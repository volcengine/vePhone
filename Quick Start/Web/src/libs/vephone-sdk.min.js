!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).vePhoneSDK=t()}(this,(function(){"use strict";function _asyncIterator(e){var t,r,n,i=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new AsyncFromSyncIterator(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function AsyncFromSyncIterator(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return(AsyncFromSyncIterator=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new AsyncFromSyncIterator(e)}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(l){u=!0,i=l}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty$1(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _regeneratorRuntime(){_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(P){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof m?t:m,a=Object.create(o.prototype),s=new O(n||[]);return i(a,"_invoke",{value:C(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(n){return{type:"throw",arg:n}}}t.wrap=l;var p="suspendedStart",_="executing",h="completed",f={};function m(){}function g(){}function v(){}var y={};u(y,a,(function(){return this}));var S=Object.getPrototypeOf,E=S&&S(S(M([])));E&&E!==r&&n.call(E,a)&&(y=E);var T=v.prototype=m.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function r(i,o,a,s){var c=d(e[i],e,o);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var o;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function C(t,r,n){var i=p;return function(o,a){if(i===_)throw new Error("Generator is already running");if(i===h){if("throw"===o)throw a;return{value:e,done:!0}}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var c=k(s,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===p)throw i=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=_;var u=d(t,r,n);if("normal"===u.type){if(i=n.done?h:"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=h,n.method="throw",n.arg=u.arg)}}}function k(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,k(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var o=d(i,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,f;var a=o.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,f):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function M(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return g.prototype=v,i(T,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:g,configurable:!0}),g.displayName=u(v,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,c,"GeneratorFunction")),e.prototype=Object.create(T),e},t.awrap=function(e){return{__await:e}},b(R.prototype),u(R.prototype,s,(function(){return this})),t.AsyncIterator=R,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new R(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(T),u(T,c,"Generator"),u(T,a,(function(){return this})),u(T,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=M,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),A(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;A(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:M(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),f}},t}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(u){return void r(u)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){asyncGeneratorStep(o,n,i,a,s,"next",e)}function s(e){asyncGeneratorStep(o,n,i,a,s,"throw",e)}a(void 0)}))}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$1(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e2){return!1}}function _construct(e,t,r){return(_construct=_isNativeReflectConstruct()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&_setPrototypeOf(i,r.prototype),i}).apply(null,arguments)}function _isNativeFunction(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(e2){return"function"==typeof e}}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(r,e)},_wrapNativeSuper(e)}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,i=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,n=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=_superPropBase(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},_get.apply(this,arguments)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:String(t)}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs$1(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){if(this instanceof e){var r=[null];r.push.apply(r,arguments);var n=Function.bind.apply(t,r);return new n}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),r}var eventEmitter={exports:{}},d$3={exports:{}},_undefined$1=void 0,is$4=function(e){return e!==_undefined$1&&null!==e},isValue$3=is$4,possibleTypes={object:!0,function:!0,undefined:!0},is$3=function(e){return!!isValue$3(e)&&hasOwnProperty.call(possibleTypes,_typeof(e))},isObject$9=is$3,is$2=function(e){if(!isObject$9(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(t){return!1}},isPrototype$5=is$2,is$1=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(t){return!1}return!isPrototype$5(e)},isFunction$6=is$1,classRe=/^\s*class[\s{/}]/,functionToString$1=Function.prototype.toString,is=function(e){return!!isFunction$6(e)&&!classRe.test(functionToString$1.call(e))},isImplemented$2=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")},isImplemented$1,hasRequiredIsImplemented;function requireIsImplemented(){return hasRequiredIsImplemented?isImplemented$1:(hasRequiredIsImplemented=1,isImplemented$1=function(){try{return Object.keys("primitive"),!0}catch(e2){return!1}})}var noop$1=function(){},_undefined=noop$1(),isValue$2=function(e){return e!==_undefined&&null!==e},shim$2,hasRequiredShim$2,keys$5,hasRequiredKeys,validValue,hasRequiredValidValue,shim$1,hasRequiredShim$1;function requireShim$2(){if(hasRequiredShim$2)return shim$2;hasRequiredShim$2=1;var e=isValue$2,t=Object.keys;return shim$2=function(r){return t(e(r)?Object(r):r)}}function requireKeys(){return hasRequiredKeys?keys$5:(hasRequiredKeys=1,keys$5=requireIsImplemented()()?Object.keys:requireShim$2())}function requireValidValue(){if(hasRequiredValidValue)return validValue;hasRequiredValidValue=1;var e=isValue$2;return validValue=function(t){if(!e(t))throw new TypeError("Cannot use null or undefined");return t}}function requireShim$1(){if(hasRequiredShim$1)return shim$1;hasRequiredShim$1=1;var e=requireKeys(),t=requireValidValue(),r=Math.max;return shim$1=function(n,i){var o,a,s,c=r(arguments.length,2);for(n=Object(t(n)),s=function(e){try{n[e]=i[e]}catch(e2){o||(o=e2)}},a=1;a<c;++a)e(i=arguments[a]).forEach(s);if(void 0!==o)throw o;return n},shim$1}var assign$3=isImplemented$2()?Object.assign:requireShim$1(),isValue$1=isValue$2,forEach$2=Array.prototype.forEach,create$2=Object.create,process$1=function(e,t){var r;for(r in e)t[r]=e[r]},normalizeOptions=function(e){var t=create$2(null);return forEach$2.call(arguments,(function(e){isValue$1(e)&&process$1(Object(e),t)})),t},str="razdwatrzy",isImplemented=function(){return"function"==typeof str.contains&&(!0===str.contains("dwa")&&!1===str.contains("foo"))},shim,hasRequiredShim;function requireShim(){if(hasRequiredShim)return shim;hasRequiredShim=1;var e=String.prototype.indexOf;return shim=function(t){return e.call(this,t,arguments[1])>-1},shim}var contains$1=isImplemented()?String.prototype.contains:requireShim(),isValue=is$4,isPlainFunction=is,assign$2=assign$3,normalizeOpts=normalizeOptions,contains=contains$1,d$2=d$3.exports=function(e,t){var r,n,i,o,a;return arguments.length<2||"string"!=typeof e?(o=t,t=e,e=null):o=arguments[2],isValue(e)?(r=contains.call(e,"c"),n=contains.call(e,"e"),i=contains.call(e,"w")):(r=i=!0,n=!1),a={value:t,configurable:r,enumerable:n,writable:i},o?assign$2(normalizeOpts(o),a):a};d$2.gs=function(e,t,r){var n,i,o,a;return"string"!=typeof e?(o=r,r=t,t=e,e=null):o=arguments[3],isValue(t)?isPlainFunction(t)?isValue(r)?isPlainFunction(r)||(o=r,r=void 0):r=void 0:(o=t,t=r=void 0):t=void 0,isValue(e)?(n=contains.call(e,"c"),i=contains.call(e,"e")):(n=!0,i=!1),a={get:t,set:r,configurable:n,enumerable:i},o?assign$2(normalizeOpts(o),a):a};var dExports=d$3.exports,validCallable=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e},module2,exports2,on,_once2,off,emit,methods,descriptors2,base,d2,callable,apply2,call,create2,defineProperty2,defineProperties,hasOwnProperty2,descriptor;module2=eventEmitter,exports2=eventEmitter.exports,d2=dExports,callable=validCallable,apply2=Function.prototype.apply,call=Function.prototype.call,create2=Object.create,defineProperty2=Object.defineProperty,defineProperties=Object.defineProperties,hasOwnProperty2=Object.prototype.hasOwnProperty,descriptor={configurable:!0,enumerable:!1,writable:!0},_once2=function(e,t){var r,n;return callable(t),n=this,on.call(this,e,r=function(){off.call(n,e,r),apply2.call(t,this,arguments)}),r.__eeOnceListener__=t,this},emit=function(e){var t,r,n,i,o;if(hasOwnProperty2.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"===_typeof(i)){for(r=arguments.length,o=new Array(r-1),t=1;t<r;++t)o[t-1]=arguments[t];for(i=i.slice(),t=0;n=i[t];++t)apply2.call(n,this,o)}else switch(arguments.length){case 1:call.call(i,this);break;case 2:call.call(i,this,arguments[1]);break;case 3:call.call(i,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,o=new Array(r-1),t=1;t<r;++t)o[t-1]=arguments[t];apply2.call(i,this,o)}},methods={on:on=function(e,t){var r;return callable(t),hasOwnProperty2.call(this,"__ee__")?r=this.__ee__:(r=descriptor.value=create2(null),defineProperty2(this,"__ee__",descriptor),descriptor.value=null),r[e]?"object"===_typeof(r[e])?r[e].push(t):r[e]=[r[e],t]:r[e]=t,this},once:_once2,off:off=function(e,t){var r,n,i,o;if(callable(t),!hasOwnProperty2.call(this,"__ee__"))return this;if(!(r=this.__ee__)[e])return this;if("object"===_typeof(n=r[e]))for(o=0;i=n[o];++o)i!==t&&i.__eeOnceListener__!==t||(2===n.length?r[e]=n[o?0:1]:n.splice(o,1));else n!==t&&n.__eeOnceListener__!==t||delete r[e];return this},emit:emit},descriptors2={on:d2(on),once:d2(_once2),off:d2(off),emit:d2(emit)},base=defineProperties({},descriptors2),module2.exports=exports2=function(e){return null==e?create2(base):defineProperties(Object(e),descriptors2)},exports2.methods=methods;var eventEmitterExports=eventEmitter.exports,EventEmitter$2=getDefaultExportFromCjs$1(eventEmitterExports),_e$1=function(){return(_e$1=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function t$2(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function i$3(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(s){i={error:s}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function o$1(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i$3(arguments[t]));return e}var n$1,r$1=function(){function e(){this._hooks={},this._cache=[],this._hooksCache={}}return e.prototype.on=function(e,t){e&&t&&"function"==typeof t&&(this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(t))},e.prototype.once=function(e,t){var r=this;e&&t&&"function"==typeof t&&this.on(e,(function n(i){t(i),r.off(e,n)}))},e.prototype.off=function(e,t){if(e&&this._hooks[e]&&this._hooks[e].length)if(t){var r=this._hooks[e].indexOf(t);-1!==r&&this._hooks[e].splice(r,1)}else this._hooks[e]=[]},e.prototype.emit=function(e,t,r){if(r){if(!e)return;-1!==this._cache.indexOf(r)?this._emit(e,t):(this._hooksCache.hasOwnProperty(r)||(this._hooksCache[r]={}),this._hooksCache[r].hasOwnProperty(e)||(this._hooksCache[r][e]=[]),this._hooksCache[r][e].push(t))}else this._emit(e,t)},e.prototype._emit=function(e,t){e&&this._hooks[e]&&this._hooks[e].length&&o$1(this._hooks[e]).forEach((function(e){try{e(t)}catch(r){}}))},e.prototype.set=function(e){e&&-1===this._cache.indexOf(e)&&this._cache.push(e)},e}(),s$1=function(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)},a$1=(n$1=+Date.now()+Number((""+Math.random()).slice(2,8)),function(){return n$1+=1}),c$2=function(e){return function(e,t,r){if("string"==typeof e&&"number"==typeof r){var n,i=[];r=r<=25?r:r%25;var o=String.fromCharCode(r+97);n=e.split(o);for(var a=0;a<n.length;a++){var s=parseInt(n[a],r);s=1*s^64;var c=String.fromCharCode(s);i.push(c)}return i.join("")}}(e,0,25)},l$1=function(e,t){void 0===e&&(e=function(){}),void 0===t&&(t=1e3);var r,n=Date.now()+t;return r=window.setTimeout((function i(){var o=Date.now()-n;e(),n+=t,r=window.setTimeout(i,Math.max(0,t-o))}),t),function(){window.clearTimeout(r)}},u$1=function(e){var t=document.createElement("a");return t.href=e,t},p$1=function(e){var t={};try{var r=u$1(e).search;if(!r)return t;(r=r.slice(1)).split("&").forEach((function(e){var r,n,i=e.split("=");i.length&&(r=i[0],n=i[1]);try{t[r]=decodeURIComponent(void 0===n?"":n)}catch(o){t[r]=n}}))}catch(n){}return t},h$1=function(e){for(var t=0,r=0,n=(e+="").length,i=0;i<n;i++)((t=31*t+e.charCodeAt(r++))>0x7fffffffffff||t<-0x800000000000)&&(t&=0xffffffffffff);return t<0&&(t+=0x7ffffffffffff),t},f$1,d$1=(e2=f$1={exports:{}},f$1.exports,i2=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var n in r)t[n]=r[n]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(n){function i(){}function o(t,r,o){if("undefined"!=typeof document){"number"==typeof(o=e({path:"/"},i.defaults,o)).expires&&(o.expires=new Date(1*new Date+864e5*o.expires)),o.expires=o.expires?o.expires.toUTCString():"";try{var a=JSON.stringify(r);/^[\{\[]/.test(a)&&(r=a)}catch(u){}r=n.write?n.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var s="";for(var c in o)o[c]&&(s+="; "+c,!0!==o[c]&&(s+="="+o[c].split(";")[0]));return document.cookie=t+"="+r+s}}function a(e,r){if("undefined"!=typeof document){for(var i={},o=document.cookie?document.cookie.split("; "):[],a=0;a<o.length;a++){var s=o[a].split("="),c=s.slice(1).join("=");r||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var u=t(s[0]);if(c=(n.read||n)(c,u)||t(c),r)try{c=JSON.parse(c)}catch(l){}if(i[u]=c,e===u)break}catch(l){}}return e?i[e]:i}}return i.set=o,i.get=function(e){return a(e,!1)},i.getJSON=function(e){return a(e,!0)},i.remove=function(t,r){o(t,"",e(r,{expires:-1}))},i.defaults={},i.withConverter=r,i}((function(){}))},e2.exports=i2(),f$1.exports),g$1=function(e,t){try{return e?d$1.get(e,{domain:t||document.domain}):d$1.get()}catch(r){return""}},m$1=function(e,t,r,n){try{var i=n||document.domain,o=+new Date+(r||6048e5);d$1.set(e,t,{expires:new Date(o),path:"/",domain:i})}catch(a){}},_=function(){function e(){this.cache={}}return e.prototype.setItem=function(e,t){this.cache[e]=t},e.prototype.getItem=function(e){return this.cache[e]},e.prototype.removeItem=function(e){this.cache[e]=void 0},e.prototype.getCookie=function(e,t){return g$1(e,t)},e.prototype.setCookie=function(e,t,r,n){m$1(e,t,r,n)},e}(),e2,i2,y,v$2,b$1={getItem:function(e){try{var t=localStorage.getItem(e),r=t;try{t&&"string"==typeof t&&(r=JSON.parse(t))}catch(n){}return r||{}}catch(n){}return{}},setItem:function(e,t){try{var r="string"==typeof t?t:JSON.stringify(t);localStorage.setItem(e,r)}catch(n){}},removeItem:function(e){try{localStorage.removeItem(e)}catch(t){}},getCookie:function(e,t){return g$1(e,t)},setCookie:function(e,t,r,n){m$1(e,t,r,n)},isSupportLS:function(){try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(e2){return!1}}()},E$1={getItem:function(e){try{var t=sessionStorage.getItem(e),r=t;try{t&&"string"==typeof t&&(r=JSON.parse(t))}catch(n){}return r||{}}catch(n){}return{}},setItem:function(e,t){try{var r="string"==typeof t?t:JSON.stringify(t);sessionStorage.setItem(e,r)}catch(n){}},removeItem:function(e){try{sessionStorage.removeItem(e)}catch(t){}},getCookie:function(e,t){return g$1(e,t)},setCookie:function(e,t,r,n){m$1(e,t,r,n)},isSupportSession:function(){try{return sessionStorage.setItem("_ranger-test-key","hi"),sessionStorage.getItem("_ranger-test-key"),sessionStorage.removeItem("_ranger-test-key"),!0}catch(e2){return!1}}()},S=function(){function e(e,t){this._storage=t&&"session"===t?E$1:!e&&b$1.isSupportLS?b$1:new _}return e.prototype.getItem=function(e){return this._storage.getItem(e)},e.prototype.setItem=function(e,t){this._storage.setItem(e,t)},e.prototype.getCookie=function(e,t){return this._storage.getCookie(e,t)},e.prototype.setCookie=function(e,t,r,n){this._storage.setCookie(e,t,r,n)},e.prototype.removeItem=function(e){this._storage.removeItem(e)},e}(),w$1=function(){function e(e,t,r){this.appid=e,this.domain=t,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=r}return e.prototype.init=function(){var e=window.navigator.userAgent,t=window.navigator.language,r=document.referrer,n=r?u$1(r).hostname:"",i=p$1(window.location.href),o=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(this.appVersion)?"wap":"web";this.utm=function(e,t,r,n){var i=new S(!1),o=new S(!1,"session"),a=e?"_tea_utm_cache_"+e:"_tea_utm_cache",s=e?"_$utm_from_url_"+e:"_$utm_from_url",c={},u=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],l={ad_id:Number(t.ad_id)||void 0,campaign_id:Number(t.campaign_id)||void 0,creative_id:Number(t.creative_id)||void 0,utm_source:t.utm_source,utm_medium:t.utm_medium,utm_campaign:t.utm_campaign,utm_term:t.utm_term,utm_content:t.utm_content,tr_shareuser:t.tr_shareuser,tr_admaster:t.tr_admaster,tr_param1:t.tr_param1,tr_param2:t.tr_param2,tr_param3:t.tr_param3,tr_param4:t.tr_param4};try{var d=!1;for(var p in l)l[p]&&(-1!==u.indexOf(p)?(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data[p]=l[p]):c[p]=l[p],d=!0);if(d)o.setItem(s,"1"),i.setCookie(a,JSON.stringify(c),n,r);else{var _=i.getCookie(a,r);_&&(c=JSON.parse(_))}o.getItem(s)&&(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data.$utm_from_url=1)}catch(h){return l}return c}(this.appid,i,this.domain,this.cookie_expire);var a=this.browser(),s=this.os();return{browser:a.browser,browser_version:a.browser_version,platform:o,os_name:s.os_name,os_version:s.os_version,userAgent:e,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(s.os_name),language:t,referrer:r,referrer_host:n,utm:this.utm,latest_data:this.last(r,n)}},e.prototype.last=function(e,t){var r="",n="",i="",o=location.hostname,a=!1;if(e&&t&&o!==t){r=e,n=t,a=!0;var s=p$1(e);s.keyword&&(i=s.keyword)}return{$latest_referrer:r,$latest_referrer_host:n,$latest_search_keyword:i,isLast:a}},e.prototype.browser=function(){var e,t,r="",n=""+parseFloat(this.appVersion),i=this.userAgent;return-1!==i.indexOf("Edge")||-1!==i.indexOf("Edg")?(r="Microsoft Edge",-1!==i.indexOf("Edge")?(e=i.indexOf("Edge"),n=i.substring(e+5)):(e=i.indexOf("Edg"),n=i.substring(e+4))):-1!==(e=i.indexOf("MSIE"))?(r="Microsoft Internet Explorer",n=i.substring(e+5)):-1!==(e=i.indexOf("Lark"))?(r="Lark",n=i.substring(e+5,e+11)):-1!==(e=i.indexOf("MetaSr"))?(r="sougoubrowser",n=i.substring(e+7,e+10)):-1!==i.indexOf("MQQBrowser")||-1!==i.indexOf("QQBrowser")?(r="qqbrowser",-1!==i.indexOf("MQQBrowser")?(e=i.indexOf("MQQBrowser"),n=i.substring(e+11,e+15)):-1!==i.indexOf("QQBrowser")&&(e=i.indexOf("QQBrowser"),n=i.substring(e+10,e+17))):-1!==i.indexOf("Chrome")?-1!==(e=i.indexOf("MicroMessenger"))?(r="weixin",n=i.substring(e+15,e+20)):-1!==(e=i.indexOf("360"))?(r="360browser",n=i.substring(i.indexOf("Chrome")+7)):-1!==i.indexOf("baidubrowser")||-1!==i.indexOf("BIDUBrowser")?(-1!==i.indexOf("baidubrowser")?(e=i.indexOf("baidubrowser"),n=i.substring(e+13,e+16)):-1!==i.indexOf("BIDUBrowser")&&(e=i.indexOf("BIDUBrowser"),n=i.substring(e+12,e+15)),r="baidubrowser"):-1!==(e=i.indexOf("xiaomi"))?-1!==i.indexOf("openlanguagexiaomi")?(r="openlanguage xiaomi",n=i.substring(e+7,e+13)):(r="xiaomi",n=i.substring(e-7,e-1)):-1!==(e=i.indexOf("TTWebView"))?(r="TTWebView",n=i.substring(e+10,e+23)):(-1!==(e=i.indexOf("Chrome"))||-1!==(e=i.indexOf("Chrome")))&&(r="Chrome",n=i.substring(e+7)):-1!==i.indexOf("Safari")?-1!==(e=i.indexOf("QQ"))?(r="qqbrowser",n=i.substring(e+10,e+16)):-1!==(e=i.indexOf("Safari"))&&(r="Safari",n=i.substring(e+7),-1!==(e=i.indexOf("Version"))&&(n=i.substring(e+8))):-1!==(e=i.indexOf("Firefox"))?(r="Firefox",n=i.substring(e+8)):-1!==(e=i.indexOf("MicroMessenger"))?(r="weixin",n=i.substring(e+15,e+20)):-1!==(e=i.indexOf("QQ"))&&(r="qqbrowser",n=i.substring(e+3,e+8)),-1!==(t=n.indexOf(";"))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(" "))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(")"))&&(n=n.substring(0,t)),{browser:r,browser_version:n}},e.prototype.os=function(){for(var e="",t="",r=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"chromeOS",r:/CrOS/},{s:"Linux",r:/(Linux|X11)/},{s:"Sun OS",r:/SunOS/}],n=0;n<r.length;n++){var i=r[n];if(i.r.test(this.userAgent)){"Mac OS X"===(e=i.s)&&this.isNewIpad()&&(e="iOS");break}}var o,a,s=function(e,t){var r=e.exec(t);return r&&r[1]?r[1]:""},c=function(e,t){var r=RegExp("(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:"+e+")","i").exec(t);return r?r.slice(1)[0]:""};switch(/Windows/.test(e)&&(t=s(/Windows (.*)/,e),e="windows"),e){case"Mac OS X":t=c("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),e="mac";break;case"Android":(a=s(/Android ([\.\_\d]+)/,o=this.userAgent))||(a=s(/Android\/([\.\_\d]+)/,o)),t=a,e="android";break;case"iOS":t=this.isNewIpad()?c("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(t=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?t[1]+"."+t[2]+"."+(0|t[3]):"",e="ios";break;case"chromeOS":var u=this.userAgent.indexOf("x86_64");t=this.userAgent.substring(u+7,u+16)}return{os_name:e,os_version:t}},e.prototype.getDeviceModel=function(e){var t="";try{if("android"===e)navigator.userAgent.split(";").forEach((function(e){e.indexOf("Build/")>-1&&(t=e.slice(0,e.indexOf("Build/")))}));else if("ios"===e||"mac"===e||"windows"===e)if(this.isNewIpad())t="iPad";else{var r=navigator.userAgent.replace("Mozilla/5.0 (",""),n=r.indexOf(";");t=r.slice(0,n)}}catch(i){return t.trim()}return t.trim()},e.prototype.isNewIpad=function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>1},e}(),k={cn:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},D={cn:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az28z1gz1hz1gz1cz18z1nz1gz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz21z1ez18z1jz1gz49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz18z1jz1gz24z18z49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k"},G="5.1.10",z=function(){function e(e,t){this.collector=e,this.config=t,this.eventNameWhiteList=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure"],this.paramsNameWhiteList=["$inactive","$inline","$target_uuid_list","$source_uuid","$is_spider","$source_id","$is_first_time","_staging_flag"],this.regStr=new RegExp("^[a-zA-Z0-9][a-z0-9A-Z_.-]{1,255}$")}return e.prototype.checkVerify=function(e){var t=this;if(!e||!e.length)return!1;var r=e[0];if(!r)return!1;var n=r.events,i=r.header;if(!n||!n.length)return!1;var o=!0;return n.forEach((function(e){if(!e)return o=!1,void(e.checkEvent="事件异常");t.checkEventName(e.event)||(o=!1,e.checkEvent="事件名不能以 $ or __开头"),t.checkEventParams(e.params)||(o=!1,e.checkParams="属性名不能以 $ or __开头")})),this.checkEventParams(i)||(o=!1),o},e.prototype.checkEventName=function(e){return!!e&&this.calculate(e,"event")},e.prototype.checkEventParams=function(e){var t=e;if("string"==typeof e&&(t=JSON.parse(t)),!Object.keys(t).length)return!0;for(var r in t)return!(!this.calculate(r,"params")||"string"==typeof t[r]&&t[r].length>1024&&(console.warn("params: "+r+" can not over 1024 byte, please check;"),1));return!0},e.prototype.calculate=function(e,t){return-1!==("event"===t?this.eventNameWhiteList:this.paramsNameWhiteList).indexOf(e)||!new RegExp("^\\$").test(e)&&!new RegExp("^__").test(e)||(console.warn(("event"===t?"event":"params")+" name: "+e+" can not start with $ or __, pleace check;"),!1)},e}();!function(e){e.Init="init",e.Config="config",e.Start="start",e.Ready="ready",e.UnReady="un-ready",e.TokenComplete="token-complete",e.TokenStorage="token-storage",e.TokenFetch="token-fetch",e.TokenError="token-error",e.ConfigUuid="config-uuid",e.ConfigWebId="config-webid",e.ConfigDomain="config-domain",e.CustomWebId="custom-webid",e.TokenChange="token-change",e.TokenReset="token-reset",e.ConfigTransform="config-transform",e.EnvTransform="env-transform",e.SessionReset="session-reset",e.SessionResetTime="session-reset-time",e.SetSessionId="set-session-id",e.Event="event",e.Events="events",e.EventNow="event-now",e.CleanEvents="clean-events",e.BeconEvent="becon-event",e.SubmitBefore="submit-before",e.SubmitScuess="submit-scuess",e.SubmitAfter="submit-after",e.SubmitError="submit-error",e.SubmitVerify="submit-verify",e.Stay="stay",e.ResetStay="reset-stay",e.StayReady="stay-ready",e.SetStay="set-stay",e.RouteChange="route-change",e.RouteReady="route-ready",e.Ab="ab",e.AbVar="ab-var",e.AbAllVars="ab-all-vars",e.AbConfig="ab-config",e.AbExternalVersion="ab-external-version",e.AbVersionChangeOn="ab-version-change-on",e.AbVersionChangeOff="ab-version-change-off",e.AbOpenLayer="ab-open-layer",e.AbCloseLayer="ab-close-layer",e.AbReady="ab-ready",e.AbComplete="ab-complete",e.AbTimeout="ab-timeout",e.Profile="profile",e.ProfileSet="profile-set",e.ProfileSetOnce="profile-set-once",e.ProfileUnset="profile-unset",e.ProfileIncrement="profile-increment",e.ProfileAppend="profile-append",e.ProfileClear="profile-clear",e.Autotrack="autotrack",e.AutotrackReady="autotrack-ready",e.CepReady="cep-ready",e.TracerReady="tracer-ready",e.sessionRecord="session-record",e.SessionRecordStart="session-record-start",e.SessionRecordPause="session-record-pause",e.SessionRecordEnd="session-record-end",e.SessionRecordReport="session-record-report",e.DestoryInstance="destory-instance",e.VisualCollectReady="visual-collect-ready",e.VisualApiReady="visual-api-ready",e.VisualApiUpdate="visual-api-update"}(y||(y={})),function(e){e.DEBUGGER_MESSAGE="debugger-message",e.DEBUGGER_MESSAGE_SDK="debugger-message-sdk",e.DEBUGGER_MESSAGE_FETCH="debugger-message-fetch",e.DEBUGGER_MESSAGE_FETCH_RESULT="debugger-message-fetch-result",e.DEBUGGER_MESSAGE_EVENT="debugger-message-event",e.DEVTOOL_WEB_READY="devtool-web-ready"}(v$2||(v$2={}));var A=y,I=void 0,M=(new Date).getTimezoneOffset(),O=parseInt(""+-M/60,10),T=60*M,R=7776e6,x=function(){function e(e,t){this.is_first_time=!0,this.configPersist=!1,this.initConfig=t,this.collect=e;var r=new w$1(t.app_id,t.cookie_domain||"",t.cookie_expire||R).init();this.eventCheck=new z(e,t);var n="__tea_cache_first_"+t.app_id;this.configKey="__tea_cache_config_"+t.app_id,this.sessionStorage=new S(!1,"session"),this.localStorage=new S(!1,"local"),t.configPersist&&(this.configPersist=!0,this.storage=1===t.configPersist?this.sessionStorage:this.localStorage);var i=this.localStorage.getItem(n);i&&1==i?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(n,"1")),this.envInfo={user:{user_unique_id:I,user_type:I,user_id:I,user_is_auth:I,user_is_login:I,device_id:I,web_id:I,ip_addr_id:I,user_unique_id_type:I},header:{app_id:I,app_name:I,app_install_id:I,install_id:I,app_package:I,app_channel:I,app_version:I,ab_version:I,os_name:r.os_name,os_version:r.os_version,device_model:r.device_model,ab_client:I,traffic_type:I,client_ip:I,device_brand:I,os_api:I,access:I,language:r.language,region:I,app_language:I,app_region:I,creative_id:r.utm.creative_id,ad_id:r.utm.ad_id,campaign_id:r.utm.campaign_id,log_type:I,rnd:I,platform:r.platform,sdk_version:G,sdk_lib:"js",province:I,city:I,timezone:O,tz_offset:T,tz_name:I,sim_region:I,carrier:I,resolution:r.screen_width+"x"+r.screen_height,browser:r.browser,browser_version:r.browser_version,referrer:r.referrer,referrer_host:r.referrer_host,width:r.screen_width,height:r.screen_height,screen_width:r.screen_width,screen_height:r.screen_height,utm_term:r.utm.utm_term,utm_content:r.utm.utm_content,utm_source:r.utm.utm_source,utm_medium:r.utm.utm_medium,utm_campaign:r.utm.utm_campaign,tracer_data:JSON.stringify(r.utm.tracer_data),custom:{},wechat_unionid:I,wechat_openid:I}},this.ab_version="",this.evtParams={},this.reportErrorCallback=function(){},this.isLast=!1,this.setCustom(r),this.initDomain(),this.initABData()}return e.prototype.initDomain=function(){var e=this.initConfig.channel_domain;if(e)this.domain=e;else{var t=this.initConfig.channel;this.domain=c$2(D[t])}},e.prototype.setDomain=function(e){this.domain=e},e.prototype.getDomain=function(){return this.domain},e.prototype.initABData=function(){var e="__tea_sdk_ab_version_"+this.initConfig.app_id,t=null;if(this.initConfig.ab_cross){var r=this.localStorage.getCookie(e,this.initConfig.ab_cookie_domain);t=r?JSON.parse(r):null}else t=this.localStorage.getItem(e);this.setAbCache(t)},e.prototype.setAbCache=function(e){this.ab_cache=e},e.prototype.getAbCache=function(){return this.ab_cache},e.prototype.setAbVersion=function(e){this.ab_version=e},e.prototype.getAbVersion=function(){return this.ab_version},e.prototype.clearAbCache=function(){this.ab_version="",this.ab_cache={}},e.prototype.getUrl=function(e){var t="";switch(e){case"event":t="/list";break;case"webid":t="/webid";break;case"tobid":t="/tobid"}var r="";return this.initConfig.caller&&(r="?sdk_version="+G+"&sdk_name=web&app_id="+this.initConfig.app_id+"&caller="+this.initConfig.caller),""+this.getDomain()+t+r},e.prototype.setCustom=function(e){if(e&&e.latest_data&&e.latest_data.isLast)for(var t in delete e.latest_data.isLast,this.isLast=!0,e.latest_data)this.envInfo.header.custom[t]=e.latest_data[t]},e.prototype.set=function(e){var t=this;Object.keys(e).forEach((function(r){void 0!==e[r]&&null!==e[r]||t.delete(r);try{t.eventCheck.calculate(r,"config")}catch(e2){}if("traffic_type"===r&&t.isLast&&(t.envInfo.header.custom.$latest_traffic_source_type=e[r]),"evtParams"===r)t.evtParams=_e$1({},t.evtParams||{},e.evtParams||{});else if("_staging_flag"===r)t.evtParams=_e$1({},t.evtParams||{},{_staging_flag:e._staging_flag});else if("reportErrorCallback"===r&&"function"==typeof e[r])t.reportErrorCallback=e[r];else{var n="",i="";if(r.indexOf(".")>-1){var o=r.split(".");n=o[0],i=o[1]}n?"user"===n||"header"===n?t.envInfo[n][i]=e[r]:t.envInfo.header.custom[i]=e[r]:Object.hasOwnProperty.call(t.envInfo.user,r)?["user_type","ip_addr_id"].indexOf(r)>-1?t.envInfo.user[r]=e[r]?Number(e[r]):e[r]:["user_id","web_id","user_unique_id","user_unique_id_type"].indexOf(r)>-1?t.envInfo.user[r]=e[r]?String(e[r]):e[r]:["user_is_auth","user_is_login"].indexOf(r)>-1?t.envInfo.user[r]=Boolean(e[r]):"device_id"===r&&(t.envInfo.user[r]=e[r]):Object.hasOwnProperty.call(t.envInfo.header,r)?t.envInfo.header[r]=e[r]:t.envInfo.header.custom[r]=e[r]}}))},e.prototype.get=function(e){try{return e?"evtParams"===e?this.evtParams:"reportErrorCallback"===e?this[e]:Object.hasOwnProperty.call(this.envInfo.user,e)?this.envInfo.user[e]:Object.hasOwnProperty.call(this.envInfo.header,e)?this.envInfo.header[e]:JSON.parse(JSON.stringify(this.envInfo[e])):JSON.parse(JSON.stringify(this.envInfo))}catch(t){console.log("get config stringify error "),this.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},e.prototype.setStore=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey)||{};if(t&&Object.keys(e).length){var r=Object.assign(e,t);this.storage.setItem(this.configKey,r)}}catch(n){console.log("setStore error"),this.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:n.message})}},e.prototype.getStore=function(){try{if(!this.configPersist)return null;var e=this.storage.getItem(this.configKey)||{};return e&&Object.keys(e).length?e:null}catch(t){return this.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),null}},e.prototype.delete=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey)||{};t&&Object.hasOwnProperty.call(t,e)&&(delete t[e],this.storage.setItem(this.configKey,t))}catch(r){this.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:r.message}),console.log("delete error")}},e}(),C=function(){function e(e,t){this.isLog=t||!1,this.name=e||""}return e.prototype.info=function(e){this.isLog&&console.log("%c %s","color: yellow; background-color: black;","[AppLog WEB SDK] [instance: "+this.name+"] "+e)},e.prototype.warn=function(e){this.isLog&&console.warn("[AppLog WEB SDK] [instance: "+this.name+"] "+e)},e.prototype.error=function(e){this.isLog&&console.error("[AppLog WEB SDK] [instance: "+this.name+"] "+e)},e.prototype.throw=function(e){throw this.error(this.name),new Error(e)},e}(),B=function(){function e(){this.spiderBot=["Baiduspider","googlebot","360Spider","haosouspider","YoudaoBot","Sogou News Spider","Yisouspider","Googlebot","Headless","Applebot","Bingbot","PetalBot"]}return e.prototype.checkSpider=function(e){if(!e.enable_spider)return!1;var t=window.navigator.userAgent;if(!t)return!0;var r=!1;return this.spiderBot.forEach((function(e){-1!==t.indexOf(e)&&(r=!0)})),r},e}(),U=function(){function e(e,t){this.collect=e,this.native=t}var t=e.prototype;return t.bridgeInject=function(){try{return!!this.native&&(AppLogBridge?(console.log("AppLogBridge is injected"),!0):(console.log("AppLogBridge is not inject"),!1))}catch(e){return console.log("AppLogBridge is not inject"),!1}},t.bridgeReady=function(){var e=this;return new Promise((function(t,r){try{e.bridgeInject()?AppLogBridge.hasStarted((function(e){console.log("AppLogBridge is started? : "+e),e?t(!0):r(!1)})):r(!1)}catch(n){console.log("AppLogBridge, error:"+JSON.stringify(n.stack)),r(!1)}}))},t.setNativeAppId=function(e){try{AppLogBridge.setNativeAppId(JSON.stringify(e)),console.log("change bridge appid, event report with appid: "+e)}catch(t){console.error("setNativeAppId error")}},t.setConfig=function(e){var t=this;try{Object.keys(e).forEach((function(r){"user_unique_id"===r?t.setUserUniqueId(e[r]):e[r]?t.addHeaderInfo(r,e[r]):t.removeHeaderInfo(r)}))}catch(r){console.error("setConfig error")}},t.setUserUniqueId=function(e){try{AppLogBridge.setUserUniqueId(e)}catch(t){console.error("setUserUniqueId error")}},t.addHeaderInfo=function(e,t){try{AppLogBridge.addHeaderInfo(e,t)}catch(r){console.error("addHeaderInfo error")}},t.setHeaderInfo=function(e){try{AppLogBridge.setHeaderInfo(JSON.stringify(e))}catch(t){console.error("setHeaderInfo error")}},t.removeHeaderInfo=function(e){try{AppLogBridge.removeHeaderInfo(e)}catch(t){console.error("removeHeaderInfo error")}},t.reportPv=function(e){this.onEventV3("predefine_pageview",e)},t.onEventV3=function(e,t){try{AppLogBridge.onEventV3(e,t),this.collect.emit(DebuggerMesssge.DEBUGGER_MESSAGE,{type:DebuggerMesssge.DEBUGGER_MESSAGE_EVENT,info:"bridge埋点上报",time:Date.now(),data:[{events:[{event:e,params:t}]}],code:200,status:"success"})}catch(r){console.error("onEventV3 error")}},t.profileSet=function(e){try{AppLogBridge.profileSet(e)}catch(t){console.error("profileSet error")}},t.profileSetOnce=function(e){try{AppLogBridge.profileSetOnce(e)}catch(t){console.error("profileSetOnce error")}},t.profileIncrement=function(e){try{AppLogBridge.profileIncrement(e)}catch(t){console.error("profileIncrement error")}},t.profileUnset=function(e){try{AppLogBridge.profileUnset(e)}catch(t){console.error("profileUnset error")}},t.profileAppend=function(e){try{AppLogBridge.profileAppend(e)}catch(t){console.error("profileAppend error")}},e}(),P=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},N=function(){function e(){}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.storage=new S(!1,"session"),this.sessionKey="__tea_session_id_"+t.app_id,this.expireTime=t.expireTime||18e5,this.disableSession=t.disable_session,this.disableSessionTimeCheck=t.disable_session_check,this.disableSession||(this.setSessionId(),this.collect.on(A.SessionReset,(function(e){r.resetSessionId(e)})),this.collect.on(A.SessionResetTime,(function(){r.updateSessionIdTime()})))},e.prototype.updateSessionIdTime=function(){var e=this.storage.getItem(this.sessionKey);if(e&&e.sessionId){var t=e.timestamp;Date.now()-t>this.expireTime?e={sessionId:P(),timestamp:Date.now()}:e.timestamp=Date.now(),this.storage.setItem(this.sessionKey,e),this.resetExpTime()}},e.prototype.setSessionId=function(){var e=this,t=this.storage.getItem(this.sessionKey);t&&t.sessionId?t.timestamp=Date.now():t={sessionId:P(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,t),this.disableSessionTimeCheck||(this.sessionExp=setInterval((function(){e.checkEXp()}),this.expireTime))},e.prototype.getSessionId=function(){var e=this.storage.getItem(this.sessionKey);return this.disableSession?"":e&&e.sessionId?e.sessionId:""},e.prototype.resetExpTime=function(){var e=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval((function(){e.checkEXp()}),this.expireTime))},e.prototype.resetSessionId=function(e){var t={sessionId:e||P(),timestamp:Date.now()};this.storage.setItem(this.sessionKey,t)},e.prototype.checkEXp=function(){var e=this.storage.getItem(this.sessionKey);e&&e.sessionId&&Date.now()-e.timestamp+30>=this.expireTime&&(e={sessionId:P(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e))},e}(),j=function(){function e(){this.eventLimit=50,this.enable_ttwebid=!1,this.eventCache=[],this.beconEventCache=[]}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.config=t,this.configManager=e.configManager,this.eventCheck=new z(e,t),this.cacheStorgae=new S(!0),this.localStorage=new S(!1),this.maxReport=t.max_report||10,this.reportTime=t.reportTime||t.report_time||30,this.timeout=t.timeout||1e5,this.enable_ttwebid=t.enable_ttwebid,this.reportUrl=t.report_url||this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_"+this.configManager.get("app_id"),this.beconKey="__tea_cache_events_becon_"+this.configManager.get("app_id"),this.abKey="__tea_sdk_ab_version_"+this.configManager.get("app_id"),this.refer_key="__tea_cache_refer_"+this.configManager.get("app_id"),this.pageId=P(),this.collect.on(A.Ready,(function(){r.reportAll(!1)})),this.collect.on(A.ConfigDomain,(function(){r.reportUrl=r.configManager.getUrl("event")})),this.collect.on(A.Event,(function(e){r.event(e)})),this.collect.on(A.BeconEvent,(function(e){r.beconEvent(e)})),this.collect.on(A.CleanEvents,(function(){r.reportAll(!1)}));var n=this.linster();this.collect.on(A.DestoryInstance,(function(){n&&n()}))},e.prototype.linster=function(){var e,t=this,r=function(){t.reportAll(!0)};window.addEventListener("unload",r,!1),e=r,navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.addEventListener("pagehide",e,!1):window.addEventListener("beforeunload",e,!1);var n=function(){"hidden"===document.visibilityState&&t.reportAll(!0)};return document.addEventListener("visibilitychange",n,!1),function(){window.removeEventListener("unload",r),window.removeEventListener("pagehide",r,!1),window.removeEventListener("beforeunload",r,!1),document.removeEventListener("visibilitychange",n,!1)}},e.prototype.reportAll=function(e){this.report(e),this.reportBecon()},e.prototype.event=function(e){var t=this;try{var r=o$1(e,this.cacheStorgae.getItem(this.eventKey)||[]);if(this.cacheStorgae.setItem(this.eventKey,r),this.reportTimeout&&clearTimeout(this.reportTimeout),r.length>=this.maxReport)this.report(!1);else{var n=this.reportTime;this.reportTimeout=setTimeout((function(){t.report(!1),t.reportTimeout=null}),n)}}catch(i){this.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:i.message})}},e.prototype.beconEvent=function(e){var t=o$1(e,this.cacheStorgae.getItem(this.beconKey)||[]);this.cacheStorgae.setItem(this.beconKey,t),this.collect.destroy||this.collect.sdkStop||this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(t)),!0))},e.prototype.reportBecon=function(){if(!this.collect.destroy&&!this.collect.sdkStop&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var e=this.cacheStorgae.getItem(this.beconKey)||[];e&&e.length&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))}},e.prototype.report=function(e){if(!this.collect.destroy&&!this.collect.sdkStop&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var t=this.cacheStorgae.getItem(this.eventKey)||[];t.length&&(this.cacheStorgae.removeItem(this.eventKey),this.sliceEvent(t,e))}},e.prototype.sliceEvent=function(e,t){if(e.length>this.eventLimit)for(var r=0;r<e.length;r+=this.eventLimit){var n;n=e.slice(r,r+this.eventLimit);var i=this.split(this.merge(n));this.send(i,t)}else i=this.split(this.merge(e)),this.send(i,t)},e.prototype.handleRefer=function(){var e="";try{if(this.config.spa||this.config.autotrack){var t=this.localStorage.getItem(this.refer_key)||{};e=t.routeChange?t.refer_key:this.configManager.get("referrer")}else e=this.configManager.get("referrer")}catch(r){e=document.referrer}return e},e.prototype.merge=function(e,t){var r=this,n=this.configManager.get(),i=n.header,o=n.user;this.config.enable_pageid&&(i.custom.page_id=this.pageId),i.referrer=this.handleRefer(),i.custom=JSON.stringify(i.custom);var a=this.configManager.get("evtParams"),s=this.configManager.get("user_unique_id_type"),c=e.map((function(e){try{Object.keys(a).length&&!t&&(e.params=_e$1({},a,e.params)),s&&(e.params.$user_unique_id_type=s);var n=r.configManager.getAbCache(),i=o[r.config.ab_user_mode]||o.user_unique_id;return n&&n.uuid&&n.uuid===i&&r.configManager.getAbVersion()&&(e.ab_sdk_version=r.configManager.getAbVersion()),e.session_id=r.collect.sessionManager.getSessionId(),e.params=JSON.stringify(e.params),e}catch(e2){return r.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e2.message}),e}})),u=JSON.parse(JSON.stringify({events:c,user:o,header:i}));u.local_time=Math.floor(Date.now()/1e3),u.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0,u.verbose=1;var l=[];return l.push(u),l},e.prototype.split=function(e){return e.map((function(e){var t=[];return t.push(e),t}))},e.prototype.send=function(e,t){var r=this;e.length&&(this.config.disable_track_event||e.forEach((function(e){try{var n=JSON.parse(JSON.stringify(e));r.config.filter&&((n=r.config.filter(n))||console.warn("filter must return data !!")),r.collect.eventFilter&&n&&((n=r.collect.eventFilter(n))||console.warn("filterEvent api must return data !!"));var i=n||e,o=JSON.parse(JSON.stringify(i));if(r.eventCheck.checkVerify(o),!i.length)return;var a=!0;if(i.forEach((function(e){e.events.length||(a=!1)})),!a)return;r.collect.emit(A.SubmitBefore,i),r.collect.requestManager.useRequest({url:r.reportUrl,data:i,success:function(e,t){e&&0!==e.e?(r.collect.emit(A.SubmitError,{type:"f_data",eventData:t,errorCode:e.e,response:e}),r.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_EVENT,info:"埋点上报失败",time:Date.now(),data:o,code:e.e,failType:"数据异常失败",status:"fail"})):(r.collect.emit(A.SubmitScuess,{eventData:t,res:e}),r.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_EVENT,info:"埋点上报成功",time:Date.now(),data:o,code:200,status:"success"}))},fail:function(e,t){r.configManager.get("reportErrorCallback")(e,t),r.collect.emit(A.SubmitError,{type:"f_net",eventData:e,errorCode:t}),r.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_EVENT,info:"埋点上报网络异常",time:Date.now(),data:o,code:t,failType:"网络异常失败",status:"fail"})},timeout:r.timeout,useBeacon:t,withCredentials:r.enable_ttwebid}),r.collect.emit(A.SubmitAfter,i)}catch(s){console.warn("something error, "+JSON.stringify(s.stack)),r.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:s.message})}})))},e}(),q$1=function(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(10):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)}().replace(/-/g,"").slice(0,19)},K=function(){function e(){this.cacheToken={},this.enableCookie=!1,this.enable_ttwebid=!1,this.enableCustomWebid=!1}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.config=t,this.configManager=this.collect.configManager,this.storage=new S(!1),this.tokenKey="__tea_cache_tokens_"+t.app_id,this.enable_ttwebid=t.enable_ttwebid,this.enableCustomWebid=t.enable_custom_webid,this.collect.on(A.ConfigUuid,(function(e){r.setUuid(e)})),this.collect.on(A.ConfigWebId,(function(e){r.setWebId(e)})),this.enableCookie=t.cross_subdomain,this.expiresTime=t.cookie_expire||6048e5,this.cookieDomain=t.cookie_domain||"",this.checkStorage()},e.prototype.checkStorage=function(){var e=this;if(this.enableCookie){var t=this.storage.getCookie(this.tokenKey,this.cookieDomain);this.cacheToken=t&&"string"==typeof t?JSON.parse(t):{}}else this.cacheToken=this.storage.getItem(this.tokenKey)||{};this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid?this.enableCustomWebid?this.collect.on(A.CustomWebId,(function(){e.tokenReady=!0,e.collect.emit(A.TokenComplete)})):this.checkEnv()||(this.enable_ttwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()},e.prototype.check=function(){this.cacheToken&&this.cacheToken.web_id?this.complete(this.cacheToken):this.config.disable_webid?this.complete({web_id:q$1(),user_unique_id:this.configManager.get("user_unique_id")||q$1()}):this.remoteWebid()},e.prototype.checkEnv=function(){var e=window.navigator.userAgent;if(-1!==e.indexOf("miniProgram")||-1!==e.indexOf("MiniProgram")){var t=p$1(window.location.href);return!(!t||!t.Web_ID||(this.complete({web_id:""+t.Web_ID,user_unique_id:this.configManager.get("user_unique_id")||""+t.Web_ID}),0))}return!1},e.prototype.remoteWebid=function(){var e=this,t=this.configManager.getUrl("webid"),r={app_key:this.config.app_key,app_id:this.config.app_id,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer,user_unique_id:""};this.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"SDK 发起WEBID请求",logType:"fetch",level:"info",time:Date.now(),data:r}),this.collect.requestManager.useRequest({url:t,data:r,success:function(t){var r;if(t&&0===t.e)r=t.web_id,e.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"WEBID请求成功",logType:"fetch",level:"info",time:Date.now(),data:t});else{var n=q$1();r=n,e.collect.configManager.set({localWebId:n}),e.collect.emit(A.TokenError),e.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"WEBID请求返回值异常",logType:"fetch",level:"warn",time:Date.now(),data:t}),e.collect.logger.warn("appid: "+e.config.app_id+" get webid error, use local webid~")}e.complete({web_id:e.configManager.get("web_id")||r,user_unique_id:e.configManager.get("user_unique_id")||r})},fail:function(){var t=q$1();e.complete({web_id:e.configManager.get("web_id")||t,user_unique_id:e.configManager.get("user_unique_id")||t}),e.collect.configManager.set({localWebId:t}),e.collect.emit(A.TokenError),e.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"WEBID请求网络异常",logType:"fetch",level:"error",time:Date.now(),data:null}),e.collect.logger.warn("appid: "+e.config.app_id+", get webid error, use local webid~")},timeout:3e5})},e.prototype.complete=function(e){var t=e.web_id,r=e.user_unique_id;e.timestamp=Date.now(),this.collect.configManager.set({web_id:t,user_unique_id:r}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(A.TokenComplete)},e.prototype.completeTtWid=function(e){var t=e.user_unique_id||"",r=this.configManager.get("user_unique_id");(r||t)&&this.configManager.set({user_unique_id:r||t}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(A.TokenComplete)},e.prototype.setUuid=function(e){if(e&&-1===["null","undefined","Null","None"].indexOf(e)){var t=String(e),r=this.configManager.get("user_unique_id"),n=this.cacheToken&&this.cacheToken.user_unique_id;if(t===r&&t===n)return;this.configManager.set({user_unique_id:t}),this.cacheToken||(this.cacheToken={}),this.cacheToken.user_unique_id=t,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(A.TokenChange,"uuid"),this.collect.emit(A.SessionReset)}else this.clearUuid()},e.prototype.clearUuid=function(){this.config.enable_ttwebid||this.configManager.get("web_id")&&this.configManager.get("user_unique_id")!==this.configManager.get("web_id")&&(this.configManager.set({user_unique_id:this.configManager.get("web_id")}),this.cacheToken&&this.cacheToken.web_id&&(this.cacheToken.user_unique_id=this.cacheToken.web_id,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken)),this.collect.emit(A.TokenReset,"uuid"))},e.prototype.setWebId=function(e){if(e&&!this.config.enable_ttwebid){this.cacheToken&&this.cacheToken.web_id?this.cacheToken.web_id!==e&&(this.cacheToken.user_unique_id=this.cacheToken.web_id===this.cacheToken.user_unique_id?e:this.cacheToken.user_unique_id,this.cacheToken.web_id=e):(this.cacheToken={},this.cacheToken.web_id=e,this.cacheToken.user_unique_id=e),this.cacheToken.timestamp=Date.now();var t=this.configManager.get("web_id"),r=this.configManager.get("user_unique_id");r&&r!==t||(this.configManager.set({user_unique_id:e}),this.collect.emit(A.TokenChange,"uuid")),t!==e&&(this.configManager.set({web_id:e}),this.collect.emit(A.TokenChange,"webid")),this.setStorage(this.cacheToken)}},e.prototype.setStorage=function(e){e._type_=this.enableCustomWebid?"custom":"default",delete e["diss".split("").reverse().join("")],this.enableCookie||this.enable_ttwebid?(this.storage.setCookie(this.tokenKey,e,this.expiresTime,this.cookieDomain),this.enable_ttwebid&&(delete e.web_id,this.storage.setItem(this.tokenKey,e))):this.storage.setItem(this.tokenKey,e),this.cacheToken=e},e.prototype.getReady=function(){return this.tokenReady},e.prototype.getTobId=function(){var e=this;return new Promise((function(t){e.collect.requestManager.useRequest({url:e.configManager.getUrl("tobid"),data:{app_id:e.config.app_id,user_unique_id:e.configManager.get("user_unique_id"),web_id:e.configManager.get("web_id"),user_unique_id_type:e.configManager.get("user_unique_id_type")},success:function(e){e&&0===e.e?t(e.tobid):t("")},fail:function(){t("")},time:3e4,withCredentials:e.enable_ttwebid})}))},e}(),L=function(){return!(!window.navigator||!window.navigator.sendBeacon)},V=function(){function e(e,t){this.collector=e,this.config=t,this.requestType=t.request_type||"xhr",this.supportBeacon=L(),this.errorCode={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005},this.customHeader=t.custom_request_header||{}}return e.prototype.useFetch=function(e){var t=e.url,r=e.data,n=e.method,i=e.success,o=e.fail,a={"Content-Type":"application/json; charset=utf-8"};if(Object.keys(this.customHeader).length)for(var s in this.customHeader)a[s]=this.customHeader[s];window.fetch?fetch(t,{method:n||"POST",headers:a,body:JSON.stringify(r)}).then((function(e){return e.json()})).then((function(e){i&&i(e)})).catch((function(e){o&&o(r,e)})):(this.requestType="xhr",console.log("your brwoser not support fetch, use xhr"),this.useRequest({url:t,data:r,method:n,success:i,fail:o}))},e.prototype.useBeacon=function(e){var t=e.url,r=e.data,n=e.success,i=e.fail;window.navigator.sendBeacon(t,JSON.stringify(r))?n&&n():i&&i(r,this.errorCode.BEACON_FALSE)},e.prototype.useRequest=function(e){var t=this,r=e.url,n=e.data,i=e.method,o=e.success,a=e.fail,s=e.timeout,c=e.useBeacon,u=e.withCredentials,l=e.app_key,d=e.forceXhr;if(c&&this.supportBeacon)this.useBeacon({url:r,data:n,method:i,success:o,fail:a});else if("fetch"!==this.requestType||d)try{var p=new XMLHttpRequest,_=i||"POST";if(p.open(_,""+r,!0),p.setRequestHeader("Content-Type","application/json; charset=utf-8"),l&&p.setRequestHeader("X-MCS-AppKey",""+l),Object.keys(this.customHeader).length)for(var h in this.customHeader)p.setRequestHeader(h,this.customHeader[h]);u&&(p.withCredentials=!0),s&&(p.timeout=s,p.ontimeout=function(){a&&a(n,t.errorCode.TIMEOUT)}),p.onload=function(){if(o){var e=null;if(p.responseText){try{e=JSON.parse(p.responseText)}catch(t){e={}}o(e,n)}}},p.onerror=function(){p.abort(),a&&a(n,t.errorCode.XHR_ON)},p.send(JSON.stringify(n))}catch(f){}else this.useFetch({url:r,data:n,method:i,success:o,fail:a})},e}(),W=function(){function e(e,t){if(this.devToolReady=!1,this.devToolOrigin="*",this.sendAlready=!1,this.eventVerifyReady=!1,t.enable_debug){var r=e.adapters.storage;this.collect=e,this.config=t,this.app_id=t.app_id,this.cacheStorgae=new r(!1,"session"),this.eventVerifyInfo=[],this.sdk_type=G.includes("tob")?"tob":"inner",this.filterEvent=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure","bav2b_page","bav2b_beat","bav2b_page_statistics","bav2b_click","bav2b_page_exposure","_be_active","predefine_pageview","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append","predefine_page_alive","predefine_page_close","abtest_exposure"],this.load()}}return e.prototype.loadScript=function(e){try{var t=document.createElement("script");t.src=e,t.onerror=function(){console.log("load DevTool render fail")},t.onload=function(){console.log("load DevTool render success")},document.getElementsByTagName("body")[0].appendChild(t)}catch(r){console.log("devTool load fail, "+r.message)}},e.prototype.parseUrl=function(){var e={};try{var t=window.location.href.split("?")[1].split("&");t.length&&t.forEach((function(t){var r=t.split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}))}catch(r){}return e},e.prototype.load=function(){return e=this,void 0,r=function(){var e,t,r;return t$2(this,(function(n){switch(n.label){case 0:if(n.trys.push([0,2,,3]),(e=this.parseUrl()).open_devtool_web&&e.app_id){if(parseInt(e.app_id)!==this.app_id)return[2]}else if(!this.getStorage())return[2];return this.loadBaseInfo(),this.loadHook(),this.setStorage(),this.addLintener(),this.loadDebuggerModule(),this.loadDevTool(),[4,this.fetchEventInfo()];case 1:return t=n.sent(),this.sendData("devtool:web:verify",t.verifyStatus),this.eventVerifyInfo=t.data,[3,3];case 2:return r=n.sent(),console.log("debug fail, "+r.message),[3,3];case 3:return[2]}}))},new((t=void 0)||(t=Promise))((function(n,i){function o(e){try{s(r.next(e))}catch(t){i(t)}}function a(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){e.done?n(e.value):new t((function(t){t(e.value)})).then(o,a)}s((r=r.apply(e,[])).next())}));var e,t,r},e.prototype.getStorage=function(){var e=this.cacheStorgae.getItem("__applog_devtool_web");return e&&parseInt(e)===this.app_id},e.prototype.setStorage=function(){this.cacheStorgae.setItem("__applog_devtool_web",this.app_id)},e.prototype.loadDevTool=function(){this.loadScript("https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/devtool/debug-web.0.0.2.js")},e.prototype.loadBaseInfo=function(){var e=this;this.info=[{title:"基本信息",type:1,infoName:{app_id:this.config.app_id,channel:this.config.channel,"上报域名":this.collect.configManager.getDomain(),"SDK版本":G,"SDK引入方式":"npm"}},{title:"用户信息",type:2,infoName:{uuid:this.collect.configManager.get("user").user_unique_id||"",web_id:this.collect.configManager.get("user").web_id||"",ssid:"点击获取SSID"}},{title:"公共参数信息",type:2,infoName:{"浏览器":this.collect.configManager.get("browser"),"浏览器版本":this.collect.configManager.get("browser_version"),"平台":this.collect.configManager.get("platform"),"设备型号":this.collect.configManager.get("device_model"),"操作系统":this.collect.configManager.get("os_name"),"操作系统版本":this.collect.configManager.get("os_version"),"屏幕分辨率":this.collect.configManager.get("resolution"),"来源":this.collect.configManager.get("referrer"),"自定义信息":""}},{title:"配置信息",type:3,infoName:{"全埋点":!!this.config.autotrack,"停留时长":!!this.config.enable_stay_duration}},{title:"A/B配置信息",type:4,infoName:{"A/B实验":!!this.config.enable_ab_test}},{title:"客户端信息",type:3,infoName:{"打通开关":!!this.config.Native}}],this.log=[],this.event=[],this.collect.on(A.Ready,(function(){e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id,e.info[2].infoName["自定义信息"]=JSON.stringify(e.collect.configManager.get("custom")),e.config.enable_ab_test&&(e.info[4].infoName["已曝光VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["A/B域名"]=e.config.ab_channel_domain||c$2(k[e.config.channel]),e.info[4].infoName["全部配置"]=e.collect.configManager.getAbData()),e.config.Native&&(e.info[5].infoName["是否打通"]=!!e.collect.bridgeReport)}))},e.prototype.loadHook=function(){var e=this;this.collect.stop(),this.collect.on(v$2.DEBUGGER_MESSAGE,(function(t){switch(t.type){case v$2.DEBUGGER_MESSAGE_SDK:var r={time:t.time,type:t.logType||"sdk",level:t.level,name:t.info,show:!0,levelShow:!0,needDesc:!!t.data};return t.data&&(r.desc={content:JSON.stringify(t.data)}),e.updateLog(r),t.secType&&"AB"===t.secType?(e.info[4].infoName["已曝光VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["全部配置"]=e.collect.configManager.getAbData()):"USER"===t.secType&&(e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id),void e.updateInfo();case v$2.DEBUGGER_MESSAGE_EVENT:if(t.data&&t.data.length){var n=t.data[0],i=n.events,o=n.header;if(o.custom=JSON.parse(o.custom),!i.length)return;i.forEach((function(r){r.checkShow=!0,r.searchShow=!0,r.type=-1!==e.filterEvent.indexOf(r.event)?"sdk":"cus",r.type=e.collect.bridgeReport?"bridge":r.type,r.params=JSON.parse(r.params),"fail"===t.status&&(r.info={message:"code: "+t.code+"， msg: "+t.failType},r.failType=t.failType);var n=!1,i=!1,o=[];e.eventVerifyInfo&&e.eventVerifyInfo.length&&(e.eventVerifyInfo.forEach((function(e){e.eventStatus=!1})),e.eventVerifyInfo.forEach((function(t){r.event===t.name&&(i=!0,n=!0,r.verifyStatus=t.status,Object.keys(r.params).forEach((function(n){if("event_index"!==n){var a={};a.paramsKey=n,a.paramsKeyValue=r.params[""+n],a.paramsStatus=!1,a.paramsStatusInfo="属性未录入",t.params.forEach((function(t){n===t.name&&(t.checked=!0,_typeof(r.params[""+n])!==e.formatParamsType(t.value_type)?a.paramsStatusInfo="属性类型错误，应为"+e.formatParamsType(t.value_type):(a.paramsStatus=!0,a.paramsStatusInfo=""))})),o.push(a),a.paramsStatusInfo&&(i=!1)}})),t.params.forEach((function(e){e.checked||(i=!1,o.push({paramsKey:e.name,paramsStatus:!1,paramsStatusInfo:"缺少属性"+e.name}))})))}))),r.reportStatus="success"===t.status,r.paramsInfo=o,r.eventStatus=i&&"success"===t.status,r.eventRecord=n})),e.updateEvent(n)}return}}))},e.prototype.formatParamsType=function(e){switch(e){case 0:return"string";case 1:case 2:return"number";case 3:return"boolean"}},e.prototype.fetchEventInfo=function(){var e=this;try{return new Promise((function(t){var r=c$2("1fz22z22z1nz21z4mz4bz4bz18z1nz1nz1jz1mz1ez1fz1mz1kz1cz4az19z27z22z1cz1bz18z1lz1az1cz4az1lz1cz22z4bz18z1nz1nz1jz1mz1ez1bz1cz24z22z1mz1mz1jz21z4bz1mz1nz1cz1lz18z1nz1gz4bz24z4dz4bz18z1nz1nz16z1jz1mz1ez16z1kz1cz22z18")+"?app_id="+e.app_id+"&t="+e.sdk_type+"&nc=false";e.collect.requestManager.useRequest({url:r,method:"GET",success:function(r){e.eventVerifyReady=!0,e.collect.reStart(),t({data:r.data,verifyStatus:!0})},fail:function(){e.eventVerifyReady=!0,e.collect.reStart(),t({data:[],verifyStatus:!1})},timeout:3e3})}))}catch(t){return{data:[],verifyStatus:!1}}},e.prototype.addLintener=function(){var e=this;window.addEventListener("message",(function(t){if(t.origin===location.origin){if(t&&t.data&&"devtool:web:ready"===t.data.type){if(e.devToolOrigin=t.origin,e.devToolReady=!0,e.sendAlready)return;e.sendData("devtool:web:init",{info:e.info,log:e.log,event:e.event,appid:e.app_id}),e.sendAlready=!0}t&&t.data&&"devtool:web:ssid"===t.data.type&&e.collect.getToken((function(t){e.info[1].infoName.ssid=t.tobid,e.updateInfo()})),t&&t.data&&t.data.type}}))},e.prototype.sendData=function(e,t){try{var r={type:e,payload:t};(window.opener||window.parent).postMessage(r,this.devToolOrigin)}catch(n){}},e.prototype.updateInfo=function(){this.devToolReady&&this.sendData("devtool:web:info",this.info)},e.prototype.updateLog=function(e){this.devToolReady?this.sendData("devtool:web:log",e):this.log.push(e)},e.prototype.updateEvent=function(e){this.devToolReady||this.eventVerifyReady?this.sendData("devtool:web:event",e):this.event.push(e)},e.prototype.loadDebuggerModule=function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.appendChild(document.createTextNode("#debugger-applog-web {\n      position: fixed;\n      width: 50px;\n      height: 50px;\n      background-image: url('https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/devtool/applog.png');;\n      bottom: 5%;\n      right: 10%;\n      cursor: pointer;\n      z-index:100;\n      background-size: 50px;\n    }")),e.appendChild(t);var r=document.createElement("div");r.innerHTML='<div id="debugger-applog-web" class="debugger-applog-web"></div>';var n=document.createElement("div");n.innerHTML='<div id="debugger-container" class="debugger-container"></div>',document.getElementsByTagName("body")[0].appendChild(r),document.getElementsByTagName("body")[0].appendChild(n),document.getElementById("debugger-applog-web").addEventListener("click",(function(){(window.opener||window.parent).postMessage({type:"devtool:web:open-draw"},location.origin)}))},e}(),J={autotrack:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/autotrack.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/autotrack.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/autotrack.js"},object:"LogAutoTrack"},ab:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/ab.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/ab.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/ab.js"},object:"LogAb"},stay:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/stay.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/stay.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/stay.js"},object:"LogStay"},route:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/route.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/route.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/route.js"},object:"LogRoute"},cep:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/cep.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/cep.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/cep.js"},object:"LogCep"},tracer:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/tracer.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/tracer.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/tracer.js"},object:"LogTracer"},retry:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/retry.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/retry.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/retry.js"},object:"LogRetry"},visual:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/visual.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/visual.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/visual.js"},object:"LogVisual"}},H=["et","profile","heartbeat","monitor"],$=function(){function e(e){this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroy=!1,this.sdkReady=!1,this.adapters={},this.loadType="base",this.sdkStop=!1,this.name=e,this.hook=new r$1,this.remotePlugin=new Map,this.Types=A,this.adapters.storage=S}return e.usePlugin=function(t,r,n){if(r){for(var i=!1,o=0,a=e.plugins.length;o<a;o++)if(e.plugins[o].name===r){e.plugins[o].plugin=t,e.plugins[o].options=n||{},i=!0;break}i||e.plugins.push({name:r,plugin:t,options:n})}else e.plugins.push({plugin:t})},e.prototype.usePlugin=function(e,t,r){e&&("full"===this.loadType&&H.includes(e)?console.info("your sdk version has "+e+" plugin already ~"):t?"string"==typeof t?this.remotePlugin.get(e)||this.remotePlugin.set(e,{src:t,call:r}):this.remotePlugin.get(e)||this.remotePlugin.set(e,{instance:t}):this.remotePlugin.get(e)||this.remotePlugin.set(e,"sdk"))},e.prototype.init=function(t){var r,n=this;this.logger=new C(this.name,t.log),this.inited?this.logger.warn("[instance: "+this.name+"], every instance's api: init,  can be call only one time!"):t&&s$1(t)?t.app_id&&"number"==typeof(r=t.app_id)&&!isNaN(r)?t.app_key&&"string"!=typeof t.app_key?this.logger.warn("app_key param is error, must be string, please check!"):(t.channel_domain||-1!==["cn","sg","va"].indexOf(t.channel)||(this.logger.warn("channel must be `cn`, `sg`,`va` !"),t.channel="cn"),this.spider=new B,this.spider.checkSpider(t)?this.logger.warn("your env may be a spider, can not report!"):(this.appBridge=new U(this,t.enable_native),this.requestManager=new V(this,t),this.bridgeReport=this.appBridge.bridgeInject(),this.configManager=new x(this,t),this.debugger=new W(this,t),this.initConfig=t,this.emit(A.Init),this.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"SDK 执行INIT",data:t,level:"info",time:Date.now()}),this.destroy=!1,t.disable_auto_pv&&(this.disableAutoPageView=!0),this.bridgeReport||(this.configManager.set({app_id:t.app_id}),this.eventManager=new j,this.tokenManager=new K,this.sessionManager=new N,Promise.all([new Promise((function(e){n.once(A.TokenComplete,(function(){e(!0)}))})),new Promise((function(e){n.once(A.Start,(function(){e(!0)}))}))]).then((function(){try{e.plugins.reduce((function(e,t){var r=t.plugin,i=t.options,o=Object.assign(n.initConfig,i),a=new r;return a.apply(n,o),e.push(a),e}),n.pluginInstances)}catch(r){console.warn("load plugin error, "+r.message),n.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:r.message})}n.sdkReady=!0,n.emit(A.Ready),n.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"SDK 初始化完成",time:Date.now(),level:"info",data:n.configManager.get("user")}),n.logger.info("appid: "+t.app_id+", userInfo:"+JSON.stringify(n.configManager.get("user"))),n.logger.info("appid: "+t.app_id+", sdk is ready, version type is "+n.loadType+", version is "+G+", you can report now !!!"),t.disable_auto_pv&&(n.disableAutoPageView=!0);try{"full"===n.loadType&&(t.enable_ab_test||t.autotrack)&&(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(r){n.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:r.message})}n.pageView(),n.on(A.TokenChange,(function(e){"webid"===e&&n.pageView(),n.logger.info("appid: "+t.app_id+" token change, new userInfo:"+JSON.stringify(n.configManager.get("user"))),n.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"SDK 设置了用户信息",time:Date.now(),secType:"USER",level:"info",data:n.configManager.get("user")})})),n.on(A.TokenReset,(function(){n.logger.info("appid: "+t.app_id+" token reset, new userInfo:"+JSON.stringify(n.configManager.get("user"))),n.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"SDK 重置了用户信息",time:Date.now(),secType:"USER",level:"info",data:n.configManager.get("user")})})),n.on(A.RouteChange,(function(e){e.init||t.disable_route_report||n.pageView()}))})),this.tokenManager.apply(this,t),this.eventManager.apply(this,t),this.sessionManager.apply(this,t)),this.inited=!0)):this.logger.warn("app_id param is error, must be number, please check!"):this.logger.warn("init params error,please check!")},e.prototype.config=function(e){if(this.inited)if(e&&s$1(e))if(this.bridgeReport)this.appBridge.setConfig(e);else{e._staging_flag&&1===e._staging_flag&&(this.staging=!0),e.disable_auto_pv&&(this.disableAutoPageView=!0,delete e.disable_auto_pv);var t=_e$1({},e),r=this.initConfig.configPersist||this.initConfig.config_persist||!1;if(this.initConfig&&r){var n=this.configManager.getStore();n&&(t=Object.assign(n,e)),this.configManager.setStore(e)}t.web_id,t.user_unique_id;var i=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r}(t,["web_id","user_unique_id"]);this.configManager.set(i),t.hasOwnProperty("web_id")&&this.emit(A.ConfigWebId,t.web_id),t.hasOwnProperty("user_unique_id")&&this.emit(A.ConfigUuid,t.user_unique_id),this.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"SDK 执行CONFIG",level:"info",time:Date.now(),data:t})}else console.warn("config params is error, please check");else console.warn("config must be use after function init")},e.prototype.setUserUniqueID=function(e){this.config({user_unique_id:e})},e.prototype.setHeaderInfo=function(e,t){var r={};r[e]=t,this.config(r)},e.prototype.removeHeaderInfo=function(e){var t={};t[e]=void 0,this.config(t)},e.prototype.setDomain=function(e){this.configManager&&this.configManager.setDomain(e),this.emit(A.ConfigDomain)},e.prototype.getConfig=function(e){return this.configManager.get(e)},e.prototype.send=function(){this.start()},e.prototype.start=function(){this.inited&&!this.sended&&(this.sended=!0,this.started=!0,this.emit(A.Start),this.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"SDK 执行START",level:"info",time:Date.now()}),this.bridgeReport&&(this.pageView(),this.emit(A.Ready)))},e.prototype.event=function(e,t){var r=this;try{var n=[];if(Array.isArray(e))e.forEach((function(e){var t=r.processEvent(e[0],e[1]||{});t&&n.push(t)}));else{var i=this.processEvent(e,t);if(!i)return;n.push(i)}this.bridgeReport?n.forEach((function(e){var t=e.event,n=e.params;r.appBridge.onEventV3(t,JSON.stringify(n))})):n.length&&(this.emit(A.Event,n),this.emit(A.SessionResetTime))}catch(o){this.logger.warn("something error, please check"),this.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:o.message})}},e.prototype.beconEvent=function(e,t){if(Array.isArray(e))console.warn("beconEvent not support batch report, please check");else{var r=[],n=this.processEvent(e,t||{});n&&(r.push(n),r.length&&(this.emit(A.BeconEvent,r),this.emit(A.SessionResetTime)))}},e.prototype.beaconEvent=function(e,t){this.beconEvent(e,t)},e.prototype.processEvent=function(e,t){void 0===t&&(t={});try{if(!e)return console.warn("eventName is null， please check"),null;var r=e;/^event\./.test(e)&&(r=e.slice(6));var n=t;"object"!=_typeof(n)&&(n={}),n.profile?delete n.profile:n.event_index=a$1();var i=void 0;return n.local_ms?(i=n.local_ms,delete n.local_ms):i=+new Date,{event:r,params:n,local_time_ms:i,is_bav:this.initConfig&&this.initConfig.autotrack?1:0}}catch(o){return this.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:o.message}),{event:e,params:t}}},e.prototype.filterEvent=function(e){this.eventFilter=e},e.prototype.on=function(e,t){this.hook.on(e,t)},e.prototype.once=function(e,t){this.hook.once(e,t)},e.prototype.off=function(e,t){this.hook.off(e,t)},e.prototype.emit=function(e,t,r){this.hook.emit(e,t,r)},e.prototype.set=function(e){this.hook.set(e)},e.prototype.stop=function(){this.sdkStop=!0},e.prototype.reStart=function(){this.sdkStop=!1},e.prototype.pageView=function(){this.disableAutoPageView||this.predefinePageView()},e.prototype.predefinePageView=function(e){if(void 0===e&&(e={}),this.inited){var t={title:document.title||location.pathname,url:location.href,url_path:location.pathname,time:Date.now(),referrer:window.document.referrer,$is_first_time:""+(this.configManager&&this.configManager.is_first_time||!1)},r=_e$1({},t,e);this.event("predefine_pageview",r)}else console.warn("predefinePageView must be use after function init")},e.prototype.clearEventCache=function(){this.emit(A.CleanEvents)},e.prototype.setWebIDviaUnionID=function(e){if(e){var t=h$1(e);this.config({web_id:""+t,wechat_unionid:e}),this.emit(A.CustomWebId)}},e.prototype.setWebId=function(e){this.config({web_id:""+e})},e.prototype.setWebIDviaOpenID=function(e){if(e){var t=h$1(e);this.config({web_id:""+t,wechat_openid:e}),this.emit(A.CustomWebId)}},e.prototype.setNativeAppId=function(e){this.bridgeReport&&this.appBridge.setNativeAppId(e)},e.prototype.getSessionId=function(){return P()},e.prototype.setSessionId=function(e){this.emit(A.SessionReset,e)},e.prototype.resetStayDuration=function(e,t,r){this.emit(A.ResetStay,{url_path:e,title:t,url:r},A.Stay)},e.prototype.resetStayParams=function(e,t,r){void 0===e&&(e=""),void 0===t&&(t=""),void 0===r&&(r=""),this.emit(A.SetStay,{url_path:e,title:t,url:r},A.Stay)},e.prototype.getToken=function(e,t){var r=this;if(this.inited){var n=!1,i=function(t){if(!n){n=!0;var i=r.configManager.get().user;return t&&(i.tobid=t,i["diss".split("").reverse().join("")]=t),e(_e$1({},i))}},o=function(){r.tokenManager.getTobId().then((function(e){i(e)}))};this.sdkReady?o():(t&&setTimeout((function(){i()}),t),this.on(A.Ready,(function(){o()})))}else console.warn("getToken must be use after function init")},e.prototype.profileSet=function(e){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(e)):this.emit(A.ProfileSet,e,A.Profile),this.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileSet",level:"info",time:Date.now(),data:e})},e.prototype.profileSetOnce=function(e){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(e)):this.emit(A.ProfileSetOnce,e,A.Profile),this.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileSetOnce",level:"info",time:Date.now(),data:e})},e.prototype.profileIncrement=function(e){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(e)):this.emit(A.ProfileIncrement,e,A.Profile),this.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileIncrement",level:"info",time:Date.now(),data:e})},e.prototype.profileUnset=function(e){this.bridgeReport?this.appBridge.profileUnset(e):this.emit(A.ProfileUnset,e,A.Profile),this.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileUnset",level:"info",time:Date.now(),data:e})},e.prototype.profileAppend=function(e){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(e)):this.emit(A.ProfileAppend,e,A.Profile),this.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileAppend",level:"info",time:Date.now(),data:e})},e.prototype.setExternalAbVersion=function(e){this.emit(A.AbExternalVersion,"string"==typeof e&&e?(""+e).trim():null,A.Ab)},e.prototype.getVar=function(e,t,r){this.emit(A.AbVar,{name:e,defaultValue:t,callback:r},A.Ab)},e.prototype.getABconfig=function(e,t){this.emit(A.AbConfig,{params:e,callback:t},A.Ab)},e.prototype.getAbSdkVersion=function(){return this.configManager.getAbVersion()},e.prototype.onAbSdkVersionChange=function(e){var t=this;return this.emit(A.AbVersionChangeOn,e,A.Ab),function(){t.emit(A.AbVersionChangeOff,e,A.Ab)}},e.prototype.offAbSdkVersionChange=function(e){this.emit(A.AbVersionChangeOff,e,A.Ab)},e.prototype.openOverlayer=function(){this.emit(A.AbOpenLayer,"",A.Ab)},e.prototype.closeOverlayer=function(){this.emit(A.AbCloseLayer,"",A.Ab)},e.prototype.getAllVars=function(e){this.emit(A.AbAllVars,e,A.Ab)},e.prototype.destoryInstace=function(){this.destroy||(this.destroy=!0,this.off(A.TokenComplete),this.emit(A.DestoryInstance))},e.prototype.destroyInstance=function(){this.destroy||(this.destroy=!0,this.off(A.TokenComplete),this.emit(A.DestoryInstance))},e.plugins=[],e}(),F=function(){function e(){}return e.prototype.apply=function(e,t){var r=this;t.event_verify_url&&("string"==typeof t.event_verify_url?(this.url=t.event_verify_url+"/v1/list_test",e.on(e.Types.SubmitBefore,(function(t){e.requestManager.useBeacon({url:r.url,data:t})}))):console.log("please use correct et_test url"))},e}(),X=function(){function e(){}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.config=t,this.duration=6e4,this.reportUrl=e.configManager.getDomain()+"/profile/list";var n=e.Types;this.eventCheck=new z(e,t),this.cache={},this.collect.on(n.ProfileSet,(function(e){r.setProfile(e)})),this.collect.on(n.ProfileSetOnce,(function(e){r.setOnceProfile(e)})),this.collect.on(n.ProfileUnset,(function(e){r.unsetProfile(e)})),this.collect.on(n.ProfileIncrement,(function(e){r.incrementProfile(e)})),this.collect.on(n.ProfileAppend,(function(e){r.appendProfile(e)})),this.collect.on(n.ProfileClear,(function(){r.cache={}})),this.ready(n.Profile)},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var r=this.collect.hook._hooksCache[e];if(!Object.keys(r).length)return;var n=function(e){r[e].length&&r[e].forEach((function(r){t.collect.hook.emit(e,r)}))};for(var i in r)n(i)}},e.prototype.report=function(e,t){void 0===t&&(t={});try{if(this.config.disable_track_event)return;var r=[];r.push(this.collect.processEvent(e,t));var n=this.collect.eventManager.merge(r);this.collect.requestManager.useRequest({url:this.reportUrl,data:n}),this.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_EVENT,info:"埋点上报成功",time:Date.now(),data:n,code:200,status:"success"})}catch(i){this.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:i.message})}},e.prototype.setProfile=function(e){var t=this.formatParams(e);t&&Object.keys(t).length&&(this.pushCache(t),this.report("__profile_set",_e$1({},t,{profile:!0})))},e.prototype.setOnceProfile=function(e){var t=this.formatParams(e,!0);t&&Object.keys(t).length&&(this.pushCache(t),this.report("__profile_set_once",_e$1({},t,{profile:!0})))},e.prototype.incrementProfile=function(e){e?this.report("__profile_increment",_e$1({},e,{profile:!0})):console.warn("please check the params, must be object!!!")},e.prototype.unsetProfile=function(e){if(e){var t={};t[e]="1",this.report("__profile_unset",_e$1({},t,{profile:!0}))}else console.warn("please check the key, must be string!!!")},e.prototype.appendProfile=function(e){if(e){var t={};for(var r in e)"string"==typeof e[r]||"Array"===Object.prototype.toString.call(e[r]).slice(8,-1)?t[r]=e[r]:console.warn("please check the value of param: "+r+", must be string or array !!!");Object.keys(t).length&&this.report("__profile_append",_e$1({},t,{profile:!0}))}else console.warn("please check the params, must be object!!!")},e.prototype.pushCache=function(e){var t=this;Object.keys(e).forEach((function(r){t.cache[r]={val:t.clone(e[r]),timestamp:Date.now()}}))},e.prototype.formatParams=function(e,t){var r=this;void 0===t&&(t=!1);try{if(!e||"[object Object]"!==Object.prototype.toString.call(e))return void console.warn("please check the params type, must be object !!!");var n={};for(var i in e)"string"==typeof e[i]||"number"==typeof e[i]||"Array"===Object.prototype.toString.call(e[i]).slice(8,-1)?n[i]=e[i]:console.warn("please check the value of params:"+i+", must be string,number,Array !!!");var o=Object.keys(n);if(!o.length)return;if(!this.eventCheck.checkEventParams(n))return;var a=Date.now();return o.filter((function(n){var i=r.cache[n];return t?!i:!(i&&r.compare(i.val,e[n])&&a-i.timestamp<r.duration)})).reduce((function(e,t){return e[t]=n[t],e}),{})}catch(s){this.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:s.message}),console.log("error")}},e.prototype.compare=function(e,t){try{return JSON.stringify(e)===JSON.stringify(t)}catch(r){return this.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:r.message}),!1}},e.prototype.clone=function(e){try{return JSON.parse(JSON.stringify(e))}catch(t){return this.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),e}},e.prototype.unReady=function(){console.warn("sdk is not ready, please use this api after start")},e}(),Q=function(){function e(){var e=this;this.setInterval=function(){e.clearIntervalFunc=l$1((function(){e.isSessionhasEvent&&e.endCurrentSession()}),e.sessionInterval)},this.clearInterval=function(){e.clearIntervalFunc&&e.clearIntervalFunc()}}return e.prototype.apply=function(e,t){var r=this;if(this.collect=e,!t.disable_heartbeat){this.sessionInterval=6e4,this.startTime=0,this.lastTime=0,this.setInterval();var n=this.collect.Types;this.collect.on(n.SessionResetTime,(function(){r.process()}))}},e.prototype.endCurrentSession=function(){this.collect.event("_be_active",{start_time:this.startTime,end_time:this.lastTime,url:window.location.href,referrer:window.document.referrer,title:document.title||location.pathname}),this.isSessionhasEvent=!1,this.startTime=0},e.prototype.process=function(){this.isSessionhasEvent||(this.isSessionhasEvent=!0,this.startTime=+new Date);var e=this.lastTime||+new Date;this.lastTime=+new Date,this.lastTime-e>this.sessionInterval&&(this.clearInterval(),this.endCurrentSession(),this.setInterval())},e}(),Z=function(){function e(){}return e.prototype.apply=function(e,t){var r=this;t.channel_domain||t.disable_track_event||t.disable_sdk_monitor||(this.collect=e,this.config=t,this.url=e.configManager.getUrl("event"),this.collect.on(e.Types.Ready,(function(){r.sdkOnload()})),this.collect.on(e.Types.SubmitError,(function(e){var t=e.type,n=e.eventData,i=e.errorCode;"f_data"===t&&r.sdkError(n,i)})))},e.prototype.sdkOnload=function(){var e=this;try{var t=this.collect.configManager.get(),r=t.header,n=t.user,i=r.app_id,o=r.app_name,a=r.sdk_version,s=n.web_id,c={events:[{event:"onload",params:JSON.stringify({app_id:i,app_name:o||"",sdk_version:a,sdk_type:"npm",sdk_config:this.config,sdk_desc:"TOC",url:location.href}),local_time_ms:Date.now()}],user:{user_unique_id:s},header:{}};setTimeout((function(){e.collect.requestManager.useRequest({url:e.url,data:[c],timeout:3e4,app_key:"566f58151b0ed37e",forceXhr:!0})}),16)}catch(u){}},e.prototype.sdkError=function(e,t){var r=this;try{var n=e[0],i=n.user,o=n.header,a=[];e.forEach((function(e){e.events.forEach((function(e){a.push(e)}))}));var s={events:a.map((function(e){return{event:"on_error",params:JSON.stringify({error_code:t,app_id:o.app_id,app_name:o.app_name||"",error_event:e.event,sdk_version:o.sdk_version,local_time_ms:e.local_time_ms,tea_event_index:Date.now(),params:e.params,header:JSON.stringify(o),user:JSON.stringify(i)}),local_time_ms:Date.now()}})),user:{user_unique_id:i.user_unique_id},header:{}};setTimeout((function(){r.collect.requestManager.useRequest({url:r.url,data:[s],timeout:3e4,app_key:"566f58151b0ed37e",forceXhr:!0})}),16)}catch(c){}},e}(),Y="undefined"!=typeof window?(window.LogPluginObject||(window.LogPluginObject={}),window.LogPluginObject):null,ee=function(){function e(){}return e.prototype.apply=function(e,t){this._plugin={},this.config=t,this.collect=e,this.channel=t.channel||"cn",this.loadExtend()},e.prototype.loadExtend=function(){var e=this;try{this.collect.remotePlugin.forEach((function(t,r){if("sdk"===t)if(J.hasOwnProperty(r)){var n=J[r].object,i=J[r].src[e.channel]+"?query="+Date.now();e.exist(r,n,i)}else console.warn("your "+r+" is not exist，please check plugin name");else"object"==_typeof(t)&&(t.src?e.exist(r,t.call,t.src):e.process(r,t.instance,"INSTANCE"))}))}catch(t){this.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),console.log("load extend error")}},e.prototype.exist=function(e,t,r){var n=this;Y[t]?(this.process(e,Y[t]),console.log("已有"+e+"插件，避免重复加载~")):this.loadPlugin(e,r,(function(){n.process(e,Y[t]),console.log(" %c %s %s %s","color: yellow; background-color: black;","–","load plugin:"+e+" success","-")}),(function(){console.log(" %c %s %s %s","color: red; background-color: yellow;","–","load plugin:"+e+" error","-")}))},e.prototype.process=function(e,t,r){try{if(r){var n=new t;n.apply&&n.apply(this.collect,this.config),console.log("excude "+e+" success")}else t&&t(this.collect,this.config)}catch(i){this.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:i.message}),console.log("excude "+e+" error, message:"+i.message)}},e.prototype.loadPlugin=function(e,t,r,n){var i=this;try{var o=document.createElement("script");o.src=t,this._plugin[e]||(this._plugin[e]=[]),this._plugin[e].push(r),o.onerror=function(){n(t)},o.onload=function(){i._plugin[e].forEach((function(e){e()}))},document.getElementsByTagName("head")[0].appendChild(o)}catch(a){this.collect.emit(v$2.DEBUGGER_MESSAGE,{type:v$2.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:a.message})}},e}();$.usePlugin(ee,"extend"),$.usePlugin(F,"et"),$.usePlugin(X,"profile"),$.usePlugin(Q,"heartbeat"),$.usePlugin(Z,"monitor"),new $("default");var ie=$,level=["error","warning","info"],WarningErrors={1e4:0,10001:0,10002:0,10003:0,10004:0,10005:0,10006:0,10007:0,10008:1,10009:0,10010:1,10011:0,10012:0,10013:0,10014:0,10015:0,10016:0,10017:0,10018:0,10019:1,10022:1,10023:1,10024:1,10025:1,10026:0,10027:0,2e4:0,20001:0,20002:0,20003:1,3e4:0,30001:0,30002:0,30007:1,30008:0,30009:0,30201:0,30203:0,30204:0,30205:0,31e3:1,31001:1,31002:1,31003:1,31004:1,31005:1,4e4:1,40001:1,40002:1,40003:1,40004:1,40005:1,40006:1,40007:1,40008:1,40044:1,40010:0,40023:1,40024:1,40026:0,40027:0,40028:0,40029:0,40047:1,40048:1,40049:1,40050:0,40031:1,40032:0,40033:0,40037:1,40038:1,40039:1,40040:1,40041:1,40043:1,5e4:0,50001:0,50002:0,50003:0,50007:1,50008:0,50009:1,60001:0,60002:0,71001:0,71002:0,71003:0,71004:0,71005:0,71006:0};function assignErrorLevel(e){var t,r=e.errc;if(void 0===r)return e;var n=null!==(t=WarningErrors[r])&&void 0!==t?t:2;return e.level=level[n]||"info",e}var RemoteLogger=function(){function e(t){_classCallCheck(this,e),EventEmitter$2(this),this.userId=t.userId,this.commonParams={},this.startEventTime=null,this.teaLog=new ie("tracker"),this.teaLog.init({app_id:3138,channel:"cn",channel_domain:t.channelDomain,log:!1,disable_sdk_monitor:!0}),this.teaLog.config({evtParams:{SDKVersion:t.SDKVersion},user_unique_id:this.userId,disable_auto_pv:!0}),this.teaLog.start()}return _createClass(e,[{key:"setCommonParams",value:function(e){this.commonParams=Object.assign(this.commonParams,_objectSpread2({},e))}},{key:"setSingleParam",value:function(e,t){this.commonParams[e]=t}},{key:"getCommonParams",value:function(){return this.commonParams}},{key:"send",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=assignErrorLevel(_objectSpread2(_objectSpread2(_objectSpread2({ts:(new Date).getTime()},t),this.commonParams),r));e="event_"+e,this.emit("logger",{eventName:e,eventParams:n});try{this.teaLog.event(e,n)}catch(e2){console.warn("[teaLog send catch]",e2)}}},{key:"beaconSend",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=assignErrorLevel(_objectSpread2(_objectSpread2({ts:(new Date).getTime()},t),this.commonParams));e="event_"+e,this.emit("logger",{eventName:e,eventParams:r});try{this.teaLog.beconEvent(e,r)}catch(e2){console.warn("[teaLog send catch]",e2)}}},{key:"destroy",value:function(){this.teaLog.destroyInstance()}}]),e}();function getUrlQuery$1(e){var t={};if(/\?/g.test(e))for(var r=e.substr(e.indexOf("?")+1).split("&"),n=0;n<r.length;n++){var i=r[n].split("=");t[i[0]]=i[1]||"0"}return t}var DB_NAME$2="vegamedb",STORE_NAME$1="vegame",STORE_CACHED_SIZE_KEY$1="vegame-cache-size",IDB$1=function(){function e(){var t,r,n,i;(_classCallCheck(this,e),this._getSize=function(e){return new Blob(e).size/1048576},null!=e&&e.instance)||(this.storeKey="test",this.logId=1,this.cacheLog="",this.LogfileSize=50,this.indexedDB=(null===(t=window)||void 0===t?void 0:t.indexedDB)||(null===(r=window)||void 0===r?void 0:r.mozIndexedDB)||(null===(n=window)||void 0===n?void 0:n.webkitIndexedDB)||(null===(i=window)||void 0===i?void 0:i.msIndexedDB),this._createStore(),this.isSupportIndexedDB=!0,e.instance=this);return e.instance}return _createClass(e,[{key:"_createStore",value:function(){var e=this;if("undefined"!=typeof window){var t;try{var r;t=null===(r=this.indexedDB)||void 0===r?void 0:r.open(DB_NAME$2)}catch(n){console.warn("当前环境不支持indexDb"),this.isSupportIndexedDB=!1}t.onupgradeneeded=function(){t.result.createObjectStore(STORE_NAME$1);try{sessionStorage.removeItem(STORE_CACHED_SIZE_KEY$1)}catch(n){}},t.onerror=function(t){console.warn("当前环境不支持indexDb"),e.isSupportIndexedDB=!1},t.onsuccess=function(){e.db=t.result,e._getCachedSize()}}}},{key:"_getCachedSize",value:function(){var e=this;try{var t=sessionStorage.getItem(STORE_CACHED_SIZE_KEY$1);t?this.cachedSize=+t:this.values().then((function(t){e.cachedSize=e._getSize(t),e._setCachedSize()}))}catch(r){}}},{key:"_setCachedSize",value:function(){try{sessionStorage.setItem(STORE_CACHED_SIZE_KEY$1,"".concat(this.cachedSize))}catch(e){}}},{key:"_getStore",value:function(e){if(this.db)return this.db.transaction(STORE_NAME$1,e).objectStore(STORE_NAME$1)}},{key:"set",value:function(e){var t=this;return new Promise((function(r,n){if(!t.isSupportIndexedDB)return!1;if(e&&t.preCacheTime&&t.preCacheTime-Date.now()<1e3)return t.cacheLog+="\n\n".concat(t.logId,": ").concat(e),t.logId++,t.timer||(t.timer=setTimeout((function(){t.set("")}),1e3-(t.preCacheTime-Date.now()))),r();clearTimeout(t.timer),t.timer=null;var i=t._getStore("readwrite");if(!i)return!1;t.cachedSize&&t.cachedSize>t.LogfileSize&&t.keyEarliest().then((function(e){t.get(e).then((function(r){t.del(e).then((function(){t.cachedSize=t.cachedSize-t._getSize(["".concat(r)]),t._setCachedSize()}))}))}));var o=i.get(t.storeKey);o.onsuccess=function(){try{var a="".concat(o.result||"").concat(t.cacheLog),s=e?"".concat(a?"\n\n":"").concat(t.logId,": ").concat(e):"";i.put("".concat(a).concat(s),t.storeKey),e&&t.logId++,t.cacheLog="",t.cachedSize=(t.cachedSize||0)+t._getSize(["".concat(t.cacheLog).concat(s)]),t._setCachedSize(),t.preCacheTime=Date.now(),r()}catch(c){if(!e)return n(c);t.cacheLog+="\n\n".concat(t.logId,": ").concat(e),t.logId++,n(c)}},o.onerror=function(r){if(!e)return n(r);t.cacheLog+="\n\n".concat(t.logId,": ").concat(e),t.logId++,n(r)}}))}},{key:"get",value:function(e){var t=this;return new Promise((function(r,n){var i=t._getStore("readonly");if(!i)return n();var o=i.get(e);o.onsuccess=function(){r(o.result)},o.onerror=function(e){n(e)}}))}},{key:"del",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.storeKey;return new Promise((function(r,n){var i=e._getStore("readwrite");if(!i)return n();var o=i.delete(t);o.onsuccess=function(){return r(o.result)},o.onerror=function(e){return n(e)}}))}},{key:"keyEarliest",value:function(){return this.keys().then((function(e){var t,r=Date.now();return e.forEach((function(e){if(e&&e.length){var n=e.split("-")[0];Number(n)<r&&(r=Number(n),t=e)}})),t}))}},{key:"keys",value:function(){var e=this;return new Promise((function(t,r){var n=e._getStore("readonly");if(!n)return r();if(n.getAllKeys){var i=n.getAllKeys();return i.onsuccess=function(){t(i.result)},void(i.onerror=function(){r()})}var o=[];n.openCursor().onsuccess=function(){this.result&&(o.push(this.result.key),this.result.continue())},n.transaction.oncomplete=function(){return t(o)}}))}},{key:"values",value:function(){var e=this;return new Promise((function(t,r){var n=e._getStore("readonly");if(!n)return r();if(n.getAll){var i=n.getAll();return i.onsuccess=function(){t(i.result)},void(i.onerror=function(){r()})}var o=[];n.openCursor().onsuccess=function(){this.result&&(o.push(this.result.value),this.result.continue())},n.transaction.oncomplete=function(){return t(o)}}))}},{key:"download",value:function(e){e=e||this.storeKey,this.get(e).then((function(t){var r=document.createElement("a");r.download="".concat(e,".txt"),r.href="data:text/paint;utf-8,"+(t||""),r.click()}))}}]),e}(),LocalDB=IDB$1,Stage$1=function(e){return e[e.ALL=0]="ALL",e[e.Init=1]="Init",e[e.Start=2]="Start",e[e.PodTrigger=3]="PodTrigger",e[e.Reconnect=4]="Reconnect",e[e.Stopped=5]="Stopped",e[e.ClientTrigger=6]="ClientTrigger",e}(Stage$1||{}),Logger$2=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n,i,o,a,s;return _classCallCheck(this,r),(s=t.call(this,e)).urlQuery=getUrlQuery$1(null===(n=window)||void 0===n||null===(i=n.location)||void 0===i?void 0:i.href),s.state={colorGroup:{1:"#cf1322",2:"#ffc069",3:"#237804",4:"#595959",36:"#0958d9"}},s.isSupportIDB="indexeddb"===(null===(o=s.urlQuery)||void 0===o?void 0:o._vegame_debuglog)||"indexeddb"===(null===(a=sessionStorage)||void 0===a?void 0:a.getItem("_vegame_debuglog")),"undefined"!=typeof window&&s.isSupportIDB&&(s.idb=new LocalDB,window.veGamelLogDB=s.idb),s}return _createClass(r,[{key:"getTime",value:function(){var e=new Date,t=e.getHours(),r=e.getMinutes(),n=e.getSeconds(),i=e.getMilliseconds();return"".concat(t,":").concat(r,":").concat(n,":").concat(i)}},{key:"print",value:function(e,t,r,n){var i,o,a,s,c=(null===(i=this.state.colorGroup)||void 0===i?void 0:i[e])||(null===(o=this.state.colorGroup)||void 0===o?void 0:o[4]);((a=console).log.apply(a,["%c".concat(this.getTime(),"~").concat(r),"color:".concat(c,";")].concat(_toConsumableArray(n))),this.isSupportIDB)&&(null===(s=this.idb)||void 0===s||s.set(" ".concat(this.getTime(),"~").concat(r," ").concat(JSON.stringify(n))))}},{key:"getLocalShowGroup",value:function(){var e,t=[""],r=[""],n=!1,i=this.urlQuery;if(null!=i&&i._vegame_debuglog){var o,a;if(n=!0,null!=i&&i._vegame_debuglog_level)t=null==i||null===(o=i._vegame_debuglog_level)||void 0===o?void 0:o.split("_");if(null!=i&&i._vegame_debuglog_stage)r=null==i||null===(a=i._vegame_debuglog_stage)||void 0===a?void 0:a.split("_")}if(null!==(e=sessionStorage)&&void 0!==e&&e.getItem("_vegame_debuglog")){var s,c,u,l,d,p;if(n=!0,null!==(s=sessionStorage)&&void 0!==s&&s.getItem("_vegame_debuglog_level"))t=null===(u=sessionStorage)||void 0===u||null===(l=u.getItem("_vegame_debuglog_level"))||void 0===l?void 0:l.split("_");if(null!==(c=sessionStorage)&&void 0!==c&&c.getItem("_vegame_debuglog_stage"))r=null===(d=sessionStorage)||void 0===d||null===(p=d.getItem("_vegame_debuglog_stage"))||void 0===p?void 0:p.split("_")}return{logShowFlag:n,levelList:t,stageList:r}}},{key:"localLog",value:function(e,t,r,n){var i=this.getLocalShowGroup();if(null!=i&&i.logShowFlag){if(!(null!=i&&i.levelList.includes("0")||null!=i&&i.levelList.includes("")||null!=i&&i.levelList.includes("".concat(e))))return!1;if(null!=i&&i.levelList.includes("")&&"4"==e)return!1;if(!(null!=i&&i.stageList.includes("0")||null!=i&&i.stageList.includes("")||null!=i&&i.stageList.includes("".concat(Stage$1[t]))))return!1;this.print(e,t,"[".concat(e,"][").concat(t,"](").concat(r,") "),n)}}},{key:"localWarnLog",value:function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];this.localLog(2,e,t,n)}},{key:"localErrorLog",value:function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];this.localLog(1,e,t,n)}},{key:"localInfoLog",value:function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];this.localLog(3,e,t,n)}},{key:"localTraceLog",value:function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];this.localLog(4,e,t,n)}}]),r}(RemoteLogger),LOG_TAG="",LOG_CHANNEL_DOMAIN="",SDK_TYPE="";function setSdkType(e){e&&(SDK_TYPE=e,LOG_TAG="[".concat(e,"]"),LOG_CHANNEL_DOMAIN="veGame"===e?"https://vegamemon.volces.com/event/collect":"https://vephonemon.volces.com/event/collect")}var NATIVE_MOUSE_PRE="NATIVE_MOUSE_PREA",MOUSE_SCROLL_VIRTUAL_CLICK="MOUSE_SCROLL_VIRTUAL_CLICK",CONTAINER_DOM_ID="cc-player-container",DID_LOCALSTORAGE_KEY="veDid",SUBSCRIBE_TYPE={VIDEO:"Video",AUDIO:"Audio",PAUSE:"Pause",RESUME:"Resume"},COMMUNICATION_MODE={RTC:"bytertc",WS:"llama_websocket",AUTO:"auto"},RTC_HOST={cn:"rtc.bytedance.com"},GAME_HOST={PROD:"https://veGame.volcengineapi.com",PROD_BACKUP:"https://open.volcengineapi.com"},GET_RESOURCE_HOST={PROD:"https://vegameapi.volces.com",PROD_BACKUP:"https://vegameapi-bak.volces.com"},VEPHONE_GET_RESOURCE_HOST={PROD:"https://vephone.cn-beijing.volces.com",PROD_BACKUP:"https://vegameapi-bak.volces.com"},PHONE_HOST={PROD:"https://acep.volcengineapi.com",PROD_BACKUP:"https://open.volcengineapi.com"},PLATFORM={PC:3,IOS:4,ANDROID:5},MODE=function(e){return e[e.CLOUD_PHONE_GAME=0]="CLOUD_PHONE_GAME",e[e.CLOUD_PHONE=1]="CLOUD_PHONE",e[e.CLOUD_PC=2]="CLOUD_PC",e}(MODE||{}),LOCATION_SERVICE_MODE=function(e){return e[e.MODE_AUTO=0]="MODE_AUTO",e[e.MODE_MANUAL=1]="MODE_MANUAL",e}(LOCATION_SERVICE_MODE||{}),ACTION=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e[e.MOVE=2]="MOVE",e[e.TOUCH_START=0]="TOUCH_START",e[e.TOUCH_END=1]="TOUCH_END",e[e.TOUCH_MOVE=2]="TOUCH_MOVE",e[e.WHEEL=8]="WHEEL",e[e.PC_TOUCH_UP=0]="PC_TOUCH_UP",e[e.PC_TOUCH_DOWN=1]="PC_TOUCH_DOWN",e[e.PC_TOUCH_MOVE=2]="PC_TOUCH_MOVE",e}(ACTION||{}),MOUSE_BUTTON=function(e){return e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.CENTER=2]="CENTER",e}(MOUSE_BUTTON||{}),KEYCODE=function(e){return e[e.KEYCODE_HOME=3]="KEYCODE_HOME",e[e.KEYCODE_BACK=4]="KEYCODE_BACK",e[e.KEYCODE_MENU=82]="KEYCODE_MENU",e[e.KEYCODE_APP_SWITCH=187]="KEYCODE_APP_SWITCH",e}(KEYCODE||{}),INNER_KEYCODE={KEYCODE_VOLUME_UP:24,KEYCODE_VOLUME_DOWN:25,KEYCODE_POWER:26,KEYCODE_ALT_LEFT:57,KEYCODE_ALT_RIGHT:58,KEYCODE_SHIFT_LEFT:59,KEYCODE_SHIFT_RIGHT:60,KEYCODE_TAB:61,KEYCODE_SPACE:62,KEYCODE_ENTER:66,KEYCODE_DEL:67,KEYCODE_BACKSLASH:73,KEYCODE_CAPS_LOCK:115},GAMEPAD_BUTTON={KEYCODE_BUTTON_A:96,KEYCODE_BUTTON_B:97,KEYCODE_BUTTON_X:99,KEYCODE_BUTTON_Y:100,KEYCODE_BUTTON_START:108,KEYCODE_BUTTON_SELECT:109,KEYCODE_BUTTON_L1:102,KEYCODE_BUTTON_R1:103,KEYCODE_BUTTON_L2:104,KEYCODE_BUTTON_R2:105,KEYCODE_BUTTON_THUMBL:106,KEYCODE_BUTTON_THUMBR:107,KEYCODE_DPAD_UP:19,KEYCODE_DPAD_DOWN:20,KEYCODE_DPAD_LEFT:21,KEYCODE_DPAD_RIGHT:22,KEYCODE_DPAD_UP_LEFT:268,KEYCODE_DPAD_DOWN_LEFT:269,KEYCODE_DPAD_UP_RIGHT:270,KEYCODE_DPAD_DOWN_RIGHT:271},PACKET_TYPE={AUTH_PACKET:0,VIDEO_PACKET:1,AUDIO_PACKET:2,CONTROL_PACKET:3,STREAM_CONTROL_PACKET:4,AUDIO_FORMAT_PACKET:10,VIDEO_FORMAT_PACKET:11,GAME_FORMAT_PACKET:12,CLIENT_INFO_PACKET:13,GAMEPAD_VIBRATION_PACKET:14,WEBSOCKET_CUSTOM_PING:23,WEBSOCKET_CUSTOM_PONG:24,REQUEST_I_FRAME:22},LOCAL_KEYBOARD_STATUS={BLUR:0,NEED_INTERACTION:1,FOCUS:2},STREAM_TYPE={STREAM_INDEX_MAIN:0,STREAM_INDEX_SCREEN:1},VIDEO_SOURCE_TYPE={VIDEO_SOURCE_TYPE_EXTERNAL:0,VIDEO_SOURCE_TYPE_INTERNAL:1},AUDIO_SOURCE_TYPE={AUDIO_SOURCE_TYPE_EXTERNAL:0,AUDIO_SOURCE_TYPE_INTERNAL:1},DISLAY_POLICY_REASON={SERVER_SWITCH:0,CLIENT_GET:1,CLIENT_SET:2,ERROR_PARAMETER:3},VIDEO_RENDER_MODE=function(e){return e[e.CONTAIN=0]="CONTAIN",e[e.FILL=1]="FILL",e[e.COVER=2]="COVER",e}(VIDEO_RENDER_MODE||{}),KEYCODE_ANDROID_ORIGIN={KEYCODE_UNKNOWN:0,KEYCODE_SOFT_LEFT:1,KEYCODE_SOFT_RIGHT:2,KEYCODE_HOME:3,KEYCODE_BACK:4,KEYCODE_CALL:5,KEYCODE_ENDCALL:6,KEYCODE_0:7,KEYCODE_1:8,KEYCODE_2:9,KEYCODE_3:10,KEYCODE_4:11,KEYCODE_5:12,KEYCODE_6:13,KEYCODE_7:14,KEYCODE_8:15,KEYCODE_9:16,KEYCODE_STAR:17,KEYCODE_POUND:18,KEYCODE_DPAD_UP:19,KEYCODE_DPAD_DOWN:20,KEYCODE_DPAD_LEFT:21,KEYCODE_DPAD_RIGHT:22,KEYCODE_DPAD_CENTER:23,KEYCODE_VOLUME_UP:24,KEYCODE_VOLUME_DOWN:25,KEYCODE_POWER:26,KEYCODE_CAMERA:27,KEYCODE_CLEAR:28,KEYCODE_A:29,KEYCODE_B:30,KEYCODE_C:31,KEYCODE_D:32,KEYCODE_E:33,KEYCODE_F:34,KEYCODE_G:35,KEYCODE_H:36,KEYCODE_I:37,KEYCODE_J:38,KEYCODE_K:39,KEYCODE_L:40,KEYCODE_M:41,KEYCODE_N:42,KEYCODE_O:43,KEYCODE_P:44,KEYCODE_Q:45,KEYCODE_R:46,KEYCODE_S:47,KEYCODE_T:48,KEYCODE_U:49,KEYCODE_V:50,KEYCODE_W:51,KEYCODE_X:52,KEYCODE_Y:53,KEYCODE_Z:54,KEYCODE_COMMA:55,KEYCODE_PERIOD:56,KEYCODE_ALT_LEFT:57,KEYCODE_ALT_RIGHT:58,KEYCODE_SHIFT_LEFT:59,KEYCODE_SHIFT_RIGHT:60,KEYCODE_TAB:61,KEYCODE_SPACE:62,KEYCODE_SYM:63,KEYCODE_EXPLORER:64,KEYCODE_ENVELOPE:65,KEYCODE_ENTER:66,KEYCODE_DEL:67,KEYCODE_GRAVE:68,KEYCODE_MINUS:69,KEYCODE_EQUALS:70,KEYCODE_LEFT_BRACKET:71,KEYCODE_RIGHT_BRACKET:72,KEYCODE_BACKSLASH:73,KEYCODE_SEMICOLON:74,KEYCODE_APOSTROPHE:75,KEYCODE_SLASH:76,KEYCODE_AT:77,KEYCODE_NUM:78,KEYCODE_HEADSETHOOK:79,KEYCODE_FOCUS:80,KEYCODE_PLUS:81,KEYCODE_MENU:82,KEYCODE_NOTIFICATION:83,KEYCODE_SEARCH:84,KEYCODE_MEDIA_PLAY_PAUSE:85,KEYCODE_MEDIA_STOP:86,KEYCODE_MEDIA_NEXT:87,KEYCODE_MEDIA_PREVIOUS:88,KEYCODE_MEDIA_REWIND:89,KEYCODE_MEDIA_FAST_FORWARD:90,KEYCODE_MUTE:91,KEYCODE_PAGE_UP:92,KEYCODE_PAGE_DOWN:93,KEYCODE_PICTSYMBOLS:94,KEYCODE_SWITCH_CHARSET:95,KEYCODE_BUTTON_A:96,KEYCODE_BUTTON_B:97,KEYCODE_BUTTON_C:98,KEYCODE_BUTTON_X:99,KEYCODE_BUTTON_Y:100,KEYCODE_BUTTON_Z:101,KEYCODE_BUTTON_L1:102,KEYCODE_BUTTON_R1:103,KEYCODE_BUTTON_L2:104,KEYCODE_BUTTON_R2:105,KEYCODE_BUTTON_THUMBL:106,KEYCODE_BUTTON_THUMBR:107,KEYCODE_BUTTON_START:108,KEYCODE_BUTTON_SELECT:109,KEYCODE_BUTTON_MODE:110,KEYCODE_ESCAPE:111,KEYCODE_FORWARD_DEL:112,KEYCODE_CTRL_LEFT:113,KEYCODE_CTRL_RIGHT:114,KEYCODE_CAPS_LOCK:115,KEYCODE_SCROLL_LOCK:116,KEYCODE_META_LEFT:117,KEYCODE_META_RIGHT:118,KEYCODE_FUNCTION:119,KEYCODE_SYSRQ:120,KEYCODE_BREAK:121,KEYCODE_MOVE_HOME:122,KEYCODE_MOVE_END:123,KEYCODE_INSERT:124,KEYCODE_FORWARD:125,KEYCODE_MEDIA_PLAY:126,KEYCODE_MEDIA_PAUSE:127,KEYCODE_MEDIA_CLOSE:128,KEYCODE_MEDIA_EJECT:129,KEYCODE_MEDIA_RECORD:130,KEYCODE_F1:131,KEYCODE_F2:132,KEYCODE_F3:133,KEYCODE_F4:134,KEYCODE_F5:135,KEYCODE_F6:136,KEYCODE_F7:137,KEYCODE_F8:138,KEYCODE_F9:139,KEYCODE_F10:140,KEYCODE_F11:141,KEYCODE_F12:142,KEYCODE_NUM_LOCK:143,KEYCODE_NUMPAD_0:144,KEYCODE_NUMPAD_1:145,KEYCODE_NUMPAD_2:146,KEYCODE_NUMPAD_3:147,KEYCODE_NUMPAD_4:148,KEYCODE_NUMPAD_5:149,KEYCODE_NUMPAD_6:150,KEYCODE_NUMPAD_7:151,KEYCODE_NUMPAD_8:152,KEYCODE_NUMPAD_9:153,KEYCODE_NUMPAD_DIVIDE:154,KEYCODE_NUMPAD_MULTIPLY:155,KEYCODE_NUMPAD_SUBTRACT:156,KEYCODE_NUMPAD_ADD:157,KEYCODE_NUMPAD_DOT:158,KEYCODE_NUMPAD_COMMA:159,KEYCODE_NUMPAD_ENTER:160,KEYCODE_NUMPAD_EQUALS:161,KEYCODE_NUMPAD_LEFT_PAREN:162,KEYCODE_NUMPAD_RIGHT_PAREN:163,KEYCODE_VOLUME_MUTE:164,KEYCODE_INFO:165,KEYCODE_CHANNEL_UP:166,KEYCODE_CHANNEL_DOWN:167,KEYCODE_ZOOM_IN:168,KEYCODE_ZOOM_OUT:169,KEYCODE_TV:170,KEYCODE_WINDOW:171,KEYCODE_GUIDE:172,KEYCODE_DVR:173,KEYCODE_BOOKMARK:174,KEYCODE_CAPTIONS:175,KEYCODE_SETTINGS:176,KEYCODE_TV_POWER:177,KEYCODE_TV_INPUT:178,KEYCODE_STB_POWER:179,KEYCODE_STB_INPUT:180,KEYCODE_AVR_POWER:181,KEYCODE_AVR_INPUT:182,KEYCODE_PROG_RED:183,KEYCODE_PROG_GREEN:184,KEYCODE_PROG_YELLOW:185,KEYCODE_PROG_BLUE:186,KEYCODE_APP_SWITCH:187,KEYCODE_BUTTON_1:188,KEYCODE_BUTTON_2:189,KEYCODE_BUTTON_3:190,KEYCODE_BUTTON_4:191,KEYCODE_BUTTON_5:192,KEYCODE_BUTTON_6:193,KEYCODE_BUTTON_7:194,KEYCODE_BUTTON_8:195,KEYCODE_BUTTON_9:196,KEYCODE_BUTTON_10:197,KEYCODE_BUTTON_11:198,KEYCODE_BUTTON_12:199,KEYCODE_BUTTON_13:200,KEYCODE_BUTTON_14:201,KEYCODE_BUTTON_15:202,KEYCODE_BUTTON_16:203,KEYCODE_LANGUAGE_SWITCH:204,KEYCODE_MANNER_MODE:205,KEYCODE_3D_MODE:206,KEYCODE_CONTACTS:207,KEYCODE_CALENDAR:208,KEYCODE_MUSIC:209,KEYCODE_CALCULATOR:210,KEYCODE_ZENKAKU_HANKAKU:211,KEYCODE_EISU:212,KEYCODE_MUHENKAN:213,KEYCODE_HENKAN:214,KEYCODE_KATAKANA_HIRAGANA:215,KEYCODE_YEN:216,KEYCODE_RO:217,KEYCODE_KANA:218,KEYCODE_ASSIST:219,KEYCODE_BRIGHTNESS_DOWN:220,KEYCODE_BRIGHTNESS_UP:221,KEYCODE_MEDIA_AUDIO_TRACK:222,KEYCODE_SLEEP:223,KEYCODE_WAKEUP:224,KEYCODE_PAIRING:225,KEYCODE_MEDIA_TOP_MENU:226,KEYCODE_11:227,KEYCODE_12:228,KEYCODE_LAST_CHANNEL:229,KEYCODE_TV_DATA_SERVICE:230,KEYCODE_VOICE_ASSIST:231,KEYCODE_TV_RADIO_SERVICE:232,KEYCODE_TV_TELETEXT:233,KEYCODE_TV_NUMBER_ENTRY:234,KEYCODE_TV_TERRESTRIAL_ANALOG:235,KEYCODE_TV_TERRESTRIAL_DIGITAL:236,KEYCODE_TV_SATELLITE:237,KEYCODE_TV_SATELLITE_BS:238,KEYCODE_TV_SATELLITE_CS:239,KEYCODE_TV_SATELLITE_SERVICE:240,KEYCODE_TV_NETWORK:241,KEYCODE_TV_ANTENNA_CABLE:242,KEYCODE_TV_INPUT_HDMI_1:243,KEYCODE_TV_INPUT_HDMI_2:244,KEYCODE_TV_INPUT_HDMI_3:245,KEYCODE_TV_INPUT_HDMI_4:246,KEYCODE_TV_INPUT_COMPOSITE_1:247,KEYCODE_TV_INPUT_COMPOSITE_2:248,KEYCODE_TV_INPUT_COMPONENT_1:249,KEYCODE_TV_INPUT_COMPONENT_2:250,KEYCODE_TV_INPUT_VGA_1:251,KEYCODE_TV_AUDIO_DESCRIPTION:252,KEYCODE_TV_AUDIO_DESCRIPTION_MIX_UP:253,KEYCODE_TV_AUDIO_DESCRIPTION_MIX_DOWN:254,KEYCODE_TV_ZOOM_MODE:255,KEYCODE_TV_CONTENTS_MENU:256,KEYCODE_TV_MEDIA_CONTEXT_MENU:257,KEYCODE_TV_TIMER_PROGRAMMING:258,KEYCODE_HELP:259,KEYCODE_NAVIGATE_PREVIOUS:260,KEYCODE_NAVIGATE_NEXT:261,KEYCODE_NAVIGATE_IN:262,KEYCODE_NAVIGATE_OUT:263,KEYCODE_STEM_PRIMARY:264,KEYCODE_STEM_1:265,KEYCODE_STEM_2:266,KEYCODE_STEM_3:267,KEYCODE_DPAD_UP_LEFT:268,KEYCODE_DPAD_DOWN_LEFT:269,KEYCODE_DPAD_UP_RIGHT:270,KEYCODE_DPAD_DOWN_RIGHT:271,KEYCODE_MEDIA_SKIP_FORWARD:272,KEYCODE_MEDIA_SKIP_BACKWARD:273,KEYCODE_MEDIA_STEP_FORWARD:274,KEYCODE_MEDIA_STEP_BACKWARD:275,KEYCODE_SOFT_SLEEP:276,KEYCODE_CUT:277,KEYCODE_COPY:278,KEYCODE_PASTE:279,KEYCODE_SYSTEM_NAVIGATION_UP:280,KEYCODE_SYSTEM_NAVIGATION_DOWN:281,KEYCODE_SYSTEM_NAVIGATION_LEFT:282,KEYCODE_SYSTEM_NAVIGATION_RIGHT:283,KEYCODE_ALL_APPS:284,KEYCODE_REFRESH:285,KEYCODE_THUMBS_UP:286,KEYCODE_THUMBS_DOWN:287,KEYCODE_PROFILE_SWITCH:288,KEYCODE_VIDEO_APP_1:289,KEYCODE_VIDEO_APP_2:290,KEYCODE_VIDEO_APP_3:291,KEYCODE_VIDEO_APP_4:292,KEYCODE_VIDEO_APP_5:293,KEYCODE_VIDEO_APP_6:294,KEYCODE_VIDEO_APP_7:295,KEYCODE_VIDEO_APP_8:296,KEYCODE_FEATURED_APP_1:297,KEYCODE_FEATURED_APP_2:298,KEYCODE_FEATURED_APP_3:299,KEYCODE_FEATURED_APP_4:300,KEYCODE_DEMO_APP_1:301,KEYCODE_DEMO_APP_2:302,KEYCODE_DEMO_APP_3:303,KEYCODE_DEMO_APP_4:304},FUNCTION_KEYCODE_CONVERT_ANDROID={ArrowUp:"KEYCODE_DPAD_UP",ArrowDown:"KEYCODE_DPAD_DOWN",ArrowLeft:"KEYCODE_DPAD_LEFT",ArrowRight:"KEYCODE_DPAD_RIGHT",Enter:"KEYCODE_ENTER",Backspace:"KEYCODE_DEL",NumpadEnter:"KEYCODE_ENTER"},POD_KEYBOARD_STATUS={VIRTUAL_KEYBOARD:0,LOCAL_KEYBOARD:1},START_CONNECTION_STATUS=function(e){return e[e.STARTED=1]="STARTED",e[e.PODSTART_SUCCESS=2]="PODSTART_SUCCESS",e[e.CLIENT_JOIN_ROOM_SUCCESS=3]="CLIENT_JOIN_ROOM_SUCCESS",e[e.POD_JOIN_ROOM_SUCCESS=4]="POD_JOIN_ROOM_SUCCESS",e[e.POD_HAS_PUBLISH_STREAM=5]="POD_HAS_PUBLISH_STREAM",e[e.CLIENT_SUBSCRIBE_STREAM=6]="CLIENT_SUBSCRIBE_STREAM",e[e.CLIENT_PLAY_SUCCESS=7]="CLIENT_PLAY_SUCCESS",e[e.CLIENT_FRAME_RENDER_SUCCESS=8]="CLIENT_FRAME_RENDER_SUCCESS",e[e.CLIENT_START_SUCCESS=9]="CLIENT_START_SUCCESS",e[e.PODSTART_ERROR=10]="PODSTART_ERROR",e[e.CLIENT_JOIN_ROOM_FAILED=11]="CLIENT_JOIN_ROOM_FAILED",e}(START_CONNECTION_STATUS||{}),START_ERROR_MAP={ERROR_START_AUTHENTICATION_FAILED:[10001,[7e5,700001,700002,71e3]],ERROR_START_GENERAL:[1e4,3e6],ERROR_START_GAME_ID_OR_CUSTOM_GAME_ID_NOT_EXIST:[10002,3530001],ERROR_START_GAME_ID_NOT_READY:[10003,3530002],ERROR_START_CONFIGURATION_CODE_NOT_EXIST:[10004,600003],ERROR_START_CONFIGURATION_CODE_NOT_REDAY:[10005,[3560001,3560002]],ERROR_START_RESOURCE_NOT_READY:[10006,3560005],ERROR_START_RESOURCE_CAPACITY_NOT_ENOUGH:[10007,[3560007,3560008]],ERROR_START_STREAM_AUTO_PLAY_FAILED:[10008],ERROR_START_AUTHENTICATION_KEY_FAILED:[10009,100026],ERROR_START_RESERVED_ID_NOT_FOUND:[10012,3561001],ERROR_START_RESERVED_ID_EXPIRED:[10013,3561002],ERROR_START_RESERVED_ID_ALREADY_USED_RELEASE:[10014,3561003],ERROR_START_RESERVED_ID_USING:[10015,3561004],ERROR_START_RESERVED_ID_MISMATCH_PREPARE:[10016,3561005],ERROR_START_NO_SUFFICIENT_FUND:[10017,3200002],ERROR_START_USER_CONFLICT:[10018,3560009],ERROR_START_MISMATCH_ACCOUNTID_VEGAME:[10026,700003,"ERROR_START_MISMATCH_ACCOUNTID"],ERROR_START_INVALID_LOCAL_TIME:[10027,100006],ERROR_START_PRODUCT_NOT_EXIST:[11001,2000001],ERROR_START_APPLICATION_NOT_EXIST:[11002,3000001],ERROR_START_PHONE_CONFIGURATION_CODE_NOT_EXIST:[11003,6e6],ERROR_START_POD_NOT_EXIST:[11004,11000001],ERROR_REQUEST_PARAMETER_BINDING_ERROR:[11005,1000001],ERROR_INVALID_REQUEST_PARAMETER:[11006,1000007],ERROR_BUSINESS_ID_ERROR:[11007,2e6],ERROR_DOWN_STREAM_UNKNOWN_ERROR:[11021,1000008],ERROR_ACCOUNT_ID_INIT_ERROR:[11008,7e6],ERROR_ACCOUNT_ID_IS_INVALID:[11009,7000001],ERROR_USER_IS_INVALID:[11010,71e5],ERROR_GENERIC_INSTANCE_ERROR:[11011,11e6],ERROR_INSTANCE_OFFLINE:[11012,11000002],ERROR_UNIVERSAL_STARTUP_FAILED:[11013,15e6],ERROR_INTERNAL_POD_START_FAILED:[11014,15000001],ERROR_INTERNAL_POD_MUTE_FAILED:[11015,15000002],ERROR_INTERNAL_CONFIG_FAILED:[11016,15000003],ERROR_START_MISMATCH_ACCOUNTID_VEPHONE:[11019,7000003,"ERROR_ACCOUNTID_MISMATCH"],ERROR_STREAM_GENERAL:[2e4,["ERROR_STATUS","ERROR_BYTE_RTC_ERROR"]],ERROR_STREAM_CONNECTION_FAILED:[20001,[300002,300003]],ERROR_STREAM_CHANGE_CLARITY_ID_NOT_IN_START_STATE:[20002],ERROR_SDK_INIT_FAILED:[30001],ERROR_SDK_LACK_OF_LOCATION_PERMISSION:[30007],ERROR_SDK_GENERAL:[3e4],ERROR_GAME_VIDEO_STREAM_PROFILE_NOT_IN_RANGE:[200005],ERROR_INIT_ACCOUNT_ID_ILLEGAL:[30009],ERROR_NET_REQUEST_ERROR:[60001],ERROR_HTTP_REQUEST_ERROR:[60002],ERROR_QUEUE_REQUEST_ERROR:[60003],ERROR_START_INVALID_ROLE:[10028,3560017],ERROR_USER_NOT_IN_QUEUE:[10029,3565002],ERROR_SDK_MANY_CONNECTION:[30012],ERROR_SDK_USER_HAS_LEAVE_ROOM:[30013],ERROR_SDK_JOIN_ROOM_FAILED:[30014],ERROR_SDK_USER_FORBIDDEN:[30015]},GAME_START_ERROR_TRANSFER_PHONE_ERROR={ERROR_START_PHONE_CONFIGURATION_CODE_NOT_EXIST:"ERROR_START_CONFIGURATION_CODE_NOT_EXIST"},START_ERROR=(object=START_ERROR_MAP,result={},Object.keys(object).forEach((function(e){var t=_slicedToArray(object[e],3),r=t[0],n=t[1],i=t[2];result[e]={CODE:r,ORIGIN:n,MESSAGE:i||e}})),result),object,result;function findStartError(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e)for(var r=Object.keys(START_ERROR),n=0,i=r;n<i.length;n++){var o=i[n],a=START_ERROR[o];if(void 0!==a.ORIGIN){var s=a.ORIGIN instanceof Array?a.ORIGIN.includes(e):a.ORIGIN===e,c=t&&(null==GAME_START_ERROR_TRANSFER_PHONE_ERROR?void 0:GAME_START_ERROR_TRANSFER_PHONE_ERROR[a.MESSAGE])||a.MESSAGE;if(s)return{errorCode:a.CODE,message:c}}}return{errorCode:START_ERROR.ERROR_START_GENERAL.CODE,message:START_ERROR.ERROR_START_GENERAL.MESSAGE}}var POD_WARNING=fillErrorMessage({WARNING_START_NO_STOP_BEFORE:10010,WARNING_START_INVALID_AUTO_RECYCLE_TIME:10019,WARNING_START_AUDIO_AUTO_PLAY_FAILED:10022,WARNING_START_WITH_FRAMEWORK_NOT_FOUND:10023,WARNING_START_WITH_FRAMEWORK_PART_MATCH:10024,WARNING_START_WITH_FRAMEWORK_WRONG_INPUT_FORMAT:10025,WARNING_VIEWER_METHOD_CALLED:30011,WARNING_QUEUEING_LACK_RESOURCE:10030,WARNING_NATIVE_IME_DISABLED:40054}),POD_ERROR$1=fillErrorMessage({ERROR_GAME_ABNORMAL_EXIT:4e4,ERROR_POD_REMOTE_OFFLINE:4e4,ERROR_GAME_CRASH:40001,ERROR_GAME_OFFLINE:40002,ERROR_GAME_EXIT_TIMEOUT:40003,ERROR_GAME_STOPPED_IDLE:40004,ERROR_GAME_STOPPED_RESET:40005,ERROR_GAME_STOPPED_API:40006,ERROR_GAME_STOPPED_DUPLICATE_START:40007,ERROR_POD_STOPPED_BACKGROUND_TIMEOUT:40008,ERROR_POD_EXIT_GENERAL:40009,ERROR_GAME_ALREADY_STOPPED:40010,ERROR_REMOTE_POWER_OFF:40011,WARNING_LOCAL_ALREADY_SET_BACKGROUND:40037,WARNING_LOCAL_ALREADY_SET_FOREGROUND:40038,ERROR_SET_INVALID_AUTO_RECYCLE_TIME:40039,WARNING_GAME_STOPPED_INGAME_EXIT:40044,ERROR_STORAGE_NOT_ENOUGH:40045,ERROR_POD_UNKNOWN_FAILURE:40046,WARNING_VIDEO_PROFILE_NOT_SUPPORT_CURRENT_PLAN:40052,ERROR_FILE_CHANNEL_FILE_NOT_FOUND:71001,ERROR_FILE_CHANNEL_FILE_NO_ACCESS:71002,ERROR_FILE_CHANNEL_NETWORK_ABORT:71003,ERROR_FILE_CHANNEL_TIMEOUT:71004,ERROR_FILE_CHANNEL_STORAGE_NOT_ENOUGH:71005,ERROR_FILE_CHANNEL_INTERNAL_ERROR:71006}),GAME_ERROR_TRANSFER_PHONE_ERROR={ERROR_GAME_ABNORMAL_EXIT:"ERROR_REMOTE_ABNORMAL_EXIT",ERROR_GAME_CRASH:"ERROR_REMOTE_OPENAPI_EXIT",ERROR_GAME_STOPPED_IDLE:"ERROR_STREAM_STOPPED_AUTO_RECYCLE",ERROR_GAME_STOPPED_RESET:"ERROR_REMOTE_EXIT",ERROR_GAME_STOPPED_API:"ERROR_REMOTE_STOPPED_API",ERROR_GAME_OFFLINE:"ERROR_REMOTE_INVISIVLE",ERROR_GAME_EXIT_TIMEOUT:"ERROR_REMOTE_KICKOFF",ERROR_GAME_STOPPED_DUPLICATE_START:"ERROR_DUPLICATE_USER"},POD_ERROR_PHONE_EXTEND=Object.keys(GAME_ERROR_TRANSFER_PHONE_ERROR).reduce((function(e,t){return _objectSpread2(_objectSpread2({},e),{},_defineProperty$1({},t,_objectSpread2(_objectSpread2({},null==POD_ERROR$1?void 0:POD_ERROR$1[t]),{},{MESSAGE:null==GAME_ERROR_TRANSFER_PHONE_ERROR?void 0:GAME_ERROR_TRANSFER_PHONE_ERROR[t]})))}),{}),BUILDER_KEYS={WARNING_REMOTE_$_FOREGROUND_FAILURE_NO_SUCH_PACKAGE_NAME:40040,WARNING_REMOTE_$_ALREADY_FOREGROUND:40041,WARNING_REMOTE_$_FOREGROUND_FAILURE_NO_PACKAGE_NAME_BACKGROUND:40043,ERROR_SDK_$_EMPTY:30002,ERROR_SDK_$_ERROR:50006},ERROR_BUILDER=function(){var e={};return Object.keys(BUILDER_KEYS).forEach((function(t){var r=BUILDER_KEYS[t];e[t]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=e?t.replace("$",e):t.replace("$_","");return{CODE:r,MESSAGE:n}}})),e}(),MESSAGE_CHANNEL_ERROR=fillErrorMessage({ERROR_MESSAGE_GENERAL_ERROR:5e4,ERROR_MESSAGE_NOT_READY:50001,ERROR_MESSAGE_FAILED_TO_PARSE_MSG:50002,ERROR_MESSAGE_CHANNEL_UID_ILLEGAL:50003,ERROR_MESSAGE_FAILED:50004,ERROR_MESSAGE_NOT_CLOUD_RUNTIME:50005,ERROR_MESSAGE_CONNECT_VERIFY_FAILED:50006,ERROR_MESSAGE_OVER_SIZED:50007,ERROR_MESSAGE_NOT_CONNECTED:50008,ERROR_MESSAGE_TIMEOUT_ILLEGAL:50009}),STATUS_ERROR={786:[40004,"ERROR_GAME_STOPPED_IDLE"],794:[40008,"ERROR_POD_STOPPED_BACKGROUND_TIMEOUT"],5:[40006,"ERROR_GAME_STOPPED_API"],1:[40014,"MESSAGE_RESOURCE_OFFLINE"],3:[40015,"MESSAGE_RESOURCE_UPDATING"],4:[40016,"MESSAGE_RESOURCE_REBOOTING"],6:[40017,"MESSAGE_RESOURCE_MAINTANENCE"],7:[40018,"MESSAGE_RESOURCE_SERVICE_UPDATING"],784:[40023,"MESSAGE_RESOURCE_RELEASED_NORMAL"],785:[40024,"MESSAGE_RESOURCE_RELEASED_NO_USER"],787:[40026,"MESSAGE_RESOURCE_RELEASED_OS_MISSED"],788:[40027,"MESSAGE_RESOURCE_RELEASED_GAME_START_FAILURE"],789:[40028,"MESSAGE_RESOURCE_RELEASED_STREAMING_ERROR"],790:[40029,"MESSAGE_RESOURCE_RELEASED_3RD_APP_MISSED"],1030:[40047,"MESSAGE_RESOURCE_RELEASED_INVALID_PARAMETER"],1031:[40048,"MESSAGE_RESOURCE_RELEASED_HEART_BEAT_TIMEOUT"],1032:[40049,"MESSAGE_RESOURCE_RELEASED_INGAME_EXIT"],1033:[40050,"MESSAGE_RESOURCE_RELEASED_START_ERROR_ARCHIVE_DOWNLOAD_FAILURE"],1027:[40032,"MESSAGE_CLOUD_GAME_CRASH_OFTEN"],1028:[40033,"MESSAGE_GAME_STEAMING_FAILURE"],768:[40019,"MESSAGE_RESOURCE_OCCUPIED"],769:[40020,"MESSAGE_RESOURCE_LAUNCHING_GAME"],770:[40021,"MESSAGE_RESOURCE_IS_RUNNING"],771:[40022,"MESSAGE_RESOURCE_IS_PUBLISH"],1024:[40030,"MESSAGE_RESOURCE_ERROR"],1025:[40031,"MESSAGE_3RD_APP_START_FAILURE"],9:[40034,"MESSAGE_RESOURCE_CLOUD_SERVICE_UPDATING"],12:[40035,"MESSAGE_RESOURCE_POD_NODE_UPDATING"],256:[40036,"MESSAGE_RESOURCE_POD_AVAILABLE"],816:[40037,"MESSAGE_3RD_APP_EXCEPTION"],1026:[40038,"MESSAGE_RESOURCE_START_FAIL"],1e4:[40042,"MESSAGE_RESOURCE_RID_OVERDUE"],10001:[40043,"MESSAGE_RESOURCE_RID_NOT_USED"],10002:[40044,"MESSAGE_RESOURCE_RID_POD_QUIT"],772:[40045,"MESSAGE_RESOURCE_RESTORE_ARCHIVE"],791:[40046,"MESSAGE_RESOURCE_START_RELEASE_NO_ARCHIVE"],792:[40051,"MESSAGE_RESOURCE_START_RELEASE_WITH_ARCHIVE"],793:[40052,"MESSAGE_RESOURCE_FINISH_ARCHIVE"]},SDK_CUSTOM_ERROR=fillErrorMessage({CLIENT_NOT_INIT:[6e3,"CLIENT_NOT_EXIT"],RTC_CLIENT_NOT_CREATE:[6001,"CLIENT_NOT_EXIT"],PUBLISH_STREAM_RTC_FAIL:7001,GET_USER_MEDIA_FAIL:7002,UNPUBLISH_STREAM_RTC_FAIL:7003});function buildCustomError(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"CUSTOM_ERROR";return{CODE:8001,MESSAGE:e}}function fillErrorMessage(e){var t={};return Object.keys(e).forEach((function(r){var n=e[r];t[r]="number"==typeof n?{CODE:n,MESSAGE:r}:{CODE:n[0],MESSAGE:n[1]}})),t}var dist={exports:{}};!function(e,t){e.exports=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}var r=t((function(e,t){var r;e.exports=r=r||function(e,t){var r=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),n={},i=n.lib={},o=i.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=i.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var a=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=a<<24-(n+o)%4*8}else for(o=0;o<i;o+=4)t[n+o>>>2]=r[o>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r,n=[],i=function(t){var r=987654321,n=4294967295;return function(){var i=((r=36969*(65535&r)+(r>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;return i/=4294967296,(i+=.5)*(e.random()>.5?1:-1)}},o=0;o<t;o+=4){var s=i(4294967296*(r||e.random()));r=987654071*s(),n.push(4294967296*s()|0)}return new a.init(n,t)}}),s=n.enc={},c=s.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(r,t/2)}},u=s.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(r,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},d=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,i=r.sigBytes,o=this.blockSize,s=i/(4*o),c=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*o,u=e.min(4*c,i);if(c){for(var l=0;l<c;l+=o)this._doProcessBlock(n,l);var d=n.splice(0,c);r.sigBytes-=u}return new a.init(d,u)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=d.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new p.HMAC.init(e,r).finalize(t)}}});var p=n.algo={};return n}(Math)})),n=t((function(e,t){var n;e.exports=(n=r,function(e){var t=n,r=t.lib,i=r.WordArray,o=r.Hasher,a=t.algo,s=[],c=[];!function(){function t(t){for(var r=e.sqrt(t),n=2;n<=r;n++)if(!(t%n))return!1;return!0}function r(e){return 4294967296*(e-(0|e))|0}for(var n=2,i=0;i<64;)t(n)&&(i<8&&(s[i]=r(e.pow(n,.5))),c[i]=r(e.pow(n,1/3)),i++),n++}();var u=[],l=a.SHA256=o.extend({_doReset:function(){this._hash=new i.init(s.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],d=r[6],p=r[7],_=0;_<64;_++){if(_<16)u[_]=0|e[t+_];else{var h=u[_-15],f=(h<<25|h>>>7)^(h<<14|h>>>18)^h>>>3,m=u[_-2],g=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;u[_]=f+u[_-7]+g+u[_-16]}var v=n&i^n&o^i&o,y=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),S=p+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&l^~s&d)+c[_]+u[_];p=d,d=l,l=s,s=a+S|0,a=o,o=i,i=n,n=S+(y+v)|0}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+a|0,r[4]=r[4]+s|0,r[5]=r[5]+l|0,r[6]=r[6]+d|0,r[7]=r[7]+p|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;return r[i>>>5]|=128<<24-i%32,r[14+(i+64>>>9<<4)]=e.floor(n/4294967296),r[15+(i+64>>>9<<4)]=n,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(l),t.HmacSHA256=o._createHmacHelper(l)}(Math),n.SHA256)})),i=(t((function(e,t){var n,i,o;e.exports=(i=(n=r).lib.Base,o=n.enc.Utf8,void(n.algo.HMAC=i.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=o.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),a=this._iKey=t.clone(),s=i.words,c=a.words,u=0;u<r;u++)s[u]^=1549556828,c[u]^=909522486;i.sigBytes=a.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})))})),t((function(e,t){e.exports=r.HmacSHA256}))),o={hmac:function(e,t){return i(t,e)},sha256:function(e){return n(e)}},a=["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id"],s=function(e){try{return encodeURIComponent(e).replace(/[^A-Za-z0-9_.~\-%]+/g,escape).replace(/[*]/g,(function(e){return"%".concat(e.charCodeAt(0).toString(16).toUpperCase())}))}catch(t){return""}},c=function(e){return Object.keys(e).sort().map((function(t){var r=e[t];if(null!=r){var n=s(t);if(n)return Array.isArray(r)?"".concat(n,"=").concat(r.map(s).sort().join("&".concat(n,"="))):"".concat(n,"=").concat(s(r))}})).filter((function(e){return e})).join("&")};return function(){function t(e,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.request=e,this.request.headers=e.headers||{},this.serviceName=r,n=n||{},this.signatureCache="boolean"!=typeof n.signatureCache||n.signatureCache,this.operation=n.operation,this.signatureVersion=n.signatureVersion,this.constant=n.isVolcengine?{algorithm:"HMAC-SHA256",v4Identifier:"request",dateHeader:"X-Date",tokenHeader:"x-security-token",contentSha256Header:"X-Content-Sha256",kDatePrefix:""}:{algorithm:"AWS4-HMAC-SHA256",v4Identifier:"aws4_request",dateHeader:"X-Amz-Date",tokenHeader:"x-amz-security-token",contentSha256Header:"X-Amz-Content-Sha256",kDatePrefix:"AWS4"},this.bodySha256=n.bodySha256,this.shouldSerializeBody="boolean"!=typeof n.shouldSerializeBody||n.shouldSerializeBody}var r;return(r=[{key:"addAuthorization",value:function(e,t){var r=this.iso8601(t).replace(/[:\-]|\.\d{3}/g,"");this.addHeaders(e,r),this.request.headers.Authorization=this.authorization(e,r)}},{key:"addHeaders",value:function(e,t){if(this.request.headers[this.constant.dateHeader]=t,e.sessionToken&&(this.request.headers[this.constant.tokenHeader]=e.sessionToken),this.request.body){var r=this.request.body;"string"!=typeof r&&this.shouldSerializeBody&&(r=r instanceof URLSearchParams?r.toString():JSON.stringify(r)),this.request.headers[this.constant.contentSha256Header]=this.bodySha256||o.sha256(r).toString()}}},{key:"authorization",value:function(e,t){var r=[],n=this.credentialString(t);return r.push("".concat(this.constant.algorithm," Credential=").concat(e.accessKeyId,"/").concat(n)),r.push("SignedHeaders=".concat(this.signedHeaders())),r.push("Signature=".concat(this.signature(e,t))),r.join(", ")}},{key:"signature",value:function(e,t){var r=this.getSigningKey(e,t.substr(0,8),this.request.region,this.serviceName,this.signatureCache);return o.hmac(r,this.stringToSign(t),"hex")}},{key:"stringToSign",value:function(e){var t=[];return t.push(this.constant.algorithm),t.push(e),t.push(this.credentialString(e)),t.push(this.hexEncodedHash(this.canonicalString())),t.join("\n")}},{key:"canonicalString",value:function(){var e=[],t=this.request.pathname||"/";return e.push(this.request.method.toUpperCase()),e.push(t),e.push(c(this.request.params)||""),e.push("".concat(this.canonicalHeaders(),"\n")),e.push(this.signedHeaders()),e.push(this.hexEncodedBodyHash()),e.join("\n")}},{key:"canonicalHeaders",value:function(){var e=this,t=[];Object.keys(this.request.headers).forEach((function(r){t.push([r,e.request.headers[r]])})),t.sort((function(e,t){return e[0].toLowerCase()<t[0].toLowerCase()?-1:1}));var r=[];return t.forEach((function(t){var n=t[0].toLowerCase();if(e.isSignableHeader(n)){var i=t[1];if(null==i||"function"!=typeof i.toString)throw new Error("Header ".concat(n," contains invalid value"));r.push("".concat(n,":").concat(e.canonicalHeaderValues(i.toString())))}})),r.join("\n")}},{key:"canonicalHeaderValues",value:function(e){return e.replace(/\s+/g," ").replace(/^\s+|\s+$/g,"")}},{key:"signedHeaders",value:function(){var e=this,t=[];return Object.keys(this.request.headers).forEach((function(r){r=r.toLowerCase(),e.isSignableHeader(r)&&t.push(r)})),t.sort().join(";")}},{key:"credentialString",value:function(e){return this.createScope(e.substr(0,8),this.request.region,this.serviceName)}},{key:"hexEncodedHash",value:function(e){return o.sha256(e)}},{key:"hexEncodedBodyHash",value:function(){return this.request.headers[this.constant.contentSha256Header]?this.request.headers[this.constant.contentSha256Header]:this.request.body?this.hexEncodedHash(c(this.request.body)):this.hexEncodedHash("")}},{key:"isSignableHeader",value:function(e){return 0===e.toLowerCase().indexOf("x-amz-")||a.indexOf(e)<0}},{key:"iso8601",value:function(e){return void 0===e&&(e=new Date),e.toISOString().replace(/\.\d{3}Z$/,"Z")}},{key:"getSigningKey",value:function(e,t,r,n){var i=o.hmac("".concat(this.constant.kDatePrefix).concat(e.secretAccessKey),t),a=o.hmac(i,r),s=o.hmac(a,n);return o.hmac(s,this.constant.v4Identifier)}},{key:"createScope",value:function(e,t,r){return[e.substr(0,8),t,r,this.constant.v4Identifier].join("/")}}])&&e(t.prototype,r),t}()}()}(dist);var distExports=dist.exports,AWSSignersV4=getDefaultExportFromCjs$1(distExports),getRandomValues$2,rnds8$2=new Uint8Array(16);function rng$2(){if(!getRandomValues$2&&!(getRandomValues$2="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues$2(rnds8$2)}var REGEX$1=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function validate$1(e){return"string"==typeof e&&REGEX$1.test(e)}for(var byteToHex$2=[],i$2=0;i$2<256;++i$2)byteToHex$2.push((i$2+256).toString(16).substr(1));function stringify$5(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(byteToHex$2[e[t+0]]+byteToHex$2[e[t+1]]+byteToHex$2[e[t+2]]+byteToHex$2[e[t+3]]+"-"+byteToHex$2[e[t+4]]+byteToHex$2[e[t+5]]+"-"+byteToHex$2[e[t+6]]+byteToHex$2[e[t+7]]+"-"+byteToHex$2[e[t+8]]+byteToHex$2[e[t+9]]+"-"+byteToHex$2[e[t+10]]+byteToHex$2[e[t+11]]+byteToHex$2[e[t+12]]+byteToHex$2[e[t+13]]+byteToHex$2[e[t+14]]+byteToHex$2[e[t+15]]).toLowerCase();if(!validate$1(r))throw TypeError("Stringified UUID is invalid");return r}function v4$2(e,t,r){var n=(e=e||{}).random||(e.rng||rng$2)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return stringify$5(n)}function isPC(){return!/Android|Alicar|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)}function isiOS(){return!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)||/Macintosh/i.test(navigator.userAgent)&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>0}function isIOSUniApp(){return/iPhone.*?uni-app/i.test(window.navigator.userAgent)}function isAndroid$1(){var e=navigator.userAgent;return-1!==e.search(/Safari/)&&(-1!==e.search(/Android[\s\/]([\d\.]+)/)||/Alicar/i.test(e))}function isMac$1(){var e=navigator.userAgent;return/macintosh|mac os x/i.test(e)}function getIOSVersion(){try{var e=navigator.userAgent.toLowerCase().match(/cpu iphone os (.*?) like mac os/)[1];return parseInt(null==e?void 0:e.split("_")[0])}catch(t){return null}}function isPwa(){return["standalone"].some((function(e){return window.matchMedia("(display-mode: "+e+")").matches}))}function getPlatform(){return isiOS()?PLATFORM.IOS:isAndroid$1()?PLATFORM.ANDROID:PLATFORM.PC}function keyCodeConvertPCtoAndroid(e){var t=e.keyCode,r=e.shiftKey,n=e.crtlKey,i=e.metaKey;if(t>=65&&t<=90)return(n||i)&&86===t?null:r||i?-1:t-36;if(t>=48&&t<=57)return r?-1:t-41;if(192===t||187===t||189===t||219===t||221===t||220===t||186===t||222===t||188===t||190===t||191===t)return-1;switch(t){case 32:return INNER_KEYCODE.KEYCODE_SPACE;case 13:return INNER_KEYCODE.KEYCODE_ENTER;case 8:return INNER_KEYCODE.KEYCODE_DEL;case 20:return INNER_KEYCODE.KEYCODE_CAPS_LOCK;case 16:return INNER_KEYCODE.KEYCODE_SHIFT_LEFT}}function toQueryString(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).map((function(t){return"".concat(t,"=").concat(e[t])})).join("&")}function randomNumString$1(e){e=e||32;for(var t="0123456789",r=t.length,n="",i=0;i<e;i++)n+=t.charAt(Math.floor(Math.random()*r));return n}var fsCompatMap={fullscreenEnabled:["fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled"],fullscreenElement:["fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement"],requestFullscreen:["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],exitFullscreen:["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],fullscreenchange:["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],fullscreenerror:["fullscreenerror","webkitfullscreenerror","mozfullscreenerror","MSFullscreenError"],pseudoClass:["fullscreen","-webkit-full-screen","-moz-full-screen","-ms-fullscreen"]},fullscreenHelper={get fullscreenElement(){var e=fsCompatMap.fullscreenElement.find((function(e){return e in document}));return e?document[e]:null},set fullscreenElement(e){},get fullscreenEnabled(){var e=fsCompatMap.fullscreenEnabled.find((function(e){return e in document}));return!!e&&document[e]},set fullscreenEnabled(e){},get fullscreenPseudoClass(){return fsCompatMap.pseudoClass.find((function(e,t){return 0!==t&&fsCompatMap.fullscreenEnabled[t]in document}))},set fullscreenPseudoClass(e){},requestFullscreen:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement,t=fsCompatMap.requestFullscreen.find((function(t){return"function"==typeof e[t]}));t&&e[t]()},exitFullscreen:function(){var e=fsCompatMap.exitFullscreen.find((function(e){return"function"==typeof document[e]}));e&&document[e]()},bindFullscreenchange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,t=arguments.length>1?arguments[1]:void 0,r=fsCompatMap.fullscreenchange.find((function(t){return"on".concat(t)in e}));return r&&e.addEventListener(r,t),function(){return fullscreenHelper.unbindFullscreenchange(e,t)}},unbindFullscreenchange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,t=arguments.length>1?arguments[1]:void 0,r=fsCompatMap.fullscreenchange.find((function(t){return"on".concat(t)in e}));r&&e.removeEventListener(r,t)},bindFullscreenerror:function(e){var t=fsCompatMap.fullscreenerror.find((function(e){return"on".concat(e)in document}));return t&&document.addEventListener(t,e),function(){return fullscreenHelper.unbindFullscreenerror(e)}},unbindFullscreenerror:function(e){var t=fsCompatMap.fullscreenerror.find((function(e){return"on".concat(e)in document}));t&&document.removeEventListener(t,e)}};function arraybufferConcatenate(){for(var e=0,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];for(var i=0,o=r;i<o.length;i++){var a=o[i];e+=a.byteLength}for(var s=new Uint8Array(e),c=0,u=0,l=r;u<l.length;u++){var d=l[u],p=new Uint8Array(d);s.set(p,c),c+=d.byteLength}return s.buffer}function debounce(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=null,i=!1;return function(){var o=this,a=Array.prototype.slice.call(arguments);n&&(clearTimeout(n),n=null),!i&&r?(e.apply(o,a),i=!0):n=setTimeout((function(){e.apply(o,a),i=!1}),t)}}function limitRange(e,t,r){return e>r?r:e<t?t:e}function clearUndf(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var r in e)if(e.hasOwnProperty(r)){var n=t?!e[r]:void 0===e[r];n&&delete e[r]}return e}function getDeviceId(){var e=localStorage.getItem(DID_LOCALSTORAGE_KEY);return e||(e="uuid_".concat(v4$2()),localStorage.setItem(DID_LOCALSTORAGE_KEY,e)),e}function pick(e,t){var r,n={},i=_createForOfIteratorHelper(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;n[o]=e[o]}}catch(a){i.e(a)}finally{i.f()}return n}function delay$1(e,t){return new Promise((function(r){var n=setTimeout(r,e);null==t||t(n)}))}var CommonHeader={"Content-Type":"application/json"},CommonParam={"X-Expires":604800,Version:"2022-02-10"};function fetchBase(e,t){return _fetchBase.apply(this,arguments)}function _fetchBase(){return _fetchBase=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R,C,k,I,A,O,M,P,w,D,N,x,L;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.token,i=void 0===n?null:n,o=t.host,a=t.signKey,s=void 0===a?"veGame":a,c=t.url,u=void 0===c?"":c,l=t.params,d=void 0===l?{}:l,p=t.body,_=void 0===p?null:p,h=t.method,f=void 0===h?"POST":h,m=t.timeout,g=void 0===m?3e4:m,v=t.extraRequiredParam,y=void 0===v?{}:v,S=t.headers,E=void 0===S?{}:S,T=t.defaultHosts,b=void 0===T?{PROD:"",PROD_BACKUP:""}:T,R=t.name,C=void 0===R?"":R,k=t.noSendExtra,I=void 0===k?{mode:MODE.CLOUD_PHONE_GAME}:k,A=t.customHandleReturn,O=void 0===A?null:A,M=t.useCommonParams,P=void 0===M||M,w=t.useCommonHeader,D=void 0===w||w,C||(C=d.Action||"fetch_default"),P&&(d=createObject(_objectSpread2(_objectSpread2({},CommonParam),d))),_&&(_=createObject(_)),r.send("openApiFetchStart",{name:C,params:d,body:_}),!1!==i&&checkParamsIsEmpty(_objectSpread2(_objectSpread2({},y),{},{token:i},pickProperties(i,["AccessKeyID","SecretAccessKey","SessionToken"]))),N=toQueryString(d),x=0,L=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n,a,c,l,p,h,m,v,y,S,T,R,k,A,M,P,w=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=w.length>0&&void 0!==w[0]&&w[0],n=w.length>1&&void 0!==w[1]&&w[1],a=t?b.PROD_BACKUP:b.PROD,c={method:f,url:"".concat(o||a).concat(u).concat(N?"?":"").concat(N),timeout:g,region:"cn-north-1",params:d,body:_,headers:D?createObject(_objectSpread2(_objectSpread2({},CommonHeader),E)):E},null!==s&&signAuthorization(c,i,s),l=null,e.prev=6,p={method:c.method,headers:c.headers,mode:"cors",body:null},_&&(p.body=JSON.stringify(c.body)),e.next=11,fetch(c.url,p);case 11:if((h=e.sent).ok&&(n=!0),l=h.status,m=h.headers,!n){e.next=21;break}return e.next=18,h.json();case 18:e.t0=e.sent,e.next=22;break;case 21:e.t0={};case 22:if(v=e.t0,y=v,S={httpStatus:l,isOk:n,statusText:h.statusText},r.send("openApiFetchSuccess",{res:v,name:C,result:S,params:d,body:_,req:c}),!O){e.next=32;break}if(!(T=O(v))){e.next=30;break}return e.abrupt("return",fetchSuccess(T,c,l,h,m));case 30:e.next=41;break;case 32:if(!v.ResponseMetadata){e.next=39;break}if(R=v.Result,k=v.ResponseMetadata,y=k,!R){e.next=37;break}return e.abrupt("return",fetchSuccess(R,c,l,v,m));case 37:e.next=41;break;case 39:if(0!==v.status_code){e.next=41;break}return e.abrupt("return",fetchSuccess(v.data,c,l,v,m));case 41:return e.abrupt("return",fetchFail(handleFetchError(y,h,{mode:(null==I?void 0:I.mode)||MODE.CLOUD_PHONE_GAME}),c,l,v));case 44:if(e.prev=44,e.t1=e.catch(6),!(x<2)){e.next=52;break}return x++,r.send("openApiFetchRetry",{name:C,err:e.t1.toString(),params:d,body:_,req:c,retryCount:x}),e.abrupt("return",L(!0,n));case 52:return r.send("openApiFetchError",{name:C,err:e.t1.toString(),params:d,body:_,req:c}),A="queryQueue"===C?START_ERROR.ERROR_QUEUE_REQUEST_ERROR:n?START_ERROR.ERROR_NET_REQUEST_ERROR:START_ERROR.ERROR_HTTP_REQUEST_ERROR,M=A.CODE,P=A.MESSAGE,e.abrupt("return",fetchFail({errorCode:M,message:P,originalErrorCode:l,originalMessage:n?"unknown network error":null===e.t1||void 0===e.t1?void 0:e.t1.toString(),isNetError:!0,httpStatus:l},c,l));case 56:case"end":return e.stop()}}),e,null,[[6,44]])})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",L(!1));case 10:case"end":return e.stop()}}),e)}))),_fetchBase.apply(this,arguments)}function createObject(e){var t={};for(var r in e)isEmpty$1(e[r])||(t[r]=e[r]);return t}function parseResponseMetadataError(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e&&e.Error){var r=e.Error.CodeN,n=e.Error.Message,i=e.RequestId,o=findStartError(r,t),a=o.errorCode,s=o.message;return{originalErrorCode:r,originalMessage:n,requestId:i,errorCode:a,message:s,success:!1}}return null}function handleFetchError(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{mode:MODE.CLOUD_PHONE_GAME},n=parseResponseMetadataError(e,(null==r?void 0:r.mode)===MODE.CLOUD_PHONE);if(n)return n;var i=t.ok,o=t.status,a=t.statusText,s=i?START_ERROR.ERROR_START_GENERAL:START_ERROR.ERROR_HTTP_REQUEST_ERROR,c=s.CODE,u=s.MESSAGE;return{originalErrorCode:o,originalMessage:a,errorCode:c,message:u,httpStatus:o}}function signAuthorization(e,t,r){var n=t.AccessKeyID,i=t.SecretAccessKey,o=t.SessionToken;new AWSSignersV4(e,r,{isVolcengine:!0}).addAuthorization({accessKeyId:n,secretAccessKey:i,sessionToken:o},new Date)}function fetchReturn(e){var t=e.data,r=void 0===t?null:t,n=e.req,i=e.error,o=void 0===i?null:i,a=e.success,s=void 0===a||a,c=e.httpStatus,u=e.origin,l=e.headers;return{success:s,data:r,error:o,req:n,httpStatus:c,origin:u,headers:void 0===l?null:l}}function fetchSuccess(e,t,r,n,i){return fetchReturn({data:e,req:t,httpStatus:r,origin:n,headers:i})}function fetchFail(e,t,r,n){return fetchReturn({req:t,error:e,success:!1,httpStatus:r,origin:n})}function pickProperties(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r={};return t.forEach((function(t){r[t]=e[t]})),r}function isEmpty$1(e){return null==e||""===e}function checkParamsIsEmpty(e){checkParamsCommon((function(){var t="";for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];if(isEmpty$1(n))t=r;else if(Array.isArray(n))for(var i=0;i<n.length;i++)isEmpty$1(n[i])&&(t=r);if(t)break}return t}))}function checkParamsCommon(e){var t=e();if(t){var r=ERROR_BUILDER.ERROR_SDK_$_EMPTY(t);throw{errorCode:r.CODE,message:r.MESSAGE}}}function fetchInnerApi(e,t){return _fetchInnerApi.apply(this,arguments)}function _fetchInnerApi(){return _fetchInnerApi=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.url,i=t.name,o=t.host,a=t.body,s=void 0===a?"":a,c=t.method,u=void 0===c?"GET":c,l=t.params,d=t.extraRequiredParam,p=t.customHandleReturn,_=t.headers,h=void 0===_?{}:_,f=t.defaultHosts,m=void 0===f?GET_RESOURCE_HOST:f,i||(i=n),e.next=4,fetchBase({token:!1,host:o,defaultHosts:m,url:n,method:u,headers:h,signKey:null,extraRequiredParam:d,body:s,params:l,useCommonParams:!1,customHandleReturn:function(e){if(e.Result)return void 0===e.Result.success&&(e.Result.success=!0),e.Result.responseMetadata=e.ResponseMetadata,e.Result;var t=parseResponseMetadataError(e.ResponseMetadata);return t||(t=0===e.status_code?Object.assign({success:!0},e.data||{}):{originalErrorCode:e.status_code,originalMessage:"",success:!1}),"OK"===(null==e?void 0:e.Msg)&&0===(null==e?void 0:e.StatusCode)?null==e?void 0:e.Data:p?p(t):t},name:i},r);case 4:if(g=e.sent,v=g.success,y=g.data,S=g.error,v){e.next=11;break}throw r.localErrorLog("fetchInnerApi",n,"".concat(i," error:"),S),S;case 11:return e.abrupt("return",y);case 12:case"end":return e.stop()}}),e)}))),_fetchInnerApi.apply(this,arguments)}var SERVICE_VERSION=20220813,SERVER_COMMAND={CMD_INPUT_START:0,CMD_INPUT_SHOW:1,CMD_INPUT_DESTROY:2,CMD_ORIENTATION_IND:3,CMD_MSGSDK:5,CMD_VIBRATOR_START:6,CMD_VIBRATOR_STOP:7,CMD_GAME_OVERDUE:8,CMD_START_LOCATION_REQUEST:9,CMD_STOP_LOCATION_REQUEST:10,CMD_OPEN_CAMERA:11,CMD_AUD_UPSTREAM:12,CMD_MOUSE_STATE:13,CMD_KEYBOARD_STATE:14,CMD_CONTACT:15,CMD_CLIPBOARD:16,CMD_DEVICE_STATUS:18,CMD_CLARITY_INDEX:20,CMD_MSG_CHANNEL:21,CMD_CAMERA_UPSTREAM:22,CMD_USERSTATUS:23,CMD_AUTO_RECYCLE_TIME:24,CMD_PROFILE_STATUS:25,CMD_PROFILE_PATH:26,CMD_LOCATION_UPDATE:28,CMD_FOREGROUND_CHANGE_STATUS:29,CMD_BACKGROUND_APP_LIST:30,CMD_SCREENSHOT_RESPONSE:31,CMD_USER_APP_FRAMEWORK_WARNING:32,CMD_FOCUSED_WINDOW:34,CMD_SHAKE_RESPONSE:37,CMD_SCREENRECORD_RESPONSE:38,CMD_FILE_CHANNEL:39,CMD_KEYBOARD_ENABLE_RESULT:40,CMD_DISLAY_POLICY:42,CMD_TEXT_INPUT_CONTROL:43,CMD_CAMERA_INJECT_STATUS:51,CMD_USER_CONTROL:53,CMD_KEYCODE_TYPE:54,CMD_GENERAL_PURPOSE:512},CLIENT_EVENT_TYPE={EVENT_TYPE_TOUCH:0,EVENT_TYPE_KEY:1,EVENT_TYPE_SENSORS:2,EVENT_TYPE_INPUTMETHOD:3,EVENT_TYPE_ORIENTATION:4,EVENT_TYPE_MSGSDK:5,EVENT_TYPE_APP_MANAGER:6,EVENT_TYPE_USEROFFLINE:7,EVENT_TYPE_USERPAUSE:8,EVENT_TYPE_USERRESUME:9,EVENT_TYPE_GDAP_JOYSTICK:10,EVENT_TYPE_STARTUP:11,EVENT_TYPE_LOCATION:12,EVENT_TYPE_KEYBOARD:13,EVENT_TYPE_MOUSE:14,EVENT_TYPE_CAMERA:15,EVENT_TYPE_CONTACTS:16,EVENT_TYPE_CLIPBOARD:17,EVENT_TYPE_CLARITY_INDEX:20,EVENT_TYPE_MSG_CHANNEL:21,EVENT_TYPE_USERSTATUS:22,EVENT_TYPE_KEEP_ALIVE_TIME:23,EVENT_TYPE_AUTO_RECYCLE_TIME:24,EVENT_TYPE_SET_PROFILE_PATH:25,EVENT_TYPE_GET_PROFILE_PATH:26,EVENT_TYPE_FIX_LOCATION:27,EVENT_TYPE_BRING_BACK_APP:28,EVENT_TYPE_GET_BACKGROUND_APPS:29,EVENT_TYPE_SCREENSHOT:31,EVENT_TYPE_INPUTMETHOD_DIRECT_TEXT:33,EVENT_TYPE_GET_FOCUSED_WINDOW:35,EVENT_TYPE_SHAKE:36,EVENT_TYPE_SCREENRECORD:38,EVENT_TYPE_FILE_CHANNEL:39,EVENT_TYPE_KEYBOARD_ENABLE:40,EVENT_TYPE_DISLAY_POLICY:42,EVENT_TYPE_USER_ROTATION:44,EVENT_TYPE_TEXT_INPUT:45,EVENT_TYPE_VIDEO_PLAY_CAMERA_INJECT:52,EVENT_TYPE_USER_CONTROL:53,EVENT_TYPE_KEYCODE_TYPE:54,EVENT_TYPE_HOSTSTATISTICS:254,EVENT_TEST_DELAY:255,EVENT_TEST_NET:256,EVENT_TYPE_GENERAL_PURPOSE:512},COMMON_TYPE={string:"string",float:"float",double:"double",sint32:"sint32",sint64:"sint64",uint64:"uint64",int32:"int32",uint32:"uint32",int64:"int64",bool:"bool",bytes:"bytes",repeated:function(e){return"repeated ".concat(e)},map:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"string",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"string";return"map ".concat(e," ").concat(t)}};function createPBField(e){var t={},r=1;for(var n in e){var i={id:r++},o=e[n];if(0===o.indexOf("repeated"))i.rule="repeated",i.type=o.replace("repeated","").trim();else if(0===o.indexOf("map")){var a=o.split(" ");i.keyType=a[1],i.type=a[2]}else i.type=o;t[n]=i}return{fields:t}}function createPBTypeValue(e){return{values:e}}var GoogleWrapTypes={DoubleValue:"DoubleValue",FloatValue:"FloatValue",Int64Value:"Int64Value",UInt64Value:"UInt64Value",Int32Value:"Int32Value",UInt32Value:"UInt32Value",BoolValue:"BoolValue",StringValue:"StringValue",BytesValue:"BytesValue"},protoTypes=[COMMON_TYPE.double,COMMON_TYPE.float,COMMON_TYPE.int64,COMMON_TYPE.uint64,COMMON_TYPE.int32,COMMON_TYPE.uint32,COMMON_TYPE.bool,COMMON_TYPE.string,COMMON_TYPE.bytes],GoogleWrapProto={};Object.keys(GoogleWrapTypes).forEach((function(e,t){GoogleWrapProto[e]=createPBField({value:protoTypes[t]})}));var wrapSingle=function(e){return{value:e}},wrapData=commonWrapRead(wrapSingle),readSingle=function(e){return e?e.value:e},readData=commonWrapRead(readSingle),_MSG_FIELDS$4;function commonWrapRead(e){return function(t,r){var n=copyData(t);return r.forEach((function(r){n[r]=e(t[r])})),n}}function copyData(e){var t={};for(var r in e)t[r]=e[r];return t}var CONTROL_ROLE_TYPE={Viewer:0,Player:1},CONTROL_SUBTYPES={ControlStart:0,ControlChange:1,ControlPlayerUpdate:2,ControlNotify:3},MSG_VALUE_NAMES$3={BusinessControlRoleType:"BusinessControlRoleType"},MSG_VALUES$3=_defineProperty$1({},MSG_VALUE_NAMES$3.BusinessControlRoleType,createPBTypeValue(CONTROL_ROLE_TYPE)),MSG_NAMES$3={BusinessControlStart:"BusinessControlStart",BusinessControlChange:"BusinessControlChange",BusinessControlChangeResp:"BusinessControlChangeResp",BusinessControlPlayerUpdate:"BusinessControlPlayerUpdate",BusinessControlNotify:"BusinessControlNotify"},MSG_FIELDS$3=(_MSG_FIELDS$4={},_defineProperty$1(_MSG_FIELDS$4,MSG_NAMES$3.BusinessControlStart,createPBField({role:MSG_VALUE_NAMES$3.BusinessControlRoleType,result:COMMON_TYPE.sint32,players:COMMON_TYPE.repeated(COMMON_TYPE.string)})),_defineProperty$1(_MSG_FIELDS$4,MSG_NAMES$3.BusinessControlChange,createPBField({role:MSG_VALUE_NAMES$3.BusinessControlRoleType,user_id:COMMON_TYPE.string})),_defineProperty$1(_MSG_FIELDS$4,MSG_NAMES$3.BusinessControlChangeResp,createPBField({role:MSG_VALUE_NAMES$3.BusinessControlRoleType,result:COMMON_TYPE.sint32,user_id:COMMON_TYPE.string})),_defineProperty$1(_MSG_FIELDS$4,MSG_NAMES$3.BusinessControlPlayerUpdate,createPBField({players:COMMON_TYPE.repeated(COMMON_TYPE.string)})),_defineProperty$1(_MSG_FIELDS$4,MSG_NAMES$3.BusinessControlNotify,createPBField({role:MSG_VALUE_NAMES$3.BusinessControlRoleType})),_MSG_FIELDS$4),PB_BUSINESS_CONTROL={SUBTYPES:CONTROL_SUBTYPES,MSG_VALUES:MSG_VALUES$3,MSG_VALUE_NAMES:MSG_VALUE_NAMES$3,MSG_NAMES:MSG_NAMES$3,MSG_FIELDS:MSG_FIELDS$3},_MSG_FIELDS$3,SEI_SUBTYPES={MsgBusinessDelayTest:8},SEI_TYPE={Delay_PB:0,VRPoseInfo_JSON:1,Custom_JSON:10},MSG_VALUE_NAMES$2={SeiType:"SeiType",SeiNode:"SeiNode"},MSG_VALUES$2=_defineProperty$1({},MSG_VALUE_NAMES$2.SeiType,createPBTypeValue(SEI_TYPE)),MSG_NAMES$2={BusinessDelayTestClient:"BusinessDelayTestClient",BusinessDelayTestPod:"BusinessDelayTestPod",SeiNode:"SeiNode",SeiList:"SeiList"},MSG_FIELDS$2=(_MSG_FIELDS$3={},_defineProperty$1(_MSG_FIELDS$3,MSG_NAMES$2.BusinessDelayTestClient,createPBField({frames:COMMON_TYPE.int32,check_id:COMMON_TYPE.string})),_defineProperty$1(_MSG_FIELDS$3,MSG_NAMES$2.BusinessDelayTestPod,createPBField({frame_index:COMMON_TYPE.int32,interval_ms:COMMON_TYPE.int64,check_id:COMMON_TYPE.string,has_touch_delay:COMMON_TYPE.bool,min_check_id:COMMON_TYPE.int32,max_check_id:COMMON_TYPE.int32})),_defineProperty$1(_MSG_FIELDS$3,MSG_NAMES$2.SeiNode,createPBField({type:MSG_VALUE_NAMES$2.SeiType,sei_data:COMMON_TYPE.bytes})),_defineProperty$1(_MSG_FIELDS$3,MSG_NAMES$2.SeiList,createPBField({sei_node:COMMON_TYPE.repeated(MSG_VALUE_NAMES$2.SeiNode)})),_MSG_FIELDS$3),PB_BUSINESS_SEI={SUBTYPES:SEI_SUBTYPES,MSG_VALUES:MSG_VALUES$2,MSG_VALUE_NAMES:MSG_VALUE_NAMES$2,MSG_NAMES:MSG_NAMES$2,MSG_FIELDS:MSG_FIELDS$2},_ENUMS,_MSG_FIELDS$2,_BusinessNameMap,MsgNames$2={BusinessClipboard:"BusinessClipboard",BusinessStartUpClient:"BusinessStartUpClient",BusinessAppManager:"BusinessAppManager",BusinessOrientationClient:"BusinessOrientationClient",BusinessOrientationPod:"BusinessOrientationPod",BusinessLocationClient:"BusinessLocationClient",BusinessLocationPod:"BusinessLocationPod",BusinessAppPauseResume:"BusinessAppPauseResume",BusinessUserStatusClient:"BusinessUserStatusClient",BusinessUserStatusPod:"BusinessUserStatusPod",BusinessKeepAliveTimeClient:"BusinessKeepAliveTimeClient",BusinessAutoRecycleTimeClient:"BusinessAutoRecycleTimeClient",BusinessAutoRecycleTimePod:"BusinessAutoRecycleTimePod",BusinessUserProfileClient:"BusinessUserProfileClient",BusinessUserProfilePod:"BusinessUserProfilePod",BusinessBackgroundAppClient:"BusinessBackgroundAppClient",BusinessBackgroundAppPod:"BusinessBackgroundAppPod",BusinessScreenshotClient:"BusinessScreenshotClient",BusinessScreenshotPod:"BusinessScreenshotPod",BusinessMsgChannel:"BusinessMsgChannel",BusinessDelayTestClient:"BusinessDelayTestClient",BusinessFocusWindowClient:"BusinessFocusWindowClient",BusinessFocusWindowPod:"BusinessFocusWindowPod",BusinessShakeClient:"BusinessShakeClient",BusinessShakePod:"BusinessShakePod",BusinessScreenRecordClient:"BusinessScreenRecordClient",BusinessScreenRecordPod:"BusinessScreenRecordPod",BusinessFileChannelClient:"BusinessFileChannelClient",BusinessFileChannelPod:"BusinessFileChannelPod",BusinessSessionClosePod:"BusinessSessionClosePod",SessionMode:"BusinessSessionMode",SessionModeResp:"BusinessSessionModeResp",PodStreamChange:"BusinessPodStreamChange",PodStreamChangeResp:"BusinessPodStreamChangeResp",Shield:"BusinessShield",BusinessMsgChannelBinary:"BusinessMsgChannelBinary"},EnumNames$3={AppManagerAction:"AppManagerAction",OrientationType:"OrientationType",Action:"Action",BackgroundAppAction:"BackgroundAppAction",SessionCloseReasonPod:"SessionCloseReasonPod"},CommonConfig$2={ENUMS:(_ENUMS={},_defineProperty$1(_ENUMS,EnumNames$3.AppManagerAction,createPBTypeValue({AppStop:0,AppStart:1,AppRestart:2})),_defineProperty$1(_ENUMS,EnumNames$3.OrientationType,createPBTypeValue({ROTATION_0:0,ROTATION_90:90,ROTATION_180:180,ROTATION_270:270})),_defineProperty$1(_ENUMS,EnumNames$3.Action,createPBTypeValue({pause:0,resume:1})),_defineProperty$1(_ENUMS,EnumNames$3.BackgroundAppAction,createPBTypeValue({BringToFront:0,GetList:1})),_defineProperty$1(_ENUMS,EnumNames$3.SessionCloseReasonPod,createPBTypeValue({GameCrash:0,NoTouch:3,PaasStop:5,BackgroundRtcDisconnectTimeout:6,GameExit:7,ReserveTimeout:8})),_ENUMS),MSG_FIELDS:(_MSG_FIELDS$2={},_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessStartUpClient,createPBField({local_capabilities:COMMON_TYPE.int64})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessClipboard,createPBField({mime_type:COMMON_TYPE.string,clip_data:COMMON_TYPE.repeated(COMMON_TYPE.string)})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessAppManager,createPBField({action:EnumNames$3.AppManagerAction,package_name:COMMON_TYPE.string})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessOrientationClient,createPBField({reserved:COMMON_TYPE.int32})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessOrientationPod,createPBField({orientation:EnumNames$3.OrientationType,tempt:COMMON_TYPE.bool})),_defineProperty$1(_MSG_FIELDS$2,"GnssSvInfo",createPBField({types:COMMON_TYPE.repeated(COMMON_TYPE.int32),prn:COMMON_TYPE.repeated(COMMON_TYPE.int32),snr:COMMON_TYPE.repeated(COMMON_TYPE.float),azimuths:COMMON_TYPE.repeated(COMMON_TYPE.float),gnss_flags:COMMON_TYPE.repeated(COMMON_TYPE.int32),cn0dbhz:COMMON_TYPE.repeated(COMMON_TYPE.float),elevations:COMMON_TYPE.repeated(COMMON_TYPE.float),svids:COMMON_TYPE.repeated(COMMON_TYPE.int32)})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessLocationClient,createPBField({provider:COMMON_TYPE.string,time:COMMON_TYPE.int64,elapsed_realtime_nanos:COMMON_TYPE.float,latitude:COMMON_TYPE.float,altitude:COMMON_TYPE.float,longitude:COMMON_TYPE.float,speed:COMMON_TYPE.float,bearing:COMMON_TYPE.float,accuracy_meters:COMMON_TYPE.float,vertical_accuracy_meters:COMMON_TYPE.float,speed_accuracy_meters_per_second:COMMON_TYPE.float,bearing_accuracy_degrees:COMMON_TYPE.float,gnss_sv_info:"GnssSvInfo",nmea:COMMON_TYPE.repeated(COMMON_TYPE.string)})),_defineProperty$1(_MSG_FIELDS$2,"StartAction",createPBTypeValue({start:0,stop:1})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessLocationPod,createPBField({action:"StartAction",provider:COMMON_TYPE.string,package_name:COMMON_TYPE.string,quality:COMMON_TYPE.int32,interval:COMMON_TYPE.int64,fastest_interval:COMMON_TYPE.int64,expire_at:COMMON_TYPE.int64,num_updates:COMMON_TYPE.int32,smallest_displacement:COMMON_TYPE.float})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessAppPauseResume,createPBField({action:EnumNames$3.Action})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessUserStatusClient,createPBField({reason:COMMON_TYPE.int32})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessUserStatusPod,createPBField({result:COMMON_TYPE.int32,from:COMMON_TYPE.int32,current:COMMON_TYPE.int32})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessKeepAliveTimeClient,createPBField({duration_seconds:COMMON_TYPE.int64})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessAutoRecycleTimeClient,createPBField({action:EnumNames$3.Action,duration_seconds:COMMON_TYPE.int64})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessAutoRecycleTimePod,createPBField({action:EnumNames$3.Action,result:COMMON_TYPE.int32,current:COMMON_TYPE.int32})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessUserProfileClient,createPBField({action:EnumNames$3.Action,path:COMMON_TYPE.repeated(COMMON_TYPE.string),reason:COMMON_TYPE.int32})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessUserProfilePod,createPBField({action:EnumNames$3.Action,path:COMMON_TYPE.repeated(COMMON_TYPE.string),result:COMMON_TYPE.int32,type:COMMON_TYPE.int32})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessBackgroundAppClient,createPBField({action:EnumNames$3.BackgroundAppAction,package_name:COMMON_TYPE.string,reason:COMMON_TYPE.int32})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessBackgroundAppPod,createPBField({action:EnumNames$3.BackgroundAppAction,result:COMMON_TYPE.int32,foreground:COMMON_TYPE.int32,package_name:COMMON_TYPE.string,app_list:COMMON_TYPE.repeated(COMMON_TYPE.string)})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessScreenshotClient,createPBField({sequence:COMMON_TYPE.string})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessScreenshotPod,createPBField({result:COMMON_TYPE.int32,sequence:COMMON_TYPE.string,save_path:COMMON_TYPE.string})),_defineProperty$1(_MSG_FIELDS$2,"MsgChannelMsg",createPBField({mid:COMMON_TYPE.string,text:COMMON_TYPE.string,time_ms:COMMON_TYPE.int64})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessMsgChannel,createPBField({payload:"MsgChannelMsg",type:COMMON_TYPE.int32,user_id:COMMON_TYPE.string,ack_id:COMMON_TYPE.string,version:COMMON_TYPE.string,dest_user_id:COMMON_TYPE.string})),_defineProperty$1(_MSG_FIELDS$2,"MsgChannelMsgBinary",createPBField({mid:COMMON_TYPE.string,data:COMMON_TYPE.bytes,time_ms:COMMON_TYPE.int64})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessMsgChannelBinary,createPBField({payload:"MsgChannelMsgBinary",type:COMMON_TYPE.int32,user_id:COMMON_TYPE.string,ack_id:COMMON_TYPE.string,version:COMMON_TYPE.string,dest_user_id:COMMON_TYPE.string})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessDelayTestClient,createPBField({frames:COMMON_TYPE.int32,check_id:COMMON_TYPE.string})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessFocusWindowClient,createPBField({uid:COMMON_TYPE.string,sequence:COMMON_TYPE.string})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessFocusWindowPod,createPBField({package_name:COMMON_TYPE.string,result:COMMON_TYPE.int32,sequence:COMMON_TYPE.string})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessShakeClient,createPBField({duration_ms:COMMON_TYPE.int64})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessShakePod,createPBField({result:COMMON_TYPE.int32,message:COMMON_TYPE.string})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessScreenRecordClient,createPBField({action:EnumNames$3.Action,duration:COMMON_TYPE.int64})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessScreenRecordPod,createPBField({status:COMMON_TYPE.int32,save_path:COMMON_TYPE.string})),_defineProperty$1(_MSG_FIELDS$2,"Carries",createPBField({folder:COMMON_TYPE.string,name:COMMON_TYPE.string,md5:COMMON_TYPE.string,expires:GoogleWrapTypes.Int64Value})),_defineProperty$1(_MSG_FIELDS$2,"CloudStorage",createPBField({ak:COMMON_TYPE.string,sk:COMMON_TYPE.string,bucket:COMMON_TYPE.string,region:COMMON_TYPE.string,endpoint:COMMON_TYPE.string,security_token:COMMON_TYPE.string,object:COMMON_TYPE.string})),_defineProperty$1(_MSG_FIELDS$2,"PodCarries",createPBField({result:GoogleWrapTypes.Int32Value,progress:GoogleWrapTypes.Int32Value,folder:COMMON_TYPE.string,name:COMMON_TYPE.string,url:COMMON_TYPE.string,md5:COMMON_TYPE.string,cloud_storage:"CloudStorage",options:COMMON_TYPE.map()})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessFileChannelClient,createPBField({action:COMMON_TYPE.int32,carries:"Carries"})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessFileChannelPod,createPBField({action:COMMON_TYPE.int32,carries:"PodCarries"})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.BusinessSessionClosePod,createPBField({reason:EnumNames$3.SessionCloseReasonPod,package_name:COMMON_TYPE.string})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.SessionMode,createPBField({sessionMode:GoogleWrapTypes.Int32Value})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.SessionModeResp,createPBField({sessionMode:COMMON_TYPE.int32,result:COMMON_TYPE.bool})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.PodStreamChange,createPBField({status:GoogleWrapTypes.Int32Value})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.PodStreamChangeResp,createPBField({status:COMMON_TYPE.int32,result:COMMON_TYPE.bool})),_defineProperty$1(_MSG_FIELDS$2,MsgNames$2.Shield,createPBField({type:COMMON_TYPE.int32,subType:COMMON_TYPE.int32})),_MSG_FIELDS$2),SUBTYPES:{StartUp:10,Clipboard:11,AppManager:5,MsgBusinessOrientation:4,Location:28,AppPauseResume:30,UserStatus:12,MsgBusinessKeepAliveTime:13,MsgBusinessAutoRecycleTime:14,MsgBusinessUserProfile:15,MsgBusinessBackgroundApp:16,MsgBusinessScreenshot:18,MsgBusinessMsgChannel:26,MsgBusinessDelayTest:8,MsgBusinessSessionClose:7,MsgBusinessFocusWindow:22,MsgBusinessShake:24,MsgBusinessScreenRecord:29,MsgBusinessFileChannel:33,MsgBusinessSessionMode:37,MsgBusinessPodStreamChange:38,MsgBusinessShield:39,MsgBusinessBinaryMsgChannel:42}},PB_BUSINESS={SUBTYPES:_objectSpread2(_objectSpread2(_objectSpread2({},PB_BUSINESS_CONTROL.SUBTYPES),PB_BUSINESS_SEI.SUBTYPES),CommonConfig$2.SUBTYPES),MSG_VALUES:_objectSpread2(_objectSpread2(_objectSpread2({},PB_BUSINESS_CONTROL.MSG_VALUES),PB_BUSINESS_SEI.MSG_VALUES),CommonConfig$2.ENUMS),MSG_VALUE_NAMES:_objectSpread2(_objectSpread2(_objectSpread2({},PB_BUSINESS_CONTROL.MSG_VALUE_NAMES),PB_BUSINESS_SEI.MSG_VALUE_NAMES),EnumNames$3),MSG_NAMES:_objectSpread2(_objectSpread2(_objectSpread2({},PB_BUSINESS_CONTROL.MSG_NAMES),PB_BUSINESS_SEI.MSG_NAMES),MsgNames$2),MSG_FIELDS:_objectSpread2(_objectSpread2(_objectSpread2({},PB_BUSINESS_CONTROL.MSG_FIELDS),PB_BUSINESS_SEI.MSG_FIELDS),CommonConfig$2.MSG_FIELDS)},ST=PB_BUSINESS.SUBTYPES,MN=PB_BUSINESS.MSG_NAMES,BusinessNameMap=(_BusinessNameMap={},_defineProperty$1(_BusinessNameMap,ST.Clipboard,MN.BusinessClipboard),_defineProperty$1(_BusinessNameMap,ST.AppManager,MN.BusinessAppManager),_defineProperty$1(_BusinessNameMap,ST.MsgBusinessOrientation,MN.BusinessOrientationPod),_defineProperty$1(_BusinessNameMap,ST.Location,MN.BusinessLocationPod),_defineProperty$1(_BusinessNameMap,ST.UserStatus,MN.BusinessUserStatusPod),_defineProperty$1(_BusinessNameMap,ST.MsgBusinessAutoRecycleTime,MN.BusinessAutoRecycleTimePod),_defineProperty$1(_BusinessNameMap,ST.MsgBusinessUserProfile,MN.BusinessUserProfilePod),_defineProperty$1(_BusinessNameMap,ST.MsgBusinessBackgroundApp,MN.BusinessBackgroundAppPod),_defineProperty$1(_BusinessNameMap,ST.MsgBusinessScreenshot,MN.BusinessScreenshotPod),_defineProperty$1(_BusinessNameMap,ST.MsgBusinessMsgChannel,MN.BusinessMsgChannel),_defineProperty$1(_BusinessNameMap,ST.MsgBusinessDelayTest,PB_BUSINESS_SEI.MSG_NAMES.SeiList),_defineProperty$1(_BusinessNameMap,ST.MsgBusinessSessionClose,MN.BusinessSessionClosePod),_defineProperty$1(_BusinessNameMap,ST.MsgBusinessFocusWindow,MN.BusinessFocusWindowPod),_defineProperty$1(_BusinessNameMap,ST.MsgBusinessShake,MN.BusinessShakePod),_defineProperty$1(_BusinessNameMap,ST.MsgBusinessScreenRecord,MN.BusinessScreenRecordPod),_defineProperty$1(_BusinessNameMap,ST.MsgBusinessFileChannel,MN.BusinessFileChannelPod),_defineProperty$1(_BusinessNameMap,ST.ControlChange,PB_BUSINESS_CONTROL.MSG_NAMES.BusinessControlChangeResp),_defineProperty$1(_BusinessNameMap,ST.ControlNotify,PB_BUSINESS_CONTROL.MSG_NAMES.BusinessControlNotify),_defineProperty$1(_BusinessNameMap,ST.ControlPlayerUpdate,PB_BUSINESS_CONTROL.MSG_NAMES.BusinessControlPlayerUpdate),_defineProperty$1(_BusinessNameMap,ST.ControlStart,PB_BUSINESS_CONTROL.MSG_NAMES.BusinessControlStart),_defineProperty$1(_BusinessNameMap,ST.MsgBusinessSessionMode,MN.SessionModeResp),_defineProperty$1(_BusinessNameMap,ST.MsgBusinessPodStreamChange,MN.PodStreamChangeResp),_defineProperty$1(_BusinessNameMap,ST.MsgBusinessShield,MN.Shield),_defineProperty$1(_BusinessNameMap,ST.MsgBusinessBinaryMsgChannel,MN.BusinessMsgChannelBinary),_BusinessNameMap),_MSG_FIELDS$1,MsgNames$1={IMEControl:"IMEControl",IMEData:"IMEData"},EnumNames$2={IMEControlType:"IMEControlType"},CommonConfig$1={ENUMS:_defineProperty$1({},EnumNames$2.IMEControlType,createPBTypeValue({IMEStart:0,IMEShow:1,IMEDestroy:2,IMEAllow:3})),MSG_FIELDS:(_MSG_FIELDS$1={},_defineProperty$1(_MSG_FIELDS$1,MsgNames$1.IMEControl,createPBField({type:EnumNames$2.IMEControlType,version:GoogleWrapTypes.Int32Value,input_type:GoogleWrapTypes.Int32Value,ime_options:GoogleWrapTypes.Int32Value,selection_start:GoogleWrapTypes.Int32Value,selection_end:GoogleWrapTypes.Int32Value,action_id:GoogleWrapTypes.Int32Value,current_text:COMMON_TYPE.string,action_label:COMMON_TYPE.string,hint_text:COMMON_TYPE.string,package_name:COMMON_TYPE.string,is_allow:GoogleWrapTypes.BoolValue})),_defineProperty$1(_MSG_FIELDS$1,MsgNames$1.IMEData,createPBField({version:GoogleWrapTypes.Int32Value,selection_start:GoogleWrapTypes.Int32Value,selection_end:GoogleWrapTypes.Int32Value,action_id:GoogleWrapTypes.Int32Value,key_code:GoogleWrapTypes.Int32Value,key_action:GoogleWrapTypes.Int32Value,encoder:COMMON_TYPE.string,char_sequence:COMMON_TYPE.string,direct_input:GoogleWrapTypes.BoolValue,visibility:GoogleWrapTypes.BoolValue})),_MSG_FIELDS$1),SUBTYPES:{MsgIMEControl:0,MsgIMEData:1}},PB_IME={SUBTYPES:_objectSpread2({},CommonConfig$1.SUBTYPES),MSG_VALUES:_objectSpread2({},CommonConfig$1.ENUMS),MSG_VALUE_NAMES:_objectSpread2({},EnumNames$2),MSG_NAMES:_objectSpread2({},MsgNames$1),MSG_FIELDS:_objectSpread2({},CommonConfig$1.MSG_FIELDS)},IMENameMap=_defineProperty$1({},CommonConfig$1.SUBTYPES.MsgIMEControl,MsgNames$1.IMEControl),IME_COMPOSITION_TYPE={ImeCompositionBegin:0,ImeCompositionEnd:1,ImeComposition:2},IME_INPUT_SUBTYPES={MsgInputImeComposition:0},MSG_VALUE_NAMES$1={ImeCompositionType:"ImeCompositionType"},MSG_VALUES$1=_defineProperty$1({},MSG_VALUE_NAMES$1.ImeCompositionType,createPBTypeValue(IME_COMPOSITION_TYPE)),MSG_NAMES$1={InputImeComposition:"InputImeComposition"},MSG_FIELDS$1=_defineProperty$1({},MSG_NAMES$1.InputImeComposition,createPBField({type:MSG_VALUE_NAMES$1.ImeCompositionType,str:COMMON_TYPE.string})),PB_INPUT_IME={SUBTYPES:IME_INPUT_SUBTYPES,MSG_VALUES:MSG_VALUES$1,MSG_VALUE_NAMES:MSG_VALUE_NAMES$1,MSG_NAMES:MSG_NAMES$1,MSG_FIELDS:MSG_FIELDS$1},_MSG_FIELDS,_SUBTYPES,MsgNames={InputMouseARM:"InputMouseARM",InputKeyARM:"InputKeyARM",InputGCGamePad:"InputGCGamePad",InputTouchARM:"InputTouchARM",InputTouchARMArray:"InputTouchARMArray"},EnumNames$1={MouseKeyType:"MouseKeyType",AVVideoFormatLevelType:"AVVideoFormatLevelType"},CommonConfig={ENUMS:{},MSG_FIELDS:(_MSG_FIELDS={},_defineProperty$1(_MSG_FIELDS,MsgNames.InputMouseARM,createPBField({x:COMMON_TYPE.float,y:COMMON_TYPE.float,action:COMMON_TYPE.int32,axis_v:COMMON_TYPE.float,axis_h:COMMON_TYPE.float,key:EnumNames$1.MouseKeyType})),_defineProperty$1(_MSG_FIELDS,MsgNames.InputKeyARM,createPBField({key_code:COMMON_TYPE.int32,action:COMMON_TYPE.int32,value:COMMON_TYPE.string})),_defineProperty$1(_MSG_FIELDS,MsgNames.InputGCGamePad,createPBField({index:COMMON_TYPE.sint32,buttons:COMMON_TYPE.sint32,lt:COMMON_TYPE.sint32,rt:COMMON_TYPE.sint32,lx:COMMON_TYPE.sint32,ly:COMMON_TYPE.sint32,rx:COMMON_TYPE.sint32,ry:COMMON_TYPE.sint32,key:COMMON_TYPE.sint32,action:COMMON_TYPE.sint32})),_defineProperty$1(_MSG_FIELDS,MsgNames.InputTouchARM,createPBField({x:COMMON_TYPE.float,y:COMMON_TYPE.float,action:COMMON_TYPE.int32,pointer_id:COMMON_TYPE.int32})),_defineProperty$1(_MSG_FIELDS,MsgNames.InputTouchARMArray,createPBField({touches:COMMON_TYPE.repeated(MsgNames.InputTouchARM),check_id:COMMON_TYPE.int32})),_MSG_FIELDS),SUBTYPES:(_SUBTYPES={},_defineProperty$1(_SUBTYPES,MsgNames.InputKeyARM,9),_defineProperty$1(_SUBTYPES,MsgNames.InputMouseARM,10),_defineProperty$1(_SUBTYPES,MsgNames.InputGCGamePad,6),_defineProperty$1(_SUBTYPES,MsgNames.InputTouchARM,8),_SUBTYPES)},PB_INPUT={SUBTYPES:_objectSpread2(_objectSpread2({},PB_INPUT_IME.SUBTYPES),CommonConfig.SUBTYPES),MSG_VALUES:_objectSpread2(_objectSpread2({},PB_INPUT_IME.MSG_VALUES),CommonConfig.ENUMS),MSG_VALUE_NAMES:_objectSpread2(_objectSpread2({},PB_INPUT_IME.MSG_VALUE_NAMES),EnumNames$1),MSG_NAMES:_objectSpread2(_objectSpread2({},PB_INPUT_IME.MSG_NAMES),MsgNames),MSG_FIELDS:_objectSpread2(_objectSpread2({},PB_INPUT_IME.MSG_FIELDS),CommonConfig.MSG_FIELDS)},IME_OUTPUT_SUBTYPES={MsgOutputImeState:0},MSG_VALUE_NAMES={},MSG_VALUES={},MSG_NAMES={OutputImeState:"OutputImeState"},MSG_FIELDS=_defineProperty$1({},MSG_NAMES.OutputImeState,createPBField({state:COMMON_TYPE.bool,w:COMMON_TYPE.sint32,h:COMMON_TYPE.sint32,x:COMMON_TYPE.sint32,y:COMMON_TYPE.sint32,fw:COMMON_TYPE.sint32,fh:COMMON_TYPE.sint32})),PB_OUTPUT_IME={SUBTYPES:IME_OUTPUT_SUBTYPES,MSG_VALUES:MSG_VALUES,MSG_VALUE_NAMES:MSG_VALUE_NAMES,MSG_NAMES:MSG_NAMES,MSG_FIELDS:MSG_FIELDS},MsgOutputType={MsgOutputCursorPos:2,MsgOutputGCVibration:5},OutputNames={OutputCursorPos:"OutputCursorPos",OutputGCVibration:"OutputGCVibration"},OutputFields=_defineProperty$1({},OutputNames.OutputGCVibration,createPBField({index:COMMON_TYPE.sint32,l:COMMON_TYPE.sint32,r:COMMON_TYPE.sint32})),PB_OUTPUT={SUBTYPES:_objectSpread2(_objectSpread2({},PB_OUTPUT_IME.SUBTYPES),MsgOutputType),MSG_VALUES:_objectSpread2({},PB_OUTPUT_IME.MSG_VALUES),MSG_VALUE_NAMES:_objectSpread2({},PB_OUTPUT_IME.MSG_VALUE_NAMES),MSG_NAMES:_objectSpread2(_objectSpread2({},PB_OUTPUT_IME.MSG_NAMES),OutputNames),MSG_FIELDS:_objectSpread2(_objectSpread2({},PB_OUTPUT_IME.MSG_FIELDS),OutputFields)},_PBDecodeMap,TYPES={MsgRaw:0,MsgHeartBeat:1,MsgState:2,MsgDevice:3,MsgAVInput:4,MsgAVOutput:5,MsgInput:6,MsgOutput:7,MsgSensors:8,MsgXR:9,MsgIME:10,MsgBusiness:66,MsgVR:100},MsgAVOutputType={MsgAVOutputAudioParams:0,MsgAVOutputAudioFormatLevel:1,MsgAVOutputAudio:2,MsgAVOutputVideoParams:10,MsgAVOutputVideoFormatLevel:11,MsgAVOutputVideo:12,MsgAVOutputVideoSceneChange:13},EnumNames={SensorType:"SensorType"},Enums=_defineProperty$1({},EnumNames.SensorType,createPBTypeValue({SensorLocation:0,SensorAcceleration:1,SensorGravity:2,SensorAttitude:3,SensorGyro:4,SensorMagnetic:5,SensorProximity:6,SensorPedometer:7,SensorAltitude:8,SensorPressure:9,SensorLight:10,SensorTemprature:11})),createXYZ=function(){return createPBField({x:COMMON_TYPE.float,y:COMMON_TYPE.float,z:COMMON_TYPE.float})},CommonFields={SensorData:createPBField({type:EnumNames.SensorType,data:COMMON_TYPE.bytes}),SensorDataLocation:createPBField({longitude:COMMON_TYPE.float,latitude:COMMON_TYPE.float}),SensorDataAcceleration:createXYZ(),SensorDataGravity:createXYZ(),SensorDataAttitude:createXYZ(),SensorDataGyro:createXYZ(),SensorDataMagnetic:createXYZ(),SensorDataProximity:createPBField({state:COMMON_TYPE.bool})},CommonSubTypes={MsgSensorControl:0,MsgSensorData:1},PB_MESSAGE={TYPES:TYPES,SUBTYPES:_objectSpread2(_objectSpread2(_objectSpread2(_objectSpread2(_objectSpread2(_objectSpread2({},PB_BUSINESS.SUBTYPES),PB_INPUT.SUBTYPES),PB_OUTPUT.SUBTYPES),PB_IME.SUBTYPES),MsgAVOutputType),CommonSubTypes),MSG_VALUES:_objectSpread2(_objectSpread2(_objectSpread2(_objectSpread2(_objectSpread2({},PB_BUSINESS.MSG_VALUES),PB_INPUT.MSG_VALUES),PB_OUTPUT.MSG_VALUES),PB_IME.MSG_VALUES),Enums),MSG_VALUE_NAMES:_objectSpread2(_objectSpread2(_objectSpread2(_objectSpread2(_objectSpread2({},PB_BUSINESS.MSG_VALUE_NAMES),PB_INPUT.MSG_VALUE_NAMES),PB_OUTPUT.MSG_VALUE_NAMES),PB_IME.MSG_VALUE_NAMES),EnumNames),MSG_NAMES:_objectSpread2(_objectSpread2(_objectSpread2(_objectSpread2({},PB_BUSINESS.MSG_NAMES),PB_INPUT.MSG_NAMES),PB_OUTPUT.MSG_NAMES),PB_IME.MSG_NAMES),MSG_FIELDS:_objectSpread2(_objectSpread2(_objectSpread2(_objectSpread2(_objectSpread2({},PB_BUSINESS.MSG_FIELDS),PB_INPUT.MSG_FIELDS),PB_OUTPUT.MSG_FIELDS),PB_IME.MSG_FIELDS),CommonFields)},PBT=PB_MESSAGE.TYPES,PBDecodeMap=(_PBDecodeMap={},_defineProperty$1(_PBDecodeMap,PBT.MsgBusiness,BusinessNameMap),_defineProperty$1(_PBDecodeMap,PBT.MsgIME,IMENameMap),_PBDecodeMap),indexMinimal={},minimal$1={},aspromise=asPromise;function asPromise(e,t){for(var r=new Array(arguments.length-1),n=0,i=2,o=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise((function(i,a){r[n]=function(e){if(o)if(o=!1,e)a(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(s){o&&(o=!1,a(s))}}))}var base64$1={};!function(e){var t=e;t.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var r=new Array(64),n=new Array(123),i=0;i<64;)n[r[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;t.encode=function(e,t,n){for(var i,o=null,a=[],s=0,c=0;t<n;){var u=e[t++];switch(c){case 0:a[s++]=r[u>>2],i=(3&u)<<4,c=1;break;case 1:a[s++]=r[i|u>>4],i=(15&u)<<2,c=2;break;case 2:a[s++]=r[i|u>>6],a[s++]=r[63&u],c=0}s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0)}return c&&(a[s++]=r[i],a[s++]=61,1===c&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))};var o="invalid encoding";t.decode=function(e,t,r){for(var i,a=r,s=0,c=0;c<e.length;){var u=e.charCodeAt(c++);if(61===u&&s>1)break;if(void 0===(u=n[u]))throw Error(o);switch(s){case 0:i=u,s=1;break;case 1:t[r++]=i<<2|(48&u)>>4,i=u,s=2;break;case 2:t[r++]=(15&i)<<4|(60&u)>>2,i=u,s=3;break;case 3:t[r++]=(3&i)<<6|u,s=0}}if(1===s)throw Error(o);return r-a},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}(base64$1);var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},EventEmitter.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},EventEmitter.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this};var float=factory(factory);function factory(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function o(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function s(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:o,e.writeFloatBE=n?o:i,e.readFloatLE=n?a:s,e.readFloatBE=n?s:a}():function(){function t(e,t,r,n){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,r,n)}}function r(e,t,r){var n=e(t,r),i=2*(n>>31)+1,o=n>>>23&255,a=8388607&n;return 255===o?a?NaN:i*(1/0):0===o?1401298464324817e-60*i*a:i*Math.pow(2,o-150)*(a+8388608)}e.writeFloatLE=t.bind(null,writeUintLE),e.writeFloatBE=t.bind(null,writeUintBE),e.readFloatLE=r.bind(null,readUintLE),e.readFloatBE=r.bind(null,readUintBE)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function o(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function s(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:o,e.writeDoubleBE=n?o:i,e.readDoubleLE=n?a:s,e.readDoubleBE=n?s:a}():function(){function t(e,t,r,n,i,o){var a=n<0?1:0;if(a&&(n=-n),0===n)e(0,i,o+t),e(1/n>0?0:2147483648,i,o+r);else if(isNaN(n))e(0,i,o+t),e(2146959360,i,o+r);else if(n>17976931348623157e292)e(0,i,o+t),e((a<<31|2146435072)>>>0,i,o+r);else{var s;if(n<22250738585072014e-324)e((s=n/5e-324)>>>0,i,o+t),e((a<<31|s/4294967296)>>>0,i,o+r);else{var c=Math.floor(Math.log(n)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(s=n*Math.pow(2,-c))>>>0,i,o+t),e((a<<31|c+1023<<20|1048576*s&1048575)>>>0,i,o+r)}}}function r(e,t,r,n,i){var o=e(n,i+t),a=e(n,i+r),s=2*(a>>31)+1,c=a>>>20&2047,u=4294967296*(1048575&a)+o;return 2047===c?u?NaN:s*(1/0):0===c?5e-324*s*u:s*Math.pow(2,c-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,writeUintLE,0,4),e.writeDoubleBE=t.bind(null,writeUintBE,4,0),e.readDoubleLE=r.bind(null,readUintLE,0,4),e.readDoubleBE=r.bind(null,readUintBE,4,0)}(),e}function writeUintLE(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function writeUintBE(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function readUintLE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function readUintBE(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e2){}return null}var utf8$2={};!function(e){var t=e;t.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},t.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,o=[],a=0;t<r;)(n=e[t++])<128?o[a++]=n:n>191&&n<224?o[a++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[a++]=55296+(n>>10),o[a++]=56320+(1023&n)):o[a++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))},t.write=function(e,t,r){for(var n,i,o=r,a=0;a<e.length;++a)(n=e.charCodeAt(a))<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(i=e.charCodeAt(a+1)))?(n=65536+((1023&n)<<10)+(1023&i),++a,t[r++]=n>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128);return r-o}}(utf8$2);var pool_1=pool,longbits,hasRequiredLongbits,hasRequiredMinimal;function pool(e,t,r){var n=r||8192,i=n>>>1,o=null,a=n;return function(r){if(r<1||r>i)return e(r);a+r>n&&(o=e(n),a=0);var s=t.call(o,a,a+=r);return 7&a&&(a=1+(7|a)),s}}function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var e=requireMinimal();function t(e,t){this.lo=e>>>0,this.hi=t>>>0}var r=t.zero=new t(0,0);r.toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1};var n=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(e){if(0===e)return r;var n=e<0;n&&(e=-e);var i=e>>>0,o=(e-i)/4294967296>>>0;return n&&(o=~o>>>0,i=~i>>>0,++i>4294967295&&(i=0,++o>4294967295&&(o=0))),new t(i,o)},t.from=function(n){if("number"==typeof n)return t.fromNumber(n);if(e.isString(n)){if(!e.Long)return t.fromNumber(parseInt(n,10));n=e.Long.fromString(n)}return n.low||n.high?new t(n.low>>>0,n.high>>>0):r},t.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},t.prototype.toLong=function(t){return e.Long?new e.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var i=String.prototype.charCodeAt;return t.fromHash=function(e){return e===n?r:new t((i.call(e,0)|i.call(e,1)<<8|i.call(e,2)<<16|i.call(e,3)<<24)>>>0,(i.call(e,4)|i.call(e,5)<<8|i.call(e,6)<<16|i.call(e,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},t.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},t.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10},longbits}function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(e){var t=e;function r(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function n(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&r(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}t.asPromise=aspromise,t.base64=base64$1,t.EventEmitter=eventemitter,t.float=float,t.inquire=inquire_1,t.utf8=utf8$2,t.pool=pool_1,t.LongBits=requireLongbits(),t.isNode=Boolean(void 0!==commonjsGlobal&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),t.global=t.isNode&&commonjsGlobal||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||commonjsGlobal,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"===_typeof(e)},t.isset=t.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!==_typeof(r)||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e2){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,r){var n=t.LongBits.fromHash(e);return t.Long?t.Long.fromBits(n.lo,n.hi,r):n.toNumber(Boolean(r))},t.merge=r,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=n,t.ProtocolError=n("ProtocolError"),t.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},t.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}}(minimal$1)),minimal$1}var writer$2=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function noop(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};function writeByte(e,t,r){t[r]=255&e}function writeVarint32(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}function writeVarint64(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function writeFixed32(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}Writer$1.create=create$1(),Writer$1.alloc=function(e){return new util$4.Array(e)},util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray)),Writer$1.prototype._push=function(e,t,r){return this.tail=this.tail.next=new Op(e,t,r),this.len+=t,this},VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer$1.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},Writer$1.prototype.int32=function(e){return e<0?this._push(writeVarint64,10,LongBits$1.fromNumber(e)):this.uint32(e)},Writer$1.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Writer$1.prototype.uint64=function(e){var t=LongBits$1.from(e);return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.int64=Writer$1.prototype.uint64,Writer$1.prototype.sint64=function(e){var t=LongBits$1.from(e).zzEncode();return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.bool=function(e){return this._push(writeByte,1,e?1:0)},Writer$1.prototype.fixed32=function(e){return this._push(writeFixed32,4,e>>>0)},Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32,Writer$1.prototype.fixed64=function(e){var t=LongBits$1.from(e);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)},Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64,Writer$1.prototype.float=function(e){return this._push(util$4.float.writeFloatLE,4,e)},Writer$1.prototype.double=function(e){return this._push(util$4.float.writeDoubleLE,8,e)};var writeBytes=util$4.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};Writer$1.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(writeByte,1,0);if(util$4.isString(e)){var r=Writer$1.alloc(t=base64.length(e));base64.decode(e,r,0),e=r}return this.uint32(t)._push(writeBytes,t,e)},Writer$1.prototype.string=function(e){var t=utf8$1.length(e);return t?this.uint32(t)._push(utf8$1.write,t,e):this._push(writeByte,1,0)},Writer$1.prototype.fork=function(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer$1.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer$1.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},Writer$1.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},Writer$1._configure=function(e){BufferWriter$1=e,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer$2;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}function writeStringBuffer(e,t,r){e.length<40?util$3.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&"set"===util$3.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},BufferWriter.prototype.bytes=function(e){util$3.isString(e)&&(e=util$3._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(BufferWriter.writeBytesBuffer,t,e),this},BufferWriter.prototype.string=function(e){var t=util$3.Buffer.byteLength(e);return this.uint32(t),t&&this._push(writeStringBuffer,t,e),this},BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader$1(e){this.buf=e,this.pos=0,this.len=e.length}var create_array="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")},create=function(){return util$2.Buffer?function(e){return(Reader$1.create=function(e){return util$2.Buffer.isBuffer(e)?new BufferReader$1(e):create_array(e)})(e)}:create_array},value;function readLongVarint(){var e=new LongBits(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.create=create(),Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice,Reader$1.prototype.uint32=(value=4294967295,function(){if(value=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return value;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return value}),Reader$1.prototype.int32=function(){return 0|this.uint32()},Reader$1.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},Reader$1.prototype.bool=function(){return 0!==this.uint32()},Reader$1.prototype.fixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.sfixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return 0|readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.float=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Reader$1.prototype.double=function(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Reader$1.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw indexOutOfRange(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},Reader$1.prototype.string=function(){var e=this.bytes();return utf8.read(e,0,e.length)},Reader$1.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this},Reader$1.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Reader$1._configure=function(e){BufferReader$1=e,Reader$1.create=create(),BufferReader$1._configure();var t=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(e){Reader.call(this,e)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)},BufferReader.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},BufferReader._configure();var rpc={},service=Service,util=requireMinimal();function Service(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service,Service.prototype.rpcCall=function e(t,r,n,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return util.asPromise(e,a,t,r,n,i);if(a.rpcImpl)try{return a.rpcImpl(t,r[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,r){if(e)return a.emit("error",e,t),o(e);if(null!==r){if(!(r instanceof n))try{r=n[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(i){return a.emit("error",i,t),o(i)}return a.emit("data",r,t),o(null,r)}a.end(!0)}))}catch(s){return a.emit("error",s,t),void setTimeout((function(){o(s)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},Service.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},function(e){e.Service=service}(rpc);var roots={};!function(e){var t=e;function r(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}t.build="minimal",t.Writer=writer$2,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=requireMinimal(),t.rpc=rpc,t.roots=roots,t.configure=r,r()}(indexMinimal);var minimal=indexMinimal,protobuf=getDefaultExportFromCjs$1(minimal),protobuf_min={exports:{}};(function(module){!function(g){var r,e,t,i;r={1:[function(e,t,r){t.exports=function(e,t){for(var r=Array(arguments.length-1),n=0,i=2,o=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise((function(i,a){r[n]=function(e){if(o)if(o=!1,e)a(e);else{for(var t=Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(s){o&&(o=!1,a(s))}}))}},{}],2:[function(e,t,r){r.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;1<--t%4&&"="==(e[0|t]||"");)++r;return Math.ceil(3*e.length)/4-r};for(var n=Array(64),i=Array(123),o=0;o<64;)i[n[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;r.encode=function(e,t,r){for(var i,o=null,a=[],s=0,c=0;t<r;){var u=e[t++];switch(c){case 0:a[s++]=n[u>>2],i=(3&u)<<4,c=1;break;case 1:a[s++]=n[i|u>>4],i=(15&u)<<2,c=2;break;case 2:a[s++]=n[i|u>>6],a[s++]=n[63&u],c=0}8191<s&&((o=o||[]).push(String.fromCharCode.apply(String,a)),s=0)}return c&&(a[s++]=n[i],a[s++]=61,1===c&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))};var a="invalid encoding";r.decode=function(e,t,r){for(var n,o=r,s=0,c=0;c<e.length;){var u=e.charCodeAt(c++);if(61==u&&1<s)break;if((u=i[u])===g)throw Error(a);switch(s){case 0:n=u,s=1;break;case 1:t[r++]=n<<2|(48&u)>>4,n=u,s=2;break;case 2:t[r++]=(15&n)<<4|(60&u)>>2,n=u,s=3;break;case 3:t[r++]=(3&n)<<6|u,s=0}}if(1===s)throw Error(a);return r-o},r.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},{}],3:[function(e,t,r){(t.exports=function e(t,r){"string"==typeof t&&(r=t,t=g);var n=[];function i(t){if("string"!=typeof t){var r=o();if(e.verbose&&console.log("codegen: "+r),r="return "+r,t){for(var a=Object.keys(t),s=Array(a.length+1),c=Array(a.length),u=0;u<a.length;)s[u]=a[u],c[u]=t[a[u++]];return s[u]=r,Function.apply(null,s).apply(null,c)}return Function(r)()}for(var l=Array(arguments.length-1),d=0;d<l.length;)l[d]=arguments[++d];if(d=0,t=t.replace(/%([%dfijs])/g,(function(e,t){var r=l[d++];switch(t){case"d":case"f":return""+ +(""+r);case"i":return""+Math.floor(r);case"j":return JSON.stringify(r);case"s":return""+r}return"%"})),d!==l.length)throw Error("parameter count mismatch");return n.push(t),i}function o(e){return"function "+(e||r||"")+"("+(t&&t.join(",")||"")+"){\n  "+n.join("\n  ")+"\n}"}return i.toString=o,i}).verbose=!1},{}],4:[function(e,t,r){function n(){this.t={}}(t.exports=n).prototype.on=function(e,t,r){return(this.t[e]||(this.t[e]=[])).push({fn:t,ctx:r||this}),this},n.prototype.off=function(e,t){if(e===g)this.t={};else if(t===g)this.t[e]=[];else for(var r=this.t[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},n.prototype.emit=function(e){var t=this.t[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},{}],5:[function(e,t,r){t.exports=o;var n=e(1),i=e(7)("fs");function o(e,t,r){return t="function"==typeof t?(r=t,{}):t||{},r?!t.xhr&&i&&i.readFile?i.readFile(e,(function(n,i){return n&&"undefined"!=typeof XMLHttpRequest?o.xhr(e,t,r):n?r(n):r(null,t.binary?i:i.toString("utf8"))})):o.xhr(e,t,r):n(o,this,e,t)}o.xhr=function(e,t,r){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4!==n.readyState)return g;if(0!==n.status&&200!==n.status)return r(Error("status "+n.status));if(t.binary){if(!(e=n.response))for(var e=[],i=0;i<n.responseText.length;++i)e.push(255&n.responseText.charCodeAt(i));return r(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return r(null,n.responseText)},t.binary&&("overrideMimeType"in n&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.responseType="arraybuffer"),n.open("GET",e),n.send()}},{1:1,7:7}],6:[function(e,t,r){function n(e){function t(e,t,r,n){var i=t<0?1:0;e(0===(t=i?-t:t)?0<1/t?0:2147483648:isNaN(t)?2143289344:34028234663852886e22<t?(i<<31|2139095040)>>>0:t<11754943508222875e-54?(i<<31|Math.round(t/1401298464324817e-60))>>>0:(i<<31|127+(i=Math.floor(Math.log(t)/Math.LN2))<<23|8388607&Math.round(t*Math.pow(2,-i)*8388608))>>>0,r,n)}function r(e,t,r){return t=2*((e=e(t,r))>>31)+1,r=e>>>23&255,e&=8388607,255==r?e?NaN:1/0*t:0==r?1401298464324817e-60*t*e:t*Math.pow(2,r-150)*(8388608+e)}function n(e,t,r){d[0]=e,t[r]=p[0],t[r+1]=p[1],t[r+2]=p[2],t[r+3]=p[3]}function c(e,t,r){d[0]=e,t[r]=p[3],t[r+1]=p[2],t[r+2]=p[1],t[r+3]=p[0]}function u(e,t){return p[0]=e[t],p[1]=e[t+1],p[2]=e[t+2],p[3]=e[t+3],d[0]}function l(e,t){return p[3]=e[t],p[2]=e[t+1],p[1]=e[t+2],p[0]=e[t+3],d[0]}var d,p,_,h,f;function m(e,t,r,n,i,o){var a,s=n<0?1:0;0===(n=s?-n:n)?(e(0,i,o+t),e(0<1/n?0:2147483648,i,o+r)):isNaN(n)?(e(0,i,o+t),e(2146959360,i,o+r)):17976931348623157e292<n?(e(0,i,o+t),e((s<<31|2146435072)>>>0,i,o+r)):n<22250738585072014e-324?(e((a=n/5e-324)>>>0,i,o+t),e((s<<31|a/4294967296)>>>0,i,o+r)):(e(4503599627370496*(a=n*Math.pow(2,-(n=1024===(n=Math.floor(Math.log(n)/Math.LN2))?1023:n)))>>>0,i,o+t),e((s<<31|n+1023<<20|1048576*a&1048575)>>>0,i,o+r))}function g(e,t,r,n,i){return t=e(n,i+t),i=2*((n=e(n,i+r))>>31)+1,t=4294967296*(1048575&n)+t,2047==(r=n>>>20&2047)?t?NaN:1/0*i:0==r?5e-324*i*t:i*Math.pow(2,r-1075)*(t+4503599627370496)}function v(e,t,r){_[0]=e,t[r]=h[0],t[r+1]=h[1],t[r+2]=h[2],t[r+3]=h[3],t[r+4]=h[4],t[r+5]=h[5],t[r+6]=h[6],t[r+7]=h[7]}function y(e,t,r){_[0]=e,t[r]=h[7],t[r+1]=h[6],t[r+2]=h[5],t[r+3]=h[4],t[r+4]=h[3],t[r+5]=h[2],t[r+6]=h[1],t[r+7]=h[0]}function S(e,t){return h[0]=e[t],h[1]=e[t+1],h[2]=e[t+2],h[3]=e[t+3],h[4]=e[t+4],h[5]=e[t+5],h[6]=e[t+6],h[7]=e[t+7],_[0]}function E(e,t){return h[7]=e[t],h[6]=e[t+1],h[5]=e[t+2],h[4]=e[t+3],h[3]=e[t+4],h[2]=e[t+5],h[1]=e[t+6],h[0]=e[t+7],_[0]}return"undefined"!=typeof Float32Array?(d=new Float32Array([-0]),f=128===(p=new Uint8Array(d.buffer))[3],e.writeFloatLE=f?n:c,e.writeFloatBE=f?c:n,e.readFloatLE=f?u:l,e.readFloatBE=f?l:u):(e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,o),e.readFloatLE=r.bind(null,a),e.readFloatBE=r.bind(null,s)),"undefined"!=typeof Float64Array?(_=new Float64Array([-0]),f=128===(h=new Uint8Array(_.buffer))[7],e.writeDoubleLE=f?v:y,e.writeDoubleBE=f?y:v,e.readDoubleLE=f?S:E,e.readDoubleBE=f?E:S):(e.writeDoubleLE=m.bind(null,i,0,4),e.writeDoubleBE=m.bind(null,o,4,0),e.readDoubleLE=g.bind(null,a,0,4),e.readDoubleBE=g.bind(null,s,4,0)),e}function i(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function o(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function a(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}t.exports=n(n)},{}],7:[function(t,i,n){function r(t){try{var i=eval("require")(t);if(i&&(i.length||Object.keys(i).length))return i}catch(t2){}return null}i.exports=r},{}],8:[function(e,t,r){var n=(r=r).isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},i=r.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),r=n(e);e="";r&&(e=t.shift()+"/");for(var i=0;i<t.length;)".."===t[i]?0<i&&".."!==t[i-1]?t.splice(--i,2):r?t.splice(i,1):++i:"."===t[i]?t.splice(i,1):++i;return e+t.join("/")};r.resolve=function(e,t,r){return r||(t=i(t)),!n(t)&&(e=(e=r?e:i(e)).replace(/(?:\/|^)[^/]+$/,"")).length?i(e+"/"+t):t}},{}],9:[function(e,t,r){t.exports=function(e,t,r){var n=r||8192,i=n>>>1,o=null,a=n;return function(r){return r<1||i<r?e(r):(n<a+r&&(o=e(n),a=0),r=t.call(o,a,a+=r),7&a&&(a=1+(7|a)),r)}}},{}],10:[function(e,t,r){r.length=function(e){for(var t,r=0,n=0;n<e.length;++n)(t=e.charCodeAt(n))<128?r+=1:t<2048?r+=2:55296==(64512&t)&&56320==(64512&e.charCodeAt(n+1))?(++n,r+=4):r+=3;return r},r.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,o=[],a=0;t<r;)(n=e[t++])<128?o[a++]=n:191<n&&n<224?o[a++]=(31&n)<<6|63&e[t++]:239<n&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[a++]=55296+(n>>10),o[a++]=56320+(1023&n)):o[a++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],8191<a&&((i=i||[]).push(String.fromCharCode.apply(String,o)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))},r.write=function(e,t,r){for(var n,i,o=r,a=0;a<e.length;++a)(n=e.charCodeAt(a))<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(55296==(64512&n)&&56320==(64512&(i=e.charCodeAt(a+1)))?(++a,t[r++]=(n=65536+((1023&n)<<10)+(1023&i))>>18|240,t[r++]=n>>12&63|128):t[r++]=n>>12|224,t[r++]=n>>6&63|128),t[r++]=63&n|128);return r-o}},{}],11:[function(e,t,r){var n=e(14),i=e(33);function o(e,t,r,i){if(t.resolvedType)if(t.resolvedType instanceof n){e("switch(d%s){",i);for(var o=t.resolvedType.values,a=Object.keys(o),s=0;s<a.length;++s)t.repeated&&o[a[s]]===t.typeDefault&&e("default:"),e("case%j:",a[s])("case %i:",o[a[s]])("m%s=%j",i,o[a[s]])("break");e("}")}else e('if(typeof d%s!=="object")',i)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",i,r,i);else{var c=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",i,i);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",i,i);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",i,i);break;case"uint64":c=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",i,i,c)('else if(typeof d%s==="string")',i)("m%s=parseInt(d%s,10)",i,i)('else if(typeof d%s==="number")',i)("m%s=d%s",i,i)('else if(typeof d%s==="object")',i)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",i,i,i,c?"true":"");break;case"bytes":e('if(typeof d%s==="string")',i)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",i,i,i)("else if(d%s.length)",i)("m%s=d%s",i,i);break;case"string":e("m%s=String(d%s)",i,i);break;case"bool":e("m%s=Boolean(d%s)",i,i)}}return e}function a(e,t,r,i){if(t.resolvedType)t.resolvedType instanceof n?e("d%s=o.enums===String?types[%i].values[m%s]:m%s",i,r,i,i):e("d%s=types[%i].toObject(m%s,o)",i,r,i);else{var o=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",i,i,i,i);break;case"uint64":o=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',i)("d%s=o.longs===String?String(m%s):m%s",i,i,i)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",i,i,i,i,o?"true":"",i);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",i,i,i,i,i);break;default:e("d%s=m%s",i,i)}}return e}r.fromObject=function(e){var t=e.fieldsArray,r=i.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var a=0;a<t.length;++a){var s=t[a].resolve(),c=i.safeProp(s.name);s.map?(r("if(d%s){",c)('if(typeof d%s!=="object")',c)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",c)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",c),o(r,s,a,c+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",c)("if(!Array.isArray(d%s))",c)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",c)("for(var i=0;i<d%s.length;++i){",c),o(r,s,a,c+"[i]")("}")("}")):(s.resolvedType instanceof n||r("if(d%s!=null){",c),o(r,s,a,c),s.resolvedType instanceof n||r("}"))}return r("return m")},r.toObject=function(e){var t=e.fieldsArray.slice().sort(i.compareFieldsById);if(!t.length)return i.codegen()("return {}");for(var r=i.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),o=[],s=[],c=[],u=0;u<t.length;++u)t[u].partOf||(t[u].resolve().repeated?o:t[u].map?s:c).push(t[u]);if(o.length){for(r("if(o.arrays||o.defaults){"),u=0;u<o.length;++u)r("d%s=[]",i.safeProp(o[u].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),u=0;u<s.length;++u)r("d%s={}",i.safeProp(s[u].name));r("}")}if(c.length){for(r("if(o.defaults){"),u=0;u<c.length;++u){var l,d=c[u],p=i.safeProp(d.name);d.resolvedType instanceof n?r("d%s=o.enums===String?%j:%j",p,d.resolvedType.valuesById[d.typeDefault],d.typeDefault):d.long?r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",d.typeDefault.low,d.typeDefault.high,d.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",p)("}else")("d%s=o.longs===String?%j:%i",p,d.typeDefault.toString(),d.typeDefault.toNumber()):d.bytes?(l="["+Array.prototype.slice.call(d.typeDefault).join(",")+"]",r("if(o.bytes===String)d%s=%j",p,String.fromCharCode.apply(String,d.typeDefault))("else{")("d%s=%s",p,l)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",p,p)("}")):r("d%s=%j",p,d.typeDefault)}r("}")}var _=!1;for(u=0;u<t.length;++u){d=t[u];var h=e.i.indexOf(d);p=i.safeProp(d.name);d.map?(_||(_=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",p,p)("d%s={}",p)("for(var j=0;j<ks2.length;++j){"),a(r,d,h,p+"[ks2[j]]")("}")):d.repeated?(r("if(m%s&&m%s.length){",p,p)("d%s=[]",p)("for(var j=0;j<m%s.length;++j){",p),a(r,d,h,p+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",p,d.name),a(r,d,h,p),d.partOf&&r("if(o.oneofs)")("d%s=%j",i.safeProp(d.partOf.name),d.name)),r("}")}return r("return d")}},{14:14,33:33}],12:[function(e,t,r){t.exports=function(e){var t=o.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter((function(e){return e.map})).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var r=0;r<e.fieldsArray.length;++r){var a=e.i[r].resolve(),s=a.resolvedType instanceof n?"int32":a.type,c="m"+o.safeProp(a.name);t("case %i:",a.id),a.map?(t("if(%s===util.emptyObject)",c)("%s={}",c)("var c2 = r.uint32()+r.pos"),i.defaults[a.keyType]!==g?t("k=%j",i.defaults[a.keyType]):t("k=null"),i.defaults[s]!==g?t("value=%j",i.defaults[s]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",a.keyType)("case 2:"),i.basic[s]===g?t("value=types[%i].decode(r,r.uint32())",r):t("value=r.%s()",s),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),i.long[a.keyType]!==g?t('%s[typeof k==="object"?util.longToHash(k):k]=value',c):t("%s[k]=value",c)):a.repeated?(t("if(!(%s&&%s.length))",c,c)("%s=[]",c),i.packed[s]!==g&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",c,s)("}else"),i.basic[s]===g?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",c,r):t("%s.push(r.%s())",c,s)):i.basic[s]===g?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",c,r):t("%s=r.%s()",c,s),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),r=0;r<e.i.length;++r){var u=e.i[r];u.required&&t("if(!m.hasOwnProperty(%j))",u.name)("throw util.ProtocolError(%j,{instance:m})","missing required '"+u.name+"'")}return t("return m")};var n=e(14),i=e(32),o=e(33)},{14:14,32:32,33:33}],13:[function(e,t,r){t.exports=function(e){for(var t,r=o.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),s=e.fieldsArray.slice().sort(o.compareFieldsById),c=0;c<s.length;++c){var u=s[c].resolve(),l=e.i.indexOf(u),d=u.resolvedType instanceof n?"int32":u.type,p=i.basic[d];t="m"+o.safeProp(u.name),u.map?(r("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",t,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",t)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|i.mapKey[u.keyType],u.keyType),p===g?r("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",l,t):r(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|p,d,t),r("}")("}")):u.repeated?(r("if(%s!=null&&%s.length){",t,t),u.packed&&i.packed[d]!==g?r("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",t)("w.%s(%s[i])",d,t)("w.ldelim()"):(r("for(var i=0;i<%s.length;++i)",t),p===g?a(r,u,l,t+"[i]"):r("w.uint32(%i).%s(%s[i])",(u.id<<3|p)>>>0,d,t)),r("}")):(u.optional&&r("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",t,u.name),p===g?a(r,u,l,t):r("w.uint32(%i).%s(%s)",(u.id<<3|p)>>>0,d,t))}return r("return w")};var n=e(14),i=e(32),o=e(33);function a(e,t,r,n){return t.resolvedType.group?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",r,n,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",r,n,(t.id<<3|2)>>>0)}},{14:14,32:32,33:33}],14:[function(e,t,r){t.exports=a;var n=e(22);((a.prototype=Object.create(n.prototype)).constructor=a).className="Enum";var i=e(21),o=e(33);function a(e,t,r,i,o){if(n.call(this,e,r),t&&"object"!=_typeof(t))throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=o||{},this.reserved=g,t)for(var a=Object.keys(t),s=0;s<a.length;++s)"number"==typeof t[a[s]]&&(this.valuesById[this.values[a[s]]=t[a[s]]]=a[s])}a.fromJSON=function(e,t){return(e=new a(e,t.values,t.options,t.comment,t.comments)).reserved=t.reserved,e},a.prototype.toJSON=function(e){return e=!!e&&!!e.keepComments,o.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:g,"comment",e?this.comment:g,"comments",e?this.comments:g])},a.prototype.add=function(e,t,r){if(!o.isString(e))throw TypeError("name must be a string");if(!o.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==g)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==g){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return this.comments[e]=r||null,this},a.prototype.remove=function(e){if(!o.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this},a.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},a.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},{21:21,22:22,33:33}],15:[function(e,t,r){t.exports=u;var n=e(22);((u.prototype=Object.create(n.prototype)).constructor=u).className="Field";var i,o=e(14),a=e(32),s=e(33),c=/^required|optional|repeated$/;function u(e,t,r,i,o,u,l){if(s.isObject(i)?(l=o,u=i,i=o=g):s.isObject(o)&&(l=u,u=o,o=g),n.call(this,e,u),!s.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!s.isString(r))throw TypeError("type must be a string");if(i!==g&&!c.test(i=i.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(o!==g&&!s.isString(o))throw TypeError("extend must be a string");this.rule=(i="proto3_optional"===i?"optional":i)&&"optional"!==i?i:g,this.type=r,this.id=t,this.extend=o||g,this.required="required"===i,this.optional=!this.required,this.repeated="repeated"===i,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!s.Long&&a.long[r]!==g,this.bytes="bytes"===r,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.n=null,this.comment=l}u.fromJSON=function(e,t){return new u(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)},Object.defineProperty(u.prototype,"packed",{get:function(){return null===this.n&&(this.n=!1!==this.getOption("packed")),this.n}}),u.prototype.setOption=function(e,t,r){return"packed"===e&&(this.n=null),n.prototype.setOption.call(this,e,t,r)},u.prototype.toJSON=function(e){return e=!!e&&!!e.keepComments,s.toObject(["rule","optional"!==this.rule&&this.rule||g,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",e?this.comment:g])},u.prototype.resolve=function(){return this.resolved?this:((this.typeDefault=a.defaults[this.type])===g&&(this.resolvedType=(this.declaringField||this).parent.lookupTypeOrEnum(this.type),this.resolvedType instanceof i?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof o&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(this.options.packed===g||!this.resolvedType||this.resolvedType instanceof o)||delete this.options.packed,Object.keys(this.options).length||(this.options=g)),this.long?(this.typeDefault=s.Long.fromNumber(this.typeDefault,"u"==(this.type[0]||"")),Object.freeze&&Object.freeze(this.typeDefault)):this.bytes&&"string"==typeof this.typeDefault&&(s.base64.test(this.typeDefault)?s.base64.decode(this.typeDefault,e=s.newBuffer(s.base64.length(this.typeDefault)),0):s.utf8.write(this.typeDefault,e=s.newBuffer(s.utf8.length(this.typeDefault)),0),this.typeDefault=e),this.map?this.defaultValue=s.emptyObject:this.repeated?this.defaultValue=s.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof i&&(this.parent.ctor.prototype[this.name]=this.defaultValue),n.prototype.resolve.call(this));var e},u.d=function(e,t,r,n){return"function"==typeof t?t=s.decorateType(t).name:t&&"object"==_typeof(t)&&(t=s.decorateEnum(t).name),function(i,o){s.decorateType(i.constructor).add(new u(o,e,t,r,{default:n}))}},u.r=function(e){i=e}},{14:14,22:22,32:32,33:33}],16:[function(e,t,r){var n=t.exports=e(17);n.build="light",n.load=function(e,t,r){return(t="function"==typeof t?(r=t,new n.Root):t||new n.Root).load(e,r)},n.loadSync=function(e,t){return(t=t||new n.Root).loadSync(e)},n.encoder=e(13),n.decoder=e(12),n.verifier=e(36),n.converter=e(11),n.ReflectionObject=e(22),n.Namespace=e(21),n.Root=e(26),n.Enum=e(14),n.Type=e(31),n.Field=e(15),n.OneOf=e(23),n.MapField=e(18),n.Service=e(30),n.Method=e(20),n.Message=e(19),n.wrappers=e(37),n.types=e(32),n.util=e(33),n.ReflectionObject.r(n.Root),n.Namespace.r(n.Type,n.Service,n.Enum),n.Root.r(n.Type),n.Field.r(n.Type)},{11:11,12:12,13:13,14:14,15:15,17:17,18:18,19:19,20:20,21:21,22:22,23:23,26:26,30:30,31:31,32:32,33:33,36:36,37:37}],17:[function(e,t,r){var n=r;function i(){n.util.r(),n.Writer.r(n.BufferWriter),n.Reader.r(n.BufferReader)}n.build="minimal",n.Writer=e(38),n.BufferWriter=e(39),n.Reader=e(24),n.BufferReader=e(25),n.util=e(35),n.rpc=e(28),n.roots=e(27),n.configure=i,i()},{24:24,25:25,27:27,28:28,35:35,38:38,39:39}],18:[function(e,t,r){t.exports=a;var n=e(15);((a.prototype=Object.create(n.prototype)).constructor=a).className="MapField";var i=e(32),o=e(33);function a(e,t,r,i,a,s){if(n.call(this,e,t,i,g,g,a,s),!o.isString(r))throw TypeError("keyType must be a string");this.keyType=r,this.resolvedKeyType=null,this.map=!0}a.fromJSON=function(e,t){return new a(e,t.id,t.keyType,t.type,t.options,t.comment)},a.prototype.toJSON=function(e){return e=!!e&&!!e.keepComments,o.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",e?this.comment:g])},a.prototype.resolve=function(){if(this.resolved)return this;if(i.mapKey[this.keyType]===g)throw Error("invalid key type: "+this.keyType);return n.prototype.resolve.call(this)},a.d=function(e,t,r){return"function"==typeof r?r=o.decorateType(r).name:r&&"object"==_typeof(r)&&(r=o.decorateEnum(r).name),function(n,i){o.decorateType(n.constructor).add(new a(i,e,t,r))}}},{15:15,32:32,33:33}],19:[function(e,t,r){t.exports=i;var n=e(35);function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)this[t[r]]=e[t[r]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,n.toJSONOptions)}},{35:35}],20:[function(e,t,r){t.exports=o;var n=e(22);((o.prototype=Object.create(n.prototype)).constructor=o).className="Method";var i=e(33);function o(e,t,r,o,a,s,c,u,l){if(i.isObject(a)?(c=a,a=s=g):i.isObject(s)&&(c=s,s=g),t!==g&&!i.isString(t))throw TypeError("type must be a string");if(!i.isString(r))throw TypeError("requestType must be a string");if(!i.isString(o))throw TypeError("responseType must be a string");n.call(this,e,c),this.type=t||"rpc",this.requestType=r,this.requestStream=!!a||g,this.responseType=o,this.responseStream=!!s||g,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u,this.parsedOptions=l}o.fromJSON=function(e,t){return new o(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},o.prototype.toJSON=function(e){return e=!!e&&!!e.keepComments,i.toObject(["type","rpc"!==this.type&&this.type||g,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",e?this.comment:g,"parsedOptions",this.parsedOptions])},o.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),n.prototype.resolve.call(this))}},{22:22,33:33}],21:[function(e,t,r){t.exports=l;var n=e(22);((l.prototype=Object.create(n.prototype)).constructor=l).className="Namespace";var i,o,a,s=e(15),c=e(33);function u(e,t){if(!e||!e.length)return g;for(var r={},n=0;n<e.length;++n)r[e[n].name]=e[n].toJSON(t);return r}function l(e,t){n.call(this,e,t),this.nested=g,this.e=null}function d(e){return e.e=null,e}l.fromJSON=function(e,t){return new l(e,t.options).addJSON(t.nested)},l.arrayToJSON=u,l.isReservedId=function(e,t){if(e)for(var r=0;r<e.length;++r)if("string"!=typeof e[r]&&e[r][0]<=t&&e[r][1]>t)return!0;return!1},l.isReservedName=function(e,t){if(e)for(var r=0;r<e.length;++r)if(e[r]===t)return!0;return!1},Object.defineProperty(l.prototype,"nestedArray",{get:function(){return this.e||(this.e=c.toArray(this.nested))}}),l.prototype.toJSON=function(e){return c.toObject(["options",this.options,"nested",u(this.nestedArray,e)])},l.prototype.addJSON=function(e){if(e)for(var t,r=Object.keys(e),n=0;n<r.length;++n)t=e[r[n]],this.add((t.fields!==g?i:t.values!==g?a:t.methods!==g?o:t.id!==g?s:l).fromJSON(r[n],t));return this},l.prototype.get=function(e){return this.nested&&this.nested[e]||null},l.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof a)return this.nested[e].values;throw Error("no such enum: "+e)},l.prototype.add=function(e){if(!(e instanceof s&&e.extend!==g||e instanceof i||e instanceof a||e instanceof o||e instanceof l))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t){if(!(t instanceof l&&e instanceof l)||t instanceof i||t instanceof o)throw Error("duplicate name '"+e.name+"' in "+this);for(var r=t.nestedArray,n=0;n<r.length;++n)e.add(r[n]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}}else this.nested={};return(this.nested[e.name]=e).onAdd(this),d(this)},l.prototype.remove=function(e){if(!(e instanceof n))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=g),e.onRemove(this),d(this)},l.prototype.define=function(e,t){if(c.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var r=this;0<e.length;){var n=e.shift();if(r.nested&&r.nested[n]){if(!((r=r.nested[n])instanceof l))throw Error("path conflicts with non-namespace objects")}else r.add(r=new l(n))}return t&&r.addJSON(t),r},l.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof l?e[t++].resolveAll():e[t++].resolve();return this.resolve()},l.prototype.lookup=function(e,t,r){if("boolean"==typeof t?(r=t,t=g):t&&!Array.isArray(t)&&(t=[t]),c.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;if(""===e[0])return this.root.lookup(e.slice(1),t);var n=this.get(e[0]);if(n){if(1===e.length){if(!t||~t.indexOf(n.constructor))return n}else if(n instanceof l&&(n=n.lookup(e.slice(1),t,!0)))return n}else for(var i=0;i<this.nestedArray.length;++i)if(this.e[i]instanceof l&&(n=this.e[i].lookup(e,t,!0)))return n;return null===this.parent||r?null:this.parent.lookup(e,t)},l.prototype.lookupType=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such type: "+e);return t},l.prototype.lookupEnum=function(e){var t=this.lookup(e,[a]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},l.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[i,a]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},l.prototype.lookupService=function(e){var t=this.lookup(e,[o]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},l.r=function(e,t,r){i=e,o=t,a=r}},{15:15,22:22,33:33}],22:[function(e,t,r){(t.exports=o).className="ReflectionObject";var n,i=e(33);function o(e,t){if(!i.isString(e))throw TypeError("name must be a string");if(t&&!i.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(o.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),o.prototype.toJSON=function(){throw Error()},o.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1,(e=e.root)instanceof n&&e.u(this)},o.prototype.onRemove=function(e){(e=e.root)instanceof n&&e.o(this),this.parent=null,this.resolved=!1},o.prototype.resolve=function(){return this.resolved||this.root instanceof n&&(this.resolved=!0),this},o.prototype.getOption=function(e){return this.options?this.options[e]:g},o.prototype.setOption=function(e,t,r){return r&&this.options&&this.options[e]!==g||((this.options||(this.options={}))[e]=t),this},o.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var n,o,a=this.parsedOptions;return r?(o=a.find((function(t){return Object.prototype.hasOwnProperty.call(t,e)})))?(n=o[e],i.setProperty(n,r,t)):((o={})[e]=i.setProperty({},r,t),a.push(o)):((o={})[e]=t,a.push(o)),this},o.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),n=0;n<r.length;++n)this.setOption(r[n],e[r[n]],t);return this},o.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},o.r=function(e){n=e}},{33:33}],23:[function(e,t,r){t.exports=a;var n=e(22);((a.prototype=Object.create(n.prototype)).constructor=a).className="OneOf";var i=e(15),o=e(33);function a(e,t,r,i){if(Array.isArray(t)||(r=t,t=g),n.call(this,e,r),t!==g&&!Array.isArray(t))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function s(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}a.fromJSON=function(e,t){return new a(e,t.oneof,t.options,t.comment)},a.prototype.toJSON=function(e){return e=!!e&&!!e.keepComments,o.toObject(["options",this.options,"oneof",this.oneof,"comment",e?this.comment:g])},a.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),s(e.partOf=this),this},a.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),-1<(t=this.oneof.indexOf(e.name))&&this.oneof.splice(t,1),e.partOf=null,this},a.prototype.onAdd=function(e){n.prototype.onAdd.call(this,e);for(var t=0;t<this.oneof.length;++t){var r=e.get(this.oneof[t]);r&&!r.partOf&&(r.partOf=this).fieldsArray.push(r)}s(this)},a.prototype.onRemove=function(e){for(var t,r=0;r<this.fieldsArray.length;++r)(t=this.fieldsArray[r]).parent&&t.parent.remove(t);n.prototype.onRemove.call(this,e)},a.d=function(){for(var e=Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,r){o.decorateType(t.constructor).add(new a(r,e)),Object.defineProperty(t,r,{get:o.oneOfGetter(e),set:o.oneOfSetter(e)})}}},{15:15,22:22,33:33}],24:[function(e,t,r){t.exports=c;var n,i=e(35),o=i.LongBits,a=i.utf8;function s(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}function u(){return i.Buffer?function(e){return(c.create=function(e){return i.Buffer.isBuffer(e)?new n(e):d(e)})(e)}:d}var l,d="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")};function p(){var e=new o(0,0),t=0;if(!(4<this.len-this.pos)){for(;t<3;++t){if(this.pos>=this.len)throw s(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,4<this.len-this.pos){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw s(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function _(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function h(){if(this.pos+8>this.len)throw s(this,8);return new o(_(this.buf,this.pos+=4),_(this.buf,this.pos+=4))}c.create=u(),c.prototype.h=i.Array.prototype.subarray||i.Array.prototype.slice,c.prototype.uint32=(l=4294967295,function(){if(l=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return l;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return l}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return _(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return 0|_(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw s(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this.h.call(this.buf,t,r)},c.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw s(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw s(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c.r=function(e){n=e,c.create=u(),n.r();var t=i.Long?"toLong":"toNumber";i.merge(c.prototype,{int64:function(){return p.call(this)[t](!1)},uint64:function(){return p.call(this)[t](!0)},sint64:function(){return p.call(this).zzDecode()[t](!1)},fixed64:function(){return h.call(this)[t](!0)},sfixed64:function(){return h.call(this)[t](!1)}})}},{35:35}],25:[function(e,t,r){t.exports=o;var n=e(24);(o.prototype=Object.create(n.prototype)).constructor=o;var i=e(35);function o(e){n.call(this,e)}o.r=function(){i.Buffer&&(o.prototype.h=i.Buffer.prototype.slice)},o.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},o.r()},{24:24,35:35}],26:[function(e,t,r){t.exports=d;var n=e(21);((d.prototype=Object.create(n.prototype)).constructor=d).className="Root";var i,o,a,s=e(15),c=e(14),u=e(23),l=e(33);function d(e){n.call(this,"",e),this.deferred=[],this.files=[]}function p(){}d.fromJSON=function(e,t){return t=t||new d,e.options&&t.setOptions(e.options),t.addJSON(e.nested)},d.prototype.resolvePath=l.path.resolve,d.prototype.fetch=l.fetch,d.prototype.load=function e(t,r,n){"function"==typeof r&&(n=r,r=g);var i=this;if(!n)return l.asPromise(e,i,t,r);var s=n===p;function c(e,t){if(n){var r=n;if(n=null,s)throw e;r(e,t)}}function u(e){var t=e.lastIndexOf("google/protobuf/");return-1<t&&(t=e.substring(t))in a?t:null}function d(e,t){try{if(l.isString(t)&&"{"==(t[0]||"")&&(t=JSON.parse(t)),l.isString(t)){o.filename=e;var n,a=o(t,i,r),d=0;if(a.imports)for(;d<a.imports.length;++d)(n=u(a.imports[d])||i.resolvePath(e,a.imports[d]))&&_(n);if(a.weakImports)for(d=0;d<a.weakImports.length;++d)(n=u(a.weakImports[d])||i.resolvePath(e,a.weakImports[d]))&&_(n,!0)}else i.setOptions(t.options).addJSON(t.nested)}catch(p){c(p)}s||h||c(null,i)}function _(e,t){if(!~i.files.indexOf(e))if(i.files.push(e),e in a)s?d(e,a[e]):(++h,setTimeout((function(){--h,d(e,a[e])})));else if(s){var r;try{r=l.fs.readFileSync(e).toString("utf8")}catch(o){return void(t||c(o))}d(e,r)}else++h,i.fetch(e,(function(r,o){--h,n&&(r?t?h||c(null,i):c(r):d(e,o))}))}var h=0;l.isString(t)&&(t=[t]);for(var f,m=0;m<t.length;++m)(f=i.resolvePath("",t[m]))&&_(f);return s?i:(h||c(null,i),g)},d.prototype.loadSync=function(e,t){if(!l.isNode)throw Error("not supported");return this.load(e,t,p)},d.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map((function(e){return"'extend "+e.extend+"' in "+e.parent.fullName})).join(", "));return n.prototype.resolveAll.call(this)};var _=/^[A-Z]/;function h(e,t){var r=t.parent.lookup(t.extend);if(r){var n=new s(t.fullName,t.id,t.type,t.rule,g,t.options);return(n.declaringField=t).extensionField=n,r.add(n),1}}d.prototype.u=function(e){if(e instanceof s)e.extend===g||e.extensionField||h(0,e)||this.deferred.push(e);else if(e instanceof c)_.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof u)){if(e instanceof i)for(var t=0;t<this.deferred.length;)h(0,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this.u(e.e[r]);_.test(e.name)&&(e.parent[e.name]=e)}},d.prototype.o=function(e){var t;if(e instanceof s)e.extend!==g&&(e.extensionField?(e.extensionField.parent.remove(e.extensionField),e.extensionField=null):-1<(t=this.deferred.indexOf(e))&&this.deferred.splice(t,1));else if(e instanceof c)_.test(e.name)&&delete e.parent[e.name];else if(e instanceof n){for(var r=0;r<e.nestedArray.length;++r)this.o(e.e[r]);_.test(e.name)&&delete e.parent[e.name]}},d.r=function(e,t,r){i=e,o=t,a=r}},{14:14,15:15,21:21,23:23,33:33}],27:[function(e,t,r){t.exports={}},{}],28:[function(e,t,r){r.Service=e(29)},{29:29}],29:[function(e,t,r){t.exports=i;var n=e(35);function i(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!r}((i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i).prototype.rpcCall=function e(t,r,i,o,a){if(!o)throw TypeError("request must be specified");var s=this;if(!a)return n.asPromise(e,s,t,r,i,o);if(!s.rpcImpl)return setTimeout((function(){a(Error("already ended"))}),0),g;try{return s.rpcImpl(t,r[s.requestDelimited?"encodeDelimited":"encode"](o).finish(),(function(e,r){if(e)return s.emit("error",e,t),a(e);if(null===r)return s.end(!0),g;if(!(r instanceof i))try{r=i[s.responseDelimited?"decodeDelimited":"decode"](r)}catch(n){return s.emit("error",n,t),a(n)}return s.emit("data",r,t),a(null,r)}))}catch(c){return s.emit("error",c,t),setTimeout((function(){a(c)}),0),g}},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},{35:35}],30:[function(e,t,r){t.exports=s;var n=e(21);((s.prototype=Object.create(n.prototype)).constructor=s).className="Service";var i=e(20),o=e(33),a=e(28);function s(e,t){n.call(this,e,t),this.methods={},this.f=null}function c(e){return e.f=null,e}s.fromJSON=function(e,t){var r=new s(e,t.options);if(t.methods)for(var n=Object.keys(t.methods),o=0;o<n.length;++o)r.add(i.fromJSON(n[o],t.methods[n[o]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r},s.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return o.toObject(["options",t&&t.options||g,"methods",n.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||g,"comment",r?this.comment:g])},Object.defineProperty(s.prototype,"methodsArray",{get:function(){return this.f||(this.f=o.toArray(this.methods))}}),s.prototype.get=function(e){return this.methods[e]||n.prototype.get.call(this,e)},s.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return n.prototype.resolve.call(this)},s.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?c((this.methods[e.name]=e).parent=this):n.prototype.add.call(this,e)},s.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,c(this)}return n.prototype.remove.call(this,e)},s.prototype.create=function(e,t,r){for(var n,i=new a.Service(e,t,r),s=0;s<this.methodsArray.length;++s){var c=o.lcFirst((n=this.f[s]).resolve().name).replace(/[^$\w_]/g,"");i[c]=o.codegen(["r","c"],o.isReserved(c)?c+"_":c)("return this.rpcCall(m,q,s,r,c)")({m:n,q:n.resolvedRequestType.ctor,s:n.resolvedResponseType.ctor})}return i}},{20:20,21:21,28:28,33:33}],31:[function(e,t,r){t.exports=y;var n=e(21);((y.prototype=Object.create(n.prototype)).constructor=y).className="Type";var i=e(14),o=e(23),a=e(15),s=e(18),c=e(30),u=e(19),l=e(24),d=e(38),p=e(33),_=e(13),h=e(12),f=e(36),m=e(11),v=e(37);function y(e,t){n.call(this,e,t),this.fields={},this.oneofs=g,this.extensions=g,this.reserved=g,this.group=g,this.c=null,this.i=null,this.a=null,this.l=null}function S(e){return e.c=e.i=e.a=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(y.prototype,{fieldsById:{get:function(){if(this.c)return this.c;this.c={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var r=this.fields[e[t]],n=r.id;if(this.c[n])throw Error("duplicate id "+n+" in "+this);this.c[n]=r}return this.c}},fieldsArray:{get:function(){return this.i||(this.i=p.toArray(this.fields))}},oneofsArray:{get:function(){return this.a||(this.a=p.toArray(this.oneofs))}},ctor:{get:function(){return this.l||(this.ctor=y.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof u||((e.prototype=new u).constructor=e,p.merge(e.prototype,t)),e.$type=e.prototype.$type=this,p.merge(e,u,!0),this.l=e;for(var r=0;r<this.fieldsArray.length;++r)this.i[r].resolve();var n={};for(r=0;r<this.oneofsArray.length;++r)n[this.a[r].resolve().name]={get:p.oneOfGetter(this.a[r].oneof),set:p.oneOfSetter(this.a[r].oneof)};r&&Object.defineProperties(e.prototype,n)}}}),y.generateConstructor=function(e){for(var t,r=p.codegen(["p"],e.name),n=0;n<e.fieldsArray.length;++n)(t=e.i[n]).map?r("this%s={}",p.safeProp(t.name)):t.repeated&&r("this%s=[]",p.safeProp(t.name));return r("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},y.fromJSON=function(e,t){var r=new y(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var u=Object.keys(t.fields),l=0;l<u.length;++l)r.add((void 0!==t.fields[u[l]].keyType?s:a).fromJSON(u[l],t.fields[u[l]]));if(t.oneofs)for(u=Object.keys(t.oneofs),l=0;l<u.length;++l)r.add(o.fromJSON(u[l],t.oneofs[u[l]]));if(t.nested)for(u=Object.keys(t.nested),l=0;l<u.length;++l){var d=t.nested[u[l]];r.add((d.id!==g?a:d.fields!==g?y:d.values!==g?i:d.methods!==g?c:n).fromJSON(u[l],d))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r},y.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return p.toObject(["options",t&&t.options||g,"oneofs",n.arrayToJSON(this.oneofsArray,e),"fields",n.arrayToJSON(this.fieldsArray.filter((function(e){return!e.declaringField})),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:g,"reserved",this.reserved&&this.reserved.length?this.reserved:g,"group",this.group||g,"nested",t&&t.nested||g,"comment",r?this.comment:g])},y.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return n.prototype.resolveAll.call(this)},y.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},y.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof a&&e.extend===g){if((this.c||this.fieldsById)[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),(this.fields[e.name]=e).message=this,e.onAdd(this),S(this)}return e instanceof o?(this.oneofs||(this.oneofs={}),(this.oneofs[e.name]=e).onAdd(this),S(this)):n.prototype.add.call(this,e)},y.prototype.remove=function(e){if(e instanceof a&&e.extend===g){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),S(this)}if(e instanceof o){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),S(this)}return n.prototype.remove.call(this,e)},y.prototype.isReservedId=function(e){return n.isReservedId(this.reserved,e)},y.prototype.isReservedName=function(e){return n.isReservedName(this.reserved,e)},y.prototype.create=function(e){return new this.ctor(e)},y.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this.i[r].resolve().resolvedType);this.encode=_(this)({Writer:d,types:t,util:p}),this.decode=h(this)({Reader:l,types:t,util:p}),this.verify=f(this)({types:t,util:p}),this.fromObject=m.fromObject(this)({types:t,util:p}),this.toObject=m.toObject(this)({types:t,util:p});var n=v[e];return n&&((e=Object.create(this)).fromObject=this.fromObject,this.fromObject=n.fromObject.bind(e),e.toObject=this.toObject,this.toObject=n.toObject.bind(e)),this},y.prototype.encode=function(e,t){return this.setup().encode(e,t)},y.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},y.prototype.decode=function(e,t){return this.setup().decode(e,t)},y.prototype.decodeDelimited=function(e){return e instanceof l||(e=l.create(e)),this.decode(e,e.uint32())},y.prototype.verify=function(e){return this.setup().verify(e)},y.prototype.fromObject=function(e){return this.setup().fromObject(e)},y.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},y.d=function(e){return function(t){p.decorateType(t,e)}}},{11:11,12:12,13:13,14:14,15:15,18:18,19:19,21:21,23:23,24:24,30:30,33:33,36:36,37:37,38:38}],32:[function(e,t,r){e=e(33);var n=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function i(e,t){var r=0,i={};for(t|=0;r<e.length;)i[n[r+t]]=e[r++];return i}r.basic=i([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),r.defaults=i([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",e.emptyArray,null]),r.long=i([0,0,0,1,1],7),r.mapKey=i([0,0,0,5,5,0,0,0,1,1,0,2],2),r.packed=i([1,5,0,0,0,5,5,0,0,0,1,1,0])},{33:33}],33:[function(e,t,r){var n,i,o=t.exports=e(35),a=e(27);o.codegen=e(3),o.fetch=e(5),o.path=e(8),o.fs=o.inquire("fs"),o.toArray=function(e){if(e){for(var t=Object.keys(e),r=Array(t.length),n=0;n<t.length;)r[n]=e[t[n++]];return r}return[]},o.toObject=function(e){for(var t={},r=0;r<e.length;){var n=e[r++],i=e[r++];i!==g&&(t[n]=i)}return t};var s=/\\/g,c=/"/g;o.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},o.safeProp=function(e){return!/^[$\w_]+$/.test(e)||o.isReserved(e)?'["'+e.replace(s,"\\\\").replace(c,'\\"')+'"]':"."+e},o.ucFirst=function(e){return(e[0]||"").toUpperCase()+e.substring(1)};var u=/_([a-z])/g;o.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(u,(function(e,t){return t.toUpperCase()}))},o.compareFieldsById=function(e,t){return e.id-t.id},o.decorateType=function(t,r){return t.$type?(r&&t.$type.name!==r&&(o.decorateRoot.remove(t.$type),t.$type.name=r,o.decorateRoot.add(t.$type)),t.$type):(r=new(n=n||e(31))(r||t.name),o.decorateRoot.add(r),r.ctor=t,Object.defineProperty(t,"$type",{value:r,enumerable:!1}),Object.defineProperty(t.prototype,"$type",{value:r,enumerable:!1}),r)};var l=0;o.decorateEnum=function(t){if(t.$type)return t.$type;var r=new(i=i||e(14))("Enum"+l++,t);return o.decorateRoot.add(r),Object.defineProperty(t,"$type",{value:r,enumerable:!1}),r},o.setProperty=function(e,t,r){if("object"!=_typeof(e))throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return function e(t,r,n){var i=r.shift();return 0<r.length?t[i]=e(t[i]||{},r,n):((r=t[i])&&(n=[].concat(r).concat(n)),t[i]=n),t}(e,t=t.split("."),r)},Object.defineProperty(o,"decorateRoot",{get:function(){return a.decorated||(a.decorated=new(e(26)))}})},{14:14,26:26,27:27,3:3,31:31,35:35,5:5,8:8}],34:[function(e,t,r){t.exports=i;var n=e(35);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var o=i.zero=new i(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1},i.zeroHash="\0\0\0\0\0\0\0\0",i.fromNumber=function(e){if(0===e)return o;var t=e<0,r=(e=t?-e:e)>>>0;e=(e-r)/4294967296>>>0;return t&&(e=~e>>>0,r=~r>>>0,4294967295<++r&&(r=0,4294967295<++e&&(e=0))),new i(r,e)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(n.isString(e)){if(!n.Long)return i.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):o},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0;e=~this.hi>>>0;return-(t+4294967296*(e=t?e:e+1>>>0))}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var a=String.prototype.charCodeAt;i.fromHash=function(e){return"\0\0\0\0\0\0\0\0"===e?o:new i((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0==r?0==t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},{35:35}],35:[function(e,t,r){var n=r;function i(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)e[n[i]]!==g&&r||(e[n[i]]=t[n[i]]);return e}function o(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),r&&i(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}n.asPromise=e(1),n.base64=e(2),n.EventEmitter=e(4),n.float=e(6),n.inquire=e(7),n.utf8=e(10),n.pool=e(9),n.LongBits=e(34),n.isNode=!!(void 0!==commonjsGlobal&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),n.global=n.isNode&&commonjsGlobal||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==_typeof(e)},n.isset=n.isSet=function(e,t){var r=e[t];return null!=r&&e.hasOwnProperty(t)&&("object"!=_typeof(r)||0<(Array.isArray(r)?r:Object.keys(r)).length)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(t){return null}}(),n.v=null,n.b=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n.b(e):new n.Array(e):n.Buffer?n.v(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){return e=n.LongBits.fromHash(e),n.Long?n.Long.fromBits(e.lo,e.hi,t):e.toNumber(!!t)},n.merge=i,n.lcFirst=function(e){return(e[0]||"").toLowerCase()+e.substring(1)},n.newError=o,n.ProtocolError=o("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;-1<r;--r)if(1===t[e[r]]&&this[e[r]]!==g&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n.r=function(){var e=n.Buffer;e?(n.v=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n.b=e.allocUnsafe||function(t){return new e(t)}):n.v=n.b=null}},{1:1,10:10,2:2,34:34,4:4,6:6,7:7,9:9}],36:[function(e,t,r){t.exports=function(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),r={};e.oneofsArray.length&&t("var p={}");for(var n=0;n<e.fieldsArray.length;++n){var s,c=e.i[n].resolve(),u="m"+i.safeProp(c.name);c.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",u,c.name),c.map?(t("if(!util.isObject(%s))",u)("return%j",o(c,"object"))("var k=Object.keys(%s)",u)("for(var i=0;i<k.length;++i){"),function(e,t,r){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",r)("return%j",o(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",r)("return%j",o(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",r)("return%j",o(t,"boolean key"))}}(t,c,"k[i]"),a(t,c,n,u+"[k[i]]")("}")):c.repeated?(t("if(!Array.isArray(%s))",u)("return%j",o(c,"array"))("for(var i=0;i<%s.length;++i){",u),a(t,c,n,u+"[i]")("}")):(c.partOf&&(s=i.safeProp(c.partOf.name),1===r[c.partOf.name]&&t("if(p%s===1)",s)("return%j",c.partOf.name+": multiple values"),r[c.partOf.name]=1,t("p%s=1",s)),a(t,c,n,u)),c.optional&&t("}")}return t("return null")};var n=e(14),i=e(33);function o(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function a(e,t,r,i){if(t.resolvedType)if(t.resolvedType instanceof n){e("switch(%s){",i)("default:")("return%j",o(t,"enum value"));for(var a=Object.keys(t.resolvedType.values),s=0;s<a.length;++s)e("case %i:",t.resolvedType.values[a[s]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",r,i)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",o(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",o(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",o(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",o(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",o(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",o(t,"buffer"))}return e}},{14:14,33:33}],37:[function(e,t,r){var n=e(19);r[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(1+e["@type"].lastIndexOf("/")),r=this.lookup(t);if(r)return~(t="."==(e["@type"][0]||"")?e["@type"].substr(1):e["@type"]).indexOf("/")||(t="/"+t),this.create({type_url:t,value:r.encode(r.fromObject(e)).finish()})}return this.fromObject(e)},toObject:function(e,t){var r,i="",o="";return t&&t.json&&e.type_url&&e.value&&(o=e.type_url.substring(1+e.type_url.lastIndexOf("/")),i=e.type_url.substring(0,1+e.type_url.lastIndexOf("/")),(r=this.lookup(o))&&(e=r.decode(e.value))),e instanceof this.ctor||!(e instanceof n)?this.toObject(e,t):(t=e.$type.toObject(e,t),e="."===e.$type.fullName[0]?e.$type.fullName.substr(1):e.$type.fullName,t["@type"]=o=(i=""===i?"type.googleapis.com/":i)+e,t)}}},{19:19}],38:[function(e,t,r){t.exports=d;var n,i=e(35),o=i.LongBits,a=i.base64,s=i.utf8;function c(e,t,r){this.fn=e,this.len=t,this.next=g,this.val=r}function u(){}function l(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function d(){this.len=0,this.head=new c(u,0,0),this.tail=this.head,this.states=null}function p(){return i.Buffer?function(){return(d.create=function(){return new n})()}:function(){return new d}}function _(e,t,r){t[r]=255&e}function h(e,t){this.len=e,this.next=g,this.val=t}function f(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function m(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}d.create=p(),d.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(d.alloc=i.pool(d.alloc,i.Array.prototype.subarray)),d.prototype.p=function(e,t,r){return this.tail=this.tail.next=new c(e,t,r),this.len+=t,this},(h.prototype=Object.create(c.prototype)).fn=function(e,t,r){for(;127<e;)t[r++]=127&e|128,e>>>=7;t[r]=e},d.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new h((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},d.prototype.int32=function(e){return e<0?this.p(f,10,o.fromNumber(e)):this.uint32(e)},d.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},d.prototype.int64=d.prototype.uint64=function(e){return e=o.from(e),this.p(f,e.length(),e)},d.prototype.sint64=function(e){return e=o.from(e).zzEncode(),this.p(f,e.length(),e)},d.prototype.bool=function(e){return this.p(_,1,e?1:0)},d.prototype.sfixed32=d.prototype.fixed32=function(e){return this.p(m,4,e>>>0)},d.prototype.sfixed64=d.prototype.fixed64=function(e){return e=o.from(e),this.p(m,4,e.lo).p(m,4,e.hi)},d.prototype.float=function(e){return this.p(i.float.writeFloatLE,4,e)},d.prototype.double=function(e){return this.p(i.float.writeDoubleLE,8,e)};var v=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};d.prototype.bytes=function(e){var t,r=e.length>>>0;return r?(i.isString(e)&&(t=d.alloc(r=a.length(e)),a.decode(e,t,0),e=t),this.uint32(r).p(v,r,e)):this.p(_,1,0)},d.prototype.string=function(e){var t=s.length(e);return t?this.uint32(t).p(s.write,t,e):this.p(_,1,0)},d.prototype.fork=function(){return this.states=new l(this),this.head=this.tail=new c(u,0,0),this.len=0,this},d.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(u,0,0),this.len=0),this},d.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},d.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},d.r=function(e){n=e,d.create=p(),n.r()}},{35:35}],39:[function(e,t,r){t.exports=o;var n=e(38);(o.prototype=Object.create(n.prototype)).constructor=o;var i=e(35);function o(){n.call(this)}function a(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}o.r=function(){o.alloc=i.b,o.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},o.prototype.bytes=function(e){var t=(e=i.isString(e)?i.v(e,"base64"):e).length>>>0;return this.uint32(t),t&&this.p(o.writeBytesBuffer,t,e),this},o.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this.p(a,t,e),this},o.r()},{35:35,38:38}]},e={},t=[16],i=function t(n){var i=e[n];return i||r[n][0].call(i=e[n]={exports:{}},t,i,i.exports),i.exports}(t[0]),i.util.global.protobuf=i,module&&module.exports&&(module.exports=i)}()})(protobuf_min);var protobuf_minExports=protobuf_min.exports,$protobuf=getDefaultExportFromCjs$1(protobuf_minExports),proto=($protobuf.roots.default||($protobuf.roots.default=new $protobuf.Root)).addJSON({cg:{nested:{protocol:{nested:_objectSpread2(_objectSpread2(_objectSpread2(_objectSpread2({},GoogleWrapProto),PB_MESSAGE.MSG_VALUES),PB_MESSAGE.MSG_FIELDS),{},{MsgType:{values:PB_MESSAGE.TYPES},KeyboardKeyType:{values:{KeyboardKeyNone:0,KeyboardKeyBack:8,KeyboardKeyTab:9,KeyboardKeyClear:12,KeyboardKeyReturn:13,KeyboardKeyShift:16,KeyboardKeyControl:17,KeyboardKeyMenu:18,KeyboardKeyPause:19,KeyboardKeyCapital:20,KeyboardKeyKana:21,KeyboardKeyImeOn:22,KeyboardKeyJunja:23,KeyboardKeyFinal:24,KeyboardKeyHanja:25,KeyboardKeyImeOff:26,KeyboardKeyEscape:27,KeyboardKeyConvert:28,KeyboardKeyNonConvert:29,KeyboardKeyAccept:30,KeyboardKeyModeChange:31,KeyboardKeySpace:32,KeyboardKeyPrior:33,KeyboardKeyNext:34,KeyboardKeyEnd:35,KeyboardKeyHome:36,KeyboardKeyLeft:37,KeyboardKeyUp:38,KeyboardKeyRight:39,KeyboardKeyDown:40,KeyboardKeySelect:41,KeyboardKeyPrint:42,KeyboardKeyExecute:43,KeyboardKeySnapshot:44,KeyboardKeyInsert:45,KeyboardKeyDelete:46,KeyboardKeyHelp:47,KeyboardKey0:48,KeyboardKey1:49,KeyboardKey2:50,KeyboardKey3:51,KeyboardKey4:52,KeyboardKey5:53,KeyboardKey6:54,KeyboardKey7:55,KeyboardKey8:56,KeyboardKey9:57,KeyboardKeyA:65,KeyboardKeyB:66,KeyboardKeyC:67,KeyboardKeyD:68,KeyboardKeyE:69,KeyboardKeyF:70,KeyboardKeyG:71,KeyboardKeyH:72,KeyboardKeyI:73,KeyboardKeyJ:74,KeyboardKeyK:75,KeyboardKeyL:76,KeyboardKeyM:77,KeyboardKeyN:78,KeyboardKeyO:79,KeyboardKeyP:80,KeyboardKeyQ:81,KeyboardKeyR:82,KeyboardKeyS:83,KeyboardKeyT:84,KeyboardKeyU:85,KeyboardKeyV:86,KeyboardKeyW:87,KeyboardKeyX:88,KeyboardKeyY:89,KeyboardKeyZ:90,KeyboardKeyLwin:91,KeyboardKeyRwin:92,KeyboardKeyApps:93,KeyboardKeySleep:95,KeyboardKeyNumpad0:96,KeyboardKeyNumpad1:97,KeyboardKeyNumpad2:98,KeyboardKeyNumpad3:99,KeyboardKeyNumpad4:100,KeyboardKeyNumpad5:101,KeyboardKeyNumpad6:102,KeyboardKeyNumpad7:103,KeyboardKeyNumpad8:104,KeyboardKeyNumpad9:105,KeyboardKeyMultiply:106,KeyboardKeyAdd:107,KeyboardKeySeparator:108,KeyboardKeySubtract:109,KeyboardKeyDecimal:110,KeyboardKeyDivide:111,KeyboardKeyF1:112,KeyboardKeyF2:113,KeyboardKeyF3:114,KeyboardKeyF4:115,KeyboardKeyF5:116,KeyboardKeyF6:117,KeyboardKeyF7:118,KeyboardKeyF8:119,KeyboardKeyF9:120,KeyboardKeyF10:121,KeyboardKeyF11:122,KeyboardKeyF12:123,KeyboardKeyF13:124,KeyboardKeyF14:125,KeyboardKeyF15:126,KeyboardKeyF16:127,KeyboardKeyF17:128,KeyboardKeyF18:129,KeyboardKeyF19:130,KeyboardKeyF20:131,KeyboardKeyF21:132,KeyboardKeyF22:133,KeyboardKeyF23:134,KeyboardKeyF24:135,KeyboardKeyNavigationView:136,KeyboardKeyNavigationMenu:137,KeyboardKeyNavigationUp:138,KeyboardKeyNavigationDown:139,KeyboardKeyNavigationLeft:140,KeyboardKeyNavigationRight:141,KeyboardKeyNavigationAccept:142,KeyboardKeyNavigationCancel:143,KeyboardKeyNumlock:144,KeyboardKeyScroll:145,KeyboardKeyOemNecEqual:146,KeyboardKeyOemFjMasshou:147,KeyboardKeyOemFjTouroku:148,KeyboardKeyOemFjLoya:149,KeyboardKeyOemFjRoya:150,KeyboardKeyLshift:160,KeyboardKeyRshift:161,KeyboardKeyLcontrol:162,KeyboardKeyRcontrol:163,KeyboardKeyLmenu:164,KeyboardKeyRmenu:165,KeyboardKeyBrowserBack:166,KeyboardKeyBrowserForward:167,KeyboardKeyBrowserRefresh:168,KeyboardKeyBrowserStop:169,KeyboardKeyBrowserSearch:170,KeyboardKeyBrowserFavorites:171,KeyboardKeyBrowserHome:172,KeyboardKeyVolumeMute:173,KeyboardKeyVolumeDown:174,KeyboardKeyVolumeUp:175,KeyboardKeyMediaNextTrack:176,KeyboardKeyMediaPrevTrack:177,KeyboardKeyMediaStop:178,KeyboardKeyMediaPlayPause:179,KeyboardKeyLaunchMail:180,KeyboardKeyLaunchMediaSelect:181,KeyboardKeyLaunchApp1:182,KeyboardKeyLaunchApp2:183,KeyboardKeyOem1:186,KeyboardKeyOemPlus:187,KeyboardKeyOemComma:188,KeyboardKeyOemMinus:189,KeyboardKeyOemPeriod:190,KeyboardKeyOem2:191,KeyboardKeyOem3:192,KeyboardKeyGamepadA:195,KeyboardKeyGamepadB:196,KeyboardKeyGamepadX:197,KeyboardKeyGamepadY:198,KeyboardKeyGamepadRightShoulder:199,KeyboardKeyGamepadLeftShoulder:200,KeyboardKeyGamepadLeftTrigger:201,KeyboardKeyGamepadRightTrigger:202,KeyboardKeyGamepadDpadUp:203,KeyboardKeyGamepadDpadDown:204,KeyboardKeyGamepadDpadLeft:205,KeyboardKeyGamepadDpadRight:206,KeyboardKeyGamepadMenu:207,KeyboardKeyGamepadView:208,KeyboardKeyGamepadLeftThumbStickButton:209,KeyboardKeyGamepadRightThumbStickButton:210,KeyboardKeyGamepadLeftThumbStickUp:211,KeyboardKeyGamepadLeftThumbStickDown:212,KeyboardKeyGamepadLeftThumbStickRight:213,KeyboardKeyGamepadLeftThumbStickLeft:214,KeyboardKeyGamepadRightThumbStickUp:215,KeyboardKeyGamepadRightThumbStickDown:216,KeyboardKeyGamepadRightThumbStickRight:217,KeyboardKeyGamepadRightThumbStickLeft:218,KeyboardKeyOem4:219,KeyboardKeyOem5:220,KeyboardKeyOem6:221,KeyboardKeyOem7:222,KeyboardKeyOem8:223,KeyboardKeyOemAx:225,KeyboardKeyOem102:226,KeyboardKeyIcoHelp:227,KeyboardKeyIco00:228,KeyboardKeyProcessKey:229,KeyboardKeyIcoClear:230,KeyboardKeyPacket:231,KeyboardKeyOemReset:233,KeyboardKeyOemJump:234,KeyboardKeyOemPa1:235,KeyboardKeyOemPa2:236,KeyboardKeyOemPa3:237,KeyboardKeyOemWsCtrl:238,KeyboardKeyOemCuSel:239,KeyboardKeyOemAttn:240,KeyboardKeyOemFinish:241,KeyboardKeyOemCopy:242,KeyboardKeyOemAuto:243,KeyboardKeyOemEnlw:244,KeyboardKeyOemBackTab:245,KeyboardKeyAttn:246,KeyboardKeyCrSel:247,KeyboardKeyExSel:248,KeyboardKeyErEof:249,KeyboardKeyPlay:250,KeyboardKeyZoom:251,KeyboardKeyNoName:252,KeyboardKeyPa1:253,KeyboardKeyOemClear:254}},MouseKeyType:{values:{MouseKeyNone:0,MouseKeyLBUTTON:1,MouseKeyRBUTTON:2,MouseKeyMBUTTON:4,MouseKeyXBUTTON1:5,MouseKeyXBUTTON2:6}},GCKeyType:{values:{GCKeyNone:0,GCKeyDPAD_UP:1,GCKeyDPAD_DOWN:2,GCKeyDPAD_LEFT:4,GCKeyDPAD_RIGHT:8,GCKeySTART:16,GCKeyBACK:32,GCKeyLEFT_THUMB:64,GCKeyRIGHT_THUMB:128,GCKeyLEFT_SHOULDER:256,GCKeyRIGHT_SHOULDER:512,GCKeyA:4096,GCKeyB:8192,GCKeyX:16384,GCKeyY:32768,GCKeyXBOX:65536,GCKeySHARE:131072}},ImeCompositionType:{values:{ImeCompositionBegin:0,ImeCompositionEnd:1,ImeComposition:2}},TouchType:{values:{TouchUp:0,TouchDown:1,TouchMove:2,TouchCancel:3}},MsgInputType:{values:{MsgInputImeComposition:0,MsgInputCursorPos:1,MsgInputKeyboardKey:2,MsgInputMouseKey:3,MsgInputMouseMove:4,MsgInputMouseWheel:5,InputGCGamePad:6,MsgInputTouch:7}},InputImeComposition:{fields:{type:{type:"ImeCompositionType",id:1},str:{type:"string",id:2}}},InputCursorPos:{fields:{w:{type:"sint32",id:1},h:{type:"sint32",id:2},x:{type:"sint32",id:3},y:{type:"sint32",id:4}}},InputKeyboard:{fields:{key:{type:"KeyboardKeyType",id:1},state:{type:"bool",id:2}}},InputMouseKey:{fields:{key:{type:"MouseKeyType",id:1},state:{type:"bool",id:2}}},InputMouseMove:{fields:{x:{type:"sint32",id:1},y:{type:"sint32",id:2}}},InputMouseWheel:{fields:{wheel:{type:"sint32",id:1},hwheel:{type:"sint32",id:2}}},InputTouch:{fields:{id:{type:"sint32",id:1},type:{type:"TouchType",id:2},w:{type:"sint32",id:3},h:{type:"sint32",id:4},x:{type:"sint32",id:5},y:{type:"sint32",id:6},radius:{type:"float",id:7},pressure:{type:"float",id:8}}},InputTouchArray:{fields:{touches:{rule:"repeated",type:"InputTouch",id:1}}},MsgOutputType:{values:{MsgOutputImeState:0,MsgOutputUrl:1,MsgOutputCursorPos:2,MsgOutputCursorVisibility:3,MsgOutputCursorImage:4,MsgOutputGCVibration:5}},OutputImeState:{fields:{state:{type:"bool",id:1},w:{type:"sint32",id:2},h:{type:"sint32",id:3},x:{type:"sint32",id:4},y:{type:"sint32",id:5},fw:{type:"sint32",id:6},fh:{type:"sint32",id:7}}},OutputUrl:{fields:{url:{type:"string",id:1},data:{type:"bytes",id:2}}},OutputCursorPos:{fields:{w:{type:"sint32",id:1},h:{type:"sint32",id:2},x:{type:"sint32",id:3},y:{type:"sint32",id:4}}},OutputCursorVisibility:{fields:{visible:{type:"bool",id:1}}},OutputCursorImage:{fields:{id:{type:"sint32",id:1},w:{type:"sint32",id:2},h:{type:"sint32",id:3},x:{type:"sint32",id:4},y:{type:"sint32",id:5},data:{type:"bytes",id:6}}},MsgRawType:{values:{MsgRawBinary:0,MsgRawString:1}},RawBinary:{fields:{bin:{type:"bytes",id:1}}},RawString:{fields:{str:{type:"string",id:1}}},MsgHeartBeatType:{values:{MsgHeartBeatDefault:0}},HeartBeat:{fields:{client:{type:"bool",id:1},ts:{type:"sint64",id:2}}},MsgStateType:{values:{MsgStateBegin:0,MsgStateEnd:1,MsgStateActive:2}},StateBegin:{fields:{code:{type:"sint64",id:1},msg:{type:"string",id:2}}},StateEnd:{fields:{code:{type:"sint64",id:1},msg:{type:"string",id:2}}},StateActive:{fields:{active:{type:"bool",id:1}}},DeviceType:{values:{DeviceMicrophone:0,DeviceCamara:1,DeviceKeyboard:2,DeviceMouse:3,DeviceGC:4,DeviceTouchScreen:5,DeviceHeadset:100,DeviceDisplay:101,DeviceSensorLocation:200,DeviceSensorAcceleration:201,DeviceSensorGravity:202,DeviceSensorAttitude:203,DeviceSensorGyro:204,DeviceSensorMagnetic:205,DeviceSensorProximity:206,DeviceSensorPedometer:207,DeviceSensorAltitude:208,DeviceSensorPressure:209,DeviceSensorLight:210,DeviceSensorTemprature:211}},MsgDeviceType:{values:{MsgDevicePlugin:0,MsgDeviceUnplug:1,MsgDeviceControl:2,MsgDeviceState:3}},Device:{fields:{index:{type:"sint32",id:1},type:{type:"DeviceType",id:2},name:{type:"string",id:3},vid:{type:"sint32",id:4},pid:{type:"sint32",id:5},state:{type:"bool",id:6},info:{type:"bytes",id:8}}},DeviceInfoMicrophone:{fields:{format:{type:"AudioSampleFormatType",id:1},rate:{type:"sint32",id:2},channels:{type:"sint32",id:3},channelLayout:{type:"AudioChannelLayout",id:4}}},DeviceInfoCamera:{fields:{format:{type:"VideoPixelFormatType",id:1},range:{type:"VideoColorRangeType",id:2},space:{type:"VideoColorSpaceType",id:3},bitdepth:{type:"sint32",id:4},width:{type:"sint32",id:5},height:{type:"sint32",id:6},fpsNom:{type:"sint32",id:7},fpsDen:{type:"sint32",id:8}}},DeviceInfoGC:{fields:{index:{type:"sint32",id:1}}},DeviceInfoHeadset:{fields:{format:{type:"AudioSampleFormatType",id:1},rate:{type:"sint32",id:2},channels:{type:"sint32",id:3},channelLayout:{type:"AudioChannelLayout",id:4}}},DeviceInfoDisplay:{fields:{format:{type:"VideoPixelFormatType",id:1},range:{type:"VideoColorRangeType",id:2},space:{type:"VideoColorSpaceType",id:3},bitdepth:{type:"sint32",id:4},width:{type:"sint32",id:5},height:{type:"sint32",id:6},fpsNom:{type:"sint32",id:7},fpsDen:{type:"sint32",id:8}}},DeviceControl:{fields:{type:{type:"DeviceType",id:1},enable:{type:"bool",id:2},params:{type:"bytes",id:3}}},DeviceControlMicrophone:{fields:{format:{type:"AudioSampleFormatType",id:1},rate:{type:"sint32",id:2},channels:{type:"sint32",id:3},channelLayout:{type:"AudioChannelLayout",id:4}}},DeviceControlCamera:{fields:{width:{type:"sint32",id:1},height:{type:"sint32",id:2}}},DeviceState:{fields:{enabled:{type:"bool",id:1}}},AudioCodecType:{values:{AudioCodecAAC:0}},AudioSampleFormatType:{values:{AudioSampleFormatU8:0,AudioSampleFormatS16:1,AudioSampleFormatS32:2,AudioSampleFormatFlt:3,AudioSampleFormatDbl:4,AudioSampleFormatU8p:5,AudioSampleFormatS16p:6,AudioSampleFormatS32p:7,AudioSampleFormatFltp:8,AudioSampleFormatDblp:9,AudioSampleFormatS64:10,AudioSampleFormatS64p:11}},AudioChannelLayout:{values:{AudioChannelLayoutUnknown:0,AudioChannelLayoutMono:1,AudioChannelLayoutStereo:2,AudioChannelLayout2Point1:3,AudioChannelLayout5Point1:4,AudioChannelLayout5Point1Back:5,AudioChannelLayout7Point1:6,AudioChannelLayout7Point1Wide:7,AudioChannelLayout7Point1WideBack:8}},VideoCodecType:{values:{VideoCodecAVC:0,VideoCodecHEVC:1,VideoCodecVVC:2}},VideoPixelFormatType:{values:{VideoPixelFormatYUV420P:0,VideoPixelFormatYUV422P:1,VideoPixelFormatYUV444P:2,VideoPixelFormatYUVNV12:3,VideoPixelFormatYUVNV21:4}},VideoColorRangeType:{values:{VideoColorRangeLIMITED:0,VideoColorRangeFULL:1}},VideoColorSpaceType:{values:{VideoColorSpaceSDR:0,VideoColorSpaceHLG:1,VideoColorSpacePQ:2}},MsgAVInputType:{values:{MsgAVInputAudio:0,MsgAVInputVideo:1}},MsgAVOutputType:{values:{MsgAVOutputAudioFormat:0,MsgAVOutputAudioFormatLevel:1,MsgAVOutputAudio:2,MsgAVOutputVideoFormat:10,MsgAVOutputVideoFormatLevel:11,MsgAVOutputVideo:12,MsgAVOutputVideoSceneChange:13}},AVTS:{fields:{gbts:{type:"sint64",id:1},gpts:{type:"sint64",id:2},gsts:{type:"sint64",id:3},lrts:{type:"sint64",id:4},lcts:{type:"sint64",id:5},lets:{type:"sint64",id:6},ldts:{type:"sint64",id:7},lsts:{type:"sint64",id:8},trts:{type:"sint64",id:9},tcts:{type:"sint64",id:10},tsts:{type:"sint64",id:11}}},AVAudioFormat:{fields:{format:{type:"AudioCodecType",id:1},rate:{type:"sint32",id:2},channels:{type:"sint32",id:3},channelLayout:{type:"AudioChannelLayout",id:4},samples:{type:"sint32",id:5},bitrate:{type:"sint32",id:6}}},AVAudioFrame:{fields:{format:{type:"AVAudioFormat",id:1},ts:{type:"AVTS",id:2},data:{type:"bytes",id:3}}},AVVideoFormatLevelType:{values:{AVVideoFormatLevelNone:0,AVVideoFormatLevel360p30r3000:1,AVVideoFormatLevel480p30r4000:2,AVVideoFormatLevel540p30r4000:3,AVVideoFormatLevel576p30r4000:4,AVVideoFormatLevel576p60r4000:5,AVVideoFormatLevel720p30r4000:6,AVVideoFormatLevel720p60r4000:7,AVVideoFormatLevel720p30r5000:8,AVVideoFormatLevel720p60r5000:9,AVVideoFormatLevel720p30r6000:10,AVVideoFormatLevel720p60r6000:11,AVVideoFormatLevel720p30r8000:12,AVVideoFormatLevel720p60r8000:13,AVVideoFormatLevel1080p30r4000:14,AVVideoFormatLevel1080p60r4000:15,AVVideoFormatLevel1080p30r5000:16,AVVideoFormatLevel1080p60r5000:17,AVVideoFormatLevel1080p30r6000:18,AVVideoFormatLevel1080p60r6000:19,AVVideoFormatLevel1080p30r8000:20,AVVideoFormatLevel1080p60r8000:21,AVVideoFormatLevel1080p30r10000:22,AVVideoFormatLevel1080p60r10000:23,AVVideoFormatLevel1080p30r12000:24,AVVideoFormatLevel1080p60r12000:25,AVVideoFormatLevel1440p30r8000:26,AVVideoFormatLevel1440p60r8000:27,AVVideoFormatLevel1440p30r10000:28,AVVideoFormatLevel1440p60r10000:29,AVVideoFormatLevel1440p30r12000:30,AVVideoFormatLevel1440p60r12000:31,AVVideoFormatLevel1440p30r14000:32,AVVideoFormatLevel1440p60r14000:33,AVVideoFormatLevel1440p30r16000:34,AVVideoFormatLevel1440p60r16000:35,AVVideoFormatLevel1440p30r18000:36,AVVideoFormatLevel1440p60r18000:37,AVVideoFormatLevel1440p30r20000:38,AVVideoFormatLevel1440p60r20000:39,AVVideoFormatLevel2160p30r20000:40,AVVideoFormatLevel2160p60r20000:41,AVVideoFormatLevel2160p30r25000:42,AVVideoFormatLevel2160p60r25000:43,AVVideoFormatLevel2160p30r30000:44,AVVideoFormatLevel2160p60r30000:45,AVVideoFormatLevel2160p30r35000:46,AVVideoFormatLevel2160p60r35000:47,AVVideoFormatLevel2160p30r40000:48,AVVideoFormatLevel2160p60r40000:49}},AVVideoFormatLevel:{fields:{level:{type:"sint32",id:1}}},AVVideoFormatLevelResp:{fields:{ok:{type:"bool",id:1},levelFrom:{type:"sint32",id:2},levelTo:{type:"sint32",id:3},format:{type:"AVVideoFormat",id:4},result:{type:"sint32",id:5}}},AVVideoFormat:{fields:{format:{type:"VideoCodecType",id:1},width:{type:"sint32",id:2},height:{type:"sint32",id:3},fpsNom:{type:"sint32",id:4},fpsDen:{type:"sint32",id:5},range:{type:"VideoColorRangeType",id:6},space:{type:"VideoColorSpaceType",id:7},npl:{type:"sint32",id:8},bitdepth:{type:"sint32",id:9},bitrate:{type:"sint32",id:10}}},AVVideoFrame:{fields:{format:{type:"AVVideoFormat",id:1},ts:{type:"AVTS",id:2},data:{type:"bytes",id:3}}}})}}}}),Stream=function(){function e(t){if(_classCallCheck(this,e),!(t instanceof ArrayBuffer))throw new Error("class Stream: buffer is invalid");this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}return _createClass(e,[{key:"length",get:function(){return this.buffer.byteLength}},{key:"position",get:function(){return this.dataview.position},set:function(e){this.dataview.position=e}},{key:"back",value:function(e){this.position-=e}},{key:"backTo",value:function(e){this.position=e}},{key:"skip",value:function(t){for(var r=Math.floor(t/4),n=t%4,i=0;i<r;i++)e.readByte(this.dataview,4);n>0&&e.readByte(this.dataview,n)}},{key:"readBuffer",value:function(e){return this.dataview.position+=e,this.buffer.slice(this.dataview.position-e,this.dataview.position)}},{key:"readFloat32",value:function(){var e=this.dataview;return e.getFloat32(e.position)}},{key:"readFloat64",value:function(){var e=this.dataview;return e.getFloat64(e.position)}},{key:"readString",value:function(e){for(var t="",r=0;r<e;r++)t+=String.fromCharCode(this.readUint8());return t}},{key:"readUint8",value:function(){return e.readByte(this.dataview,1)}},{key:"readUint16",value:function(t){return e.readByte(this.dataview,2,!1,t)}},{key:"readUint24",value:function(t){return e.readByte(this.dataview,3,!1,t)}},{key:"readUint32",value:function(t){return e.readByte(this.dataview,4,!1,t)}},{key:"readUint64",value:function(){return e.readByte(this.dataview,8)}},{key:"readInt8",value:function(t){return e.readByte(this.dataview,1,!0,t)}},{key:"readInt16",value:function(t){return e.readByte(this.dataview,2,!0,t)}},{key:"readInt32",value:function(t){return e.readByte(this.dataview,4,!0,t)}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}}],[{key:"readByte",value:function(e,t,r,n){var i;switch(t){case 1:i=r?e.getInt8(e.position):e.getUint8(e.position);break;case 2:i=r?e.getInt16(e.position,n):e.getUint16(e.position,n);break;case 3:if(r)throw"not supported for readByte 3";n?(i=e.getUint8(e.position),i|=e.getUint16(e.position+1,n)<<8):(i=e.getUint16(e.position)<<8,i|=e.getUint8(e.position+2));break;case 4:i=r?e.getInt32(e.position,n):e.getUint32(e.position,n);break;case 8:if(r)throw"not supported for readBody 8";i=e.getUint32(e.position)*Math.pow(2,32),i+=e.getUint32(e.position+4);break;default:i=""}return e.position+=t,i}}]),e}(),KEYCODE_MAP={KeyA:"KeyboardKeyA",KeyB:"KeyboardKeyB",KeyC:"KeyboardKeyC",KeyD:"KeyboardKeyD",KeyE:"KeyboardKeyE",KeyF:"KeyboardKeyF",KeyG:"KeyboardKeyG",KeyH:"KeyboardKeyH",KeyI:"KeyboardKeyI",KeyJ:"KeyboardKeyJ",KeyK:"KeyboardKeyK",KeyL:"KeyboardKeyL",KeyM:"KeyboardKeyM",KeyN:"KeyboardKeyN",KeyO:"KeyboardKeyO",KeyP:"KeyboardKeyP",KeyQ:"KeyboardKeyQ",KeyR:"KeyboardKeyR",KeyS:"KeyboardKeyS",KeyT:"KeyboardKeyT",KeyU:"KeyboardKeyU",KeyV:"KeyboardKeyV",KeyW:"KeyboardKeyW",KeyX:"KeyboardKeyX",KeyY:"KeyboardKeyY",KeyZ:"KeyboardKeyZ",Digit0:"KeyboardKey0",Digit1:"KeyboardKey1",Digit2:"KeyboardKey2",Digit3:"KeyboardKey3",Digit4:"KeyboardKey4",Digit5:"KeyboardKey5",Digit6:"KeyboardKey6",Digit7:"KeyboardKey7",Digit8:"KeyboardKey8",Digit9:"KeyboardKey9",Backquote:"KeyboardKeyOem3",Minus:"KeyboardKeyOemMinus",Equal:"KeyboardKeyOemPlus",BracketLeft:"KeyboardKeyOem4",BracketRight:"KeyboardKeyOem6",Backslash:"KeyboardKeyOem5",Semicolon:"KeyboardKeyOem1",Quote:"KeyboardKeyOem7",Comma:"KeyboardKeyOemComma",Period:"KeyboardKeyOemPeriod",Slash:"KeyboardKeyOem2",Escape:"KeyboardKeyEscape",Enter:"KeyboardKeyReturn",Backspace:"KeyboardKeyBack",Tab:"KeyboardKeyTab",CapsLock:"KeyboardKeyCapital",ShiftLeft:"KeyboardKeyLshift",ShiftRight:"KeyboardKeyRshift",ControlLeft:"KeyboardKeyLcontrol",ControlRight:"KeyboardKeyRcontrol",AltLeft:"KeyboardKeyLmenu",AltRight:"KeyboardKeyRmenu",MetaLeft:"KeyboardKeyLwin",MetaRight:"KeyboardKeyRwin",Space:"KeyboardKeySpace",Numpad0:"KeyboardKeyNumpad0",Numpad1:"KeyboardKeyNumpad1",Numpad2:"KeyboardKeyNumpad2",Numpad3:"KeyboardKeyNumpad3",Numpad4:"KeyboardKeyNumpad4",Numpad5:"KeyboardKeyNumpad5",Numpad6:"KeyboardKeyNumpad6",Numpad7:"KeyboardKeyNumpad7",Numpad8:"KeyboardKeyNumpad8",Numpad9:"KeyboardKeyNumpad9",NumLock:"KeyboardKeyNumlock",NumpadDivide:"KeyboardKeyDivide",NumpadMultiply:"KeyboardKeyMultiply",NumpadSubtract:"KeyboardKeySubtract",NumpadAdd:"KeyboardKeyAdd",NumpadDecimal:"KeyboardKeyDecimal",NumpadEnter:"KeyboardKeyReturn",ArrowUp:"KeyboardKeyUp",ArrowDown:"KeyboardKeyDown",ArrowLeft:"KeyboardKeyLeft",ArrowRight:"KeyboardKeyRight",PageUp:"KeyboardKeyPrior",PageDown:"KeyboardKeyNext",Home:"KeyboardKeyHome",End:"KeyboardKeyEnd",Insert:"KeyboardKeyInsert",Delete:"KeyboardKeyDelete",F1:"KeyboardKeyF1",F2:"KeyboardKeyF2",F3:"KeyboardKeyF3",F4:"KeyboardKeyF4",F5:"KeyboardKeyF5",F6:"KeyboardKeyF6",F7:"KeyboardKeyF7",F8:"KeyboardKeyF8",F9:"KeyboardKeyF9",F10:"KeyboardKeyF10",F11:"KeyboardKeyF11",F12:"KeyboardKeyF12",F13:"KeyboardKeyF13",F14:"KeyboardKeyF14",F15:"KeyboardKeyF15"},MOUSE_BUTTON_MAP={0:"MouseKeyLBUTTON",1:"MouseKeyMBUTTON",2:"MouseKeyRBUTTON",3:"MouseKeyXBUTTON1",4:"MouseKeyXBUTTON2"},JSBI=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var i;if(_classCallCheck(this,r),(i=t.call(this,e)).sign=n,Object.setPrototypeOf(_assertThisInitialized(i),r.prototype),e>r.__kMaxLength)throw new RangeError("Maximum BigInt size exceeded");return _possibleConstructorReturn(i)}return _createClass(r,[{key:"toDebugString",value:function(){var e,t=["BigInt["],r=_createForOfIteratorHelper(this);try{for(r.s();!(e=r.n()).done;){var n=e.value;t.push((n?(n>>>0).toString(16):n)+", ")}}catch(i){r.e(i)}finally{r.f()}return t.push("]"),t.join("")}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;if(2>e||36<e)throw new RangeError("toString() radix argument must be between 2 and 36");return 0===this.length?"0":0==(e&e-1)?r.__toStringBasePowerOfTwo(this,e):r.__toStringGeneric(this,e,!1)}},{key:"valueOf",value:function(){throw new Error("Convert JSBI instances to native numbers using `toNumber`.")}},{key:"__copy",value:function(){for(var e=new r(this.length,this.sign),t=0;t<this.length;t++)e[t]=this[t];return e}},{key:"__trim",value:function(){for(var e=this.length,t=this[e-1];0===t;)t=this[--e-1],this.pop();return 0===e&&(this.sign=!1),this}},{key:"__initializeDigits",value:function(){for(var e=0;e<this.length;e++)this[e]=0}},{key:"__clzmsd",value:function(){return r.__clz30(this.__digit(this.length-1))}},{key:"__inplaceMultiplyAdd",value:function(e,t,n){n>this.length&&(n=this.length);for(var i=32767&e,o=e>>>15,a=0,s=t,c=0;c<n;c++){var u=this.__digit(c),l=32767&u,d=u>>>15,p=r.__imul(l,i),_=r.__imul(l,o),h=r.__imul(d,i),f=s+p+a;a=f>>>30,f&=1073741823,a+=(f+=((32767&_)<<15)+((32767&h)<<15))>>>30,s=r.__imul(d,o)+(_>>>15)+(h>>>15),this.__setDigit(c,1073741823&f)}if(0!=a||0!==s)throw new Error("implementation bug")}},{key:"__inplaceAdd",value:function(e,t,r){for(var n=0,i=0;i<r;i++){var o=this.__halfDigit(t+i)+e.__halfDigit(i)+n;n=o>>>15,this.__setHalfDigit(t+i,32767&o)}return n}},{key:"__inplaceSub",value:function(e,t,r){var n=0;if(1&t){t>>=1;for(var i=this.__digit(t),o=32767&i,a=0;a<r-1>>>1;a++){var s=e.__digit(a),c=(i>>>15)-(32767&s)-n;n=1&c>>>15,this.__setDigit(t+a,(32767&c)<<15|32767&o),n=1&(o=(32767&(i=this.__digit(t+a+1)))-(s>>>15)-n)>>>15}var u=e.__digit(a),l=(i>>>15)-(32767&u)-n;if(n=1&l>>>15,this.__setDigit(t+a,(32767&l)<<15|32767&o),t+a+1>=this.length)throw new RangeError("out of bounds");0==(1&r)&&(n=1&(o=(32767&(i=this.__digit(t+a+1)))-(u>>>15)-n)>>>15,this.__setDigit(t+e.length,1073709056&i|32767&o))}else{t>>=1;for(var d=0;d<e.length-1;d++){var p=this.__digit(t+d),_=e.__digit(d),h=(32767&p)-(32767&_)-n,f=(p>>>15)-(_>>>15)-(n=1&h>>>15);n=1&f>>>15,this.__setDigit(t+d,(32767&f)<<15|32767&h)}var m=this.__digit(t+d),g=e.__digit(d),v=(32767&m)-(32767&g)-n;n=1&v>>>15;var y=0;0==(1&r)&&(n=1&(y=(m>>>15)-(g>>>15)-n)>>>15),this.__setDigit(t+d,(32767&y)<<15|32767&v)}return n}},{key:"__inplaceRightShift",value:function(e){if(0!==e){for(var t=this.__digit(0)>>>e,r=this.length-1,n=0;n<r;n++){var i=this.__digit(n+1);this.__setDigit(n,1073741823&i<<30-e|t),t=i>>>e}this.__setDigit(r,t)}}},{key:"__digit",value:function(e){return this[e]}},{key:"__unsignedDigit",value:function(e){return this[e]>>>0}},{key:"__setDigit",value:function(e,t){this[e]=0|t}},{key:"__setDigitGrow",value:function(e,t){this[e]=0|t}},{key:"__halfDigitLength",value:function(){var e=this.length;return 32767>=this.__unsignedDigit(e-1)?2*e-1:2*e}},{key:"__halfDigit",value:function(e){return 32767&this[e>>>1]>>>15*(1&e)}},{key:"__setHalfDigit",value:function(e,t){var r=e>>>1,n=this.__digit(r),i=1&e?32767&n|t<<15:1073709056&n|32767&t;this.__setDigit(r,i)}}],[{key:"BigInt",value:function(e){var t=Math.floor,n=Number.isFinite;if("number"==typeof e){if(0===e)return r.__zero();if(r.__isOneDigitInt(e))return 0>e?r.__oneDigit(-e,!0):r.__oneDigit(e,!1);if(!n(e)||t(e)!==e)throw new RangeError("The number "+e+" cannot be converted to BigInt because it is not an integer");return r.__fromDouble(e)}if("string"==typeof e){var i=r.__fromString(e);if(null===i)throw new SyntaxError("Cannot convert "+e+" to a BigInt");return i}if("boolean"==typeof e)return!0===e?r.__oneDigit(1,!1):r.__zero();if("object"==_typeof(e)){if(e.constructor===r)return e;var o=r.__toPrimitive(e);return r.BigInt(o)}throw new TypeError("Cannot convert "+e+" to a BigInt")}},{key:"toNumber",value:function(e){var t=e.length;if(0===t)return 0;if(1===t){var n=e.__unsignedDigit(0);return e.sign?-n:n}var i=e.__digit(t-1),o=r.__clz30(i),a=30*t-o;if(1024<a)return e.sign?-1/0:1/0;var s=a-1,c=i,u=t-1,l=o+3,d=32===l?0:c<<l;d>>>=12;var p=l-12,_=12<=l?0:c<<20+l,h=20+l;for(0<p&&0<u&&(u--,d|=(c=e.__digit(u))>>>30-p,_=c<<p+2,h=p+2);0<h&&0<u;)u--,c=e.__digit(u),_|=30<=h?c<<h-30:c>>>30-h,h-=30;var f=r.__decideRounding(e,h,u,c);if((1===f||0===f&&1==(1&_))&&(0===(_=_+1>>>0)&&(0!=++d>>>20&&(d=0,1023<++s))))return e.sign?-1/0:1/0;var m=e.sign?-2147483648:0;return s=s+1023<<20,r.__kBitConversionInts[1]=m|s|d,r.__kBitConversionInts[0]=_,r.__kBitConversionDouble[0]}},{key:"unaryMinus",value:function(e){if(0===e.length)return e;var t=e.__copy();return t.sign=!e.sign,t}},{key:"bitwiseNot",value:function(e){return e.sign?r.__absoluteSubOne(e).__trim():r.__absoluteAddOne(e,!0)}},{key:"exponentiate",value:function(e,t){if(t.sign)throw new RangeError("Exponent must be positive");if(0===t.length)return r.__oneDigit(1,!1);if(0===e.length)return e;if(1===e.length&&1===e.__digit(0))return e.sign&&0==(1&t.__digit(0))?r.unaryMinus(e):e;if(1<t.length)throw new RangeError("BigInt too big");var n=t.__unsignedDigit(0);if(1===n)return e;if(n>=r.__kMaxLengthBits)throw new RangeError("BigInt too big");if(1===e.length&&2===e.__digit(0)){var i=1+(0|n/30),o=new r(i,e.sign&&0!=(1&n));o.__initializeDigits();var a=1<<n%30;return o.__setDigit(i-1,a),o}var s=null,c=e;for(0!=(1&n)&&(s=e),n>>=1;0!==n;n>>=1)c=r.multiply(c,c),0!=(1&n)&&(s=null===s?c:r.multiply(s,c));return s}},{key:"multiply",value:function(e,t){if(0===e.length)return e;if(0===t.length)return t;var n=e.length+t.length;30<=e.__clzmsd()+t.__clzmsd()&&n--;var i=new r(n,e.sign!==t.sign);i.__initializeDigits();for(var o=0;o<e.length;o++)r.__multiplyAccumulate(t,e.__digit(o),i,o);return i.__trim()}},{key:"divide",value:function(e,t){if(0===t.length)throw new RangeError("Division by zero");if(0>r.__absoluteCompare(e,t))return r.__zero();var n,i=e.sign!==t.sign,o=t.__unsignedDigit(0);if(1===t.length&&32767>=o){if(1===o)return i===e.sign?e:r.unaryMinus(e);n=r.__absoluteDivSmall(e,o,null)}else n=r.__absoluteDivLarge(e,t,!0,!1);return n.sign=i,n.__trim()}},{key:"remainder",value:function(e,t){if(0===t.length)throw new RangeError("Division by zero");if(0>r.__absoluteCompare(e,t))return e;var n=t.__unsignedDigit(0);if(1===t.length&&32767>=n){if(1===n)return r.__zero();var i=r.__absoluteModSmall(e,n);return 0===i?r.__zero():r.__oneDigit(i,e.sign)}var o=r.__absoluteDivLarge(e,t,!1,!0);return o.sign=e.sign,o.__trim()}},{key:"add",value:function(e,t){var n=e.sign;return n===t.sign?r.__absoluteAdd(e,t,n):0<=r.__absoluteCompare(e,t)?r.__absoluteSub(e,t,n):r.__absoluteSub(t,e,!n)}},{key:"subtract",value:function(e,t){var n=e.sign;return n===t.sign?0<=r.__absoluteCompare(e,t)?r.__absoluteSub(e,t,n):r.__absoluteSub(t,e,!n):r.__absoluteAdd(e,t,n)}},{key:"leftShift",value:function(e,t){return 0===t.length||0===e.length?e:t.sign?r.__rightShiftByAbsolute(e,t):r.__leftShiftByAbsolute(e,t)}},{key:"signedRightShift",value:function(e,t){return 0===t.length||0===e.length?e:t.sign?r.__leftShiftByAbsolute(e,t):r.__rightShiftByAbsolute(e,t)}},{key:"unsignedRightShift",value:function(){throw new TypeError("BigInts have no unsigned right shift; use >> instead")}},{key:"lessThan",value:function(e,t){return 0>r.__compareToBigInt(e,t)}},{key:"lessThanOrEqual",value:function(e,t){return 0>=r.__compareToBigInt(e,t)}},{key:"greaterThan",value:function(e,t){return 0<r.__compareToBigInt(e,t)}},{key:"greaterThanOrEqual",value:function(e,t){return 0<=r.__compareToBigInt(e,t)}},{key:"equal",value:function(e,t){if(e.sign!==t.sign)return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e.__digit(r)!==t.__digit(r))return!1;return!0}},{key:"notEqual",value:function(e,t){return!r.equal(e,t)}},{key:"bitwiseAnd",value:function(e,t){var n,i=Math.max;if(!e.sign&&!t.sign)return r.__absoluteAnd(e,t).__trim();if(e.sign&&t.sign){var o=i(e.length,t.length)+1,a=r.__absoluteSubOne(e,o),s=r.__absoluteSubOne(t);return a=r.__absoluteOr(a,s,a),r.__absoluteAddOne(a,!0,a).__trim()}return e.sign&&(e=(n=[t,e])[0],t=n[1]),r.__absoluteAndNot(e,r.__absoluteSubOne(t)).__trim()}},{key:"bitwiseXor",value:function(e,t){var n,i=Math.max;if(!e.sign&&!t.sign)return r.__absoluteXor(e,t).__trim();if(e.sign&&t.sign){var o=i(e.length,t.length),a=r.__absoluteSubOne(e,o),s=r.__absoluteSubOne(t);return r.__absoluteXor(a,s,a).__trim()}var c=i(e.length,t.length)+1;e.sign&&(e=(n=[t,e])[0],t=n[1]);var u=r.__absoluteSubOne(t,c);return u=r.__absoluteXor(u,e,u),r.__absoluteAddOne(u,!0,u).__trim()}},{key:"bitwiseOr",value:function(e,t){var n,i=(0,Math.max)(e.length,t.length);if(!e.sign&&!t.sign)return r.__absoluteOr(e,t).__trim();if(e.sign&&t.sign){var o=r.__absoluteSubOne(e,i),a=r.__absoluteSubOne(t);return o=r.__absoluteAnd(o,a,o),r.__absoluteAddOne(o,!0,o).__trim()}e.sign&&(e=(n=[t,e])[0],t=n[1]);var s=r.__absoluteSubOne(t,i);return s=r.__absoluteAndNot(s,e,s),r.__absoluteAddOne(s,!0,s).__trim()}},{key:"asIntN",value:function(e,t){var n=Math.floor;if(0===t.length)return t;if(0>(e=n(e)))throw new RangeError("Invalid value: not (convertible to) a safe integer");if(0===e)return r.__zero();if(e>=r.__kMaxLengthBits)return t;var i=0|(e+29)/30;if(t.length<i)return t;var o=t.__unsignedDigit(i-1),a=1<<(e-1)%30;if(t.length===i&&o<a)return t;if((o&a)!==a)return r.__truncateToNBits(e,t);if(!t.sign)return r.__truncateAndSubFromPowerOfTwo(e,t,!0);if(0==(o&a-1)){for(var s=i-2;0<=s;s--)if(0!==t.__digit(s))return r.__truncateAndSubFromPowerOfTwo(e,t,!1);return t.length===i&&o===a?t:r.__truncateToNBits(e,t)}return r.__truncateAndSubFromPowerOfTwo(e,t,!1)}},{key:"asUintN",value:function(e,t){var n=Math.floor;if(0===t.length)return t;if(0>(e=n(e)))throw new RangeError("Invalid value: not (convertible to) a safe integer");if(0===e)return r.__zero();if(t.sign){if(e>r.__kMaxLengthBits)throw new RangeError("BigInt too big");return r.__truncateAndSubFromPowerOfTwo(e,t,!1)}if(e>=r.__kMaxLengthBits)return t;var i=0|(e+29)/30;if(t.length<i)return t;var o=e%30;if(t.length==i){if(0===o)return t;if(0==t.__digit(i-1)>>>o)return t}return r.__truncateToNBits(e,t)}},{key:"ADD",value:function(e,t){if(e=r.__toPrimitive(e),t=r.__toPrimitive(t),"string"==typeof e)return"string"!=typeof t&&(t=t.toString()),e+t;if("string"==typeof t)return e.toString()+t;if(e=r.__toNumeric(e),t=r.__toNumeric(t),r.__isBigInt(e)&&r.__isBigInt(t))return r.add(e,t);if("number"==typeof e&&"number"==typeof t)return e+t;throw new TypeError("Cannot mix BigInt and other types, use explicit conversions")}},{key:"LT",value:function(e,t){return r.__compare(e,t,0)}},{key:"LE",value:function(e,t){return r.__compare(e,t,1)}},{key:"GT",value:function(e,t){return r.__compare(e,t,2)}},{key:"GE",value:function(e,t){return r.__compare(e,t,3)}},{key:"EQ",value:function(e,t){for(;;){if(r.__isBigInt(e))return r.__isBigInt(t)?r.equal(e,t):r.EQ(t,e);if("number"==typeof e){if(r.__isBigInt(t))return r.__equalToNumber(t,e);if("object"!=_typeof(t))return e==t;t=r.__toPrimitive(t)}else if("string"==typeof e){if(r.__isBigInt(t))return null!==(e=r.__fromString(e))&&r.equal(e,t);if("object"!=_typeof(t))return e==t;t=r.__toPrimitive(t)}else if("boolean"==typeof e){if(r.__isBigInt(t))return r.__equalToNumber(t,+e);if("object"!=_typeof(t))return e==t;t=r.__toPrimitive(t)}else if("symbol"==_typeof(e)){if(r.__isBigInt(t))return!1;if("object"!=_typeof(t))return e==t;t=r.__toPrimitive(t)}else{if("object"!=_typeof(e))return e==t;if("object"==_typeof(t)&&t.constructor!==r)return e==t;e=r.__toPrimitive(e)}}}},{key:"NE",value:function(e,t){return!r.EQ(e,t)}},{key:"DataViewGetBigInt64",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r.asIntN(64,r.DataViewGetBigUint64(e,t,n))}},{key:"DataViewGetBigUint64",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=n?[4,0]:[0,4],o=_slicedToArray(i,2),a=o[0],s=o[1],c=e.getUint32(t+a,n),u=e.getUint32(t+s,n),l=new r(3,!1);return l.__setDigit(0,1073741823&u),l.__setDigit(1,(268435455&c)<<2|u>>>30),l.__setDigit(2,c>>>28),l.__trim()}},{key:"DataViewSetBigInt64",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];r.DataViewSetBigUint64(e,t,n,i)}},{key:"DataViewSetBigUint64",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=0,a=0;if(0<(n=r.asUintN(64,n)).length&&(a=n.__digit(0),1<n.length)){var s=n.__digit(1);a|=s<<30,o=s>>>2,2<n.length&&(o|=n.__digit(2)<<28)}var c=i?[4,0]:[0,4],u=_slicedToArray(c,2),l=u[0],d=u[1];e.setUint32(t+l,o,i),e.setUint32(t+d,a,i)}},{key:"__zero",value:function(){return new r(0,!1)}},{key:"__oneDigit",value:function(e,t){var n=new r(1,t);return n.__setDigit(0,e),n}},{key:"__decideRounding",value:function(e,t,r,n){if(0<t)return-1;var i;if(0>t)i=-t-1;else{if(0===r)return-1;r--,n=e.__digit(r),i=29}var o=1<<i;if(0==(n&o))return-1;if(0!=(n&(o-=1)))return 1;for(;0<r;)if(r--,0!==e.__digit(r))return 1;return 0}},{key:"__fromDouble",value:function(e){r.__kBitConversionDouble[0]=e;var t,n=(2047&r.__kBitConversionInts[1]>>>20)-1023,i=1+(0|n/30),o=new r(i,0>e),a=1048575&r.__kBitConversionInts[1]|1048576,s=r.__kBitConversionInts[0],c=n%30,u=0;if(c<20){var l=20-c;u=l+32,t=a>>>l,a=a<<32-l|s>>>l,s<<=32-l}else if(20===c)u=32,t=a,a=s,s=0;else{var d=c-20;u=32-d,t=a<<d|s>>>32-d,a=s<<d,s=0}o.__setDigit(i-1,t);for(var p=i-2;0<=p;p--)0<u?(u-=30,t=a>>>2,a=a<<30|s>>>2,s<<=30):t=0,o.__setDigit(p,t);return o.__trim()}},{key:"__isWhitespace",value:function(e){return!!(13>=e&&9<=e)||(159>=e?32==e:131071>=e?160==e||5760==e:196607>=e?10>=(e&=131071)||40==e||41==e||47==e||95==e||4096==e:65279==e)}},{key:"__fromString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0,i=e.length,o=0;if(o===i)return r.__zero();for(var a=e.charCodeAt(o);r.__isWhitespace(a);){if(++o===i)return r.__zero();a=e.charCodeAt(o)}if(43===a){if(++o===i)return null;a=e.charCodeAt(o),n=1}else if(45===a){if(++o===i)return null;a=e.charCodeAt(o),n=-1}if(0===t){if(t=10,48===a){if(++o===i)return r.__zero();if(88===(a=e.charCodeAt(o))||120===a){if(t=16,++o===i)return null;a=e.charCodeAt(o)}else if(79===a||111===a){if(t=8,++o===i)return null;a=e.charCodeAt(o)}else if(66===a||98===a){if(t=2,++o===i)return null;a=e.charCodeAt(o)}}}else if(16===t&&48===a){if(++o===i)return r.__zero();if(88===(a=e.charCodeAt(o))||120===a){if(++o===i)return null;a=e.charCodeAt(o)}}if(0!=n&&10!==t)return null;for(;48===a;){if(++o===i)return r.__zero();a=e.charCodeAt(o)}var s=i-o,c=r.__kMaxBitsPerChar[t],u=r.__kBitsPerCharTableMultiplier-1;if(s>1073741824/c)return null;var l=c*s+u>>>r.__kBitsPerCharTableShift,d=new r(0|(l+29)/30,!1),p=10>t?t:10,_=10<t?t-10:0;if(0==(t&t-1)){c>>=r.__kBitsPerCharTableShift;var h=[],f=[],m=!1;do{for(var g=0,v=0;;){var y=void 0;if(a-48>>>0<p)y=a-48;else{if(!((32|a)-97>>>0<_)){m=!0;break}y=(32|a)-87}if(v+=c,g=g<<c|y,++o===i){m=!0;break}if(a=e.charCodeAt(o),30<v+c)break}h.push(g),f.push(v)}while(!m);r.__fillFromParts(d,h,f)}else{d.__initializeDigits();var S=!1,E=0;do{for(var T=0,b=1;;){var R=void 0;if(a-48>>>0<p)R=a-48;else{if(!((32|a)-97>>>0<_)){S=!0;break}R=(32|a)-87}var C=b*t;if(1073741823<C)break;if(b=C,T=T*t+R,E++,++o===i){S=!0;break}a=e.charCodeAt(o)}var k=0|(c*E+(u=30*r.__kBitsPerCharTableMultiplier-1)>>>r.__kBitsPerCharTableShift)/30;d.__inplaceMultiplyAdd(b,T,k)}while(!S)}if(o!==i){if(!r.__isWhitespace(a))return null;for(o++;o<i;o++)if(a=e.charCodeAt(o),!r.__isWhitespace(a))return null}return d.sign=-1==n,d.__trim()}},{key:"__fillFromParts",value:function(e,t,r){for(var n=0,i=0,o=0,a=t.length-1;0<=a;a--){var s=t[a],c=r[a];i|=s<<o,30===(o+=c)?(e.__setDigit(n++,i),o=0,i=0):30<o&&(e.__setDigit(n++,1073741823&i),i=s>>>c-(o-=30))}if(0!==i){if(n>=e.length)throw new Error("implementation bug");e.__setDigit(n++,i)}for(;n<e.length;n++)e.__setDigit(n,0)}},{key:"__toStringBasePowerOfTwo",value:function(e,t){var n=e.length,i=t-1,o=i=(15&(i=(51&(i=(85&i>>>1)+(85&i))>>>2)+(51&i))>>>4)+(15&i),a=t-1,s=e.__digit(n-1),c=0|(30*n-r.__clz30(s)+o-1)/o;if(e.sign&&c++,268435456<c)throw new Error("string too long");for(var u=Array(c),l=c-1,d=0,p=0,_=0;_<n-1;_++){var h=e.__digit(_),f=(d|h<<p)&a;u[l--]=r.__kConversionChars[f];var m=o-p;for(d=h>>>m,p=30-m;p>=o;)u[l--]=r.__kConversionChars[d&a],d>>>=o,p-=o}var g=(d|s<<p)&a;for(u[l--]=r.__kConversionChars[g],d=s>>>o-p;0!==d;)u[l--]=r.__kConversionChars[d&a],d>>>=o;if(e.sign&&(u[l--]="-"),-1!=l)throw new Error("implementation bug");return u.join("")}},{key:"__toStringGeneric",value:function(e,t,n){var i=e.length;if(0===i)return"";if(1===i){var o=e.__unsignedDigit(0).toString(t);return!1===n&&e.sign&&(o="-"+o),o}var a,s,c=30*i-r.__clz30(e.__digit(i-1)),u=r.__kMaxBitsPerChar[t]-1,l=c*r.__kBitsPerCharTableMultiplier,d=(l=0|(l+=u-1)/u)+1>>1,p=r.exponentiate(r.__oneDigit(t,!1),r.__oneDigit(d,!1)),_=p.__unsignedDigit(0);if(1===p.length&&32767>=_){(a=new r(e.length,!1)).__initializeDigits();for(var h=0,f=2*e.length-1;0<=f;f--){var m=h<<15|e.__halfDigit(f);a.__setHalfDigit(f,0|m/_),h=0|m%_}s=h.toString(t)}else{var g=r.__absoluteDivLarge(e,p,!0,!0);a=g.quotient;var v=g.remainder.__trim();s=r.__toStringGeneric(v,t,!0)}a.__trim();for(var y=r.__toStringGeneric(a,t,!0);s.length<d;)s="0"+s;return!1===n&&e.sign&&(y="-"+y),y+s}},{key:"__unequalSign",value:function(e){return e?-1:1}},{key:"__absoluteGreater",value:function(e){return e?-1:1}},{key:"__absoluteLess",value:function(e){return e?1:-1}},{key:"__compareToBigInt",value:function(e,t){var n=e.sign;if(n!==t.sign)return r.__unequalSign(n);var i=r.__absoluteCompare(e,t);return 0<i?r.__absoluteGreater(n):0>i?r.__absoluteLess(n):0}},{key:"__compareToNumber",value:function(e,t){if(r.__isOneDigitInt(t)){var n=e.sign,i=0>t;if(n!==i)return r.__unequalSign(n);if(0===e.length){if(i)throw new Error("implementation bug");return 0===t?0:-1}if(1<e.length)return r.__absoluteGreater(n);var o=Math.abs(t),a=e.__unsignedDigit(0);return a>o?r.__absoluteGreater(n):a<o?r.__absoluteLess(n):0}return r.__compareToDouble(e,t)}},{key:"__compareToDouble",value:function(e,t){if(t!=t)return t;if(t===1/0)return-1;if(t===-1/0)return 1;var n=e.sign;if(n!==0>t)return r.__unequalSign(n);if(0===t)throw new Error("implementation bug: should be handled elsewhere");if(0===e.length)return-1;r.__kBitConversionDouble[0]=t;var i=2047&r.__kBitConversionInts[1]>>>20;if(2047==i)throw new Error("implementation bug: handled elsewhere");var o=i-1023;if(0>o)return r.__absoluteGreater(n);var a=e.length,s=e.__digit(a-1),c=r.__clz30(s),u=30*a-c,l=o+1;if(u<l)return r.__absoluteLess(n);if(u>l)return r.__absoluteGreater(n);var d=1048576|1048575&r.__kBitConversionInts[1],p=r.__kBitConversionInts[0],_=29-c;if(_!==(0|(u-1)%30))throw new Error("implementation bug");var h,f=0;if(20>_){var m=20-_;f=m+32,h=d>>>m,d=d<<32-m|p>>>m,p<<=32-m}else if(20===_)f=32,h=d,d=p,p=0;else{var g=_-20;f=32-g,h=d<<g|p>>>32-g,d=p<<g,p=0}if((s>>>=0)>(h>>>=0))return r.__absoluteGreater(n);if(s<h)return r.__absoluteLess(n);for(var v=a-2;0<=v;v--){0<f?(f-=30,h=d>>>2,d=d<<30|p>>>2,p<<=30):h=0;var y=e.__unsignedDigit(v);if(y>h)return r.__absoluteGreater(n);if(y<h)return r.__absoluteLess(n)}if(0!==d||0!==p){if(0===f)throw new Error("implementation bug");return r.__absoluteLess(n)}return 0}},{key:"__equalToNumber",value:function(e,t){var n=Math.abs;return r.__isOneDigitInt(t)?0===t?0===e.length:1===e.length&&e.sign===0>t&&e.__unsignedDigit(0)===n(t):0===r.__compareToDouble(e,t)}},{key:"__comparisonResultToBool",value:function(e,t){return 0===t?0>e:1===t?0>=e:2===t?0<e:3===t?0<=e:void 0}},{key:"__compare",value:function(e,t,n){if(e=r.__toPrimitive(e),t=r.__toPrimitive(t),"string"==typeof e&&"string"==typeof t)switch(n){case 0:return e<t;case 1:return e<=t;case 2:return e>t;case 3:return e>=t}if(r.__isBigInt(e)&&"string"==typeof t)return null!==(t=r.__fromString(t))&&r.__comparisonResultToBool(r.__compareToBigInt(e,t),n);if("string"==typeof e&&r.__isBigInt(t))return null!==(e=r.__fromString(e))&&r.__comparisonResultToBool(r.__compareToBigInt(e,t),n);if(e=r.__toNumeric(e),t=r.__toNumeric(t),r.__isBigInt(e)){if(r.__isBigInt(t))return r.__comparisonResultToBool(r.__compareToBigInt(e,t),n);if("number"!=typeof t)throw new Error("implementation bug");return r.__comparisonResultToBool(r.__compareToNumber(e,t),n)}if("number"!=typeof e)throw new Error("implementation bug");if(r.__isBigInt(t))return r.__comparisonResultToBool(r.__compareToNumber(t,e),2^n);if("number"!=typeof t)throw new Error("implementation bug");return 0===n?e<t:1===n?e<=t:2===n?e>t:3===n?e>=t:void 0}},{key:"__absoluteAdd",value:function(e,t,n){if(e.length<t.length)return r.__absoluteAdd(t,e,n);if(0===e.length)return e;if(0===t.length)return e.sign===n?e:r.unaryMinus(e);var i=e.length;(0===e.__clzmsd()||t.length===e.length&&0===t.__clzmsd())&&i++;for(var o=new r(i,n),a=0,s=0;s<t.length;s++){var c=e.__digit(s)+t.__digit(s)+a;a=c>>>30,o.__setDigit(s,1073741823&c)}for(;s<e.length;s++){var u=e.__digit(s)+a;a=u>>>30,o.__setDigit(s,1073741823&u)}return s<o.length&&o.__setDigit(s,a),o.__trim()}},{key:"__absoluteSub",value:function(e,t,n){if(0===e.length)return e;if(0===t.length)return e.sign===n?e:r.unaryMinus(e);for(var i=new r(e.length,n),o=0,a=0;a<t.length;a++){var s=e.__digit(a)-t.__digit(a)-o;o=1&s>>>30,i.__setDigit(a,1073741823&s)}for(;a<e.length;a++){var c=e.__digit(a)-o;o=1&c>>>30,i.__setDigit(a,1073741823&c)}return i.__trim()}},{key:"__absoluteAddOne",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e.length;null===n?n=new r(i,t):n.sign=t;for(var o=1,a=0;a<i;a++){var s=e.__digit(a)+o;o=s>>>30,n.__setDigit(a,1073741823&s)}return 0!=o&&n.__setDigitGrow(i,1),n}},{key:"__absoluteSubOne",value:function(e,t){for(var n=e.length,i=new r(t=t||n,!1),o=1,a=0;a<n;a++){var s=e.__digit(a)-o;o=1&s>>>30,i.__setDigit(a,1073741823&s)}if(0!=o)throw new Error("implementation bug");for(var c=n;c<t;c++)i.__setDigit(c,0);return i}},{key:"__absoluteAnd",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e.length,o=t.length,a=o;if(i<o){a=i;var s=e,c=i;e=t,i=o,t=s,o=c}var u=a;null===n?n=new r(u,!1):u=n.length;for(var l=0;l<a;l++)n.__setDigit(l,e.__digit(l)&t.__digit(l));for(;l<u;l++)n.__setDigit(l,0);return n}},{key:"__absoluteAndNot",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e.length,o=t.length,a=o;i<o&&(a=i);var s=i;null===n?n=new r(s,!1):s=n.length;for(var c=0;c<a;c++)n.__setDigit(c,e.__digit(c)&~t.__digit(c));for(;c<i;c++)n.__setDigit(c,e.__digit(c));for(;c<s;c++)n.__setDigit(c,0);return n}},{key:"__absoluteOr",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e.length,o=t.length,a=o;if(i<o){a=i;var s=e,c=i;e=t,i=o,t=s,o=c}var u=i;null===n?n=new r(u,!1):u=n.length;for(var l=0;l<a;l++)n.__setDigit(l,e.__digit(l)|t.__digit(l));for(;l<i;l++)n.__setDigit(l,e.__digit(l));for(;l<u;l++)n.__setDigit(l,0);return n}},{key:"__absoluteXor",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e.length,o=t.length,a=o;if(i<o){a=i;var s=e,c=i;e=t,i=o,t=s,o=c}var u=i;null===n?n=new r(u,!1):u=n.length;for(var l=0;l<a;l++)n.__setDigit(l,e.__digit(l)^t.__digit(l));for(;l<i;l++)n.__setDigit(l,e.__digit(l));for(;l<u;l++)n.__setDigit(l,0);return n}},{key:"__absoluteCompare",value:function(e,t){var r=e.length-t.length;if(0!=r)return r;for(var n=e.length-1;0<=n&&e.__digit(n)===t.__digit(n);)n--;return 0>n?0:e.__unsignedDigit(n)>t.__unsignedDigit(n)?1:-1}},{key:"__multiplyAccumulate",value:function(e,t,n,i){if(0!==t){for(var o,a=32767&t,s=t>>>15,c=0,u=0,l=0;l<e.length;l++,i++){o=n.__digit(i);var d=e.__digit(l),p=32767&d,_=d>>>15,h=r.__imul(p,a),f=r.__imul(p,s),m=r.__imul(_,a);c=(o+=u+h+c)>>>30,o&=1073741823,c+=(o+=((32767&f)<<15)+((32767&m)<<15))>>>30,u=r.__imul(_,s)+(f>>>15)+(m>>>15),n.__setDigit(i,1073741823&o)}for(;0!=c||0!==u;i++){var g=n.__digit(i);g+=c+u,u=0,c=g>>>30,n.__setDigit(i,1073741823&g)}}}},{key:"__internalMultiplyAdd",value:function(e,t,n,i,o){for(var a=n,s=0,c=0;c<i;c++){var u=e.__digit(c),l=r.__imul(32767&u,t),d=r.__imul(u>>>15,t),p=l+((32767&d)<<15)+s+a;a=p>>>30,s=d>>>15,o.__setDigit(c,1073741823&p)}if(o.length>i)for(o.__setDigit(i++,a+s);i<o.length;)o.__setDigit(i++,0);else if(0!==a+s)throw new Error("implementation bug")}},{key:"__absoluteDivSmall",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=new r(e.length,!1));for(var i,o=0,a=2*e.length-1;0<=a;a-=2){var s=0|(i=(o<<15|e.__halfDigit(a))>>>0)/t,c=0|(i=((o=0|i%t)<<15|e.__halfDigit(a-1))>>>0)/t;o=0|i%t,n.__setDigit(a>>>1,s<<15|c)}return n}},{key:"__absoluteModSmall",value:function(e,t){for(var r=0,n=2*e.length-1;0<=n;n--){r=0|((r<<15|e.__halfDigit(n))>>>0)%t}return r}},{key:"__absoluteDivLarge",value:function(e,t,n,i){var o=t.__halfDigitLength(),a=t.length,s=e.__halfDigitLength()-o,c=null;n&&(c=new r(s+2>>>1,!1)).__initializeDigits();var u=new r(o+2>>>1,!1);u.__initializeDigits();var l=r.__clz15(t.__halfDigit(o-1));0<l&&(t=r.__specialLeftShift(t,l,0));for(var d,p=r.__specialLeftShift(e,l,1),_=t.__halfDigit(o-1),h=0,f=s;0<=f;f--){d=32767;var m=p.__halfDigit(f+o);if(m!==_){var g=(m<<15|p.__halfDigit(f+o-1))>>>0;d=0|g/_;for(var v=0|g%_,y=t.__halfDigit(o-2),S=p.__halfDigit(f+o-2);r.__imul(d,y)>>>0>(v<<16|S)>>>0&&(d--,!(32767<(v+=_))););}r.__internalMultiplyAdd(t,d,0,a,u);var E=p.__inplaceSub(u,f,o+1);0!==E&&(E=p.__inplaceAdd(t,f,o),p.__setHalfDigit(f+o,32767&p.__halfDigit(f+o)+E),d--),n&&(1&f?h=d<<15:c.__setDigit(f>>>1,h|d))}if(i)return p.__inplaceRightShift(l),n?{quotient:c,remainder:p}:p;if(n)return c;throw new Error("unreachable")}},{key:"__clz15",value:function(e){return r.__clz30(e)-15}},{key:"__specialLeftShift",value:function(e,t,n){var i=e.length,o=new r(i+n,!1);if(0===t){for(var a=0;a<i;a++)o.__setDigit(a,e.__digit(a));return 0<n&&o.__setDigit(i,0),o}for(var s=0,c=0;c<i;c++){var u=e.__digit(c);o.__setDigit(c,1073741823&u<<t|s),s=u>>>30-t}return 0<n&&o.__setDigit(i,s),o}},{key:"__leftShiftByAbsolute",value:function(e,t){var n=r.__toShiftAmount(t);if(0>n)throw new RangeError("BigInt too big");var i=0|n/30,o=n%30,a=e.length,s=0!==o&&0!=e.__digit(a-1)>>>30-o,c=a+i+(s?1:0),u=new r(c,e.sign);if(0===o){for(var l=0;l<i;l++)u.__setDigit(l,0);for(;l<c;l++)u.__setDigit(l,e.__digit(l-i))}else{for(var d=0,p=0;p<i;p++)u.__setDigit(p,0);for(var _=0;_<a;_++){var h=e.__digit(_);u.__setDigit(_+i,1073741823&h<<o|d),d=h>>>30-o}if(s)u.__setDigit(a+i,d);else if(0!==d)throw new Error("implementation bug")}return u.__trim()}},{key:"__rightShiftByAbsolute",value:function(e,t){var n=e.length,i=e.sign,o=r.__toShiftAmount(t);if(0>o)return r.__rightShiftByMaximum(i);var a=0|o/30,s=o%30,c=n-a;if(0>=c)return r.__rightShiftByMaximum(i);var u=!1;if(i)if(0!=(e.__digit(a)&(1<<s)-1))u=!0;else for(var l=0;l<a;l++)if(0!==e.__digit(l)){u=!0;break}u&&0===s&&(0==~e.__digit(n-1)&&c++);var d=new r(c,i);if(0===s){d.__setDigit(c-1,0);for(var p=a;p<n;p++)d.__setDigit(p-a,e.__digit(p))}else{for(var _=e.__digit(a)>>>s,h=n-a-1,f=0;f<h;f++){var m=e.__digit(f+a+1);d.__setDigit(f,1073741823&m<<30-s|_),_=m>>>s}d.__setDigit(h,_)}return u&&(d=r.__absoluteAddOne(d,!0,d)),d.__trim()}},{key:"__rightShiftByMaximum",value:function(e){return e?r.__oneDigit(1,!0):r.__zero()}},{key:"__toShiftAmount",value:function(e){if(1<e.length)return-1;var t=e.__unsignedDigit(0);return t>r.__kMaxLengthBits?-1:t}},{key:"__toPrimitive",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";if("object"!=_typeof(e))return e;if(e.constructor===r)return e;if("undefined"!=typeof Symbol&&"symbol"==_typeof(Symbol.toPrimitive)){var n=e[Symbol.toPrimitive];if(n){var i=n(t);if("object"!=_typeof(i))return i;throw new TypeError("Cannot convert object to primitive value")}}var o=e.valueOf;if(o){var a=o.call(e);if("object"!=_typeof(a))return a}var s=e.toString;if(s){var c=s.call(e);if("object"!=_typeof(c))return c}throw new TypeError("Cannot convert object to primitive value")}},{key:"__toNumeric",value:function(e){return r.__isBigInt(e)?e:+e}},{key:"__isBigInt",value:function(e){return"object"==_typeof(e)&&null!==e&&e.constructor===r}},{key:"__truncateToNBits",value:function(e,t){for(var n=0|(e+29)/30,i=new r(n,t.sign),o=n-1,a=0;a<o;a++)i.__setDigit(a,t.__digit(a));var s=t.__digit(o);if(0!=e%30){var c=32-e%30;s=s<<c>>>c}return i.__setDigit(o,s),i.__trim()}},{key:"__truncateAndSubFromPowerOfTwo",value:function(e,t,n){for(var i=Math.min,o=0|(e+29)/30,a=new r(o,n),s=0,c=o-1,u=0,l=i(c,t.length);s<l;s++){var d=0-t.__digit(s)-u;u=1&d>>>30,a.__setDigit(s,1073741823&d)}for(;s<c;s++)a.__setDigit(s,0|1073741823&-u);var p,_=c<t.length?t.__digit(c):0,h=e%30;if(0==h)p=0-_-u,p&=1073741823;else{var f=32-h,m=1<<32-f;p=m-(_=_<<f>>>f)-u,p&=m-1}return a.__setDigit(c,p),a.__trim()}},{key:"__digitPow",value:function(e,t){for(var r=1;0<t;)1&t&&(r*=e),t>>>=1,e*=e;return r}},{key:"__isOneDigitInt",value:function(e){return(1073741823&e)===e}}]),r}(_wrapNativeSuper(Array));JSBI.__kMaxLength=33554432,JSBI.__kMaxLengthBits=JSBI.__kMaxLength<<5,JSBI.__kMaxBitsPerChar=[0,0,32,51,64,75,83,90,96,102,107,111,115,119,122,126,128,131,134,136,139,141,143,145,147,149,151,153,154,156,158,159,160,162,163,165,166],JSBI.__kBitsPerCharTableShift=5,JSBI.__kBitsPerCharTableMultiplier=1<<JSBI.__kBitsPerCharTableShift,JSBI.__kConversionChars=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],JSBI.__kBitConversionBuffer=new ArrayBuffer(8),JSBI.__kBitConversionDouble=new Float64Array(JSBI.__kBitConversionBuffer),JSBI.__kBitConversionInts=new Int32Array(JSBI.__kBitConversionBuffer),JSBI.__clz30=Math.clz32?function(e){return Math.clz32(e)-2}:function(e){return 0===e?30:0|29-(0|Math.log(e>>>0)/Math.LN2)},JSBI.__imul=Math.imul||function(e,t){return 0|e*t};var _ProtoBufMessage=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"setHeader",value:function(e,t,r){var n=new ArrayBuffer(26),i=new DataView(n),o=JSBI.BigInt((new Date).getTime()),a=JSBI.BigInt("0x1988030620210507");return JSBI.DataViewSetBigInt64(i,0,a,!0),i.setInt16(8,1,!0),JSBI.DataViewSetBigInt64(i,10,o,!0),i.setInt16(18,e,!0),i.setInt16(20,t,!0),i.setInt32(22,r,!0),n}},{key:"getHeader",value:function(e){var t=new Stream(e);return{magic:t.readUint64(!0),ver:t.readInt16(!0),time:t.readUint64(!0),type:t.readInt16(!0),subtype:t.readInt16(!0),len:t.readInt32(!0)}}},{key:"encodeMsgCommon",value:function(t){var r=t.msgName,n=t.payload,i=t.type,o=t.subType,a=e.encodePayloadCommon(r,n);return arraybufferConcatenate(e.setHeader(i,o,a.length),a)}},{key:"encodePayloadCommon",value:function(t,r){var n=e.protoRoot[t],i=n.verify(r);if(i)throw Error(i);var o=n.create(r);return n.encode(o).finish()}},{key:"encodeMsgBusiness",value:function(){}},{key:"encodeImeMsg",value:function(t){var r=t.type,n=void 0===r?2:r,i=t.str;return e.encodeMsgCommon({msgName:PB_INPUT.MSG_NAMES.InputImeComposition,payload:{type:n,str:i},type:PB_MESSAGE.TYPES.MsgInput,subType:PB_INPUT.SUBTYPES.MsgInputImeComposition})}},{key:"encodeControlChangeMsg",value:function(t){var r=t.role,n=t.userId;return e.encodeMsgCommon({msgName:PB_MESSAGE.MSG_NAMES.BusinessControlChange,payload:{role:r,user_id:n},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_MESSAGE.SUBTYPES.ControlChange})}},{key:"encodeControlNotifyMsg",value:function(){return e.encodeMsgCommon({msgName:PB_MESSAGE.MSG_NAMES.BusinessControlNotify,payload:{role:CONTROL_ROLE_TYPE.Player},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_MESSAGE.SUBTYPES.ControlNotify})}},{key:"encodeDelayTestMsg",value:function(t){return e.encodeMsgCommon({msgName:PB_MESSAGE.MSG_NAMES.BusinessDelayTestClient,payload:{frames:5,check_id:t},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_MESSAGE.SUBTYPES.MsgBusinessDelayTest})}},{key:"encodeMouseMovementMsg",value:function(t){var r=t.x,n=t.y;return e.encodeMsgCommon({msgName:"InputMouseMove",payload:{x:r,y:n},type:e.protoRoot.MsgType.MsgInput,subType:e.protoRoot.MsgInputType.MsgInputMouseMove})}},{key:"encodeMouseMoveMsg",value:function(t){var r=t.movementX,n=t.movementY,i=t.clientWidth,o=t.clientHeight,a=t.offsetX,s=t.offsetY,c=e.protoRoot.InputMouseMove,u={x:r,y:n},l=c.verify(u);if(l)throw Error(l);var d=c.create(u),p=c.encode(d).finish(),_=arraybufferConcatenate(e.setHeader(e.protoRoot.MsgType.MsgInput,e.protoRoot.MsgInputType.MsgInputMouseMove,p.length),p),h=e.protoRoot.InputCursorPos,f={w:i,h:o,x:a,y:s},m=h.verify(f);if(m)throw Error(m);var g=h.create(f),v=h.encode(g).finish();return{movePBMessage:_,cursorPosPBMessage:arraybufferConcatenate(e.setHeader(e.protoRoot.MsgType.MsgInput,e.protoRoot.MsgInputType.MsgInputCursorPos,v.length),v)}}},{key:"encodeMouseKeyMsg",value:function(t,r){var n=e.protoRoot.InputMouseKey,i={key:e.protoRoot.MouseKeyType[MOUSE_BUTTON_MAP[t]],state:!!r},o=n.verify(i);if(o)throw Error(o);var a=n.create(i),s=n.encode(a).finish();return arraybufferConcatenate(e.setHeader(e.protoRoot.MsgType.MsgInput,e.protoRoot.MsgInputType.MsgInputMouseKey,s.length),s)}},{key:"encodeWheelMsg",value:function(t,r){var n=e.protoRoot.InputMouseWheel,i={};"number"==typeof t&&(i.hwheel=parseInt(t)),"number"==typeof r&&(i.wheel=parseInt(r));var o=n.verify(i);if(o)throw Error(o);var a=n.create(i),s=n.encode(a).finish();return arraybufferConcatenate(e.setHeader(e.protoRoot.MsgType.MsgInput,e.protoRoot.MsgInputType.MsgInputMouseWheel,s.length),s)}},{key:"encodeKeyMsg",value:function(t,r){var n=e.protoRoot.InputKeyboard,i=e.protoRoot.KeyboardKeyType,o=KEYCODE_MAP[t];if(o){var a={key:i[o],state:r},s=n.verify(a);if(s)throw Error(s);var c=n.create(a),u=n.encode(c).finish();return arraybufferConcatenate(e.setHeader(e.protoRoot.MsgType.MsgInput,e.protoRoot.MsgInputType.MsgInputKeyboardKey,u.length),u)}console.warn("no keyboard map:",t)}},{key:"encodeVideoStreamProfileMsg",value:function(t){var r=e.protoRoot.AVVideoFormatLevel,n={level:t},i=r.verify(n);if(i)throw Error(i);var o=r.create(n),a=r.encode(o).finish();return arraybufferConcatenate(e.setHeader(e.protoRoot.MsgType.MsgAVOutput,e.protoRoot.MsgAVOutputType.MsgAVOutputVideoFormatLevel,a.length),a)}},{key:"encodeRawStringMessage",value:function(t){var r=e.protoRoot.RawString,n={str:t},i=r.verify(n);if(i)throw Error(i);var o=r.create(n),a=r.encode(o).finish();return arraybufferConcatenate(e.setHeader(e.protoRoot.MsgType.MsgRaw,e.protoRoot.MsgRawType.MsgRawString,a.length),a)}},{key:"encodeBinaryMessage",value:function(t){var r=Array.prototype.slice.call(new Uint8Array(t)),n=e.protoRoot.RawBinary,i={bin:r},o=n.verify(i);if(o)throw Error(o);var a=n.create(i),s=n.encode(a).finish();return arraybufferConcatenate(e.setHeader(e.protoRoot.MsgType.MsgRaw,e.protoRoot.MsgRawType.MsgRawBinary,s.length),s)}},{key:"encodeTouchMsg",value:function(t){var r=e.protoRoot.InputTouchArray,n={touches:t},i=r.verify(n);if(i)throw Error(i);var o=r.create(n),a=r.encode(o).finish();return arraybufferConcatenate(e.setHeader(e.protoRoot.MsgType.MsgInput,e.protoRoot.MsgInputType.MsgInputTouch,a.length),a)}},{key:"encodeGamePadMsg",value:function(t){return e.encodeMsgCommon({msgName:PB_MESSAGE.MSG_NAMES.InputGCGamePad,payload:t,type:PB_MESSAGE.TYPES.MsgInput,subType:PB_MESSAGE.SUBTYPES.InputGCGamePad})}},{key:"decodePBMessage",value:function(t){var r=e.getHeader(t),n=e.protoRoot;if(r.type===n.MsgType.MsgRaw&&r.subtype===n.MsgRawType.MsgRawString)return{type:r.type,subtype:r.subtype,msg:this.decodeRawStringMessage(t.slice(26)).str};if(r.type===n.MsgType.MsgRaw&&r.subtype===n.MsgRawType.MsgRawBinary)return{type:r.type,subtype:r.subtype,msg:this.decodeRawBinaryMessage(t.slice(26)).bin};if(r.type===n.MsgType.MsgAVOutput&&r.subtype===n.MsgAVOutputType.MsgAVOutputVideoFormatLevel)return{type:r.type,subtype:r.subtype,msg:this.decodeVideoStreamProfileMsg(t.slice(26))};if(r.type===n.MsgType.MsgOutput&&r.subtype===n.MsgOutputType.MsgOutputCursorVisibility)return{type:r.type,subtype:r.subtype,msg:this.decodeCursorVisibilityMsg(t.slice(26))};if(r.type===n.MsgType.MsgOutput){if(r.subtype===n.MsgOutputType.MsgOutputCursorImage)return{type:r.type,subtype:r.subtype,msg:this.decodeCursorImageMsg(t.slice(26))};var i="";switch(r.subtype){case PB_OUTPUT_IME.SUBTYPES.MsgOutputImeState:i=PB_OUTPUT_IME.MSG_NAMES.OutputImeState;break;case PB_OUTPUT.SUBTYPES.MsgOutputGCVibration:i=PB_OUTPUT.MSG_NAMES.OutputGCVibration;break;case PB_OUTPUT.SUBTYPES.MsgOutputCursorPos:i=PB_OUTPUT.MSG_NAMES.OutputCursorPos}return e.decodeCommonMessage(i,r,t)}if(r.type===n.MsgType.MsgDevice&&r.subtype===n.MsgDeviceType.MsgDeviceControl){var o,a=protobuf.util.newBuffer(t.slice(26)),s=n.DeviceControl.decode(a);return o=s.type===n.DeviceType.DeviceCamara?n.DeviceControlCamera.decode(s.params):n.DeviceControlMicrophone.decode(s.params),s.params=o,{type:r.type,subtype:r.subtype,msg:s}}var c=PBDecodeMap[r.type];return c?this._decodeTypeWithMap(t,r,c):null}},{key:"_decodeTypeWithMap",value:function(t,r,n){var i=protobuf.util.newBuffer(t.slice(26)),o=n[r.subtype],a=e.protoRoot[o];if(!a)return null;var s=null;try{s=a.decode(i)}catch(e2){throw new Error("pb解析失败 ".concat(o))}return{type:r.type,subtype:r.subtype,msg:s}}},{key:"decodeCommonMessage",value:function(t,r,n){if(!t)return null;var i=protobuf.util.newBuffer(n.slice(26)),o=e.protoRoot[t].decode(i);return{type:r.type,subtype:r.subtype,msg:o}}},{key:"decodeDelayTestMessagePodData",value:function(t){return e.protoRoot[PB_BUSINESS_SEI.MSG_NAMES.BusinessDelayTestPod].decode(t)}},{key:"decodeRawStringMessage",value:function(t){var r=protobuf.util.newBuffer(t);return e.protoRoot.RawString.decode(r)}},{key:"decodeRawBinaryMessage",value:function(t){var r=protobuf.util.newBuffer(t);return e.protoRoot.RawBinary.decode(r)}},{key:"decodeVideoStreamProfileMsg",value:function(t){var r=protobuf.util.newBuffer(t);return e.protoRoot.AVVideoFormatLevelResp.decode(r)}},{key:"decodeCursorVisibilityMsg",value:function(t){var r=protobuf.util.newBuffer(t);return e.protoRoot.OutputCursorVisibility.decode(r)}},{key:"decodeCursorImageMsg",value:function(t){var r=protobuf.util.newBuffer(t);return e.protoRoot.OutputCursorImage.decode(r)}},{key:"keycodeMap",value:function(t){var r=e.protoRoot.KeyboardKeyType,n=KEYCODE_MAP[t];if(n)return r[n];console.warn("no keyboard map:",t)}}]),e}(),ProtoBufMessage=_ProtoBufMessage;ProtoBufMessage.protoRoot=proto.lookup("cg.protocol"),window.ProtoBufMessage=ProtoBufMessage;var PB_MESSAGE_CHANNEL_PROTOCOL_VERSION=20231024,_MessageFactory=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"eventTypeClipboard",value:function(t){return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessClipboard,payload:{mime_type:"text/plain",clip_data:[t]},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.Clipboard}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_CLIPBOARD,event_data:{mimeType:"text/plain",clipData:[t]}}}},{key:"eventTypeStartUp",value:function(t){return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessStartUpClient,payload:{local_capabilities:t?6:7},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.StartUp}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_STARTUP,event_data:{local_capabilities:t?6:7}}}},{key:"eventTypeAppManager",value:function(t,r){return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessAppManager,payload:{action:r,package_name:t},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.AppManager}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_APP_MANAGER,event_data:{game_pkg:t,action:r}}}},{key:"eventTypeMouse",value:function(t){var r=t.x,n=t.y,i=t.action,o=t.deltaX,a=t.deltaY,s=t.button;return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_INPUT.MSG_NAMES.InputMouseARM,payload:{action:i,key:s,axis_v:a,axis_h:o,x:r,y:n},type:PB_MESSAGE.TYPES.MsgInput,subType:PB_INPUT.SUBTYPES.InputMouseARM}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_MOUSE,event_data:{action:i,button:s,axis_v:a,axis_h:o,x:r,y:n}}}},{key:"eventTypeGdapJoystick",value:function(t){var r=t.leftX,n=t.leftY,i=t.rightX,o=t.rightY,a=t.leftT,s=t.rightT,c=t.index,u=void 0===c?0:c;return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_INPUT.MSG_NAMES.InputGCGamePad,payload:{index:u,lt:a,rt:s,lx:r,ly:n,rx:i,ry:o},type:PB_MESSAGE.TYPES.MsgInput,subType:PB_INPUT.SUBTYPES.InputGCGamePad}):Object.assign({index:u,op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_GDAP_JOYSTICK},{event_data:{left_x:r,left_y:n,right_x:i,right_y:o,left_t:a,right_t:s}})}},{key:"eventTypeOrientation",value:function(){return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessOrientationClient,payload:{},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.MsgBusinessOrientation}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_ORIENTATION}}},{key:"eventTypeLocation",value:function(t){var r=t.timestamp,n=t.latitude,i=t.altitude,o=t.longitude,a=t.speed,s=t.accuracy,c=t.altitudeAccuracy;return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessLocationClient,payload:{provider:"gps",time:r,elapsed_realtime_nanos:1e3*r*1e3,latitude:n,altitude:i||0,longitude:o,speed:a||0,bearing:0,accuracy_meters:s||0,vertical_accuracy_meters:c||0,speed_accuracy_meters_per_second:0,bearing_accuracy_degrees:0},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.Location}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_LOCATION,event_data:{provider:"gps",time:r,elapsedRealtimeNanos:1e3*r*1e3,latitude:n,altitude:i||0,longitude:o,speed:a||0,bearing:0,accuracyMeters:s||0,verticalAccuracyMeters:c||0,speedAccuracyMetersPerSecond:0,bearingAccuracyDegrees:0}}}},{key:"eventTypeInputMethod",value:function(t){var r=t.isPodLxc,n=t.charSequence,i=void 0===n?"":n;t.selectionStart,t.selectionEnd;var o=t.actionId,a=t.visibility,s=t.directInput;if(e.usePB){var c={version:wrapSingle(3),action_id:wrapSingle(o),encoder:"UTF-8",char_sequence:r?i:encodeURIComponent(i)};return s&&(c.direct_input=wrapSingle(s)),!1===a&&(c.visibility=wrapSingle(a)),ProtoBufMessage.encodeMsgCommon({msgName:PB_IME.MSG_NAMES.IMEData,payload:c,type:PB_MESSAGE.TYPES.MsgIME,subType:PB_IME.SUBTYPES.MsgIMEData})}return{op_type:s?CLIENT_EVENT_TYPE.EVENT_TYPE_INPUTMETHOD_DIRECT_TEXT:CLIENT_EVENT_TYPE.EVENT_TYPE_INPUTMETHOD,event_data:{charSequence:r?i:encodeURIComponent(i),actionId:o,encoder:"UTF-8",visibility:a,version:3}}}},{key:"eventTypeInputCombineMethod",value:function(t){var r=t.inputContext;return e.usePB,{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_TEXT_INPUT,event_data:{charSequence:encodeURIComponent(r),encoder:"UTF-8"}}}},{key:"eventTypeKey",value:function(t){var r=t.keycode,n=t.action,i=t.index,o=t.value;if(e.usePB){var a={action:n,key_code:r};return void 0!==o&&(a.value=o),ProtoBufMessage.encodeMsgCommon({msgName:PB_INPUT.MSG_NAMES.InputKeyARM,payload:a,type:PB_MESSAGE.TYPES.MsgInput,subType:PB_INPUT.SUBTYPES.InputKeyARM})}return _objectSpread2({op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_KEY,event_data:_objectSpread2({action:n,key_code:r},void 0!==o&&{value:o})},void 0!==i&&{index:i})}},{key:"eventTypeKeyCustom",value:function(t){var r=t.keycode,n=t.action;return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_INPUT.MSG_NAMES.InputKeyARM,payload:{key_code:r,action:n},type:PB_MESSAGE.TYPES.MsgInput,subType:PB_INPUT.SUBTYPES.InputKeyARM}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_KEY,event_data:{action:n,key_code:r}}}},{key:"eventTypeClarityIndex",value:function(t){var r=t.id;return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:"AVVideoFormatLevel",payload:{level:r},type:PB_MESSAGE.TYPES.MsgAVOutput,subType:MsgAVOutputType.MsgAVOutputVideoFormatLevel}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_CLARITY_INDEX,event_data:{clarity:r}}}},{key:"eventTypeTouch",value:function(t){var r=t.eventData,n=t.checkId;return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_INPUT.MSG_NAMES.InputTouchARMArray,payload:{touches:r,check_id:n},type:PB_MESSAGE.TYPES.MsgInput,subType:PB_INPUT.SUBTYPES.InputTouchARM}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_TOUCH,extra_data:{check_id:n},event_data:r}}},{key:"eventTypeUserPause",value:function(t){return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessAppPauseResume,payload:{action:0},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.AppPauseResume}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_USERPAUSE}}},{key:"eventTypeUserResume",value:function(t){return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessAppPauseResume,payload:{action:1},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.AppPauseResume}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_USERRESUME}}},{key:"eventTypeDislayPolicy",value:function(e){var t=e.action,r=void 0===t?0:t,n=e.displayContent,i=e.status;return{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_DISLAY_POLICY,event_data:{action:r,status:i,display_content:n}}}},{key:"eventTypeRestart",value:function(){return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessAppManager,payload:{action:2},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.AppManager}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_APP_MANAGER,event_data:{action:2}}}},{key:"eventTypeUserStatus",value:function(t){return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessUserStatusClient,payload:{reason:t?0:1},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.UserStatus}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_USERSTATUS,event_data:{reason:t?0:1}}}},{key:"eventTypeKeepAliveTime",value:function(t){return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessKeepAliveTimeClient,payload:{duration_seconds:t},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.MsgBusinessKeepAliveTime}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_KEEP_ALIVE_TIME,event_data:{duration:t}}}},{key:"eventTypeAutoRecycleTime",value:function(t,r){return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessAutoRecycleTimeClient,payload:clearUndf({action:t?0:1,duration_seconds:r}),type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.MsgBusinessAutoRecycleTime}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_AUTO_RECYCLE_TIME,event_data:clearUndf({action:t?0:1,duration:r})}}},{key:"eventTypeProfilePath",value:function(t,r){return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessUserProfileClient,payload:clearUndf({action:t?0:1,path:r}),type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.MsgBusinessUserProfile}):{op_type:t?CLIENT_EVENT_TYPE.EVENT_TYPE_SET_PROFILE_PATH:CLIENT_EVENT_TYPE.EVENT_TYPE_GET_PROFILE_PATH,event_data:t?{user_profile_path:r}:{reason:0}}}},{key:"eventTypeFixLocation",value:function(t){var r=t.latitude,n=t.longitude;return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:"SensorDataLocation",payload:{latitude:r,longitude:n},type:PB_MESSAGE.TYPES.MsgSensors,subType:PB_MESSAGE.SUBTYPES.MsgSensorData}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_FIX_LOCATION,event_data:{latitude:r,longitude:n}}}},{key:"eventTypeBackgroundAppClient",value:function(t,r){return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessBackgroundAppClient,payload:clearUndf({action:t?0:1,package_name:r,reason:t?void 0:0}),type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.MsgBusinessBackgroundApp}):{op_type:t?CLIENT_EVENT_TYPE.EVENT_TYPE_BRING_BACK_APP:CLIENT_EVENT_TYPE.EVENT_TYPE_GET_BACKGROUND_APPS,event_data:t?{packageName:r}:{reason:0}}}},{key:"eventTypeScreenShot",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessScreenshotClient,payload:{sequence:t},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.MsgBusinessScreenshot}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_SCREENSHOT,event_data:{sequence:t,isSavedOnPod:r}}}},{key:"eventTypeSensors",value:function(t,r){var n=["","acceleration","","orientation","gyroscope","magnetic"].indexOf(t);if(""===t||-1===n)return null;if(e.usePB){var i=["","SensorDataAcceleration","","SensorDataAttitude","SensorDataGyro","SensorDataMagnetic"][n],o=null;if([1,3,4,5].includes(n)){var a=_slicedToArray(r,3);o={x:a[0],y:a[1],z:a[2]}}var s=ProtoBufMessage.encodePayloadCommon(i,o);return ProtoBufMessage.encodeMsgCommon({msgName:"SensorData",payload:{type:n,data:s},type:PB_MESSAGE.TYPES.MsgSensors,subType:PB_MESSAGE.SUBTYPES.MsgSensorData})}return{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_SENSORS,event_data:{type:t,data:r}}}},{key:"veMessage",value:function(t){var r=t.payload,n=t.userId,i=t.mid,o=t.needAck,a=void 0!==o&&o,s=t.destUserId,c=void 0===s?"":s,u=t.type,l=void 0===u?"":u,d=t.time,p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return"string"!=typeof r&&(r=JSON.stringify(r)),d||(d=Date.now()),i||(i=Date.now().toString()+randomNumString$1(4)),p&&e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessMsgChannel,payload:{payload:{mid:i,text:r,time:d},type:"number"==typeof l?l:a?0:3,user_id:n,version:"".concat(PB_MESSAGE_CHANNEL_PROTOCOL_VERSION),dest_user_id:c},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.MsgBusinessMsgChannel}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_MSG_CHANNEL,event_data:{message:{mid:i,text:r,time:d},type:"number"==typeof l?l:a?0:3,user_id:n,dest_user_id:c,version:"".concat(SERVICE_VERSION)}}}},{key:"veMessageBinary",value:function(e){var t=e.payload,r=e.userId,n=e.mid,i=e.needAck,o=void 0!==i&&i,a=e.destUserId,s=e.time;return ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessMsgChannelBinary,payload:{payload:{mid:n,data:Array.from(new Uint8Array(t)),time_ms:s},type:o?8:9,user_id:r,version:"".concat(PB_MESSAGE_CHANNEL_PROTOCOL_VERSION),dest_user_id:a},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.MsgBusinessBinaryMsgChannel})}},{key:"veMessageResponse",value:function(t){var r=t.userId,n=t.ackId,i=t.destUserId;return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessMsgChannel,payload:{type:1,user_id:r,ack_id:n,version:"".concat(PB_MESSAGE_CHANNEL_PROTOCOL_VERSION),dest_user_id:i},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.MsgBusinessMsgChannel}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_MSG_CHANNEL,event_data:{type:1,user_id:r,ack_id:n,dest_user_id:i,version:SERVICE_VERSION}}}},{key:"veMessageBinaryResponse",value:function(e){var t=e.userId,r=e.ackId,n=e.destUserId;return ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessMsgChannelBinary,payload:{type:108,user_id:t,ack_id:r,version:"".concat(PB_MESSAGE_CHANNEL_PROTOCOL_VERSION),dest_user_id:n},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.MsgBusinessBinaryMsgChannel})}},{key:"veMessageStatusChangeResponse",value:function(t){var r=t.userId,n=t.ackId,i=t.destUserId;return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessMsgChannel,payload:{type:105,user_id:r,ack_id:n,version:"".concat(PB_MESSAGE_CHANNEL_PROTOCOL_VERSION),dest_user_id:i},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.MsgBusinessMsgChannel}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_MSG_CHANNEL,event_data:{type:105,user_id:r,ack_id:n,dest_user_id:i,version:SERVICE_VERSION}}}},{key:"veMessageReadyResponse",value:function(t){var r=t.userId,n=t.destUserId;return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessMsgChannel,payload:{type:4,user_id:r,version:"".concat(PB_MESSAGE_CHANNEL_PROTOCOL_VERSION),dest_user_id:n},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.MsgBusinessMsgChannel}):{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_MSG_CHANNEL,event_data:{type:4,user_id:r,dest_user_id:n,version:SERVICE_VERSION}}}},{key:"veMessageHearBeatResponse",value:function(t){var r=t.userId,n=t.mid,i=t.ackId,o=t.destUserId;if(e.usePB)return ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessMsgChannel,payload:{payload:{mid:n,time:Date.now()},type:106,user_id:r,ack_id:i,version:"".concat(PB_MESSAGE_CHANNEL_PROTOCOL_VERSION),dest_user_id:o},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.MsgBusinessMsgChannel});var a=(new Date).getTime();return{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_MSG_CHANNEL,event_data:{message:{mid:n,time:a},type:106,user_id:r,ack_id:i,dest_user_id:o,version:SERVICE_VERSION}}}},{key:"eventTestDelay",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessDelayTestClient,payload:{check_id:t,frames:r},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.MsgBusinessDelayTest}):{op_type:CLIENT_EVENT_TYPE.EVENT_TEST_DELAY,event_data:{check_id:t,frames:r}}}},{key:"eventGetFocusedWindow",value:function(t){var r=t.uid;return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessFocusWindowClient,payload:{uid:r},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.MsgBusinessFocusWindow}):{event_data:{uid:r},op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_GET_FOCUSED_WINDOW}}},{key:"eventShakeEvent",value:function(t){return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessShakeClient,payload:{duration_ms:t},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.MsgBusinessShake}):e.createMessageData(CLIENT_EVENT_TYPE.EVENT_TYPE_SHAKE,{duration:t})}},{key:"eventRotatePhoneEvent",value:function(t,r){return e.usePB,e.createMessageData(CLIENT_EVENT_TYPE.EVENT_TYPE_USER_ROTATION,{rotation:t,duration:r})}},{key:"eventKeyboardEnable",value:function(t){return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_IME.MSG_NAMES.IMEControl,payload:{type:3,is_allow:wrapSingle(t)},type:PB_MESSAGE.TYPES.MsgIME,subType:PB_IME.SUBTYPES.MsgIMEControl}):e.createMessageData(CLIENT_EVENT_TYPE.EVENT_TYPE_KEYBOARD_ENABLE,{enable:t})}},{key:"eventScreenRecordStart",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessShakeClient,payload:{action:0,duration:t,is_saved_on_pod:r},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.MsgBusinessShake}):e.createMessageData(CLIENT_EVENT_TYPE.EVENT_TYPE_SCREENRECORD,{action:"start",duration:t,is_saved_on_pod:r})}},{key:"eventScreenRecordStop",value:function(t){return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessShakeClient,payload:{action:1},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.MsgBusinessShake}):e.createMessageData(CLIENT_EVENT_TYPE.EVENT_TYPE_SCREENRECORD,{action:"stop"})}},{key:"eventFileChannelSend",value:function(t,r){return e.usePB?ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.BusinessFileChannelClient,payload:{action:t,carries:wrapData(r,["expires"])},type:PB_MESSAGE.TYPES.MsgBusiness,subType:PB_BUSINESS.SUBTYPES.MsgBusinessFileChannel}):e.createMessageData(CLIENT_EVENT_TYPE.EVENT_TYPE_FILE_CHANNEL,{action:t,carries:r})}},{key:"createMessageData",value:function(e,t){return{event_data:t,op_type:e}}},{key:"eventTypeVideoPlayInject",value:function(e){var t=e.action,r=void 0===t?0:t,n=e.path,i=e.mode;return{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_VIDEO_PLAY_CAMERA_INJECT,event_data:{cmd:r,path:n,mode:i}}}},{key:"eventTypeUserControl",value:function(e){var t=e.action,r=e.userId,n=e.enable;return{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_USER_CONTROL,event_data:{action:t,enable:n,userId:r}}}},{key:"eventTypeKeyboardChange",value:function(e){var t=e.keyboard,r=void 0===t?"":t,n=e.action;return{op_type:CLIENT_EVENT_TYPE.EVENT_TYPE_KEYCODE_TYPE,event_data:{type:"pod"===r?0:1,action:n}}}}]),e}(),MessageFactory$1=_MessageFactory;MessageFactory$1.usePB=!1;var logger$e=new Logger$2({}),statusMap=function(e){return STATUS_ERROR[e.exit_code]||STATUS_ERROR[e.pod_status]||[POD_ERROR$1.ERROR_GAME_ABNORMAL_EXIT.CODE,POD_ERROR$1.ERROR_GAME_ABNORMAL_EXIT.MESSAGE]};function checkRotationParam(e){if(e&&"landscape"!==e&&"portrait"!==e)throw logger$e.localErrorLog("Start","checkRotationParam","rotation error: ","rotation只能取值landscape或者portrait或者为空"),{errorCode:START_ERROR.ERROR_SDK_GENERAL.CODE,message:START_ERROR.ERROR_SDK_GENERAL.MESSAGE}}function countPassDuration(e){if(!e)return 0;var t=e.get("X-Paas-Start"),r=e.get("X-Paas-End");return t&&r?parseInt(r)-parseInt(t):0}function generateStartBody(e){e.gameHost;var t=e.gameId,r=e.customGameId;e.token;var n=e.userId,i=e.did,o=e.roundId,a=e.videoStreamProfileId,s=e.accountId,c=e.planId,u=e.reservedId,l=e.sessionId,d=e.autoRecycleTime,p=e.width,_=e.height,h=e.rotation,f=e.isScreenLock,m=e.userTag,g=e.extra,v=e.mediaProvider,y=e.userProfilePathList;e.enableFullScreen;var S=e.platform,E=e.podSettings,T=e.sdkVersion,b=e.sessionMode,R=e.queuePriority;return checkRotationParam(h),{game_id:t,custom_game_id:r,client_user_id:n,round_id:o,width:p,height:_,device_id:i,client_session_id:l,platform:S,reserved_id:u,user_profile_path_list:y,configuration_code:c,game_rotation:h,orientation_lock:f,user_tag:m,extra:g,pod_settings:E?JSON.stringify(E):null,inner_extra:clearUndf({isPCWeb:"true",support_pb:MessageFactory$1.usePB?"true":void 0}),video_stream_profile_id:void 0===a?null:parseInt(a),media_provider:v,auto_recycle_time:d,account_id:s,sdk_version:T,head_os:"Web",mode_type:b,queue_priority:R}}function GameStart(e,t,r){return _GameStart.apply(this,arguments)}function _GameStart(){return(_GameStart=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,o,a,s,c,u,l,d,p,_,h,f;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.localInfoLog("Start","GameStart","controlright podSettings",r.podSettings),i=r.token,o=r.gameHost,a=r.roundId,s={Action:"SDKGameStart"},e.next=5,fetchBase({token:i,host:o,defaultHosts:GAME_HOST,extraRequiredParam:{roundId:a},params:s,body:t,name:"gameStart"},n);case 5:if(c=e.sent,u=c.success,l=c.data,d=c.error,p=c.req,_=c.origin,h=c.headers,f={request:p,response:_,category:{paas_duration:countPassDuration(h)}},u||Object.assign(f,{errc:d.errorCode,msg:d.message,oErrc:d.originalErrorCode,oMsg:d.originalMessage,oReqId:d.requestId,httpStatus:d.httpStatus}),n.send("startRequest",f),u){e.next=20;break}throw n.localErrorLog("Start","GameStart","GameStart error",d),d;case 20:return n.localInfoLog("Start","GameStart","GameStart success"),e.abrupt("return",l);case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function PhoneStart(e,t){return _PhoneStart.apply(this,arguments)}function _PhoneStart(){return(_PhoneStart=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R,C,k,I,A,O,M,P,w,D,N,x,L,$,B,U,F,V,G;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=t.phoneHost,d=t.productId,p=t.podId,_=t.userId,h=t.accountId,f=t.token,m=t.applicationId,g=t.sessionId,v=t.width,y=t.height,S=t.rotation,E=t.planId,T=t.isReset,b=t.roundId,R=t.videoStreamProfileId,C=t.userTag,k=t.extra,I=t.mediaProvider,A=t.remoteLocationMock,O=t.enableLocalKeyboard,M=t.autoRecycleTime,P=t.mode,w=t.sdkVersion,D=t.did,N=t.platform,checkRotationParam(S),x={product_id:d,client_user_id:_,width:v,height:y,client_session_id:g,media_provider:I,pod_id:p,app_id:m,configuration_code:E,reset:T,round_id:b,video_stream_profile_id:void 0===R?null:parseInt(R),user_tag:C,extra:k,device_id:D,platform:N,rotation_mode:void 0===S?"auto_rotation":S,remote_location_mock:A,enable_local_keyboard:O,auto_recycle_time:M,account_id:h,inner_extra:{fullDisplayFlag:"true"},sdk_version:w,head_os:"Web"},e.next=5,fetchBase({token:f,host:l,defaultHosts:PHONE_HOST,signKey:"ACEP",extraRequiredParam:{productId:d},params:{Action:"PodStart",Version:"2022-08-01"},body:x,name:"phoneStart",noSendExtra:{mode:P}},r);case 5:if(L=e.sent,$=L.success,B=L.data,U=L.error,F=L.req,V=L.origin,G=L.headers,$){e.next=17;break}throw r.localErrorLog("Start","PhoneStart","PodStart error",U),U;case 17:r.localInfoLog("Start","PodStart","PodStart success"),r.send("startRequest",{request:F,response:V,category:{paas_duration:countPassDuration(G)}});case 19:return e.abrupt("return",null!=B&&null!==(n=B.media_list)&&void 0!==n&&n[0]?_objectSpread2(_objectSpread2({},B.media_list[0]),{},{media_provider:(null===(i=B.media_list[0])||void 0===i?void 0:i.stream_provider)||(null===(o=B.media_list[0])||void 0===o?void 0:o.media_provider),rtc_app_id:(null===(a=B.media_list[0])||void 0===a?void 0:a.media_app_id)||(null===(s=B.media_list[0])||void 0===s?void 0:s.rtc_app_id),rotation_mode:(null===(c=B.media_list[0])||void 0===c?void 0:c.rotation)||(null===(u=B.media_list[0])||void 0===u?void 0:u.rotation_mode),pod_id:null==B?void 0:B.pod_id,reserved_id:null==B?void 0:B.reserve_id,s_key:null==B?void 0:B.s_key}):_objectSpread2(_objectSpread2({},B),{},{isPodLxc:!0}));case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function MonitorPod(e,t){return _MonitorPod.apply(this,arguments)}function _MonitorPod(){return(_MonitorPod=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.phoneHost,i=t.monitorPodId,o=t.monitorUserId,a=t.monitorToken,t.monitorAccountId,e.next=3,fetchBase({token:a,host:n,defaultHosts:PHONE_HOST,method:"GET",signKey:"ACEP",extraRequiredParam:{monitorPodId:i,monitorUserId:o},params:{Action:"MonitorPod",Version:"2020-10-25",pod_id:i,client_user_id:o},name:"monitorPod"},r);case 3:if(s=e.sent,c=s.success,u=s.data,l=s.error,c){e.next=10;break}throw r.localErrorLog("Start","MonitorPod","MonitorPod error:",l),l;case 10:return e.abrupt("return",u);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function GetResourceStatus(e,t){var r=e.getResourceHost,n=e.reservedId,i=e.skey;return fetchInnerApi({host:r,url:"/api/instance/status",name:"getResourceStatus",extraRequiredParam:{reservedId:n,skey:i},params:{reserved_id:n,skey:i},customHandleReturn:function(e){if(e.success){var t=_slicedToArray(statusMap(e),2),r=t[0],n=t[1];return _objectSpread2(_objectSpread2({},e),{},{errorCode:r,message:n})}return _objectSpread2(_objectSpread2({},e),{},{errorCode:POD_ERROR$1.ERROR_GAME_ABNORMAL_EXIT.CODE,message:POD_ERROR$1.ERROR_GAME_ABNORMAL_EXIT.MESSAGE})}},t)}function GetVePhonePodStatus(e,t){var r=e.getResourceHost,n=e.reservedId,i=e.sKey,o=e.podId;return fetchInnerApi({host:r,url:"/openapi/sdk/cloudnative/v2/pod/get_status",name:"GetPodStatus",defaultHosts:VEPHONE_GET_RESOURCE_HOST,extraRequiredParam:{reservedId:n,sKey:i,podId:o},params:{ReserveId:n,SKey:i,PodId:o},customHandleReturn:function(e){return e}},t)}function UpdateMediaToken(e,t){return _UpdateMediaToken.apply(this,arguments)}function _UpdateMediaToken(){return(_UpdateMediaToken=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getResourceHost,i=t.reservedId,o=t.skey,a=t.userId,e.next=3,fetchBase({token:!1,host:n,defaultHosts:GET_RESOURCE_HOST,url:"/api/volc/media_token",method:"GET",signKey:null,params:{client_user_id:a,reserved_id:i,skey:o},name:"updateMediaToken"},r);case 3:if(s=e.sent,c=s.success,u=s.data,l=s.error,c){e.next=10;break}throw r.localErrorLog("Start","UpdateMediaToken","UpdateMediaToken error:",l),l;case 10:return e.abrupt("return",u);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var EventStore=function(){function e(){_classCallCheck(this,e),this._removeList=[]}return _createClass(e,[{key:"setElement",value:function(e){this.el=e}},{key:"getTarget",value:function(e){return["keydown","keyup","paste"].includes(e)?document:this.el}},{key:"add",value:function(e,t){if("object"===_typeof(e))for(var r in e)this.add(r,e[r]);else{if(null===t)return;this.getTarget(e).addEventListener(e,t),this._removeList.push({name:e,fn:t})}}},{key:"clear",value:function(){var e=this;this._removeList.forEach((function(t){var r=t.name,n=t.fn;e.getTarget(r).removeEventListener(r,n)})),this._removeList=[]}}]),e}(),TouchIdUnifier=function(){function e(){_classCallCheck(this,e),this.isIOS=!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),this.idArray=[],this.idMap={},this._nextId=0}return _createClass(e,[{key:"touchCancel",value:function(){this.idArray=[],this.idMap={},this._nextId=0}},{key:"unite",value:function(e){return this.isIOS?(this.handleTouches(e.touches),this.handleTouches(e.changedTouches,"touchend"===e.type),e):e}},{key:"uniteId",value:function(e,t){var r=this.idMap[e],n=null!=r?r:this.nextId(e);return t&&this.onTouchEnd(e),n}},{key:"handleTouches",value:function(e,t){var r,n=_createForOfIteratorHelper(e);try{for(n.s();!(r=n.n()).done;){var i=r.value,o=this.uniteId(i.identifier,t);Object.defineProperty(i,"identifier",{value:o})}}catch(a){n.e(a)}finally{n.f()}}},{key:"nextId",value:function(e){var t=this._nextId;return this.idArray[t]=e,this.idMap[e]=t,this.updateNextId(),t}},{key:"updateNextId",value:function(){for(var e=0;e<this.idArray.length;e++)if(void 0===this.idArray[e])return void(this._nextId=e);this._nextId=this.idArray.length}},{key:"onTouchEnd",value:function(e){var t=this.idMap[e];"number"==typeof t&&(delete this.idMap[e],this.idArray[t]=void 0,this.updateNextId())}}]),e}(),TouchSender=function(){function e(t){_classCallCheck(this,e),this._touchCacheMap={},this.touchUnifier=new TouchIdUnifier,this.parent=t}return _createClass(e,[{key:"_modifyTouchCache",value:function(e,t){Array.isArray(e)||(e=[e]);var r=this._touchCacheMap;e.forEach((function(e){var n=e.pointerId;if(!t){var i=r[n];i?(i.x=e.x,i.y=e.y):r[n]=Object.assign({},e)}r[n]?r[n].isActive=!0:console.warn("cacheMap[id] not exist",n,Object.keys(r).length)}));var n=this.generateTouchList();return t&&e.forEach((function(e){var t=e.pointerId;r[t]&&delete r[t]})),n}},{key:"generateTouchList",value:function(){var e=this._touchCacheMap,t=[],r=[];for(var n in e)t.push(parseInt(n)),r.push(Object.assign({},e[n])),e[n].isActive=!1;return{idArr:t,touchList:r}}},{key:"clearAllTouch",value:function(){var e=this._touchCacheMap;for(var t in e){var r=e[t],n=r.pointerId,i=r.x,o=r.y;this.send({pointerId:n,x:i,y:o,action:ACTION.TOUCH_END})}this.touchUnifier.touchCancel()}},{key:"isPCTouch",get:function(){return this.parent.mode===MODE.CLOUD_PC&&!this.parent._player._isHaiMACloud}},{key:"sendTouchList",value:function(e){var t=this,r=e.touchList,n=e.action,i=e.androidAction,o=this.isPCTouch,a=r.map((function(e){return{action:o?t.countPCTouchAction(e.isActive,n):i,originAction:n,pointerId:e.pointerId,x:e.x,y:e.y}})),s=this.parent,c=s._player;s.mode;var u=s.disableDefaultTouchEvent,l=s.podWidth,d=s.podHeight;if(c.emit("on-touch-event",a.map((function(e){var t=e.pointerId,r=e.x,i=e.y;return{action:n,pointerId:t,x:r,y:i}}))),!u)if(this.isPCTouch){var p=[];a.forEach((function(e){p.push({id:e.pointerId,type:e.action,w:l,h:d,x:Math.round(l*parseFloat(e.x)),y:Math.round(d*parseFloat(e.y)),radius:1,pressure:1})}));var _=ProtoBufMessage.encodeTouchMsg(p);c._sendMessage(_,!0)}else{var h;MessageFactory$1.usePB&&a.forEach((function(e,t){a[t].pointer_id=e.pointerId,delete a[t].pointerId}));var f=(null===(h=c._detectDelayHandler)||void 0===h?void 0:h.touchDelayDetector.geneCheckId())||0,m=MessageFactory$1.eventTypeTouch({eventData:a,checkId:f});c._sendCustomMessage(m)}}},{key:"send",value:function(e){var t=this;Array.isArray(e)||(e=[e]);var r=Array.isArray(e)?e[0]:e,n=r.action,i=n===ACTION.TOUCH_END;e.forEach((function(e){e.isActive=r===e,e.pointerId=t.touchUnifier.uniteId(e.pointerId,i)}));var o=this._modifyTouchCache(e,i),a=o.idArr,s=o.touchList,c=this.isPCTouch?null:this.countSendAction(a,n,r.pointerId);this.sendTouchList({action:n,touchList:s,androidAction:c})}},{key:"countSendAction",value:function(e,t,r){if(t===ACTION.TOUCH_MOVE||e.length<2)return t;var n=t===ACTION.TOUCH_START?5:6;return 256*e.indexOf(r)+n}},{key:"countPCTouchAction",value:function(e,t){return t===ACTION.MOVE?ACTION.PC_TOUCH_MOVE:t===ACTION.TOUCH_START?e?ACTION.PC_TOUCH_DOWN:ACTION.PC_TOUCH_MOVE:e?ACTION.PC_TOUCH_UP:ACTION.PC_TOUCH_MOVE}}]),e}(),TouchHandler=function(){function e(t,r){var n=this,i=r.domId,o=r.mode,a=r.isPC,s=void 0!==a&&a,c=r.disableInteraction,u=void 0!==c&&c,l=r.enableLocalMouseScroll,d=void 0!==l&&l,p=r.localKeyboardHandler,_=void 0===p?null:p,h=r.systemCursorShowStatHandler,f=r.disableDefaultTouchEvent;_classCallCheck(this,e),this.noScaleAndLandscape=!1,this.noScale=!1,this.eventStore=new EventStore,this.hasVideoBlackPadding=!1,this.touchSender=new TouchSender(this),this._player=t,this.domId=i,this.mode=o,this.isPC=s,this.disableInteraction=u,this.enableLocalMouseScroll=d,this.disableDefaultTouchEvent=f,this.hasMouseScrollVirtualClick=!1,this.mouseScrollVirtualClickPosition={clientX:null,clientY:null},this.touchElement=document.getElementById(i),this.eventStore.setElement(this.touchElement),this.keyPressedList=[],this.isMouseDown=!1,this.podUserId=null,this.podWidth=null,this.podHeight=null,this.streamWidth=null,this.streamHeight=null,this.scale=null,this.enableScale=!0,this.degree=null,this.rotation=null,this.localKeyboardHandler=_,this.systemCursorShowStatHandler=h,this.systemCursorShowStat=!0,this.systemCursorHiddenVirtualPosition={clientX:null,clientY:null},this._videoRenderMode=VIDEO_RENDER_MODE.CONTAIN,this._initEvent(),this._player.getConfig("enableScreenRotationTouch")&&this.isPC&&0===this.mode&&"portrait"!==this._player.rotationMode&&this._player.on("on-screen-rotation",(function(e){e.fromPod&&(n.rotation=e.rotation)}))}return _createClass(e,[{key:"setDegree",value:function(e){var t=e%360;this._player.emit("on-screen-rotation",{appOriginDirection:0===this._player.rotationDegree?"portrait":"landscape",streamDirection:"portrait"===this._player.rotationMode&&0!==this.rotation?"landscape":"portrait",uiDomRotation:null!=t?t:0}),this.degree=t}},{key:"setRotation",value:function(e){this.rotation=e%360}},{key:"_initEvent",value:function(){var e=this;if(!this.disableInteraction){var t=function(){return{touchstart:e.touchStart.bind(e),touchend:e.touchEnd.bind(e),touchmove:e.touchMove.bind(e),touchcancel:function(){e.touchSender.clearAllTouch()}}},r=function(){return{mousedown:e.mouseDown.bind(e),mouseup:e.mouseUp.bind(e),mousemove:e.mouseMove.bind(e),contextmenu:e.contextListener.bind(e)}},n=function(){return{keydown:e.keydown.bind(e),keyup:e.keyup.bind(e)}};this.mode===MODE.CLOUD_PHONE||this.mode===MODE.CLOUD_PHONE_GAME?this.isPC?this.eventStore.add(_objectSpread2(_objectSpread2({},r()),{},{mouseleave:this.mouseUp.bind(this),mousewheel:this.enableLocalMouseScroll?this.wheelEvent.bind(this):null})):this.eventStore.add(t()):this.mode===MODE.CLOUD_PC&&(this.isPC?this.eventStore.add(_objectSpread2(_objectSpread2(_objectSpread2({},r()),n()),{},{mousewheel:this.wheelEvent.bind(this)})):this.eventStore.add(_objectSpread2(_objectSpread2({},t()),n())))}}},{key:"setStreamSize",value:function(e){var t=e.streamWidth,r=e.streamHeight;e.videoEle,this.streamWidth=t,this.streamHeight=r}},{key:"setContentSize",value:function(e){var t=e.width,r=e.height,n=e.enableScale;t&&(this.podWidth=t),r&&(this.podHeight=r),"boolean"==typeof n&&(this.enableScale=n)}},{key:"videoRenderMode",get:function(){return this._videoRenderMode},set:function(e){this._videoRenderMode=e}},{key:"updateVideoScale",value:function(e){var t=1;if(this.noScale){if(this._videoRenderMode===VIDEO_RENDER_MODE.COVER&&this.hasVideoBlackPadding){t=(this.podWidth/this.podHeight).toFixed(6)>(this.touchElement.clientWidth/this.touchElement.clientHeight).toFixed(6)?this.touchElement.clientHeight*this.podWidth/(this.podHeight*this.touchElement.clientWidth):this.touchElement.clientWidth*this.podHeight/(this.podWidth*this.touchElement.clientHeight);var r="scale(".concat(t.toFixed(6),")");e.style.transform=r}return{podWidth:this.podWidth,podHeight:this.podHeight,streamWidth:this.streamWidth,streamHeight:this.streamHeight,clientWidth:this.touchElement.clientWidth,clientHeight:this.touchElement.clientHeight,scale:t,noScale:!0}}if(this.noScaleAndLandscape){var n,i,o=(this.podWidth/this.podHeight).toFixed(6),a=(this.podHeight/this.podWidth).toFixed(6),s=(this.touchElement.clientWidth/this.touchElement.clientHeight).toFixed(6);o>s?(n=this.touchElement.clientWidth,i=this.podHeight/this.podWidth*n):(i=this.touchElement.clientHeight,n=this.podWidth/this.podWidth*i);var c=i,u=n;t=a>s?this._videoRenderMode===VIDEO_RENDER_MODE.COVER?this.touchElement.clientHeight/u:this.touchElement.clientWidth/c:this._videoRenderMode===VIDEO_RENDER_MODE.COVER?this.touchElement.clientWidth/c:this.touchElement.clientHeight/u;var l="rotate(90deg) scale(".concat(t.toFixed(6),")");return e.style.transform=l,{podWidth:this.podWidth,podHeight:this.podHeight,streamWidth:this.streamWidth,streamHeight:this.streamHeight,clientWidth:this.touchElement.clientWidth,clientHeight:this.touchElement.clientHeight,scale:t,noScaleAndLandscape:!0}}var d=this.podWidth,p=this.podHeight,_=this.streamWidth,h=this.streamHeight;270!==this.rotation&&90!==this.rotation||(d=this.podHeight,p=this.podWidth,_=this.streamHeight,h=this.streamWidth);var f=e,m=(_/h).toFixed(6),g=(d/p).toFixed(6),v=(this.touchElement.clientWidth/this.touchElement.clientHeight).toFixed(6);if(this.enableScale&&g>m&&v>m)if(g>v){var y=_/h*this.touchElement.clientHeight;t=this.touchElement.clientWidth/y}else{var S=p/d*_/h*this.touchElement.clientHeight;t=this.touchElement.clientHeight/S}if(this.enableScale&&m>g&&m>v)if(g>v){var E=d/p*h/_*this.touchElement.clientWidth;t=this.touchElement.clientWidth/E}else{var T=h/_*this.touchElement.clientWidth;t=this.touchElement.clientHeight/T}if(t){this.scale=Math.ceil(1e5*t)/1e5;var b="scale(".concat(this.scale,")");f&&(f.style.transform=b)}return{rotationPodWidth:d,rotationPodHeight:p,rotationStreamWidth:_,rotationStreamHeight:h,clientWidth:this.touchElement.clientWidth,clientHeight:this.touchElement.clientHeight,scale:t||1}}},{key:"contextListener",value:function(e){e.preventDefault()}},{key:"touchStart",value:function(e){var t;if(this._player.canOperate&&"playing"===(null===(t=this._player.client)||void 0===t?void 0:t.status)){e.preventDefault(),1===e.touches.length&&isiOS()&&this.localKeyboardHandler&&this.localKeyboardHandler.status===LOCAL_KEYBOARD_STATUS.NEED_INTERACTION&&this.localKeyboardHandler.inputFocus();for(var r=e.changedTouches,n=this.touchElement.getBoundingClientRect(),i=this.touchElement.clientWidth,o=this.touchElement.clientHeight,a=n.left,s=n.top,c=0;c<r.length;c++){var u=r[c],l=u.clientX-a,d=u.clientY-s,p=this.coordinateScaleAndRotate({width:i,height:o,targetx:l,targety:d,podWidth:this.podWidth,podHeight:this.podHeight}),_=p.x,h=p.y,f=u.identifier,m={action:ACTION.TOUCH_START,pointerId:f,x:_,y:h};this.sendTouchMessage(m)}}}},{key:"touchEnd",value:function(e){var t;if(this._player.canOperate&&"playing"===(null===(t=this._player.client)||void 0===t?void 0:t.status)){e.preventDefault();for(var r=e.changedTouches,n=this.touchElement.getBoundingClientRect(),i=this.touchElement.clientWidth,o=this.touchElement.clientHeight,a=n.left,s=n.top,c=0;c<r.length;c++){var u=r[c],l=u.clientX-a,d=u.clientY-s,p=this.coordinateScaleAndRotate({width:i,height:o,targetx:l,targety:d,podWidth:this.podWidth,podHeight:this.podHeight}),_=p.x,h=p.y,f=u.identifier,m={action:ACTION.TOUCH_END,pointerId:f,x:_,y:h};this.sendTouchMessage(m)}this._firstClickPlayAudio()}}},{key:"touchMove",value:function(e){var t;if(this._player.canOperate&&"playing"===(null===(t=this._player.client)||void 0===t?void 0:t.status)){e.preventDefault();for(var r=Array.from(e.changedTouches),n=this.touchElement.getBoundingClientRect(),i=this.touchElement.clientWidth,o=this.touchElement.clientHeight,a=n.left,s=n.top,c=[],u=0;u<r.length;u++){var l=r[u],d=l.clientX-a,p=l.clientY-s,_=this.coordinateScaleAndRotate({width:i,height:o,targetx:d,targety:p,podWidth:this.podWidth,podHeight:this.podHeight}),h=_.x,f=_.y,m=l.identifier;c.push({action:ACTION.TOUCH_MOVE,pointerId:m,x:h,y:f})}this.sendTouchMessage(c)}}},{key:"sendTouchMessage",value:function(e){return this.touchSender.send(e)}},{key:"mouseDown",value:function(e){var t;if(this._player.canOperate&&"playing"===(null===(t=this._player.client)||void 0===t?void 0:t.status)){if(this.mode===MODE.CLOUD_PC){e.preventDefault(),this.systemCursorShowStatHandler.setSystemCursorShowAuto("mousedown");var r=ProtoBufMessage.encodeMouseKeyMsg(e.button,!0);this._player._sendMessage(r,!0)}else{if(2===e.button)return;this.resetMouseScrollVirtualClick(e),this.isMouseDown=!0;var n=this.mouseConvert(e,ACTION.DOWN);this.sendTouchMessage(n)}this._firstClickPlayAudio()}}},{key:"mouseMove",value:function(e){var t;if(this._player.canOperate&&"playing"===(null===(t=this._player.client)||void 0===t?void 0:t.status))if(this.mode===MODE.CLOUD_PC){var r,n,i=this.touchElement.getBoundingClientRect(),o=i.left,a=i.top,s=this.touchElement.clientWidth,c=this.touchElement.clientHeight,u=e.movementX,l=e.movementY,d={clientX:e.clientX,clientY:e.clientY},p=!1;if(null===(r=this.systemCursorShowStatHandler)||void 0===r||r.setSystemCursorShowAuto(),null!==(n=this.systemCursorShowStatHandler)&&void 0!==n&&n.localCursorShowStats)this.systemCursorHiddenVirtualPosition={clientX:null,clientY:null};else{var _;p=!0;var h=null===(_=this.systemCursorShowStatHandler)||void 0===_?void 0:_.cursorSensitivity;if(u*=h,l*=h,null===this.systemCursorHiddenVirtualPosition.clientX&&null===this.systemCursorHiddenVirtualPosition.clientY)this.systemCursorHiddenVirtualPosition={clientX:e.clientX,clientY:e.clientY};else{var f=this.systemCursorHiddenVirtualPosition.clientX+u,m=this.systemCursorHiddenVirtualPosition.clientY+l,g=f-o,v=m-a;g<=s&&g>=0&&(this.systemCursorHiddenVirtualPosition.clientX=f),v<=c&&v>=0&&(this.systemCursorHiddenVirtualPosition.clientY=m)}d=this.systemCursorHiddenVirtualPosition}var y=this._player.handlers.CursorPosHandler;y.isEnable&&(d=y.onMouseMove({isPointLock:p,clientWidth:s,clientHeight:c,offsetLeft:o,offsetTop:a,movementX:u,movementY:l}));var S=this.mouseConvertPCPB({event:d,action:ACTION.MOVE,width:s,height:c,offsetLeft:o,offsetTop:a}),E=S.x,T=S.y;this._player._debug&&console.log(LOG_TAG,"x, y: ",E+", "+T);var b=limitRange(parseInt(s*parseFloat(E)),1,s-1),R=limitRange(parseInt(c*parseFloat(T)),1,c-1),C=ProtoBufMessage.encodeMouseMoveMsg({movementX:u,movementY:l,clientWidth:s,clientHeight:c,offsetX:b,offsetY:R}),k=C.movePBMessage,I=C.cursorPosPBMessage;this._player._sendMessage(k,!0),this._player._sendMessage(I,!0)}else{if(2===e.button)return;if(!this.isMouseDown)return;this.resetMouseScrollVirtualClick(e);var A=this.mouseConvert(e,ACTION.MOVE);this.sendTouchMessage(A)}}},{key:"mouseUp",value:function(e){var t;if(this._player.canOperate&&"playing"===(null===(t=this._player.client)||void 0===t?void 0:t.status))if(this.mode===MODE.CLOUD_PC){e.preventDefault();var r=ProtoBufMessage.encodeMouseKeyMsg(e.button);this._player._sendMessage(r,!0)}else{if(2===e.button)return;if(!this.isMouseDown)return;this.resetMouseScrollVirtualClick(e),this.isMouseDown=!1;var n=this.mouseConvert(e,ACTION.UP);this.sendTouchMessage(n)}}},{key:"resetMouseScrollVirtualClick",value:function(){if(this.mode===MODE.CLOUD_PHONE&&this.hasMouseScrollVirtualClick){this.hasMouseScrollVirtualClick=!1;var e=this.mouseConvert(this.mouseScrollVirtualClickPosition,ACTION.MOVE,MOUSE_SCROLL_VIRTUAL_CLICK);this.sendTouchMessage(e);var t=this.mouseConvert(this.mouseScrollVirtualClickPosition,ACTION.UP,MOUSE_SCROLL_VIRTUAL_CLICK);this.sendTouchMessage(t),this.mouseScrollVirtualClickPosition={clientX:null,clientY:null}}}},{key:"mouseConvert",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:NATIVE_MOUSE_PRE,n=this.touchElement.clientWidth,i=this.touchElement.clientHeight,o=this.podWidth,a=this.podHeight,s=this.touchElement.getBoundingClientRect().left,c=this.touchElement.getBoundingClientRect().top,u=e.clientX,l=e.clientY,d=u-s,p=l-c,_=this.coordinateScaleAndRotate({width:n,height:i,targetx:d,targety:p,podWidth:o,podHeight:a}),h=_.x,f=_.y,m={x:h,y:f};return m.action=t,m.pointerId=r,m}},{key:"wheelEvent",value:function(e){var t=this;if(this._player.canOperate)if(e.preventDefault(),this.mode===MODE.CLOUD_PC){var r;if("playing"!==(null===(r=this._player.client)||void 0===r?void 0:r.status))return;this.systemCursorShowStatHandler.setSystemCursorShowAuto();var n=e.deltaX,i=e.deltaY;isMac$1()||(n=-n,i=-i);var o=ProtoBufMessage.encodeWheelMsg(n,i);this._player._sendMessage(o,!0)}else if(this.mode===MODE.CLOUD_PHONE){if(!this.hasMouseScrollVirtualClick){this.hasMouseScrollVirtualClick=!0;var a=this.mouseConvert(e,ACTION.DOWN,MOUSE_SCROLL_VIRTUAL_CLICK);this.sendTouchMessage(a),this.resetMouseScroll=debounce((function(){return t.resetMouseScrollVirtualClick()}),200)}this.resetMouseScroll(),null===this.mouseScrollVirtualClickPosition.clientX&&null===this.mouseScrollVirtualClickPosition.clientY&&(this.mouseScrollVirtualClickPosition={clientX:e.clientX,clientY:e.clientY});var s=e.deltaX,c=e.deltaY;isMac$1()||(s=-s,c=-c);var u=s&&(s>0?1:-1)*this.touchElement.clientWidth*.1,l=c&&(c>0?1:-1)*this.touchElement.clientHeight*.1;this.mouseScrollVirtualClickPosition.clientX+=u,this.mouseScrollVirtualClickPosition.clientY+=l;var d=this.mouseConvert(this.mouseScrollVirtualClickPosition,ACTION.MOVE,MOUSE_SCROLL_VIRTUAL_CLICK);this.sendTouchMessage(d)}else{var p=this.touchElement.getBoundingClientRect(),_=this.mouseConvertPC({event:e,action:ACTION.WHEEL,width:this.touchElement.clientWidth,height:this.touchElement.clientHeight,offsetLeft:p.left,offsetTop:p.top});this._player._sendCustomMessage(_)}}},{key:"mouseConvertPC",value:function(e){var t,r,n,i=e.event,o=e.action,a=e.width,s=e.height,c=e.offsetLeft,u=e.offsetTop,l=i.clientX-c,d=i.clientY-u,p=this.coordinateScaleAndRotate({width:a,height:s,targetx:l,targety:d,podWidth:this.podWidth,podHeight:this.podHeight}),_=p.x,h=p.y,f=i.button;return o===ACTION.WHEEL?(n=i.deltaY,r=i.deltaX,t=0):t=1===f?2:2===f?1:0,MessageFactory$1.eventTypeMouse({button:t,action:o,x:_,y:h,deltaX:r,deltaY:n})}},{key:"mouseConvertPCPB",value:function(e){var t=e.event;e.action;var r=e.width,n=e.height,i=e.offsetLeft,o=e.offsetTop,a=t.clientX-i,s=t.clientY-o,c=this.coordinateScaleAndRotate({width:r,height:n,targetx:a,targety:s,podWidth:this.podWidth,podHeight:this.podHeight});return{x:c.x,y:c.y}}},{key:"coordinateScaleAndRotate",value:function(e){var t,r,n=e.width,i=e.height,o=e.targetx,a=e.targety,s=e.podWidth,c=e.podHeight,u=this.degree,l=s,d=c,p=n,_=i;if((270===this.rotation||90===this.rotation||this.noScaleAndLandscape)&&(l=c,d=s),90===u||270===u){var h=l;l=d,d=h,h=p,p=_,_=h}var f,m,g,v=l/d,y=p/_;if(this._videoRenderMode===VIDEO_RENDER_MODE.COVER)this.noScaleAndLandscape?v>y?(r=a/(f=_),t=(o+((m=parseInt(f/d*l))-p)/2)/m):(t=o/(m=p),r=(a+((f=parseInt(m/l*d))-_)/2)/f):v>y?(r=a/(f=_),t=(o+((m=parseInt(l/d*f))-p)/2)/m):(t=o/(m=p),r=(a+((f=parseInt(d/l*m))-_)/2)/f);else if(this._videoRenderMode===VIDEO_RENDER_MODE.FILL)t=o/p,r=a/_;else{if(l&&d)if(v>y)t=o/(m=p),r=(a-(_-(f=parseInt(d/l*m)))/2)/f;else f=_,t=(o-(p-(m=parseInt(l/d*f)))/2)/m,r=a/f;else t=o/p,r=a/_}return g=90===u?{x:r.toFixed(6),y:(1-t).toFixed(6)}:180===u?{x:(1-t).toFixed(6),y:(1-r).toFixed(6)}:270===u?{x:(1-r).toFixed(6),y:t.toFixed(6)}:{x:t.toFixed(6),y:r.toFixed(6)},this.noScaleAndLandscape?{x:parseFloat(g.y),y:1-parseFloat(g.x)}:{x:parseFloat(g.x),y:parseFloat(g.y)}}},{key:"_sendKeyDown",value:function(e){this._player._sendMessage(ProtoBufMessage.encodeKeyMsg(e,!0),!0)}},{key:"keydown",value:function(e){if(this._player.canOperate)if(this.mode===MODE.CLOUD_PC){var t,r=e.code||e.key;if("playing"!==(null===(t=this._player.client)||void 0===t?void 0:t.status))return;if(this.systemCursorShowStatHandler.setSystemCursorShowAuto(),this.keyPressedList[r]&&"Backspace"!==r)return;this.keyPressedList[r]=r;var n=this._player._pcImeHandler;if(!n||n.needSendKey(e,!0)){var i=ProtoBufMessage.encodeKeyMsg(r,!0);this._player._sendMessage(i,!0)}}else{var o=keyCodeConvertPCtoAndroid(e);if(o&&-1!==o){var a=MessageFactory$1.eventTypeKey({action:ACTION.DOWN,key_code:o});this._player._sendCustomMessage(a)}}}},{key:"keyup",value:function(e){if(this._player.canOperate)if(this.mode===MODE.CLOUD_PC){var t,r=e.code;if("playing"!==(null===(t=this._player.client)||void 0===t?void 0:t.status))return;if(!this.keyPressedList[r])return;delete this.keyPressedList[r];var n=this._player._pcImeHandler;if(!n||n.needSendKey(e)){var i=ProtoBufMessage.encodeKeyMsg(r,!1);this._player._sendMessage(i,!0)}}else{var o=keyCodeConvertPCtoAndroid(e);if(o)if(-1===o){var a=MessageFactory$1.eventTypeKey({action:ACTION.UP,key_code:-1,value:e.key&&encodeURIComponent(e.key)});this._player._sendCustomMessage(a)}else{var s=MessageFactory$1.eventTypeKey({action:ACTION.UP,key_code:o});this._player._sendCustomMessage(s)}}}},{key:"pasteEvent",value:function(e){var t=(e.clipboardData||window.clipboardData).getData("text"),r=MessageFactory$1.eventTypeKey({action:ACTION.UP,key_code:-1,value:encodeURIComponent(t||"")});this._player._sendCustomMessage(r),e.preventDefault()}},{key:"_firstClickPlayAudio",value:function(){var e;this._player._needFirstClickPlayAudio&&"playing"===(null===(e=this._player.client)||void 0===e?void 0:e.status)&&(this._player._needFirstClickPlayAudio=!1,this._player.client.play(),this._player._setAudioMute(!1))}},{key:"destroy",value:function(){this.eventStore.clear()}}]),e}(),LocalKeyboardHandler$1=function(){function e(t,r){var n=r.customLocalKeyboardInputId,i=r.useCustomLocalKeyboardInput;_classCallCheck(this,e),this._player=t,this._isVePhone=null==t?void 0:t.isVePhone,this._inputContainerDomId="cc-player-input-container",this._inputDomId="cc-player-input",this._customLocalKeyboardInputId=n,this._useCustomLocalKeyboardInput=i,this._inputMethodData={actionId:0,selectionStart:0,selectionEnd:0},this._isFirstResponseRotation=!0,this._status=LOCAL_KEYBOARD_STATUS.BLUR,this._inputFocused=!1,this.inputCon=this.init(),this._keydownFn=null,this.composText=""}return _createClass(e,[{key:"status",get:function(){return this._status}},{key:"init",value:function(){var e,t,r,n=this;this._customLocalKeyboardInputId||this._useCustomLocalKeyboardInput?r=document.getElementById(this._customLocalKeyboardInputId):((r=document.createElement("textarea")).id=this._inputDomId,(t=document.createElement("div")).id=this._inputContainerDomId,t.style.position="fixed",t.style.marginRight=8,t.style.width="100%",t.style.maxWidth="95%",t.style.display="none",t.style.opacity=.01,t.style.left=0,t.style.top=0,t.style.pointerEvents="none"),this._player.on("on-keyboard-enable-change",(function(e){n._getInputElement()&&(r.disabled=!e)})),r&&this._initInputRelatedEvent(r),null===(e=t)||void 0===e||e.appendChild(r);var i={ArrowLeft:21,ArrowRight:22,ArrowUp:19,ArrowDown:20,Enter:66,Backspace:67};return document.addEventListener("keydown",this._keydownFn=function(e){var t;if(null===(t=n._player._pcImeHandler)||void 0===t||!t.isInComposition){var r=n._getInputElement();if((null==r||!r.composing)&&n._inputFocused){var o,a=i[e.key];if(a)(67!==a||null!==(o=n._player)&&void 0!==o&&o.isPodLxc)&&(e.preventDefault(),n._sendKeyCustom(a),n._sendKeyCustom(a,1))}}}),t}},{key:"_sendKeyCustom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._player._sendCustomMessage(MessageFactory$1.eventTypeKeyCustom({action:t,keycode:e}))}},{key:"_initInputRelatedEvent",value:function(e){var t=this;e.autocomplete="off",null==e||e.addEventListener("compositionstart",this._inputComsitionStartListener=function(e){e.target.composing=!0}),null==e||e.addEventListener("compositionend",this._inputComsitionEndListener=function(e){if(e.target.composing){e.target.composing=!1;var t=new Event("input");e.target.dispatchEvent(t)}}),null==e||e.addEventListener("input",this._inputInputListener=function(r){var n;if((""!==e.value||t._isVePhone)&&(null===(n=t._player._pcImeHandler)||void 0===n||!n.isInComposition)){if(!r.target.composing){var i,o={charSequence:e.value,isPodLxc:null===(i=t._player)||void 0===i?void 0:i.isPodLxc};t._customLocalKeyboardInputId?o.directInput=!0:"number"==typeof t._inputMethodData.actionId&&(o.actionId=t._inputMethodData.actionId);var a=MessageFactory$1.eventTypeInputMethod(o);t._player._sendCustomMessage(a);var s=r.data;"insertText"!==r.inputType&&"insertCompositionText"!==r.inputType&&!1!==r.isTrusted||!s||t._player.emit("custom-input-text",s)}if(!1===r.isTrusted){var c=t.composText;t.composText="",c&&t._player.emit("custom-input-text",c)}!0===r.isComposing&&!0===r.isTrusted&&(t.composText=(null==r?void 0:r.data)||"")}}),null==e||e.addEventListener("blur",this._inputBlurListener=function(){t._inputFocused=!1}),null==e||e.addEventListener("focus",this._inputFocusListener=function(){t._inputFocused=!0,t.updateInputSelection()})}},{key:"_removeInputRelatedEvent",value:function(e){null==e||e.removeEventListener("compositionstart",this._inputComsitionStartListener),null==e||e.removeEventListener("compositionend",this._inputComsitionEndListener),null==e||e.removeEventListener("input",this._inputInputListener),null==e||e.removeEventListener("blur",this._inputBlurListener),null==e||e.removeEventListener("focus",this._inputFocusListener)}},{key:"setCustomLocalKeyboardInputId",value:function(e){this._customLocalKeyboardInputId=e,this._hasInitInputRelatedEvent||(this._initInputRelatedEvent(this._getInputElement()),this._hasInitInputRelatedEvent=!0)}},{key:"clearCustomLocalKeyboardInput",value:function(){this._removeInputRelatedEvent(this._getInputElement()),this._customLocalKeyboardInputId=null,this._hasInitInputRelatedEvent=!1}},{key:"inputFocus",value:function(){var e=this._getInputElement();e===document.activeElement&&(null==e||e.focus(),this._status=LOCAL_KEYBOARD_STATUS.FOCUS)}},{key:"syncLocalKeyboardCloseStatus",value:function(){var e,t=this._getInputElement(),r={charSequence:null==t?void 0:t.value,isPodLxc:null===(e=this._player)||void 0===e?void 0:e.isPodLxc,visibility:!1};"number"==typeof this._inputMethodData.actionId&&(r.actionId=this._inputMethodData.actionId);var n=MessageFactory$1.eventTypeInputMethod(r);return this._player._sendCustomMessage(n)}},{key:"_getInputElement",value:function(){return this._customLocalKeyboardInputId||this._useCustomLocalKeyboardInput?document.getElementById(this._customLocalKeyboardInputId):document.getElementById(this._inputDomId)}},{key:"onReceiveCurText",value:function(e,t){var r;if(!e)return!1;var n=null!==(r=this._player)&&void 0!==r&&r.isPodLxc?t:decodeURIComponent(t),i=n===e.value;return i||(e.value=n),e.focus(),i}},{key:"handleInputMethodEvent",value:function(e){var t=document.getElementById(this._inputContainerDomId),r=this._getInputElement();if(e.command===SERVER_COMMAND.CMD_INPUT_START){t&&(t.style.display="block");var n=e.currentText,i=e.selectionStart,o=e.selectionEnd;this.onReceiveCurText(r,n),this._inputMethodData.actionId=e.data.actionId,this._inputMethodData.selectionStart=i,this._inputMethodData.selectionEnd=o,this._status=LOCAL_KEYBOARD_STATUS.NEED_INTERACTION,this._player.emit("local-keyboard-open",{currentText:n,selectionStart:i,selectionEnd:o})}if(e.command===SERVER_COMMAND.CMD_INPUT_SHOW){t&&(t.style.display="block");var a=e.currentText,s=e.selectionStart,c=e.selectionEnd;this.onReceiveCurText(r,a),this._inputMethodData.selectionStart=s,this._inputMethodData.selectionEnd=c,this.updateInputSelection(),this._status=LOCAL_KEYBOARD_STATUS.NEED_INTERACTION,this._player.emit("local-keyboard-open",{currentText:a,selectionStart:s,selectionEnd:c})}e.command===SERVER_COMMAND.CMD_INPUT_DESTROY&&(t&&(t.style.display="none"),this._inputMethodData.selectionStart=null,this._inputMethodData.selectionEnd=null,null==r||r.blur(),r&&(r.value=""),this._status=LOCAL_KEYBOARD_STATUS.BLUR,this._player.emit("local-keyboard-close"))}},{key:"handleRotationEvent",value:function(e){if(this._isFirstResponseRotation){this._isFirstResponseRotation=!1;var t=MessageFactory$1.eventTypeOrientation();this._player._sendCustomMessage(t)}if(!this._isVePhone){var r,n=MessageFactory$1.eventTypeInputMethod({actionId:this._inputMethodData.actionId,isPodLxc:null===(r=this._player)||void 0===r?void 0:r.isPodLxc});return this._player._sendCustomMessage(n)}}},{key:"updateInputSelection",value:function(){var e=this._getInputElement();null!==this._inputMethodData.selectionStart&&null!==this._inputMethodData.selectionEnd&&(null==e||e.setSelectionRange(this._inputMethodData.selectionStart,this._inputMethodData.selectionEnd))}},{key:"reset",value:function(){this._isFirstResponseRotation=!0,this._status=LOCAL_KEYBOARD_STATUS.BLUR,this.composText=""}},{key:"destroy",value:function(){this.inputCon=null,document.removeEventListener("keydown",this._keydownFn)}}]),e}(),LocalKeyboardHandler=function(){function e(t,r){var n=this,i=r.customLocalKeyboardInputId;_classCallCheck(this,e),this.keydown=function(e){var t=null==KEYCODE_ANDROID_ORIGIN?void 0:KEYCODE_ANDROID_ORIGIN[null==FUNCTION_KEYCODE_CONVERT_ANDROID?void 0:FUNCTION_KEYCODE_CONVERT_ANDROID[null==e?void 0:e.code]];if(""!==n.composText||!n._inputFocused)return!1;t&&(n._player._sendCustomMessage(MessageFactory$1.eventTypeKeyCustom({action:0,keycode:t})),n._player._sendCustomMessage(MessageFactory$1.eventTypeKeyCustom({action:1,keycode:t})),n._player.emit("custom-input-key-event",{action:0,keycode:t}),n._player.emit("custom-input-key-event",{action:1,keycode:t}))},this.keyup=function(e){var t=null==KEYCODE_ANDROID_ORIGIN?void 0:KEYCODE_ANDROID_ORIGIN[null==FUNCTION_KEYCODE_CONVERT_ANDROID?void 0:FUNCTION_KEYCODE_CONVERT_ANDROID[null==e?void 0:e.code]];if(""!==n.composText)return!1;t&&(n._player._sendCustomMessage(MessageFactory$1.eventTypeKeyCustom({action:1,keycode:t})),n._player.emit("custom-input-key-event",{action:1,keycode:t}))},this.pasteEvent=function(e){var t=(e.clipboardData||window.clipboardData).getData("text")||"";if(t&&n._inputFocused){var r={inputContext:t},i=MessageFactory$1.eventTypeInputCombineMethod(r);n._player._sendCustomMessage(i),n._player.emit("custom-input-text",t)}},this.mouseUp=function(e){if(n._status===LOCAL_KEYBOARD_STATUS.FOCUS&&!n._inputFocused){var t=document.getElementById(n._inputDomId);null==t||t.focus()}},this._player=t,this._inputContainerDomId="".concat(this._player.containerDomId,"-inputGroup"),this._inputDomId="".concat(this._player.containerDomId,"-input"),this._customLocalKeyboardInputId=i,this.touchElement=document.getElementById(this._player.domId),this._isFirstResponseRotation=!0,this._status=LOCAL_KEYBOARD_STATUS.BLUR,this._inputFocused=!1,this.inputCon=this.init(),this.composText=""}return _createClass(e,[{key:"status",get:function(){return this._status}},{key:"init",value:function(){var e,t,r,n=this;return this._customLocalKeyboardInputId?(r=document.getElementById(this._customLocalKeyboardInputId),this._inputDomId=this._customLocalKeyboardInputId):((r=document.createElement("textarea")).id=this._inputDomId,(t=document.createElement("div")).id=this._inputContainerDomId,t.style.position="absolute",t.style.marginRight=8,t.style.width="100%",t.style.maxWidth="95%",t.style.display="none",t.style.opacity=.01,t.style.left=0,t.style.top=0,t.style.pointerEvents="none"),r.autocomplete="off",this._player.on("on-keyboard-enable-change",(function(e){r.disabled=!e})),r.addEventListener("compositionstart",(function(e){e.target.composing=!0})),r.addEventListener("compositionend",(function(e){if(e.target.composing){e.target.composing=!1;var t=new Event("input");e.target.dispatchEvent(t)}})),r.addEventListener("input",(function(e){var t;if(null===(t=n._player._pcImeHandler)||void 0===t||!t.isInComposition){if(!e.target.composing||!1===e.isTrusted){var r=e.data;if(!1===e.isTrusted&&(r=n.composText,n.composText=""),("insertText"===e.inputType||"insertCompositionText"===e.inputType||!1===e.isTrusted)&&r){var i={inputContext:r},o=MessageFactory$1.eventTypeInputCombineMethod(i);n._player._sendCustomMessage(o),n._player.emit("custom-input-text",r)}}!0===e.isComposing&&!0===e.isTrusted&&(n.composText=(null==e?void 0:e.data)||"")}})),r.addEventListener("blur",(function(){n._inputFocused=!1})),r.addEventListener("focus",(function(){n._inputFocused=!0})),null===(e=t)||void 0===e||e.appendChild(r),this._player.isPC&&(document.addEventListener("keydown",this.keydown),document.addEventListener("paste",this.pasteEvent),this.touchElement.addEventListener("mouseup",this.mouseUp)),t}},{key:"inputFocus",value:function(){var e=document.getElementById(this._inputDomId);e===document.activeElement&&(e.focus(),this._status=LOCAL_KEYBOARD_STATUS.FOCUS)}},{key:"handleInputMethodEvent",value:function(e){var t,r,n=document.getElementById(this._inputContainerDomId),i=document.getElementById(this._inputDomId);e.command===SERVER_COMMAND.CMD_TEXT_INPUT_CONTROL&&null!=e&&null!==(t=e.data)&&void 0!==t&&t.enable&&(n&&(n.style.display="block"),i.focus(),this._status=LOCAL_KEYBOARD_STATUS.FOCUS,this._player.emit("local-keyboard-open")),e.command!==SERVER_COMMAND.CMD_TEXT_INPUT_CONTROL||null!=e&&null!==(r=e.data)&&void 0!==r&&r.enable||(n&&(n.style.display="none"),i.blur(),i.value="",this._status=LOCAL_KEYBOARD_STATUS.BLUR,this._player.emit("local-keyboard-close"))}},{key:"handleRotationEvent",value:function(e){if(this._isFirstResponseRotation){this._isFirstResponseRotation=!1;var t=MessageFactory$1.eventTypeOrientation();this._player._sendCustomMessage(t)}}},{key:"reset",value:function(){this._isFirstResponseRotation=!0,this.composText="",this._status=LOCAL_KEYBOARD_STATUS.BLUR}},{key:"destroy",value:function(){this.inputCon=null,document.removeEventListener("keydown",this.keydown),document.removeEventListener("paste",this.pasteEvent),this.touchElement.removeEventListener("mouseup",this.mouseUp)}}]),e}(),_excluded$2=["message"],_excluded2$1=["msg"],_excluded3$1=["ele","fakeEle"],_excluded4$1=["orgTrack","mediaTrack","preprocessingTrack"],_excluded5$1=["orgTrack","mediaTrack","preprocessingTrack"],_ref,_ref15,_RoomProfileMap,_a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l,_m,_n,_o,_p,_q,_r,_s,_t,__defProp$1=Object.defineProperty,__defNormalProp=function(e,t,r){return t in e?__defProp$1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},__publicField=function(e,t,r){return __defNormalProp(e,"symbol"!=_typeof(t)?t+"":t,r),r};function _mergeNamespaces$1(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(r){if("default"!==r&&!(r in e)){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(e)}var detectorResults={};function getObjectFunctions(e,t){return e?Object.getOwnPropertyNames(e).filter((function(t){if("peerIdentity"===t)return!1;try{return"function"==typeof e[t]||void 0===e[t]}catch(r){return!1}})).map((function(r){return{obj:e,prefix:t,attr:r}})):[]}function isNativeCode(e,t){try{return e[t].toString().includes("[native code]")?"native":"non-native"}catch(r){return"untouchable"}}var detectorList=("undefined"!=typeof window?[[null==(_a=window.RTCPeerConnection)?void 0:_a.prototype,"RTCPeerConnection.prototype"],[window.RTCPeerConnection,"RTCPeerConnection"],[null==(_b=window.RTCDataChannel)?void 0:_b.prototype,"RTCDataChannel.prototype"],[window.RTCDataChannel,"RTCDataChannel"],[null==(_c=window.MediaStreamTrack)?void 0:_c.prototype,"MediaStreamTrack.prototype"],[window.MediaStreamTrack,"MediaStreamTrack"],[null==(_d=window.MediaStream)?void 0:_d.prototype,"MediaStream.prototype"],[window.MediaStream,"MediaStream"],[null==(_e=window.HTMLAudioElement)?void 0:_e.prototype,"HTMLAudioElement.prototype"],[null==(_f=window.HTMLVideoElement)?void 0:_f.prototype,"HTMLVideoElement.prototype"],[null==(_g=window.HTMLMediaElement)?void 0:_g.prototype,"HTMLMediaElement.prototype"],[null!==(_ref=null==(_h=window.AudioContext)?void 0:_h.prototype)&&void 0!==_ref?_ref:null==(_i=window.webkitAudioContext)?void 0:_i.prototype,"AudioContext.prototype"],[null==(_j=window.BaseAudioContext)?void 0:_j.prototype,"BaseAudioContext.prototype"],[null==(_k=window.AudioNode)?void 0:_k.prototype,"AudioNode.prototype"],[window.navigator.mediaDevices,"navigator.mediaDevices"],[window.console,"console"]]:[]).reduce((function(e,t){var r=_slicedToArray(t,2),n=r[0],i=r[1];return e.concat(getObjectFunctions(n,i))}),[]);"undefined"!=typeof window&&detectorList.push({obj:window.navigator.mediaDevices,prefix:"navigator.mediaDevices",attr:"getUserMedia"},{obj:window.navigator.mediaDevices,prefix:"navigator.mediaDevices",attr:"getDisplayMedia"},{obj:window.navigator.mediaDevices,prefix:"navigator.mediaDevices",attr:"enumerateDevices"},{obj:window.navigator.mediaDevices,prefix:"navigator.mediaDevices",attr:"getSupportedConstraints"});var _iterator2=_createForOfIteratorHelper(detectorList),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _step2$value=_step2.value,_e156=_step2$value.obj,t$1=_step2$value.prefix,i$1=_step2$value.attr;detectorResults["".concat(t$1,".").concat(i$1)]=isNativeCode(_e156,i$1)}}catch(err2){_iterator2.e(err2)}finally{_iterator2.f()}var DEBUG$2="undefined"!=typeof window&&(window.location.search.includes("_rtc_debug_")||(null==(_l=window.localStorage)?void 0:_l.getItem("_rtc_debug_")));DEBUG$2&&console.log("RTC_AMBULANCE",detectorResults);var filtedResult=Object.entries(detectorResults).filter((function(e){var t=_slicedToArray(e,2);return t[0],"non-native"===t[1]})).map((function(e){var t=_slicedToArray(e,2),r=t[0];return t[1],r}));Object.keys(filtedResult).length&&console.warn("RTC_AMBULANCE","have non-native code:\n",filtedResult.join("\n"));var logDisabled_=!0,deprecationWarnings_=!0;function extractVersion(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function wrapPeerConnectionEvent(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=r(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,o),i.apply(this,[e,o])};var o=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(r))return o.apply(this,arguments);var n=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function disableLog(e){return"boolean"!=typeof e?new Error("Argument type: "+_typeof(e)+". Please use a boolean."):(logDisabled_=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function disableWarnings(e){return"boolean"!=typeof e?new Error("Argument type: "+_typeof(e)+". Please use a boolean."):(deprecationWarnings_=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function log(){if("object"==("undefined"==typeof window?"undefined":_typeof(window))){if(logDisabled_)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function deprecated(e,t){deprecationWarnings_&&console.warn(e+" is deprecated, please use "+t+" instead.")}function detectBrowser(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var r=e.navigator;if(r.mozGetUserMedia)t.browser="firefox",t.version=extractVersion(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=extractVersion(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=extractVersion(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function isObject$1$1(e){return"[object Object]"===Object.prototype.toString.call(e)}function compactObject(e){return isObject$1$1(e)?Object.keys(e).reduce((function(t,r){var n=isObject$1$1(e[r]),i=n?compactObject(e[r]):e[r],o=n&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,_defineProperty$1({},r,i))}),{}):e}function walkStats(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((function(n){n.endsWith("Id")?walkStats(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach((function(t){walkStats(e,e.get(t),r)}))})))}function filterStats(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((function(t){e.forEach((function(r){r.type===n&&r.trackId===t.id&&walkStats(e,r,i)}))})),i}var logging=log;function shimGetUserMedia$2(e,t){var r=e&&e.navigator;if(r.mediaDevices){var n=function(e){if("object"!=_typeof(e)||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n="object"==_typeof(e[r])?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var o={};"number"==typeof n.ideal?(o[i("min",r)]=n.ideal,t.optional.push(o),(o={})[i("max",r)]=n.ideal,t.optional.push(o)):(o[i("",r)]=n.ideal,t.optional.push(o))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",r)]=n.exact):["min","max"].forEach((function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,r)]=n[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==_typeof(e.audio)){var o=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};o((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),o(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"==_typeof(e.video)){var a=e.video.facingMode;a=a&&("object"==_typeof(a)?a:{ideal:a});var s,c=t.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||c))if(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?s=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(s=["front"]),s)return r.mediaDevices.enumerateDevices().then((function(t){var r=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return s.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!r&&t.length&&s.includes("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=a.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=n(e.video),logging("chrome: "+JSON.stringify(e)),i(e)}));e.video=n(e.video)}return logging("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(e,t,n){i(e,(function(e){r.webkitGetUserMedia(e,t,(function(e){n&&n(o(e))}))}))}.bind(r),r.mediaDevices.getUserMedia){var a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return i(e,(function(e){return a(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(o(e))}))}))}}}}function shimGetDisplayMedia$1(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((function(t){var n=r.video&&r.video.width,i=r.video&&r.video.height,o=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},n&&(r.video.mandatory.maxWidth=n),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function shimMediaStream(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function shimOnTrack$1(e){if("object"==_typeof(e)&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===n.track.id})):{track:n.track};var o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)})),t.stream.getTracks().forEach((function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===n.id})):{track:n};var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else wrapPeerConnectionEvent(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))}function shimGetSendersWithDtmf(e){if("object"==_typeof(e)&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((function(e){r._senders.push(t(r,e))}))};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach((function(e){var r=t._senders.find((function(t){return t.track===e}));r&&t._senders.splice(t._senders.indexOf(r),1)}))}}else if("object"==_typeof(e)&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function shimGetStats(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,r=Array.prototype.slice.call(arguments),n=r[0],i=r[1],o=r[2];if(arguments.length>0&&"function"==typeof n)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof n))return t.apply(this,[]);var a=function(e){var t={};return e.result().forEach((function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){r[t]=e.stat(t)})),t[r.id]=r})),t},s=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){var c=function(e){i(s(a(e)))};return t.apply(this,[c,n])}return new Promise((function(r,n){t.apply(e,[function(e){r(s(a(e)))},n])})).then(i,o)}}}function shimSenderReceiverGetStats(e){if("object"==_typeof(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return filterStats(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=n.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return filterStats(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,r,n,o=arguments[0];return this.getSenders().forEach((function(e){e.track===o&&(t?n=!0:t=e)})),this.getReceivers().forEach((function(e){return e.track===o&&(r?n=!0:r=e),e.track===o})),n||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}}}function shimAddTrackRemoveTrackWithNative(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var n=this.getSenders();r.apply(this,arguments);var i=this.getSenders().filter((function(e){return-1===n.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]})),i.apply(this,arguments)}}function shimAddTrackRemoveTrack(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return shimAddTrackRemoveTrackWithNative(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(r.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}n.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((function(e){return e.track===t})))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var o=this._streams[r.id];if(o)o.addTrack(t),Promise.resolve().then((function(){n.dispatchEvent(new Event("negotiationneeded"))}));else{var a=new e.MediaStream([t]);this._streams[r.id]=a,this._reverseStreams[a.id]=r,this.addStream(a)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],n=_defineProperty$1({},t,(function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[function(r){var n=s(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then((function(t){return s(e,t)}))}));e.RTCPeerConnection.prototype[t]=n[t]}));var o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(e=this,r=(t=arguments[0]).sdp,Object.keys(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:r})),o.apply(this,arguments)):o.apply(this,arguments);var e,t,r};var a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=a.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach((function(n){r._streams[n].getTracks().find((function(t){return e.track===t}))&&(t=r._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function s(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:r})}}function shimPeerConnection$1(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],n=_defineProperty$1({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=n[t]}))}function fixNegotiationNeeded(e,t){wrapPeerConnectionEvent(e,"negotiationneeded",(function(e){var r=e.target;if(!(t.version<72||r.getConfiguration&&"plan-b"===r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e}))}var chromeShim=Object.freeze({__proto__:null,fixNegotiationNeeded:fixNegotiationNeeded,shimAddTrackRemoveTrack:shimAddTrackRemoveTrack,shimAddTrackRemoveTrackWithNative:shimAddTrackRemoveTrackWithNative,shimGetDisplayMedia:shimGetDisplayMedia$1,shimGetSendersWithDtmf:shimGetSendersWithDtmf,shimGetStats:shimGetStats,shimGetUserMedia:shimGetUserMedia$2,shimMediaStream:shimMediaStream,shimOnTrack:shimOnTrack$1,shimPeerConnection:shimPeerConnection$1,shimSenderReceiverGetStats:shimSenderReceiverGetStats});function shimGetUserMedia$1(e,t){var r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var i=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"==_typeof(e)&&"object"==_typeof(e.audio)&&(e=JSON.parse(JSON.stringify(e)),i(e.audio,"autoGainControl","mozAutoGainControl"),i(e.audio,"noiseSuppression","mozNoiseSuppression")),o(e)},n&&n.prototype.getSettings){var a=n.prototype.getSettings;n.prototype.getSettings=function(){var e=a.apply(this,arguments);return i(e,"mozAutoGainControl","autoGainControl"),i(e,"mozNoiseSuppression","noiseSuppression"),e}}if(n&&n.prototype.applyConstraints){var s=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==_typeof(e)&&(e=JSON.parse(JSON.stringify(e)),i(e,"autoGainControl","mozAutoGainControl"),i(e,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[e])}}}}function shimGetDisplayMedia(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}function shimOnTrack(e){"object"==_typeof(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function shimPeerConnection(e,t){if("object"==_typeof(e)&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],n=_defineProperty$1({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=n[t]}));var r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),i=e[0],o=e[1],a=e[2];return n.apply(this,[i||null]).then((function(e){if(t.version<53&&!o)try{e.forEach((function(e){e.type=r[e.type]||e.type}))}catch(n){if("TypeError"!==n.name)throw n;e.forEach((function(t,n){e.set(n,Object.assign({},t,{type:r[t.type]||t.type}))}))}return e})).then(o,a)}}}function shimSenderGetStats(e){if("object"==_typeof(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function shimReceiverGetStats(e){if("object"==_typeof(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r}),wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function shimRemoveStream(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;deprecated("removeStream","removeTrack"),this.getSenders().forEach((function(r){r.track&&e.getTracks().includes(r.track)&&t.removeTrack(r)}))})}function shimRTCDataChannel(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function shimAddTransceiver(e){if("object"==_typeof(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);var r=(e=_toConsumableArray(e)).length>0;r&&e.forEach((function(e){if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var n=t.apply(this,arguments);if(r){var i=n.sender,o=i.getParameters();(!("encodings"in o)||1===o.encodings.length&&0===Object.keys(o.encodings[0]).length)&&(o.encodings=e,i.sendEncodings=e,this.setParametersPromises.push(i.setParameters(o).then((function(){delete i.sendEncodings})).catch((function(){delete i.sendEncodings}))))}return n})}}function shimGetParameters(e){if("object"==_typeof(e)&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}}function shimCreateOffer(e){if("object"==_typeof(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(r,e)})).finally((function(){r.setParametersPromises=[]})):t.apply(this,arguments)}}}function shimCreateAnswer(e){if("object"==_typeof(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(r,e)})).finally((function(){r.setParametersPromises=[]})):t.apply(this,arguments)}}}var firefoxShim=Object.freeze({__proto__:null,shimAddTransceiver:shimAddTransceiver,shimCreateAnswer:shimCreateAnswer,shimCreateOffer:shimCreateOffer,shimGetDisplayMedia:shimGetDisplayMedia,shimGetParameters:shimGetParameters,shimGetUserMedia:shimGetUserMedia$1,shimOnTrack:shimOnTrack,shimPeerConnection:shimPeerConnection,shimRTCDataChannel:shimRTCDataChannel,shimReceiverGetStats:shimReceiverGetStats,shimRemoveStream:shimRemoveStream,shimSenderGetStats:shimSenderGetStats});function shimLocalStreamsAPI(e){if("object"==_typeof(e)&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(n){return t.call(r,n,e)})),e.getVideoTracks().forEach((function(n){return t.call(r,n,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var r=this,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return i&&i.forEach((function(e){r._localStreams?r._localStreams.includes(e)||r._localStreams.push(e):r._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var n=e.getTracks();this.getSenders().forEach((function(e){n.includes(e.track)&&t.removeTrack(e)}))}})}}function shimRemoteStreamsAPI(e){if("object"==_typeof(e)&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}}))}),t.apply(e,arguments)}}}function shimCallbacksAPI(e){if("object"==_typeof(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};var s=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=s,s=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=s,s=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=s}}function shimGetUserMedia(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return n(shimConstraints(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))}function shimConstraints(e){return e&&void 0!==e.video?Object.assign({},e,{video:compactObject(e.video)}):e}function shimRTCIceServerUrls(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(deprecated("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,delete o.url,n.push(o)):n.push(e.iceServers[i])}e.iceServers=n}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}function shimTrackEventTransceiver(e){"object"==_typeof(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function shimCreateOfferLegacy(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var n=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function shimAudioContext(e){"object"!=_typeof(e)||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var safariShim=Object.freeze({__proto__:null,shimAudioContext:shimAudioContext,shimCallbacksAPI:shimCallbacksAPI,shimConstraints:shimConstraints,shimCreateOfferLegacy:shimCreateOfferLegacy,shimGetUserMedia:shimGetUserMedia,shimLocalStreamsAPI:shimLocalStreamsAPI,shimRTCIceServerUrls:shimRTCIceServerUrls,shimRemoteStreamsAPI:shimRemoteStreamsAPI,shimTrackEventTransceiver:shimTrackEventTransceiver});function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var sdp$1={exports:{}};!function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},t.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},t.getDescription=function(e){var r=t.splitSections(e);return r&&r[0]},t.getMediaSections=function(e){var r=t.splitSections(e);return r.shift(),r},t.matchPrefix=function(e,r){return t.splitLines(e).filter((function(e){return 0===e.indexOf(r)}))},t.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:void 0===r[t[n]]&&(r[t[n]]=t[n+1])}return r},t.writeCandidate=function(e){var t=[];t.push(e.foundation);var r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},t.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(t=n[i].trim().split("="))[0].trim()]=t[1];return r},t.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach((function(t){void 0!==e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)})),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},t.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},t.getMid=function(e){var r=t.matchPrefix(e,"a=mid:")[0];if(r)return r.substr(6)},t.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,r){return{role:"auto",fingerprints:t.matchPrefix(e+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},t.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==_typeof(e.keyParams)?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,r){return t.matchPrefix(e+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,r){var n=t.matchPrefix(e+r,"a=ice-ufrag:")[0],i=t.matchPrefix(e+r,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substr(12),password:i.substr(10)}:null},t.writeIceParameters=function(e){var t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){for(var r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var o=n[i],a=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=t.parseRtpMap(a),c=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?t.parseFmtp(c[0]):{},s.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),r.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(s.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach((function(e){r.headerExtensions.push(t.parseExtmap(e))})),r},t.writeRtpDescription=function(e,r){var n="";n+="m="+e+" ",n+=r.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=r.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",r.codecs.forEach((function(e){n+=t.writeRtpMap(e),n+=t.writeFmtp(e),n+=t.writeRtcpFb(e)}));var i=0;return r.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(n+="a=maxptime:"+i+"\r\n"),r.headerExtensions&&r.headerExtensions.forEach((function(e){n+=t.writeExtmap(e)})),n},t.parseRtpEncodingParameters=function(e){var r,n=[],i=t.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,u=t.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));u.length>0&&u[0].length>1&&u[0][0]===c&&(r=u[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&r&&(t.rtx={ssrc:r}),n.push(t),o&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&c&&n.push({ssrc:c});var l=t.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,n.forEach((function(e){e.maxBitrate=l}))),n},t.parseRtcpParameters=function(e){var r={},n=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);var i=t.matchPrefix(e,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=0===i.length;var o=t.matchPrefix(e,"a=rtcp-mux");return r.mux=o.length>0,r},t.writeRtcpParameters=function(e){var t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){var r,n=t.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(r=n[0].substr(7).split(" "))[0],track:r[1]};var i=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(r=i[0].value.split(" "))[0],track:r[1]}:void 0},t.parseSctpDescription=function(e){var r,n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");i.length>0&&(r=parseInt(i[0].substr(19),10)),isNaN(r)&&(r=65536);var o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:n.fmt,maxMessageSize:r};var a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){var s=a[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){var r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,r,n){var i=void 0!==r?r:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,r){for(var n=t.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){var r=t.splitLines(e)[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(e){var r=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var r=t.splitLines(e),n=0;n<r.length;n++)if(r[n].length<2||"="!==r[n].charAt(1))return!1;return!0},e.exports=t}(sdp$1);var sdpExports=sdp$1.exports,SDPUtils=getDefaultExportFromCjs(sdpExports),sdp=_mergeNamespaces$1({__proto__:null,default:SDPUtils},[sdpExports]);function shimRTCIceCandidate(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==_typeof(e)&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),n=SDPUtils.parseCandidate(e.candidate),i=Object.assign(r,n);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,wrapPeerConnectionEvent(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}}function shimRTCIceCandidateRelayProtocol(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||wrapPeerConnectionEvent(e,"icecandidate",(function(e){if(e.candidate){var t=SDPUtils.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function shimMaxMessageSize(e,t){if(e.RTCPeerConnection){"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var e=this.getConfiguration(),n=e.sdpSemantics;"plan-b"===n&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;var t=SDPUtils.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=SDPUtils.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){var i,o=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r}(arguments[0]),a=(u=o,l=65536,"firefox"===t.browser&&(l=t.version<57?-1===u?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),l),s=function(e,r){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var i=SDPUtils.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?n=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n}(arguments[0],o);i=0===a&&0===s?Number.POSITIVE_INFINITY:0===a||0===s?Math.max(a,s):Math.min(a,s);var c={};Object.defineProperty(c,"maxMessageSize",{get:function(){return i}}),this._sctp=c}var u,l;return r.apply(this,arguments)}}}function shimSendThrowTypeError(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},wrapPeerConnectionEvent(e,"datachannel",(function(e){return r(e.channel,e.target),e}))}function r(e,t){var r=e.send;e.send=function(){var n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}}function shimConnectionState(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}}function removeExtmapAllowMixed(e,t){if(e.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)){var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){var n=t.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return r.apply(this,arguments)}}}function shimAddIceCandidateNullOrEmpty(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}}function shimParameterlessSetLocalDescription(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var r=e.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this,t=arguments[0]||{};if("object"!=_typeof(t)||t.type&&t.sdp)return r.apply(this,arguments);if(!(t={type:t.type,sdp:t.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":t.type="offer";break;default:t.type="answer"}return t.sdp||"offer"!==t.type&&"answer"!==t.type?r.apply(this,[t]):("offer"===t.type?this.createOffer:this.createAnswer).apply(this).then((function(t){return r.apply(e,[t])}))})}}var commonShim=Object.freeze({__proto__:null,removeExtmapAllowMixed:removeExtmapAllowMixed,shimAddIceCandidateNullOrEmpty:shimAddIceCandidateNullOrEmpty,shimConnectionState:shimConnectionState,shimMaxMessageSize:shimMaxMessageSize,shimParameterlessSetLocalDescription:shimParameterlessSetLocalDescription,shimRTCIceCandidate:shimRTCIceCandidate,shimRTCIceCandidateRelayProtocol:shimRTCIceCandidateRelayProtocol,shimSendThrowTypeError:shimSendThrowTypeError});function adapterFactory(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.window,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},n=log,i=detectBrowser(t),o={browserDetails:i,commonShim:commonShim,extractVersion:extractVersion,disableLog:disableLog,disableWarnings:disableWarnings,sdp:sdp};switch(i.browser){case"chrome":if(!chromeShim||!shimPeerConnection$1||!r.shimChrome)return n("Chrome shim is not included in this adapter release."),o;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),o;n("adapter.js shimming chrome."),o.browserShim=chromeShim,shimAddIceCandidateNullOrEmpty(t,i),shimParameterlessSetLocalDescription(t),shimGetUserMedia$2(t,i),shimMediaStream(t),shimPeerConnection$1(t,i),shimOnTrack$1(t),shimAddTrackRemoveTrack(t,i),shimGetSendersWithDtmf(t),shimGetStats(t),shimSenderReceiverGetStats(t),fixNegotiationNeeded(t,i),shimRTCIceCandidate(t),shimRTCIceCandidateRelayProtocol(t),shimConnectionState(t),shimMaxMessageSize(t,i),shimSendThrowTypeError(t),removeExtmapAllowMixed(t,i);break;case"firefox":if(!firefoxShim||!shimPeerConnection||!r.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=firefoxShim,shimAddIceCandidateNullOrEmpty(t,i),shimParameterlessSetLocalDescription(t),shimGetUserMedia$1(t,i),shimPeerConnection(t,i),shimOnTrack(t),shimRemoveStream(t),shimSenderGetStats(t),shimReceiverGetStats(t),shimRTCDataChannel(t),shimAddTransceiver(t),shimGetParameters(t),shimCreateOffer(t),shimCreateAnswer(t),shimRTCIceCandidate(t),shimConnectionState(t),shimMaxMessageSize(t,i),shimSendThrowTypeError(t);break;case"safari":if(!safariShim||!r.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=safariShim,shimAddIceCandidateNullOrEmpty(t,i),shimParameterlessSetLocalDescription(t),shimRTCIceServerUrls(t),shimCreateOfferLegacy(t),shimCallbacksAPI(t),shimLocalStreamsAPI(t),shimRemoteStreamsAPI(t),shimTrackEventTransceiver(t),shimGetUserMedia(t),shimAudioContext(t),shimRTCIceCandidate(t),shimRTCIceCandidateRelayProtocol(t),shimMaxMessageSize(t,i),shimSendThrowTypeError(t),removeExtmapAllowMixed(t,i);break;default:n("Unsupported browser!")}return o}adapterFactory({window:"undefined"==typeof window?void 0:window});var getRandomValues$1,ErrorCode=function(e){return e.INVALID_ENGINE="INVALID_ENGINE",e.INVALID_PARAMS="INVALID_PARAMS",e.INVOKED_BEFORE_JOIN_ROOM="INVOKED_BEFORE_JOIN_ROOM",e.INVALID_TOKEN="INVALID_TOKEN",e.JOIN_ROOM_FAILED="JOIN_ROOM_FAILED",e.UPDATE_TOKEN_WITH_INVALID_TOKEN="UPDATE_TOKEN_WITH_INVALID_TOKEN",e.UPDATE_TOKEN_BEFORE_JOIN="UPDATE_TOKEN_BEFORE_JOIN",e.REPEAT_JOIN="REPEAT_JOIN",e.REPEAT_PUBLISH="REPEAT_PUBLISH",e.REPEAT_PUSH="REPEAT_PUSH",e.REPEAT_PLAY="REPEAT_PLAY",e.PUBLISH_BEFORE_JOIN="PUBLISH_BEFORE_JOIN",e.UNPUBLISH_BEFORE_JOIN="UNPUBLISH_BEFORE_JOIN",e.SUBSCRIBE_BEFORE_JOIN="SUBSCRIBE_BEFORE_JOIN",e.UNSUBSCRIBE_BEFORE_JOIN="UNSUBSCRIBE_BEFORE_JOIN",e.NO_PUBLISH_PERMISSION="NO_PUBLISH_PERMISSION",e.STREAM_NOT_EXIST="STREAM_NOT_EXIST",e.EMPTY_STREAM="EMPTY_STREAM",e.NOT_CONNECTED_YET="NOT_CONNECTED_YET",e.IM_BEFORE_JOIN="IM_BEFORE_JOIN",e.USER_NOT_EXIST="USER_NOT_EXIST",e.ALREADY_IN_ROOM="ALREADY_IN_ROOM",e.KICKED_OUT="KICKED_OUT",e.ROOM_DISMISS="ROOM_DISMISS",e.TOKEN_EXPIRED="TOKEN_EXPIRED",e.DUPLICATE_LOGIN="DUPLICATE_LOGIN",e.INVOKED_BEFORE_CAPTURE="INVOKED_BEFORE_CAPTURE",e.REPEAT_CAPTURE="REPEAT_CAPTURE",e.GET_VIDEO_TRACK_FAILED="GET_VIDEO_TRACK_FAILED",e.GET_AUDIO_TRACK_FAILED="GET_AUDIO_TRACK_FAILED",e.GET_SCREEN_TRACK_FAILED="GET_SCREEN_TRACK_FAILED",e.STREAM_TYPE_NOT_MATCH="STREAM_TYPE_NOT_MATCH",e.CANT_FIND_DOM="CANT_FIND_DOM",e.INVALID_DEVICE_ID="INVALID_DEVICE_ID",e.NO_PERMISSION="NO_PERMISSION",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INTERRUPT="INTERRUPT",e.ICE_SERVER_WRONG="ICE_SERVER_WRONG",e.ESTABLISH_DATACHANNEL_FAILED="ESTABLISH_DATACHANNEL_FAILED",e.LOAD_RESOURCES_FAILED="LOAD_RESOURCES_FAILED",e.SIGNALING_CHANNEL_NOT_OPEN="SIGNALING_CHANNEL_NOT_OPEN",e.TIME_OUT="TIME_OUT",e.REFUSE_OPERATION_IN_DISCONNECT="REFUSE_OPERATION_IN_DISCONNECT",e.ADD_TRANSCEIVER_FAILED="ADD_TRANSCEIVER_FAILED",e.UPDATE_TRACK_FAILED="UPDATE_TRACK_FAILED",e.PUBLISH_FAILED="PUBLISH_FAILED",e.UNPUBLISH_FAILED="UNPUBLISH_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.OPERATION_CANCEL="OPERATION_CANCEL",e.START_CLOUD_PROXY_AFTER_JOIN="START_CLOUD_PROXY_AFTER_JOIN",e.STOP_CLOUD_PROXY_BEFORE_LEAVE="STOP_CLOUD_PROXY_BEFORE_LEAVE",e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.REPEAT_DEVICE_TEST="REPEAT_DEVICE_TEST",e.AUDIO_DEVICE_TEST_FAILED="AUDIO_DEVICE_RECORD_FAILED",e.ALREADY_LOGIN="ALREADY_LOGIN",e.LOGIN_FAILED="LOGIN_FAILED",e.NOT_LOGIN="NOT_LOGIN",e.RTM_DUPLICATE_LOGIN="RTM_DUPLICATE_LOGIN",e.RTM_TOKEN_ERROR="RTM_TOKEN_ERROR",e.USER_MESSAGE_TIMEOUT="USER_MESSAGE_TIMEOUT",e.USER_MESSAGE_BROKEN="USER_MESSAGE_BROKEN",e.USER_MESSAGE_NO_RECEIVER="USER_MESSAGE_NO_RECEIVER",e.USER_MESSAGE_NO_RELAYPATH="USER_MESSAGE_NO_RELAYPATH",e.USER_MESSAGE_EXCEED_QPS="USER_MESSAGE_EXCEED_QPS",e.USER_MESSAGE_SEND_TO_SERVER_ERROR="USER_MESSAGE_SEND_TO_SERVER_ERROR",e.USER_MESSAGE_SERVER_RESPONSE_ERROR="USER_MESSAGE_SERVER_RESPONSE_ERROR",e.USER_MESSAGE_NOT_JOIN="USER_MESSAGE_NOT_JOIN",e.USER_MESSAGE_INIT="USER_MESSAGE_INIT",e.USER_MESSAGE_NO_CONNECTION="USER_MESSAGE_NO_CONNECTION",e.USER_MESSAGE_NOT_LOGIN="USER_MESSAGE_NOT_LOGIN",e.USER_MESSAGE_SERVER_PARAMS_NOTSET="USER_MESSAGE_SERVER_PARAMS_NOTSET",e.USER_MESSAGE_UNKNOWN="USER_MESSAGE_UNKNOWN",e.START_PUBLIC_STREAM_BEFORE_JOIN="START_PUBLIC_STREAM_BEFORE_JOIN",e.RECONNECT_FAILED="RECONNECT_FAILED",e.SUBTITLE_ALREADY_ON="SUBTITLE_ALREADY_ON",e.SUBTITLE_NOT_TURNED_ON="SUBTITLE_NOT_TURNED_ON",e.SUBTITLE_ERR_POSTPROCESS="SUBTITLE_ERR_POSTPROCESS",e.SUBTITLE_ERR_CONNECTION_ERROR="SUBTITLE_ERR_CONNECTION_ERROR",e.SUBTITLE_ERR_PROCESS_ERROR="SUBTITLE_ERR_PROCESS_ERROR",e.SUBTITLE_ERR_UNKNOWN="SUBTITLE_ERR_UNKNOWN",e.UNEXPECTED_INVOKE_FORWARD_STREAM="UNEXPECTED_INVOKE_FORWARD_STREAM",e.ROOM_FORBIDDEN="ROOM_FORBIDDEN",e.USER_FORBIDDEN="USER_FORBIDDEN",e}(ErrorCode||{}),AudioMixingError=function(e){return e[e.AUDIO_MIXING_ERROR_OK=0]="AUDIO_MIXING_ERROR_OK",e[e.AUDIO_MIXING_ERROR_PRELOAD_FAILED=1]="AUDIO_MIXING_ERROR_PRELOAD_FAILED",e[e.AUDIO_MIXING_ERROR_START_FAILED=2]="AUDIO_MIXING_ERROR_START_FAILED",e[e.AUDIO_MIXING_ERROR_ID_NOT_FOUND=3]="AUDIO_MIXING_ERROR_ID_NOT_FOUND",e[e.AUDIO_MIXING_ERROR_SET_POSITION_FAILED=4]="AUDIO_MIXING_ERROR_SET_POSITION_FAILED",e[e.AUDIO_MIXING_ERROR_INVALID_VOLUME=5]="AUDIO_MIXING_ERROR_INVALID_VOLUME",e[e.AUDIO_MIXING_ERROR_LOAD_CONFLICT=6]="AUDIO_MIXING_ERROR_LOAD_CONFLICT",e[e.AUDIO_MIXING_ERROR_ID_TYPE_NOT_MATCH=7]="AUDIO_MIXING_ERROR_ID_TYPE_NOT_MATCH",e[e.AUDIO_MIXING_ERROR_ID_TYPE_INVALID_PITCH=8]="AUDIO_MIXING_ERROR_ID_TYPE_INVALID_PITCH",e[e.AUDIO_MIXING_ERROR_INVALID_AUDIO_TRACK=9]="AUDIO_MIXING_ERROR_INVALID_AUDIO_TRACK",e}(AudioMixingError||{}),VideoSourceType=function(e){return e[e.VIDEO_SOURCE_TYPE_EXTERNAL=0]="VIDEO_SOURCE_TYPE_EXTERNAL",e[e.VIDEO_SOURCE_TYPE_INTERNAL=1]="VIDEO_SOURCE_TYPE_INTERNAL",e}(VideoSourceType||{}),AudioSourceType=function(e){return e[e.AUDIO_SOURCE_TYPE_EXTERNAL=0]="AUDIO_SOURCE_TYPE_EXTERNAL",e[e.AUDIO_SOURCE_TYPE_INTERNAL=1]="AUDIO_SOURCE_TYPE_INTERNAL",e}(AudioSourceType||{}),UserOfflineReason=function(e){return e[e.QUIT=0]="QUIT",e[e.DROPPED=1]="DROPPED",e[e.SWITCH_TO_INVISIBLE=2]="SWITCH_TO_INVISIBLE",e[e.KICKED_BY_ADMIN=3]="KICKED_BY_ADMIN",e}(UserOfflineReason||{}),ChannelProfile=function(e){return e[e.CHANNEL_PROFILE_COMMUNICATION=0]="CHANNEL_PROFILE_COMMUNICATION",e[e.CHANNEL_PROFILE_LIVE_BROADCASTING=1]="CHANNEL_PROFILE_LIVE_BROADCASTING",e}(ChannelProfile||{}),SubscribeMode=function(e){return e[e.AUTO_SUBSCRIBE_MODE=0]="AUTO_SUBSCRIBE_MODE",e[e.MANUAL_SUBSCRIBE_MODE=1]="MANUAL_SUBSCRIBE_MODE",e}(SubscribeMode||{}),SubscribeState=function(e){return e[e.SUBSCRIBE_SUCC=0]="SUBSCRIBE_SUCC",e[e.SUBSCRIBE_FAIL=1]="SUBSCRIBE_FAIL",e}(SubscribeState||{}),PublishState=function(e){return e[e.PUBLISH_SUCC=0]="PUBLISH_SUCC",e[e.PUBLISH_FAIL=1]="PUBLISH_FAIL",e}(PublishState||{}),MirrorMode=function(e){return e[e.MIRROR_MODE_OFF=0]="MIRROR_MODE_OFF",e[e.MIRROR_MODE_ON=1]="MIRROR_MODE_ON",e}(MirrorMode||{}),VideoRenderMode=function(e){return e[e.RENDER_MODE_HIDDEN=0]="RENDER_MODE_HIDDEN",e[e.RENDER_MODE_FIT=1]="RENDER_MODE_FIT",e[e.RENDER_MODE_FILL=2]="RENDER_MODE_FILL",e}(VideoRenderMode||{}),StreamIndex=function(e){return e[e.STREAM_INDEX_MAIN=0]="STREAM_INDEX_MAIN",e[e.STREAM_INDEX_SCREEN=1]="STREAM_INDEX_SCREEN",e}(StreamIndex||{}),MediaType=function(e){return e[e.AUDIO=1]="AUDIO",e[e.VIDEO=2]="VIDEO",e[e.AUDIO_AND_VIDEO=3]="AUDIO_AND_VIDEO",e}(MediaType||{}),StreamRemoveReason=function(e){return e[e.STREAM_REMOVE_REASON_UNPUBLISH=0]="STREAM_REMOVE_REASON_UNPUBLISH",e[e.STREAM_REMOVE_REASON_PUBLISH_FAILED=1]="STREAM_REMOVE_REASON_PUBLISH_FAILED",e[e.STREAM_REMOVE_REASON_KEEP_LIVE_FAILED=2]="STREAM_REMOVE_REASON_KEEP_LIVE_FAILED",e[e.STREAM_REMOVE_REASON_CLIENT_DISCONNECTED=3]="STREAM_REMOVE_REASON_CLIENT_DISCONNECTED",e[e.STREAM_REMOVE_REASON_REPUBLISH=4]="STREAM_REMOVE_REASON_REPUBLISH",e[e.STREAM_REMOVE_REASON_OTHER=5]="STREAM_REMOVE_REASON_OTHER",e}(StreamRemoveReason||{}),ConnectionState=function(e){return e[e.CONNECTION_START=0]="CONNECTION_START",e[e.CONNECTION_STATE_DISCONNECTED=1]="CONNECTION_STATE_DISCONNECTED",e[e.CONNECTION_STATE_CONNECTING=2]="CONNECTION_STATE_CONNECTING",e[e.CONNECTION_STATE_CONNECTED=3]="CONNECTION_STATE_CONNECTED",e[e.CONNECTION_STATE_RECONNECTING=4]="CONNECTION_STATE_RECONNECTING",e[e.CONNECTION_STATE_RECONNECTED=5]="CONNECTION_STATE_RECONNECTED",e[e.CONNECTION_STATE_LOST=6]="CONNECTION_STATE_LOST",e}(ConnectionState||{}),MirrorType=function(e){return e[e.MIRROR_TYPE_NONE=0]="MIRROR_TYPE_NONE",e[e.MIRROR_TYPE_RENDER=1]="MIRROR_TYPE_RENDER",e}(MirrorType||{}),LocalMainReportMode=function(e){return e[e.NORMAL=0]="NORMAL",e[e.DISCONNECT=1]="DISCONNECT",e[e.RESET=2]="RESET",e}(LocalMainReportMode||{}),AudioReportMode=function(e){return e[e.MICROPHONE=0]="MICROPHONE",e[e.AUDIOMIXING=1]="AUDIOMIXING",e}(AudioReportMode||{}),LogChannel=function(e){return e[e.domestic=0]="domestic",e[e.overseas=1]="overseas",e}(LogChannel||{}),USER_ONLINE_STATUS=function(e){return e[e.OFFLINE=0]="OFFLINE",e[e.ONLINE=1]="ONLINE",e[e.UNREACHABLE=2]="UNREACHABLE",e}(USER_ONLINE_STATUS||{}),PublicStreamType=function(e){return e[e.AUDIO_AND_VIDEO=0]="AUDIO_AND_VIDEO",e[e.AUDIO_ONLY=1]="AUDIO_ONLY",e[e.VIDEO_ONLY=2]="VIDEO_ONLY",e}(PublicStreamType||{}),PublicInterpolationMode=function(e){return e[e.PREV_FRAME=0]="PREV_FRAME",e[e.OTHER_FRAME=1]="OTHER_FRAME",e}(PublicInterpolationMode||{}),SubscribeFallbackOption=function(e){return e[e.DISABLE=0]="DISABLE",e[e.VIDEO_STREAM_LOW=1]="VIDEO_STREAM_LOW",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e}(SubscribeFallbackOption||{}),RemoteUserPriority=function(e){return e[e.LOW=0]="LOW",e[e.MEDIUM=100]="MEDIUM",e[e.HIGH=200]="HIGH",e}(RemoteUserPriority||{}),NetworkQuality$1=function(e){return e[e.UNKNOWN=0]="UNKNOWN",e[e.EXCELLENT=1]="EXCELLENT",e[e.GOOD=2]="GOOD",e[e.POOR=3]="POOR",e[e.BAD=4]="BAD",e[e.VBAD=5]="VBAD",e[e.DOWN=6]="DOWN",e}(NetworkQuality$1||{}),FallbackOrRecoverReason=function(e){return e[e.Unknown=-1]="Unknown",e[e.SubscribeFallbackByBandwidth=0]="SubscribeFallbackByBandwidth",e[e.SubscribeRecoverByBandwidth=2]="SubscribeRecoverByBandwidth",e}(FallbackOrRecoverReason||{}),RoomProfileType=function(e){return e[e.communication=0]="communication",e[e.chat=5]="chat",e[e.chatRoom=6]="chatRoom",e[e.coHost=9]="coHost",e[e.meeting=16]="meeting",e[e.classRoom=18]="classRoom",e}(RoomProfileType||{}),AudioProfileType=function(e){return e[e.default=0]="default",e[e.fluent=1]="fluent",e[e.standard=2]="standard",e[e.hd=3]="hd",e[e.standardStereo=4]="standardStereo",e[e.hdMono=5]="hdMono",e}(AudioProfileType||{}),RTCAutoPlayPolicy=function(e){return e[e.AUTO_PLAY=0]="AUTO_PLAY",e[e.VIDEO_ONLY=1]="VIDEO_ONLY",e[e.PLAY_MANUALLY=2]="PLAY_MANUALLY",e}(RTCAutoPlayPolicy||{}),AAC_PROFILE=function(e){return e.LC="LC",e.HEv1="HEv1",e.HEv2="HEv2",e}(AAC_PROFILE||{}),TRANSCODING_VIDEO_CODEC=function(e){return e.H264="H264",e.H265="H265",e}(TRANSCODING_VIDEO_CODEC||{}),SUBTITLE_MODE=function(e){return e[e.ASR_ONLY=0]="ASR_ONLY",e[e.ASR_AND_TRANSLATION=1]="ASR_AND_TRANSLATION",e}(SUBTITLE_MODE||{}),SubtitleEventType=function(e){return e[e.STARTED=0]="STARTED",e[e.STOPPED=1]="STOPPED",e[e.ERROR=2]="ERROR",e}(SubtitleEventType||{}),ForwardStreamState=function(e){return e[e.FORWARD_STREAM_STATE_SUCCESS=0]="FORWARD_STREAM_STATE_SUCCESS",e[e.FORWARD_STREAM_STATE_FAILURE=1]="FORWARD_STREAM_STATE_FAILURE",e}(ForwardStreamState||{}),ForwardStreamError=function(e){return e[e.FORWARD_STREAM_ERROR_OK=0]="FORWARD_STREAM_ERROR_OK",e[e.FORWARD_STREAM_ERROR_INVALID_TOKEN=1202]="FORWARD_STREAM_ERROR_INVALID_TOKEN",e[e.FORWARD_STREAM_ERROR_RESPONSE=1203]="FORWARD_STREAM_ERROR_RESPONSE",e[e.FORWARD_STREAM_ERROR_REMOTE_KICKED=1204]="FORWARD_STREAM_ERROR_REMOTE_KICKED",e[e.FORWARD_STREAM_ERROR_NOT_SUPPORT=1205]="FORWARD_STREAM_ERROR_NOT_SUPPORT",e}(ForwardStreamError||{}),SDKError=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,i){var o;return _classCallCheck(this,r),o=t.call(this,n),__publicField(_assertThisInitialized(o),"code"),__publicField(_assertThisInitialized(o),"message"),__publicField(_assertThisInitialized(o),"error"),o.code=e,o.message=n,o.error=i,Object.setPrototypeOf(_assertThisInitialized(o),r.prototype),o}return _createClass(r,[{key:"toString",value:function(){return"SDKError: ".concat(this.code," ").concat(this.message)}}]),r}(_wrapNativeSuper(Error)),rnds8$1=new Uint8Array(16);function rng$1(){if(!getRandomValues$1&&!(getRandomValues$1="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues$1(rnds8$1)}var REGEX=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function validate(e){return"string"==typeof e&&REGEX.test(e)}for(var byteToHex$1=[],i$1=0;i$1<256;++i$1)byteToHex$1.push((i$1+256).toString(16).substr(1));function stringify$4(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(byteToHex$1[e[t+0]]+byteToHex$1[e[t+1]]+byteToHex$1[e[t+2]]+byteToHex$1[e[t+3]]+"-"+byteToHex$1[e[t+4]]+byteToHex$1[e[t+5]]+"-"+byteToHex$1[e[t+6]]+byteToHex$1[e[t+7]]+"-"+byteToHex$1[e[t+8]]+byteToHex$1[e[t+9]]+"-"+byteToHex$1[e[t+10]]+byteToHex$1[e[t+11]]+byteToHex$1[e[t+12]]+byteToHex$1[e[t+13]]+byteToHex$1[e[t+14]]+byteToHex$1[e[t+15]]).toLowerCase();if(!validate(r))throw TypeError("Stringified UUID is invalid");return r}function v4$1(e,t,r){var n=(e=e||{}).random||(e.rng||rng$1)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return stringify$4(n)}var isSSR$1=function(){return"undefined"==typeof window},genUuid$1=function(){return v4$1()},promiseAny$1=function(e){return new Promise((function(t,r){var n=(e=Array.isArray(e)?e:[]).length,i=[];0===n?r([]):e.forEach((function(e){e.then((function(e){t(e)}),(function(e){n--,i.push(e),0===n&&r(i)}))}))}))},assertValidMsgId=function(e){return"number"==typeof e};function mediaTrackStringify(e){return null==e?"undefined | null":"string"==typeof e?e:JSON.stringify({contentHint:e.contentHint,enabled:e.enabled,id:e.id,kind:e.kind,label:e.label,muted:e.muted,readyState:e.readyState})}function mediaStreamStringify(e){return null==e?"undefined | null":"string"==typeof e?e:JSON.stringify({id:e.id,active:e.active})}function mediaSenderStringify(e){return null==e?"undefined | null":"string"==typeof e?e:JSON.stringify({track:mediaTrackStringify(e.track)})}function mediaReceiverStringify(e){return null==e?"undefined | null":"string"==typeof e?e:JSON.stringify({track:mediaTrackStringify(e.track)})}function mediaTransceiverStringify(e){return null==e?"undefined | null":"string"==typeof e?e:JSON.stringify({currentDirection:e.currentDirection,direction:e.direction,mid:e.mid,stopped:e.stopped,receiver:mediaReceiverStringify(e.receiver),sender:mediaSenderStringify(e.sender)})}var DB_NAME$1="@byted/ve-rtc",STORE_NAME="@byted/ve-rtc",STORE_CACHED_SIZE_KEY="@byted/ve-rtc-cache-size",IDB=function(){function e(){_classCallCheck(this,e),__publicField(this,"storeKey"),__publicField(this,"logLevel"),__publicField(this,"LogfileSize"),__publicField(this,"db"),__publicField(this,"logId"),__publicField(this,"cacheLog"),__publicField(this,"cachedSize"),__publicField(this,"preCacheTime"),__publicField(this,"timer"),__publicField(this,"_getSize",(function(e){return new Blob(e).size/1048576})),this.storeKey="",this.logId=1,this.cacheLog="",this.logLevel="none",this.LogfileSize=100,this._createStore()}return _createClass(e,[{key:"_createStore",value:function(){var e=this;if(!isSSR$1()&&window.indexedDB){var t=indexedDB.open(DB_NAME$1);t.onupgradeneeded=function(){t.result.createObjectStore(STORE_NAME);try{localStorage.removeItem(STORE_CACHED_SIZE_KEY)}catch(e){}},t.onerror=function(e){},t.onsuccess=function(){e.db=t.result,e._getCachedSize()}}}},{key:"_getCachedSize",value:function(){var e=this;try{var t=localStorage.getItem(STORE_CACHED_SIZE_KEY);t?this.cachedSize=Number(t):this.values().then((function(t){e.cachedSize=e._getSize(t),e._setCachedSize()}))}catch(r){}}},{key:"_setCachedSize",value:function(){try{localStorage.setItem(STORE_CACHED_SIZE_KEY,"".concat(this.cachedSize))}catch(e2){}}},{key:"_getStore",value:function(e){if(this.db)return this.db.transaction(STORE_NAME,e).objectStore(STORE_NAME)}},{key:"set",value:function(e){var t=this;return new Promise((function(r,n){if("none"===t.logLevel)return r();if(e&&t.preCacheTime&&t.preCacheTime-Date.now()<1e3)return t.cacheLog+="\n\n".concat(t.logId,": ").concat(e),t.logId++,t.timer||(t.timer=setTimeout((function(){t.set("")}),1e3-(t.preCacheTime-Date.now()))),r();clearTimeout(t.timer),t.timer=null;var i=t._getStore("readwrite");if(!i)return n("get store fail");t.cachedSize&&t.cachedSize>t.LogfileSize&&t.keyEarliest().then((function(e){t.get(e).then((function(r){t.del(e).then((function(){t.cachedSize=t.cachedSize-t._getSize(["".concat(r)]),t._setCachedSize()}))}))}));var o=i.get(t.storeKey);o.onsuccess=function(){try{var a="".concat(o.result||"").concat(t.cacheLog),s=e?"".concat(a?"\n\n":"").concat(t.logId,": ").concat(e):"";i.put("".concat(a).concat(s),t.storeKey),e&&t.logId++,t.cacheLog="",t.cachedSize=(t.cachedSize||0)+t._getSize(["".concat(t.cacheLog).concat(s)]),t._setCachedSize(),t.preCacheTime=Date.now(),r()}catch(c){if(!e)return n(c);t.cacheLog+="\n\n".concat(t.logId,": ").concat(e),t.logId++,n(c)}},o.onerror=function(r){if(!e)return n(r);t.cacheLog+="\n\n".concat(t.logId,": ").concat(e),t.logId++,n(r)}}))}},{key:"get",value:function(e){var t=this;return new Promise((function(r,n){var i=t._getStore("readonly");if(!i)return n();var o=i.get(e);o.onsuccess=function(){r(o.result)},o.onerror=function(e){n(e)}}))}},{key:"del",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.storeKey;return new Promise((function(r,n){var i=e._getStore("readwrite");if(!i)return n();var o=i.delete(t);o.onsuccess=function(){return r(o.result)},o.onerror=function(e){return n(e)}}))}},{key:"keyEarliest",value:function(){return this.keys().then((function(e){var t,r=Date.now();return e.forEach((function(e){if(e&&e.length){var n=e.split("-")[0];Number(n)<r&&(r=Number(n),t=e)}})),t}))}},{key:"keys",value:function(){var e=this;return new Promise((function(t,r){var n=e._getStore("readonly");if(!n)return r();if(n.getAllKeys){var i=n.getAllKeys();return i.onsuccess=function(){t(i.result)},void(i.onerror=function(){r()})}var o=[];n.openCursor().onsuccess=function(){this.result&&(o.push(this.result.key),this.result.continue())},n.transaction.oncomplete=function(){return t(o)}}))}},{key:"values",value:function(){var e=this;return new Promise((function(t,r){var n=e._getStore("readonly");if(!n)return r();if(n.getAll){var i=n.getAll();return i.onsuccess=function(){t(i.result)},void(i.onerror=function(){r()})}var o=[];n.openCursor().onsuccess=function(){this.result&&(o.push(this.result.value),this.result.continue())},n.transaction.oncomplete=function(){return t(o)}}))}},{key:"download",value:function(e){e=e||this.storeKey,this.get(e).then((function(t){var r=document.createElement("a");r.download="".concat(e,".txt"),r.href="data:text/paint;utf-8,".concat(t||""),r.click()}))}}]),e}(),iDB=new IDB,EventEmitter$1=function(){function e(){_classCallCheck(this,e),__publicField(this,"_all",{})}return _createClass(e,[{key:"on",value:function(e,t){var r=this._all[e];r?r.push(t):this._all[e]=[t]}},{key:"once",value:function(e,t){var r=this;this.on(e,(function n(){t.apply(void 0,arguments),r.off(e,n)}))}},{key:"off",value:function(e,t){var r=this._all[e];null==r||r.splice(r.indexOf(t)>>>0,1)}},{key:"emit",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=this._all[e];null==i||i.slice().forEach((function(e){return e.apply(void 0,r)}))}},{key:"safeEmit",value:function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return this.emit.apply(this,[e].concat(r))}catch(i){console.error(i)}}},{key:"destroy",value:function(){this._all={}}}]),e}(),configNumberKeys=["UPLOAD_CONSOLE_LENGTH_CUT","UPLOAD_REPORT_LIMIT"];function needToNumber(e){return configNumberKeys.includes(e)}var Config$2=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),e=t.apply(this,arguments),__publicField(_assertThisInitialized(e),"config",{UPLOAD_CONSOLE_ON:!1,UPLOAD_CONSOLE_LENGTH_CUT:200,UPLOAD_REPORT_LIMIT:45e4,ENABLE_REPORT_IDB_BUFFER:!1}),e}return _createClass(r,[{key:"setParameter",value:function(e,t){if(needToNumber(e))try{var r=Number(t);if(Number.isNaN(r))return;this.config[e]=r}catch(n){return void console.warn("Cannot convert core lib parameter ".concat(e,":").concat(t," into number"))}else this.config[e]=t;this.emit(e,this.config[e])}},{key:"getParameter",value:function(e){return this.config[e]}},{key:"getKeys",value:function(){return Object.keys(this.config)}}]),r}(EventEmitter$1),CoreConfig=new Config$2,common$1={};!function(e){var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=_typeof(n))throw new TypeError(n+"must be non-object");for(var i in n)r(n,i)&&(e[i]=n[i])}}return e},e.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){var t,r,n,i,o,a;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(a=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)o=e[t],a.set(o,i),i+=o.length;return a}},i={arraySet:function(e,t,r,n,i){for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){return[].concat.apply([],e)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,n)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,i))},e.setTyped(t)}(common$1);var deflate$4={},deflate$3={},trees$1={},utils$6$1=common$1,Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(e){for(var t=e.length;--t>=0;)e[t]=0}var STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],DIST_CODE_LEN=512,static_ltree=new Array(2*(L_CODES$1+2));zero$1(static_ltree);var static_dtree=new Array(2*D_CODES$1);zero$1(static_dtree);var _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);var _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);var base_length=new Array(LENGTH_CODES$1);zero$1(base_length);var static_l_desc,static_d_desc,static_bl_desc,base_dist=new Array(D_CODES$1);function StaticTreeDesc(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function TreeDesc(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function d_code(e){return e<256?_dist_code[e]:_dist_code[256+(e>>>7)]}function put_short(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function send_bits(e,t,r){e.bi_valid>Buf_size-r?(e.bi_buf|=t<<e.bi_valid&65535,put_short(e,e.bi_buf),e.bi_buf=t>>Buf_size-e.bi_valid,e.bi_valid+=r-Buf_size):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function send_code(e,t,r){send_bits(e,r[2*t],r[2*t+1])}function bi_reverse(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function bi_flush(e){16===e.bi_valid?(put_short(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function gen_bitlen(e,t){var r,n,i,o,a,s,c=t.dyn_tree,u=t.max_code,l=t.stat_desc.static_tree,d=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,_=t.stat_desc.extra_base,h=t.stat_desc.max_length,f=0;for(o=0;o<=MAX_BITS$1;o++)e.bl_count[o]=0;for(c[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<HEAP_SIZE$1;r++)(o=c[2*c[2*(n=e.heap[r])+1]+1]+1)>h&&(o=h,f++),c[2*n+1]=o,n>u||(e.bl_count[o]++,a=0,n>=_&&(a=p[n-_]),s=c[2*n],e.opt_len+=s*(o+a),d&&(e.static_len+=s*(l[2*n+1]+a)));if(0!==f){do{for(o=h-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[h]--,f-=2}while(f>0);for(o=h;0!==o;o--)for(n=e.bl_count[o];0!==n;)(i=e.heap[--r])>u||(c[2*i+1]!==o&&(e.opt_len+=(o-c[2*i+1])*c[2*i],c[2*i+1]=o),n--)}}function gen_codes(e,t,r){var n,i,o=new Array(MAX_BITS$1+1),a=0;for(n=1;n<=MAX_BITS$1;n++)o[n]=a=a+r[n-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=bi_reverse(o[s]++,s))}}function tr_static_init(){var e,t,r,n,i,o=new Array(MAX_BITS$1+1);for(r=0,n=0;n<LENGTH_CODES$1-1;n++)for(base_length[n]=r,e=0;e<1<<extra_lbits[n];e++)_length_code[r++]=n;for(_length_code[r-1]=n,i=0,n=0;n<16;n++)for(base_dist[n]=i,e=0;e<1<<extra_dbits[n];e++)_dist_code[i++]=n;for(i>>=7;n<D_CODES$1;n++)for(base_dist[n]=i<<7,e=0;e<1<<extra_dbits[n]-7;e++)_dist_code[256+i++]=n;for(t=0;t<=MAX_BITS$1;t++)o[t]=0;for(e=0;e<=143;)static_ltree[2*e+1]=8,e++,o[8]++;for(;e<=255;)static_ltree[2*e+1]=9,e++,o[9]++;for(;e<=279;)static_ltree[2*e+1]=7,e++,o[7]++;for(;e<=287;)static_ltree[2*e+1]=8,e++,o[8]++;for(gen_codes(static_ltree,L_CODES$1+1,o),e=0;e<D_CODES$1;e++)static_dtree[2*e+1]=5,static_dtree[2*e]=bi_reverse(e,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)}function init_block(e){var t;for(t=0;t<L_CODES$1;t++)e.dyn_ltree[2*t]=0;for(t=0;t<D_CODES$1;t++)e.dyn_dtree[2*t]=0;for(t=0;t<BL_CODES$1;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*END_BLOCK]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function bi_windup(e){e.bi_valid>8?put_short(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function copy_block(e,t,r,n){bi_windup(e),n&&(put_short(e,r),put_short(e,~r)),utils$6$1.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}function smaller(e,t,r,n){var i=2*t,o=2*r;return e[i]<e[o]||e[i]===e[o]&&n[t]<=n[r]}function pqdownheap(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&smaller(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!smaller(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function compress_block(e,t,r){var n,i,o,a,s=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],i=e.pending_buf[e.l_buf+s],s++,0===n?send_code(e,i,t):(send_code(e,(o=_length_code[i])+LITERALS$1+1,t),0!==(a=extra_lbits[o])&&send_bits(e,i-=base_length[o],a),send_code(e,o=d_code(--n),r),0!==(a=extra_dbits[o])&&send_bits(e,n-=base_dist[o],a))}while(s<e.last_lit);send_code(e,END_BLOCK,t)}function build_tree(e,t){var r,n,i,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=HEAP_SIZE$1,r=0;r<c;r++)0!==o[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):o[2*r+1]=0;for(;e.heap_len<2;)o[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=a[2*i+1]);for(t.max_code=u,r=e.heap_len>>1;r>=1;r--)pqdownheap(e,o,r);i=c;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pqdownheap(e,o,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,o[2*i]=o[2*r]+o[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,o[2*r+1]=o[2*n+1]=i,e.heap[1]=i++,pqdownheap(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],gen_bitlen(e,t),gen_codes(o,u,e.bl_count)}function scan_tree(e,t,r){var n,i,o=-1,a=t[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=t[2*(n+1)+1],++s<c&&i===a||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[2*REP_3_6]++):s<=10?e.bl_tree[2*REPZ_3_10]++:e.bl_tree[2*REPZ_11_138]++,s=0,o=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4))}function send_tree(e,t,r){var n,i,o=-1,a=t[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),n=0;n<=r;n++)if(i=a,a=t[2*(n+1)+1],!(++s<c&&i===a)){if(s<u)do{send_code(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==o&&(send_code(e,i,e.bl_tree),s--),send_code(e,REP_3_6,e.bl_tree),send_bits(e,s-3,2)):s<=10?(send_code(e,REPZ_3_10,e.bl_tree),send_bits(e,s-3,3)):(send_code(e,REPZ_11_138,e.bl_tree),send_bits(e,s-11,7));s=0,o=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4)}}function build_bl_tree(e){var t;for(scan_tree(e,e.dyn_ltree,e.l_desc.max_code),scan_tree(e,e.dyn_dtree,e.d_desc.max_code),build_tree(e,e.bl_desc),t=BL_CODES$1-1;t>=3&&0===e.bl_tree[2*bl_order[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function send_all_trees(e,t,r,n){var i;for(send_bits(e,t-257,5),send_bits(e,r-1,5),send_bits(e,n-4,4),i=0;i<n;i++)send_bits(e,e.bl_tree[2*bl_order[i]+1],3);send_tree(e,e.dyn_ltree,t-1),send_tree(e,e.dyn_dtree,r-1)}function detect_data_type(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return Z_BINARY;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return Z_TEXT;for(t=32;t<LITERALS$1;t++)if(0!==e.dyn_ltree[2*t])return Z_TEXT;return Z_BINARY}zero$1(base_dist);var static_init_done=!1;function _tr_init(e){static_init_done||(tr_static_init(),static_init_done=!0),e.l_desc=new TreeDesc(e.dyn_ltree,static_l_desc),e.d_desc=new TreeDesc(e.dyn_dtree,static_d_desc),e.bl_desc=new TreeDesc(e.bl_tree,static_bl_desc),e.bi_buf=0,e.bi_valid=0,init_block(e)}function _tr_stored_block(e,t,r,n){send_bits(e,(STORED_BLOCK<<1)+(n?1:0),3),copy_block(e,t,r,!0)}function _tr_align(e){send_bits(e,STATIC_TREES<<1,3),send_code(e,END_BLOCK,static_ltree),bi_flush(e)}function _tr_flush_block(e,t,r,n){var i,o,a=0;e.level>0?(e.strm.data_type===Z_UNKNOWN$1&&(e.strm.data_type=detect_data_type(e)),build_tree(e,e.l_desc),build_tree(e,e.d_desc),a=build_bl_tree(e),i=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=i&&(i=o)):i=o=r+5,r+4<=i&&-1!==t?_tr_stored_block(e,t,r,n):e.strategy===Z_FIXED$1||o===i?(send_bits(e,(STATIC_TREES<<1)+(n?1:0),3),compress_block(e,static_ltree,static_dtree)):(send_bits(e,(DYN_TREES<<1)+(n?1:0),3),send_all_trees(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),compress_block(e,e.dyn_ltree,e.dyn_dtree)),init_block(e),n&&bi_windup(e)}function _tr_tally(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(_length_code[r]+LITERALS$1+1)]++,e.dyn_dtree[2*d_code(t)]++),e.last_lit===e.lit_bufsize-1}function adler32$2(e,t,r,n){for(var i=65535&e|0,o=e>>>16&65535|0,a=0;0!==r;){r-=a=r>2e3?2e3:r;do{o=o+(i=i+t[n++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0}trees$1._tr_init=_tr_init,trees$1._tr_stored_block=_tr_stored_block,trees$1._tr_flush_block=_tr_flush_block,trees$1._tr_tally=_tr_tally,trees$1._tr_align=_tr_align;var adler32_1=adler32$2;function makeTable(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}var crcTable=makeTable();function crc32$2(e,t,r,n){var i=crcTable,o=n+r;e^=-1;for(var a=n;a<o;a++)e=e>>>8^i[255&(e^t[a])];return-1^e}var configuration_table,crc32_1=crc32$2,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},utils$5$1=common$1,trees=trees$1,adler32$1=adler32_1,crc32$1=crc32_1,msg$2=messages,Z_NO_FLUSH$1=0,Z_PARTIAL_FLUSH=1,Z_FULL_FLUSH=3,Z_FINISH$2=4,Z_BLOCK$1=5,Z_OK$2=0,Z_STREAM_END$2=1,Z_STREAM_ERROR$1=-2,Z_DATA_ERROR$1=-3,Z_BUF_ERROR$1=-5,Z_DEFAULT_COMPRESSION$1=-1,Z_FILTERED=1,Z_HUFFMAN_ONLY=2,Z_RLE=3,Z_FIXED=4,Z_DEFAULT_STRATEGY$1=0,Z_UNKNOWN=2,Z_DEFLATED$2=8,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3;function err(e,t){return e.msg=msg$2[t],t}function rank(e){return(e<<1)-(e>4?9:0)}function zero(e){for(var t=e.length;--t>=0;)e[t]=0}function flush_pending(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(utils$5$1.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function flush_block_only(e,t){trees._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,flush_pending(e.strm)}function put_byte(e,t){e.pending_buf[e.pending++]=t}function putShortMSB(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function read_buf(e,t,r,n){var i=e.avail_in;return i>n&&(i=n),0===i?0:(e.avail_in-=i,utils$5$1.arraySet(t,e.input,e.next_in,i,r),1===e.state.wrap?e.adler=adler32$1(e.adler,t,i,r):2===e.state.wrap&&(e.adler=crc32$1(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)}function longest_match(e,t){var r,n,i=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-MIN_LOOKAHEAD?e.strstart-(e.w_size-MIN_LOOKAHEAD):0,u=e.window,l=e.w_mask,d=e.prev,p=e.strstart+MAX_MATCH,_=u[o+a-1],h=u[o+a];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(r=t)+a]===h&&u[r+a-1]===_&&u[r]===u[o]&&u[++r]===u[o+1]){o+=2,r++;do{}while(u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&o<p);if(n=MAX_MATCH-(p-o),o=p-MAX_MATCH,n>a){if(e.match_start=t,a=n,n>=s)break;_=u[o+a-1],h=u[o+a]}}}while((t=d[t&l])>c&&0!=--i);return a<=e.lookahead?a:e.lookahead}function fill_window(e){var t,r,n,i,o,a=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=a+(a-MIN_LOOKAHEAD)){utils$5$1.arraySet(e.window,e.window,a,a,0),e.match_start-=a,e.strstart-=a,e.block_start-=a,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=a?n-a:0}while(--r);t=r=a;do{n=e.prev[--t],e.prev[t]=n>=a?n-a:0}while(--r);i+=a}if(0===e.strm.avail_in)break;if(r=read_buf(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=MIN_MATCH)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+MIN_MATCH-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<MIN_MATCH)););}while(e.lookahead<MIN_LOOKAHEAD&&0!==e.strm.avail_in)}function deflate_stored(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(fill_window(e),0===e.lookahead&&t===Z_NO_FLUSH$1)return BS_NEED_MORE;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE;if(e.strstart-e.block_start>=e.w_size-MIN_LOOKAHEAD&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$2?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):(e.strstart>e.block_start&&(flush_block_only(e,!1),e.strm.avail_out),BS_NEED_MORE)}function deflate_fast(e,t){for(var r,n;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$1)return BS_NEED_MORE;if(0===e.lookahead)break}if(r=0,e.lookahead>=MIN_MATCH&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,r)),e.match_length>=MIN_MATCH)if(n=trees._tr_tally(e,e.strstart-e.match_start,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=MIN_MATCH){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=trees._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,t===Z_FINISH$2?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_slow(e,t){for(var r,n,i;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$1)return BS_NEED_MORE;if(0===e.lookahead)break}if(r=0,e.lookahead>=MIN_MATCH&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=MIN_MATCH-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,r),e.match_length<=5&&(e.strategy===Z_FILTERED||e.match_length===MIN_MATCH&&e.strstart-e.match_start>4096)&&(e.match_length=MIN_MATCH-1)),e.prev_length>=MIN_MATCH&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-MIN_MATCH,n=trees._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-MIN_MATCH),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=MIN_MATCH-1,e.strstart++,n&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}else if(e.match_available){if((n=trees._tr_tally(e,0,e.window[e.strstart-1]))&&flush_block_only(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return BS_NEED_MORE}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=trees._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,t===Z_FINISH$2?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_rle(e,t){for(var r,n,i,o,a=e.window;;){if(e.lookahead<=MAX_MATCH){if(fill_window(e),e.lookahead<=MAX_MATCH&&t===Z_NO_FLUSH$1)return BS_NEED_MORE;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=MIN_MATCH&&e.strstart>0&&(n=a[i=e.strstart-1])===a[++i]&&n===a[++i]&&n===a[++i]){o=e.strstart+MAX_MATCH;do{}while(n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<o);e.match_length=MAX_MATCH-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=MIN_MATCH?(r=trees._tr_tally(e,1,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=trees._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$2?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_huff(e,t){for(var r;;){if(0===e.lookahead&&(fill_window(e),0===e.lookahead)){if(t===Z_NO_FLUSH$1)return BS_NEED_MORE;break}if(e.match_length=0,r=trees._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$2?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function Config$1(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function lm_init(e){e.window_size=2*e.w_size,zero(e.head),e.max_lazy_match=configuration_table[e.level].max_lazy,e.good_match=configuration_table[e.level].good_length,e.nice_match=configuration_table[e.level].nice_length,e.max_chain_length=configuration_table[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=MIN_MATCH-1,e.match_available=0,e.ins_h=0}function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new utils$5$1.Buf16(2*HEAP_SIZE),this.dyn_dtree=new utils$5$1.Buf16(2*(2*D_CODES+1)),this.bl_tree=new utils$5$1.Buf16(2*(2*BL_CODES+1)),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new utils$5$1.Buf16(MAX_BITS+1),this.heap=new utils$5$1.Buf16(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new utils$5$1.Buf16(2*L_CODES+1),zero(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function deflateResetKeep(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=Z_UNKNOWN,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?INIT_STATE:BUSY_STATE,e.adler=2===t.wrap?0:1,t.last_flush=Z_NO_FLUSH$1,trees._tr_init(t),Z_OK$2):err(e,Z_STREAM_ERROR$1)}function deflateReset(e){var t=deflateResetKeep(e);return t===Z_OK$2&&lm_init(e.state),t}function deflateSetHeader(e,t){return e&&e.state?2!==e.state.wrap?Z_STREAM_ERROR$1:(e.state.gzhead=t,Z_OK$2):Z_STREAM_ERROR$1}function deflateInit2(e,t,r,n,i,o){if(!e)return Z_STREAM_ERROR$1;var a=1;if(t===Z_DEFAULT_COMPRESSION$1&&(t=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),i<1||i>MAX_MEM_LEVEL||r!==Z_DEFLATED$2||n<8||n>15||t<0||t>9||o<0||o>Z_FIXED)return err(e,Z_STREAM_ERROR$1);8===n&&(n=9);var s=new DeflateState;return e.state=s,s.strm=e,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+MIN_MATCH-1)/MIN_MATCH),s.window=new utils$5$1.Buf8(2*s.w_size),s.head=new utils$5$1.Buf16(s.hash_size),s.prev=new utils$5$1.Buf16(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new utils$5$1.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=o,s.method=r,deflateReset(e)}function deflateInit(e,t){return deflateInit2(e,t,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1)}function deflate$2(e,t){var r,n,i,o;if(!e||!e.state||t>Z_BLOCK$1||t<0)return e?err(e,Z_STREAM_ERROR$1):Z_STREAM_ERROR$1;if(n=e.state,!e.output||!e.input&&0!==e.avail_in||n.status===FINISH_STATE&&t!==Z_FINISH$2)return err(e,0===e.avail_out?Z_BUF_ERROR$1:Z_STREAM_ERROR$1);if(n.strm=e,r=n.last_flush,n.last_flush=t,n.status===INIT_STATE)if(2===n.wrap)e.adler=0,put_byte(n,31),put_byte(n,139),put_byte(n,8),n.gzhead?(put_byte(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),put_byte(n,255&n.gzhead.time),put_byte(n,n.gzhead.time>>8&255),put_byte(n,n.gzhead.time>>16&255),put_byte(n,n.gzhead.time>>24&255),put_byte(n,9===n.level?2:n.strategy>=Z_HUFFMAN_ONLY||n.level<2?4:0),put_byte(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(put_byte(n,255&n.gzhead.extra.length),put_byte(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=crc32$1(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=EXTRA_STATE):(put_byte(n,0),put_byte(n,0),put_byte(n,0),put_byte(n,0),put_byte(n,0),put_byte(n,9===n.level?2:n.strategy>=Z_HUFFMAN_ONLY||n.level<2?4:0),put_byte(n,OS_CODE),n.status=BUSY_STATE);else{var a=Z_DEFLATED$2+(n.w_bits-8<<4)<<8;a|=(n.strategy>=Z_HUFFMAN_ONLY||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(a|=PRESET_DICT),a+=31-a%31,n.status=BUSY_STATE,putShortMSB(n,a),0!==n.strstart&&(putShortMSB(n,e.adler>>>16),putShortMSB(n,65535&e.adler)),e.adler=1}if(n.status===EXTRA_STATE)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(e.adler=crc32$1(e.adler,n.pending_buf,n.pending-i,i)),flush_pending(e),i=n.pending,n.pending!==n.pending_buf_size));)put_byte(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(e.adler=crc32$1(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=NAME_STATE)}else n.status=NAME_STATE;if(n.status===NAME_STATE)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=crc32$1(e.adler,n.pending_buf,n.pending-i,i)),flush_pending(e),i=n.pending,n.pending===n.pending_buf_size)){o=1;break}o=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,put_byte(n,o)}while(0!==o);n.gzhead.hcrc&&n.pending>i&&(e.adler=crc32$1(e.adler,n.pending_buf,n.pending-i,i)),0===o&&(n.gzindex=0,n.status=COMMENT_STATE)}else n.status=COMMENT_STATE;if(n.status===COMMENT_STATE)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=crc32$1(e.adler,n.pending_buf,n.pending-i,i)),flush_pending(e),i=n.pending,n.pending===n.pending_buf_size)){o=1;break}o=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,put_byte(n,o)}while(0!==o);n.gzhead.hcrc&&n.pending>i&&(e.adler=crc32$1(e.adler,n.pending_buf,n.pending-i,i)),0===o&&(n.status=HCRC_STATE)}else n.status=HCRC_STATE;if(n.status===HCRC_STATE&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&flush_pending(e),n.pending+2<=n.pending_buf_size&&(put_byte(n,255&e.adler),put_byte(n,e.adler>>8&255),e.adler=0,n.status=BUSY_STATE)):n.status=BUSY_STATE),0!==n.pending){if(flush_pending(e),0===e.avail_out)return n.last_flush=-1,Z_OK$2}else if(0===e.avail_in&&rank(t)<=rank(r)&&t!==Z_FINISH$2)return err(e,Z_BUF_ERROR$1);if(n.status===FINISH_STATE&&0!==e.avail_in)return err(e,Z_BUF_ERROR$1);if(0!==e.avail_in||0!==n.lookahead||t!==Z_NO_FLUSH$1&&n.status!==FINISH_STATE){var s=n.strategy===Z_HUFFMAN_ONLY?deflate_huff(n,t):n.strategy===Z_RLE?deflate_rle(n,t):configuration_table[n.level].func(n,t);if(s!==BS_FINISH_STARTED&&s!==BS_FINISH_DONE||(n.status=FINISH_STATE),s===BS_NEED_MORE||s===BS_FINISH_STARTED)return 0===e.avail_out&&(n.last_flush=-1),Z_OK$2;if(s===BS_BLOCK_DONE&&(t===Z_PARTIAL_FLUSH?trees._tr_align(n):t!==Z_BLOCK$1&&(trees._tr_stored_block(n,0,0,!1),t===Z_FULL_FLUSH&&(zero(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),flush_pending(e),0===e.avail_out))return n.last_flush=-1,Z_OK$2}return t!==Z_FINISH$2?Z_OK$2:n.wrap<=0?Z_STREAM_END$2:(2===n.wrap?(put_byte(n,255&e.adler),put_byte(n,e.adler>>8&255),put_byte(n,e.adler>>16&255),put_byte(n,e.adler>>24&255),put_byte(n,255&e.total_in),put_byte(n,e.total_in>>8&255),put_byte(n,e.total_in>>16&255),put_byte(n,e.total_in>>24&255)):(putShortMSB(n,e.adler>>>16),putShortMSB(n,65535&e.adler)),flush_pending(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?Z_OK$2:Z_STREAM_END$2)}function deflateEnd(e){var t;return e&&e.state?(t=e.state.status)!==INIT_STATE&&t!==EXTRA_STATE&&t!==NAME_STATE&&t!==COMMENT_STATE&&t!==HCRC_STATE&&t!==BUSY_STATE&&t!==FINISH_STATE?err(e,Z_STREAM_ERROR$1):(e.state=null,t===BUSY_STATE?err(e,Z_DATA_ERROR$1):Z_OK$2):Z_STREAM_ERROR$1}function deflateSetDictionary(e,t){var r,n,i,o,a,s,c,u,l=t.length;if(!e||!e.state)return Z_STREAM_ERROR$1;if(2===(o=(r=e.state).wrap)||1===o&&r.status!==INIT_STATE||r.lookahead)return Z_STREAM_ERROR$1;for(1===o&&(e.adler=adler32$1(e.adler,t,l,0)),r.wrap=0,l>=r.w_size&&(0===o&&(zero(r.head),r.strstart=0,r.block_start=0,r.insert=0),u=new utils$5$1.Buf8(r.w_size),utils$5$1.arraySet(u,t,l-r.w_size,r.w_size,0),t=u,l=r.w_size),a=e.avail_in,s=e.next_in,c=e.input,e.avail_in=l,e.next_in=0,e.input=t,fill_window(r);r.lookahead>=MIN_MATCH;){n=r.strstart,i=r.lookahead-(MIN_MATCH-1);do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+MIN_MATCH-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--i);r.strstart=n,r.lookahead=MIN_MATCH-1,fill_window(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=MIN_MATCH-1,r.match_available=0,e.next_in=s,e.input=c,e.avail_in=a,r.wrap=o,Z_OK$2}configuration_table=[new Config$1(0,0,0,0,deflate_stored),new Config$1(4,4,8,4,deflate_fast),new Config$1(4,5,16,8,deflate_fast),new Config$1(4,6,32,32,deflate_fast),new Config$1(4,4,16,16,deflate_slow),new Config$1(8,16,32,32,deflate_slow),new Config$1(8,16,128,128,deflate_slow),new Config$1(8,32,128,256,deflate_slow),new Config$1(32,128,258,1024,deflate_slow),new Config$1(32,258,258,4096,deflate_slow)],deflate$3.deflateInit=deflateInit,deflate$3.deflateInit2=deflateInit2,deflate$3.deflateReset=deflateReset,deflate$3.deflateResetKeep=deflateResetKeep,deflate$3.deflateSetHeader=deflateSetHeader,deflate$3.deflate=deflate$2,deflate$3.deflateEnd=deflateEnd,deflate$3.deflateSetDictionary=deflateSetDictionary,deflate$3.deflateInfo="pako deflate (from Nodeca project)";var strings$2={},utils$4$1=common$1,STR_APPLY_OK=!0,STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,[0])}catch(e2){STR_APPLY_OK=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e2){STR_APPLY_UIA_OK=!1}for(var _utf8len=new utils$4$1.Buf8(256),q=0;q<256;q++)_utf8len[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;function buf2binstring(e,t){if(t<65534&&(e.subarray&&STR_APPLY_UIA_OK||!e.subarray&&STR_APPLY_OK))return String.fromCharCode.apply(null,utils$4$1.shrinkBuf(e,t));for(var r="",n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r}function ZStream$2(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}_utf8len[254]=_utf8len[254]=1,strings$2.string2buf=function(e){var t,r,n,i,o,a=e.length,s=0;for(i=0;i<a;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new utils$4$1.Buf8(s),o=0,i=0;o<s;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|63&r):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},strings$2.buf2binstring=function(e){return buf2binstring(e,e.length)},strings$2.binstring2buf=function(e){for(var t=new utils$4$1.Buf8(e.length),r=0,n=t.length;r<n;r++)t[r]=e.charCodeAt(r);return t},strings$2.buf2string=function(e,t){var r,n,i,o,a=t||e.length,s=new Array(2*a);for(n=0,r=0;r<a;)if((i=e[r++])<128)s[n++]=i;else if((o=_utf8len[i])>4)s[n++]=65533,r+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&r<a;)i=i<<6|63&e[r++],o--;o>1?s[n++]=65533:i<65536?s[n++]=i:(i-=65536,s[n++]=55296|i>>10&1023,s[n++]=56320|1023&i)}return buf2binstring(s,n)},strings$2.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+_utf8len[e[r]]>t?r:t};var zstream=ZStream$2,zlib_deflate=deflate$3,utils$3$1=common$1,strings$1=strings$2,msg$1=messages,ZStream$1=zstream,toString$1$1=Object.prototype.toString,Z_NO_FLUSH=0,Z_FINISH$1=4,Z_OK$1=0,Z_STREAM_END$1=1,Z_SYNC_FLUSH=2,Z_DEFAULT_COMPRESSION=-1,Z_DEFAULT_STRATEGY=0,Z_DEFLATED$1=8;function Deflate(e){if(!(this instanceof Deflate))return new Deflate(e);this.options=utils$3$1.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZStream$1,this.strm.avail_out=0;var r=zlib_deflate.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Z_OK$1)throw new Error(msg$1[r]);if(t.header&&zlib_deflate.deflateSetHeader(this.strm,t.header),t.dictionary){var n;if(n="string"==typeof t.dictionary?strings$1.string2buf(t.dictionary):"[object ArrayBuffer]"===toString$1$1.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=zlib_deflate.deflateSetDictionary(this.strm,n))!==Z_OK$1)throw new Error(msg$1[r]);this._dict_set=!0}}function deflate$1(e,t){var r=new Deflate(t);if(r.push(e,!0),r.err)throw r.msg||msg$1[r.err];return r.result}function deflateRaw(e,t){return(t=t||{}).raw=!0,deflate$1(e,t)}function gzip(e,t){return(t=t||{}).gzip=!0,deflate$1(e,t)}Deflate.prototype.push=function(e,t){var r,n,i=this.strm,o=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?Z_FINISH$1:Z_NO_FLUSH,"string"==typeof e?i.input=strings$1.string2buf(e):"[object ArrayBuffer]"===toString$1$1.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new utils$3$1.Buf8(o),i.next_out=0,i.avail_out=o),(r=zlib_deflate.deflate(i,n))!==Z_STREAM_END$1&&r!==Z_OK$1)return this.onEnd(r),this.ended=!0,!1;0!==i.avail_out&&(0!==i.avail_in||n!==Z_FINISH$1&&n!==Z_SYNC_FLUSH)||("string"===this.options.to?this.onData(strings$1.buf2binstring(utils$3$1.shrinkBuf(i.output,i.next_out))):this.onData(utils$3$1.shrinkBuf(i.output,i.next_out)))}while((i.avail_in>0||0===i.avail_out)&&r!==Z_STREAM_END$1);return n===Z_FINISH$1?(r=zlib_deflate.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Z_OK$1):n!==Z_SYNC_FLUSH||(this.onEnd(Z_OK$1),i.avail_out=0,!0)},Deflate.prototype.onData=function(e){this.chunks.push(e)},Deflate.prototype.onEnd=function(e){e===Z_OK$1&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=utils$3$1.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},deflate$4.Deflate=Deflate,deflate$4.deflate=deflate$1,deflate$4.deflateRaw=deflateRaw,deflate$4.gzip=gzip;var inflate$4={},inflate$3={},BAD$1=30,TYPE$1=12,inffast=function(e,t){var r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R,C,k;r=e.state,n=e.next_in,C=e.input,i=n+(e.avail_in-5),o=e.next_out,k=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),c=r.dmax,u=r.wsize,l=r.whave,d=r.wnext,p=r.window,_=r.hold,h=r.bits,f=r.lencode,m=r.distcode,g=(1<<r.lenbits)-1,v=(1<<r.distbits)-1;e:do{h<15&&(_+=C[n++]<<h,h+=8,_+=C[n++]<<h,h+=8),y=f[_&g];t:for(;;){if(_>>>=S=y>>>24,h-=S,0==(S=y>>>16&255))k[o++]=65535&y;else{if(!(16&S)){if(0==(64&S)){y=f[(65535&y)+(_&(1<<S)-1)];continue t}if(32&S){r.mode=TYPE$1;break e}e.msg="invalid literal/length code",r.mode=BAD$1;break e}E=65535&y,(S&=15)&&(h<S&&(_+=C[n++]<<h,h+=8),E+=_&(1<<S)-1,_>>>=S,h-=S),h<15&&(_+=C[n++]<<h,h+=8,_+=C[n++]<<h,h+=8),y=m[_&v];r:for(;;){if(_>>>=S=y>>>24,h-=S,!(16&(S=y>>>16&255))){if(0==(64&S)){y=m[(65535&y)+(_&(1<<S)-1)];continue r}e.msg="invalid distance code",r.mode=BAD$1;break e}if(T=65535&y,h<(S&=15)&&(_+=C[n++]<<h,(h+=8)<S&&(_+=C[n++]<<h,h+=8)),(T+=_&(1<<S)-1)>c){e.msg="invalid distance too far back",r.mode=BAD$1;break e}if(_>>>=S,h-=S,T>(S=o-a)){if((S=T-S)>l&&r.sane){e.msg="invalid distance too far back",r.mode=BAD$1;break e}if(b=0,R=p,0===d){if(b+=u-S,S<E){E-=S;do{k[o++]=p[b++]}while(--S);b=o-T,R=k}}else if(d<S){if(b+=u+d-S,(S-=d)<E){E-=S;do{k[o++]=p[b++]}while(--S);if(b=0,d<E){E-=S=d;do{k[o++]=p[b++]}while(--S);b=o-T,R=k}}}else if(b+=d-S,S<E){E-=S;do{k[o++]=p[b++]}while(--S);b=o-T,R=k}for(;E>2;)k[o++]=R[b++],k[o++]=R[b++],k[o++]=R[b++],E-=3;E&&(k[o++]=R[b++],E>1&&(k[o++]=R[b++]))}else{b=o-T;do{k[o++]=k[b++],k[o++]=k[b++],k[o++]=k[b++],E-=3}while(E>2);E&&(k[o++]=k[b++],E>1&&(k[o++]=k[b++]))}break}}break}}while(n<i&&o<s);n-=E=h>>3,_&=(1<<(h-=E<<3))-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=o<s?s-o+257:257-(o-s),r.hold=_,r.bits=h},utils$2$1=common$1,MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],inftrees=function(e,t,r,n,i,o,a,s){var c,u,l,d,p,_,h,f,m,g=s.bits,v=0,y=0,S=0,E=0,T=0,b=0,R=0,C=0,k=0,I=0,A=null,O=0,M=new utils$2$1.Buf16(MAXBITS+1),P=new utils$2$1.Buf16(MAXBITS+1),w=null,D=0;for(v=0;v<=MAXBITS;v++)M[v]=0;for(y=0;y<n;y++)M[t[r+y]]++;for(T=g,E=MAXBITS;E>=1&&0===M[E];E--);if(T>E&&(T=E),0===E)return i[o++]=20971520,i[o++]=20971520,s.bits=1,0;for(S=1;S<E&&0===M[S];S++);for(T<S&&(T=S),C=1,v=1;v<=MAXBITS;v++)if(C<<=1,(C-=M[v])<0)return-1;if(C>0&&(e===CODES$1||1!==E))return-1;for(P[1]=0,v=1;v<MAXBITS;v++)P[v+1]=P[v]+M[v];for(y=0;y<n;y++)0!==t[r+y]&&(a[P[t[r+y]]++]=y);if(e===CODES$1?(A=w=a,_=19):e===LENS$1?(A=lbase,O-=257,w=lext,D-=257,_=256):(A=dbase,w=dext,_=-1),I=0,y=0,v=S,p=o,b=T,R=0,l=-1,d=(k=1<<T)-1,e===LENS$1&&k>ENOUGH_LENS$1||e===DISTS$1&&k>ENOUGH_DISTS$1)return 1;for(;;){h=v-R,a[y]<_?(f=0,m=a[y]):a[y]>_?(f=w[D+a[y]],m=A[O+a[y]]):(f=96,m=0),c=1<<v-R,S=u=1<<b;do{i[p+(I>>R)+(u-=c)]=h<<24|f<<16|m|0}while(0!==u);for(c=1<<v-1;I&c;)c>>=1;if(0!==c?(I&=c-1,I+=c):I=0,y++,0==--M[v]){if(v===E)break;v=t[r+a[y]]}if(v>T&&(I&d)!==l){for(0===R&&(R=T),p+=S,C=1<<(b=v-R);b+R<E&&!((C-=M[b+R])<=0);)b++,C<<=1;if(k+=1<<b,e===LENS$1&&k>ENOUGH_LENS$1||e===DISTS$1&&k>ENOUGH_DISTS$1)return 1;i[l=I&d]=T<<24|b<<16|p-o|0}}return 0!==I&&(i[p+I]=v-R<<24|64<<16|0),s.bits=T,0},utils$1$1=common$1,adler32=adler32_1,crc32=crc32_1,inflate_fast2=inffast,inflate_table2=inftrees,CODES=0,LENS=1,DISTS=2,Z_FINISH=4,Z_BLOCK=5,Z_TREES=6,Z_OK=0,Z_STREAM_END=1,Z_NEED_DICT=2,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR=-5,Z_DEFLATED=8,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD=30,MEM=31,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS;function zswap32(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new utils$1$1.Buf16(320),this.work=new utils$1$1.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=HEAD,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new utils$1$1.Buf32(ENOUGH_LENS),t.distcode=t.distdyn=new utils$1$1.Buf32(ENOUGH_DISTS),t.sane=1,t.back=-1,Z_OK):Z_STREAM_ERROR}function inflateReset(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(e)):Z_STREAM_ERROR}function inflateReset2(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,inflateReset(e))):Z_STREAM_ERROR}function inflateInit2(e,t){var r,n;return e?(n=new InflateState,e.state=n,n.window=null,(r=inflateReset2(e,t))!==Z_OK&&(e.state=null),r):Z_STREAM_ERROR}function inflateInit(e){return inflateInit2(e,DEF_WBITS)}var lenfix,distfix,virgin=!0;function fixedtables(e){if(virgin){var t;for(lenfix=new utils$1$1.Buf32(512),distfix=new utils$1$1.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(inflate_table2(LENS,e.lens,0,288,lenfix,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;inflate_table2(DISTS,e.lens,0,32,distfix,0,e.work,{bits:5}),virgin=!1}e.lencode=lenfix,e.lenbits=9,e.distcode=distfix,e.distbits=5}function updatewindow(e,t,r,n){var i,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new utils$1$1.Buf8(o.wsize)),n>=o.wsize?(utils$1$1.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((i=o.wsize-o.wnext)>n&&(i=n),utils$1$1.arraySet(o.window,t,r-n,i,o.wnext),(n-=i)?(utils$1$1.arraySet(o.window,t,r-n,n,0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0}function inflate$2(e,t){var r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R,C,k=0,I=new utils$1$1.Buf8(4),A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return Z_STREAM_ERROR;(r=e.state).mode===TYPE&&(r.mode=TYPEDO),a=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,n=e.input,s=e.avail_in,u=r.hold,l=r.bits,d=s,p=c,b=Z_OK;e:for(;;)switch(r.mode){case HEAD:if(0===r.wrap){r.mode=TYPEDO;break}for(;l<16;){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}if(2&r.wrap&&35615===u){r.check=0,I[0]=255&u,I[1]=u>>>8&255,r.check=crc32(r.check,I,2,0),u=0,l=0,r.mode=FLAGS;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",r.mode=BAD;break}if((15&u)!==Z_DEFLATED){e.msg="unknown compression method",r.mode=BAD;break}if(l-=4,T=8+(15&(u>>>=4)),0===r.wbits)r.wbits=T;else if(T>r.wbits){e.msg="invalid window size",r.mode=BAD;break}r.dmax=1<<T,e.adler=r.check=1,r.mode=512&u?DICTID:TYPE,u=0,l=0;break;case FLAGS:for(;l<16;){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}if(r.flags=u,(255&r.flags)!==Z_DEFLATED){e.msg="unknown compression method",r.mode=BAD;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=BAD;break}r.head&&(r.head.text=u>>8&1),512&r.flags&&(I[0]=255&u,I[1]=u>>>8&255,r.check=crc32(r.check,I,2,0)),u=0,l=0,r.mode=TIME;case TIME:for(;l<32;){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}r.head&&(r.head.time=u),512&r.flags&&(I[0]=255&u,I[1]=u>>>8&255,I[2]=u>>>16&255,I[3]=u>>>24&255,r.check=crc32(r.check,I,4,0)),u=0,l=0,r.mode=OS;case OS:for(;l<16;){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}r.head&&(r.head.xflags=255&u,r.head.os=u>>8),512&r.flags&&(I[0]=255&u,I[1]=u>>>8&255,r.check=crc32(r.check,I,2,0)),u=0,l=0,r.mode=EXLEN;case EXLEN:if(1024&r.flags){for(;l<16;){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}r.length=u,r.head&&(r.head.extra_len=u),512&r.flags&&(I[0]=255&u,I[1]=u>>>8&255,r.check=crc32(r.check,I,2,0)),u=0,l=0}else r.head&&(r.head.extra=null);r.mode=EXTRA;case EXTRA:if(1024&r.flags&&((_=r.length)>s&&(_=s),_&&(r.head&&(T=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),utils$1$1.arraySet(r.head.extra,n,o,_,T)),512&r.flags&&(r.check=crc32(r.check,n,_,o)),s-=_,o+=_,r.length-=_),r.length))break e;r.length=0,r.mode=NAME;case NAME:if(2048&r.flags){if(0===s)break e;_=0;do{T=n[o+_++],r.head&&T&&r.length<65536&&(r.head.name+=String.fromCharCode(T))}while(T&&_<s);if(512&r.flags&&(r.check=crc32(r.check,n,_,o)),s-=_,o+=_,T)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=COMMENT;case COMMENT:if(4096&r.flags){if(0===s)break e;_=0;do{T=n[o+_++],r.head&&T&&r.length<65536&&(r.head.comment+=String.fromCharCode(T))}while(T&&_<s);if(512&r.flags&&(r.check=crc32(r.check,n,_,o)),s-=_,o+=_,T)break e}else r.head&&(r.head.comment=null);r.mode=HCRC;case HCRC:if(512&r.flags){for(;l<16;){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}if(u!==(65535&r.check)){e.msg="header crc mismatch",r.mode=BAD;break}u=0,l=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=TYPE;break;case DICTID:for(;l<32;){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}e.adler=r.check=zswap32(u),u=0,l=0,r.mode=DICT;case DICT:if(0===r.havedict)return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=u,r.bits=l,Z_NEED_DICT;e.adler=r.check=1,r.mode=TYPE;case TYPE:if(t===Z_BLOCK||t===Z_TREES)break e;case TYPEDO:if(r.last){u>>>=7&l,l-=7&l,r.mode=CHECK;break}for(;l<3;){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}switch(r.last=1&u,l-=1,3&(u>>>=1)){case 0:r.mode=STORED;break;case 1:if(fixedtables(r),r.mode=LEN_,t===Z_TREES){u>>>=2,l-=2;break e}break;case 2:r.mode=TABLE;break;case 3:e.msg="invalid block type",r.mode=BAD}u>>>=2,l-=2;break;case STORED:for(u>>>=7&l,l-=7&l;l<32;){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",r.mode=BAD;break}if(r.length=65535&u,u=0,l=0,r.mode=COPY_,t===Z_TREES)break e;case COPY_:r.mode=COPY;case COPY:if(_=r.length){if(_>s&&(_=s),_>c&&(_=c),0===_)break e;utils$1$1.arraySet(i,n,o,_,a),s-=_,o+=_,c-=_,a+=_,r.length-=_;break}r.mode=TYPE;break;case TABLE:for(;l<14;){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}if(r.nlen=257+(31&u),u>>>=5,l-=5,r.ndist=1+(31&u),u>>>=5,l-=5,r.ncode=4+(15&u),u>>>=4,l-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=BAD;break}r.have=0,r.mode=LENLENS;case LENLENS:for(;r.have<r.ncode;){for(;l<3;){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}r.lens[A[r.have++]]=7&u,u>>>=3,l-=3}for(;r.have<19;)r.lens[A[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,R={bits:r.lenbits},b=inflate_table2(CODES,r.lens,0,19,r.lencode,0,r.work,R),r.lenbits=R.bits,b){e.msg="invalid code lengths set",r.mode=BAD;break}r.have=0,r.mode=CODELENS;case CODELENS:for(;r.have<r.nlen+r.ndist;){for(;g=(k=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,v=65535&k,!((m=k>>>24)<=l);){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}if(v<16)u>>>=m,l-=m,r.lens[r.have++]=v;else{if(16===v){for(C=m+2;l<C;){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}if(u>>>=m,l-=m,0===r.have){e.msg="invalid bit length repeat",r.mode=BAD;break}T=r.lens[r.have-1],_=3+(3&u),u>>>=2,l-=2}else if(17===v){for(C=m+3;l<C;){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}l-=m,T=0,_=3+(7&(u>>>=m)),u>>>=3,l-=3}else{for(C=m+7;l<C;){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}l-=m,T=0,_=11+(127&(u>>>=m)),u>>>=7,l-=7}if(r.have+_>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=BAD;break}for(;_--;)r.lens[r.have++]=T}}if(r.mode===BAD)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=BAD;break}if(r.lenbits=9,R={bits:r.lenbits},b=inflate_table2(LENS,r.lens,0,r.nlen,r.lencode,0,r.work,R),r.lenbits=R.bits,b){e.msg="invalid literal/lengths set",r.mode=BAD;break}if(r.distbits=6,r.distcode=r.distdyn,R={bits:r.distbits},b=inflate_table2(DISTS,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,R),r.distbits=R.bits,b){e.msg="invalid distances set",r.mode=BAD;break}if(r.mode=LEN_,t===Z_TREES)break e;case LEN_:r.mode=LEN;case LEN:if(s>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=u,r.bits=l,inflate_fast2(e,p),a=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,n=e.input,s=e.avail_in,u=r.hold,l=r.bits,r.mode===TYPE&&(r.back=-1);break}for(r.back=0;g=(k=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,v=65535&k,!((m=k>>>24)<=l);){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}if(g&&0==(240&g)){for(y=m,S=g,E=v;g=(k=r.lencode[E+((u&(1<<y+S)-1)>>y)])>>>16&255,v=65535&k,!(y+(m=k>>>24)<=l);){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}u>>>=y,l-=y,r.back+=y}if(u>>>=m,l-=m,r.back+=m,r.length=v,0===g){r.mode=LIT;break}if(32&g){r.back=-1,r.mode=TYPE;break}if(64&g){e.msg="invalid literal/length code",r.mode=BAD;break}r.extra=15&g,r.mode=LENEXT;case LENEXT:if(r.extra){for(C=r.extra;l<C;){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=DIST;case DIST:for(;g=(k=r.distcode[u&(1<<r.distbits)-1])>>>16&255,v=65535&k,!((m=k>>>24)<=l);){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}if(0==(240&g)){for(y=m,S=g,E=v;g=(k=r.distcode[E+((u&(1<<y+S)-1)>>y)])>>>16&255,v=65535&k,!(y+(m=k>>>24)<=l);){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}u>>>=y,l-=y,r.back+=y}if(u>>>=m,l-=m,r.back+=m,64&g){e.msg="invalid distance code",r.mode=BAD;break}r.offset=v,r.extra=15&g,r.mode=DISTEXT;case DISTEXT:if(r.extra){for(C=r.extra;l<C;){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=BAD;break}r.mode=MATCH;case MATCH:if(0===c)break e;if(_=p-c,r.offset>_){if((_=r.offset-_)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=BAD;break}_>r.wnext?(_-=r.wnext,h=r.wsize-_):h=r.wnext-_,_>r.length&&(_=r.length),f=r.window}else f=i,h=a-r.offset,_=r.length;_>c&&(_=c),c-=_,r.length-=_;do{i[a++]=f[h++]}while(--_);0===r.length&&(r.mode=LEN);break;case LIT:if(0===c)break e;i[a++]=r.length,c--,r.mode=LEN;break;case CHECK:if(r.wrap){for(;l<32;){if(0===s)break e;s--,u|=n[o++]<<l,l+=8}if(p-=c,e.total_out+=p,r.total+=p,p&&(e.adler=r.check=r.flags?crc32(r.check,i,p,a-p):adler32(r.check,i,p,a-p)),p=c,(r.flags?u:zswap32(u))!==r.check){e.msg="incorrect data check",r.mode=BAD;break}u=0,l=0}r.mode=LENGTH;case LENGTH:if(r.wrap&&r.flags){for(;l<32;){if(0===s)break e;s--,u+=n[o++]<<l,l+=8}if(u!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=BAD;break}u=0,l=0}r.mode=DONE;case DONE:b=Z_STREAM_END;break e;case BAD:b=Z_DATA_ERROR;break e;case MEM:return Z_MEM_ERROR;default:return Z_STREAM_ERROR}return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=u,r.bits=l,(r.wsize||p!==e.avail_out&&r.mode<BAD&&(r.mode<CHECK||t!==Z_FINISH))&&updatewindow(e,e.output,e.next_out,p-e.avail_out),d-=e.avail_in,p-=e.avail_out,e.total_in+=d,e.total_out+=p,r.total+=p,r.wrap&&p&&(e.adler=r.check=r.flags?crc32(r.check,i,p,e.next_out-p):adler32(r.check,i,p,e.next_out-p)),e.data_type=r.bits+(r.last?64:0)+(r.mode===TYPE?128:0)+(r.mode===LEN_||r.mode===COPY_?256:0),(0===d&&0===p||t===Z_FINISH)&&b===Z_OK&&(b=Z_BUF_ERROR),b}function inflateEnd(e){if(!e||!e.state)return Z_STREAM_ERROR;var t=e.state;return t.window&&(t.window=null),e.state=null,Z_OK}function inflateGetHeader(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?Z_STREAM_ERROR:(r.head=t,t.done=!1,Z_OK):Z_STREAM_ERROR}function inflateSetDictionary(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&r.mode!==DICT?Z_STREAM_ERROR:r.mode===DICT&&adler32(1,t,n,0)!==r.check?Z_DATA_ERROR:updatewindow(e,t,n,n)?(r.mode=MEM,Z_MEM_ERROR):(r.havedict=1,Z_OK):Z_STREAM_ERROR}inflate$3.inflateReset=inflateReset,inflate$3.inflateReset2=inflateReset2,inflate$3.inflateResetKeep=inflateResetKeep,inflate$3.inflateInit=inflateInit,inflate$3.inflateInit2=inflateInit2,inflate$3.inflate=inflate$2,inflate$3.inflateEnd=inflateEnd,inflate$3.inflateGetHeader=inflateGetHeader,inflate$3.inflateSetDictionary=inflateSetDictionary,inflate$3.inflateInfo="pako inflate (from Nodeca project)";var constants$1={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};function GZheader$1(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader$1,zlib_inflate=inflate$3,utils$h=common$1,strings=strings$2,c$1=constants$1,msg=messages,ZStream=zstream,GZheader=gzheader,toString$2=Object.prototype.toString;function Inflate(e){if(!(this instanceof Inflate))return new Inflate(e);this.options=utils$h.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZStream,this.strm.avail_out=0;var r=zlib_inflate.inflateInit2(this.strm,t.windowBits);if(r!==c$1.Z_OK)throw new Error(msg[r]);if(this.header=new GZheader,zlib_inflate.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=strings.string2buf(t.dictionary):"[object ArrayBuffer]"===toString$2.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=zlib_inflate.inflateSetDictionary(this.strm,t.dictionary))!==c$1.Z_OK))throw new Error(msg[r])}function inflate$1(e,t){var r=new Inflate(t);if(r.push(e,!0),r.err)throw r.msg||msg[r.err];return r.result}function inflateRaw(e,t){return(t=t||{}).raw=!0,inflate$1(e,t)}Inflate.prototype.push=function(e,t){var r,n,i,o,a,s=this.strm,c=this.options.chunkSize,u=this.options.dictionary,l=!1;if(this.ended)return!1;n=t===~~t?t:!0===t?c$1.Z_FINISH:c$1.Z_NO_FLUSH,"string"==typeof e?s.input=strings.binstring2buf(e):"[object ArrayBuffer]"===toString$2.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new utils$h.Buf8(c),s.next_out=0,s.avail_out=c),(r=zlib_inflate.inflate(s,c$1.Z_NO_FLUSH))===c$1.Z_NEED_DICT&&u&&(r=zlib_inflate.inflateSetDictionary(this.strm,u)),r===c$1.Z_BUF_ERROR&&!0===l&&(r=c$1.Z_OK,l=!1),r!==c$1.Z_STREAM_END&&r!==c$1.Z_OK)return this.onEnd(r),this.ended=!0,!1;s.next_out&&(0!==s.avail_out&&r!==c$1.Z_STREAM_END&&(0!==s.avail_in||n!==c$1.Z_FINISH&&n!==c$1.Z_SYNC_FLUSH)||("string"===this.options.to?(i=strings.utf8border(s.output,s.next_out),o=s.next_out-i,a=strings.buf2string(s.output,i),s.next_out=o,s.avail_out=c-o,o&&utils$h.arraySet(s.output,s.output,i,o,0),this.onData(a)):this.onData(utils$h.shrinkBuf(s.output,s.next_out)))),0===s.avail_in&&0===s.avail_out&&(l=!0)}while((s.avail_in>0||0===s.avail_out)&&r!==c$1.Z_STREAM_END);return r===c$1.Z_STREAM_END&&(n=c$1.Z_FINISH),n===c$1.Z_FINISH?(r=zlib_inflate.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===c$1.Z_OK):n!==c$1.Z_SYNC_FLUSH||(this.onEnd(c$1.Z_OK),s.avail_out=0,!0)},Inflate.prototype.onData=function(e){this.chunks.push(e)},Inflate.prototype.onEnd=function(e){e===c$1.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=utils$h.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},inflate$4.Inflate=Inflate,inflate$4.inflate=inflate$1,inflate$4.inflateRaw=inflateRaw,inflate$4.ungzip=inflate$1;var assign$1=common$1.assign,deflate=deflate$4,inflate=inflate$4,constants=constants$1,pako={};assign$1(pako,deflate,inflate,constants);var pako_1=pako,pako$1=getDefaultExportFromCjs(pako_1),lockId$1=1,PromiseLock$1=function(){function e(t){_classCallCheck(this,e),__publicField(this,"lockingPromise",Promise.resolve()),__publicField(this,"locks",0),__publicField(this,"name",""),__publicField(this,"lockId"),this.lockId=lockId$1++,t&&(this.name=t)}return _createClass(e,[{key:"isLocked",get:function(){return this.locks>0}},{key:"lock",value:function(){var e,t=this;this.locks+=1;var r=new Promise((function(r){e=function(){t.locks-=1,r()}})),n=this.lockingPromise.then((function(){return e}));return this.lockingPromise=this.lockingPromise.then((function(){return r})),n}}]),e}(),DB_NAME="VERTC",indexedDB$1=function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},_IndexedDBInterface=function(){function e(t){_classCallCheck(this,e),__publicField(this,"storeName"),__publicField(this,"pendingList",[]),this.storeName=t,!isSSR$1()&&indexedDB$1()&&this._checkAndCreateStore(t)}var t,r,n,i,o,a,s;return _createClass(e,[{key:"_checkAndCreateStore",value:(s=_asyncToGenerator(_regeneratorRuntime().mark((function t(r,n){var i,o,a=this;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._promiseLock.lock();case 2:if(i=t.sent,!indexedDB$1.databases){t.next=6;break}return t.next=6,new Promise((function(e){var t=function(){return indexedDB$1.databases().finally(e)};o=setInterval(t,100),t()})).finally((function(){return clearInterval(o)}));case 6:return t.abrupt("return",new Promise((function(t){e.db&&(e.db.close(),delete e.db);var o=n?indexedDB$1().open(DB_NAME,n):indexedDB$1().open(DB_NAME);o.onupgradeneeded=function(){o.result.createObjectStore(r)},o.onerror=function(){console.error("IndexedDBInterface error",o.error)},o.onsuccess=function(){var n=o.result;e.db=n;try{e.db.transaction(a.storeName,"readonly"),a.pendingList.forEach(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.txMode,n=t.pendResolve,i=t.pendReject,e.prev=1,e.t0=n,e.next=5,a._getStore(r);case 5:e.t1=e.sent,(0,e.t0)(e.t1),e.next=12;break;case 9:e.prev=9,e.t2=e.catch(1),i();case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()),t()}catch(s){t(a._checkAndCreateStore(r,n.version+1))}finally{i()}}})));case 7:case"end":return t.stop()}}),t)}))),function(e,t){return s.apply(this,arguments)})},{key:"_getStore",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function t(r){var n,i=this;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._promiseLock.lock();case 2:return n=t.sent,t.abrupt("return",new Promise((function(t,o){if(!e.db)return i.pendingList.push({txMode:r,pendResolve:t,pendReject:o}),void n();try{t(e.db.transaction(i.storeName,r).objectStore(i.storeName))}catch(a){return void i.pendingList.push({txMode:r,pendResolve:t,pendReject:o})}finally{n()}})));case 4:case"end":return t.stop()}}),t)}))),function(e){return a.apply(this,arguments)})},{key:"put2String",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{n=JSON.stringify(t)}catch(i){n=t}return e.next=3,this.put(n,r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"get4String",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:r=e.sent;try{n=JSON.parse(r)}catch(i){n=r}return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"put",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getStore("readwrite");case 2:return n=e.sent,e.abrupt("return",new Promise((function(e,i){var o=n.put(t,r);o.onsuccess=function(){e()},o.onerror=function(e){i(e)}})));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"get",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getStore("readonly");case 2:return r=e.sent,e.abrupt("return",new Promise((function(e,n){var i=r.get(t);i.onsuccess=function(){e(i.result)},i.onerror=function(e){n(e)}})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"del",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getStore("readwrite");case 2:return r=e.sent,e.abrupt("return",new Promise((function(e,n){var i=r.delete(t);i.onsuccess=function(){e()},i.onerror=function(e){n(e)}})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();__publicField(_IndexedDBInterface,"db"),__publicField(_IndexedDBInterface,"state","init"),__publicField(_IndexedDBInterface,"_promiseLock",new PromiseLock$1("iDB"));var IndexedDBInterface=_IndexedDBInterface;function isOutBufferItem(e){return void 0!==e.report_id}var LongStringReportor=function(){function e(){_classCallCheck(this,e),__publicField(this,"name","LongStringReportor"),__publicField(this,"inBuffer",[]),__publicField(this,"outBuffer",[])}return _createClass(e,[{key:"push",value:function(e){e.message&&this.inBuffer.push(_objectSpread2(_objectSpread2({},e),{},{message:{id:genUuid$1().slice(0,3),index:0,end:!0,msg:e.message}}))}},{key:"splice",value:function(e){for(var t=[],r=0;this.outBuffer.length;){var n=JSON.stringify(this.outBuffer[0]).length;if(!(n<e))break;e-=n,r+=n,t.push(this.outBuffer.shift())}for(;this.inBuffer[0]&&e>0;){var i=this.inBuffer[0],o=i.message,a=_objectSpread2(_objectSpread2({},_objectWithoutProperties(i,_excluded$2)),{},{message:_objectSpread2(_objectSpread2({},o),{},{msg:""})}),s=JSON.stringify(a).length,c=e-s,u=_objectSpread2({},a);if(c>o.msg.length)u.message.msg=o.msg,this.inBuffer.shift();else{if(!(c>=10))break;var l=o.msg.slice(0,c);u.message.msg=l,u.message.end=!1,this.inBuffer[0].message.msg=o.msg.slice(c),this.inBuffer[0].message.index++}var d=JSON.stringify(u.message),p=d.length;e-=p+s,r+=p+s,t.push(_objectSpread2(_objectSpread2({},u),{},{message:d}))}return{payload:t,payloadSize:r}}},{key:"unshift",value:function(e){this.outBuffer=e.concat(this.outBuffer)}},{key:"get",value:function(){return[].concat(_toConsumableArray(this.outBuffer),_toConsumableArray(this.inBuffer.map((function(e){return _objectSpread2(_objectSpread2({},e),{},{message:JSON.stringify(e.message)})}))))}},{key:"set",value:function(e){var t=this;e.forEach((function(e){isOutBufferItem(e)?t.outBuffer.push(e):(e.message||(e.message=""),t.inBuffer.push(_objectSpread2(_objectSpread2({},e),{},{message:JSON.parse(e.message)})))})),this.outBuffer=[].concat(this.outBuffer),this.inBuffer=[].concat(this.inBuffer)}},{key:"isEmpty",value:function(){return 0===this.inBuffer.length&&0===this.outBuffer.length}}]),e}(),longStringReportor=new LongStringReportor,defaultCommonStats={product_line:"rtc",report_version:"5",os:"web",user_agent:isSSR$1()?"":null==navigator?void 0:navigator.userAgent,platform:"web",product:"webrtc",app_state:"active"},DEBUG$1="undefined"!=typeof window&&(window.location.search.includes("_rtc_debug_")||(null==(_m=window.localStorage)?void 0:_m.getItem("_rtc_debug_"))),ReportorDBBuffer=function(){function e(t){_classCallCheck(this,e),__publicField(this,"_buffer"),this._buffer=new IndexedDBInterface(t)}var t,r;return _createClass(e,[{key:"set",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._buffer.put2String(t,r);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"get",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],e.prev=1,e.next=4,this._buffer.get4String(t);case 4:n=e.sent,e.next=9;break;case 7:e.prev=7,e.t0=e.catch(1);case 9:return e.abrupt("return",null!==(r=n)&&void 0!==r?r:[]);case 10:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return t.apply(this,arguments)})}]),e}(),Reportor=function(){function e(){var t=this;_classCallCheck(this,e),__publicField(this,"reportCommon",defaultCommonStats),__publicField(this,"reportIds",new Map),__publicField(this,"dataBuffer",[]),__publicField(this,"reportorList",[]),__publicField(this,"dbBuffer"),__publicField(this,"posting",!1),__publicField(this,"sucSendTimer"),__publicField(this,"preSucTime",0),__publicField(this,"errSendTimer"),__publicField(this,"errSendDelay",100),__publicField(this,"_logServerUrl"),__publicField(this,"_retryCount",0),__publicField(this,"_reportLimit",5e5),__publicField(this,"_disableTimeout",!1),isSSR$1()||(window.addEventListener("beforeunload",(function(){clearTimeout(t.errSendTimer),clearTimeout(t.sucSendTimer),t.send(void 0,!0)})),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState?t.setCommonStats({app_state:"active"}):"hidden"===document.visibilityState&&t.setCommonStats({app_state:"background"})})),DEBUG$1&&(window.__rtc_debug_reportor__=this)),CoreConfig.on("UPLOAD_REPORT_LIMIT",(function(e){t.setReportLimit(e)})),CoreConfig.on("ENABLE_REPORT_IDB_BUFFER",(function(e){e&&t.enableIndexedDBBuffer()})),setTimeout((function(){t.reportorList.push(consoleReportor),t.reportorList.push(longStringReportor)}))}var t;return _createClass(e,[{key:"setUrl",value:function(e){this._logServerUrl=e}},{key:"setCommonStats",value:function(e){this.reportCommon=Object.assign(this.reportCommon,e)}},{key:"getCommonStats",value:function(){return this.reportCommon}},{key:"setReportLimit",value:function(e){this._reportLimit=Math.max(e,5e4),this._reportLimit=Math.min(e,5e5)}},{key:"getReportId",value:function(e){var t;e=null!==(t=e)&&void 0!==t?t:"__global__",this.reportIds.has(e)||this.reportIds.set(e,0);var r=this.reportIds.get(e);return void 0===r&&(reportGlobalError("no reportId in reportId map with engine-session-id ".concat(e),0,{}),r=0),this.reportIds.set(e,r+1),r}},{key:"push",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t)this.send(e);else{var r,n=null!==(r=e.engine_session_id)&&void 0!==r?r:"__global__";this.reportIds.has(n)||this.reportIds.set(n,0),this.dataBuffer.push(e),!this.posting&&!this.errSendTimer&&Date.now()-this.preSucTime>2e3&&(clearTimeout(this.sucSendTimer),this.send())}}},{key:"enableIndexedDBBuffer",value:function(){var e=this;this.dbBuffer||(this.dbBuffer=new ReportorDBBuffer("ReportorDBBuffer"),this.dbBuffer.get("LogReportor").then((function(t){t.forEach((function(t){e.push(t)}))})),this.reportorList.forEach((function(t){var r;null==(r=e.dbBuffer)||r.get(t.name).then((function(e){t.set(e)}))})))}},{key:"backup",value:function(){var e,t=this;try{null==(e=this.dbBuffer)||e.set(_toConsumableArray(this.dataBuffer),"LogReportor"),this.reportorList.forEach((function(e){var r;null==(r=t.dbBuffer)||r.set(_toConsumableArray(e.get()),e.name)}))}catch(r){reportGlobalError("Error when save log into IDB",-1,r)}}},{key:"unshift",value:function(e){this.dataBuffer=e[0].concat(this.dataBuffer),this.reportorList.forEach((function(t,r){var n;t.unshift(null!==(n=e[r+1])&&void 0!==n?n:[])}))}},{key:"_splice",value:function(){var e=this,t=findSizeIndex$1(this.dataBuffer,this._reportLimit);0===t&&this.dataBuffer.length>0&&(this._reportLimit=JSON.stringify(this.dataBuffer[0]).length+10,t=1,reportGlobalError("update report limit to ".concat(this._reportLimit),0,null));var r=this.dataBuffer.splice(0,t),n=JSON.stringify(r).length,i=[r],o=this._reportLimit-n;return this.reportorList.forEach((function(t){var r=t.splice(o),n=r.payload,a=r.payloadSize;n.forEach((function(t){var r,n;void 0===t.report_id&&(t.report_id=e.getReportId(t.engine_session_id),!isSSR$1()&&window.__onRTCReport&&(null==(n=window.__onRTCReport)||n.call(window,null!==(r=t.engine_session_id)&&void 0!==r?r:"global",t,e.getCommonStats())))})),i.push(n),o-=a})),i}},{key:"send",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l,d;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.backup(),n=this.reportorList.reduce((function(e,t){return e&&t.isEmpty()}),!0),(t||this.dataBuffer.length||!n)&&this._logServerUrl){e.next=4;break}return e.abrupt("return");case 4:if(t||(this.posting=!0),i=[],t||(i=this._splice()),o=DEBUG$1,a={data:t||i.flat(),header:_objectSpread2(_objectSpread2({},this.reportCommon),{},{http_retry_count:this._retryCount}),from:"web",os:"web",version:"1"},s={method:"POST",body:o?JSON.stringify(a):pako$1.gzip(JSON.stringify(a))},!this._disableTimeout)try{c=new AbortController,s.signal=c.signal,setTimeout((function(){c.abort()}),1e4)}catch(p){console.warn("AbortController is not supported"),this._disableTimeout=!0}return o||(s.headers={"Content-Encoding":"gzip","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}),d=null,e.prev=11,e.next=14,fetch(this._logServerUrl,s);case 14:if(u=e.sent,e.t0=200!==u.status&&304!==u.status,e.t0){e.next=22;break}return e.t1=JSON,e.next=20,u.text();case 20:e.t2=e.sent,d=e.t1.parse.call(e.t1,e.t2);case 22:e.next=27;break;case 24:e.prev=24,e.t3=e.catch(11),l=e.t3;case 27:t||(this.posting=!1),d&&0===d.StatusCode?t||r||this.sucSend():(setTimeout((function(){var e;reportGlobalError("reportor post error, resJSON:".concat(null==d?void 0:d.toString()," err:").concat(l),null!==(e=null==u?void 0:u.status)&&void 0!==e?e:-1,l)}),0),t?this.send(t):(this.unshift(i),r?this.send():this.errSend()));case 28:case"end":return e.stop()}}),e,this,[[11,24]])}))),function(e,r){return t.apply(this,arguments)})},{key:"sucSend",value:function(){this.errSendDelay=100,this._retryCount=0,this.preSucTime=Date.now(),this.sucSendTimer=window.setTimeout(this.send.bind(this),2e3)}},{key:"errSend",value:function(){var e=this;this.errSendTimer=window.setTimeout((function(){e.send(),delete e.errSendTimer}),this.errSendDelay),this.errSendDelay*=2,this._retryCount++}}]),e}();function findSizeIndex$1(e,t){for(var r=0,n=0;n<e.length;n++)if((r+=JSON.stringify(e[n]).length)>t)return n;return e.length}var commonReportor=new Reportor,Monitor=function(){function e(t){_classCallCheck(this,e),__publicField(this,"modifyIds",{}),this.id=t}return _createClass(e,[{key:"report",value:function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=_objectSpread2(_objectSpread2(_objectSpread2({event_key:e,rtc_timestamp:Date.now()},this.modifyIds),t),{},{common_extra_info:JSON.stringify(n),report_id:commonReportor.getReportId(this.modifyIds.engine_session_id)});!isSSR$1()&&window.__onRTCReport&&(null==(r=window.__onRTCReport)||r.call(window,this.modifyIds.engine_session_id,i,commonReportor.getCommonStats())),commonReportor.push(i)}},{key:"reportLog",value:function(e){var t=_objectSpread2(_objectSpread2({event_key:"rtc_invoke_status",sdk_api_name:"console_log",rtc_timestamp:Date.now()},this.modifyIds),{},{message:e});consoleReportor.push(t)}},{key:"reportLongString",value:function(e,t){var r=_objectSpread2(_objectSpread2({event_key:"rtc_invoke_status",sdk_api_name:"sdk_long_string_".concat(e),rtc_timestamp:Date.now()},this.modifyIds),{},{message:t});longStringReportor.push(r)}},{key:"set",value:function(e){this.modifyIds=Object.assign(this.modifyIds,e)}},{key:"destroy",value:function(){}}]),e}(),logger$c;setTimeout((function(){logger$c=new Logger$1$1("MessageReportor",1)}),0);var _MessageReportor=function(){function e(t){_classCallCheck(this,e),__publicField(this,"_preTime",Date.now()),__publicField(this,"_one2oneNum",0),__publicField(this,"_one2manyNum",0),__publicField(this,"_one2oneMsgCache",new Map),__publicField(this,"_one2manyMsgCache",new Map),__publicField(this,"roomId",""),__publicField(this,"userId",""),__publicField(this,"rtsSessionId",""),this.id=t}return _createClass(e,[{key:"needReport",value:function(t){return!!e.config&&(Date.now()-this._preTime>=36e5&&(this._preTime=Date.now(),this._one2oneNum=0,this._one2manyNum=0),"one2one"===t&&this._one2oneNum<e.config.max_one2one_fpt_per_hour&&Math.random()<=e.config.one2one_fpt_ratio/100||"one2many"===t&&this._one2manyNum<e.config.max_one2many_fpt_per_hour&&Math.random()<=e.config.one2many_fpt_ratio/100)}},{key:"cacheP2PMsg",value:function(t){var r;this._one2oneMsgCache.set(t.msg_id,_objectSpread2({config_version:(null==(r=e.config)?void 0:r.version)||""},t))}},{key:"updateP2PMsg",value:function(e,t){var r=this._one2oneMsgCache.get(e);r&&this._one2oneMsgCache.set(e,_objectSpread2(_objectSpread2({},r),t))}},{key:"cacheCustomMsg",value:function(t){var r;this._one2manyMsgCache.set(t.msg_id,_objectSpread2({config_version:(null==(r=e.config)?void 0:r.version)||""},t))}},{key:"updateOne2ManyMsg",value:function(e,t){var r=this._one2manyMsgCache.get(e);r&&this._one2manyMsgCache.set(e,_objectSpread2(_objectSpread2({},r),t))}},{key:"reportP2PMsg",value:function(e){var t,r=this._one2oneMsgCache.get(e);r&&(logger$c.info("reportP2PMsg",r.type,JSON.stringify(r)),null==(t=getMonitor(this.id))||t.report("rts_message",r))}},{key:"reportOne2ManyMsg",value:function(e){var t,r=this._one2manyMsgCache.get(e);r&&(logger$c.info("reportOne2ManyMsg",r.type,JSON.stringify(r)),null==(t=getMonitor(this.id))||t.report("rts_message",r))}},{key:"reportMsgRecv",value:function(t){var r,n;t.config_version=(null==(r=e.config)?void 0:r.version)||"",logger$c.info("reportMsgRecv",t.type,JSON.stringify(t)),null==(n=getMonitor(this.id))||n.report("rts_message",t)}},{key:"destroy",value:function(){this._one2manyNum=0,this._one2oneNum=0,this._one2manyMsgCache.clear(),this._one2oneMsgCache.clear(),this._preTime=Date.now(),this.roomId="",this.userId="",this.rtsSessionId=""}}]),e}();__publicField(_MessageReportor,"config");var MessageReportor=_MessageReportor,_cache=new Map,setConfig=function(e){logger$c.info("setConfig","get config: ".concat(JSON.stringify(e))),MessageReportor.config=e},createRTSMsgReportor=function(e){var t=_cache.get(e)||new MessageReportor(e);return _cache.set(e,t),t},destroyRTSMsgReportor=function(e){var t=_cache.get(e);t&&(t.destroy(),_cache.delete(e))},setRoomId=function(e,t){var r=_cache.get(e);r&&(r.roomId=t||"")},setUserId=function(e,t){var r=_cache.get(e);r&&(r.userId=t||"")},setRtsSessionId=function(e,t){var r=_cache.get(e);r&&(r.rtsSessionId=t)},samplingP2PMsg=function(e,t){var r=_cache.get(e);if(null==r?void 0:r.needReport("one2one")){var n="".concat(t.from).concat(t.id),i=t.to?"one2one":"one2server";t.enable_report=!0,t.report_msg_id=t.id,r.cacheP2PMsg({rts_session_id:r.rtsSessionId,msg_id:n,node_role:"src_sdk",from:t.from,to:t.to||"server",type:i,rts_room_id:t.room,req_ts:Date.now(),send_ts:Date.now(),ack_ts:Date.now(),msg_size:0,error_code:0,recv_msg_ts:0,fwd_msg_ts:0,reply_ack_ts:0,cur_dst_uid:""})}return t},updateP2PMsgReq=function(e,t,r){var n;t.enable_report&&assertValidMsgId(t.report_msg_id)&&(null==(n=_cache.get(e))||n.updateP2PMsg("".concat(t.from).concat(t.report_msg_id),{send_ts:Date.now(),msg_size:r}))},updateP2PMsgAck=function(e,t,r){if(t.enable_report&&assertValidMsgId(t.report_msg_id)){var n=_cache.get(e);null==n||n.updateP2PMsg("".concat(t.from).concat(t.report_msg_id),{ack_ts:Date.now(),error_code:r}),null==n||n.reportP2PMsg("".concat(t.from).concat(t.report_msg_id))}},samplingOne2ManyMsg=function(e,t,r){var n=_cache.get(e);return(null==n?void 0:n.needReport("one2many"))&&(r.enable_report=!0,r.report_msg_id=t,n.cacheCustomMsg({rts_session_id:n.rtsSessionId,msg_id:"".concat(r.clientId).concat(t),node_role:"src_sdk",from:r.clientId,to:n.roomId,type:"one2many",rts_room_id:n.roomId,req_ts:Date.now(),send_ts:Date.now(),ack_ts:Date.now(),msg_size:0,error_code:0,recv_msg_ts:0,fwd_msg_ts:0,reply_ack_ts:0,cur_dst_uid:""})),r},updateOne2ManyMsgReq=function(e,t,r){if(t.enable_report&&assertValidMsgId(t.report_msg_id)){var n=_cache.get(e);n&&n.updateOne2ManyMsg("".concat(t.clientId).concat(t.report_msg_id),{send_ts:Date.now(),msg_size:r})}},updateOne2ManyMsgAck=function(e,t,r){if(t.enable_report&&assertValidMsgId(t.report_msg_id)){var n=_cache.get(e);n&&(null==n||n.updateOne2ManyMsg("".concat(t.clientId).concat(t.report_msg_id),{ack_ts:Date.now(),error_code:r}),null==n||n.reportOne2ManyMsg("".concat(t.clientId).concat(t.report_msg_id)))}},reportP2PMsgRecv=function(e,t,r){if(t.enable_report&&assertValidMsgId(t.report_msg_id)){var n=_cache.get(e),i=t.to?"one2one":"one2many";null==n||n.reportMsgRecv({rts_session_id:n.rtsSessionId,msg_id:"".concat(t.from).concat(t.report_msg_id),msg_size:r.msg_size,node_role:"dst_sdk",type:i,rts_room_id:t.room,from:t.from,to:t.to||t.room,error_code:0,recv_msg_ts:r.recv_msg_ts,fwd_msg_ts:r.fwd_msg_ts,reply_ack_ts:Date.now(),cur_dst_uid:t.to?"":n.userId,config_version:"",req_ts:0,send_ts:0,ack_ts:0})}},reportOne2ManyMsgRecv=function(e,t,r){if(t.enable_report&&assertValidMsgId(t.report_msg_id)){var n=_cache.get(e);null==n||n.reportMsgRecv({rts_session_id:n.rtsSessionId,msg_id:"".concat(t.clientId).concat(t.report_msg_id),msg_size:r.msg_size,node_role:"dst_sdk",type:"one2many",rts_room_id:t.roomId,from:t.clientId,to:t.roomId,error_code:0,recv_msg_ts:r.recv_msg_ts,fwd_msg_ts:r.fwd_msg_ts,reply_ack_ts:Date.now(),cur_dst_uid:n.userId,config_version:"",req_ts:0,send_ts:0,ack_ts:0})}},RTSMsgReportor={_cache:_cache,setConfig:setConfig,setRtsSessionId:setRtsSessionId,createRTSMsgReportor:createRTSMsgReportor,destroyRTSMsgReportor:destroyRTSMsgReportor,setRoomId:setRoomId,setUserId:setUserId,samplingP2PMsg:samplingP2PMsg,updateP2PMsgReq:updateP2PMsgReq,updateP2PMsgAck:updateP2PMsgAck,samplingOne2ManyMsg:samplingOne2ManyMsg,reportP2PMsgRecv:reportP2PMsgRecv,updateOne2ManyMsgAck:updateOne2ManyMsgAck,updateOne2ManyMsgReq:updateOne2ManyMsgReq,reportOne2ManyMsgRecv:reportOne2ManyMsgRecv},MessageStatisticsObserver=function(){function e(t){_classCallCheck(this,e),__publicField(this,"_timer"),__publicField(this,"userMessage",{}),__publicField(this,"roomMessage",{}),this.id=t,this._setTimer()}return _createClass(e,[{key:"_setTimer",value:function(){var e=this;!function t(){e._reportAndgReset(),clearTimeout(e._timer),e._timer=setTimeout(t,1e4)}()}},{key:"_reportAndgReset",value:function(){(Object.keys(this.userMessage).length||Object.keys(this.roomMessage).length)&&(this._report(),this._reset())}},{key:"_report",value:function(){var e,t=this;null==(e=getMonitor(this.id))||e.report("rtc_message_statistics",{dc_user_message:Object.keys(this.userMessage).map((function(e){return t.userMessage[e]})),dc_room_message:Object.keys(this.roomMessage).map((function(e){return t.roomMessage[e]})),media_server_ip:""})}},{key:"_reset",value:function(){this.userMessage={},this.roomMessage={}}},{key:"_checkInitUserMessage",value:function(e,t){this.userMessage["".concat(t,"-").concat(e)]||(this.userMessage["".concat(t,"-").concat(e)]={dc_peer_user_id:e,dc_send_total:0,dc_recv_total:0,dc_send_ack:0,dc_send_fail:0,dc_fail_timeout:0,dc_fail_no_receiver:0,dc_fail_no_relay_path:0,dc_cost_time:0,dc_cost_e2s:0,dc_cost_s2s:0,dc_least_time:Number(1/0),dc_most_time:0,dc_cost_peer_s2e:0,dc_send_ack_100:0,dc_send_ack_200:0,dc_send_ack_400:0,dc_send_ack_1s:0,dc_message_type:t,dc_send_binary:0})}},{key:"_sendUserMessage",value:function(e,t,r){this._checkInitUserMessage(e,t),this.userMessage["".concat(t,"-").concat(e)].dc_send_total++,r&&this.userMessage["".concat(t,"-").concat(e)].dc_send_binary++}},{key:"_recvUserMessage",value:function(e,t){this._checkInitUserMessage(e,t),this.userMessage["".concat(t,"-").concat(e)].dc_recv_total++}},{key:"_sendUserFail",value:function(e,t,r){var n=this.userMessage["".concat(t,"-").concat(e)];n&&(n.dc_send_fail++,this._handleUserFail(n,r))}},{key:"_handleUserFail",value:function(e,t){t&&(t.code||t.err)&&(["TIME_OUT","USER_MESSAGE_TIMEOUT"].includes(t.code)?e.dc_fail_timeout++:3===t.err?e.dc_fail_no_receiver++:4===t.err?e.dc_fail_no_relay_path++:1===t.err&&e.dc_fail_timeout++)}},{key:"_sendUserAck",value:function(e,t,r,n,i){var o=this.userMessage["".concat(t,"-").concat(e)];o&&(o.dc_send_ack++,o.dc_cost_time+=r,o.dc_cost_s2s+=n||0,o.dc_cost_peer_s2e+=i,o.dc_cost_e2s+=r-(n||0)-i,r<=100?(o.dc_send_ack_100++,o.dc_send_ack_200++,o.dc_send_ack_400++,o.dc_send_ack_1s++):r<=200?(o.dc_send_ack_200++,o.dc_send_ack_400++,o.dc_send_ack_1s++):r<=400?(o.dc_send_ack_400++,o.dc_send_ack_1s++):r<=1e3&&o.dc_send_ack_1s++,r<o.dc_least_time&&(o.dc_least_time=r),r>o.dc_most_time&&(o.dc_most_time=r))}},{key:"sendRoomMessage",value:function(e,t){this.roomMessage[e]||(this.roomMessage[e]={dc_room_id:e,dc_send_total:0,dc_send_ack:0,dc_cost_time:0,dc_least_time:Number(1/0),dc_most_time:0,dc_send_fail:0,dc_send_ack_100:0,dc_send_ack_200:0,dc_send_ack_400:0,dc_send_ack_1s:0,dc_send_binary:0}),this.roomMessage[e].dc_send_total++,t&&this.roomMessage[e].dc_send_binary++}},{key:"sendRoomFail",value:function(e){var t=this.roomMessage[e];t&&t.dc_send_fail++}},{key:"sendRoomAck",value:function(e,t){var r=this.roomMessage[e];r&&(r.dc_send_ack++,r.dc_cost_time+=t,t<r.dc_least_time&&(r.dc_least_time=t),t>r.dc_most_time&&(r.dc_most_time=t),t<=100?(r.dc_send_ack_100++,r.dc_send_ack_200++,r.dc_send_ack_400++,r.dc_send_ack_1s++):t<=200?(r.dc_send_ack_200++,r.dc_send_ack_400++,r.dc_send_ack_1s++):t<=400?(r.dc_send_ack_400++,r.dc_send_ack_1s++):t<=1e3&&r.dc_send_ack_1s++)}},{key:"sendP2PMessage",value:function(e,t){this._sendUserMessage(e,"p2p",t)}},{key:"recvP2PMessage",value:function(e){this._recvUserMessage(e,"p2p")}},{key:"sendP2PFail",value:function(e,t){this._sendUserFail(e,"p2p",t)}},{key:"sendP2PAck",value:function(e,t,r,n){this._sendUserAck(e,"p2p",t,r,n)}},{key:"sendP2POutRoomMessage",value:function(e,t){this._sendUserMessage(e,"p2p_outside_room",t)}},{key:"recvP2POutRoomMessage",value:function(e){this._recvUserMessage(e,"p2p_outside_room")}},{key:"sendP2POutRoomFail",value:function(e,t){this._sendUserFail(e,"p2p_outside_room",t)}},{key:"sendP2POutRoomAck",value:function(e,t,r,n){this._sendUserAck(e,"p2p_outside_room",t,r,n)}},{key:"sendP2serverMessage",value:function(e){this._sendUserMessage("","p2server",e)}},{key:"sendP2serverFail",value:function(e){this._sendUserFail("","p2server",e)}},{key:"sendP2serveAck",value:function(e,t,r){this._sendUserAck("","p2server",e,t,r)}},{key:"countP2PMessage",value:function(e,t,r,n,i){this.sendP2PMessage(t,r),e?this.sendP2PAck(t,Date.now()-n,i.s2s_time,i.s2e_time):this.sendP2PFail(t,i)}},{key:"countRoomMessage",value:function(e,t,r,n){this.sendRoomMessage(t,r),e?this.sendRoomAck(t,Date.now()-n):this.sendRoomFail(t)}},{key:"countUserMessageOutsideRoom",value:function(e,t,r,n,i){this.sendP2POutRoomMessage(t,r),e?this.sendP2POutRoomAck(t,Date.now()-n,i.s2s_time,i.s2e_time):this.sendP2POutRoomFail(t,i)}},{key:"countServerMessage",value:function(e,t,r,n){this.sendP2serverMessage(t),e?(n=n||{},this.sendP2serveAck(Date.now()-r,n.s2s_time||0,n.s2e_time||0)):this.sendP2serverFail(n)}},{key:"destroy",value:function(){this._reset(),clearTimeout(this._timer)}}]),e}(),setGlobalStats=function(e){commonReportor.setCommonStats(e)},setReportUrl=function(e){commonReportor.setUrl(e)},globalMonitor=new Monitor("global"),reportGlobalApiCall=function(e,t,r){globalMonitor.report("rtc_sdk_api_call",{sdk_api_name:e,error_code:t,message:r})},reportGlobalCallback=function(e,t,r){globalMonitor.report("rtc_sdk_callback",{sdk_callback_name:e,error_code:t,message:r})},reportGlobalError=function(e,t,r){globalMonitor.report("rtc_error",{message:e,error_code:t},r)},reportGlobalInvokeStatus=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0;globalMonitor.report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:r,stream_id:n,elapse:0},i)};function reportGlobalLog(e){globalMonitor.reportLog(e)}var monitorMap=new Map,getMonitor=function(e){return monitorMap.get(e)},createMonitor=function(e,t){var r=new Monitor(e);return r.set(_objectSpread2(_objectSpread2({},t),{},{engine_session_id:genUuid$1()})),r.report("sdk_init_engine",{start:Date.now(),type:"begin"}),monitorMap.set(e,r),r};function reportRtcSdkApiCall(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e,r,n){if("function"==typeof n.value){var i=n.value;n.value=function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];var a,s,c,u=this.engineId||this.id,l={};t.forEach((function(e,t){l[e]=n[t]})),"joinRoom"===r&&(null==(s=getMonitor(u))||s.set({room_id:n[1],user_id:null==(a=n[2])?void 0:a.userId})),null==(c=getMonitor(u))||c.report("rtc_sdk_api_call",{sdk_api_name:r,message:JSON.stringify(reportParamsCheck(n)),error_code:0},l);var d=i.apply(this,n);return"function"==typeof(null==d?void 0:d.then)?d.then((function(e){return reportRtcSdkCallback(u,r,[e||{}]),e})).catch((function(e){throw reportRtcSdkCallback(u,r,e.message,e.code),e})):(reportRtcSdkCallback(u,r,[d||{}]),d)}}}}var reportRtcSdkCallback=function(e,t,r){var n,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4?arguments[4]:void 0,a={sdk_callback_name:t,error_code:i,message:JSON.stringify(Array.isArray(r)?reportParamsCheck(r):r)};o&&(a.room_id=o),null==(n=getMonitor(e))||n.report("rtc_sdk_callback",a)},reportRtcInvokeStatus=function(e,t,r){var n,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5?arguments[5]:void 0;null==(n=getMonitor(e))||n.report("rtc_invoke_status",{sdk_api_name:t,message:r,error_code:i,stream_id:o,elapse:0},a)},maxBinaryLength=10;function reportParamsCheck(e){return e.map((function e(t){if(null==t?void 0:t._reportName)return t._reportName;if(t instanceof HTMLElement)return t.toString();if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){var r=ArrayBuffer.isView(t)?t.buffer:t,n=r.byteLength,i=[];if(n>maxBinaryLength){var o=new DataView(r),a=Array.from({length:maxBinaryLength/2}).map((function(e,t){return o.getUint8(t)})),s=Array.from({length:maxBinaryLength/2}).map((function(e,t){return n-1-t})).reverse().map((function(e){return o.getUint8(e)}));i=[].concat(_toConsumableArray(a),["..."],_toConsumableArray(s))}else i=Array.from(new Uint8Array(r));return"".concat(t.constructor.name,"(").concat(n,") [").concat(i.join(", "),"]")}if(t instanceof ImageData)return"ImageData";if(Array.isArray(t))return t.map(e);if(["[object Object]","[object MediaStreamTrack]"].includes(Object.prototype.toString.call(t))){var c={};for(var u in t)c[u]=e(t[u]);return c}return t}))}var ENABLE_CONSOLE_UPLOAD="undefined"!=typeof window&&window.location.search.includes("_rtc_upload_console_"),ConsoleReportor=function(){function e(){var t=this;_classCallCheck(this,e),__publicField(this,"name","ConsoleReportor"),__publicField(this,"_uuid","".concat(Math.floor(899*Math.random())+100)),__publicField(this,"_consoleReportId",0),__publicField(this,"_engineReportIdMap",new Map),__publicField(this,"_enabled","NULL"),__publicField(this,"_consoleCutLength",CoreConfig.getParameter("UPLOAD_CONSOLE_LENGTH_CUT")),__publicField(this,"buffer",[]),ENABLE_CONSOLE_UPLOAD&&setTimeout((function(){t.switchOn()}),0),CoreConfig.on("UPLOAD_CONSOLE_ON",(function(e){e?t.switchOn():t.turnOff()})),CoreConfig.on("UPLOAD_CONSOLE_LENGTH_CUT",(function(e){t._consoleCutLength=e}))}return _createClass(e,[{key:"enabled",get:function(){return"OFF"!==this._enabled}},{key:"switchOn",value:function(){"NULL"===this._enabled&&(console.log("[LoggerReportor.constructor] console upload switch ON"),this._enabled="ON")}},{key:"turnOff",value:function(){"NULL"===this._enabled&&(console.log("[LoggerReportor.constructor] console upload switch OFF"),this._enabled="OFF",this.buffer=[])}},{key:"getEngineConsoleId",value:function(e){var t,r=null!==(t=this._engineReportIdMap.get(e))&&void 0!==t?t:0;return this._engineReportIdMap.set(e,r+1),r}},{key:"report",value:function(e,t,r,n,i,o,a,s,c){var u=this;if("OFF"!==this._enabled){var l=getMonitor(t),d=this._consoleReportId++,p=this.getEngineConsoleId(t),_=shallowJson(c,this._consoleCutLength),h=_toConsumableArray(c),f="".concat(s).replace(/%o|%s/gi,(function(){return shallowJson([h.shift()],u._consoleCutLength)})),m="[".concat(this._uuid,"-").concat(d,"][").concat(t,"-").concat(p,"]-").concat(r,"-").concat(e,"[").concat(n,"]").concat(i,"[").concat(o,".").concat(a,"] ").concat(f," ").concat(_);l?l.reportLog(m):reportGlobalLog(m)}}},{key:"push",value:function(e){"OFF"!==this._enabled&&this.buffer.push(e)}},{key:"splice",value:function(e){if("ON"!==this._enabled)return{payload:[],payloadSize:0};var t=findSizeIndex(this.buffer,e),r=t.index,n=t.size;return{payload:this.buffer.splice(0,r),payloadSize:n}}},{key:"unshift",value:function(e){this.buffer=e.concat(this.buffer)}},{key:"get",value:function(){return this.buffer}},{key:"set",value:function(e){this.buffer=e.concat(this.buffer)}},{key:"isEmpty",value:function(){return"OFF"===this._enabled||0===this.buffer.length}}]),e}();function shallowJson(e,t){return e.map((function(e){var r="";try{if("string"==typeof e)return e;if(void 0===e)return"undefined";if(null===e)return"null";if(e instanceof MediaStreamTrack)return mediaTrackStringify(e);if(e instanceof MediaStream)return mediaStreamStringify(e);if(e instanceof RTCRtpSender)return mediaSenderStringify(e);if(e instanceof RTCRtpReceiver)return mediaReceiverStringify(e);if(e instanceof RTCRtpTransceiver)return mediaTransceiverStringify(e);r=JSON.stringify(e)}catch(n){r=e.toString()}return r&&r.length>=t&&(r=r.slice(0,t)),r})).join(", ")}function findSizeIndex(e,t){for(var r=0,n=0;n<e.length;n++){var i=JSON.stringify(e[n]).length;if((r+=i)>t)return{index:n,size:r-i}}return{index:e.length,size:r}}var consoleReportor=new ConsoleReportor,colorMap={DEBUG:"rgba(0, 0, 0, 0)"," INFO":"rgba(93, 173, 226, 0)"," WARN":"rgba(255, 119, 0, 0.3)",ERROR:"rgba(255, 0, 0, 0.3)"," SUCC":"rgba(0, 119, 0, 0.3)"},DEBUG="undefined"!=typeof window&&(window.location.search.includes("_rtc_debug_")||(null==(_n=window.localStorage)?void 0:_n.getItem("_rtc_debug_"))),Logger$1=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"global";_classCallCheck(this,e),__publicField(this,"indent"),__publicField(this,"module"),__publicField(this,"_engineId"),this.module=t,this.indent=r,this._engineId=n}return _createClass(e,[{key:"_print",value:function(e,t){for(var r,n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];var a=i.shift();try{var s=[].concat(i),c="".concat(a).replace(/%o/gi,(function(){var e=s.shift();return JSON.stringify(e)}));iDB.set("[VERTC][".concat(this.module,".").concat(t,"] ").concat(c," ").concat(s.map((function(e){return JSON.stringify(e)})).join(", ")))}catch(p){}for(var u="",l=0;l<this.indent;l++)u+="    ";var d=getTimestamp();consoleReportor.report("[VERTC]",this._engineId,d,e,u,this.module,t,a,i),DEBUG&&(r=console).log.apply(r,["%c".concat(d,"-[VERTC]%c[").concat(e,"]%c").concat(u,"[").concat(this.module,".").concat(t,"] ").concat(a),"color:#0050b3;","background-color:".concat(colorMap[e],";"),"color:#0050b3;"].concat(i))}},{key:"print",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this._print.apply(this,[" INFO",e].concat(r))}},{key:"debug",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this._print.apply(this,["DEBUG",e].concat(r))}},{key:"info",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this._print.apply(this,[" INFO",e].concat(r))}},{key:"warn",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this._print.apply(this,[" WARN",e].concat(r))}},{key:"error",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this._print.apply(this,["ERROR",e].concat(r))}},{key:"success",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this._print.apply(this,[" SUCC",e].concat(r))}}]),e}(),getTimestamp=function(){var e=new Date;return"".concat(e.toTimeString().split(" ")[0],":").concat(e.getMilliseconds().toString().padStart(3,"0"))},Logger$1$1=Logger$1,getServerConfig=function(e){var t=getMonitor(e.engineId),r={keys:e.keys,labelSelector:"",sdkVersion:e.sdkVersion,deviceType:"web",appId:e.appId,deviceId:e.deviceId},n=e.requestDomains.map((function(e){return"https://".concat(e,"/decision/v1/multi")}));null==t||t.report("rtc_get_config",{error_code:0,message:JSON.stringify(r),elapse:0,host:n.join(","),type:"request",config_id:"",enable_cloud_proxy:!1});var i=n.map(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"POST",body:JSON.stringify(r)}).then((function(e){return e.json()}));case 2:return e.t0=e.sent,e.t1=n,e.abrupt("return",{result:e.t0,index:e.t1});case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}());return new Promise((function(e){promiseAny$1(i).then((function(r){var i=r.result,o=r.index;null==t||t.report("rtc_get_config",{error_code:200,message:JSON.stringify(i),elapse:0,host:n[o],type:"response",config_id:"",enable_cloud_proxy:!1}),e(i)})).catch((function(e){var r;null==t||t.report("rtc_get_config",{error_code:500,message:null==(r=e[0])?void 0:r.message,elapse:0,host:"",type:"response",config_id:"",enable_cloud_proxy:!1})}))}))},getRandomValues,rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&!(getRandomValues="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}for(var byteToHex=[],e$1=0;e$1<256;++e$1)byteToHex.push((e$1+256).toString(16).slice(1));function unsafeStringify(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(byteToHex[e[t+0]]+byteToHex[e[t+1]]+byteToHex[e[t+2]]+byteToHex[e[t+3]]+"-"+byteToHex[e[t+4]]+byteToHex[e[t+5]]+"-"+byteToHex[e[t+6]]+byteToHex[e[t+7]]+"-"+byteToHex[e[t+8]]+byteToHex[e[t+9]]+"-"+byteToHex[e[t+10]]+byteToHex[e[t+11]]+byteToHex[e[t+12]]+byteToHex[e[t+13]]+byteToHex[e[t+14]]+byteToHex[e[t+15]]).toLowerCase()}var randomUUID="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID:randomUUID};function v4(e,t,r){if(native.randomUUID&&!t&&!e)return native.randomUUID();var n=(e=e||{}).random||(e.rng||rng)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return unsafeStringify(n)}var textDecoder=new TextDecoder,textEncoder=new TextEncoder,genUuid=function(){return v4()},getServerNow=function(){return Date.now()},isSupportVideoFrameCallback=!isSSR$1()&&"function"==typeof HTMLVideoElement.prototype.requestVideoFrameCallback;function concatenate(e){for(var t=0,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var o=0,a=n;o<a.length;o++){var s=a[o];t+=s.length}for(var c=new e(t),u=0,l=0,d=n;l<d.length;l++){var p=d[l];c.set(p,u),u+=p.length}return c}var Utils=function(){function e(){_classCallCheck(this,e)}var t,r;return _createClass(e,null,[{key:"token2auth",value:function(t,r,n,i){return i?"Bearer ".concat(i):"Basic ".concat(e.createUnsafeToken(t,r,n))}},{key:"createUnsafeToken",value:function(e,t,r){return window.btoa([e,t,r].filter((function(e){return null!==e})).join(":"))}},{key:"merge",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=0,i=Object.entries(t);n<i.length;n++){var o=_slicedToArray(i[n],2),a=o[0],s=o[1];null!==s&&"object"==_typeof(s)?e.merge(t[a],r[a]):void 0!==r[a]&&(t[a]=r[a])}}},{key:"ab2str",value:function(e){return textDecoder.decode(e)}},{key:"ab2obj",value:function(t){try{var r=e.ab2str(t);return JSON.parse(r)}catch(n){return{}}}},{key:"str2ab",value:function(e){return textEncoder.encode(e).buffer}},{key:"ab2b64str",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){var r=new FileReader;r.onload=function(){return e(r.result)},r.readAsDataURL(new Blob([t]))}));case 2:return e.abrupt("return",e.sent.split(",",2)[1]);case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"b64str2ab",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("data:application/octet;base64,".concat(t)).then((function(e){return e.arrayBuffer()})));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();function createRandomId(){for(var e=Number("".concat(Math.random()).slice(-7).padEnd(7,"0")).toString(2).padEnd(28,"1").split(""),t=[];e.length;)t.push(e.splice(0,7));return t.map((function(e,r){var n=r===t.length-1?"0":"1";return Number.parseInt(n+e.join(""),2)}))}var genEventSessionId=function(){return Math.floor(65535*Math.random())};function isByteId(e){return 128==(128&e)}function isRttMessage(e){return"string"==typeof e&&e.indexOf("__web__rtc__rtt__")>-1}function randomNum(e){for(var t="",r=0;r<e;r++)t+=Math.floor(10*Math.random());return t}var createDefaultSdp=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],(r=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"})).createDataChannel("default"),r.addTransceiver("audio",{direction:"recvonly"}),r.addTransceiver("video",{direction:"recvonly"}),t&&(r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"sendonly"})),e.next=5,r.createOffer();case 5:return n=e.sent,e.abrupt("return",(r.close(),n.sdp));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),promiseAny=function(e){return new Promise((function(t,r){var n=(e=Array.isArray(e)?e:[]).length,i=[];0===n?r([]):e.forEach((function(e){e.then((function(e){t(e)}),(function(e){n--,i.push(e),0===n&&r(i)}))}))}))};function getNonlinearVolume(e){return Number(Math.max(-127,10*Math.log10(Math.pow(e/255,2))).toFixed(2))}function audioInMediaType(e){return(e&MediaType.AUDIO)===MediaType.AUDIO}function videoInMediaType(e){return(e&MediaType.VIDEO)===MediaType.VIDEO}function getPublicStats(e){var t={};return Object.keys(e).forEach((function(r){"object"==_typeof(e[r])?t[r]=getPublicStats(e[r]):r.startsWith("_")||(t[r]=e[r])})),t}function splitPublicStreamSei(e){var t=new DataView(e.buffer);if(t.byteLength<=4||65535!==t.getUint16(0))return{seiCount:1,seis:[e]};for(var r={seiCount:0,seis:[]},n=!1,i=2;i<t.byteLength;){var o=t.getUint16(i);if(i+=2,t.byteLength-i<o){n=!0;break}var a=new Uint8Array(e.buffer,i,o);if(i+=o,t.byteLength-i>0&&t.byteLength-i<=2){n=!0;break}r.seiCount++,r.seis.push(a)}return n&&(r.seiCount=1,r.seis=[e]),r}function isUndefined$2(e){return void 0===e}function warnDeprecatedApi(e){return function(t,r,n){var i=n.value;n.value=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return console.warn("[RTC WebSDK]: Api: ".concat(r," has been abandoned from version ").concat(e)),i.apply(this,n)}}}function warnDevelopers(e){console.warn("[RTC WebSDK]: ".concat(e))}function constraints2number(e){return"number"==typeof e?e:"number"==typeof(null==e?void 0:e.exact)?e.exact:"number"==typeof(null==e?void 0:e.ideal)?e.ideal:"number"==typeof(null==e?void 0:e.max)?e.max:"number"==typeof(null==e?void 0:e.min)?e.min:1}function setJoinRoomInfo(e,t,r){if("function"==typeof r.value){var n=r.value;r.value=function(){for(var e,t=getMonitor(this.id),r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return null==t||t.set({room_id:i[1],user_id:null==(e=i[2])?void 0:e.userId}),n.apply(this,i)}}}var EngineEventsTypes=function(e){return e.onTrackEnded="onTrackEnded",e.onTrackMute="onTrackMute",e.onTrackUnmute="onTrackUnmute",e.onPlayerEvent="onPlayerEvent",e.onAutoplayFailed="onAutoplayFailed",e.onUserJoined="onUserJoined",e.onUserLeave="onUserLeave",e.onConnectionStateChanged="onConnectionStateChanged",e.onUserPublishStream="onUserPublishStream",e.onUserUnpublishStream="onUserUnpublishStream",e.onUserPublishScreen="onUserPublishScreen",e.onUserUnpublishScreen="onUserUnpublishScreen",e.onRoomMessageReceived="onRoomMessageReceived",e.onRoomBinaryMessageReceived="onRoomBinaryMessageReceived",e.onUserMessageReceived="onUserMessageReceived",e.onUserBinaryMessageReceived="onUserBinaryMessageReceived",e.onVideoFirstFrameRendered="onVideoFirstFrameRendered",e.onVideoFirstFrameDecoded="onVideoFirstFrameDecoded",e.onRemoteVideoFirstFrame="onRemoteVideoFirstFrame",e.onAudioFirstFrameDecoded="onAudioFirstFrameDecoded",e.onRemoteAudioFirstFrame="onRemoteAudioFirstFrame",e.onFirstPublicStreamVideoFrameRendered="onFirstPublicStreamVideoFrameRendered",e.onFirstPublicStreamVideoFrameDecoded="onFirstPublicStreamVideoFrameDecoded",e.onFirstPublicStreamAudioFrameDecoded="onFirstPublicStreamAudioFrameDecoded",e.onVideoDeviceStateChanged="onVideoDeviceStateChanged",e.onAudioDeviceStateChanged="onAudioDeviceStateChanged",e.onRemoteStreamStats="onRemoteStreamStats",e.onPublicStreamStats="onPublicStreamStats",e.onLocalStreamStats="onLocalStreamStats",e.onAudioVolumeIndication="onAudioVolumeIndication",e.onLocalAudioPropertiesReport="onLocalAudioPropertiesReport",e.onRemoteAudioPropertiesReport="onRemoteAudioPropertiesReport",e.onActiveSpeaker="onActiveSpeaker",e.onAudioPlaybackDeviceChanged="onAudioPlaybackDeviceChanged",e.onUserStartVideoCapture="onUserStartVideoCapture",e.onUserStopVideoCapture="onUserStopVideoCapture",e.onUserStartAudioCapture="onUserStartAudioCapture",e.onUserStopAudioCapture="onUserStopAudioCapture",e.onAutoPublishResult="onAutoPublishResult",e.onAutoSubscribeResult="onAutoSubscribeResult",e.onLiveTranscodingResult="onLiveTranscodingResult",e.onStreamMixingEvent="onStreamMixingEvent",e.onAudioPlaybackDeviceTestVolume="onAudioPlaybackDeviceTestVolume",e.onSEIMessageReceived="onSEIMessageReceived",e.onError="onError",e.onAudioMixingStateChanged="onAudioMixingStateChanged",e.onUserMessageReceivedOutsideRoom="onUserMessageReceivedOutsideRoom",e.onUserBinaryMessageReceivedOutsideRoom="onUserBinaryMessageReceivedOutsideRoom",e.onTokenWillExpire="onTokenWillExpire",e.onCloudProxyConnected="onCloudProxyConnected",e.onPushPublicStreamResult="onPushPublicStreamResult",e.onPublicStreamSEIMessageReceived="onPublicStreamSEIMessageReceived",e.onNetworkQuality="onNetworkQuality",e.onSimulcastSubscribeFallback="onSimulcastSubscribeFallback",e.onRemoteVideoSizeChanged="onRemoteVideoSizeChanged",e.onVideoStreamBanned="onVideoStreamBanned",e.onAudioStreamBanned="onAudioStreamBanned",e.onLocalVideoSizeChanged="onLocalVideoSizeChanged",e.onSubtitleStateChanged="onSubtitleStateChanged",e.onSubtitleMessageReceived="onSubtitleMessageReceived",e.onServerParamsSetResult="onServerParamsSetResult",e.onLocalStreamTrackChangedByExtension="onLocalStreamTrackChangedByExtension",e.onVendorConnectionStateChanged="onVendorConnectionStateChanged",e.onForwardStreamError="onForwardStreamError",e.onRejoinWithTcp="onRejoinWithTcp",e.onIceConnectWithTcp="onIceConnectWithTcp",e.onPublishRetry="onPublishRetry",e.onSubscribeRetry="onSubscribeRetry",e.onPublishResult="onPublishResult",e.onSubscribeResult="onSubscribeResult",e}(EngineEventsTypes||{}),isSSR=function(){return"undefined"==typeof window},userAgentString=isSSR()?"":window.navigator.userAgent;function getBrowser(){var e="none";return isSSR()||(null!==userAgentString.match("Firefox")?e="mozilla":null!==userAgentString.match("Chrome")?(e="chrome-stable",null!==userAgentString.match("Electron")&&(e="electron")):(null!==userAgentString.match("Safari")||null!==userAgentString.match("AppleWebKit"))&&(e="safari")),e}var isFirefox="mozilla"===getBrowser(),isSafari="safari"===getBrowser(),isChrome="chrome-stable"===getBrowser(),isCriOS=!isSSR()&&/CriOS/i.test(userAgentString),isEdgeForDesktop=!isSSR()&&/Edg\//i.test(userAgentString),isEdgeForAndroid=!isSSR()&&/EdgA/i.test(userAgentString),isEdgeForIOS=!isSSR()&&/EdgiOS/i.test(userAgentString),isEdge=isEdgeForDesktop||isEdgeForAndroid||isEdgeForIOS,isDingTalk=!isSSR()&&/DingTalk/i.test(navigator.userAgent),isIPad=!isSSR()&&(!!/(iPad)/i.exec(userAgentString)||/Macintosh/i.test(userAgentString)&&"ontouchend"in document),isMac=!isSSR()&&/Macintosh/i.test(userAgentString),isWeChat=!isSSR()&&/MicroMessenger/i.test(userAgentString),isMobile$1=!isSSR()&&userAgentString.toLowerCase().includes("mobile"),isIOS=!isSSR()&&!!/(iPhone|iPad|iPod)/i.exec(userAgentString),isAndroid=!isSSR()&&/Android/i.test(userAgentString),isWindows=!isSSR()&&/Windows/i.test(userAgentString),sv=0,sv2="0",v$1=!isSSR()&&(null==(_o=userAgentString.match(/version\/(\d+)/i))?void 0:_o[1]);isSafari&&v$1&&(sv=Number(v$1),sv2=null==(_p=navigator.userAgent.match(/version\/(\d+\.\d+)/i))?void 0:_p[1]);var v2=!isSSR()&&(null==(_q=userAgentString.match(/Firefox\/(\d+)/i))?void 0:_q[1]);isFirefox&&v2&&(sv=Number(v2));var safariVersion=sv,firefoxVersion=sv,safariMinorVersion=sv2,iOSVersion=null!==(_ref15=!isSSR()&&(null==(_s=null==(_r=userAgentString.match(/ ([\d_]+) like Mac OS X/i))?void 0:_r[1])?void 0:_s.split("_").map((function(e){return parseInt(e)}))))&&void 0!==_ref15?_ref15:[],cv=0,cvs=!isSSR()&&(null==(_t=userAgentString.match(/Chrome\/(\d+)/i))?void 0:_t[1]);cvs&&(cv=Number(cvs));var chromeVersion=cv,PLATFORM_KEY="VolcEngine",RTC_DEVICE_ID="RTC_DEVICE_ID",RTC_ACCESS_NODE="RTC_ACCESS_NODE",RTC_ACCESS_URLS="RTC_ACCESS_URLS",ENGINE_WEB_CONFIG="ENGINE_WEB_CONFIG",SERVER_CONFIG="SERVER_CONFIG",Cache=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"get",value:function(e){var t=localStorage.getItem(e);if(!t)return null;try{var r=JSON.parse(t);return r.ttl>0&&Date.now()-r.saveTime>r.ttl?(this.delete(e),null):r.message}catch(n){return null}}},{key:"set",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n={ttl:r,saveTime:Date.now(),message:t};try{return localStorage.setItem(e,JSON.stringify(n)),!0}catch(i){return!1}}},{key:"getTtl",value:function(e){var t=localStorage.getItem(e);if(!t)return null;try{return JSON.parse(t).ttl}catch(r){return null}}},{key:"delete",value:function(e){try{return localStorage.removeItem(e),!0}catch(t){return!1}}}]),e}(),SDKCache=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"getDeviceId",value:function(){if(isSSR())return"";var e=this.get(RTC_DEVICE_ID);return e&&!/^[0-9a-f]{8}(-[0-9a-f]{4}){3}-[0-9a-f]{12}$/.test(e)||(e=randomNum(30)),this.setDeviceId(e),e}},{key:"setDeviceId",value:function(e){return setGlobalStats({device_id:e}),this.set(RTC_DEVICE_ID,e),e}},{key:"getAccessNode",value:function(e){return this.get("".concat(RTC_ACCESS_NODE,"_").concat(e,"-").concat(PLATFORM_KEY))}},{key:"setAccessNode",value:function(e,t,r){return this.set("".concat(RTC_ACCESS_NODE,"_").concat(e,"-").concat(PLATFORM_KEY),t,1e3*r)}},{key:"deleteAccessNode",value:function(e,t){var r=this.getAccessNode(e),n=this.getTtl("".concat(RTC_ACCESS_NODE,"_").concat(e,"-").concat(PLATFORM_KEY));Array.isArray(r)&&r.length>0&&((r=r.filter((function(e){return e.mediaID!==t.mediaID&&e.msgKey!==t.msgKey}))).length>0?this.setAccessNode(e,r,n||0):this.clearAccessNode(e))}},{key:"clearAccessNode",value:function(e){this.delete("".concat(RTC_ACCESS_NODE,"_").concat(e,"-").concat(PLATFORM_KEY))}},{key:"getAccessUrls",value:function(){return this.get("".concat(RTC_ACCESS_URLS,"-").concat(PLATFORM_KEY))}},{key:"setAccessUrls",value:function(e){var t=e.map((function(e){var t=e.host,r=e.path;return"https://".concat(t).concat(r)}));return this.set("".concat(RTC_ACCESS_URLS,"-").concat(PLATFORM_KEY),t)}},{key:"clearAccessUrls",value:function(){this.delete("".concat(RTC_ACCESS_URLS,"-").concat(PLATFORM_KEY))}},{key:"getEngineWebConfig",value:function(e,t){var r,n="".concat(e,"_").concat(t,"_").concat(this.getDeviceId()),i=this.get(ENGINE_WEB_CONFIG);return(null==(r=null==i?void 0:i.find((function(e){return e.key===n})))?void 0:r.config)||{}}},{key:"setEngineWebConfig",value:function(e,t,r){if(r){var n="".concat(e,"_").concat(t,"_").concat(this.getDeviceId()),i=this.get(ENGINE_WEB_CONFIG)||[];return(i=i.filter((function(e){return e.key!==n}))).push({key:n,config:r}),this.set(ENGINE_WEB_CONFIG,i.slice(-5))}}},{key:"getServerConfig",value:function(e){var t,r="".concat(e),n=this.get(SERVER_CONFIG);return(null==(t=null==n?void 0:n.find((function(e){return e.key===r})))?void 0:t.config)||{}}},{key:"setServerConfig",value:function(e,t){if(t){var r="".concat(e),n=this.get(SERVER_CONFIG)||[];return(n=n.filter((function(e){return e.key!==r}))).push({key:r,config:t}),this.set(SERVER_CONFIG,n.slice(-5))}}}]),r}(Cache),sdkCache=new SDKCache,logger$b=new Logger$1$1("JoinRoomConfig",0),_JoinRoomConfig=function(){function e(t){_classCallCheck(this,e),__publicField(this,"_useTcpAfterJoinTimeout",e.DEFAULT_CONF.useTcpAfterJoinTimeout),__publicField(this,"_joinWithTcpOnly",e.DEFAULT_CONF.joinWithTcpOnly),__publicField(this,"_joinWithTcpOnlyDelay",e.DEFAULT_CONF.joinWithTcpOnlyDelay),__publicField(this,"_blackBrowserRegexList",[]),this._engineId=t,location.search.indexOf("__rtc_tcp_only__")>-1&&(this._joinWithTcpOnly=!0,this._joinWithTcpOnlyDelay=0),this._report()}return _createClass(e,[{key:"useTcpAfterJoinTimeout",get:function(){return this._useTcpAfterJoinTimeout}},{key:"useTcpJoin",get:function(){return this._joinWithTcpOnly}},{key:"useTcpJoinDelay",get:function(){return this._joinWithTcpOnlyDelay}},{key:"isBlackBrower",value:function(){return this._blackBrowserRegexList.find((function(e){return new RegExp(e).test(navigator.userAgent)}))}},{key:"setServerConfig",value:function(e){var t,r,n,i,o,a,s=!1;"boolean"==typeof(null==(t=null==e?void 0:e.use_tcp_after_join_timeout)?void 0:t.enable)&&(this._useTcpAfterJoinTimeout=null==(r=e.use_tcp_after_join_timeout)?void 0:r.enable,s=!0),"boolean"==typeof(null==(n=null==e?void 0:e.join_with_tcp_only)?void 0:n.enable)&&(this._joinWithTcpOnly=null==(i=e.join_with_tcp_only)?void 0:i.enable,s=!0),"number"==typeof(null==(o=null==e?void 0:e.join_with_tcp_only)?void 0:o.delay_ms)&&(this._joinWithTcpOnlyDelay=null==(a=e.join_with_tcp_only)?void 0:a.delay_ms,s=!0),e&&Array.isArray(e.black_browser_regex_list)&&(this._blackBrowserRegexList=e.black_browser_regex_list,s=!0),s&&this._report()}},{key:"toString",value:function(){return JSON.stringify({use_tcp_after_join_timeout:this._useTcpAfterJoinTimeout,join_with_tcp_only:this._joinWithTcpOnly,join_with_tcp_only_delay:this._joinWithTcpOnlyDelay,black_browser_regex_list:this._blackBrowserRegexList})}},{key:"_report",value:function(){logger$b.print("_report",this.toString()),reportRtcInvokeStatus(this._engineId,"web_join_room_config",this.toString())}}],[{key:"setDefaulConf",value:function(t){var r=t.useTcpAfterJoinTimeout,n=t.joinWithTcpOnly,i=t.joinWithTcpOnlyDelay;return"boolean"==typeof r&&(e.DEFAULT_CONF.useTcpAfterJoinTimeout=r),"boolean"==typeof n&&(e.DEFAULT_CONF.joinWithTcpOnly=n),"number"==typeof i&&(e.DEFAULT_CONF.joinWithTcpOnlyDelay=Math.max(0,i)),e.DEFAULT_CONF}}]),e}();__publicField(_JoinRoomConfig,"DEFAULT_CONF",{useTcpAfterJoinTimeout:!0,joinWithTcpOnly:!1,joinWithTcpOnlyDelay:5e3});var JoinRoomConfig=_JoinRoomConfig,internalAccessDomains="access.rtc.volcvideo.com,access2-hl.rtc.volcvideo.com,rtcg-access.volcvideos.com".split(",");function getFullAccessUrl(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return/^https?:\/\/.+/.test(e)||(e="https://".concat(e)),"".concat(e,"/dispatch/v1/AccessInfo?Action=GetAccessInfo")}function getFullLogServerUrl(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return/^https?:\/\/.+/.test(e)||(e="https://".concat(e)),"".concat(e,"/video/v1/webrtc_log/")}var domesticLogServerUrl="https://web-log-report.rtc.volcvideo.com/video/v1/webrtc_log/",overseasLogServerUrl="https://web-log-report.volcvideos.com/video/v1/webrtc_log/",configDomains="common.rtc.volcvideo.com,rtcg.volcvideos.com".split(","),Config2={VERSION:"4.58.1",ICE_CONFIG_REQUEST_URLS_INTERNAL:internalAccessDomains.map(getFullAccessUrl),ICE_CONFIG_REQUEST_URLS:[],EXPECTED_ADDR:"",LOG_SERVER_URL:domesticLogServerUrl,CONFIG_REQUEST_DOMAINS:configDomains,DEVICE_ID:"",OVERSEA:!1,PLATFORM:"",PRODUCT:"",FORCE_ENABLED_REPORT_CALLBACKS:[],SKIP_WEB_AUDIO_IN_TRACK:!1,AUDIO_STALL:!0,VIDEO_STALL:!0,VIDEO_STALL_100MS:!1,STATS_SCALLBACK_SUPPORT:!0,JOIN_ROOM_CONFIG:JoinRoomConfig.DEFAULT_CONF,SIGNAL_COMPRESSION:!0,SIGNAL_CROP_JOINROOM:!0,VIDEO_STALL_DATA:500,AUDIO_STALL_DATA:200,IOS_SAFARI_ORIENTATION:!1};function setParameter(e,t){if(reportGlobalApiCall("setParameter",0,"key: ".concat(e,", value: ").concat(t)),"VERSION"!==e){if("JOIN_ROOM_CONFIG"===e)return JoinRoomConfig.setDefaulConf(t);if("ICE_CONFIG_REQUEST_URLS"!==e)if("VIDEO_STALL_DATA"!==e)if("AUDIO_STALL_DATA"!==e)if("VIDEO_STALL_100MS"!==e)if("PLATFORM"!==e||"string"!=typeof t)if("PRODUCT"!==e||"string"!=typeof t)if("FORCE_ENABLED_REPORT_CALLBACKS"!==e){if("LOG_SERVER_URL"===e){var r=t===LogChannel.overseas?overseasLogServerUrl:t===LogChannel.domestic?domesticLogServerUrl:"string"==typeof t?t:void 0;r&&(Config2.LOG_SERVER_URL=r,setReportUrl(r))}else if("OVERSEA"===e)return setGlobalStats({extra_is_oversea:t?"1":"0"}),void(Config2.OVERSEA=t);"CONFIG_REQUEST_DOMAINS"===e&&Array.isArray(t)&&t.length>0?Config2.CONFIG_REQUEST_DOMAINS=t:("DEVICE_ID"===e&&sdkCache.setDeviceId(t),CoreConfig.getKeys().includes(e)?CoreConfig.setParameter(e,t):Config2[e]=t)}else{var n="string"==typeof t?[t]:t;Config2.FORCE_ENABLED_REPORT_CALLBACKS=n}else setGlobalStats({product:t});else setGlobalStats({platform:t});else Config2.VIDEO_STALL_100MS=isSupportVideoFrameCallback&&!!t;else Config2.AUDIO_STALL_DATA=Math.max(200,Number(t));else Config2.VIDEO_STALL_DATA=Math.max(500,Number(t));else{var i="string"==typeof t?[t]:t;Config2.ICE_CONFIG_REQUEST_URLS=i.map(getFullAccessUrl)}}}function getParameter(e){return"DEVICE_ID"===e?sdkCache.getDeviceId():Config2[e]}function getPublicStreamControlMessage(e,t,r){var n,i,o,a,s,c,u,l,d;return{type:"publicstream",action:t,publicStreamID:e,publicStreamMeta:{audio:{},video:{fps:(null==(n=r.video)?void 0:n.fps)||15,bitrate:1e3*((null==(i=r.video)?void 0:i.kBitRate)||40),width:(null==(o=r.video)?void 0:o.width)||640,height:(null==(a=r.video)?void 0:a.height)||360},layout:{layoutMode:2,interpolationMode:(null==(s=r.layout)?void 0:s.interpolationMode)||PublicInterpolationMode.PREV_FRAME,canvas:{bgColor:(null==(c=r.layout)?void 0:c.backgroundColor)||"#000000",bgImage:(null==(u=r.layout)?void 0:u.backgroundImage)||""},regions:(null==(d=null==(l=r.layout)?void 0:l.regions)?void 0:d.map((function(e){return{roomId:e.roomId,userId:e.userId,alterImage:e.alertImage||"",alpha:!e.alpha||Number(e.alpha)>1||Number(e.alpha)<=0?1:Number(e.alpha),x:!e.x||Number(e.x)>=1||Number(e.x)<0?0:Number(e.x),y:!e.y||Number(e.y)>=1||Number(e.y)<0?0:Number(e.y),w:!e.w||Number(e.w)>1||Number(e.w)<=0?1:Number(e.w),h:!e.h||Number(e.h)>1||Number(e.h)<=0?1:Number(e.h),zorder:!e.zorder||Number(e.zorder)<0||Number(e.zorder)>100?0:Number(e.zorder),renderMode:void 0===e.renderMode?1:e.renderMode,streamType:e.isScreenStream?1:0,mediaType:e.mediaType||0,sourceCrop:e.sourceCrop}})))||[]}}}}var videoEncoderAutoConfigList=[];function getVideoEncoderAutoConfigList(){return videoEncoderAutoConfigList}function _setVideoEncoderAutoConfigList(e){videoEncoderAutoConfigList=e}var defaultVideoEncoderConfig={width:640,height:480,frameRate:15,maxKbps:600},defaultScreenEncoderConfig={width:1920,height:1080,frameRate:15,maxKbps:3e3};function checkBoolean(e,t){if("boolean"!=typeof e)throw new SDKError(ErrorCode.INVALID_PARAMS,"Invalid ".concat(t,": The value should be boolean type."))}function checkNumber(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.POSITIVE_INFINITY;if(e<r||e>n||"number"!=typeof e)throw new SDKError(ErrorCode.INVALID_PARAMS,"Invalid ".concat(t,": the value range is [").concat(r,", ").concat(n,"]. integer only"))}function checkString(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.POSITIVE_INFINITY;if(null==e)throw new SDKError(ErrorCode.INVALID_PARAMS,"".concat(t," cannot be empty"));if(!isValidString(e,r,n))throw new SDKError(ErrorCode.INVALID_PARAMS,"Invalid ".concat(t,": The value should be string type. Length of the string: [").concat(r,",").concat(n,"]"))}function checkEnum(e,t,r){if(!r.includes(e))throw new SDKError(ErrorCode.INVALID_PARAMS,"Invalid ".concat(t,": The value can only be set as ").concat(JSON.stringify(r)))}function checkMediaStreamTrack(e){if(!(e instanceof MediaStreamTrack))throw new SDKError(ErrorCode.INVALID_PARAMS,"Invalid track, The value should be MediaStreamTrack type.")}function checkEmpty(e,t){if(isEmpty(e))throw new SDKError(ErrorCode.INVALID_PARAMS,"Invalid ".concat(t,", should not be empty"))}function checkArrayBuffer(e,t){if(!(e instanceof ArrayBuffer))throw new SDKError(ErrorCode.INVALID_PARAMS,"Invalid ".concat(t,", should be ArrayBuffer"))}function checkSupportedConstraints(e){try{for(var t=navigator.mediaDevices.getSupportedConstraints(),r=0,n=Object.keys(e);r<n.length;r++){var i=n[r];t[i]||delete e[i]}}catch(o){}}function isValidString(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return"string"==typeof e&&e.length<=r&&e.length>=t}function isEmpty(e){return null==e}function checkRoomId(e){if("string"!=typeof e||!/^[a-zA-Z0-9@._\-]{1,128}$/.test(e))throw new SDKError(ErrorCode.INVALID_PARAMS,"The RoomId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function checkUserId(e){if("string"!=typeof e||!/^[a-zA-Z0-9@._\-]{1,128}$/.test(e))throw new SDKError(ErrorCode.INVALID_PARAMS,"The userId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function checkPublicStreamId(e){if("string"!=typeof e||!/^[a-zA-Z0-9@._\-]{1,128}$/.test(e))throw new SDKError(ErrorCode.INVALID_PARAMS,"The publicStreamId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function illegalBusinessId(e){return"string"!=typeof e}function checkUserInfo(e){checkEmpty(e,"userInfo"),checkUserId(e.userId),isEmpty(e.extraInfo)||checkString(e.extraInfo,"userInfo.extraInfo",1,200)}function checkRoomConfig(e){checkEmpty(e,"roomConfig"),checkBoolean(e.isAutoPublish,"roomConfig.isAutoPublish"),checkBoolean(e.isAutoSubscribeAudio,"roomConfig.isAutoSubscribeAudio"),checkBoolean(e.isAutoSubscribeVideo,"roomConfig.isAutoSubscribeVideo"),isEmpty(e.roomProfileType)||checkEnum(e.roomProfileType,"roomConfig",[RoomProfileType.communication,RoomProfileType.chat,RoomProfileType.chatRoom,RoomProfileType.coHost,RoomProfileType.meeting,RoomProfileType.classRoom])}function checkVideoPlayerOption(e){checkEmpty(e,"videoPlayerOption")}function checkBufferSize(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64;if(!e||0===(null==e?void 0:e.byteLength))throw new SDKError(ErrorCode.INVALID_PARAMS,"The message cannot be empty");if((null==(t=e instanceof ArrayBuffer?e:Utils.str2ab(JSON.stringify(e)))?void 0:t.byteLength)>1e3*r)throw new SDKError(ErrorCode.INVALID_PARAMS,"The message length must be less than ".concat(r,"K"))}function isReportCallback(e){var t=getParameter("FORCE_ENABLED_REPORT_CALLBACKS");return!!(null==t?void 0:t.includes(e))||![EngineEventsTypes.onRemoteStreamStats,EngineEventsTypes.onLocalStreamStats,EngineEventsTypes.onAudioVolumeIndication,EngineEventsTypes.onLocalAudioPropertiesReport,EngineEventsTypes.onRemoteAudioPropertiesReport].includes(e)}function checkRemoteConfig(e){if("number"!=typeof(null==e?void 0:e.width)||"number"!=typeof(null==e?void 0:e.height))throw new SDKError(ErrorCode.INVALID_PARAMS,"remoteVideoConfig must contain width, height, frameRate")}function checkConstrainULongg(e,t){if("number"!=typeof e||Number.isNaN(e)||!(e>=1)){var r=e;if(!((null==r?void 0:r.min)||(null==r?void 0:r.max)||(null==r?void 0:r.exact)||(null==r?void 0:r.ideal)))throw new SDKError(ErrorCode.INVALID_PARAMS,"".concat(t," is not a valid ConstrainULong"))}}function checkVideoEncoderConfig(e){var t,r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;checkNumber(null==n?void 0:n.maxKbps,"maxKbps"),checkConstrainULongg(null==n?void 0:n.width,"width"),checkConstrainULongg(null==n?void 0:n.height,"height"),checkConstrainULongg(null==n?void 0:n.frameRate,"frameRate")}}catch(err2){r.e(err2)}finally{r.f()}}function numberRangeGuide(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.NEGATIVE_INFINITY,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.POSITIVE_INFINITY;return checkNumber(e,t,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),(e=e>r?e:r)<n?e:n}var eventemitter3={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,n,o,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,o||e,a),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,a=new Array(o);i<o;i++)a[i]=n[i].fn;return a},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,i,o,a){var s=r?r+e:e;if(!this._events[s])return!1;var c,u,l=this._events[s],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,i),!0;case 5:return l.fn.call(l.context,t,n,i,o),!0;case 6:return l.fn.call(l.context,t,n,i,o,a),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,_=l.length;for(u=0;u<_;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,n);break;case 4:l[u].fn.call(l[u].context,t,n,i);break;default:if(!c)for(p=1,c=new Array(d-1);p<d;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},s.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||a(this,o);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==t||i&&!s[c].once||n&&s[c].context!==n)&&u.push(s[c]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}(eventemitter3);var eventemitter3Exports=eventemitter3.exports,EventEmitter2=getDefaultExportFromCjs(eventemitter3Exports),logger$a=new Logger$1$1("VERTC",0),EnhancedEventEmitter=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"safeEmit",value:function(e){var t=this.listenerCount(e);try{for(var n,i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return(n=_get(_getPrototypeOf(r.prototype),"emit",this)).call.apply(n,[this,e].concat(o))}catch(s){return logger$a.error("safeEmit","safeEmit() | event listener threw an error [event:%s]:%o",e,s),console.error(s),Boolean(t)}}}]),r}(eventemitter3Exports.EventEmitter),simulcastFormats=[{maxLayers:3,totalPixels:2073600},{maxLayers:3,totalPixels:921600},{maxLayers:3,totalPixels:518400},{maxLayers:2,totalPixels:230400},{maxLayers:2,totalPixels:129600},{maxLayers:1,totalPixels:57600},{maxLayers:1,totalPixels:0}];function getSimulcastLayers(e){for(var t=0,r=e.width*e.height,n=0;n<simulcastFormats.length;n++)if(r>=simulcastFormats[n].totalPixels){t=n;break}if(0===t)return simulcastFormats[t].maxLayers;var i=simulcastFormats[t-1].totalPixels;return(i-r)/(i-simulcastFormats[t].totalPixels)<.1?simulcastFormats[t-1].maxLayers:simulcastFormats[t].maxLayers}function fillSimulcastLayers(e,t){var r=[];if(t<=1)return r;var n=Math.min(e.width,e.height)/90;return r.push({scaleResolutionDownBy:n,width:Math.floor(e.width/n),height:Math.floor(e.height/n),maxkbps:100,frameRate:10}),t<=2||r.unshift({scaleResolutionDownBy:2,width:Math.floor(e.width/2),height:Math.floor(e.height/2),maxkbps:Math.floor(e.maxKbps/2),frameRate:e.frameRate>=30?Math.floor(e.frameRate/2):e.frameRate}),r}var isSupported$1=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,e.t0=!(isSSR()||!window.RTCPeerConnection||!window.RTCPeerConnection.prototype.addTransceiver||!window.RTCPeerConnection.prototype.createDataChannel),!e.t0){e.next=11;break}return e.next=5,isH264DecodeSupported();case 5:if(e.t1=e.sent,!e.t1){e.next=10;break}return e.next=9,isH264EncodeSupported();case 9:e.t1=e.sent;case 10:e.t0=e.t1;case 11:return e.abrupt("return",e.t0);case 14:return e.prev=14,e.t2=e.catch(0),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(){return e.apply(this,arguments)}}(),internalGetSupportedCodecs=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,isH264DecodeSupported();case 3:if(e.t0=e.sent,!e.t0){e.next=8;break}return e.next=7,isH264EncodeSupported();case 7:e.t0=e.sent;case 8:if(e.t1=e.t0,!e.t1){e.next=11;break}t.push("H264");case 11:return e.next=13,isVP8DecodeSupported();case 13:if(e.t2=e.sent,!e.t2){e.next=18;break}return e.next=17,isVP8EncodeSupported();case 17:e.t2=e.sent;case 18:if(e.t3=e.t2,!e.t3){e.next=21;break}t.push("vp8");case 21:return e.abrupt("return",t);case 22:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getSupportedCodecs=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,internalGetSupportedCodecs();case 2:return e.abrupt("return",e.sent.map((function(e){return e.toUpperCase()})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),codecsSupportMap={};function supportH264(e){if(["level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f","profile-level-id=42e01f;level-asymmetry-allowed=1;packetization-mode=1","packetization-mode=1;profile-level-id=42e01f;level-asymmetry-allowed=1"].find((function(t){return null==e?void 0:e.includes(t)}))){for(var t=navigator.userAgent.toLowerCase(),r=!1,n=0,i=[/miuibrowser/,/70.*HeyTapBrowser/i];n<i.length;n++){i[n].test(t)&&(r=!0)}return!r}return!1}var createOfferSdp=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new RTCPeerConnection({sdpSemantics:"unified-plan"})).addTransceiver("video",{direction:t}),e.next=4,r.createOffer();case 4:return n=e.sent,e.abrupt("return",(r.close(),n.sdp.toLowerCase()));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),checkCodecsEncodeSupport=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,createOfferSdp("sendonly");case 2:if(t=e.sent,e.t0=navigator.userAgent.includes("VivoBrowser"),!e.t0){e.next=8;break}return e.next=7,createOfferSdp("sendonly");case 7:t=e.sent;case 8:return codecsSupportMap.h264encode=supportH264(t),codecsSupportMap.vp8encode=t.indexOf("vp8")>-1,e.abrupt("return",codecsSupportMap);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),checkCodecsDecodeSupport=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,createOfferSdp("recvonly");case 2:if(t=e.sent,e.t0=navigator.userAgent.includes("VivoBrowser"),!e.t0){e.next=8;break}return e.next=7,createOfferSdp("recvonly");case 7:t=e.sent;case 8:return codecsSupportMap.h264decode=supportH264(t),codecsSupportMap.vp8decode=t.indexOf("vp8")>-1,e.abrupt("return",codecsSupportMap);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),isH264EncodeSupported=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==codecsSupportMap.h264encode){e.next=9;break}return e.prev=1,e.next=4,checkCodecsEncodeSupport();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",!1);case 9:return e.abrupt("return",codecsSupportMap.h264encode||!1);case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(){return e.apply(this,arguments)}}(),isH264DecodeSupported=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==codecsSupportMap.h264decode){e.next=9;break}return e.prev=1,e.next=4,checkCodecsDecodeSupport();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",!1);case 9:return e.abrupt("return",codecsSupportMap.h264decode||!1);case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(){return e.apply(this,arguments)}}(),isVP8EncodeSupported=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==codecsSupportMap.vp8encode){e.next=9;break}return e.prev=1,e.next=4,checkCodecsEncodeSupport();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",!1);case 9:return e.abrupt("return",codecsSupportMap.vp8encode||!1);case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(){return e.apply(this,arguments)}}(),isVP8DecodeSupported=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==codecsSupportMap.vp8decode){e.next=9;break}return e.prev=1,e.next=4,checkCodecsDecodeSupport();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",!1);case 9:return e.abrupt("return",codecsSupportMap.vp8decode||!1);case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(){return e.apply(this,arguments)}}(),isEncodedTransformSupported=function(){return"undefined"!=typeof TransformStream&&"undefined"!=typeof RTCRtpSender&&"undefined"!=typeof RTCRtpReceiver&&void 0!==RTCRtpSender.prototype.createEncodedStreams&&void 0!==RTCRtpReceiver.prototype.createEncodedStreams},isWebAudioSupported=function(){return isMac?isChrome&&chromeVersion>=70||isFirefox&&firefoxVersion>=80||isSafari&&safariVersion>=14:isWindows?isChrome&&chromeVersion>=70||isFirefox&&firefoxVersion>=80:isIOS?iOSVersion[0]>=14:!!isAndroid&&isChrome&&chromeVersion>=86},isStatsCallbackSupport=isChrome&&chromeVersion<=114,isTransportCCSupport=!isFirefox||firefoxVersion>=96,isRRTRSupported=!(isSafari&&safariVersion<=14),STATS_CACHE=new Map,getExtraChromeStatsReport=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var n=getParameter("STATS_SCALLBACK_SUPPORT");if(isChrome&&void 0===window.InstallTrigger&&isStatsCallbackSupport&&n)try{t.getStats((function(t){var r=[];t.result().forEach((function(e){if(!stasType.includes(e.type)){var t={};e.names().forEach((function(r){t[r]=e.stat(r)})),r.push(_objectSpread2(_objectSpread2({},t),{},{id:e.id,type:e.type,timestamp:e.timestamp}))}})),e({all:r,getTrackStats:function(e){return r.filter((function(t){return"ssrc"!==t.type||t.googTrackId===e}))}})}))}catch(i){r(i)}else e({all:[],getTrackStats:function(){return[]}})})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getAllStatsReport=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getStats();case 2:return o=e.sent,a={all:[]},s=new Map,o.forEach((function(e){var t=s.get(e.type)||new Map;t.set(e.id,e),s.set(e.type,t),a.all.push(e)})),c=function(e,t){e.forEach((function(e){var r,n,i,o,a,c,u,l,d,p,_=e.codecId,h=e.transportId,f=e.trackId,m=e.playoutId;if(null==(r=s.get(RTCStatsType.codec))||r.forEach((function(e){e.id===_&&t.add(e)})),null==(n=s.get(RTCStatsType.transport))||n.forEach((function(e){e.id===h&&(d=e,t.add(e))})),null==(i=s.get(RTCStatsType.track))||i.forEach((function(e){e.id===f&&t.add(e)})),null==(o=s.get(RTCStatsType.mediaPlayout))||o.forEach((function(e){e.id===m&&t.add(e)})),d){var g=d,v=g.localCertificateId,y=g.remoteCertificateId,S=g.selectedCandidatePairId;null==(a=s.get(RTCStatsType.certificate))||a.forEach((function(e){(e.id===v||e.id===y)&&t.add(e)})),null==(c=s.get(RTCStatsType.candidatePair))||c.forEach((function(e){e.id===S&&(p=e,t.add(e))}))}if(p){var E=p,T=E.localCandidateId,b=E.remoteCandidateId;null==(u=s.get(RTCStatsType.localCandidate))||u.forEach((function(e){e.id===T&&t.add(e)})),null==(l=s.get(RTCStatsType.remoteCandidate))||l.forEach((function(e){e.id===b&&t.add(e)}))}}))},e.abrupt("return",(s.get(RTCStatsType.mediaSource)?null==(r=s.get(RTCStatsType.mediaSource))||r.forEach((function(e){var t,r=new Set;r.add(e);var n=[];null==(t=s.get(RTCStatsType.outboundRtp))||t.forEach((function(t){var i;t.mediaSourceId===e.id&&(r.add(t),n.push(t),null==(i=s.get(RTCStatsType.remoteInboundRtp))||i.forEach((function(e){e.localId===t.id&&r.add(e)})))})),c(n,r),a[e.trackIdentifier]=Array.from(r)})):s.get(RTCStatsType.track)&&(null==(n=s.get(RTCStatsType.track))||n.forEach((function(e){var t,r=new Set;r.add(e);var n=[];null==(t=s.get(RTCStatsType.outboundRtp))||t.forEach((function(t){var i;t.trackId===e.id&&(r.add(t),n.push(t),null==(i=s.get(RTCStatsType.remoteInboundRtp))||i.forEach((function(e){e.localId===t.id&&r.add(e)})))})),c(n,r),a[e.trackIdentifier]=Array.from(r)}))),null==(i=s.get(RTCStatsType.inboundRtp))||i.forEach((function(e){var t,r,n=new Set;n.add(e),null==(t=s.get(RTCStatsType.remoteOutboundRtp))||t.forEach((function(t){t.localId===e.id&&n.add(t)})),c([e],n);var i=e.trackIdentifier;i||null==(r=s.get(RTCStatsType.track))||r.forEach((function(t){t.id===e.trackId&&(i=t.trackIdentifier)})),a[i]=Array.from(n)})),a));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getStats$1=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,o,a,s,c,u;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null==r?void 0:r.id,t instanceof RTCPeerConnection){e.next=3;break}return e.abrupt("return",[]);case 3:if(!isFirefox&&!isSafari){e.next=14;break}return o=[],e.prev=5,e.next=8,t.getStats(r);case 8:e.sent.forEach((function(e){o.push(e)})),e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:return e.abrupt("return",o);case 14:return(!(a=STATS_CACHE.get(t))||Date.now()-a.timestamp>150)&&(a={timestamp:Date.now(),statsPromise:getAllStatsReport(t),extraStatsPromise:getExtraChromeStatsReport(t)},STATS_CACHE.set(t,a)),e.next=18,a.statsPromise;case 18:if(s=e.sent,c=(i?s[i]:s.all)||[],n){e.next=25;break}return e.next=23,a.extraStatsPromise;case 23:u=e.sent,c=c.concat((i?u.getTrackStats(i):u.all)||[]);case 25:return e.abrupt("return",c);case 26:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t,r,n){return e.apply(this,arguments)}}(),RTCStatsType=function(e){return e.codec="codec",e.inboundRtp="inbound-rtp",e.outboundRtp="outbound-rtp",e.remoteInboundRtp="remote-inbound-rtp",e.remoteOutboundRtp="remote-outbound-rtp",e.mediaSource="media-source",e.csrc="csrc",e.peerConnection="peer-connection",e.dataChannel="data-channel",e.stream="stream",e.track="track",e.transceiver="transceiver",e.sender="sender",e.receiver="receiver",e.transport="transport",e.sctpTransport="sctp-transport",e.candidatePair="candidate-pair",e.localCandidate="local-candidate",e.remoteCandidate="remote-candidate",e.certificate="certificate",e.iceServer="ice-server",e.mediaPlayout="media-playout",e}(RTCStatsType||{}),stasType=["codec","inbound-rtp","outbound-rtp","remote-inbound-rtp","remote-outbound-rtp","media-source","csrc","peer-connection","data-channel","stream","track","transceiver","sender","receiver","transport","sctp-transport","candidate-pair","local-candidate","remote-candidate","certificate","ice-server"],AudioMixingDualMonoMode=function(e){return e[e.AUTO=0]="AUTO",e[e.MODE_L=1]="MODE_L",e[e.MODE_R=2]="MODE_R",e[e.MODE_MIX=3]="MODE_MIX",e}(AudioMixingDualMonoMode||{}),AudioMixingType=function(e){return e[e.PLAYOUT=0]="PLAYOUT",e[e.PUBLISH=1]="PUBLISH",e[e.PLAYOUT_AND_PUBLISH=2]="PLAYOUT_AND_PUBLISH",e}(AudioMixingType||{}),AudioMixingState=function(e){return e[e.AUDIO_MIXING_STATE_PRELOADED=0]="AUDIO_MIXING_STATE_PRELOADED",e[e.AUDIO_MIXING_STATE_PLAYING=1]="AUDIO_MIXING_STATE_PLAYING",e[e.AUDIO_MIXING_STATE_PAUSED=2]="AUDIO_MIXING_STATE_PAUSED",e[e.AUDIO_MIXING_STATE_STOPPED=3]="AUDIO_MIXING_STATE_STOPPED",e[e.AUDIO_MIXING_STATE_FAILED=4]="AUDIO_MIXING_STATE_FAILED",e[e.AUDIO_MIXING_STATE_FINISHED=5]="AUDIO_MIXING_STATE_FINISHED",e[e.AUDIO_MIXING_STATE_PCM_ENABLED=6]="AUDIO_MIXING_STATE_PCM_ENABLED",e[e.AUDIO_MIXING_STATE_PCM_DISABLED=7]="AUDIO_MIXING_STATE_PCM_DISABLED",e}(AudioMixingState||{}),lib$1={},parser$1={},grammar$2={exports:{}},grammar$1=grammar$2.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(grammar$1).forEach((function(e){grammar$1[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}));var grammarExports=grammar$2.exports;!function(e){var t=function(e){return String(Number(e))===e?Number(e):e},r=function(e,r,n){var i=e.name&&e.names;e.push&&!r[e.push]?r[e.push]=[]:i&&!r[e.name]&&(r[e.name]={});var o=e.push?{}:i?r[e.name]:r;!function(e,r,n,i){if(i&&!n)r[i]=t(e[1]);else for(var o=0;o<n.length;o+=1)null!=e[o+1]&&(r[n[o]]=t(e[o+1]))}(n.match(e.reg),o,e.names,e.name),e.push&&r[e.push].push(o)},n=grammarExports,i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},o=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach((function(e){var t=e[0],i=e.slice(2);"m"===t&&(o.push({rtp:[],fmtp:[]}),a=o[o.length-1]);for(var s=0;s<(n[t]||[]).length;s+=1){var c=n[t][s];if(c.reg.test(i))return r(c,a,i)}})),t.media=o,t};var o=function(e,r){var n=r.split(/=(.+)/,2);return 2===n.length?e[n[0]]=t(n[1]):1===n.length&&r.length>1&&(e[n[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var r=[],n=e.split(" ").map(t),i=0;i<n.length;i+=3)r.push({component:n[i],ip:n[i+1],port:n[i+2]});return r},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var r,n=!1;return"~"!==e[0]?r=t(e):(r=t(e.substring(1,e.length)),n=!0),{scid:r,paused:n}}))}))}}(parser$1);var grammar=grammarExports,formatRegExp=/%[sdv%]/g,format$2=function(e){var t=1,r=arguments,n=r.length;return e.replace(formatRegExp,(function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},makeLine=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var o=t.names[i];t.name?n.push(r[t.name][o]):n.push(r[t.names[i]])}else n.push(r[t.name]);return format$2.apply(null,n)},defaultOuterOrder=["v","o","s","i","u","e","p","c","b","t","r","z","a"],defaultInnerOrder=["i","c","b","a"],writer$1=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||defaultOuterOrder,n=t.innerOrder||defaultInnerOrder,i=[];return r.forEach((function(t){grammar[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(makeLine(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(makeLine(t,r,e))}))}))})),e.media.forEach((function(e){i.push(makeLine("m",grammar.m[0],e)),n.forEach((function(t){grammar[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(makeLine(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(makeLine(t,r,e))}))}))}))})),i.join("\r\n")+"\r\n"},parser=parser$1,writer=writer$1;lib$1.write=writer,lib$1.parse=parser.parse,lib$1.parseParams=parser.parseParams,lib$1.parseFmtpConfig=parser.parseFmtpConfig,lib$1.parsePayloads=parser.parsePayloads,lib$1.parseRemoteCandidates=parser.parseRemoteCandidates,lib$1.parseImageAttributes=parser.parseImageAttributes,lib$1.parseSimulcastStreamList=parser.parseSimulcastStreamList;var logger$9=new Logger$1$1("FirefoxHandler",3),SSRC_MAX=Math.pow(2,32),clientCname="kp34Za0H+aVf862l",serverCname="o/i14u9pJrxRKAsu";function generateAllSsrc(e){return e>SSRC_MAX-18?(logger$9.warn("generateAllSsrc","reset start id",e),generateAllSsrc(e=e-SSRC_MAX+1e4+18)):{audio:e,audioFec:e+1,audioRtx:e+2,video:e+3,videoFec:e+4,videoRtx:e+5,next:e+18}}var generateSsrc=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:serverCname;return[{id:r,attribute:"cname",value:n},{id:r,attribute:"msid",value:"".concat(e," ").concat(e,"-").concat(t)},{id:r,attribute:"mslabel",value:"".concat(e)},{id:r,attribute:"label",value:"".concat(e,"-").concat(t)}]},generateSsrcs=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=t.video,i=t.videoRtx,o=t.videoFec,a=[n,i],s=r.cname,c=r.flexfec;c&&a.push(o);var u=a.reduce((function(t,r){return t.concat(generateSsrc(e,"video",r,s))}),[]),l=[{semantics:"FID",ssrcs:"".concat(n," ").concat(i)}];return c&&l.push({semantics:"FEC-FR",ssrcs:"".concat(n," ").concat(o)}),{ssrcs:u,ssrcGroups:l}};function closeMline(e){return e.direction="inactive",e.port=0,delete e.ext,delete e.ssrcs,delete e.ssrcGroups,delete e.simulcast,delete e.simulcast_03,delete e.rids,delete e.extmapAllowMixed,delete e.bundleOnly,e}var getLocalPartialSdp=function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=_objectSpread2(_objectSpread2({},e),{},{media:[]});return n&&(i.invalid=[{value:"realx-exts:rscp"}]),t&&i.media.push(t),r&&i.media.push(r),delete i.groups,delete i.msidSemantic,lib$1.write(i)};function parseAnswerIceParams(e){return _parseAnswerIceParams.apply(this,arguments)}function _parseAnswerIceParams(){return _parseAnswerIceParams=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n=t.publicIPs,i=t.certFingerprint,o=t.iceParams,a=t.iceConfig,r.fingerprint={type:"sha-256",hash:i},r.icePwd=o.serverIcePwd,e.next=5,getServerUfrag(o.serverIceUfrag);case 5:return r.iceUfrag=e.sent,r.candidates=genCandidates(n,a),r.setup="active",r.iceOptions="renomination",e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)}))),_parseAnswerIceParams.apply(this,arguments)}function genCandidates(e,t){if(!Array.isArray(e))return[];var r=0,n=[];return e.forEach((function(e){var i={component:1,ip:e.ip,type:"host",generation:e.generation};e.udpPorts&&!t.tcpOnly&&e.udpPorts.forEach((function(e){n.push(_objectSpread2(_objectSpread2({},i),{},{foundation:r++,transport:"udp",port:e,priority:2130706431}))})),e.tcpPorts&&e.tcpPorts.forEach((function(e){n.push(_objectSpread2(_objectSpread2({},i),{},{foundation:r++,transport:"tcp",port:e,tcptype:"passive",priority:2130705431}))}))})),n}var getServerUfrag=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(new TextEncoder).encode("PREC"),e.t0=Uint8Array,e.next=4,Utils.b64str2ab(t);case 4:return e.t1=e.sent,n=new e.t0(e.t1),i=new Uint8Array(4),crypto.getRandomValues(i),(o=new Uint8Array(2))[0]=0,o[1]=1,a=concatenate(Uint8Array,r,n,i,o),e.next=13,Utils.ab2b64str(a.buffer);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),setCodecPreferences=function(e,t){var r=0;if(Array.isArray(e.fmtp)&&Array.isArray(e.rtp)){var n,i=_createForOfIteratorHelper(e.fmtp);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(o.config.includes("level-asymmetry-allowed=1")&&o.config.includes("packetization-mode=1")&&o.config.includes("profile-level-id=42e01f")){r=o.payload;break}}}catch(err2){i.e(err2)}finally{i.f()}for(var a=0;a<e.rtp.length;a++){var s=e.rtp[a];if("H264"===t){if(s.payload===r){e.rtp.unshift(e.rtp.splice(a,1)[0]);break}}else if(s.codec===t){e.rtp.unshift(e.rtp.splice(a,1)[0]);break}}var c=[];e.rtp.forEach((function(e){return c.push(e.payload)})),e.payloads=c.join(" ")}},cropSdpMediaSection=function(e){var t=lib$1.parse(e);return t.media=t.media.map((function(e){return"audio"===e.type?cropAudioMediaSection(e,t):cropVideoMediaSection(e,["H264","VP8"],t)})),lib$1.write(t)},pushRRTR=function(e){e.media.forEach((function(e){"audio"!==e.type&&"video"!==e.type||e.rtp.forEach((function(t){e.rtcpFb||(e.rtcpFb=[]),e.rtcpFb.find((function(e){return e.payload===t.payload&&"rrtr"===e.type}))||e.rtcpFb.push({payload:t.payload,type:"rrtr"})}))}))},cropVideoMediaSection=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{rrtr:!1},i={},o={},a=-1,s=[];return Array.isArray(e.fmtp)&&e.fmtp.forEach((function(e){var t=e.payload,r=e.config;if(r.startsWith("apt=")){var n=r.slice(4);i[t]=n}else r.includes("42e01f")&&r.includes("packetization-mode=1")&&(a=t)})),Array.isArray(e.rtp)&&(e.rtp=e.rtp.filter((function(e){var r,n=e.codec,c=e.payload;switch(n){case"H264":return r=!1,t.map((function(e){"H264"===e&&c===a&&(o[c]=c,s.push(c),r=!0)})),r;case"rtx":return!!o[i[c]]&&(o[c]=c,!0);case"red":case"ulpfec":case"flexfec-03":return o[c]=c,!0;default:return r=!1,t.map((function(e){e===n&&(o[c]=c,s.push(c),r=!0)})),r}}))),Array.isArray(e.fmtp)&&(e.fmtp=e.fmtp.filter((function(e){return o[e.payload]}))),Array.isArray(e.rtcpFb)?e.rtcpFb=e.rtcpFb.filter((function(e){return o[e.payload]})):e.rtcpFb=[],n.rrtr&&s.forEach((function(t){var r;null==(r=e.rtcpFb)||r.push({payload:t,type:"rrtr"})})),deleteProperty(e,r),Array.isArray(e.ext)&&(e.ext=e.ext.filter((function(e){if("http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"!==e.uri&&"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"!==e.uri&&"http://www.webrtc.org/experiments/rtp-hdrext/color-space"!==e.uri)return e}))),"string"==typeof e.payloads&&(e.payloads=e.payloads.split(" ").filter((function(e){return o[e]})).join(" ")),e},cropAudioMediaSection=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{rrtr:!1},n={};if(Array.isArray(e.rtp)&&(e.rtp=e.rtp.filter((function(e){var t=e.codec,r=e.payload;return("opus"===t||"red"===t)&&(n[r]=r,!0)}))),Array.isArray(e.rtcpFb)||(e.rtcpFb=[]),r.rrtr&&Object.keys(n).forEach((function(t){var r;null==(r=e.rtcpFb)||r.push({payload:Number(t),type:"rrtr"})})),deleteProperty(e,t),"string"==typeof e.payloads){var i=[];e.payloads.split(" ").forEach((function(e){n[e]&&i.push(e)})),e.payloads=i.join(" ")}return e},deleteProperty=function(e,t){e.iceOptions&&delete e.iceOptions,e.icePwd&&(t.icePwd=e.icePwd,delete e.icePwd),e.iceUfrag&&(t.iceUfrag=e.iceUfrag,delete e.iceUfrag),e.fingerprint&&(t.fingerprint=e.fingerprint,delete e.fingerprint)},BasicHandler=function(e){_inherits(n,e);var t,r=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),i=r.call(this),__publicField(_assertThisInitialized(i),"_peerConnection"),__publicField(_assertThisInitialized(i),"_dataChannel"),__publicField(_assertThisInitialized(i),"_context"),__publicField(_assertThisInitialized(i),"peerConnectionMode",0),__publicField(_assertThisInitialized(i),"id"),__publicField(_assertThisInitialized(i),"_monitor"),__publicField(_assertThisInitialized(i),"logger"),__publicField(_assertThisInitialized(i),"_nextSsrc",Math.floor(Math.random()*SSRC_MAX+1e4)),__publicField(_assertThisInitialized(i),"_aSendonlyAnswerTpl"),__publicField(_assertThisInitialized(i),"_vSendonlyAnswerTpl"),__publicField(_assertThisInitialized(i),"_enableSubFlexfec",!1),__publicField(_assertThisInitialized(i),"audioTrack4ff"),__publicField(_assertThisInitialized(i),"setLocalDescription"),__publicField(_assertThisInitialized(i),"setRemoteDescription"),i.peer=t,i.id=e.id,i._monitor=getMonitor(i.id),i.logger=new Logger$1$1("BasicHandler",3,e.id),i._peerConnection=t.getOriginRTCPeerConnection(),i._dataChannel=t.getOriginRTCDataChannel(),i.setLocalDescription=t.setLocalDescription.bind(t),i.setRemoteDescription=t.setRemoteDescription.bind(t),i._context=e,i.peer.on("ontrack",(function(e){i.emit("ontrack",e)})),i}return _createClass(n,[{key:"destroy",value:function(){this.logger.info("destroy",this.peerConnectionId||""),_get(_getPrototypeOf(n.prototype),"removeAllListeners",this).call(this)}},{key:"getTransceivers",value:function(){return this._peerConnection.getTransceivers()}},{key:"getConnectionState",value:function(){return this._peerConnection.connectionState}},{key:"_simulcast",value:function(e,t,r,n,i){var o=[];1===e.videoEncodeConfig.length?(o=fillSimulcastLayers(t,i),this.logger.info("simulcast() ","simulcastLayers: %o",o)):(o=e.videoEncodeConfig.slice(1).slice(1-i).map((function(e){if(e.width>e.height&&t.width<t.height||e.width<e.height&&t.width>t.height){var r=e.width;e.width=e.height,e.height=r}var n=constraints2number(e.width),i=t.width/n;return{width:n,height:Math.floor(t.height/i),scaleResolutionDownBy:i,frameRate:constraints2number(e.frameRate)||15,maxkbps:e.maxKbps||600}})),this.logger.info("simulcast() ","simulcastLayers2: %o",o));var a=[!0];o.forEach((function(e,t){var i,o={maxBitrate:1e3*e.maxkbps,scaleResolutionDownBy:e.scaleResolutionDownBy,rid:"".concat(t+1),maxFramerate:e.frameRate};null==(i=r.sendEncodings)||i.unshift(o),n.push({width:e.width,height:e.height,framerate:e.frameRate,maxkbps:e.maxkbps,rid:"".concat(t+1)}),a.push(!0)})),this._context&&(this._context.activeSimStreams=a)}},{key:"internalPublish",value:function(e){var t,r,n,i,o=e.stream,a=e.videoTrack,s=e.audioTrack,c=e.enableSimulcast,u=e.pubAudio,l=e.pubVideo,d={direction:"sendonly",streams:[o]},p={direction:"sendonly",streams:[o]},_=[],h=[];if(Array.isArray(null==e?void 0:e.videoEncodeConfig)&&e.videoEncodeConfig.length){var f=null==a?void 0:a.preprocessingTrack,m=_objectSpread2({},defaultVideoEncoderConfig);if(f){var g=null==f?void 0:f.getSettings();m={width:Math.floor(g.width),height:Math.floor(g.height),frameRate:Math.floor(g.frameRate)}}"number"!=typeof m.frameRate&&(m.frameRate=30);var v=null==e?void 0:e.videoEncodeConfig[0],y={maxBitrate:1e3*v.maxKbps,rid:"0"};if(e.prevBitrate=v.maxKbps,p.sendEncodings=[y],_.push({width:m.width,height:m.height,framerate:m.frameRate,maxkbps:v.maxKbps,rid:"0"}),c&&(!isFirefox||"VP8"===(null==(r=null==(t=this._context)?void 0:t.serverConfig)?void 0:r.videoCodec))){var S=getSimulcastLayers(m);this.logger.info("simulcast() ","maxLayers: %o",S),S>1&&(this._simulcast(e,_objectSpread2(_objectSpread2({},m),{},{maxKbps:v.maxKbps}),p,_,S),(null==(i=null==(n=this._context)?void 0:n.serverConfig)?void 0:i.simulcastOnDemand)&&(h=_.map((function(e,t){return _objectSpread2(_objectSpread2({},e),{},{video_index:t,sub_index:t})}))))}}this.logger.info("publish videoTransceiverInit videoDescriptions","",p,_);var E=null==s?void 0:s.preprocessingTrack;(null==s?void 0:s.mixType)!==AudioMixingType.PLAYOUT&&(null==s?void 0:s.mixedAudioTrack)&&(E=null==s?void 0:s.mixedAudioTrack),E=u&&E?E:"audio";var T=null==a?void 0:a.preprocessingTrack;T=l&&T?T:"video";try{this._reportRtcInvokeStatus("Handler.internalPublish",JSON.stringify({aTrack:mediaTrackStringify(E),vTrack:mediaTrackStringify(T),audioTransceiverInit:d,videoTransceiverInit:p}))}catch(b){}return{semantics:"unified-plan",videoDescriptions:_,subVideoDescriptions:h,audioTransceiverInit:{track:E,init:d},videoTransceiverInit:{track:T,init:p}}}},{key:"updateMaxBitrate",value:function(e){var t,r,n,i,o;this.logger.info("updateMaxBitrate()");var a=null==(t=e.videoTrack)?void 0:t.preprocessingTrack,s=e.videoTransceiver;if(a&&e.pubVideo&&s){var c=null==(n=null==(r=e.videoEncodeConfig)?void 0:r[0])?void 0:n.maxKbps;if(c){if(c===e.prevBitrate)return void this.logger.warn("updateMaxBitrate()","no change");e.prevBitrate=c}var u=null==(i=s.sender)?void 0:i.getParameters();if(u){u.encodings=null==(o=null==u?void 0:u.encodings)?void 0:o.map((function(t){var r,n=Number(t.rid)||0,i=null==(r=e.videoEncodeConfig[n])?void 0:r.maxKbps;return"number"==typeof i&&(t.maxBitrate=1e3*i),t})),null==s||s.sender.setParameters(u);try{this._reportRtcInvokeStatus("Handler.updateScaleResolutionDownBy",JSON.stringify(u.encodings))}catch(l){}}}else this.logger.warn("updateMaxBitrate()","no pub")}},{key:"getStats",value:function(e,t){return getStats$1(this._peerConnection,e,t)}},{key:"setCurrentDescription",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"createAVMlineAnswerTpl",value:function(e){var t=this,r=lib$1.parse(e);r.media.forEach((function(e){if("audio"===e.type){if("sendonly"===e.direction){var r=null==e?void 0:e.rtp.find((function(e){return"opus"===e.codec}));if(r&&(null==e?void 0:e.fmtp)){var n=null==e?void 0:e.fmtp.find((function(e){return e.payload===r.payload}));n&&t._context&&(n.config+=";stereo=1;sprop-stereo=1")}t._aSendonlyAnswerTpl=e}}else"video"===e.type&&("sendonly"===e.direction&&(t._vSendonlyAnswerTpl=e),Array.isArray(e.rtp)&&e.rtp.forEach((function(e){var r;(null==(r=e.codec)?void 0:r.includes("flexfec"))&&(t._enableSubFlexfec=!0)})))})),isRRTRSupported&&pushRRTR(r)}},{key:"pc",get:function(){return this._peerConnection}},{key:"peerConnectionId",get:function(){return this.peer.getConnectionId()||""}},{key:"addBitrateLimit",value:function(e,t){null==e||e.rtp.forEach((function(r){var n=r.codec,i=r.payload;if(["vp8","h264"].includes(n.toLocaleLowerCase())){var o=e.fmtp.find((function(e){return e.payload===i}));o?o.config=[].concat(_toConsumableArray(o.config.split(";")),["x-google-min-bitrate=100","x-google-start-bitrate=".concat(t)]).join(";"):e.fmtp.push({payload:i,config:"x-google-min-bitrate=100;x-google-start-bitrate=".concat(t)})}}))}},{key:"_report",value:function(e,t,r){var n;null==(n=this._monitor)||n.report(e,_objectSpread2(_objectSpread2({},t),{},{connection_id:this.peer.getConnectionId(),group_connection_id:this.peer.getGroupConnectionId()}),r)}},{key:"_reportRtcInvokeStatus",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0;this._report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:r,stream_id:n,elapse:0},i)}}]),n}(eventemitter3Exports.EventEmitter),DeviceDetector=function(e){_inherits(h,e);var t,r,n,i,o,a,s,c,u,l,d,p,_=_createSuper(h);function h(){var e,t;return _classCallCheck(this,h),e=_.call(this),__publicField(_assertThisInitialized(e),"deviceMap",{audioinput:new Map,audiooutput:new Map,videoinput:new Map}),__publicField(_assertThisInitialized(e),"checkDeviceChangeTimer",null),__publicField(_assertThisInitialized(e),"isSupportedPermissionsQuery",!1),__publicField(_assertThisInitialized(e),"isGrantedMicrophonePermission",!1),__publicField(_assertThisInitialized(e),"isGrantedCameraPermission",!1),e.isSupportedPermissionsQuery=!isSSR()&&!!(null==(t=null==navigator?void 0:navigator.permissions)?void 0:t.query),e._handleDeviceChange=e._handleDeviceChange.bind(_assertThisInitialized(e)),!isSSR()&&e.initListener().then((function(){e.updateDeviceListInSilent()})),e}return _createClass(h,[{key:"refreshDevices",value:(p=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i=this,o=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:"audio",navigator.mediaDevices){e.next=3;break}return e.abrupt("return");case 3:if(!isFirefox){e.next=19;break}if(e.prev=4,"audio"!==t){e.next=11;break}return e.next=8,navigator.mediaDevices.getUserMedia({audio:!0});case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,navigator.mediaDevices.getUserMedia({video:!0});case 13:e.t0=e.sent;case 14:r=e.t0,e.next=19;break;case 17:e.prev=17,e.t1=e.catch(4);case 19:return e.next=21,navigator.mediaDevices.enumerateDevices();case 21:n=e.sent,r&&r.getTracks().forEach((function(e){return e.stop()})),n.forEach((function(e){var t;e.deviceId&&(null==(t=i.deviceMap[e.kind])||t.set(e.deviceId,e))}));case 23:case"end":return e.stop()}}),e,null,[[4,17]])}))),function(){return p.apply(this,arguments)})},{key:"initListener",value:(d=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(null==(t=navigator.mediaDevices)?void 0:t.ondevicechange)&&"function"==typeof(null==(r=navigator.mediaDevices)?void 0:r.addEventListener)?navigator.mediaDevices.addEventListener("devicechange",(function(){o._handleDeviceChange(),setTimeout((function(){o._handleDeviceChange()}),300)})):this.checkDeviceChangeTimer=window.setInterval((function(){o._handleDeviceChange()}),3e3),!this.isSupportedPermissionsQuery){e.next=19;break}return e.prev=1,e.next=4,navigator.permissions.query({name:"microphone"});case 4:n=e.sent,this.isGrantedMicrophonePermission="granted"===n.state,n.addEventListener("change",(function(){o.isGrantedMicrophonePermission="granted"===n.state})),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(1);case 10:return e.prev=10,e.next=13,navigator.permissions.query({name:"camera"});case 13:i=e.sent,this.isGrantedCameraPermission="granted"===i.state,i.addEventListener("change",(function(){o.isGrantedCameraPermission="granted"===i.state})),e.next=19;break;case 17:e.prev=17,e.t1=e.catch(10);case 19:case"end":return e.stop()}}),e,this,[[1,8],[10,17]])}))),function(){return d.apply(this,arguments)})},{key:"_handleDeviceChange",value:(l=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices){e.next=2;break}return e.abrupt("return");case 2:if(e.t0=isFirefox,!e.t0){e.next=7;break}return e.next=6,navigator.mediaDevices.getUserMedia({audio:!0});case 6:t=e.sent;case 7:return e.next=9,navigator.mediaDevices.enumerateDevices();case 9:r=(r=e.sent).filter((function(e){return!!e.deviceId})),t&&t.getTracks().forEach((function(e){return e.stop()})),n=Array.from([].concat(_toConsumableArray(this.deviceMap.audioinput.values()),_toConsumableArray(this.deviceMap.videoinput.values()),_toConsumableArray(this.deviceMap.audiooutput.values()))),(isMobile$1||isIPad)&&!n.length&&r.length&&r.forEach((function(e){var t;null==(t=i.deviceMap[e.kind])||t.set(e.deviceId,e)})),r.forEach((function(e){var t=i.deviceMap[e.kind].get(e.deviceId);i.deviceMap[e.kind].set(e.deviceId,e),t||(e.kind.includes("video")?i.emit(EngineEventsTypes.onVideoDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"active"}):e.kind.includes("audio")&&i.emit(EngineEventsTypes.onAudioDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"active"}))})),n.forEach((function(e){r.find((function(t){return t.deviceId===e.deviceId&&t.kind===e.kind}))||(i.deviceMap[e.kind].delete(e.deviceId),e.kind.includes("video")?i.emit(EngineEventsTypes.onVideoDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"inactive"}):e.kind.includes("audio")&&i.emit(EngineEventsTypes.onAudioDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"inactive"}))}));case 13:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"getUserMedia",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia(t);case 2:return r=e.sent,e.abrupt("return",((null==t?void 0:t.audio)&&(this.isGrantedMicrophonePermission=!0),(null==t?void 0:t.video)&&(this.isGrantedCameraPermission=!0),(null==t?void 0:t.video)?this.refreshDevices("video"):this.refreshDevices("audio"),r));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"checkPermissionsByDevices",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={audio:!1,video:!1},navigator.mediaDevices){e.next=3;break}return e.abrupt("return",t);case 3:return e.next=5,navigator.mediaDevices.enumerateDevices();case 5:return r=e.sent,e.abrupt("return",(t.audio=r.filter((function(e){return"audioinput"===e.kind&&e.label&&e.deviceId})).length>0,t.video=r.filter((function(e){return"videoinput"===e.kind&&e.label&&e.deviceId})).length>0,t));case 7:case"end":return e.stop()}}),e)}))),function(){return c.apply(this,arguments)})},{key:"getPermissions",value:(s=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o,a,s,c=this,u=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.length>0&&void 0!==u[0]?u[0]:{},n=t.audio,i=t.video,o=t.force,n||i||(n=!0,i=!0),a={audio:!1,video:!1},o){e.next=26;break}if(!this.isSupportedPermissionsQuery){e.next=16;break}if(!n||!i){e.next=12;break}if(!this.isGrantedMicrophonePermission||!this.isGrantedCameraPermission){e.next=10;break}return e.abrupt("return",(a.audio=!0,a.video=!0,a));case 10:e.next=14;break;case 12:if(!(n&&this.isGrantedMicrophonePermission||i&&this.isGrantedCameraPermission)){e.next=14;break}return e.abrupt("return",(a.audio=this.isGrantedMicrophonePermission,a.video=this.isGrantedCameraPermission,a));case 14:case 22:e.next=26;break;case 16:return e.next=18,this.checkPermissionsByDevices();case 18:if(s=e.sent,!n||!i){e.next=24;break}if(!s.audio||!s.video){e.next=22;break}return e.abrupt("return",s);case 24:if(!(n&&s.audio||i&&s.video)){e.next=26;break}return e.abrupt("return",s);case 26:if(e.t0=null==(r=navigator.mediaDevices)?void 0:r.getUserMedia,!e.t0){e.next=30;break}return e.next=30,navigator.mediaDevices.getUserMedia({audio:n,video:i}).then((function(e){e&&(e.getTracks().forEach((function(e){return e.stop()})),n&&(a.audio=!0,c.isGrantedMicrophonePermission=!0),i&&(a.video=!0,c.isGrantedCameraPermission=!0))})).catch((function(){}));case 30:if(!n){e.next=35;break}return e.next=33,this.refreshDevices("audio");case 33:e.next=37;break;case 35:return e.next=37,this.refreshDevices("video");case 37:return e.abrupt("return",a);case 38:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"updateDeviceListInSilent",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.isGrantedCameraPermission&&this.isGrantedMicrophonePermission&&this.refreshDevices("audio");case 1:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"enumerateDevices",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions();case 2:return e.next=4,this.refreshDevices();case 4:return e.abrupt("return",Array.from([].concat(_toConsumableArray(this.deviceMap.audioinput.values()),_toConsumableArray(this.deviceMap.videoinput.values()),_toConsumableArray(this.deviceMap.audiooutput.values()))));case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"enumerateAudioCaptureDevices",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions({audio:!0});case 2:return e.next=4,this.refreshDevices();case 4:return e.abrupt("return",Array.from(this.deviceMap.audioinput.values()));case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"enumerateVideoCaptureDevices",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions({video:!0});case 2:return e.next=4,this.refreshDevices("video");case 4:return e.abrupt("return",Array.from(this.deviceMap.videoinput.values()));case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"enumerateAudioPlaybackDevices",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions({audio:!0});case 2:return e.next=4,this.refreshDevices("audio");case 4:return e.abrupt("return",Array.from(this.deviceMap.audiooutput.values()));case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getDeviceById",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices();case 2:return e.abrupt("return",e.sent.find((function(e){return e.deviceId===t})));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),h}(EnhancedEventEmitter),dd$1=new DeviceDetector;!isSSR()&&(window.__rtc_dd__=dd$1);var logger$8=new Logger$1$1("InternalEventBus",1),InternalEvent=function(e){return e.ON_IOS_INTERRUPTION_START="ON_IOS_INTERRUPTION_START",e.ON_IOS_INTERRUPTION_END="ON_IOS_INTERRUPTION_END",e.ON_IOS_LOCAL_TRACK_MUTE="ON_IOS_LOCAL_TRACK_MUTE",e.ON_IOS_LOCAL_TRACK_UNMUTE="ON_IOS_LOCAL_TRACK_UNMUTE",e}(InternalEvent||{}),InternalEventBus=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"emit",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return logger$8.info(e),(t=_get(_getPrototypeOf(r.prototype),"emit",this)).call.apply(t,[this,e].concat(i))}}]),r}(eventemitter3Exports.EventEmitter),internalEventBus=new InternalEventBus,logger$7=new Logger$1$1("AudioContext",1),WebAudioManager=function(){function e(){var t=this;_classCallCheck(this,e),__publicField(this,"_audioContextInstance"),__publicField(this,"_previousState",""),__publicField(this,"_currentState",""),__publicField(this,"_contextStuckAt",0);var r=0;isSSR()||setInterval((function(){if(t._audioContextInstance){var e=t._audioContextInstance.currentTime;t._contextStuckAt?t._contextStuckAt!==e&&(t._contextStuckAt=0,logger$7.info("currentTime resume"),reportGlobalInvokeStatus("currentTime resume","")):e&&r===e&&(t._contextStuckAt=e,logger$7.warn("currentTime stuck",t._contextStuckAt),t._audioContextInstance.suspend(),t._audioContextInstance.resume(),reportGlobalInvokeStatus("AudioContext currentTime stuck",t._contextStuckAt)),r=e}}),3e3)}return _createClass(e,[{key:"getAudioContextInstance",value:function(){var e=this;if(!this._audioContextInstance){var t=window.AudioContext||window.webkitAudioContext;this._audioContextInstance=new t,this._audioContextInstance.onstatechange=function(){var t,r,n;logger$7.warn("state change",null==(t=e._audioContextInstance)?void 0:t.state),e._previousState=e._currentState,e._currentState=(null==(r=e._audioContextInstance)?void 0:r.state)||"","interrupted"===(null==(n=e._audioContextInstance)?void 0:n.state)&&e._audioContextInstance.resume(),(isIOS||isIPad)&&("running"===e._previousState&&"interrupted"===e._currentState&&internalEventBus.emit(InternalEvent.ON_IOS_INTERRUPTION_START),"interrupted"===e._previousState&&"running"===e._currentState&&internalEventBus.emit(InternalEvent.ON_IOS_INTERRUPTION_END))}}return this._audioContextInstance}}]),e}(),AudioLevelFetcher=function(){function e(t){_classCallCheck(this,e),__publicField(this,"_ctx"),__publicField(this,"_analyserNode"),__publicField(this,"_audioSource"),__publicField(this,"currentTrackId"),this.currentTrackId=t.id;var r=audioContextManager.getAudioContextInstance();if(t instanceof MediaStreamTrack){var n=new MediaStream;n.addTrack(t),this._audioSource=r.createMediaStreamSource(n)}else this._audioSource=r.createMediaElementSource(t),this._audioSource.connect(r.destination);var i=r.createAnalyser();this._audioSource.connect(i),this._analyserNode=i,this._ctx=r}var t;return _createClass(e,[{key:"getAudioLevel",value:function(){var e;"suspended"===(null==(e=this._ctx)?void 0:e.state)&&this._ctx.resume();var t=new Uint8Array(2048);this._analyserNode.getByteTimeDomainData(t);var r=0;t.forEach((function(e){return r=Math.max(r,Math.abs(e-128))}));var n=r/128*255;return n>2?n:0}},{key:"resume",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==(t=this._ctx)?void 0:t.resume();case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){this._audioSource.disconnect(),this._analyserNode.disconnect()}}]),e}(),audioContextManager=new WebAudioManager,RTCExtensionType=function(e){return e[e.CAPTURE=0]="CAPTURE",e[e.PRE_PROCESSING=1]="PRE_PROCESSING",e[e.ENCODE=2]="ENCODE",e[e.TRANSFER=3]="TRANSFER",e[e.POST_PROCESSING=4]="POST_PROCESSING",e[e.DECODE=5]="DECODE",e[e.RENDERING=6]="RENDERING",e}(RTCExtensionType||{}),ExtensionManager=function(){function e(t){_classCallCheck(this,e),__publicField(this,"_plugins",new Map),this.id=t}var t;return _createClass(e,[{key:"register",value:function(e){var t=this._plugins.get(e.type)||[];if(t.findIndex((function(t){return t.name===e.name}))>-1)throw new Error("Failed to register ".concat(e.name,": name is repeated."));t.push(e),this._plugins.set(e.type,t)}},{key:"getPluginsByType",value:function(e){return this._plugins.get(e)||[]}},{key:"getPluginByName",value:function(e,t){return(this._plugins.get(e)||[]).find((function(e){return e.name===t}))}},{key:"getPreProcessingTrack",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this._plugins.get(1)||[],n=t.mediaTrack,i=_createForOfIteratorHelper(r),e.prev=3,i.s();case 5:if((o=i.n()).done){e.next=12;break}return a=o.value,e.next=9,a.effect(t,n);case 9:n=e.sent;case 10:e.next=5;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),i.e(e.t0);case 17:return e.prev=17,i.f(),e.finish(17);case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,this,[[3,14,17,20]])}))),function(e){return t.apply(this,arguments)})},{key:"destroy",value:function(){this._plugins.forEach((function(e){e.forEach((function(e){return e.destroy()}))})),this._plugins.clear()}}]),e}(),SourceType=function(e){return e[e.EXTERNAL=0]="EXTERNAL",e[e.INTERNAL=1]="INTERNAL",e}(SourceType||{}),logger$6=new Logger$1$1("VERTC",0),trackStreamMap=new WeakMap,AudioProcessor=function(){function e(){_classCallCheck(this,e),__publicField(this,"_ac"),__publicField(this,"_sourceNode"),__publicField(this,"_gainNode"),__publicField(this,"_destNode"),this._ac=audioContextManager.getAudioContextInstance(),this._gainNode=this._ac.createGain(),this._destNode=this._ac.createMediaStreamDestination(),this._gainNode.connect(this._destNode)}return _createClass(e,[{key:"setVolume",value:function(e){this._gainNode.gain.value=e/100}},{key:"getVolume",value:function(){return Math.round(100*this._gainNode.gain.value)}},{key:"updateInputTrack",value:function(e){this._sourceNode&&(this._sourceNode.mediaStream.getTracks().forEach((function(e){e.stop()})),delete this._sourceNode);var t=new MediaStream;t.addTrack(e),this._sourceNode=this._ac.createMediaStreamSource(t),this._sourceNode.connect(this._gainNode)}},{key:"getOutputTrack",value:function(){return this._destNode.stream.getTracks()[0]}},{key:"destroy",value:function(){var e,t;null==(e=this._sourceNode)||e.mediaStream.getTracks().forEach((function(e){e.stop()})),13!==safariVersion&&this._destNode.stream.getTracks().forEach((function(e){e.stop()})),null==(t=this._sourceNode)||t.disconnect(),this._gainNode.disconnect(),delete this._sourceNode}}]),e}(),Track=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var i;return _classCallCheck(this,r),i=t.call(this),__publicField(_assertThisInitialized(i),"sourceType",1),__publicField(_assertThisInitialized(i),"_originTrack"),__publicField(_assertThisInitialized(i),"_trackId"),__publicField(_assertThisInitialized(i),"_channelCount"),i._trackId=n,i._originTrack=e,i._channelCount=e.getSettings().channelCount,i}return _createClass(r,[{key:"getId",value:function(){return this._trackId}},{key:"channelCount",get:function(){var e;return null!==(e=this._channelCount)&&void 0!==e?e:0}},{key:"originTrack",get:function(){return this._originTrack},set:function(e){this._originTrack=e,this._channelCount=mediaTrack.getSettings().channelCount}},{key:"destroy",value:function(){this._originTrack.stop()}}]),r}(EnhancedEventEmitter),LocalTrack=function(e){_inherits(n,e);var t,r=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),i=r.call(this,e,t),__publicField(_assertThisInitialized(i),"_mediaTrack"),__publicField(_assertThisInitialized(i),"_preProcessingTrack"),__publicField(_assertThisInitialized(i),"_ap"),__publicField(_assertThisInitialized(i),"_extensionManager"),__publicField(_assertThisInitialized(i),"handleTrackEnded",(function(){i.emit("track-ended",_assertThisInitialized(i)),i.close()})),__publicField(_assertThisInitialized(i),"handleMute",(function(){i.emit("track-mute",_assertThisInitialized(i))})),__publicField(_assertThisInitialized(i),"handleUnmute",(function(){i.emit("track-unmute",_assertThisInitialized(i))})),i._initListeners(),i}return _createClass(n,[{key:"withWebAudio",get:function(){return!!this._ap}},{key:"mediaTrack",get:function(){var e;return null!==(e=this._mediaTrack)&&void 0!==e?e:this._originTrack}},{key:"preprocessingTrack",get:function(){var e;return null!==(e=this._preProcessingTrack)&&void 0!==e?e:this.mediaTrack}},{key:"setTrack",value:function(e,t){this._originTrack=e,this._ap&&(this._ap.updateInputTrack(e),this._mediaTrack=this._ap.getOutputTrack()),t&&this.generatePreProcessingTrack(t)}},{key:"generatePreProcessingTrack",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._extensionManager=t,this._preProcessingTrack=void 0,e.prev=1,e.next=4,t.getPreProcessingTrack(this);case 4:(r=e.sent)instanceof MediaStreamTrack&&(this._preProcessingTrack=r),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e){return t.apply(this,arguments)})},{key:"close",value:function(){var e,t;this._originTrack.removeEventListener("ended",this.handleTrackEnded),this._originTrack.removeEventListener("mute",this.handleMute),this._originTrack.removeEventListener("unmute",this.handleUnmute),null==(e=this._preProcessingTrack)||e.stop(),null==(t=this._mediaTrack)||t.stop(),this._ap&&this._ap.destroy(),_get(_getPrototypeOf(n.prototype),"destroy",this).call(this)}},{key:"_initListeners",value:function(){this._originTrack instanceof MediaStreamTrack&&(this._originTrack.addEventListener("ended",this.handleTrackEnded),this._originTrack.addEventListener("mute",this.handleMute),this._originTrack.addEventListener("unmute",this.handleUnmute))}}]),n}(Track),RemoteTrack=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var i;return _classCallCheck(this,r),i=t.call(this,e,n),__publicField(_assertThisInitialized(i),"_mediaTrack"),__publicField(_assertThisInitialized(i),"_ap"),__publicField(_assertThisInitialized(i),"player"),i._originTrack=e,i}return _createClass(r,[{key:"mediaTrack",get:function(){var e;return null!==(e=this._mediaTrack)&&void 0!==e?e:this._originTrack}},{key:"preprocessingTrack",get:function(){return this.mediaTrack}},{key:"withWebAudio",get:function(){return!!this._ap}},{key:"setPlayer",value:function(e){this.player=e}},{key:"close",value:function(){this._ap&&this._ap.destroy()}}]),r}(Track),LocalVideoTrack=function(e){_inherits(n,e);var t,r=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),i=r.call(this,e,t),__publicField(_assertThisInitialized(i),"mediaType","video"),__publicField(_assertThisInitialized(i),"resolution"),__publicField(_assertThisInitialized(i),"dummy",!1),__publicField(_assertThisInitialized(i),"videoPlayer"),i.resolution={width:0,height:0},i}return _createClass(n,[{key:"updateVideoCaptureConfig",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return logger$6.info("updateVideoEncoderConfig","update localVideoTrack: ",t),delete(r=_objectSpread2({},t)).contentHint,isFirefox&&this.streamIndex===StreamIndex.STREAM_INDEX_MAIN&&(r.frameRate={ideal:30,max:30}),e.next=6,this.originTrack.applyConstraints(r);case 6:((n=this.originTrack.getSettings()).width&&n.width!==this.resolution.width||n.height&&n.height!==this.resolution.height)&&(this.resolution={width:n.width,height:n.height},this.emit("resolution-change",this.resolution));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"replaceTrack",value:function(e){this.setTrack(e)}},{key:"setContentHint",value:function(e){"contentHint"in this.originTrack&&["text","motion","detail"].includes(e)&&(this.originTrack.contentHint=e)}}]),n}(LocalTrack),LocalAudioTrack=function(e){_inherits(n,e);var t,r=_createSuper(n);function n(){var e;return _classCallCheck(this,n),e=r.apply(this,arguments),__publicField(_assertThisInitialized(e),"mediaType","audio"),__publicField(_assertThisInitialized(e),"audioCaptureConfig"),__publicField(_assertThisInitialized(e),"mixedAudioTrack"),__publicField(_assertThisInitialized(e),"mixType",AudioMixingType.PLAYOUT_AND_PUBLISH),__publicField(_assertThisInitialized(e),"_audioFetchMap",new Map),__publicField(_assertThisInitialized(e),"notSupportedWebAudio",!1),e}return _createClass(n,[{key:"getAudioLevel",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:AudioReportMode.MICROPHONE,r=t===AudioReportMode.AUDIOMIXING&&this.mixType!==AudioMixingType.PLAYOUT&&null!==(e=this.mixedAudioTrack)&&void 0!==e?e:this.preprocessingTrack,n=this._audioFetchMap.get(t);return n&&n.currentTrackId===r.id||(null==n||n.destroy(),n=new AudioLevelFetcher(r),this._audioFetchMap.set(t,n)),n.getAudioLevel()}},{key:"updateAudioCaptureConfig",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.audioCaptureConfig,!e.t0){e.next=5;break}return logger$6.info("updateAudioCaptureConfig","update localAudioTrack: ",this.audioCaptureConfig),e.next=5,this.originTrack.applyConstraints(this.audioCaptureConfig);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){this._audioFetchMap.forEach((function(e){return e.destroy()})),this._audioFetchMap.clear(),_get(_getPrototypeOf(n.prototype),"close",this).call(this)}},{key:"setVolume",value:function(e){var t,r=!getParameter("SKIP_WEB_AUDIO_IN_TRACK")&&isWebAudioSupported();r||(this.notSupportedWebAudio=!0);var n=!this.withWebAudio&&100!==e;try{r&&n&&(logger$6.print("Create AudioProcess"),this._ap=new AudioProcessor,this._ap.updateInputTrack(this.originTrack),this._mediaTrack=this._ap.getOutputTrack(),this._extensionManager&&this.generatePreProcessingTrack(this._extensionManager))}catch(i){logger$6.print("WebAudio may not supported, quired return"),this.notSupportedWebAudio=!0}this.notSupportedWebAudio||null==(t=this._ap)||t.setVolume(e),r&&n&&this.emit("needReplaceTrack",this)}},{key:"getVolume",value:function(){return this._ap?this._ap.getVolume():100}}]),n}(LocalTrack),RemoteVideoTrack=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),e=t.apply(this,arguments),__publicField(_assertThisInitialized(e),"mediaType","video"),__publicField(_assertThisInitialized(e),"videoPlayer"),e}return _createClass(r)}(RemoteTrack),RemoteAudioTrack=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),e=t.apply(this,arguments),__publicField(_assertThisInitialized(e),"mediaType","audio"),__publicField(_assertThisInitialized(e),"_audioLevelFetcher"),__publicField(_assertThisInitialized(e),"notSupportedWebAudio",!1),e}return _createClass(r,[{key:"getAudioLevel",value:function(){return this._audioLevelFetcher||(this._audioLevelFetcher=new AudioLevelFetcher(this.originTrack)),this._audioLevelFetcher.getAudioLevel()}},{key:"setVolume",value:function(e){var t,r,n=!getParameter("SKIP_WEB_AUDIO_IN_TRACK")&&isWebAudioSupported();n||(this.notSupportedWebAudio=!0);var i=!this.withWebAudio&&100!==e;try{n&&i&&(logger$6.print("Create AudioProcess"),this._ap=new AudioProcessor,this._ap.updateInputTrack(this.originTrack),this._mediaTrack=this._ap.getOutputTrack())}catch(o){logger$6.print("WebAudio may not supported, quite return"),this.notSupportedWebAudio=!0}this.notSupportedWebAudio||null==(t=this._ap)||t.setVolume(e),n&&i&&(this.emit("needReplaceTrack",this),null==(r=this.player)||r.playAudio(this))}},{key:"getVolume",value:function(){return this.notSupportedWebAudio?100:this._ap?this._ap.getVolume():100}},{key:"close",value:function(){var e;null==(e=this._audioLevelFetcher)||e.destroy(),_get(_getPrototypeOf(r.prototype),"close",this).call(this)}}]),r}(RemoteTrack),MicrophoneAudioTrack=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),e=t.apply(this,arguments),__publicField(_assertThisInitialized(e),"streamIndex",StreamIndex.STREAM_INDEX_MAIN),e}return _createClass(r)}(LocalAudioTrack),CameraVideoTrack=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),e=t.apply(this,arguments),__publicField(_assertThisInitialized(e),"streamIndex",StreamIndex.STREAM_INDEX_MAIN),e}return _createClass(r)}(LocalVideoTrack),CustomVideoLocalTrack=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),e=t.apply(this,arguments),__publicField(_assertThisInitialized(e),"streamIndex",StreamIndex.STREAM_INDEX_MAIN),__publicField(_assertThisInitialized(e),"sourceType",0),e}return _createClass(r)}(LocalVideoTrack),CustomAudioLocalTrack=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),e=t.apply(this,arguments),__publicField(_assertThisInitialized(e),"streamIndex",StreamIndex.STREAM_INDEX_MAIN),__publicField(_assertThisInitialized(e),"sourceType",0),e}return _createClass(r)}(LocalAudioTrack),ScreenVideoTrack=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),e=t.apply(this,arguments),__publicField(_assertThisInitialized(e),"streamIndex",StreamIndex.STREAM_INDEX_SCREEN),e}return _createClass(r)}(LocalVideoTrack),ScreenAudioTrack=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),e=t.apply(this,arguments),__publicField(_assertThisInitialized(e),"streamIndex",StreamIndex.STREAM_INDEX_SCREEN),e}return _createClass(r)}(LocalAudioTrack),CustomScreenVideoLocalTrack=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),e=t.apply(this,arguments),__publicField(_assertThisInitialized(e),"streamIndex",StreamIndex.STREAM_INDEX_SCREEN),__publicField(_assertThisInitialized(e),"sourceType",0),e}return _createClass(r)}(LocalVideoTrack),CustomScreenAudioLocalTrack=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),e=t.apply(this,arguments),__publicField(_assertThisInitialized(e),"streamIndex",StreamIndex.STREAM_INDEX_SCREEN),__publicField(_assertThisInitialized(e),"sourceType",0),e}return _createClass(r)}(LocalAudioTrack);function createDummyVideoLocalTrack(e,t){return _createDummyVideoLocalTrack.apply(this,arguments)}function _createDummyVideoLocalTrack(){return _createDummyVideoLocalTrack=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new CameraVideoTrack(t,genUuid())).dummy=!0,e.next=4,n.generatePreProcessingTrack(r);case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)}))),_createDummyVideoLocalTrack.apply(this,arguments)}function createDummyScreenVideoLocalTrack(e,t){return _createDummyScreenVideoLocalTrack.apply(this,arguments)}function _createDummyScreenVideoLocalTrack(){return _createDummyScreenVideoLocalTrack=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new ScreenVideoTrack(t,genUuid())).dummy=!0,e.next=4,n.generatePreProcessingTrack(r);case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)}))),_createDummyScreenVideoLocalTrack.apply(this,arguments)}function createCameraVideoTrack(e,t){return _createCameraVideoTrack.apply(this,arguments)}function _createCameraVideoTrack(){return _createCameraVideoTrack=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(null==(n=t.deviceId)?void 0:n.exact)||"default",a=getMonitor(r.id),e.prev=1,logger$6.info("createCameraVideoTrack","constraints:",t),null==a||a.report("rtc_video_capture_event",{event_type:"start",media_device_id:o}),s=getServerNow(),isFirefox&&(t.frameRate={ideal:30,max:30}),e.next=7,dd$1.getUserMedia({video:t});case 7:i=e.sent,null==a||a.report("rtc_video_capture_event",{event_type:"start_capture_result",media_device_id:o,reason:"success",elapse:getServerNow()-s}),e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(1),null==a||a.report("rtc_video_capture_event",{event_type:"running_failed",media_device_id:o,error_code:e.t0.code,reason:e.t0.name+e.t0.message}),new SDKError(ErrorCode.GET_VIDEO_TRACK_FAILED,"throw error from getUserMedia. [".concat(e.t0.name||"unknown name","]: ").concat(e.t0.message||"unknown message","."),e.t0);case 14:return c=i.getVideoTracks()[0],trackStreamMap.set(c,i),u=new CameraVideoTrack(c,genUuid()),e.next=19,u.generatePreProcessingTrack(r);case 19:return e.abrupt("return",u);case 20:case"end":return e.stop()}}),e,null,[[1,11]])}))),_createCameraVideoTrack.apply(this,arguments)}function createMicrophoneAudioTrack(e,t){return _createMicrophoneAudioTrack.apply(this,arguments)}function _createMicrophoneAudioTrack(){return _createMicrophoneAudioTrack=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return logger$6.info("createMicrophoneAudioTrack","constraints:",t),o=(null==(n=t.deviceId)?void 0:n.exact)||"default",a=getMonitor(r.id),e.prev=2,null==a||a.report("rtc_video_capture_event",{event_type:"start",media_device_id:o}),s=getServerNow(),(c=r.getPluginByName(RTCExtensionType.PRE_PROCESSING,"RTCAIAnsExtension"))&&(c.isOpen()?(t.autoGainControl=!0,t.noiseSuppression=!1):t.noiseSuppression=!0),e.next=8,dd$1.getUserMedia({audio:t});case 8:i=e.sent,null==a||a.report("rtc_video_capture_event",{event_type:"start_capture_result",media_device_id:o,reason:"success",elapse:getServerNow()-s}),e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(2),null==a||a.report("rtc_video_capture_event",{event_type:"running_failed",media_device_id:o,error_code:e.t0.code,reason:e.t0.name+e.t0.message}),new SDKError(ErrorCode.GET_AUDIO_TRACK_FAILED,"throw error from getUserMedia. [".concat(e.t0.name||"unknown name","]: ").concat(e.t0.message||"unknown message","."),e.t0);case 15:return u=i.getAudioTracks()[0],trackStreamMap.set(u,i),l=new MicrophoneAudioTrack(u,genUuid()),e.next=20,l.generatePreProcessingTrack(r);case 20:return e.abrupt("return",l);case 21:case"end":return e.stop()}}),e,null,[[2,12]])}))),_createMicrophoneAudioTrack.apply(this,arguments)}function createMicrophoneAndCameraTrack(e,t,r){return _createMicrophoneAndCameraTrack.apply(this,arguments)}function _createMicrophoneAndCameraTrack(){return _createMicrophoneAndCameraTrack=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,o,a,s,c,u,l,d,p,_,h,f;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return logger$6.print("createCameraAndMicrophoneTrack","audioConstraints:",t,"videoConstraints:",r),a=getMonitor(n.id),c=(null==(i=t.deviceId)?void 0:i.exact)||"default",u=(null==(o=r.deviceId)?void 0:o.exact)||"default",e.prev=3,null==a||a.report("rtc_video_capture_event",{event_type:"start",media_device_id:"".concat(u,", ").concat(c)}),l=getServerNow(),isFirefox&&(r.frameRate={ideal:30,max:30}),(d=n.getPluginByName(RTCExtensionType.PRE_PROCESSING,"RTCAIAnsExtension"))&&(d.isOpen()?(t.autoGainControl=!0,t.noiseSuppression=!1):t.noiseSuppression=!0),e.next=11,dd$1.getUserMedia({audio:t,video:r});case 11:s=e.sent,null==a||a.report("rtc_video_capture_event",{event_type:"start_capture_result",media_device_id:"".concat(u,", ").concat(c),reason:"success",elapse:getServerNow()-l}),e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(3),null==a||a.report("rtc_video_capture_event",{event_type:"running_failed",media_device_id:"".concat(u,", ").concat(c),error_code:e.t0.code,reason:e.t0.name+e.t0.message}),new SDKError(ErrorCode.GET_VIDEO_TRACK_FAILED,"throw error from getUserMedia. [".concat(e.t0.name||"unknown name","]: ").concat(e.t0.message||"unknown message","."),e.t0);case 18:return p=s.getVideoTracks()[0],trackStreamMap.set(p,s),_=new CameraVideoTrack(p,genUuid()),e.next=23,_.generatePreProcessingTrack(n);case 23:return h=s.getAudioTracks()[0],trackStreamMap.set(h,s),f=new MicrophoneAudioTrack(h,genUuid()),e.next=28,f.generatePreProcessingTrack(n);case 28:return e.abrupt("return",{videoTrack:_,audioTrack:f});case 29:case"end":return e.stop()}}),e,null,[[3,15]])}))),_createMicrophoneAndCameraTrack.apply(this,arguments)}function createScreenTracks(){return _createScreenTracks.apply(this,arguments)}function _createScreenTracks(){return _createScreenTracks=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o,a,s,c,u,l,d=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=d.length>0&&void 0!==d[0]&&d[0],r=d.length>1?d[1]:void 0,n=d.length>2?d[2]:void 0,logger$6.info("createScreenTracks","withAudio: %o, constraints: %o",t,n),o=getMonitor(r.id),e.prev=5,null==o||o.report("rtc_video_capture_event",{event_type:"start",media_device_id:"screen"}),a=getServerNow(),e.next=10,navigator.mediaDevices.getDisplayMedia({video:!(n&&(!isSafari||"16.1"!==safariMinorVersion))||n,audio:!!t&&{channelCount:2,noiseSuppression:!1,echoCancellation:!0,autoGainControl:!1}});case 10:i=e.sent,null==o||o.report("rtc_video_capture_event",{event_type:"start_capture_result",media_device_id:"screen",reason:"success",elapse:getServerNow()-a}),e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(5),null==o||o.report("rtc_video_capture_event",{event_type:"running_failed",media_device_id:"screen",error_code:e.t0.code,reason:e.t0.name+e.t0.message}),new SDKError(ErrorCode.GET_SCREEN_TRACK_FAILED,"throw error from getDisplayMedia",e.t0);case 17:return s=i.getVideoTracks()[0],c=new ScreenVideoTrack(s,genUuid()),e.next=20,c.generatePreProcessingTrack(r);case 20:if(!(u=i.getAudioTracks()[0])){e.next=26;break}return l=new ScreenAudioTrack(u,genUuid()),e.next=25,l.generatePreProcessingTrack(r);case 25:return e.abrupt("return",[c,l]);case 26:return e.abrupt("return",[c,void 0]);case 27:case"end":return e.stop()}}),e,null,[[5,14]])}))),_createScreenTracks.apply(this,arguments)}function createRemoteVideoTrack(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:genUuid();return new RemoteVideoTrack(e,t)}function createRemoteAudioTrack(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:genUuid();return new RemoteAudioTrack(e,t)}function createCustomVideoLocalTrack(e,t){return _createCustomVideoLocalTrack.apply(this,arguments)}function _createCustomVideoLocalTrack(){return _createCustomVideoLocalTrack=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new CustomVideoLocalTrack(t,genUuid()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)}))),_createCustomVideoLocalTrack.apply(this,arguments)}function createCustomAudioLocalTrack(e,t){return _createCustomAudioLocalTrack.apply(this,arguments)}function _createCustomAudioLocalTrack(){return _createCustomAudioLocalTrack=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new CustomAudioLocalTrack(t,genUuid()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)}))),_createCustomAudioLocalTrack.apply(this,arguments)}function createCustomScreenVideoLocalTrack(e,t){return _createCustomScreenVideoLocalTrack.apply(this,arguments)}function _createCustomScreenVideoLocalTrack(){return _createCustomScreenVideoLocalTrack=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new CustomScreenVideoLocalTrack(t,genUuid()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)}))),_createCustomScreenVideoLocalTrack.apply(this,arguments)}function createCustomScreenAudioLocalTrack(e,t){return _createCustomScreenAudioLocalTrack.apply(this,arguments)}function _createCustomScreenAudioLocalTrack(){return _createCustomScreenAudioLocalTrack=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new CustomScreenAudioLocalTrack(t,genUuid()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)}))),_createCustomScreenAudioLocalTrack.apply(this,arguments)}var runtimeTrackCls={LocalVideoTrack:LocalVideoTrack,LocalAudioTrack:LocalAudioTrack,RemoteVideoTrack:RemoteVideoTrack,RemoteAudioTrack:RemoteAudioTrack},ExtendMediaType=function(e){return e[e.NONE=0]="NONE",e}(ExtendMediaType||{}),Nalunit={getNalunits:function(e){if(e.length-e.position<4)return[];var t=e.position;return 1===e.getInt32(t)||0===e.getInt16(t)&&1===e.getInt8(t+2)?Nalunit.getAnnexbNals(e):Nalunit.getAvccNals(e)},getAnnexbNals:function(e){for(var t=[],r=Nalunit.getHeaderPositionAnnexB(e),n=r.pos,i=n;n<e.length-4;){var o=new Uint8Array(e.buffer.slice(n,n+r.headerLength));r.pos===e.position&&e.skip(r.headerLength),i=(r=Nalunit.getHeaderPositionAnnexB(e)).pos;var a={header:o,body:new Uint8Array(e.buffer.slice(n+o.byteLength,i)),type:-1};Nalunit.analyseNal(a),a.type<=9&&0!==a.type&&t.push(a),e.skip(i-e.position),n=i}return t},getAvccNals:function(e){for(var t=[];e.position<e.length-4;){var r=e.getInt32(e.position);if(!(e.length-e.position>=r))break;var n=new Uint8Array(e.buffer.slice(e.position,e.position+4));e.skip(4);var i=new Uint8Array(e.buffer.slice(e.position,e.position+r));e.skip(r);var o={header:n,body:i,type:-1};Nalunit.analyseNal(o),o.type<=9&&0!==o.type&&t.push(o)}return t},analyseNal:function(e){var t=31&e.body[0];switch(e.type=t,t){case 1:e.ndr=!0;break;case 5:e.idr=!0;break;case 6:e.sei=!0;break;case 7:e.sps=!0;break;case 8:e.pps=!0}},getHeaderPositionAnnexB:function(e){for(var t=e.position,r=0,n=e.length;3!==r&&4!==r&&t<n-4;)0===e.getInt16(t)?1===e.getInt16(t+2)?r=4:1===e.getInt8(t+2)?r=3:t++:t++;return t===n-4&&(0===e.getInt16(t)?1===e.getInt16(t+2)?r=4:t=n:(t++,0===e.getInt16(t)&&1===e.getInt8(t)?r=3:t=n)),{pos:t,headerLength:r}}},RTCDataView=function(){function e(t){_classCallCheck(this,e),__publicField(this,"_position",0),__publicField(this,"_dataview"),this._dataview=new DataView(t)}return _createClass(e,[{key:"length",get:function(){return this.buffer.byteLength}},{key:"buffer",get:function(){return this._dataview.buffer}},{key:"position",get:function(){return this._position},set:function(e){this._position=e}},{key:"back",value:function(e){this.position-=e}},{key:"getUint8",value:function(e){return this._dataview.getUint8(e)}},{key:"getInt8",value:function(e){return this._dataview.getInt8(e)}},{key:"getInt16",value:function(e){return this._dataview.getInt16(e)}},{key:"getUint16",value:function(e){return this._dataview.getUint16(e)}},{key:"getUint32",value:function(e){return this._dataview.getUint32(e)}},{key:"getInt32",value:function(e){return this._dataview.getInt32(e)}},{key:"skip",value:function(t){for(var r=Math.floor(t/4),n=t%4,i=0;i<r;i++)e.readByte(this,4);n>0&&e.readByte(this,n)}},{key:"readUint8",value:function(){return e.readByte(this,1)}},{key:"readUint16",value:function(){return e.readByte(this,2)}},{key:"readUint24",value:function(){return e.readByte(this,3)}},{key:"readUint32",value:function(){return e.readByte(this,4)}},{key:"readUint64",value:function(){return e.readByte(this,8)}},{key:"readInt8",value:function(){return e.readByte(this,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this,4,!0)}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}}],[{key:"readByte",value:function(e,t,r){var n;switch(t){case 1:n=r?e.getInt8(e.position):e.getUint8(e.position);break;case 2:n=r?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(r)throw new Error("not supported for readByte 3");n=e.getUint8(e.position)<<16,n|=e.getUint8(e.position+1)<<8,n|=e.getUint8(e.position+2);break;case 4:n=r?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(r)throw new Error("not supported for readBody 8");n=e.getUint32(e.position)<<32,n|=e.getUint32(e.position+4);break;default:n=""}return e.position+=t,n}}]),e}(),RTC_SEI_TYPE=function(e){return e[e.internal=0]="internal",e[e.external=1]="external",e[e.bypass=2]="bypass",e}(RTC_SEI_TYPE||{}),UUID_INTERNAL=new Uint8Array([109,167,53,190,103,90,72,1,170,89,63,164,194,199,19,85]),UUID_EXTERNAL=new Uint8Array([109,167,53,190,103,90,72,1,170,89,63,164,194,199,19,84]),rbsp2ebsp=function(e){var t,r=[],n=0,i=_createForOfIteratorHelper(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;n>=2&&o<=3&&(r.push(3),n=0),0===o?n++:n=0,r.push(o)}}catch(err2){i.e(err2)}finally{i.f()}return new Uint8Array(r)},ebsp2rbsp=function(e){for(var t=[],r=0;r<e.length;r++)e[r]<=3&&0===e[r-1]&&0===e[r-2]||t.push(e[r]);return new Uint8Array(t)};function serializeData(e){for(var t=[];e>=255;)e-=255,t.push(255);return t.push(e),new Uint8Array(t)}function deserializeData(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;255===e[t]&&t<e.byteLength;)t++,r+=255;return t<e.byteLength&&(r+=e[t++]),[r,t]}var SEIHelper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"generateSEI",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new Uint8Array([0,0,0,1]),n=new Uint8Array([6]),i=new Uint8Array([5]),o=t?UUID_INTERNAL:UUID_EXTERNAL,a=serializeData(e.byteLength+o.byteLength),s=rbsp2ebsp(e);return new Uint8Array([].concat(_toConsumableArray(r),_toConsumableArray(n),_toConsumableArray(i),_toConsumableArray(a),_toConsumableArray(o),_toConsumableArray(s),[128]))}},{key:"decodeSeiBody",value:function(e){e=e.slice(0,e.length-1);var t=ebsp2rbsp(e);if(!(t.byteLength<2)){var r=0;if(5===t[1]||100===t[1]){var n=_slicedToArray(deserializeData(t,r+=2),2),i=n[0],o=2,a=(r=n[1])+i;return t.byteLength>=UUID_EXTERNAL.byteLength&&i>=UUID_EXTERNAL.byteLength&&t.slice(r,r+UUID_EXTERNAL.byteLength).toString()===UUID_EXTERNAL.toString()?(r+=UUID_EXTERNAL.byteLength,o=1):t.byteLength>=UUID_EXTERNAL.byteLength&&i>=UUID_EXTERNAL.byteLength&&t.slice(r,r+UUID_INTERNAL.byteLength).toString()===UUID_INTERNAL.toString()&&(r+=UUID_INTERNAL.byteLength,o=0),{type:o,payload:t.slice(r,a)}}}}},{key:"parseInternalSEI",value:function(e){var t=new Map,r=0;if(0===e.type){for(;e.payload.byteLength-r>=2;){var n=_slicedToArray(deserializeData(e.payload,r),2),i=n[0];r=n[1];var o=_slicedToArray(deserializeData(e.payload,r),2),a=o[0];if(r=o[1],t.get(i)||!(a<=e.payload.byteLength-r))break;t.set(i,e.payload.slice(r,r+a)),r+=a}return t}}},{key:"makeInternalSei",value:function(e){var t,r=[],n=_createForOfIteratorHelper(e);try{for(n.s();!(t=n.n()).done;){var i=_slicedToArray(t.value,2),o=i[0],a=i[1],s=serializeData(o),c=serializeData(a.byteLength);r.push(s,c,a)}}catch(err2){n.e(err2)}finally{n.f()}var u=r.reduce((function(e,t){return e+t.byteLength}),0),l=new Uint8Array(u);return r.reduce((function(e,t){return l.set(t,e),e+t.byteLength}),0),l}}]),e}(),Stats=function(){function e(t){_classCallCheck(this,e),__publicField(this,"_timer"),__publicField(this,"handler"),__publicField(this,"_monitor"),__publicField(this,"logger"),__publicField(this,"_destroyed",!1),this._context=t,this._monitor=getMonitor(t.id),this.logger=new Logger$1$1("Stats",3,t.id)}return _createClass(e,[{key:"setVar",value:function(e){this.handler=e}},{key:"stopReport",value:function(e){this._timer&&(this.logger.info("stopReport","invoke"),clearTimeout(this._timer),delete this._timer,reportRtcInvokeStatus(this._context.id,"del_media_statistics_timer","reason: ".concat(e,", stack: ").concat((new Error).stack),0,this._stream.streamId||""))}},{key:"filterIllegal",value:function(e){var t={};return Object.keys(e).forEach((function(r){null===e[r]||void 0===e[r]||Number.isNaN(e[r])||(t[r]=e[r])})),t}},{key:"destroy",value:function(){this.logger.info("destroy","invoke"),reportRtcInvokeStatus(this._context.id,"media_statistics_destroy","".concat((new Error).stack),0,"".concat(this._stream.streamId)),this.stopReport("destroy"),this._destroyed=!0}}]),e}(),LocalStatsReport=function(e){_inherits(i,e);var t,r,n=_createSuper(i);function i(e,t){var r;return _classCallCheck(this,i),(r=n.call(this,e))._stream=t,r}return _createClass(i,[{key:"setLocalStreamStatsEvtInterval",value:function(e,t){var r,n,i,o=this;if(!this._timer){this.logger.info("setLocalStreamStatsEvtInterval","invoke"),this.setVar(t),this._destroyed=!1;var a={audio:{},video:{}},s=this._stream,c=null==(r=s.audioTrack)?void 0:r.preprocessingTrack,u=null==(n=s.videoTrack)?void 0:n.preprocessingTrack;this.getAudioStats(c,a,null==(i=s.audioTrack)?void 0:i.getAudioLevel()),this.getVideoStats(u,a);var l=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=null==(t=s.audioTrack)?void 0:t.preprocessingTrack,c=null==(r=s.videoTrack)?void 0:r.preprocessingTrack,e.next=3,o.getAudioStats(i,a,null==(n=s.audioTrack)?void 0:n.getAudioLevel());case 3:return e.t0=e.sent,e.next=6,o.getVideoStats(c,a);case 6:return e.t1=e.sent,e.t2=s.isScreen,e.abrupt("return",{audioStats:e.t0,videoStats:e.t1,isScreen:e.t2});case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),d=function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function t(){var r;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l();case 2:r=t.sent,e(r),o._destroyed||(o._timer=setTimeout(d,2e3));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();this._timer=setTimeout(d,2e3)}}},{key:"getAudioStats",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,o,a,s,c,u,l,d,p,_,h,f,m,g;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a={},s={timestamp:Date.now()},c=this._stream,u=c.streamId,l=c.audioMid,d=c.isScreen,p=c.pubAttributes,_=c.pubAudio,h=c.audioTrack,f={media_type:"audio",is_screen:!!d,direction:"up",stream_id:u,vid:l,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,capture_state:p.localaudio?"capture_state_on":"capture_state_off",mute_state:_?"mute_state_off":"mute_state_on"},h&&(f.playback_volume=h.getVolume()),t&&this.handler){e.next=3;break}return e.abrupt("return",a);case 3:return e.next=5,this.handler.getStats(t);case 5:if((m=e.sent).length){e.next=8;break}return e.abrupt("return",a);case 8:return m.forEach((function(e){var t=e.type,r=e.packetsSent,n=e.packetsLost,i=e.bytesSent,o=e.clockRate,c=e.roundTripTime,u=e.channels,l=e.audioLevel,d=e.mimeType,p=e.availableIncomingBitrate,_=e.availableOutgoingBitrate,h=e.bytesReceived,m=e.nominated,g=e.id,v=e.currentRoundTripTime,y=e.state,S=e.writable,E=e.requestsReceived,T=e.responsesReceived,b=e.requestsSent,R=e.consentRequestsSent,C=e.responsesSent,k=e.jitter,I=e.candidateType,A=e.ip,O=e.address,M=e.networkType,P=e.port,w=e.protocol,D=e.nackCount,N=e.retransmittedBytesSent,x=e.retransmittedPacketsSent,L=e.audioInputLevel,$=e.ssrc,B=e.totalAudioEnergy,U=e.totalSamplesDuration,F=e.mediaType,V=e.fractionLost;"outbound-rtp"===t?(s.packetsSent=r,s.bytesSent=i,f.bytes=i,f.packetsSent=r,f.nackCount=D,f.ssrc=$,f.retransmitted_bytes_sent=N,f.retransmitted_packets_sent=x,s.retransmittedBytesSent=N,s.retransmittedPacketsSent=x):"remote-inbound-rtp"===t?(s.packetsLost=n,f.packetsLost=n,f.net_jitter=1e3*k,a.rtt=1e3*c,f.rtt=a.rtt,a._fractionLost=V||0):"codec"===t?(a.recordSampleRate=o,a.numChannels=u,f.codecName=d):"media-source"===t&&void 0!==l?(f.audio_level=l?-10*Math.log10(Math.pow(l,2)):l,f.volume=255*l,f.total_audio_energy=B,f.totalInputDuration=U):"ssrc"===t&&"audio"===F?f.send_level=L:"candidate-pair"===t?(f.ice_available_incoming_bitrate=p,f.ice_available_outgoing_bitrate=_,f.ice_bytes_received=h,f.ice_bytes_sent=i,f.ice_nominated=Number(m),f.ice_pair_id=g,f.ice_pair_rtt=v,f.ice_pair_state=y,f.ice_pair_writable=S,f.recv_ping_requests=E,f.recv_ping_responses=T,f.sent_ping_requests_before_first_response=b,f.sent_ping_requests_total=b+(R||0),f.sent_ping_responses=C):"local-candidate"===t?(f.local_candidate_type=I,f.local_ip=A||O,f.local_network_type=M,f.local_port=P,f.protocol=w):"remote-candidate"===t&&(f.remote_candidate_type=I,f.remote_ip=A||O,f.remote_port=P);var G=getParameter("STATS_SCALLBACK_SUPPORT");isStatsCallbackSupport&&G||"media-source"===t&&(f.send_level=l)})),void 0===f.volume&&void 0!==n&&(f.volume=n,f.audio_level=n?-10*Math.log10(Math.pow(n/255,2)):n),g=r.audio,e.abrupt("return",g.timestamp?(void 0!==s.packetsLost&&(a.audioLossRate=(s.packetsLost-g.packetsLost)/(s.packetsSent-g.packetsSent),a.audioLossRate=Number.isNaN(a.audioLossRate)?0:a.audioLossRate,f.fraction_lost=a.audioLossRate),a.statsInterval=s.timestamp-g.timestamp,f.stats_interval=a.statsInterval,a.sendKBitrate=(s.bytesSent-g.bytesSent||0)/a.statsInterval*8,f.mediaBitratebps=Math.round(1e3*a.sendKBitrate),f.bandwidth=Math.round(f.mediaBitratebps/1024),void 0!==s.retransmittedBytesSent&&(f.retransmitBitratebps=(s.retransmittedBytesSent-g.retransmittedBytesSent||0)/a.statsInterval),r.audio=s,f.vendor_mode=this._stream.vendorCode||0,f.pc_session_id=null==(i=this.handler)?void 0:i.peerConnectionId,null==(o=this._monitor)||o.report("rtc_media_statistics",f),a._retransmittedRate=(s.retransmittedPacketsSent-g.retransmittedPacketsSent)/(s.packetsSent-g.packetsSent),void 0===a.audioLossRate&&(a.audioLossRate=a._retransmittedRate,f.fraction_lost=a.audioLossRate),a._fractionLost=Math.max(a._fractionLost,a.audioLossRate),this.filterIllegal(a)):(r.audio=s,this.filterIllegal(a)));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"getVideoStats",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s={},c={timestamp:Date.now(),simulcast:{}},u=this._stream,l=u.streamId,d=u.videoMid,p=u.isScreen,_=u.pubAttributes,h=u.enableSimulcast,f=u.pubVideo,m={media_type:"video",is_screen:!!p,direction:"up",stream_id:l,vid:d,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,capture_state:_.localvideo?"capture_state_on":"capture_state_off",mute_state:f?"mute_state_off":"mute_state_on"},t&&this.handler){e.next=3;break}return e.abrupt("return",s);case 3:return m.cap_frame_width=t.getSettings().width,m.cap_frame_height=t.getSettings().height,m.frameRateSent=t.getSettings().frameRate,s.isScreen=p,e.next=6,this.handler.getStats(t);case 6:if((g=e.sent).length){e.next=9;break}return e.abrupt("return",s);case 9:if(v=0,g.forEach((function(e){var t=e.type,n=e.framesEncoded,i=e.packetsLost,o=e.bytesSent,a=e.framesSent,u=e.retransmittedBytesSent,l=e.totalPacketSendDelay,d=e.totalEncodeTime,p=e.firCount,_=e.targetBitrate,f=e.roundTripTime,g=e.mimeType,y=e.frameWidth,S=e.frameHeight,E=e.packetsSent,T=e.googActualEncBitrate,b=e.googAvailableReceiveBandwidth,R=e.googAvailableSendBandwidth,C=e.googAvgEncodeMs,k=e.googBucketDelay,I=e.googEncodeUsagePercent,A=e.googFrameRateInput,O=e.availableIncomingBitrate,M=e.availableOutgoingBitrate,P=e.bytesReceived,w=e.nominated,D=e.id,N=e.currentRoundTripTime,x=e.state,L=e.writable,$=e.candidateType,B=e.ip,U=e.address,F=e.networkType,V=e.port,G=e.nackCount,j=e.pliCount,K=e.protocol,H=e.qpSum,z=e.requestsReceived,Y=e.responsesReceived,W=e.googRetransmitBitrate,q=e.requestsSent,X=e.consentRequestsSent,J=e.responsesSent,Z=e.ssrc,Q=e.googTargetEncBitrate,ee=e.googTransmitBitrate,te=e.retransmittedPacketsSent,re=e.encoderImplementation,ne=e.jitter,ie=e.rid,oe=e.fractionLost,ae=e.googAdaptationChanges,se=e.qualityLimitationReason,ce=e.qualityLimitationDurations,ue=e.googFirsReceived,le=e.googFrameRateSent,de=e.keyFramesEncoded,pe=e.scalabilityMode,_e=e.framesPerSecond,he=e.frames;"outbound-rtp"===t?(h&&(ie?c.simulcast[ie]=e:c.simulcast[v]=e,v++),c.framesEncoded=n||c.framesEncoded||0,m.key_frames_encoded=de||0,c.bytesSent=o||c.bytesSent||0,c.framesSent=a||c.framesSent,m.bytes=o||m.bytes||0,c.packetsSent=E||c.packetsSent||0,m.packetsSent=E||m.packetsSent||0,m.nackCount=G||m.nackCount||0,m.pli_count=j||m.pli_count||0,m.qp_sum=H||m.qp_sum||0,m.ssrc=Z||m.ssrc||0,m.retransmitted_packets_sent=te,c.retransmittedPacketsSent=te,c.retransmittedBytesSent=u,m.encoder_implementation=re,m.qualityLimitationReason=se,m.qualityLimitationDurations=ce,m.scalabilityMode=pe,void 0!==y&&((!s.encodedFrameWidth||y>s.encodedFrameWidth)&&(s.encodedFrameWidth=y),(!s.encodedFrameHeight||S>s.encodedFrameHeight)&&(s.encodedFrameHeight=S),m.frame_size_height=S,m.frame_size_width=y)):"track"===t?(s.encodedFrameWidth=y,s.encodedFrameHeight=S,m.frame_size_height=S,m.frame_size_width=y):"remote-inbound-rtp"===t?(c.packetsLost=i,s.rtt=1e3*f,m.rtt=s.rtt,m.jitter=1e3*ne,m.packetsLost=i,s._fractionLost=oe||0):"codec"===t?(s.codecType=g,m.codecName=g):"candidate-pair"===t?(m.ice_available_incoming_bitrate=O,m.ice_available_outgoing_bitrate=M,m.ice_bytes_received=P,m.ice_bytes_sent=o,m.ice_nominated=Number(w),m.ice_pair_id=D,m.ice_pair_rtt=N,m.ice_pair_state=x,m.ice_pair_writable=L,m.recv_ping_requests=z,m.recv_ping_responses=Y,m.sent_ping_requests_before_first_response=q,m.sent_ping_requests_total=q+X,m.sent_ping_responses=J):"local-candidate"===t?(m.local_candidate_type=$,m.local_ip=B||U,m.local_network_type=F,m.local_port=V,m.protocol=K):"remote-candidate"===t?(m.remote_candidate_type=$,m.remote_ip=B||U,m.remote_port=V):"VideoBwe"===t?(m.encBitratebps=T,m.available_receive_bandwidth=b,m.available_send_bandwidth=R,m.bucket_delay=k,m.retransmitBitratebps=W,m.targetEncBitratebps=Q,m.transmit_bitrate=ee,s._sendBandWidth=Number(R)):"ssrc"===t&&(m.avg_encode_ms=C,m.encodeUsage=I,m.frame_rate_input=A,m.orignal_input_Framerate=Number(A),m.ddaptationChanges=ae,m.firsReceived=ue,m.frameRateSent=le);var fe=getParameter("STATS_SCALLBACK_SUPPORT");if(!isStatsCallbackSupport||!fe){var me=r.video,ge=c.timestamp-me.timestamp;if("outbound-rtp"===t){var ve=o-me.bytesSent,ye=u-me.retransmittedBytesSent;m.encBitratebps=Math.round(8e3*(ve-ye)/ge),m.bucket_delay=l/E,m.retransmitBitratebps=Math.round(8e3*ye/ge),m.targetEncBitratebps=_,m.transmit_bitrate=Math.round(1e3*(o-me.bytesSent)*8/ge),m.avg_encode_ms=1e3*d/n,m.firsReceived=p+j}else"candidate-pair"===t?(m.available_send_bandwidth=M,s._sendBandWidth=M):"media-source"===t&&(m.frame_rate_input=_e,m.orignal_input_Framerate=Number(_e),m.frame_input=he)}})),(y=r.video).timestamp){e.next=14;break}return e.abrupt("return",(r.video=c,this.filterIllegal(s)));case 14:return s.statsInterval=c.timestamp-y.timestamp,m.stats_interval=s.statsInterval,S=Object.keys(c.simulcast),h?(m.sim_enc_width=[],m.sim_enc_height=[],m.sim_enc_bps=[],m.sim_enc_framerate=[],m.sim_enc_key_frames=[],m.sim_rids=[],m.sim_enc_bandwidth=[],m.sim_sent_framerate=[],m.sim_fraction_lost=[],m.sim_keyencoded=[],m.active_sim_streams=this._context.activeSimStreams||[],m.sim_retransmittedRate=[],E=!1,S.sort((function(e,t){return Number(e)-Number(t)})).forEach((function(e){var t=c.simulcast[e],r=t.frameWidth,n=t.frameHeight,i=t.bytesSent,o=t.framesEncoded,a=t.framesSent,u=t.packetsLost,l=t.packetsSent,d=t.qualityLimitationReason,p=t.qualityLimitationDurations,_=t.qualityLimitationResolutionChanges,h=t.retransmittedPacketsSent,f=t.pliCount,g=t.keyFramesEncoded;void 0!==d&&(m.sim_qualityLimitationReason||(m.sim_qualityLimitationReason=[],m.sim_qualityLimitationDurations=[],m.sim_qualityLimitationResolutionChanges=[]),m.sim_qualityLimitationReason.push(d),m.sim_qualityLimitationDurations.push(p),m.sim_qualityLimitationResolutionChanges.push(_));var v=y.simulcast[e];if(m.sim_enc_width.push(r||0),m.sim_enc_height.push(n||0),m.sim_enc_key_frames.push(g||0),v){var S=(i-v.bytesSent||0)/s.statsInterval;m.sim_enc_bps.push(Math.round(8e3*S)),m.sim_enc_bandwidth.push(Math.round(8e3*S/1024));var T=1e3*(o-v.framesEncoded)/s.statsInterval;m.sim_enc_framerate.push(Math.round(T)),m.sim_rids.push(e);var b=void 0!==a?a-v.framesSent:o-v.framesEncoded,R=1e3*b/s.statsInterval;m.sim_sent_framerate.push(Math.round(R));var C=(u-v.packetsLost)/(l-v.packetsSent);s._retransmittedRate=(h-v.retransmittedPacketsSent)/(l-v.packetsSent),C=Number.isNaN(C)?0:C,m.sim_fraction_lost.push(C),m.sim_keyencoded.push(f-v.pliCount>0),m.sim_retransmittedRate.push(s._retransmittedRate),r>0&&!E&&(s.sentKBitrate=8*S,s.encoderOutputFrameRate=T,s.encodedFrameCount=b,s.sentFrameRate=R,s.videoLossRate=C,E=!0)}})),m.vendor_mode=this._stream.vendorCode||0,m.pc_session_id=null==(n=this.handler)?void 0:n.peerConnectionId,null==(i=this._monitor)||i.report("rtc_media_statistics",m)):(s.encodedFrameCount=void 0!==c.framesSent?c.framesSent-y.framesSent:c.framesEncoded-y.framesEncoded,s.sentKBitrate=(c.bytesSent-y.bytesSent||0)/s.statsInterval*8,m.bitrate=Math.round(1e3*s.sentKBitrate),m.bandwidth=Math.round(m.bitrate/1024),s.encoderOutputFrameRate=1e3*(c.framesEncoded-y.framesEncoded)/s.statsInterval,m.frame_rate_encoded=Math.round(s.encoderOutputFrameRate),s.sentFrameRate=1e3*s.encodedFrameCount/s.statsInterval,m.frame_rate_sent=Math.round(s.sentFrameRate),s.videoLossRate=(c.packetsLost-y.packetsLost)/(c.packetsSent-y.packetsSent),s.videoLossRate=Number.isNaN(s.videoLossRate)?0:s.videoLossRate,m.fraction_lost=s.videoLossRate,s._retransmittedRate=(c.retransmittedPacketsSent-y.retransmittedPacketsSent)/(c.packetsSent-y.packetsSent),m.vendor_mode=this._stream.vendorCode||0,m.pc_session_id=null==(o=this.handler)?void 0:o.peerConnectionId,null==(a=this._monitor)||a.report("rtc_media_statistics",m)),e.abrupt("return",(r.video=c,s._fractionLost=Math.max(s._fractionLost,s.videoLossRate),this.filterIllegal(s)));case 18:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),i}(Stats),RemoteStatsReport=function(e){_inherits(o,e);var t,r,n,i=_createSuper(o);function o(e,t){var r;return _classCallCheck(this,o),(r=i.call(this,e))._stream=t,r}return _createClass(o,[{key:"setRemoteStreamStatsEvtInterval",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l,d=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._timer){e.next=2;break}return e.abrupt("return");case 2:return this.logger.info("setRemoteStreamStatsEvtInterval","invoke"),this.setVar(r),a={audio:{},video:{}},this._destroyed=!1,s=this._stream,c=null==(n=s.audioTrack)?void 0:n.originTrack,u=null==(i=s.videoTrack)?void 0:i.originTrack,this.getRemoteVideoStats(u,a),e.next=9,this.getRemoteAudioStats(c,a,null==(o=this._stream.audioTrack)?void 0:o.getAudioLevel());case 9:l=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var r,n,i,o,c,u,p;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=null==(r=s.audioTrack)?void 0:r.originTrack,c=null==(n=s.videoTrack)?void 0:n.originTrack,e.next=4,d.getRemoteAudioStats(o,a,null==(i=d._stream.audioTrack)?void 0:i.getAudioLevel());case 4:return u=e.sent,e.next=7,d.getRemoteVideoStats(c,a);case 7:p=e.sent,t({audioStats:u,videoStats:p,isScreen:s.isScreen,userId:s.userId,streamId:s.streamId}),d._destroyed||(d._timer=setTimeout(l,2e3));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),this.stopReport("start a new timer."),this._timer=setTimeout(l,2e3);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"unsubscribe",value:function(){this.logger.info("unsubscribe","invoke"),_get(_getPrototypeOf(o.prototype),"stopReport",this).call(this,"unsubscribe"),this._stream.stopAudioStallObserve()}},{key:"getRemoteAudioStats",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c={},u={},l=this._stream,d=l.streamId,p=l.userId,_=l.isScreen,h=l.audioMid,f=l.subMediaType,m=l._attributes,g=l.virtual,v=l.audioTrack,y={media_type:"audio",is_screen:!!_,direction:"down",stream_id:d,stream_user_id:p,vid:h,audio_mux:g,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,mute_state:audioInMediaType(f)?"mute_state_off":"mute_state_on",remote_user_capture_state:m.localaudio?"capture_state_on":"capture_state_off",remote_user_mute_state:m.localaudio&&m.audiostream?"mute_state_off":"mute_state_on"},v&&(y.playback_volume=v.getVolume()),t&&this.handler){e.next=3;break}return e.abrupt("return",c);case 3:return e.next=5,this.handler.getStats(t);case 5:if((S=e.sent).length){e.next=8;break}return e.abrupt("return",c);case 8:if(S.forEach((function(e){var t,r,i=e.type,o=e.packetsLost,a=e.packetsReceived,s=e.bytesReceived,l=e.jitterBufferDelay,p=e.jitterBufferEmittedCount,_=e.clockRate,h=e.channels,f=e.totalSamplesReceived,m=e.concealedSamples,g=e.silentConcealedSamples,v=e.concealmentEvents,S=e.totalRoundTripTime,E=e.packetsDiscarded,T=e.state,R=e.currentRoundTripTime,C=e.audioLevel,k=e.totalAudioEnergy,I=e.totalSamplesDuration,A=e.mimeType,O=e.googDecodingNormal,M=e.googDecodingMuted,P=e.availableIncomingBitrate,w=e.availableOutgoingBitrate,D=e.bytesSent,N=e.nominated,x=e.id,L=e.writable,$=e.jitter,B=e.candidateType,U=e.ip,F=e.address,V=e.networkType,G=e.port,j=e.protocol,K=e.audioOutputLevel,H=e.requestsReceived,z=e.responsesReceived,Y=e.requestsSent,W=e.consentRequestsSent,q=e.responsesSent,X=e.ssrc,J=e.nackCount,Z=e.lastPacketReceivedTimestamp,Q=e.concealmentevents,ee=e.fecPacketsReceived;"inbound-rtp"===i?(u.packetsLost=o,u.packetsReceived=a,y.packetsLost=o,y.packetsReceived=a,y.packetsDiscarded=E,y.nackCount=J,y.lastPacketReceivedTimestamp=Z,y.concealmentevents=Q,u.bytesReceived=s,void 0!==l&&(c.jitterBufferDelay=l/p*1e3,y.average_jitter_buffer_delay_ms=c.jitterBufferDelay),void 0!==f&&(u.totalSamplesReceived=f,c.concealedSamples=m,u.concealedSamples=m,u.silentConcealedSamples=g,y.concealedSamples=m,c.concealmentEvents=v,y.totalSamplesReceived=f),void 0!==ee&&(y.fec_packets_received=ee,u.fecPacketsReceived=ee),y.jitter=1e3*$,y.ssrc=X,void 0!==C&&0!==C?(y.audio_level=C?-10*Math.log10(Math.pow(C,2)):C,y.volume=255*C):(y.volume=null!=n?n:255*C,y.audio_level=n?-10*Math.log10(Math.pow(n/255,2)):n),void 0!==k&&(y.total_audio_energy=k),void 0!==I&&(y.totalAudioDuration=I)):"codec"===i?(c.recordSampleRate=_,h&&(c.numChannels=h),y.codecName=A):"candidate-pair"===i?(y.ice_available_incoming_bitrate=P,y.ice_available_outgoing_bitrate=w,y.ice_bytes_received=s,y.ice_bytes_sent=D,y.ice_nominated=Number(N),y.ice_pair_id=x,y.ice_pair_rtt=R,y.rtt=1e3*R,y.rtt&&(null==(r=null==(t=b._context.streamRTT)?void 0:t[d])?void 0:r.audio)&&(y.total_rtt_ms=Math.round(y.rtt+b._context.streamRTT[d].audio)),y.ice_pair_state=T,y.ice_pair_writable=L,y.recv_ping_requests=H,y.recv_ping_responses=z,y.sent_ping_requests_before_first_response=Y,y.sent_ping_requests_total=Y+(W||0),y.sent_ping_responses=q,"succeeded"===T&&(c.rtt=1e3*R,c.total_rtt=1e3*S)):"track"===i&&void 0!==C?(0===C&&0!==n?(y.volume=n,y.audio_level=n?-10*Math.log10(Math.pow(n/255,2)):n):(y.audio_level=C?-10*Math.log10(Math.pow(C,2)):C,y.volume=255*C),y.total_audio_energy=k,y.totalAudioDuration=I):"ssrc"===i?(y.decodingNormal=O,y.recvAudioLevel=K,y.decodingMuted=M):"local-candidate"===i?(y.local_candidate_type=B,y.local_ip=U||F,y.local_network_type=V,y.local_port=G,y.protocol=j):"remote-candidate"===i&&(y.remote_candidate_type=B,y.remote_ip=U||F,y.remote_port=G)})),(E=r.audio).timestamp){e.next=12;break}return e.abrupt("return",(u.timestamp=Date.now(),r.audio=u,this.filterIllegal(c)));case 12:if(e.t0=void 0!==u.concealedSamples,!e.t0){e.next=20;break}return y.interval_concealed_samples=u.concealedSamples-E.concealedSamples,y.interval_samples_received=u.totalSamplesReceived-E.totalSamplesReceived,y.interval_silent_concealed_samples=u.silentConcealedSamples-E.silentConcealedSamples,e.next=19,this._stream.updateAudioStallInfo(y,c,u);case 19:T=e.sent;case 20:return u.timestamp=Date.now(),c.audioLossRate=(u.packetsLost-E.packetsLost)/(u.packetsReceived-E.packetsReceived+(u.packetsLost-E.packetsLost)),c.audioLossRate=Number.isNaN(c.audioLossRate)?0:c.audioLossRate,y.fraction_lost=c.audioLossRate,c.statsInterval=u.timestamp-E.timestamp,y.stats_interval=c.statsInterval,c.receivedKBitrate=(u.bytesReceived-E.bytesReceived||0)/c.statsInterval*8,y.bandwidth=Math.round(1e3*c.receivedKBitrate/1024),void 0!==u.concealedSamples&&(c.receivedSampleRate=1e3*y.interval_samples_received/c.statsInterval),void 0!==u.fecPacketsReceived&&(y.fecBitratebps=(u.fecPacketsReceived-E.fecPacketsReceived||0)/c.statsInterval),y.average_jitter_buffer_delay_ms&&y.total_rtt_ms&&(c.e2eDelay=y.average_jitter_buffer_delay_ms+y.total_rtt_ms),(null==(o=null==(i=this._context.streamRTT)?void 0:i[d])?void 0:o.audio)&&(c.totalRtt=(y.rtt?y.rtt:0)+this._context.streamRTT[d].audio),r.audio=u,y.vendor_mode=this._stream.vendorCode||0,y.pc_session_id=null==(a=this.handler)?void 0:a.peerConnectionId,null==(s=this._monitor)||s.report("rtc_media_statistics",y,T),e.abrupt("return",this.filterIllegal(c));case 37:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"getRemoteVideoStats",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s={},c={timestamp:Date.now()},u=this._stream,l=u.streamId,d=u.userId,p=u.isScreen,_=u.subMediaType,h=u._attributes,f=_objectSpread2({media_type:"video",is_screen:!!p,direction:"down",stream_id:l,stream_user_id:d,vid:this._stream.videoMid,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,mute_state:videoInMediaType(_)?"mute_state_off":"mute_state_on",remote_user_capture_state:h.localvideo?"capture_state_on":"capture_state_off",remote_user_mute_state:h.localvideo&&h.videostream?"mute_state_off":"mute_state_on"},this._stream.getVideoRenderInfo()),t&&this.handler){e.next=3;break}return e.abrupt("return",s);case 3:return s.isScreen=p,e.next=6,this.handler.getStats(t);case 6:if((m=e.sent).length){e.next=9;break}return e.abrupt("return",s);case 9:if(m.forEach((function(e){var t,r,n=e.type,i=e.frameHeight,o=e.frameWidth,a=e.packetsLost,u=e.packetsReceived,d=e.bytesReceived,p=e.framesDecoded,_=e.jitterBufferDelay,h=e.jitterBufferEmittedCount,m=e.mimeType,g=e.firCount,v=e.availableIncomingBitrate,y=e.availableOutgoingBitrate,S=e.bytesSent,E=e.nominated,b=e.id,R=e.currentRoundTripTime,C=e.state,k=e.writable,I=e.candidateType,A=e.ip,O=e.address,M=e.networkType,P=e.port,w=e.nackCount,D=e.pliCount,N=e.protocol,x=e.requestsReceived,L=e.responsesReceived,$=e.requestsSent,B=e.consentRequestsSent,U=e.responsesSent,F=e.ssrc,V=e.jitter,G=e.framesReceived,j=e.keyFramesDecoded,K=e.totalDecodeTime,H=e.decoderImplementation,z=e.lastPacketReceivedTimestamp,Y=e.framesDropped;"inbound-rtp"===n?(c.packetsLost=a,f.packetsLost=a,c.packetsReceived=u,f.packetsReceived=u,c.bytesReceived=d,f.bytes=d,c.framesDecoded=p,c.totalDecodeTime=K,void 0!==_&&(c.jitterBufferDelay=_/h*1e3,f.average_jitter_buffer_delay_ms=c.jitterBufferDelay),f.fir_count=g,f.nackCount=w,c.nackCount=w,f.pli_count=D,f.ssrc=F,f.framesDropped=Y,f.jitter=1e3*V,f.framesReceived=G,c.framesReceived=G,f.framesDecoded=p,f.key_frames_decoded=j,f.decoder_name=H,f.last_packet_received_timestamp=z,void 0!==o&&(s.width=o,f.frame_size_width=o,s.height=i,f.frame_size_height=i)):"track"===n&&void 0!==o?(s.width=o,f.frame_size_width=o,s.height=i,f.frame_size_height=i,void 0!==G&&(f.framesReceived=G,c.framesReceived=G)):"codec"===n?f.codecName=m:"candidate-pair"===n?(f.ice_available_incoming_bitrate=v,f.ice_available_outgoing_bitrate=y,f.ice_bytes_received=d,f.ice_bytes_sent=S,f.ice_nominated=Number(E),f.ice_pair_id=b,f.ice_pair_rtt=R,f.rtt=1e3*R,f.rtt&&(null==(r=null==(t=T._context.streamRTT)?void 0:t[l])?void 0:r.video)&&(f.total_rtt_ms=Math.round(f.rtt+(T._context.streamRTT[l].video||0))),s.rtt=f.rtt,f.ice_pair_state=C,f.ice_pair_writable=k,f.recv_ping_requests=x,f.recv_ping_responses=L,f.sent_ping_requests_before_first_response=$,f.sent_ping_requests_total=$+(B||0),f.sent_ping_responses=U):"local-candidate"===n?(f.local_candidate_type=I,f.local_ip=A||O,f.local_network_type=M,f.local_port=P,f.protocol=N):"remote-candidate"===n&&(f.remote_candidate_type=I,f.remote_ip=A||O,f.remote_port=P)})),(g=r.video).timestamp){e.next=13;break}return e.abrupt("return",(r.video=c,this.filterIllegal(s)));case 13:return v=c.packetsLost-g.packetsLost,y=c.packetsReceived-g.packetsReceived,s.videoLossRate=v/(y+v),g.totalDecodeTime&&g.framesDecoded&&c.framesDecoded!==g.framesDecoded&&(S=c.totalDecodeTime-g.totalDecodeTime,E=c.framesDecoded-g.framesDecoded,f.decode_elapse_per_frame=Number((S/E*1e3).toFixed(2))),e.abrupt("return",(s._retransmittedRate=(c.nackCount-g.nackCount)/(y+v),s.videoLossRate=Number.isNaN(s.videoLossRate)?0:s.videoLossRate,f.fraction_lost=s.videoLossRate,s.statsInterval=c.timestamp-g.timestamp,f.stats_interval=s.statsInterval,s.receivedKBitrate=(c.bytesReceived-g.bytesReceived||0)/s.statsInterval*8,f.bitrate=Math.round(1e3*s.receivedKBitrate),f.bandwidth=Math.round(f.bitrate/1024),s.decoderOutputFrameRate=1e3*(c.framesDecoded-g.framesDecoded)/s.statsInterval,s.receivedFrameRate=1e3*(c.framesReceived-g.framesReceived)/s.statsInterval,f.frame_rate_decoded=Math.round(s.decoderOutputFrameRate),f.frame_rate_received=Math.round(s.receivedFrameRate),f.average_jitter_buffer_delay_ms&&f.total_rtt_ms&&(s.e2eDelay=f.average_jitter_buffer_delay_ms+f.total_rtt_ms),(null==(i=null==(n=this._context.streamRTT)?void 0:n[l])?void 0:i.video)&&(s.totalRtt=(f.rtt?f.rtt:0)+(this._context.streamRTT[l].video||0)),r.video=c,this._stream.updateVideoStallInfo(f,s),f.vendor_mode=this._stream.vendorCode||0,f.pc_session_id=null==(o=this.handler)?void 0:o.peerConnectionId,null==(a=this._monitor)||a.report("rtc_media_statistics",f),this.filterIllegal(s)));case 16:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"destroy",value:function(){_get(_getPrototypeOf(o.prototype),"destroy",this).call(this),_get(_getPrototypeOf(o.prototype),"stopReport",this).call(this,"destroy"),this._stream.stopAudioStallObserve()}}]),o}(Stats),VideoStallObserver=function(){function e(t,r){_classCallCheck(this,e),__publicField(this,"_removeHandler"),__publicField(this,"_remotePauseHandler"),__publicField(this,"_prePts"),__publicField(this,"_stallList"),__publicField(this,"_videoInWaiting",!1),__publicField(this,"_videoInWaitingCallback",!1),__publicField(this,"_videoInWaiting100ms",!1),__publicField(this,"_isPaused"),__publicField(this,"_pauseStart",0),__publicField(this,"_pauseDuration",0),__publicField(this,"_requestVideoFrameCallbackTimer"),__publicField(this,"_logger"),__publicField(this,"_player"),__publicField(this,"_recentVideoInfo"),__publicField(this,"_stallTimeThreshold"),__publicField(this,"_openVideoStall100ms",Config2.VIDEO_STALL_100MS);var n=t?1500:isSafari||isFirefox?550:500;this._stallTimeThreshold={report:n,callback:Math.max(Config2.VIDEO_STALL_DATA,n)},this._logger=new Logger$1$1("VideoStallObserver",1,r)}return _createClass(e,[{key:"start",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._logger.print("start","invoke"),this._player=e,isSupportVideoFrameCallback&&!r)e.domElement&&(this._requestVideoFrameCallbackTimer=e.domElement.requestVideoFrameCallback(this._onVideoRefresh.bind(this)),this._removeHandler=function(){var r;t._requestVideoFrameCallbackTimer&&(null==(r=e.domElement)||r.cancelVideoFrameCallback(t._requestVideoFrameCallbackTimer))});else{var n=function(r){return t._onVideoTimeupdate(r,e)};e.on("playback_event",n),this._removeHandler=function(){return e.off("playback_event",n)}}var i=function(e){return t._onVideoPause(e)};e.on("playback_event",i),this._remotePauseHandler=function(){return e.off("playback_event",i)}}},{key:"getRecentRenderInfo4Report",value:function(){var e=this,t={};return this._recentVideoInfo&&Object.keys(this._recentVideoInfo).forEach((function(r){var n,i=r.replace(/[a-z]{1}[A-Z]{1}/g,(function(e){return"".concat(e[0],"_").concat(e[1].toLowerCase())}));t["video_".concat(i)]=null==(n=e._recentVideoInfo)?void 0:n[r]})),t}},{key:"stop",value:function(){var e,t;this._logger.print("stop","invoke"),delete this._player,null==(e=this._removeHandler)||e.call(this),delete this._removeHandler,null==(t=this._remotePauseHandler)||t.call(this),delete this._remotePauseHandler,delete this._stallList,delete this._prePts,delete this._recentVideoInfo,this._videoInWaiting=!1,this._videoInWaitingCallback=!1,this._videoInWaiting100ms=!1}},{key:"destroy",value:function(){this.stop()}},{key:"getStallInfo",value:function(e){var t=this,r=e.interval,n=e.frameRateReceived,i=e.frameRateDecoded,o=e.bitrate,a={pts:0,report:{stallCount:0,stallDuration:0,list:[]},callback:{stallCount:0,stallDuration:0},pauseDuration:this._getPauseDuration()};return this._stallList&&((isSafari||isFirefox)&&(0===o||(i||1/0)<=1||(n||1/0)<=1)||0===this._stallList.length?(a.report.stallDuration=a.callback.stallDuration=2e3,a.report.stallCount=a.callback.stallCount=this._videoInWaiting?0:1,this._openVideoStall100ms&&(a.stall100ms={count:this._videoInWaiting100ms?0:1,duration:2e3}),this._videoInWaiting=!0,this._videoInWaitingCallback=!0,this._videoInWaiting100ms=!0):this._stallList.forEach((function(e,n){var i=e.timeUpdateInterval;0===n&&t._videoInWaiting&&(i=Math.round(e.timeUpdateInterval%r));var o=e.timeUpdateInterval>t._stallTimeThreshold.report;o&&(a.report.list.push(e.timeUpdateInterval),a.report.stallDuration+=i,t._videoInWaiting||a.report.stallCount++),t._videoInWaiting=o,e.timeUpdateInterval>t._stallTimeThreshold.callback?(a.callback.stallDuration+=i,t._videoInWaitingCallback||a.callback.stallCount++,t._videoInWaitingCallback=!0):t._videoInWaitingCallback=!1,t._openVideoStall100ms&&(a.stall100ms||(a.stall100ms={count:0,duration:0}),e.timeUpdateInterval>100?(a.stall100ms.duration+=i,t._videoInWaiting100ms||a.stall100ms.count++,t._videoInWaiting100ms=!0):t._videoInWaiting100ms=!1),a.pts=e.playTime})),this._stallList=[]),a}},{key:"_getPauseDuration",value:function(){var e=this._pauseDuration;if(this._pauseDuration=0,this._isPaused){var t=getServerNow(),r=t-(this._pauseStart||0);r>500&&(this._pauseStart=t,e+=r)}return e}},{key:"_onVideoPause",value:function(e){if("pause"===e.eventName)this._isPaused=!0,this._pauseStart=getServerNow();else if("play"===e.eventName&&this._isPaused){this._isPaused=!1;var t=getServerNow()-this._pauseStart;t>500&&(this._pauseDuration+=t)}}},{key:"_onVideoTimeupdate",value:function(e,t){if("timeupdate"===e.eventName){var r=t.domElement;if(!r||0===r.currentTime)return;if(void 0===this._prePts)return void(this._prePts=r.currentTime);if(this._stallList||(this._stallList=[]),r.currentTime>this._prePts){var n=r.currentTime-this._prePts;this._stallList.push({playTime:r.currentTime,timeUpdateInterval:Math.round(1e3*n)})}this._prePts=r.currentTime}}},{key:"_onVideoRefresh",value:function(e,t){var r,n;if(this._stallList||(this._stallList=[]),this._prePts){var i=t.presentationTime-this._prePts;this._stallList.push({playTime:t.presentationTime,timeUpdateInterval:Math.round(i)})}this._recentVideoInfo=t,this._prePts=t.presentationTime,null==(n=null==(r=this._player)?void 0:r.domElement)||n.requestVideoFrameCallback(this._onVideoRefresh.bind(this))}}]),e}(),_AudioStallObserver=function(){function e(t){_classCallCheck(this,e),__publicField(this,"_audioStallTimer"),__publicField(this,"_preSample"),__publicField(this,"_isStallInPreCallbackEnd",!1),__publicField(this,"_isStallInPreReportEnd",!1),__publicField(this,"_stallList",[]),this._stream=t}var t,r;return _createClass(e,[{key:"start",value:function(t,r){this.stop(),Config2.AUDIO_STALL&&e.interval>0&&"number"==typeof t&&"number"==typeof r&&(this._preSample={ts:getServerNow(),concealedSamples:t,totalSamplesReceived:r},this._startStallCountInterval())}},{key:"stop",value:function(){this._stallList=[],this._audioStallTimer&&(clearTimeout(this._audioStallTimer),delete this._audioStallTimer)}},{key:"destroy",value:function(){this.stop()}},{key:"getAudioStallInfo",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function t(){var r,n,i,o;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={stats_count:this._stallList.filter((function(e){return!!e.get_stats_cost})).length,stall_list:_toConsumableArray(this._stallList)},t.prev=1,t.next=4,this._audioStallCount();case 4:t.next=8;break;case 6:t.prev=6,t.t0=t.catch(1);case 8:return n=computeStallInfo(this._stallList,2,this._isStallInPreReportEnd),this._isStallInPreReportEnd=n.isStallInEnd,i=Config2.AUDIO_STALL_DATA/e.interval,o=computeStallInfo(this._stallList,i,this._isStallInPreCallbackEnd),t.abrupt("return",(this._isStallInPreCallbackEnd=o.isStallInEnd,this.stop(),this._startStallCountInterval(),{report:{stall_count:n.stall_count,stall_duration:n.stall_duration,list:n.list},callback:{stall_count:o.stall_count,stall_duration:o.stall_duration,list:o.list},extra:r}));case 12:case"end":return t.stop()}}),t,this,[[1,6]])}))),function(){return r.apply(this,arguments)})},{key:"_startStallCountInterval",value:function(){var t=this,r=function(){var n=_asyncToGenerator(_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return clearTimeout(t._audioStallTimer),delete t._audioStallTimer,n.next=4,t._audioStallCount();case 4:t._audioStallTimer||(t._audioStallTimer=setTimeout(r,e.interval));case 5:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();this._audioStallTimer=setTimeout(r,e.interval)}},{key:"_audioStallCount",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function t(){var r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._preSample&&!(getServerNow()-this._preSample.ts<.5*e.interval)){t.next=2;break}return t.abrupt("return");case 2:if(n=this._stream,i=n.hasAudio,o=n.subAudio,a=n.virtual,s=n.virtualOccupy,c=n.removeTrack,u=n.audioTrack,!c&&u){t.next=5;break}return t.abrupt("return",(clearTimeout(this._audioStallTimer),void delete this._audioStallTimer));case 5:if((l=i&&o)&&(!a||s)){t.next=10;break}this._preSample.ts=getServerNow(),this._stallList.push({reason:l?"virtual: ".concat(a,", virtualOccupy: ").concat(s):"hasAudio: ".concat(i,", subAudio: ").concat(o)}),t.next=24;break;case 10:return d=getServerNow(),h=0,t.prev=12,t.next=15,null==(r=this._stream.audioTransceiver)?void 0:r.receiver.getStats();case 15:null==(f=t.sent)||f.forEach((function(e){"inbound-rtp"===e.type&&(p=e),h++})),t.next=22;break;case 19:t.prev=19,t.t0=t.catch(12),_=t.t0.message||JSON.stringify(t.t0);case 22:m=getServerNow(),g=getServerNow(),v=g-this._preSample.ts,p?(S=(y=p).concealedSamples,E=y.totalSamplesReceived,T=S-this._preSample.concealedSamples,b=E-this._preSample.totalSamplesReceived,R=T>=0&&b>=0&&T>=e.ratio*b,this._stallList.push({concealed:T,received:b,diff:v,start:this._preSample.ts,end:g,get_stats_cost:m-d,get_stats_start:d,get_stats_end:m,is_stall:R}),this._preSample.concealedSamples=S,this._preSample.totalSamplesReceived=E,this._preSample.ts=g):this._stallList.push({diff:v,start:this._preSample.ts,end:g,get_stats_cost:m-d,get_stats_start:d,get_stats_end:m,reason:h?_||"no inbound-rtp":"no report"});case 24:case"end":return t.stop()}}),t,this,[[12,19]])}))),function(){return t.apply(this,arguments)})}],[{key:"setAudioStallConfig",value:function(t){e.interval=((null==t?void 0:t.audio_stall_interval)||200)/2,e.ratio=(null==t?void 0:t.audio_stall_ratio)||.6}}]),e}();__publicField(_AudioStallObserver,"interval",100),__publicField(_AudioStallObserver,"ratio",.6);var AudioStallObserver=_AudioStallObserver,computeStallInfo=function(e,t,r){for(var n,i={stall_count:0,stall_duration:0,isStallInEnd:!1,list:[]},o=0,a=0,s=0;s<e.length;s++){var c=e[s];c.is_stall&&(o++,a+=c.diff||0);var u=s===e.length-1;if(!c.is_stall||u){var l=o>=t,d=s+t-o-1;if(!l&&o>2){var p=0;e.slice(s+1,d+1).forEach((function(e){e.is_stall&&(p+=e.diff||0)})),(l=a+p>AudioStallObserver.interval*t*AudioStallObserver.ratio)&&(s=d,a+=p)}l&&(i.stall_count++,i.stall_duration+=a,i.list.push(a)),u&&(i.isStallInEnd=l),o=a=0}}return!0===(null==(n=e[0])?void 0:n.is_stall)&&r&&i.stall_count>0&&i.stall_count--,i},StreamBase=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),n=t.call(this),__publicField(_assertThisInitialized(n),"_videoPlayer"),__publicField(_assertThisInitialized(n),"isScreen",!1),__publicField(_assertThisInitialized(n),"audioMid"),__publicField(_assertThisInitialized(n),"videoMid"),__publicField(_assertThisInitialized(n),"videoTransceiver"),__publicField(_assertThisInitialized(n),"audioTransceiver"),__publicField(_assertThisInitialized(n),"vendorHandler"),__publicField(_assertThisInitialized(n),"vendorCode",0),__publicField(_assertThisInitialized(n),"engineId"),__publicField(_assertThisInitialized(n),"logger"),n.engineId=e.id,n.logger=new Logger$1$1("Stream",0,e.id),n}return _createClass(r,[{key:"stopReport",value:function(e){this.statsReport.stopReport(e)}},{key:"destroy",value:function(){var e,t;delete this.audioMid,delete this.videoMid,this.statsReport.destroy(),null==(e=this.observer)||e.reset(),delete this.videoTransceiver,delete this.audioTransceiver,null==(t=this.vendorHandler)||t.destroy(),this.vendorCode=0,delete this.vendorHandler}}]),r}(EnhancedEventEmitter),StreamState=function(e){return e[e.INIT=0]="INIT",e[e.SUB_ING=1]="SUB_ING",e[e.SUB_ED=2]="SUB_ED",e}(StreamState||{}),LocalStream=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),n=t.call(this,e),__publicField(_assertThisInitialized(n),"id"),__publicField(_assertThisInitialized(n),"stream"),__publicField(_assertThisInitialized(n),"streamId"),__publicField(_assertThisInitialized(n),"seiList",[]),__publicField(_assertThisInitialized(n),"videoTrack"),__publicField(_assertThisInitialized(n),"audioTrack"),__publicField(_assertThisInitialized(n),"videoEncodeConfig",[defaultVideoEncoderConfig]),__publicField(_assertThisInitialized(n),"subVideoDescriptions",[]),__publicField(_assertThisInitialized(n),"enableSimulcast",!1),__publicField(_assertThisInitialized(n),"observer"),__publicField(_assertThisInitialized(n),"statsReport"),__publicField(_assertThisInitialized(n),"prevBitrate",0),__publicField(_assertThisInitialized(n),"pubAudio",!1),__publicField(_assertThisInitialized(n),"pubVideo",!1),__publicField(_assertThisInitialized(n),"pubAttributes"),__publicField(_assertThisInitialized(n),"pcSessionId"),n.stream=new MediaStream,n.id=genUuid$1(),n.pubAttributes={localaudio:!1,localvideo:!1,videostream:!1,audiostream:!1,extvideo:!1,extaudio:!1,videoDescriptions:[]},n.statsReport=new LocalStatsReport(e,_assertThisInitialized(n)),n}return _createClass(r,[{key:"audioHasCapture",get:function(){return this.pubAttributes.localaudio}},{key:"audioHasPublish",get:function(){return this.pubAttributes.audiostream}},{key:"videoHasCapture",get:function(){return this.pubAttributes.localvideo}},{key:"videoHasPublish",get:function(){return this.pubAttributes.videostream}},{key:"hasPublished",get:function(){return!!this.audioMid&&!!this.videoMid}},{key:"isEmptyStream",get:function(){return!this.audioTrack&&!this.videoTrack}},{key:"initStreamId",get:function(){return this.stream.id}},{key:"startReport",value:function(e,t){this.statsReport.setLocalStreamStatsEvtInterval(e,t)}},{key:"initVideoEncodedTransform",value:function(){var e=this;if(this.videoTransceiver&&this.videoTransceiver.sender){var t=this.videoTransceiver.sender;if(isEncodedTransformSupported()){var r=t.createEncodedStreams(),n=r.readable,i=r.writable,o=new TransformStream({transform:function(t,r){var n=e.seiList[0];if(n){var i=SEIHelper.generateSEI(n.content),o=new Uint8Array(i.byteLength+t.data.byteLength);0===n.repeatCount&&e.seiList.splice(0,1),n.repeatCount--,o.set(new Uint8Array(t.data)),o.set(i,t.data.byteLength),t.data=o.buffer,r.enqueue(t)}else r.enqueue(t)}});n.pipeThrough(o).pipeTo(i)}}else this.logger.warn("no sender found when trying to bind encodedTransform")}},{key:"initAudioEncodedTransform",value:function(){if(this.audioTransceiver&&this.audioTransceiver.sender){var e=this.audioTransceiver.sender.createEncodedStreams(),t=e.readable,r=e.writable;t.pipeThrough(new TransformStream({transform:function(e,t){t.enqueue(e)}})).pipeTo(r)}else this.logger.warn("no sender found when trying to bind encodedTransform")}},{key:"clean",value:function(){reportRtcInvokeStatus(this.engineId,"localstream_clean","".concat((new Error).stack),0,this.streamId||""),_get(_getPrototypeOf(r.prototype),"destroy",this).call(this),this.prevBitrate=0,this.subVideoDescriptions=[]}},{key:"switchTrackEnableState",value:function(e,t){var r;"audio"===e?r=this.audioTrack:"video"===e&&(r=this.videoTrack);var n=null==r?void 0:r.mediaTrack;return!(!n||(null==n?void 0:n.enabled)===t||(n.enabled=t,0))}},{key:"resetStream",value:function(){this.stream=new MediaStream}}]),r}(StreamBase),RemoteStream=function(e){_inherits(n,e);var t,r=_createSuper(n);function n(e,t,i,o,a,s){var c;return _classCallCheck(this,n),c=r.call(this,e),__publicField(_assertThisInitialized(c),"streamId"),__publicField(_assertThisInitialized(c),"userId"),__publicField(_assertThisInitialized(c),"isPublic"),__publicField(_assertThisInitialized(c),"hasVideo"),__publicField(_assertThisInitialized(c),"hasAudio"),__publicField(_assertThisInitialized(c),"_attributes"),__publicField(_assertThisInitialized(c),"streamState"),__publicField(_assertThisInitialized(c),"removeTrack",!1),__publicField(_assertThisInitialized(c),"observer"),__publicField(_assertThisInitialized(c),"statsReport"),__publicField(_assertThisInitialized(c),"subVideo"),__publicField(_assertThisInitialized(c),"subAudio"),__publicField(_assertThisInitialized(c),"subMediaType"),__publicField(_assertThisInitialized(c),"subLayer"),__publicField(_assertThisInitialized(c),"_sequenceId"),__publicField(_assertThisInitialized(c),"stream"),__publicField(_assertThisInitialized(c),"videoTrack"),__publicField(_assertThisInitialized(c),"audioTrack"),__publicField(_assertThisInitialized(c),"recordedVideoFrames"),__publicField(_assertThisInitialized(c),"stillExist"),__publicField(_assertThisInitialized(c),"originalMediaType"),__publicField(_assertThisInitialized(c),"priority"),__publicField(_assertThisInitialized(c),"originalStreamIndex",0),__publicField(_assertThisInitialized(c),"virtual"),__publicField(_assertThisInitialized(c),"pcSessionId"),__publicField(_assertThisInitialized(c),"_virtualOccupy"),__publicField(_assertThisInitialized(c),"_videoStallObserver"),__publicField(_assertThisInitialized(c),"_audioStallObserver"),__publicField(_assertThisInitialized(c),"_handler"),c.virtual=!1,c._virtualOccupy=!1,c.userId=t,c.isScreen=o,c.isPublic=a,c.streamId=i,c.hasAudio=s.audiostream&&s.localaudio,c.hasVideo=s.videostream&&s.localvideo,c._attributes=s,c.vendorCode=(null==s?void 0:s.vendorCode)||0,c.subVideo=!1,c.subAudio=!1,c._sequenceId=0,c.subMediaType=ExtendMediaType.NONE,c.subLayer={spatialLayer:0,spatialSubLayer:-1},c.streamState=0,c.statsReport=new RemoteStatsReport(e,_assertThisInitialized(c)),c.enableVendorMode&&(c.pcSessionId=genUuid$1()),c}return _createClass(n,[{key:"vendor",get:function(){return this._attributes.vendorCode}},{key:"audioHasCapture",get:function(){return this._attributes.localaudio}},{key:"audioHasPublish",get:function(){return this._attributes.audiostream}},{key:"videoHasCapture",get:function(){return this._attributes.localvideo}},{key:"videoHasPublish",get:function(){return this._attributes.videostream}},{key:"sequenceId",get:function(){return this._sequenceId||-1},set:function(e){"number"==typeof e&&(this._sequenceId=e)}},{key:"enableVendorMode",get:function(){return"number"==typeof this.attributes.vendorCode&&0!==this.attributes.vendorCode}},{key:"hasSubscribed",get:function(){return 2===this.streamState}},{key:"attributes",get:function(){return this._attributes},set:function(e){this.hasVideo=e.localvideo&&e.videostream,this.hasAudio=e.localaudio&&e.audiostream,this._attributes=e,this.vendorCode=e.vendorCode||0}},{key:"virtualOccupy",get:function(){return this._virtualOccupy},set:function(e){var t,r;this._virtualOccupy&&!e?null==(t=this.observer)||t.setPushTrack(!1):!this._virtualOccupy&&e&&(null==(r=this.observer)||r.setPushTrack(!0)),this._virtualOccupy=e}},{key:"startReport",value:function(e,t){this.statsReport.setRemoteStreamStatsEvtInterval(e,t),this._handler=t}},{key:"getStats",value:function(e,t){var r;return null==(r=this._handler)?void 0:r.getStats(e,t)}},{key:"initVideoEncodedTransform",value:function(){var e=this;if(this.videoTransceiver&&this.videoTransceiver.receiver){var t=this.videoTransceiver.receiver.createEncodedStreams(),r=t.readable,n=t.writable;r.pipeThrough(new TransformStream({transform:function(t,r){Nalunit.getNalunits(new RTCDataView(t.data)).forEach((function(t){if(t.sei){var r=SEIHelper.decodeSeiBody(t.body);r&&r.type!==RTC_SEI_TYPE.internal&&e.safeEmit("onSEIMessage",r.payload)}})),r.enqueue(t)}})).pipeTo(n)}else this.logger.warn("no receiver found when trying to bind encodedTransform")}},{key:"initAudioEncodedTransform",value:function(){var e=this;if(this.audioTransceiver&&this.audioTransceiver.receiver){var t=this.audioTransceiver.receiver.createEncodedStreams(),r=t.readable,n=t.writable;r.pipeThrough(new TransformStream({transform:function(t,r){t.data.byteLength<=1e3?r.enqueue(t):e.logger.print("too large audio frame",t.data.byteLength)}})).pipeTo(n)}else this.logger.warn("no receiver found when trying to bind encodedTransform")}},{key:"ontrack",value:function(e){var t,r,n,i;try{reportRtcInvokeStatus(this.engineId,"Stream.ontrack",JSON.stringify({uid:this.userId,streamId:this.streamId,streams:e.streams.reduce((function(e,t){return e+mediaStreamStringify(t)}),""),transceiver:mediaTransceiverStringify(e.transceiver),track:mediaTrackStringify(e.track)}),0,this.streamId||"")}catch(a){}if(this.enableVendorMode||(null==(n=null==(r=null==(t=e.streams)?void 0:t[0])?void 0:r.id)?void 0:n.includes(this.streamId))){var o=e.track;"video"===(null==o?void 0:o.kind)?this._setVideoTrack(o):"audio"===(null==(i=e.track)?void 0:i.kind)&&this._setAudioTrack(o),this._setStream(e.streams[0])}this.safeEmit("ontrack",e)}},{key:"startVideoStallObserve",value:function(e){this.logger.info("startVideoStallObserve","invoke"),this._videoStallObserver||(this._videoStallObserver=new VideoStallObserver(this.isScreen,this.engineId)),this._videoStallObserver.start(e),this._videoPlayer=e}},{key:"stopVideoStallObserve",value:function(){var e;this.logger.info("stopVideoStallObserve","invoke"),null==(e=this._videoStallObserver)||e.stop(),delete this._videoPlayer}},{key:"updateVideoStallInfo",value:function(e,t){var r,n=null==(r=this._videoStallObserver)?void 0:r.getStallInfo({interval:e.stats_interval||0,bitrate:e.bitrate,frameRateDecoded:e.frame_rate_decoded,frameRateReceived:e.frame_rate_received});if(n){var i=Math.min(n.report.stallDuration,e.stats_interval||0);if(e.play_time=n.pts,e.stall_count=n.report.stallCount,e.is_screen?e.stuck_length=i:e.stall_duration=i,e.pause_duration=Math.min(i,n.pauseDuration),t.stallCount=n.callback.stallCount,t.stallDuration=n.callback.stallDuration,n.stall100ms){var o=Math.min(n.stall100ms.duration,e.stats_interval||0);e.stall_duration_100ms=o,e.stall_count_100ms=n.stall100ms.count,t.stallDuration100MS=o,t.stallCount100MS=n.stall100ms.count}0===n.report.stallCount&&0===n.report.stallDuration||this.logger.print("video_stall_report",this.userId,JSON.stringify(n.report))}}},{key:"getVideoRenderInfo",value:function(){var e;return(null==(e=this._videoStallObserver)?void 0:e.getRecentRenderInfo4Report())||{}}},{key:"stopAudioStallObserve",value:function(){var e;this.logger.info("stopAudioStallObserve","invoke"),null==(e=this._audioStallObserver)||e.stop()}},{key:"updateAudioStallInfo",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._audioStallObserver){e.next=5;break}return e.next=3,this._audioStallObserver.getAudioStallInfo();case 3:return i=e.sent,e.abrupt("return",(t.concealedSamples===t.interval_concealed_samples&&t.totalSamplesReceived===t.interval_samples_received?(t.stall_count=0,t.stall_duration=0,r.stallCount=0,r.stallDuration=0):(t.stall_count=i.report.stall_count,t.stall_duration=i.report.stall_duration,r.stallCount=i.callback.stall_count,r.stallDuration=i.callback.stall_duration),0===i.report.stall_count&&0===i.report.stall_duration||this.logger.print("audio_stall_report",this.userId,JSON.stringify(_objectSpread2(_objectSpread2({},i.report),{},{callbackList:i.callback.list}))),i.extra));case 5:this._audioStallObserver=new AudioStallObserver(this),this._audioStallObserver.start(n.concealedSamples,n.totalSamplesReceived),this.logger.print("startAduioObserver","start");case 6:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})},{key:"clean",value:function(){var e;this.logger.info("clean","exec stream.clean ".concat(this.streamId," ").concat(this.userId)),reportRtcInvokeStatus(this.engineId,"remotestream_clean","".concat((new Error).stack),0,this.streamId),_get(_getPrototypeOf(n.prototype),"destroy",this).call(this),this.subAudio=!1,this.subVideo=!1,this.sequenceId=0,this.videoTrack=void 0,null==(e=this.audioTrack)||e.close(),this.audioTrack=void 0,this.stream=void 0,this.recordedVideoFrames=void 0,delete this.priority}},{key:"destroy",value:function(){var e,t;this.clean(),null==(e=this._audioStallObserver)||e.destroy(),delete this._audioStallObserver,null==(t=this._videoStallObserver)||t.destroy(),delete this._videoStallObserver,this.attributes={audiostream:!1,localaudio:!1,localvideo:!1,videostream:!1,extvideo:!1,extaudio:!1,videoDescriptions:[]}}},{key:"resetHasSubscribed",value:function(){this.streamState=0}},{key:"_setStream",value:function(e){var t=this;this.stream=e,e.onaddtrack=function(e){"video"===e.track.kind?t._setVideoTrack(e.track):"audio"===e.track.kind&&t._setAudioTrack(e.track)}}},{key:"_setAudioTrack",value:function(e){var t,r;(null==(r=null==(t=this.audioTrack)?void 0:t.preprocessingTrack)?void 0:r.id)!==e.id&&(this.audioTrack=createRemoteAudioTrack(e),this.emit("ontrack",this.audioTrack))}},{key:"_setVideoTrack",value:function(e){var t,r;(null==(r=null==(t=this.videoTrack)?void 0:t.preprocessingTrack)?void 0:r.id)!==e.id&&(this.videoTrack=createRemoteVideoTrack(e),this.emit("ontrack",this.videoTrack))}}]),n}(StreamBase),logger$5=new Logger$1$1("queue",4),SdpStrategy=function(e){return e[e.ADD=0]="ADD",e[e.CLOSE=1]="CLOSE",e}(SdpStrategy||{}),SdpAction=function(e){return e.publish="publish",e.unpublish="unpublish",e.subscribe="subscribe",e.unsubscribe="unsubscribe",e.pushtrack="pushtrack",e.removetrack="removetrack",e}(SdpAction||{}),negativedAction={publish:"unpublish",subscribe:"unsubscribe",pushtrack:"removetrack"},aggregationSdpStrategy={publish:0,subscribe:0,pushtrack:0,unpublish:1,unsubscribe:1,removetrack:1},SdpQueue=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),e=t.call(this),__publicField(_assertThisInitialized(e),"_queue"),e._queue=[],e}return _createClass(r,[{key:"queue",get:function(){return this._queue}},{key:"enqueue",value:function(e){var t=this._queue.length,r="";return this._queue=this._queue.filter((function(t){return t.streamId!==e.streamId||e.action!==negativedAction[t.action]||(r=t.streamId,logger$5.info("offsetStreamId",r),!1)})),this._queue.length===t&&this._queue.push(e),this.emit("start"),r}},{key:"dequeue",value:function(){if(!this._queue.length)return null;var e=this._queue.length;isChrome&&chromeVersion>=86&&chromeVersion<=92&&(e=Math.min(this._queue.length,5));for(var t=aggregationSdpStrategy[this._queue[0].action],r=1;r<e;r++)if(aggregationSdpStrategy[this._queue[r].action]!==t)return{sdpStrategy:t,items:this._queue.splice(0,r)};return{sdpStrategy:t,items:this._queue.splice(0,e)}}}]),r}(EventEmitter2),encodedTransformSupported$2=isEncodedTransformSupported(),ChromeHandler=function(e){_inherits(u,e);var t,r,n,i,o,a,s,c=_createSuper(u);function u(e,t){var r;return _classCallCheck(this,u),r=c.call(this,e,t),__publicField(_assertThisInitialized(r),"name","chrome"),__publicField(_assertThisInitialized(r),"_queueBusy",!1),__publicField(_assertThisInitialized(r),"_sdpQueue"),__publicField(_assertThisInitialized(r),"_aSendonlyOfferTpl"),__publicField(_assertThisInitialized(r),"_vSendonlyOfferTpl"),__publicField(_assertThisInitialized(r),"_aRecvonlyOfferTpl"),__publicField(_assertThisInitialized(r),"_vRecvonlyOfferTpl"),__publicField(_assertThisInitialized(r),"_mid",10),__publicField(_assertThisInitialized(r),"_inactiveMlineIndex",[]),__publicField(_assertThisInitialized(r),"_mlinesCache",{}),__publicField(_assertThisInitialized(r),"setDescription"),r.logger=new Logger$1$1("ChromeHandler",3,e.id),r.setDescription=t.setDescription.bind(t),r._sdpQueue=new SdpQueue,r._sdpQueue.on("start",(function(){r._queueBusy||"stable"!==r._peerConnection.signalingState||(r.logger.info("dequeue start"),r.dequeue())})),r}return _createClass(u,[{key:"destroy",value:function(){_get(_getPrototypeOf(u.prototype),"destroy",this).call(this),this._mlinesCache={}}},{key:"publish",value:(s=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R,C,k,I,A,O,M,P,w;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=t.stream,d=t.enableSimulcast,p=_get(_getPrototypeOf(u.prototype),"internalPublish",this).call(this,t),_=p.videoDescriptions,h=p.subVideoDescriptions,f=p.audioTransceiverInit,m=p.videoTransceiverInit,g=generateAllSsrc(this._nextSsrc),this._nextSsrc=g.next,v=""+this._mid++,y=""+this._mid++,S=_objectSpread2(_objectSpread2(_objectSpread2({},this._aSendonlyOfferTpl),this.peer._offerIce),{},{mid:v,msid:"".concat(l.id," ").concat(l.id,"-audio"),ssrcs:generateSsrc(l.id,"audio",g.audio,clientCname)}),E=_objectSpread2(_objectSpread2(_objectSpread2({},this._vSendonlyOfferTpl),this.peer._offerIce),{},{mid:y,msid:"".concat(l.id," ").concat(l.id,"-video")}),d?(this.logger.info("subVideoDesc","desc: %o ",h),delete E.ssrcGroups,delete E.ssrcs,T=[],E.rids=_.map((function(e){var t=e.rid;return T.unshift(t),{id:t,direction:"send"}})),E.simulcast={dir1:"send",list1:T.join(";")}):(b=generateSsrcs(l.id,g,{cname:clientCname}),R=b.ssrcs,C=b.ssrcGroups,E.ssrcs=R,E.ssrcGroups=C),(null==(n=null==(r=this._context)?void 0:r.serverConfig)?void 0:n.audioRed)&&Array.isArray(S.rtp)&&(-1!==(k=S.rtp.findIndex((function(e){return"red"===e.codec})))&&(I=S.rtp.splice(k,1),A=_slicedToArray(I,1),O=A[0],S.rtp.unshift(O)),M=[],S.rtp.forEach((function(e){return M.push(e.payload)})),S.payloads=M.join(" ")),(null==(o=null==(i=this._context)?void 0:i.serverConfig)?void 0:o.videoCodec)&&setCodecPreferences(E,null==(s=null==(a=this._context)?void 0:a.serverConfig)?void 0:s.videoCodec),Array.isArray(E.ext)&&(getParameter("IOS_SAFARI_ORIENTATION")||!isSafari&&!isIOS||(E.ext=E.ext.filter((function(e){var t;return!(null==(t=null==e?void 0:e.uri)?void 0:t.includes("video-orientation"))}))),E.ext=E.ext.filter((function(e){var t;return!(null==(t=null==e?void 0:e.uri)?void 0:t.includes("framemarking"))}))),(P=null==S?void 0:S.rtp.find((function(e){return"opus"===e.codec})))&&S.fmtp&&(w=S.fmtp.find((function(e){return e.payload===P.payload})))&&(null==(c=this._context)?void 0:c.audioProfileManager)&&(w.config=this._context.audioProfileManager.getOpusConfigStr(w.config)),e.abrupt("return",(d||isSafari||this.addBitrateLimit(E,t.videoEncodeConfig[0].maxKbps),this._mlinesCache[t.stream.id]=[S,E],{partialSdp:getLocalPartialSdp(this.peer._offerSession,S,E),audioMid:v,videoMid:y,type:"incroffer",semantics:"unified-plan",videoDescriptions:_,subVideoDescriptions:h,audioTransceiverInit:f,videoTransceiverInit:m,peerConnectionMode:this.peerConnectionMode}));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"subscribe",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("subscribe"),this._aRecvonlyOfferTpl&&this._vRecvonlyOfferTpl){e.next=7;break}return e.next=4,this._genOfferSdp();case 4:return o=e.sent,e.next=7,this.createAVMlineOfferTpl(o);case 7:return l="",d="",p=!1,_=!1,this._mlinesCache[t.streamId]=[a,s],t.virtual?(l=""+this._mid++,p=!0):r.multiChatMode?(l=""+this._mid++,d=""+this._mid++,_=!0):(p=!0,_=!0,l=""+this._mid++,d=""+this._mid++),l&&(a=_objectSpread2(_objectSpread2({},this._aRecvonlyOfferTpl),{},{mid:l})),p&&(this._mlinesCache[t.streamId][0]=a,c={track:"audio",init:{direction:"recvonly"}}),d&&(s=_objectSpread2(_objectSpread2({},this._vRecvonlyOfferTpl),{},{mid:d})),_&&(this._mlinesCache[t.streamId][1]=s,u={track:"video",init:{direction:"recvonly"}}),h=getLocalPartialSdp(this.peer._offerSession,a,s),t.enableVendorMode||r.multiChatMode||t.virtual||!this._aSendonlyAnswerTpl||!this._vSendonlyAnswerTpl||(f=generateAllSsrc(this._nextSsrc),this._nextSsrc=f.next,g=_objectSpread2(_objectSpread2(_objectSpread2({},this._aSendonlyAnswerTpl),this.peer._answerIce),{},{mid:l,msid:"".concat(t.streamId).concat((null==(n=this._context)?void 0:n.avSync)?"":"-audio"," ").concat(t.streamId,"-audio"),ssrcs:generateSsrc(t.streamId,"audio",f.audio)}),v=_objectSpread2(_objectSpread2(_objectSpread2({},this._vSendonlyAnswerTpl),this.peer._answerIce),{},{mid:d,msid:"".concat(t.streamId).concat((null==(i=this._context)?void 0:i.avSync)?"":"-video"," ").concat(t.streamId,"-video")},generateSsrcs(t.streamId,f,{flexfec:this._enableSubFlexfec})),m={sdp:lib$1.write(_objectSpread2(_objectSpread2({},this.peer._answerSession),{},{media:[g,v]})),sequenceId:t.sequenceId?++t.sequenceId:0},null==f||delete f.next),(y=null==a?void 0:a.rtp.find((function(e){return"opus"===e.codec})))&&(null==a?void 0:a.fmtp)&&(S=null==a?void 0:a.fmtp.find((function(e){return e.payload===y.payload})))&&this._context&&(S.config+=";stereo=1;sprop-stereo=1"),t.isPublic&&chromeVersion>=86&&(null==(E=null==s?void 0:s.rtp.filter((function(e){return"H264"===e.codec})))?void 0:E.length)&&(null==s?void 0:s.fmtp)&&(null==s||s.fmtp.forEach((function(e){E.find((function(t){return t.payload===e.payload}))&&(e.config+=";sps-pps-idr-in-keyframe=1")}))),e.abrupt("return",{partialSdp:h,audioMid:l,videoMid:d,type:"incroffer",semantics:"unified-plan",audioTransceiverInit:c,videoTransceiverInit:u,allSsrc:f,peerConnectionMode:this.peerConnectionMode,signalingAck:m});case 15:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"handleAck",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.logger.info("handleAck()","item: %o",t),this._sdpQueue.enqueue(t)));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"dequeue",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._queueBusy=!0,a=this._sdpQueue.dequeue(),this.logger.info("dequeue()","ret: %o",a),a){e.next=4;break}return e.abrupt("return",void(this._queueBusy=!1));case 4:if(s=[],e.prev=5,c=a.items,u=a.sdpStrategy,l=[],d=[],p=[],u!==SdpStrategy.ADD){e.next=11;break}return e.delegateYield(_regeneratorRuntime().mark((function e(){var a,u;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:delete(a=_objectSpread2({},y.peer._answerIce)).candidates,_=!1,h=!1,e.prev=4,u=function(){var e=g.value,c=e.audioMid,u=e.videoMid,_=e.action,h=e.audioTransceiverInit,f=e.videoTransceiverInit,m=e.signalingAck,v=e.stream,S=v instanceof RemoteStream;if(e.onSuccess&&p.push(e.onSuccess),e.onFail&&s.push(e.onFail),S&&(null==m?void 0:m.sequenceId)<v.sequenceId)return"break";var E={},T={},b=lib$1.parse(m.sdp);Array.isArray(b.media)&&b.media.sort((function(e,t){var r;return null==(r=null==e?void 0:e.type)?void 0:r.localeCompare(null==t?void 0:t.type)})).forEach((function(e){"audio"===(e=_objectSpread2(_objectSpread2({},e),a)).type?(E=e).mid=c:(T=e).mid=u}));var R=v.streamId;if(_===SdpAction.publish&&(R=null==(t=v.stream)?void 0:t.id),!y._mlinesCache[R])return"break";var C=_slicedToArray(y._mlinesCache[R],2),k=C[0],I=C[1];if(h&&k){v.audioTransceiver=y._peerConnection.addTransceiver(h.track,h.init),y._reportRtcInvokeStatus("chromeHandler.addTrack",JSON.stringify({audioStreamTrack:mediaTrackStringify(h.track)}));var A=y._inactiveMlineIndex.shift();A||(A=y.peer._offerMlines.length),y.peer._offerMlines[A]=_objectSpread2({},k),y.peer._answerMlines[A]=E,encodedTransformSupported$2&&v.initAudioEncodedTransform()}if(f&&I){v.videoTransceiver=y._peerConnection.addTransceiver(f.track,f.init),y._reportRtcInvokeStatus("chromeHandler.addTrack",JSON.stringify({videoStreamTrack:mediaTrackStringify(f.track)}));var O=y._inactiveMlineIndex.shift();O||(O=y.peer._offerMlines.length),y.peer._offerMlines[O]=_objectSpread2({},I),_===SdpAction.publish&&(null==(n=null==(r=y._context)?void 0:r.serverConfig)?void 0:n.videoCodec)&&setCodecPreferences(T,null==(o=null==(i=y._context)?void 0:i.serverConfig)?void 0:o.videoCodec),y.peer._answerMlines[O]=T,encodedTransformSupported$2&&v.initVideoEncodedTransform()}l.push(v.streamId||""),d.push(S?v.userId:"local"),S&&(v.sequenceId=null==m?void 0:m.sequenceId),delete y._mlinesCache[R]},m=_asyncIterator(c);case 7:return e.next=9,m.next();case 9:if(!(_=!(g=e.sent).done)){e.next=16;break}if("break"!==u()){e.next=13;break}return e.abrupt("break",16);case 13:_=!1,e.next=7;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(4),h=!0,f=e.t0;case 22:if(e.prev=22,e.prev=23,!_||null==m.return){e.next=27;break}return e.next=27,m.return();case 27:if(e.prev=27,!h){e.next=30;break}throw f;case 30:return e.finish(27);case 31:return e.finish(22);case 32:case"end":return e.stop()}}),e,null,[[4,18,22,32],[23,,27,31]])}))(),"t0",9);case 9:e.next=13;break;case 11:v={},c.forEach((function(e){var t=e.audioMid,r=e.videoMid,n=e.action;v[t]=t,n!==SdpAction.removetrack&&(v[r]=r),v[t]=t})),this.peer._offerMlines=this.peer._offerMlines.map((function(e,t){return v[e.mid]&&(e=closeMline(e),y._inactiveMlineIndex.push(t)),e})),this._inactiveMlineIndex.sort((function(e,t){return e-t})),this.peer._answerMlines=this.peer._answerMlines.map((function(e){return v[e.mid]&&(e=closeMline(e)),e}));case 13:return e.prev=13,e.next=16,this.setDescription(l.length?{streamId:l.join(","),streamUserId:d.join(",")}:void 0);case 16:e.next=25;break;case 18:if(e.prev=18,e.t1=e.catch(13),e.t2="have-local-offer"===this._peerConnection.signalingState,!e.t2){e.next=24;break}return e.next=24,this._peerConnection.setLocalDescription({type:"rollback"});case 24:throw e.t1;case 25:try{p.forEach((function(e){return e()}))}catch(S){}this.logger.info("dequeue","loop"),e.next=32;break;case 29:e.prev=29,e.t3=e.catch(5),this.logger.error("dequeue","unknown error: %o",e.t3),s.forEach((function(t){return t(e.t3)}));case 32:return e.prev=32,this.dequeue(),e.finish(32);case 35:case"end":return e.stop()}}),e,this,[[5,29,32,35],[13,18]])}))),function(){return i.apply(this,arguments)})},{key:"getDefaultSdp",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._genOfferSdp();case 2:return t=e.sent,this.createAVMlineOfferTpl(t),r=lib$1.parse(t),n=[],e.abrupt("return",(r.media=r.media.filter((function(e){return"recvonly"===e.direction&&(Array.isArray(e.ext)&&(e.ext=e.ext.filter((function(e){return"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"!==e.uri}))),n.push("".concat(e.mid)),!0)})),r.groups=[{mids:n.join(" "),type:"BUNDLE"}],isRRTRSupported&&pushRRTR(r),{sdp:lib$1.write(r),semantics:"unified-plan",type:"incroffer"}));case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"rollback",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.msid,delete this._mlinesCache[r];case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"createAVMlineOfferTpl",value:function(e){var t=this,r=lib$1.parse(e);r.media.forEach((function(e){"audio"===e.type?"sendonly"===e.direction?t._aSendonlyOfferTpl=e:(Array.isArray(e.ext)&&(e.ext=e.ext.filter((function(e){return"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"!==e.uri}))),t._aRecvonlyOfferTpl=e):"video"===e.type&&("sendonly"===e.direction?t._vSendonlyOfferTpl=e:(Array.isArray(e.ext)&&(e.ext=e.ext.filter((function(e){return"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"!==e.uri}))),t._vRecvonlyOfferTpl=e))})),isRRTRSupported&&pushRRTR(r)}},{key:"_genOfferSdp",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,createDefaultSdp(!0);case 3:if(t=e.sent){e.next=6;break}throw"pc.createOffer() return empty.";case 6:e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),r="Get offer Error. "+(e.t0.message|e.t0),new SDKError(ErrorCode.NOT_SUPPORTED,r);case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,null,[[0,8]])}))),function(){return t.apply(this,arguments)})}]),u}(BasicHandler),FirefoxHandler=function(e){_inherits(l,e);var t,r,n,i,o,a,s,c,u=_createSuper(l);function l(e,t){var r;return _classCallCheck(this,l),r=u.call(this,e,t),__publicField(_assertThisInitialized(r),"name","firefox"),__publicField(_assertThisInitialized(r),"_aRecvonlyOfferTpl"),r.logger=new Logger$1$1("FirefoxHandler",3,e.id),r}return _createClass(l,[{key:"publish",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u,d,p,_,h,f,m,g=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=_get(_getPrototypeOf(l.prototype),"internalPublish",this).call(this,t),o=i.videoDescriptions,a=i.subVideoDescriptions,s=i.audioTransceiverInit,c=i.videoTransceiverInit,t.audioTransceiver=this._peerConnection.addTransceiver(s.track,s.init),Array.isArray(c.init.sendEncodings)&&1===c.init.sendEncodings.length&&(c.init.sendEncodings=c.init.sendEncodings.map((function(e){return delete e.rid,e}))),t.videoTransceiver=this._peerConnection.addTransceiver(c.track,c.init),u=getServerNow(),this._report("rtc_begin_create_offer",{direction:"up",stream_id:"",stream_user_id:"",pc_session_id:this.peerConnectionId,vendor_mode:0}),e.next=6,this._peerConnection.createOffer();case 6:return d=e.sent,this._report("rtc_create_offer",{direction:"up",error_code:0,stream_id:"",stream_user_id:"",elapse:getServerNow()-u}),(p=lib$1.parse(d.sdp)).media=null==(r=p.media)?void 0:r.map((function(e){return _objectSpread2(_objectSpread2({},e),g.peer._offerIce)})),pushRRTR(p),e.next=13,this.setLocalDescription(lib$1.write(p));case 13:return _=t.audioTransceiver.mid,h=t.videoTransceiver.mid,f=null,m=null,p.media=null==(n=p.media)?void 0:n.map((function(e){var t,r,n,i,o;if("".concat(e.mid)===_){var a=null==(f=e)?void 0:f.rtp.find((function(e){return"opus"===e.codec}));if(a&&f.fmtp){var s=f.fmtp.find((function(e){return e.payload===a.payload}));s&&(null==(t=g._context)?void 0:t.audioProfileManager)&&(s.config=g._context.audioProfileManager.getOpusConfigStr(s.config))}}else"".concat(e.mid)===h&&((null==(n=null==(r=g._context)?void 0:r.serverConfig)?void 0:n.videoCodec)&&setCodecPreferences(e,null==(o=null==(i=g._context)?void 0:i.serverConfig)?void 0:o.videoCodec),m=e);return e})),this.addBitrateLimit(m,t.videoEncodeConfig[0].maxKbps),e.next=19,this.setLocalDescription(lib$1.write(p));case 19:return e.abrupt("return",{partialSdp:getLocalPartialSdp(p,f,m),audioMid:_,videoMid:h,type:"incroffer",semantics:"unified-plan",videoDescriptions:o,subVideoDescriptions:a,audioTransceiverInit:s,videoTransceiverInit:c,peerConnectionMode:this.peerConnectionMode});case 20:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"subscribe",value:(s=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("subscribe()"),d="",p="",_=!1,h=!1,t.virtual?_=!0:(r.multiChatMode||(_=!0),h=!0),_&&(t.audioTransceiver=this._peerConnection.addTransceiver("audio",{direction:"recvonly"})),h&&(t.videoTransceiver=this._peerConnection.addTransceiver("video",{direction:"recvonly"})),f=getServerNow(),this._report("rtc_begin_create_offer",{direction:"up",stream_id:t.streamId,stream_user_id:t.userId,pc_session_id:this.peerConnectionId,vendor_mode:0}),e.next=7,this._peerConnection.createOffer();case 7:return m=e.sent,this._report("rtc_create_offer",{error_code:0,direction:"up",stream_id:t.streamId,stream_user_id:t.userId,elapse:getServerNow()-f}),(g=lib$1.parse(m.sdp)).media=null==(n=g.media)?void 0:n.map((function(e){return _objectSpread2(_objectSpread2({},e),T.peer._offerIce)})),g.media.map((function(e){var t,r,n,i;"video"===e.type&&(isTransportCCSupport?(e.ext=null==(t=e.ext)?void 0:t.filter((function(e){return-1===e.uri.indexOf("abs-send-time")})),e.rtcpFb=null==(r=e.rtcpFb)?void 0:r.filter((function(e){return"goog-remb"!==e.type}))):(e.rtcpFb=null==(n=e.rtcpFb)?void 0:n.filter((function(e){return"transport-cc"!==e.type})),e.ext=null==(i=e.ext)?void 0:i.filter((function(e){return-1===e.uri.indexOf("transport")}))))})),isRRTRSupported&&pushRRTR(g),e.next=15,this.setLocalDescription(lib$1.write(g),{streamId:t.streamId||"",streamUserId:t.userId});case 15:if(d=null==(i=t.audioTransceiver)?void 0:i.mid,p=null==(o=t.videoTransceiver)?void 0:o.mid,null==(a=g.media)||a.forEach((function(e){"".concat(e.mid)===d?u=e:"".concat(e.mid)===p&&(l=e)})),d&&u||(d="audio_".concat(p),u=_objectSpread2(_objectSpread2({},this._aRecvonlyOfferTpl),{},{mid:d})),t.audioMid=d,t.videoMid=p,r.multiChatMode||t.virtual||!this._aSendonlyAnswerTpl||!this._aSendonlyAnswerTpl){e.next=25;break}v=generateAllSsrc(this._nextSsrc),this._nextSsrc=v.next,S=_objectSpread2(_objectSpread2(_objectSpread2({},this._aSendonlyAnswerTpl),this.peer._answerIce),{},{mid:d,msid:"".concat(t.streamId).concat((null==(s=this._context)?void 0:s.avSync)?"":"-audio"," ").concat(t.streamId,"-audio"),ssrcs:generateSsrc(t.streamId,"audio",v.audio)}),E=_objectSpread2(_objectSpread2(_objectSpread2({},this._vSendonlyAnswerTpl),this.peer._answerIce),{},{mid:p,msid:"".concat(t.streamId).concat((null==(c=this._context)?void 0:c.avSync)?"":"-video"," ").concat(t.streamId,"-video")},generateSsrcs(t.streamId,v,{flexfec:this._enableSubFlexfec})),y={sdp:lib$1.write(_objectSpread2(_objectSpread2({},this.peer._answerSession),{},{media:[S,E]})),sequenceId:t.sequenceId?++t.sequenceId:0},null==v||delete v.next;case 25:return e.abrupt("return",{partialSdp:getLocalPartialSdp(g,u,l,!1),audioMid:d,videoMid:p,type:"incroffer",semantics:"unified-plan",audioTransceiverInit:t.audioTransceiver?{track:"audio",init:{direction:"recvonly"}}:void 0,videoTransceiverInit:t.videoTransceiver?{track:"video",init:{direction:"recvonly"}}:void 0,allSsrc:v,peerConnectionMode:this.peerConnectionMode,signalingAck:y});case 26:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"handleAck",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.signalingAck,n=t.stream,(i=t.action)!==SdpAction.removetrack){e.next=3;break}return e.abrupt("return","");case 3:if(i!==SdpAction.unpublish&&i!==SdpAction.unsubscribe){e.next=14;break}return e.prev=4,e.next=7,this.close(n);case 7:"function"==typeof t.onSuccess&&t.onSuccess(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),"function"==typeof t.onFail&&t.onFail(e.t0);case 13:return e.abrupt("return",n.streamId||"");case 14:return o=lib$1.parse(null==r?void 0:r.sdp),e.prev=15,e.next=18,this._internalSetRemoteDescription(o.media,n);case 18:"function"==typeof t.onSuccess&&t.onSuccess(),e.next=24;break;case 21:e.prev=21,e.t1=e.catch(15),"function"==typeof t.onFail&&t.onFail(e.t1);case 24:return e.abrupt("return","");case 25:case"end":return e.stop()}}),e,this,[[4,10],[15,21]])}))),function(e){return a.apply(this,arguments)})},{key:"_internalSetRemoteDescription",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={},(a=lib$1.parse(null==(n=this._peerConnection.remoteDescription)?void 0:n.sdp)).media.forEach((function(e){void 0!==e.mid&&(o[e.mid]=e)})),t.forEach((function(e){if("audio"===(e=_objectSpread2(_objectSpread2({},e),u.peer._answerIce)).type&&(r.audioMid?(e.mid=r.audioMid,o[r.audioMid]=e):o[e.mid]=e),"video"===e.type){if(r instanceof LocalStream&&firefoxVersion<=87){var t={};Array.isArray(e.rtp)&&(e.rtp=e.rtp.filter((function(e){return"rtx"!==e.codec||(t[e.payload]=e.payload,!1)}))),"string"==typeof e.payloads&&(e.payloads=e.payloads.split(" ").filter((function(e){return!t[e]})).join(" ")),Array.isArray(e.fmtp)&&(e.fmtp=e.fmtp.filter((function(e){return!t[e.payload]}))),Array.isArray(e.rtcpFb)&&(e.fmtp=e.fmtp.filter((function(e){return!t[e.payload]})))}r.videoMid?(e.mid=r.videoMid,o[r.videoMid]=e):o[e.mid]=e}})),s=lib$1.parse(null==(i=this._peerConnection.localDescription)?void 0:i.sdp),c=s.media.map((function(e){var t=o[e.mid];return"inactive"===e.direction?e:t})),a.groups=s.groups,a.media=c,a.media.map((function(e){var t,r,n,i;"video"===e.type&&(isTransportCCSupport?(e.ext=null==(t=e.ext)?void 0:t.filter((function(e){return-1===e.uri.indexOf("abs-send-time")})),e.rtcpFb=null==(r=e.rtcpFb)?void 0:r.filter((function(e){return"goog-remb"!==e.type}))):(e.rtcpFb=null==(n=e.rtcpFb)?void 0:n.filter((function(e){return"transport-cc"!==e.type})),e.ext=null==(i=e.ext)?void 0:i.filter((function(e){return-1===e.uri.indexOf("transport")}))))})),isRRTRSupported&&pushRRTR(a),e.next=9,this.setRemoteDescription(lib$1.write(a));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getDefaultSdp",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=lib$1.parse(null==(t=this._peerConnection.localDescription)?void 0:t.sdp),this.createAVMlineOfferTpl(null==(r=this._peerConnection.localDescription)?void 0:r.sdp),i=[],e.abrupt("return",(n.media=n.media.filter((function(e){return"recvonly"===e.direction&&(e.mid=e.mid+1,i.push("".concat(e.mid)),!0)})),isRRTRSupported&&pushRRTR(n),n.groups=[{mids:i.join(" "),type:"BUNDLE"}],{sdp:lib$1.write(n),semantics:"unified-plan",type:"incroffer"}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"rollback",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.msid,r=t.stream,n=t.audioMid,i=t.videoMid,e.abrupt("return",(this.logger.warn("rollback()"),this.close(r,n,i)));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"close",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,o,a,s,c,u,l,d,p,_=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("close()"),o=t.audioMid||r,a=t.videoMid||n,s={},t.audioTransceiver&&o&&(t.audioTransceiver.stop(),s[o]=o),t.videoTransceiver&&a&&(t.videoTransceiver.stop(),s[a]=a),c=[],e.next=6,this._peerConnection.createOffer();case 6:return u=e.sent,(l=lib$1.parse(null==u?void 0:u.sdp)).media=l.media.map((function(e){return s[e.mid]&&(e=closeMline(e)),"inactive"!==e.direction&&c.push(e.mid),_objectSpread2(_objectSpread2({},e),_.peer._offerIce)})),d=lib$1.parse(null==(i=this._peerConnection.remoteDescription)?void 0:i.sdp),p={},d.media.forEach((function(e){void 0!==e.mid&&(p[e.mid]=e)})),d.media=l.media.map((function(e){return"inactive"===e.direction?e:p[e.mid]})),l.groups&&d.groups&&(l.groups[0].mids=c.join(" "),d.groups[0].mids=c.join(" ")),e.next=15,this.setLocalDescription(lib$1.write(l));case 15:return e.next=17,this.setRemoteDescription(lib$1.write(d));case 17:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"setCurrentDescription",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._peerConnection.createOffer();case 2:if(e.t0=this._peerConnection.localDescription&&this._peerConnection.remoteDescription,!e.t0){e.next=8;break}return e.next=6,this._peerConnection.setLocalDescription(this._peerConnection.localDescription);case 6:return e.next=8,this._peerConnection.setRemoteDescription(this._peerConnection.remoteDescription);case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"createAVMlineOfferTpl",value:function(e){var t=this,r=lib$1.parse(e);r.media.forEach((function(e){"audio"===e.type&&(t._aRecvonlyOfferTpl=e)})),isRRTRSupported&&pushRRTR(r)}}]),l}(BasicHandler),createHandler=function(e,t){return isFirefox?new FirefoxHandler(e,t):new ChromeHandler(e,t)},RemoveStreamMessage=function(e){return e.streamRemovedBySchedule308="stream removed",e.clientRePublish="client republish",e.publishStreamFaied="publish failed",e.clientUnPublish="client unpublished",e.clientDisconnected="client disconnected",e.videoMuted="video muted",e}(RemoveStreamMessage||{}),StreamControlType=function(e){return e.PushLimitWarn="PushLimitWarn",e}(StreamControlType||{}),SignalEvent=function(e){return e.ON_ADD_STREAM="onAddStream",e.ON_ADD_STREAM_LIST="onAddStreamList",e.ON_REMOVE_STREAM="onRemoveStream",e.ON_REMOVE_STREAM_LIST="onRemoveStreamList",e.USER_DISCONNECTION="userDisconnection",e.USER_DISCONNECTION_LIST="userDisconnectionList",e.USER_CONNECTION="userConnection",e.USER_CONNECTION_LIST="userConnectionList",e.ON_UPDATE_STREAM_ATTRIBUTES="onUpdateStreamAttributes",e.ON_UPDATE_ROOM_ATTRIBUTES="onUpdateRoomAttributes",e.ON_UPDATE_USER_ATTRIBUTES="onUpdateUserAttributes",e.ON_PUSH_TRACK="onPushTrack",e.ON_REMOVE_TRACK="onRemoveTrack",e.ON_CUSTOM_MESSAGE="onCustomMessage",e.NODE_CHANGE="nodeChange",e.USER_MESSAGE_RECEIVED="userMessageReceived",e.USER_BINARY_MESSAGE_RECEIVED="userBinaryMessageReceived",e.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM="userMessageReceivedOutsideRoom",e.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM="userBinaryMessageReceivedOutsideRoom",e.POST_PROCESSING_MESSAGE="postProcessingMessage",e.ON_USER_TOKEN_WILL_EXPIRE="onUserTokenWillExpire",e.STREAM_CONTROL_MESSAGE="streamControlMessage",e.ON_SPEAKER_CHANGE="onSpeakerChange",e.ON_STREAM_FAILED="streamFailed",e.ON_NOTIFY_RECONNECT="notifyReconnect",e.ON_FORWARD_DST_ROOM_USER_KICK="onForwardDstRoomUserKick",e}(SignalEvent||{}),MediaServerSignalEvent=function(e){return e.RSCP="RSCP",e.RTT="RTT",e.SSC="SSC",e}(MediaServerSignalEvent||{}),StateEvent=function(e){return e.ON_CONNECTION_STATE_CHANGE="onConnectionStateChange",e.ON_VENDOR_CONNECTION_STATE_CHANGE="onVendorConnectionStateChange",e.ABNORMAL_DISCONNECTION="normalConnection",e}(StateEvent||{}),UserDisconnectionTag=function(e){return e.userLeave="userLeave",e.connectionLost="connectionLost",e.userDuplicateLogin="userDuplicateLogin",e.kickedByAdmin="kickedByAdmin",e.roleChanged="roleChanged",e.onUserTokenDidExpire="onUserTokenDidExpire",e}(UserDisconnectionTag||{}),UserDisconnectionCode=function(e){return e[e.roomDismissByAdmin=2]="roomDismissByAdmin",e}(UserDisconnectionCode||{}),logger$4=new Logger$1$1("Locker",2),lockId=1,PromiseLock2=function(){function e(t){_classCallCheck(this,e),__publicField(this,"lockingPromise",Promise.resolve()),__publicField(this,"locks",0),__publicField(this,"name",""),__publicField(this,"lockId"),this.lockId=lockId++,t&&(this.name=t),logger$4.info("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}return _createClass(e,[{key:"isLocked",get:function(){return this.locks>0}},{key:"lock",value:function(){var e,t=this;this.locks+=1,logger$4.info("[lock-".concat(this.name,"-").concat(this.lockId,"] locked, current queue ").concat(this.locks,"."));var r=new Promise((function(r){e=function(){t.locks-=1,logger$4.info("[lock-".concat(t.name,"-").concat(t.lockId,"] unlocked, current queue ").concat(t.locks,".")),r()}})),n=this.lockingPromise.then((function(){return e}));return this.lockingPromise=this.lockingPromise.then((function(){return r})),n}}]),e}(),RoomEvent=function(e){return e.RESUBSCRIBE="resubscribe",e.STREAM_FAILED="stream_failed",e.SUBSCRIBE_PUSH_TRACK="subscribe_push_track",e.REMOVE_PUSH_TRACK="remove_push_track",e.VIDEO_FIRST_FRAME="video_first_frame",e.ON_USER_PUBLISH_STATE_CHANGE="on_user_publish_state_change",e.ON_USER_START_AUDIO_CAPTURE="on_user_start_audio_capture",e.ON_USER_STOP_AUDIO_CAPTURE="on_user_stop_audio_capture",e.ON_USER_START_VIDEO_CAPTURE="on_user_start_video_capture",e.ON_USER_STOP_VIDEO_CAPTURE="on_user_stop_video_capture",e.ON_SEI_MESSAGED_RECEIVED="on_sei_messaged_received",e.ON_PUBLISH_RESULT="on_publish_result",e.ON_SUBSCRIBE_RESULT="ON_SUBSCRIBE_RESULT",e.ON_UPDATE_TOKEN_SUCCESS="on_update_token_success",e.ON_REMOTE_STREAM_STATS="ON_REMOTE_STREAM_STATS",e.ON_LOCAL_STREAM_STATS="ON_LOCAL_STREAM_STATS",e.ON_USER_LEAVE="on_user_leave",e.ON_ROOM_ERROR="on_room_error",e.ON_NETWORK_QUALITY="on_network_quality",e.ON_SIMULCAST_SUBSCRIBE_FALLBACK="on_simulcast_subscribe_fallback",e.ON_REMOTE_VIDEO_SIZE_CHANGED="on_remote_video_size_changed",e.RECONNECT_FAILED="reconnect_failed",e.ON_SUBTITLE_STATE_CHANGED="ON_SUBTITLE_STATE_CHANGED",e.ON_SUBTITLE_MESSAGE_RECEIVED="ON_SUBTITLE_MESSAGE_RECEIVED",e.ON_VIDEO_STREAM_BANNED="ON_VIDEO_STREAM_BANNED",e.ON_AUDIO_STREAM_BANNED="ON_AUDIO_STREAM_BANNED",e.ON_FORWARD_STREAM_ERROR="ON_FORWARD_STREAM_ERROR",e.ON_REJOIN_WITH_TCP="ON_REJOIN_WITH_TCP",e.ON_ICE_CONNECT_WITH_TCP="ON_ICE_CONNECT_WITH_TCP",e.PUB_RETRY="PUB_RETRY",e.SUB_RETRY="SUB_RETRY",e}(RoomEvent||{}),StreamMixingEventType=function(e){return e[e.START=1]="START",e[e.START_SUCCESS=2]="START_SUCCESS",e[e.START_FAILED=3]="START_FAILED",e[e.UPDATE=4]="UPDATE",e[e.UPDATE_SUCCESS=5]="UPDATE_SUCCESS",e[e.UPDATE_FAILED=6]="UPDATE_FAILED",e[e.STOP=7]="STOP",e[e.STOP_SUCCESS=8]="STOP_SUCCESS",e[e.STOP_FAILED=9]="STOP_FAILED",e}(StreamMixingEventType||{}),PubState=function(e){return e[e.PUB=0]="PUB",e[e.UNPUB=1]="UNPUB",e}(PubState||{}),RoomProfileMap=(_RoomProfileMap={},_defineProperty$1(_RoomProfileMap,RoomProfileType.communication,[0]),_defineProperty$1(_RoomProfileMap,RoomProfileType.chat,[0]),_defineProperty$1(_RoomProfileMap,RoomProfileType.chatRoom,[1,"IES_chatroom"]),_defineProperty$1(_RoomProfileMap,RoomProfileType.coHost,[1,"IES_PK"]),_defineProperty$1(_RoomProfileMap,RoomProfileType.meeting,[16]),_defineProperty$1(_RoomProfileMap,RoomProfileType.classRoom,[0]),_RoomProfileMap),encodedTransformSupported$1=isEncodedTransformSupported(),VendorHandler=function(e){_inherits(s,e);var t,r,n,i,o,a=_createSuper(s);function s(e,t){var r;return _classCallCheck(this,s),r=a.call(this,e,t),__publicField(_assertThisInitialized(r),"_peerConnectionId",genUuid()),__publicField(_assertThisInitialized(r),"peerConnectionMode",1),__publicField(_assertThisInitialized(r),"name","vendor"),__publicField(_assertThisInitialized(r),"direction","up"),__publicField(_assertThisInitialized(r),"stream"),t.on("ice_state",(function(e){r._report("rtc_ice_state",{pc_session_id:r.peerConnectionId,direction:r.direction,error_code:0,ice_state:e.toUpperCase(),message:"",peer_connection_id:r.peerConnectionId,stream_id:"",stream_user_id:""})})),t.on("disconnect",(function(){r.emit("disconnect")})),r}return _createClass(s,[{key:"publish",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,c,u,l,d,p=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.enableSimulcast=!1,this.stream=t,r=_get(_getPrototypeOf(s.prototype),"internalPublish",this).call(this,t),n=r.videoDescriptions,i=r.subVideoDescriptions,o=r.audioTransceiverInit,a=r.videoTransceiverInit,t.audioTransceiver=this._peerConnection.addTransceiver(o.track,o.init),t.videoTransceiver=this._peerConnection.addTransceiver(a.track,a.init),encodedTransformSupported$1&&(t.initAudioEncodedTransform(),t.initVideoEncodedTransform()),this._report("rtc_begin_create_offer",{direction:"up",stream_id:"",stream_user_id:"",pc_session_id:this.peerConnectionId,vendor_mode:(null==t?void 0:t.vendorCode)||0}),e.next=5,this._peerConnection.createOffer();case 5:return c=e.sent,u=getServerNow(),l=lib$1.parse(c.sdp),Array.isArray(l.media)&&(l.media=l.media.map((function(e){var r,n,i,o,a;if("video"===e.type)(null==(n=null==(r=p._context)?void 0:r.serverConfig)?void 0:n.videoCodec)&&setCodecPreferences(e,null==(o=null==(i=p._context)?void 0:i.serverConfig)?void 0:o.videoCodec),(isSafari||isIOS)&&Array.isArray(e.ext)&&(e.ext=e.ext.filter((function(e){var t;return!(null==(t=null==e?void 0:e.uri)?void 0:t.includes("video-orientation"))}))),isSafari||p.addBitrateLimit(e,t.videoEncodeConfig[0].maxKbps);else if("audio"===e.type){var s=null==e?void 0:e.rtp.find((function(e){return"opus"===e.codec}));if(s&&e.fmtp){var c=e.fmtp.find((function(e){return e.payload===s.payload}));c&&(null==(a=p._context)?void 0:a.audioProfileManager)&&(c.config=p._context.audioProfileManager.getOpusConfigStr(c.config))}}return e}))),d=new RTCSessionDescription({type:"offer",sdp:lib$1.write(l)}),e.prev=10,e.next=13,this._peerConnection.setLocalDescription(d);case 13:this._report("rtc_set_description",{error_code:0,message:d.sdp||"",is_local:"1",direction:"up",stream_id:"",stream_user_id:"",elapse:getServerNow()-u},{type:"offer"}),e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(10),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+d.sdp,is_local:"1",direction:"up",stream_id:"",stream_user_id:"",elapse:getServerNow()-u},{type:"offer"}),e.t0;case 19:return e.abrupt("return",{partialSdp:d.sdp||"",audioMid:"0",videoMid:"1",type:"offer",semantics:"unified-plan",videoDescriptions:n,subVideoDescriptions:i,audioTransceiverInit:o,videoTransceiverInit:a,peerConnectionMode:this.peerConnectionMode,peerConnectionId:this.peerConnectionId});case 20:case"end":return e.stop()}}),e,this,[[10,16]])}))),function(e){return o.apply(this,arguments)})},{key:"subscribe",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stream=t,this.direction="down",t.audioTransceiver=this._peerConnection.addTransceiver("audio",{direction:"recvonly"}),t.videoTransceiver=this._peerConnection.addTransceiver("video",{direction:"recvonly"}),encodedTransformSupported$1&&(t.initAudioEncodedTransform(),t.initVideoEncodedTransform()),this._report("rtc_begin_create_offer",{direction:"down",stream_id:t.streamId,stream_user_id:t.userId,pc_session_id:this.peerConnectionId,vendor_mode:t.vendorCode||0}),e.next=3,this._peerConnection.createOffer();case 3:return r=e.sent,n=getServerNow(),i=lib$1.parse(r.sdp),Array.isArray(i.media)&&(i.media=i.media.map((function(e){if("audio"===e.type){var t=null==e?void 0:e.rtp.find((function(e){return"opus"===e.codec}));if(t&&(null==e?void 0:e.fmtp)){var r=null==e?void 0:e.fmtp.find((function(e){return e.payload===t.payload}));r&&a._context&&(r.config+=";stereo=1;sprop-stereo=1")}}return e}))),o=new RTCSessionDescription({type:"offer",sdp:lib$1.write(i)}),e.prev=8,e.next=11,this._peerConnection.setLocalDescription(o);case 11:this._report("rtc_set_description",{error_code:0,message:o.sdp||"",is_local:"1",direction:"down",stream_id:t.streamId,stream_user_id:t.userId,elapse:getServerNow()-n},{type:"offer"}),e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(8),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+o.sdp,is_local:"1",direction:"down",stream_id:t.streamId,stream_user_id:t.userId,elapse:getServerNow()-n},{type:"offer"}),e.t0;case 17:return e.abrupt("return",{partialSdp:o.sdp||"",audioMid:"0",videoMid:"1",type:"offer",semantics:"unified-plan",peerConnectionMode:this.peerConnectionMode,peerConnectionId:this.peerConnectionId});case 18:case"end":return e.stop()}}),e,this,[[8,14]])}))),function(e){return i.apply(this,arguments)})},{key:"handleAck",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.action!==SdpAction.publish&&t.action!==SdpAction.subscribe){e.next=14;break}return s=new RTCSessionDescription({sdp:null==(r=t.signalingAck)?void 0:r.sdp,type:"answer"}),c=getServerNow(),e.prev=2,e.next=5,this._peerConnection.setRemoteDescription(s);case 5:this._report("rtc_set_description",{error_code:0,message:s.sdp||"",is_local:"1",direction:"down",stream_id:null==(n=t.stream)?void 0:n.userId,stream_user_id:(null==(i=t.stream)?void 0:i.streamId)||"",elapse:getServerNow()-c},{type:"answer"}),e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(2),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+s.sdp,is_local:"1",direction:"down",stream_id:null==(o=t.stream)?void 0:o.userId,stream_user_id:(null==(a=t.stream)?void 0:a.streamId)||"",elapse:getServerNow()-c},{type:"offer"}),e.t0;case 11:"function"==typeof t.onSuccess&&t.onSuccess(),e.next=15;break;case 14:t.action!==SdpAction.unpublish&&t.action!==SdpAction.unsubscribe||this.destroy();case 15:return e.abrupt("return","");case 16:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(e){return n.apply(this,arguments)})},{key:"destroy",value:function(){this.peer.destroy(),_get(_getPrototypeOf(s.prototype),"destroy",this).call(this)}},{key:"getDefaultSdp",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{sdp:"",type:"offer",semantics:""});case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"connect",value:function(){throw new Error("Method not implemented.")}},{key:"rollback",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{this._peerConnection.close()}catch(e2){}case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"peerConnectionId",get:function(){return this._peerConnectionId},set:function(e){this._peerConnectionId=e}}]),s}(BasicHandler),RtcErrorCode=function(e){return e[e.AUTOPLAY_FAILED=-1e3]="AUTOPLAY_FAILED",e[e.TRACK_ERROR=-1001]="TRACK_ERROR",e[e.Fetch_MODIFY=-1002]="Fetch_MODIFY",e[e.BLACK_BROWSER=-1003]="BLACK_BROWSER",e}(RtcErrorCode||{}),defaultConfig={start_interval:100,multiplier:2,max_interval:3e4},RetryLimiter=function(){function e(){_classCallCheck(this,e),__publicField(this,"_times",0),__publicField(this,"_config",defaultConfig),__publicField(this,"initTs",getServerNow())}return _createClass(e,[{key:"getRetryDelay",value:function(){return Math.min(this._config.max_interval,Math.pow(this._config.multiplier,this._times++)*this._config.start_interval)}},{key:"setConfig",value:function(e){this._config=e}},{key:"reset",value:function(){this._times=0}}]),e}(),IceConfigRequestManager=function(){function e(t){_classCallCheck(this,e),__publicField(this,"_reconnectTimer"),__publicField(this,"_abortControllers",[]),__publicField(this,"_monitor"),__publicField(this,"logger"),__publicField(this,"_groupConfigId",genUuid()),__publicField(this,"_retryLimiter",new RetryLimiter),__publicField(this,"_timer"),this._ctx=t,this._monitor=getMonitor(t.id),this.logger=new Logger$1$1("ICERequest",4,t.id)}var t,r,n,i;return _createClass(e,[{key:"getICENode",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("getICENode","invoke"),e.prev=1,e.next=4,this._getAccessWithRetry(t);case 4:if(0!==(r=e.sent).length){e.next=7;break}throw new Error("server return empty nodes.");case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(1),this._reportRtcInvokeStatus("es.join.getNodeFailed",e.t0),new SDKError(ErrorCode.ICE_SERVER_WRONG,"get ICE config failed: ".concat(e.t0.message),e.t0);case 12:return e.abrupt("return",(this.logger.success("getICENode","success"),this._reportRtcInvokeStatus("es.join.getNodeSuccess",r),r));case 13:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e){return i.apply(this,arguments)})},{key:"_getAccessWithRetry",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return 0!==r&&this.logger.info("_getAccessWithRetry()","invoke feedbackInfo: %o, 201count: %o",e,r),new Promise((function(n,i){t._getAccessNode(e).then((function(e){t._retryLimiter.reset(),n(e)})).catch((function(o){if(Array.isArray(o)&&o.length>0){if(o.findIndex((function(e){return 400<=e.code&&e.code<500}))>-1)return t._retryLimiter.reset(),i(new Error("HTTP request failed(4xx)"));if(o.every((function(e){var t;return 201===e.code||201===(null==(t=e.error)?void 0:t.code)}))&&r++,3===r)return t._retryLimiter.reset(),i(new Error("HTTP request failed(201)"))}var a=t._retryLimiter.getRetryDelay();t.logger.warn("_getAccessWithRetry()","_getAccessWithRetry error, will retry after ".concat(a,"ms"),o),t._reconnectTimer=self.setTimeout((function(){t._getAccessWithRetry(e,r).then(n).catch(i)}),a)}))}))}},{key:"_getAccessNode",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var i=sdkCache.getAccessNode(r._ctx.appId);i?(r.logger.info("getAccessNode","use cache node."),e(Array.isArray(i)?i:[i]),r._timer=window.setTimeout((function(){r._getAccessNodeFromServer(t),r._reportRtcInvokeStatus("es.R.node.cache",i),delete r._timer}),0)):r._getAccessNodeFromServer(t).then(e).catch(n)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"_getAccessNodeFromServer",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._getAccessUrls(),n=r.urls,i=r.needFallback,e.abrupt("return",this.getICEConfigFromServer(n,t).then((function(e){var t=e.nodes;return!o._ctx.useCloudProxy&&sdkCache.setAccessNode(o._ctx.appId,t,e.ttl||11200),e.dispatchDomains&&!o._ctx.useCloudProxy&&sdkCache.setAccessUrls(e.dispatchDomains),t})).catch((function(e){if(i)return o._reportRtcInvokeStatus("es.R.req.fallback",""),sdkCache.clearAccessUrls(),o._getAccessNodeFromServer(t);throw e})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_getAccessUrls",value:function(){var e=sdkCache.getAccessUrls()||[],t=!0;return this._reportRtcInvokeStatus("es.R.req.cache.urls",e),0===e.length&&(e=Config2.ICE_CONFIG_REQUEST_URLS,t=!1,this._reportRtcInvokeStatus("es.R.req.external.urls",e)),0===e.length&&(e=Config2.ICE_CONFIG_REQUEST_URLS_INTERNAL,t=!1,this._reportRtcInvokeStatus("es.R.req.internal.urls",e)),{urls:e,needFallback:t}}},{key:"getICEConfigFromServer",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=genUuid(),s={appID:this._ctx.appId,deviceID:sdkCache.getDeviceId(),connectSessionID:a,os:"web",sdkVersion:Config2.VERSION,isOversea:Config2.OVERSEA,expectedAddr:getParameter("EXPECTED_ADDR"),productPlatform:"VolcEngine",enableCloudProxy:this._ctx.useCloudProxy,expectedIDC:this._ctx.expectedIDC},r&&(s.feedbackInfo=r,"ICE_FAILED"!==(null==(i=null==(n=r[0])?void 0:n.feedbackReason)?void 0:i.type)&&delete s.expectedAddr),c=Date.now(),null==(o=this._monitor)||o.report("rtc_get_access",{error_code:0,message:JSON.stringify(s),elapse:0,type:"request",host:t.join(","),config_id:a,group_config_id:this._groupConfigId}),u=t.map(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new AbortController,l._abortControllers.push(n),e.prev=2,e.next=5,fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify(s),signal:n.signal});case 5:i=e.sent,e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(2),o=fetch,Function.prototype.toString.call(o).includes("[native code]")||null==(r=l._monitor)||r.report("rtc_error",{error_code:RtcErrorCode.Fetch_MODIFY,message:"get access failed, possibly due to modifying the browser's Fetch API."},{origin_error:e.t0}),e.t0;case 11:if(l._abortControllers=l._abortControllers.filter((function(e){return e!==n})),200===i.status){e.next=13;break}throw{message:i.statusText,code:i.status};case 13:return e.next=15,i.json();case 15:if(200===(a=e.sent).code){e.next=18;break}throw a;case 18:if(0!==a.nodes.length){e.next=20;break}throw{code:a.code,message:JSON.stringify(a)};case 20:return e.abrupt("return",{url:t,result:a});case 21:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",promiseAny(u).then((function(e){var t,r=e.result,n=e.url;return null==(t=l._monitor)||t.report("rtc_get_access",{error_code:200,message:JSON.stringify(r),elapse:Date.now()-c,type:"response",host:n,config_id:a,group_config_id:l._groupConfigId}),r})).catch((function(e){var r,n,i,o;throw null==(o=l._monitor)||o.report("rtc_get_access",{error_code:Number((null==(r=e[0])?void 0:r.code)||(null==(n=e[0])?void 0:n.server_code)),message:null==(i=e[0])?void 0:i.message,elapse:Date.now()-c,type:"response",host:t.join(","),config_id:a,group_config_id:l._groupConfigId},{error:JSON.stringify(e)}),e})));case 6:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"destroy",value:function(){this._abortControllers.forEach((function(e){return e.abort()})),this._reconnectTimer&&(window.clearTimeout(this._reconnectTimer),delete this._reconnectTimer),this._timer&&(window.clearTimeout(this._timer),delete this._timer)}},{key:"_reportRtcInvokeStatus",value:function(e,t){var r;null==(r=this._monitor)||r.report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:0,stream_id:"",elapse:0,group_config_id:this._groupConfigId})}}]),e}(),encodedTransformSupported=isEncodedTransformSupported(),peerConnectionConfiguration={iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",encodedInsertableStreams:!!encodedTransformSupported||void 0},ConnectFailCode=function(e){return e[e.DC_ERROR=0]="DC_ERROR",e[e.DC_CLOSE=1]="DC_CLOSE",e[e.ICE_FAILED=2]="ICE_FAILED",e[e.DESTROY=3]="DESTROY",e[e.TIMEOUT=4]="TIMEOUT",e}(ConnectFailCode||{}),PeerConnectionGUID=0,PeerConnection=function(e){_inherits(s,e);var t,r,n,i,o,a=_createSuper(s);function s(e,t){var r;return _classCallCheck(this,s),r=a.call(this),__publicField(_assertThisInitialized(r),"uuid",(PeerConnectionGUID++).toString()),__publicField(_assertThisInitialized(r),"_peerConnectionId",""),__publicField(_assertThisInitialized(r),"audioTrack4ff"),__publicField(_assertThisInitialized(r),"_pc"),__publicField(_assertThisInitialized(r),"_dc"),__publicField(_assertThisInitialized(r),"_iceNode"),__publicField(_assertThisInitialized(r),"_initSctpEvents",!1),__publicField(_assertThisInitialized(r),"_monitor"),__publicField(_assertThisInitialized(r),"_offerIce",{}),__publicField(_assertThisInitialized(r),"_answerIce",{}),__publicField(_assertThisInitialized(r),"_offerSession"),__publicField(_assertThisInitialized(r),"_answerSession"),__publicField(_assertThisInitialized(r),"_offerMlines",[]),__publicField(_assertThisInitialized(r),"_answerMlines",[]),__publicField(_assertThisInitialized(r),"_connectReject"),__publicField(_assertThisInitialized(r),"_logger"),r._ctx=e,r._groupConnectionId=t,r._monitor=getMonitor(e.id),r._logger=new Logger$1$1("PeerConnection_".concat(r.uuid),4,e.id),r._pc=new RTCPeerConnection(peerConnectionConfiguration),r._pc.ontrack=function(e){var t,n,i=null==(n=null==(t=e.streams)?void 0:t[0])?void 0:n.id;r._print("pc.ontrack","".concat(e.track.kind," ").concat(e.track.id," ").concat(i)),"ff-stream"===i&&(r.audioTrack4ff=e.track),r.emit("ontrack",e)},r._pc.onconnectionstatechange=function(){r._print("onconnectionstatechange","".concat(r._pc.connectionState,". ice -> ").concat(r._pc.iceConnectionState)),"failed"!==r._pc.iceConnectionState&&"closed"!==r._pc.iceConnectionState&&"failed"!==r._pc.connectionState||r.emit("disconnect","ice failed")},r._pc.oniceconnectionstatechange=function(){var e=r._pc.iceConnectionState;r._report("rtc_pre_ice_state",{message:e,ice_state:e.toUpperCase()}),r.emit("ice_state",e)},r}return _createClass(s,[{key:"getOriginRTCPeerConnection",value:function(){return this._pc}},{key:"getOriginRTCDataChannel",value:function(){return this._dc}},{key:"getConnectionId",value:function(){return this._peerConnectionId}},{key:"getGroupConnectionId",value:function(){return this._groupConnectionId}},{key:"connect",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u,l,d=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._print("connect","invoke. %o",t),this._iceNode=t,(r=this._pc.createDataChannel("signaling",{negotiated:!0,id:100})).binaryType="arraybuffer",this._dc=r,e.next=5,this._genIceInfo(t);case 5:return n=e.sent,i=n.offerIce,o=n.answerIce,this._offerIce=i,this._answerIce=o,this._peerConnectionId=o.iceUfrag||"",isFirefox&&(this._pc.addTransceiver("audio",{direction:"recvonly"}),this._pc.addTransceiver("video",{direction:"recvonly"})),e.next=11,this._pc.createOffer();case 11:if((a=e.sent).sdp){e.next=14;break}throw new SDKError(ErrorCode.NOT_SUPPORTED,"create offer sdp failed.");case 14:if(s=lib$1.parse(a.sdp),c=_slicedToArray(s.media,1),u=c[0],this._offerIce.fingerprint=s.fingerprint||u.fingerprint,!isFirefox){e.next=27;break}return s.media=s.media.map((function(e){var t,r,n,i,o=_objectSpread2(_objectSpread2({},e),d._offerIce);return"video"===o.type&&(isTransportCCSupport?(o.ext=null==(t=o.ext)?void 0:t.filter((function(e){return-1===e.uri.indexOf("abs-send-time")})),o.rtcpFb=null==(r=o.rtcpFb)?void 0:r.filter((function(e){return"goog-remb"!==e.type}))):(o.rtcpFb=null==(n=o.rtcpFb)?void 0:n.filter((function(e){return"transport-cc"!==e.type})),o.ext=null==(i=o.ext)?void 0:i.filter((function(e){return-1===e.uri.indexOf("transport")})))),o})),isRRTRSupported&&pushRRTR(s),(l=_objectSpread2({},s)).fingerprint=this._answerIce.fingerprint,l.media=l.media.map((function(e){return delete(e=_objectSpread2(_objectSpread2({},e),d._answerIce)).bundleOnly,e.port=9,"application"===e.type?e.sctpmap={sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144}:("audio"===e.type&&(e.msid="ff-stream ff-stream-audio"),e.direction="sendonly"),e})),isRRTRSupported&&pushRRTR(l),e.next=23,this.setLocalDescription(lib$1.write(s));case 23:return e.next=25,this.setRemoteDescription(lib$1.write(l));case 25:e.next=30;break;case 27:delete s.media,this._offerSession=_objectSpread2({},s),this._answerSession=_objectSpread2({},s),this._answerSession.fingerprint&&(this._answerSession.fingerprint=this._answerIce.fingerprint),this._offerMlines=[_objectSpread2(_objectSpread2(_objectSpread2({},u),this._offerIce),{},{mid:"".concat(0)})],this._answerMlines=[_objectSpread2(_objectSpread2(_objectSpread2({},u),this._answerIce),{},{sctpmap:{sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144},mid:"".concat(0)})],this.setDescription();case 30:return e.next=32,new Promise((function(e,t){d._connectReject=t,r.onopen=function(){d._print("connect","dataChannel open"),d._reportRtcInvokeStatus("es.dc.open",""),e(""),delete d._connectReject},r.onerror=function(e){var t,r,n,i;d._report("rtc_signaling_msg_error",{error_code:null==(t=null==e?void 0:e.error)?void 0:t.sdpLineNumber,message:null==(r=null==e?void 0:e.error)?void 0:r.errorDetail,reason:"invalid data"}),d._reportRtcInvokeStatus("es.dc.error",""),null==(i=d._connectReject)||i.call(d,{message:"dc.onerror, ".concat(null==(n=e.error)?void 0:n.errorDetail),code:0}),d.emit("disconnect","dc onerror"),delete d._connectReject},r.onclose=function(){var e;d._reportRtcInvokeStatus("es.dc.close",""),null==(e=d._connectReject)||e.call(d,{message:"dc.onclose",code:1}),d.emit("disconnect","dc onclose"),delete d._connectReject},d._pc.addEventListener("connectionstatechange",(function(){var e;"failed"!==d._pc.iceConnectionState&&"closed"!==d._pc.iceConnectionState&&"failed"!==d._pc.connectionState||(null==(e=d._connectReject)||e.call(d,{message:"pc.connectionstatechange -> ".concat(d._pc.connectionState,", ice -> ").concat(d._pc.iceConnectionState),code:2}),delete d._connectReject)})),setTimeout((function(){var e;null==(e=d._connectReject)||e.call(d,{code:4,message:"connect timeout"}),delete d._connectReject}),8e3)}));case 32:return this._print("connect","dataChannel establish success"),e.abrupt("return",r);case 34:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"setDescription",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._print("setDescription","invoke."),this._offerSession.media=this._offerMlines,this._answerSession.media=this._answerMlines,r=[],this._offerMlines.forEach((function(e){"inactive"!==e.direction&&e.mid&&r.push(e.mid)})),this._offerSession.groups&&this._answerSession.groups&&(this._offerSession.groups[0].mids=r.join(" "),this._answerSession.groups[0].mids=r.join(" ")),n=getServerNow(),t&&this._report("rtc_begin_create_offer",{direction:"local"===t.streamUserId?"up":"down",stream_id:t.streamId,stream_user_id:t.streamUserId,pc_session_id:this._peerConnectionId,vendor_mode:0}),e.next=7,this._pc.createOffer();case 7:return t&&this._report("rtc_create_offer",{error_code:0,direction:"local"===t.streamUserId?"up":"down",stream_id:t.streamId,stream_user_id:t.streamUserId,elapse:getServerNow()-n}),e.next=10,this.setLocalDescription(lib$1.write(this._offerSession),t);case 10:return e.next=12,this.setRemoteDescription(lib$1.write(this._answerSession),t);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setLocalDescription",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=getServerNow(),e.prev=1,e.next=4,this._pc.setLocalDescription(new RTCSessionDescription({type:"offer",sdp:t}));case 4:if(this._report("rtc_set_description",{error_code:0,message:t,is_local:"1",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:(null==r?void 0:r.streamId)||"",stream_user_id:(null==r?void 0:r.streamUserId)||"",elapse:getServerNow()-i},{type:"offer"}),this._initSctpEvents){e.next=9;break}this._initSctpEvents=!0,(o=null==(n=this._pc)?void 0:n.sctp)&&(o.onstatechange=function(){a._reportRtcInvokeStatus("sctp","sctp state change TO: ".concat(o.state))},o.transport&&(o.transport.onstatechange=function(){var e;a._reportRtcInvokeStatus("dtls","dtls state change TO: ".concat(null==(e=null==o?void 0:o.transport)?void 0:e.state))}));case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),console.error("setLocal",e.t0),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+t,is_local:"1",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:"",stream_user_id:"",elapse:getServerNow()-i},{type:"offer"});case 14:case"end":return e.stop()}}),e,this,[[1,11]])}))),function(e,t){return n.apply(this,arguments)})},{key:"setRemoteDescription",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=getServerNow(),e.prev=1,e.next=4,this._pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:t}));case 4:this._report("rtc_set_description",{error_code:0,message:t,is_local:"0",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:(null==r?void 0:r.streamId)||"",stream_user_id:(null==r?void 0:r.streamUserId)||"",elapse:getServerNow()-n},{type:"answer"}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.error("setRemote",e.t0),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+t,is_local:"0",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:(null==r?void 0:r.streamId)||"",stream_user_id:(null==r?void 0:r.streamUserId)||"",elapse:getServerNow()-n},{type:"answer"});case 10:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e,t){return r.apply(this,arguments)})},{key:"disconnect",value:function(){var e,t;null==(e=this._connectReject)||e.call(this,{code:3,message:"invoke destroy()"}),delete this._connectReject,this._pc.close(),null==(t=this._dc)||t.close(),this._pc.ontrack=null}},{key:"destroy",value:function(){this._print("destroy",this._peerConnectionId),_get(_getPrototypeOf(s.prototype),"removeAllListeners",this).call(this),this.disconnect()}},{key:"_genIceInfo",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0={iceUfrag:null==(r=t.iceParams)?void 0:r.clientIceUfrag,icePwd:null==(n=t.iceParams)?void 0:n.clientIcePwd,iceOptions:"renomination"},e.next=3,parseAnswerIceParams(t);case 3:return e.t1=e.sent,e.abrupt("return",{offerIce:e.t0,answerIce:e.t1});case 5:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"_print",value:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];(t=this._logger).info.apply(t,["".concat(e)].concat(n))}},{key:"_report",value:function(e,t,r){var n,i,o;null==(o=this._monitor)||o.report(e,_objectSpread2(_objectSpread2({},t),{},{connection_id:this._peerConnectionId,group_connection_id:this._groupConnectionId}),_objectSpread2(_objectSpread2({},r),{},{tcp_only:null==(n=this._iceNode)?void 0:n.iceConfig.tcpOnly,ms_addr:JSON.stringify((null==(i=this._iceNode)?void 0:i.publicIPs.map((function(e){return{ip:e.ip,tcp:e.tcpPorts,udp:e.udpPorts}})))||[])}))}},{key:"_reportRtcInvokeStatus",value:function(e,t){this._report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:0,stream_id:"",elapse:0})}}],[{key:"checkSupported",value:function(){if(!RTCPeerConnection)throw new SDKError(ErrorCode.NOT_SUPPORTED,"missing RTCPeerConnection API.");["addTransceiver","createDataChannel","createOffer","setLocalDescription","setRemoteDescription"].forEach((function(e){var t;if(!(null==(t=null==RTCPeerConnection?void 0:RTCPeerConnection.prototype)?void 0:t[e]))throw new SDKError(ErrorCode.NOT_SUPPORTED,"missing peer.".concat(e," API."))}))}}]),s}(EnhancedEventEmitter),DC_MESSAGE_DIRECTION=function(e){return e[e.SEND=0]="SEND",e[e.FEEDBACK=1]="FEEDBACK",e}(DC_MESSAGE_DIRECTION||{}),DC_MESSAGE_FUNCTION_TYPE=function(e){return e[e.P2P=0]="P2P",e[e.SIGNAL=1]="SIGNAL",e[e.BROADCAST=2]="BROADCAST",e[e.BUSINESS_SERVER=3]="BUSINESS_SERVER",e}(DC_MESSAGE_FUNCTION_TYPE||{}),USER_MESSAGE_SEND_RESULT=function(e){return e[e.SUCCESS=0]="SUCCESS",e[e.TIMEOUT=1]="TIMEOUT",e[e.BROKEN=2]="BROKEN",e[e.NO_RECEIVER=3]="NO_RECEIVER",e[e.NO_RELAYPATH=4]="NO_RELAYPATH",e[e.EXCEED_QPS=5]="EXCEED_QPS",e[e.SEND_TO_SERVER_ERROR=17]="SEND_TO_SERVER_ERROR",e[e.SERVER_RESPONSE_ERROR=18]="SERVER_RESPONSE_ERROR",e[e.NOT_JOIN=100]="NOT_JOIN",e[e.NOT_LOGIN=105]="NOT_LOGIN",e[e.SERVER_PARAMS_NOTSET=106]="SERVER_PARAMS_NOTSET",e[e.UNKNOWN=1e3]="UNKNOWN",e}(USER_MESSAGE_SEND_RESULT||{}),USER_MESSAGE_SEND_RESULT_EXPLAIN={0:[0,"success"],1:[ErrorCode.USER_MESSAGE_TIMEOUT,"timeout, failed to send."],2:[ErrorCode.USER_MESSAGE_BROKEN,"dataChannel broken, failed to send."],3:[ErrorCode.USER_MESSAGE_NO_RECEIVER,"cannot find the receiver."],4:[ErrorCode.USER_MESSAGE_NO_RECEIVER,"cannot find relay path."],5:[ErrorCode.USER_MESSAGE_EXCEED_QPS,"cannot find relay path."],17:[ErrorCode.USER_MESSAGE_SEND_TO_SERVER_ERROR,"failed to send to business server."],18:[ErrorCode.USER_MESSAGE_SERVER_RESPONSE_ERROR,"business server response error."],100:[ErrorCode.USER_MESSAGE_NOT_JOIN,"not join room"],105:[ErrorCode.USER_MESSAGE_NOT_LOGIN,"not login."],106:[ErrorCode.USER_MESSAGE_SERVER_PARAMS_NOTSET,"server param is not set."],1e3:[ErrorCode.USER_MESSAGE_UNKNOWN,"unknown."]},noPrintSignaling=[],SIGNALING_FUNCTION_TYPE=function(e){return e[e.C2S=0]="C2S",e[e.C2C=1]="C2C",e[e.C2GW=2]="C2GW",e[e.C2CDirect=3]="C2CDirect",e[e.C2RTM=4]="C2RTM",e}(SIGNALING_FUNCTION_TYPE||{}),DataChannelSignaling=function(e){_inherits(a,e);var t,r,n,i,o=_createSuper(a);function a(e,t){var r;return _classCallCheck(this,a),r=o.call(this),__publicField(_assertThisInitialized(r),"_singlingCache",new Map),__publicField(_assertThisInitialized(r),"_p2pCache",new Map),__publicField(_assertThisInitialized(r),"_rttIds",{}),__publicField(_assertThisInitialized(r),"_p2pMessageId",1),__publicField(_assertThisInitialized(r),"_clearDataChannelListener"),__publicField(_assertThisInitialized(r),"_monitor"),__publicField(_assertThisInitialized(r),"logger"),r.id=e,r._dataChannel=t,r._clearDataChannelListener=r._handleHandler(),r._monitor=getMonitor(e),r.logger=new Logger$1$1("DataChannelSignaling",3,e),r}return _createClass(a,[{key:"destroy",value:function(){var e=this;this._dataChannel&&(this._clearDataChannelListener(),this._dataChannel.close()),this._singlingCache.forEach((function(t,r){t.error(new SDKError(ErrorCode.OPERATION_CANCEL,"disconnect")),e._singlingCache.delete(r)})),this._singlingCache.clear(),this._p2pCache.clear(),this._p2pMessageId=1,this._rttIds={}}},{key:"sendSignaling",value:function(e,t,r){var n,i=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6e4;return null==(n=this._monitor)||n.report("rtc_signaling",{error_code:0,message:JSON.stringify(t),signaling_event:"call-".concat(e),signaling_type:"Send",stream_id:t.streamId,stream_user_id:t.streamUserId,direction:"up"}),new Promise((function(n,a){var s=i._genHeader(r);s.id=createRandomId();var c=s.id.join("-"),u="customMessage"===e;u&&RTSMsgReportor.samplingOne2ManyMsg(i.id,Number(s.id.join("")),t);var l=setTimeout((function(){i._singlingCache.delete(c),a(new SDKError(ErrorCode.TIME_OUT,"".concat(e," message time out"))),u&&RTSMsgReportor.updateOne2ManyMsgAck(i.id,t,999)}),o);i._singlingCache.set(c,{signalingType:e,success:function(e){clearTimeout(l),n(e),u&&RTSMsgReportor.updateOne2ManyMsgAck(i.id,t,0)},error:function(e){clearTimeout(l),a(e),u&&RTSMsgReportor.updateOne2ManyMsgAck(i.id,t,e.code)}}),i.logger.info("Signal",">>>>>> [".concat(e,"][").concat(c,"]"),t),i._sendMessage(e,s,t)}))}},{key:"sendPingSignaling",value:function(){return this.sendSignaling("CheckConnectivity",{ts:Date.now()},{functionType:2})}},{key:"sendP2PMessage",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.msg,i=_objectWithoutProperties(t,_excluded2$1),o=n instanceof ArrayBuffer,e.t0=this,e.t1=RTSMsgReportor,e.t2=this.id,e.t3=_objectSpread2,e.t4=_objectSpread2({ver:1,id:this._p2pMessageId++,time:Date.now(),dir:DC_MESSAGE_DIRECTION.SEND,type:DC_MESSAGE_FUNCTION_TYPE.P2P,err:USER_MESSAGE_SEND_RESULT.SUCCESS},i),e.t5={},e.t6=o,!o){e.next=15;break}return e.next=12,Utils.ab2b64str(n);case 12:e.t7=e.sent,e.next=16;break;case 15:e.t7=n;case 16:return e.t8=e.t7,e.t9={binary:e.t6,msg:e.t8},e.t10=(0,e.t3)(e.t4,e.t5,e.t9),e.t11=e.t1.samplingP2PMsg.call(e.t1,e.t2,e.t10),e.t12=r,e.abrupt("return",e.t0._sendP2PMessage.call(e.t0,e.t11,e.t12));case 22:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"_sendP2PMessage",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return isRttMessage(e.msg)?this._rttIds[e.id]=e.id:e.dir===DC_MESSAGE_DIRECTION.SEND&&this.logger.info("_sendP2PMessage [DC Signaling p2p >>]",JSON.stringify(e)),new Promise((function(n,i){var o=t._genHeader(_objectSpread2(_objectSpread2({needAck:!0,functionType:1},r),{},{id:createRandomId()}));if(e.dir===DC_MESSAGE_DIRECTION.SEND){var a=setTimeout((function(){t._p2pCache.delete(e.id),i(new SDKError(ErrorCode.USER_MESSAGE_TIMEOUT,"P2P message timeout")),RTSMsgReportor.updateP2PMsgAck(t.id,e,999)}),12e3);t._p2pCache.set(e.id,{success:function(r,i){clearTimeout(a),n(i),RTSMsgReportor.updateP2PMsgAck(t.id,e,0)},error:function(r){clearTimeout(a),RTSMsgReportor.updateP2PMsgAck(t.id,e,r.err);var n=_slicedToArray(USER_MESSAGE_SEND_RESULT_EXPLAIN[r.err]||[ErrorCode.USER_MESSAGE_UNKNOWN,"err: ".concat(r.err,", msg: ").concat(r.msg)],2),o=n[0],s=n[1];i({err:r.err,code:o,message:r.msg||s})}})}try{t._sendMessage("p2p",o,e)}catch(s){throw s.code===ErrorCode.NOT_CONNECTED_YET&&(s.code=ErrorCode.USER_MESSAGE_BROKEN),s}}))}},{key:"_sendMessage",value:function(e,t,r){if(!this._dataChannel||"open"!==this._dataChannel.readyState)throw new SDKError(ErrorCode.NOT_CONNECTED_YET,"DataChannel not open");var n=getParameter("SIGNAL_COMPRESSION")||t.zip,i=t.version+(Number(n)<<4)+(Number(t.encrypt)<<5),o=Number(t.needAck)+(Number(t.direction)<<1)+(Number(t.functionType)<<2)+(Number(t.binary)<<6),a=Utils.str2ab(JSON.stringify([e,r])),s=concatenate(Uint8Array,[i,o].concat(_toConsumableArray(t.id||[])),n||t.zip?pako$1.deflate(new Uint8Array(a)):new Uint8Array(a));this._dataChannel.send(s.buffer),"p2p"===e?RTSMsgReportor.updateP2PMsgReq(this.id,r,s.buffer.byteLength):"customMessage"===e&&RTSMsgReportor.updateOne2ManyMsgReq(this.id,r,s.buffer.byteLength)}},{key:"_dispartData",value:function(e){var t=new Uint8Array(e),r=0,n=t[r++],i=t[r++],o={version:15&n,zip:16==(16&n),encrypt:32==(32&n),needAck:1==(1&i),direction:(2&i)>>1,functionType:(60&i)>>2,binary:64==(64&i)};if(o.needAck||1===o.direction){for(;r<=6;r++)if(!isByteId(t[r])){r++;break}o.id=Array.from(t.slice(2,r))}return{header:o,data:t.slice(r)}}},{key:"_feedbackSignaling",value:function(e,t,r){var n=this._genHeader({needAck:!0,direction:1,id:e.split("-").map((function(e){return Number(e)}))});noPrintSignaling.includes(t)||this.logger.info("Signal",">>>>>> [".concat(t,"-res][").concat(e,"]")),this._sendMessage("".concat(t,"-res"),n,r)}},{key:"_handleMessage",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Date.now(),i=t.byteLength,o=this._dispartData(t),a=o.data,(s=o.header).zip&&((c=new pako$1.Inflate).push(a,!0),a=c.result),u=Utils.ab2str(a),l=[],e.prev=6,l=JSON.parse(u),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(6),e.abrupt("return",void(e.t0 instanceof Error&&(null==(r=this._monitor)||r.report("rtc_signaling_msg_error",{error_code:-1,message:e.t0.message,reason:"message parse failed"}))));case 13:e.t1=s.functionType,e.next=0===e.t1?16:1===e.t1?18:2===e.t1?20:21;break;case 16:return this.C2S(s,l,u,i,n),e.abrupt("break",21);case 18:return this.C2C(l,i,n),e.abrupt("break",21);case 20:this.C2GW(s,l,u);case 21:case"end":return e.stop()}}),e,this,[[6,10]])}))),function(e){return n.apply(this,arguments)})},{key:"C2S",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i,o){var a,s,c,u,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=(null==(a=t.id)?void 0:a.join("-"))||"",1!==t.direction){e.next=5;break}this._handleAckMessage(c,r[0]||{},n),e.next=17;break;case 5:if(!Array.isArray(r)){e.next=17;break}if(u=r[0],r=r[1],noPrintSignaling.includes(u)||this.logger.info("Signal","<<<<<< ".concat(u),r,c),this._feedbackSignaling(c,u,u===SignalEvent.ON_CUSTOM_MESSAGE?_objectSpread2(_objectSpread2({},r),{},{message:""}):""),e.t0=r.binary&&"string"==typeof r.message,!e.t0){e.next=15;break}return e.next=14,Utils.b64str2ab(r.message);case 14:r.message=e.sent;case 15:l=Date.now(),this.emit(u,_objectSpread2({},r)),u===SignalEvent.ON_CUSTOM_MESSAGE&&RTSMsgReportor.reportOne2ManyMsgRecv(this.id,r,{msg_size:i,recv_msg_ts:o,fwd_msg_ts:l}),null==(s=this._monitor)||s.report("rtc_signaling",{error_code:0,message:n,signaling_event:"on-".concat(u),signaling_type:"Recv",stream_id:r.streamId,stream_user_id:r.clientId,direction:"down"});case 17:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i,o){return r.apply(this,arguments)})},{key:"C2C",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,o,a,s,c,u,l,d,p;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Array.isArray(t)&&(t=t[1]),i=null==t?void 0:t.id,e.t0=(this._rttIds[i]||(null==t?void 0:t.dir)===DC_MESSAGE_DIRECTION.FEEDBACK||isRttMessage(null==t?void 0:t.msg)?delete this._rttIds[i]:this.logger.info("Signal","<<<<<< p2p response",t),t.dir),e.next=e.t0===DC_MESSAGE_DIRECTION.SEND?5:e.t0===DC_MESSAGE_DIRECTION.FEEDBACK?43:44;break;case 5:if(o=Date.now(),isRttMessage(null==t?void 0:t.msg)){e.next=41;break}if(s=(a=t).binary,c=a.msg,u=a.room,l=a.to,d=a.from,p=""===u?s?SignalEvent.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM:SignalEvent.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM:s?SignalEvent.USER_BINARY_MESSAGE_RECEIVED:SignalEvent.USER_MESSAGE_RECEIVED,!l){e.next=27;break}if(e.t1=this,e.t2=p,e.t3=_objectSpread2,e.t4=_objectSpread2({},t),e.t5={},!s){e.next=20;break}return e.next=17,Utils.b64str2ab(c);case 17:e.t6=e.sent,e.next=21;break;case 20:e.t6=c;case 21:e.t7=e.t6,e.t8={msg:e.t7},e.t9=(0,e.t3)(e.t4,e.t5,e.t8),e.t1.emit.call(e.t1,e.t2,e.t9),e.next=41;break;case 27:if(e.t10=this,e.t11=SignalEvent.ON_CUSTOM_MESSAGE,e.t12=d,e.t13=s,!s){e.next=37;break}return e.next=34,Utils.b64str2ab(c);case 34:e.t14=e.sent,e.next=38;break;case 37:e.t14=c;case 38:e.t15=e.t14,e.t16={clientId:e.t12,binary:e.t13,message:e.t15},e.t10.emit.call(e.t10,e.t11,e.t16);case 41:return this._sendP2PMessage(_objectSpread2(_objectSpread2({},t),{},{dir:DC_MESSAGE_DIRECTION.FEEDBACK,msg:""})),RTSMsgReportor.reportP2PMsgRecv(this.id,t,{msg_size:r,recv_msg_ts:n,fwd_msg_ts:o}),e.abrupt("break",44);case 43:this._handleP2PMsgFeedback(t);case 44:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})},{key:"C2GW",value:function(e,t,r){var n,i;if(1===e.direction){var o=(null==(n=e.id)?void 0:n.join("-"))||"";this._handleAckMessage(o,t[0]||{},r)}else{var a=_slicedToArray(t,2),s=a[0],c=a[1],u=void 0===c?{}:c;if("RXMediaMsg"===s){var l=u.type,d=u.data;switch(null==(i=this._monitor)||i.report("rtc_signaling",{error_code:0,message:r,signaling_event:"on-".concat(l),signaling_type:"Recv",stream_id:"",stream_user_id:"",direction:"down"}),l){case"RSCP":try{var p=JSON.parse(d);Array.isArray(p)&&this.emit(l,p)}catch(f){}break;case"RTT":try{var _=JSON.parse(d);_.length&&this.emit(l,_[0])}catch(f){}break;case"SSC":try{var h=JSON.parse(d);h.length&&this.emit(l,h[0])}catch(f){}}}}}},{key:"_handleHandler",value:function(){var e=this,t=function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(t){e.logger.warn("_handleHandler","dataChannel close",t)})),r=function(t){e.logger.error("_handleHandler","dataChannel error",t)},n=function(t){e._handleMessage(t.data)};return this._dataChannel.addEventListener("close",t),this._dataChannel.addEventListener("error",r),this._dataChannel.addEventListener("message",n),function(){e._dataChannel.removeEventListener("close",t),e._dataChannel.removeEventListener("error",r),e._dataChannel.removeEventListener("message",n)}}},{key:"_genHeader",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _objectSpread2({version:2,zip:!1,encrypt:!1,needAck:!0,direction:0,functionType:0,binary:!1},e)}},{key:"_handleAckMessage",value:function(e,t,r){var n,i=this._singlingCache.get(e);i&&(this._singlingCache.delete(e),200===t.code?i.success(t):i.error(t),this.logger.info("Signal","<<<<<< [".concat(i.signalingType,"-ack] ").concat(e),t)),null==(n=this._monitor)||n.report("rtc_signaling",{error_code:0,message:r,signaling_event:null==i?void 0:i.signalingType,signaling_type:"Ack",stream_id:"",stream_user_id:"",direction:"down"})}},{key:"_handleP2PMsgFeedback",value:function(e){var t=this._p2pCache.get(e.id);t&&(this._p2pCache.delete(e.id),e.err===USER_MESSAGE_SEND_RESULT.SUCCESS?t.success(e.id,e):t.error(e))}}]),a}(eventemitter3Exports.EventEmitter),freeGlobal$2="object"==("undefined"==typeof global?"undefined":_typeof(global))&&global&&global.Object===Object&&global,freeGlobal$1$1=freeGlobal$2,freeSelf$1="object"==("undefined"==typeof self?"undefined":_typeof(self))&&self&&self.Object===Object&&self,root$9=freeGlobal$1$1||freeSelf$1||Function("return this")(),root$1$1=root$9,Symbol2=root$1$1.Symbol,Symbol$1=Symbol2,objectProto$c$1=Object.prototype,hasOwnProperty$9$1=objectProto$c$1.hasOwnProperty,nativeObjectToString$1$1=objectProto$c$1.toString,symToStringTag$1$1=Symbol$1?Symbol$1.toStringTag:void 0;function getRawTag$2(e){var t=hasOwnProperty$9$1.call(e,symToStringTag$1$1),r=e[symToStringTag$1$1];try{e[symToStringTag$1$1]=void 0;var n=!0}catch(o){}var i=nativeObjectToString$1$1.call(e);return n&&(t?e[symToStringTag$1$1]=r:delete e[symToStringTag$1$1]),i}var objectProto$b$1=Object.prototype,nativeObjectToString$2=objectProto$b$1.toString;function objectToString$3(e){return nativeObjectToString$2.call(e)}var nullTag$1="[object Null]",undefinedTag$1="[object Undefined]",symToStringTag$2=Symbol$1?Symbol$1.toStringTag:void 0;function baseGetTag$5(e){return null==e?void 0===e?undefinedTag$1:nullTag$1:symToStringTag$2&&symToStringTag$2 in Object(e)?getRawTag$2(e):objectToString$3(e)}function isObjectLike$6(e){return null!=e&&"object"==_typeof(e)}function arrayMap(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}var isArray$a=Array.isArray,isArray$1$1=isArray$a;function isObject$8(e){var t=_typeof(e);return null!=e&&("object"==t||"function"==t)}function identity(e){return e}var asyncTag$1="[object AsyncFunction]",funcTag$2$1="[object Function]",genTag$1$1="[object GeneratorFunction]",proxyTag$1="[object Proxy]";function isFunction$5(e){if(!isObject$8(e))return!1;var t=baseGetTag$5(e);return t==funcTag$2$1||t==genTag$1$1||t==asyncTag$1||t==proxyTag$1}var coreJsData$2=root$1$1["__core-js_shared__"],coreJsData$1$1=coreJsData$2,maskSrcKey$1=function(){var e=/[^.]+$/.exec(coreJsData$1$1&&coreJsData$1$1.keys&&coreJsData$1$1.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function isMasked$2(e){return!!maskSrcKey$1&&maskSrcKey$1 in e}var funcProto$1$1=Function.prototype,funcToString$1$1=funcProto$1$1.toString;function toSource$3(e){if(null!=e){try{return funcToString$1$1.call(e)}catch(t){}try{return e+""}catch(t){}}return""}var reRegExpChar$1=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor$1=/^\[object .+?Constructor\]$/,funcProto$2=Function.prototype,objectProto$a$1=Object.prototype,funcToString$2=funcProto$2.toString,hasOwnProperty$8$1=objectProto$a$1.hasOwnProperty,reIsNative$1=RegExp("^"+funcToString$2.call(hasOwnProperty$8$1).replace(reRegExpChar$1,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative$2(e){return!(!isObject$8(e)||isMasked$2(e))&&(isFunction$5(e)?reIsNative$1:reIsHostCtor$1).test(toSource$3(e))}function getValue$2(e,t){return null==e?void 0:e[t]}function getNative$8(e,t){var r=getValue$2(e,t);return baseIsNative$2(r)?r:void 0}var WeakMap$1$1=getNative$8(root$1$1,"WeakMap"),WeakMap$2$1=WeakMap$1$1,objectCreate$1=Object.create,baseCreate$2=function(){function e(){}return function(t){if(!isObject$8(t))return{};if(objectCreate$1)return objectCreate$1(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),baseCreate$1$1=baseCreate$2;function apply(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function copyArray$2(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}var HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut(e){var t=0,r=0;return function(){var n=nativeNow(),i=HOT_SPAN-(n-r);if(r=n,i>0){if(++t>=HOT_COUNT)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function constant(e){return function(){return e}}var defineProperty$2=function(){try{var e=getNative$8(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),defineProperty$1$1=defineProperty$2,baseSetToString=defineProperty$1$1?function(e,t){return defineProperty$1$1(e,"toString",{configurable:!0,enumerable:!1,value:constant(t),writable:!0})}:identity,baseSetToString$1=baseSetToString,setToString=shortOut(baseSetToString$1),setToString$1=setToString;function arrayEach$2(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}var MAX_SAFE_INTEGER$1$1=9007199254740991,reIsUint$1=/^(?:0|[1-9]\d*)$/;function isIndex$2(e,t){var r=_typeof(e);return!!(t=null==t?MAX_SAFE_INTEGER$1$1:t)&&("number"==r||"symbol"!=r&&reIsUint$1.test(e))&&e>-1&&e%1==0&&e<t}function baseAssignValue$3(e,t,r){"__proto__"==t&&defineProperty$1$1?defineProperty$1$1(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function eq$3(e,t){return e===t||e!=e&&t!=t}var objectProto$9$1=Object.prototype,hasOwnProperty$7$1=objectProto$9$1.hasOwnProperty;function assignValue$3(e,t,r){var n=e[t];hasOwnProperty$7$1.call(e,t)&&eq$3(n,r)&&(void 0!==r||t in e)||baseAssignValue$3(e,t,r)}function copyObject$6(e,t,r,n){var i=!r;r||(r={});for(var o=-1,a=t.length;++o<a;){var s=t[o],c=n?n(r[s],e[s],s,r,e):void 0;void 0===c&&(c=e[s]),i?baseAssignValue$3(r,s,c):assignValue$3(r,s,c)}return r}var nativeMax=Math.max;function overRest(e,t,r){return t=nativeMax(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,o=nativeMax(n.length-t,0),a=Array(o);++i<o;)a[i]=n[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=n[i];return s[t]=r(a),apply(e,this,s)}}function baseRest(e,t){return setToString$1(overRest(e,t,identity),e+"")}var MAX_SAFE_INTEGER$2=9007199254740991;function isLength$3(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER$2}function isArrayLike$3(e){return null!=e&&isLength$3(e.length)&&!isFunction$5(e)}function isIterateeCall(e,t,r){if(!isObject$8(r))return!1;var n=_typeof(t);return!!("number"==n?isArrayLike$3(r)&&isIndex$2(t,r.length):"string"==n&&t in r)&&eq$3(r[t],e)}function createAssigner(e){return baseRest((function(t,r){var n=-1,i=r.length,o=i>1?r[i-1]:void 0,a=i>2?r[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,a&&isIterateeCall(r[0],r[1],a)&&(o=i<3?void 0:o,i=1),t=Object(t);++n<i;){var s=r[n];s&&e(t,s,n,o)}return t}))}var objectProto$8$1=Object.prototype;function isPrototype$4(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||objectProto$8$1)}function baseTimes$2(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var argsTag$2$1="[object Arguments]";function baseIsArguments$2(e){return isObjectLike$6(e)&&baseGetTag$5(e)==argsTag$2$1}var objectProto$7$1=Object.prototype,hasOwnProperty$6$1=objectProto$7$1.hasOwnProperty,propertyIsEnumerable$1$1=objectProto$7$1.propertyIsEnumerable,isArguments$2=baseIsArguments$2(function(){return arguments}())?baseIsArguments$2:function(e){return isObjectLike$6(e)&&hasOwnProperty$6$1.call(e,"callee")&&!propertyIsEnumerable$1$1.call(e,"callee")},isArguments$1$1=isArguments$2;function stubFalse$1(){return!1}var freeExports$2="object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&exports&&!exports.nodeType&&exports,freeModule$2=freeExports$2&&"object"==("undefined"==typeof module?"undefined":_typeof(module))&&module&&!module.nodeType&&module,moduleExports$2=freeModule$2&&freeModule$2.exports===freeExports$2,Buffer$1=moduleExports$2?root$1$1.Buffer:void 0,nativeIsBuffer=Buffer$1?Buffer$1.isBuffer:void 0,isBuffer$7=nativeIsBuffer||stubFalse$1,isBuffer$1$1=isBuffer$7,argsTag$1$1="[object Arguments]",arrayTag$1$1="[object Array]",boolTag$2$1="[object Boolean]",dateTag$2$1="[object Date]",errorTag$1$1="[object Error]",funcTag$1$1="[object Function]",mapTag$4$1="[object Map]",numberTag$2$1="[object Number]",objectTag$2$1="[object Object]",regexpTag$2$1="[object RegExp]",setTag$4$1="[object Set]",stringTag$2$1="[object String]",weakMapTag$2$1="[object WeakMap]",arrayBufferTag$2$1="[object ArrayBuffer]",dataViewTag$3$1="[object DataView]",float32Tag$2$1="[object Float32Array]",float64Tag$2$1="[object Float64Array]",int8Tag$2$1="[object Int8Array]",int16Tag$2$1="[object Int16Array]",int32Tag$2$1="[object Int32Array]",uint8Tag$2$1="[object Uint8Array]",uint8ClampedTag$2$1="[object Uint8ClampedArray]",uint16Tag$2$1="[object Uint16Array]",uint32Tag$2$1="[object Uint32Array]",typedArrayTags$1={};function baseIsTypedArray$2(e){return isObjectLike$6(e)&&isLength$3(e.length)&&!!typedArrayTags$1[baseGetTag$5(e)]}function baseUnary$4(e){return function(t){return e(t)}}typedArrayTags$1[float32Tag$2$1]=typedArrayTags$1[float64Tag$2$1]=typedArrayTags$1[int8Tag$2$1]=typedArrayTags$1[int16Tag$2$1]=typedArrayTags$1[int32Tag$2$1]=typedArrayTags$1[uint8Tag$2$1]=typedArrayTags$1[uint8ClampedTag$2$1]=typedArrayTags$1[uint16Tag$2$1]=typedArrayTags$1[uint32Tag$2$1]=!0,typedArrayTags$1[argsTag$1$1]=typedArrayTags$1[arrayTag$1$1]=typedArrayTags$1[arrayBufferTag$2$1]=typedArrayTags$1[boolTag$2$1]=typedArrayTags$1[dataViewTag$3$1]=typedArrayTags$1[dateTag$2$1]=typedArrayTags$1[errorTag$1$1]=typedArrayTags$1[funcTag$1$1]=typedArrayTags$1[mapTag$4$1]=typedArrayTags$1[numberTag$2$1]=typedArrayTags$1[objectTag$2$1]=typedArrayTags$1[regexpTag$2$1]=typedArrayTags$1[setTag$4$1]=typedArrayTags$1[stringTag$2$1]=typedArrayTags$1[weakMapTag$2$1]=!1;var freeExports$1="object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&exports&&!exports.nodeType&&exports,freeModule$1=freeExports$1&&"object"==("undefined"==typeof module?"undefined":_typeof(module))&&module&&!module.nodeType&&module,moduleExports$1=freeModule$1&&freeModule$1.exports===freeExports$1,freeProcess=moduleExports$1&&freeGlobal$1$1.process,nodeUtil$3=function(){try{return freeModule$1&&freeModule$1.require&&freeModule$1.require("util").types||freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}(),nodeUtil$1$1=nodeUtil$3,nodeIsTypedArray$1=nodeUtil$1$1&&nodeUtil$1$1.isTypedArray,isTypedArray$3=nodeIsTypedArray$1?baseUnary$4(nodeIsTypedArray$1):baseIsTypedArray$2,isTypedArray$1$1=isTypedArray$3,objectProto$6$1=Object.prototype,hasOwnProperty$5$1=objectProto$6$1.hasOwnProperty;function arrayLikeKeys$3(e,t){var r=isArray$1$1(e),n=!r&&isArguments$1$1(e),i=!r&&!n&&isBuffer$1$1(e),o=!r&&!n&&!i&&isTypedArray$1$1(e),a=r||n||i||o,s=a?baseTimes$2(e.length,String):[],c=s.length;for(var u in e)!t&&!hasOwnProperty$5$1.call(e,u)||a&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||isIndex$2(u,c))||s.push(u);return s}function overArg$3(e,t){return function(r){return e(t(r))}}var nativeKeys$2=overArg$3(Object.keys,Object),nativeKeys$1$1=nativeKeys$2,objectProto$5$1=Object.prototype,hasOwnProperty$4$1=objectProto$5$1.hasOwnProperty;function baseKeys$2(e){if(!isPrototype$4(e))return nativeKeys$1$1(e);var t=[];for(var r in Object(e))hasOwnProperty$4$1.call(e,r)&&"constructor"!=r&&t.push(r);return t}function keys$4(e){return isArrayLike$3(e)?arrayLikeKeys$3(e):baseKeys$2(e)}function nativeKeysIn$2(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}var objectProto$4$1=Object.prototype,hasOwnProperty$3$1=objectProto$4$1.hasOwnProperty;function baseKeysIn$2(e){if(!isObject$8(e))return nativeKeysIn$2(e);var t=isPrototype$4(e),r=[];for(var n in e)("constructor"!=n||!t&&hasOwnProperty$3$1.call(e,n))&&r.push(n);return r}function keysIn$4(e){return isArrayLike$3(e)?arrayLikeKeys$3(e,!0):baseKeysIn$2(e)}var assignIn=createAssigner((function(e,t){copyObject$6(t,keysIn$4(t),e)})),assignIn$1=assignIn,nativeCreate$5=getNative$8(Object,"create"),nativeCreate$1$1=nativeCreate$5;function hashClear$2(){this.__data__=nativeCreate$1$1?nativeCreate$1$1(null):{},this.size=0}function hashDelete$2(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var HASH_UNDEFINED$1$1="__lodash_hash_undefined__",objectProto$3$1=Object.prototype,hasOwnProperty$2$1=objectProto$3$1.hasOwnProperty;function hashGet$2(e){var t=this.__data__;if(nativeCreate$1$1){var r=t[e];return r===HASH_UNDEFINED$1$1?void 0:r}return hasOwnProperty$2$1.call(t,e)?t[e]:void 0}var objectProto$2$1=Object.prototype,hasOwnProperty$1$1=objectProto$2$1.hasOwnProperty;function hashHas$2(e){var t=this.__data__;return nativeCreate$1$1?void 0!==t[e]:hasOwnProperty$1$1.call(t,e)}var HASH_UNDEFINED$2="__lodash_hash_undefined__";function hashSet$2(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=nativeCreate$1$1&&void 0===t?HASH_UNDEFINED$2:t,this}function Hash$2(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function listCacheClear$2(){this.__data__=[],this.size=0}function assocIndexOf$5(e,t){for(var r=e.length;r--;)if(eq$3(e[r][0],t))return r;return-1}Hash$2.prototype.clear=hashClear$2,Hash$2.prototype.delete=hashDelete$2,Hash$2.prototype.get=hashGet$2,Hash$2.prototype.has=hashHas$2,Hash$2.prototype.set=hashSet$2;var arrayProto$1=Array.prototype,splice$1=arrayProto$1.splice;function listCacheDelete$2(e){var t=this.__data__,r=assocIndexOf$5(t,e);return!(r<0||(r==t.length-1?t.pop():splice$1.call(t,r,1),--this.size,0))}function listCacheGet$2(e){var t=this.__data__,r=assocIndexOf$5(t,e);return r<0?void 0:t[r][1]}function listCacheHas$2(e){return assocIndexOf$5(this.__data__,e)>-1}function listCacheSet$2(e,t){var r=this.__data__,n=assocIndexOf$5(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function ListCache$5(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ListCache$5.prototype.clear=listCacheClear$2,ListCache$5.prototype.delete=listCacheDelete$2,ListCache$5.prototype.get=listCacheGet$2,ListCache$5.prototype.has=listCacheHas$2,ListCache$5.prototype.set=listCacheSet$2;var Map$1$1=getNative$8(root$1$1,"Map"),Map$2$1=Map$1$1;function mapCacheClear$2(){this.size=0,this.__data__={hash:new Hash$2,map:new(Map$2$1||ListCache$5),string:new Hash$2}}function isKeyable$2(e){var t=_typeof(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function getMapData$5(e,t){var r=e.__data__;return isKeyable$2(t)?r["string"==typeof t?"string":"hash"]:r.map}function mapCacheDelete$2(e){var t=getMapData$5(this,e).delete(e);return this.size-=t?1:0,t}function mapCacheGet$2(e){return getMapData$5(this,e).get(e)}function mapCacheHas$2(e){return getMapData$5(this,e).has(e)}function mapCacheSet$2(e,t){var r=getMapData$5(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function MapCache$2(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function arrayPush$3(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}MapCache$2.prototype.clear=mapCacheClear$2,MapCache$2.prototype.delete=mapCacheDelete$2,MapCache$2.prototype.get=mapCacheGet$2,MapCache$2.prototype.has=mapCacheHas$2,MapCache$2.prototype.set=mapCacheSet$2;var getPrototype$3=overArg$3(Object.getPrototypeOf,Object),getPrototype$1$1=getPrototype$3;function stackClear$2(){this.__data__=new ListCache$5,this.size=0}function stackDelete$2(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function stackGet$2(e){return this.__data__.get(e)}function stackHas$2(e){return this.__data__.has(e)}var LARGE_ARRAY_SIZE$1=200;function stackSet$2(e,t){var r=this.__data__;if(r instanceof ListCache$5){var n=r.__data__;if(!Map$2$1||n.length<LARGE_ARRAY_SIZE$1-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new MapCache$2(n)}return r.set(e,t),this.size=r.size,this}function Stack$2(e){var t=this.__data__=new ListCache$5(e);this.size=t.size}function baseAssign$2(e,t){return e&&copyObject$6(t,keys$4(t),e)}function baseAssignIn$2(e,t){return e&&copyObject$6(t,keysIn$4(t),e)}Stack$2.prototype.clear=stackClear$2,Stack$2.prototype.delete=stackDelete$2,Stack$2.prototype.get=stackGet$2,Stack$2.prototype.has=stackHas$2,Stack$2.prototype.set=stackSet$2;var freeExports="object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==("undefined"==typeof module?"undefined":_typeof(module))&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,Buffer2=moduleExports?root$1$1.Buffer:void 0,allocUnsafe=Buffer2?Buffer2.allocUnsafe:void 0;function cloneBuffer$1(e,t){if(t)return e.slice();var r=e.length,n=allocUnsafe?allocUnsafe(r):new e.constructor(r);return e.copy(n),n}function arrayFilter$2(e,t){for(var r=-1,n=null==e?0:e.length,i=0,o=[];++r<n;){var a=e[r];t(a,r,e)&&(o[i++]=a)}return o}function stubArray$3(){return[]}var objectProto$1$1=Object.prototype,propertyIsEnumerable$2=objectProto$1$1.propertyIsEnumerable,nativeGetSymbols$1$1=Object.getOwnPropertySymbols,getSymbols$4=nativeGetSymbols$1$1?function(e){return null==e?[]:(e=Object(e),arrayFilter$2(nativeGetSymbols$1$1(e),(function(t){return propertyIsEnumerable$2.call(e,t)})))}:stubArray$3,getSymbols$1$1=getSymbols$4;function copySymbols$2(e,t){return copyObject$6(e,getSymbols$1$1(e),t)}var nativeGetSymbols$2=Object.getOwnPropertySymbols,getSymbolsIn$3=nativeGetSymbols$2?function(e){for(var t=[];e;)arrayPush$3(t,getSymbols$1$1(e)),e=getPrototype$1$1(e);return t}:stubArray$3,getSymbolsIn$1$1=getSymbolsIn$3;function copySymbolsIn$2(e,t){return copyObject$6(e,getSymbolsIn$1$1(e),t)}function baseGetAllKeys$3(e,t,r){var n=t(e);return isArray$1$1(e)?n:arrayPush$3(n,r(e))}function getAllKeys$2(e){return baseGetAllKeys$3(e,keys$4,getSymbols$1$1)}function getAllKeysIn$2(e){return baseGetAllKeys$3(e,keysIn$4,getSymbolsIn$1$1)}var DataView$1$1=getNative$8(root$1$1,"DataView"),DataView$2$1=DataView$1$1,Promise$1$1=getNative$8(root$1$1,"Promise"),Promise$2$1=Promise$1$1,Set$1$1=getNative$8(root$1$1,"Set"),Set$2$1=Set$1$1,mapTag$3$1="[object Map]",objectTag$1$1="[object Object]",promiseTag$1="[object Promise]",setTag$3$1="[object Set]",weakMapTag$1$1="[object WeakMap]",dataViewTag$2$1="[object DataView]",dataViewCtorString$1=toSource$3(DataView$2$1),mapCtorString$1=toSource$3(Map$2$1),promiseCtorString$1=toSource$3(Promise$2$1),setCtorString$1=toSource$3(Set$2$1),weakMapCtorString$1=toSource$3(WeakMap$2$1),getTag$4=baseGetTag$5;(DataView$2$1&&getTag$4(new DataView$2$1(new ArrayBuffer(1)))!=dataViewTag$2$1||Map$2$1&&getTag$4(new Map$2$1)!=mapTag$3$1||Promise$2$1&&getTag$4(Promise$2$1.resolve())!=promiseTag$1||Set$2$1&&getTag$4(new Set$2$1)!=setTag$3$1||WeakMap$2$1&&getTag$4(new WeakMap$2$1)!=weakMapTag$1$1)&&(getTag$4=function(e){var t=baseGetTag$5(e),r=t==objectTag$1$1?e.constructor:void 0,n=r?toSource$3(r):"";if(n)switch(n){case dataViewCtorString$1:return dataViewTag$2$1;case mapCtorString$1:return mapTag$3$1;case promiseCtorString$1:return promiseTag$1;case setCtorString$1:return setTag$3$1;case weakMapCtorString$1:return weakMapTag$1$1}return t});var getTag$1$1=getTag$4,objectProto$d=Object.prototype,hasOwnProperty$b=objectProto$d.hasOwnProperty;function initCloneArray$2(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&hasOwnProperty$b.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var Uint8Array$1$1=root$1$1.Uint8Array,Uint8Array$2$1=Uint8Array$1$1;function cloneArrayBuffer$4(e){var t=new e.constructor(e.byteLength);return new Uint8Array$2$1(t).set(new Uint8Array$2$1(e)),t}function cloneDataView$2(e,t){var r=t?cloneArrayBuffer$4(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var reFlags$1=/\w*$/;function cloneRegExp$2(e){var t=new e.constructor(e.source,reFlags$1.exec(e));return t.lastIndex=e.lastIndex,t}var symbolProto$1=Symbol$1?Symbol$1.prototype:void 0,symbolValueOf$1=symbolProto$1?symbolProto$1.valueOf:void 0;function cloneSymbol$2(e){return symbolValueOf$1?Object(symbolValueOf$1.call(e)):{}}function cloneTypedArray$2(e,t){var r=t?cloneArrayBuffer$4(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var boolTag$1$1="[object Boolean]",dateTag$1$1="[object Date]",mapTag$2$1="[object Map]",numberTag$1$1="[object Number]",regexpTag$1$1="[object RegExp]",setTag$2$1="[object Set]",stringTag$1$1="[object String]",symbolTag$1$1="[object Symbol]",arrayBufferTag$1$1="[object ArrayBuffer]",dataViewTag$1$1="[object DataView]",float32Tag$1$1="[object Float32Array]",float64Tag$1$1="[object Float64Array]",int8Tag$1$1="[object Int8Array]",int16Tag$1$1="[object Int16Array]",int32Tag$1$1="[object Int32Array]",uint8Tag$1$1="[object Uint8Array]",uint8ClampedTag$1$1="[object Uint8ClampedArray]",uint16Tag$1$1="[object Uint16Array]",uint32Tag$1$1="[object Uint32Array]";function initCloneByTag$2(e,t,r){var n=e.constructor;switch(t){case arrayBufferTag$1$1:return cloneArrayBuffer$4(e);case boolTag$1$1:case dateTag$1$1:return new n(+e);case dataViewTag$1$1:return cloneDataView$2(e,r);case float32Tag$1$1:case float64Tag$1$1:case int8Tag$1$1:case int16Tag$1$1:case int32Tag$1$1:case uint8Tag$1$1:case uint8ClampedTag$1$1:case uint16Tag$1$1:case uint32Tag$1$1:return cloneTypedArray$2(e,r);case mapTag$2$1:return new n;case numberTag$1$1:case stringTag$1$1:return new n(e);case regexpTag$1$1:return cloneRegExp$2(e);case setTag$2$1:return new n;case symbolTag$1$1:return cloneSymbol$2(e)}}function initCloneObject$2(e){return"function"!=typeof e.constructor||isPrototype$4(e)?{}:baseCreate$1$1(getPrototype$1$1(e))}var mapTag$1$1="[object Map]";function baseIsMap$2(e){return isObjectLike$6(e)&&getTag$1$1(e)==mapTag$1$1}var nodeIsMap$1=nodeUtil$1$1&&nodeUtil$1$1.isMap,isMap$3=nodeIsMap$1?baseUnary$4(nodeIsMap$1):baseIsMap$2,isMap$1$1=isMap$3,setTag$1$1="[object Set]";function baseIsSet$2(e){return isObjectLike$6(e)&&getTag$1$1(e)==setTag$1$1}var nodeIsSet$1=nodeUtil$1$1&&nodeUtil$1$1.isSet,isSet$3=nodeIsSet$1?baseUnary$4(nodeIsSet$1):baseIsSet$2,isSet$1$1=isSet$3,CLONE_DEEP_FLAG$1$1=1,CLONE_FLAT_FLAG$1=2,CLONE_SYMBOLS_FLAG$1$1=4,argsTag$3="[object Arguments]",arrayTag$2="[object Array]",boolTag$3="[object Boolean]",dateTag$3="[object Date]",errorTag$2="[object Error]",funcTag$3="[object Function]",genTag$2="[object GeneratorFunction]",mapTag$5="[object Map]",numberTag$3="[object Number]",objectTag$3="[object Object]",regexpTag$3="[object RegExp]",setTag$5="[object Set]",stringTag$3="[object String]",symbolTag$2="[object Symbol]",weakMapTag$3="[object WeakMap]",arrayBufferTag$3="[object ArrayBuffer]",dataViewTag$4="[object DataView]",float32Tag$3="[object Float32Array]",float64Tag$3="[object Float64Array]",int8Tag$3="[object Int8Array]",int16Tag$3="[object Int16Array]",int32Tag$3="[object Int32Array]",uint8Tag$3="[object Uint8Array]",uint8ClampedTag$3="[object Uint8ClampedArray]",uint16Tag$3="[object Uint16Array]",uint32Tag$3="[object Uint32Array]",cloneableTags$1={};function baseClone$2(e,t,r,n,i,o){var a,s=t&CLONE_DEEP_FLAG$1$1,c=t&CLONE_FLAT_FLAG$1,u=t&CLONE_SYMBOLS_FLAG$1$1;if(r&&(a=i?r(e,n,i,o):r(e)),void 0!==a)return a;if(!isObject$8(e))return e;var l=isArray$1$1(e);if(l){if(a=initCloneArray$2(e),!s)return copyArray$2(e,a)}else{var d=getTag$1$1(e),p=d==funcTag$3||d==genTag$2;if(isBuffer$1$1(e))return cloneBuffer$1(e,s);if(d==objectTag$3||d==argsTag$3||p&&!i){if(a=c||p?{}:initCloneObject$2(e),!s)return c?copySymbolsIn$2(e,baseAssignIn$2(a,e)):copySymbols$2(e,baseAssign$2(a,e))}else{if(!cloneableTags$1[d])return i?e:{};a=initCloneByTag$2(e,d,s)}}o||(o=new Stack$2);var _=o.get(e);if(_)return _;o.set(e,a),isSet$1$1(e)?e.forEach((function(n){a.add(baseClone$2(n,t,r,n,e,o))})):isMap$1$1(e)&&e.forEach((function(n,i){a.set(i,baseClone$2(n,t,r,i,e,o))}));var h=l?void 0:(u?c?getAllKeysIn$2:getAllKeys$2:c?keysIn$4:keys$4)(e);return arrayEach$2(h||e,(function(n,i){h&&(n=e[i=n]),assignValue$3(a,i,baseClone$2(n,t,r,i,e,o))})),a}cloneableTags$1[argsTag$3]=cloneableTags$1[arrayTag$2]=cloneableTags$1[arrayBufferTag$3]=cloneableTags$1[dataViewTag$4]=cloneableTags$1[boolTag$3]=cloneableTags$1[dateTag$3]=cloneableTags$1[float32Tag$3]=cloneableTags$1[float64Tag$3]=cloneableTags$1[int8Tag$3]=cloneableTags$1[int16Tag$3]=cloneableTags$1[int32Tag$3]=cloneableTags$1[mapTag$5]=cloneableTags$1[numberTag$3]=cloneableTags$1[objectTag$3]=cloneableTags$1[regexpTag$3]=cloneableTags$1[setTag$5]=cloneableTags$1[stringTag$3]=cloneableTags$1[symbolTag$2]=cloneableTags$1[uint8Tag$3]=cloneableTags$1[uint8ClampedTag$3]=cloneableTags$1[uint16Tag$3]=cloneableTags$1[uint32Tag$3]=!0,cloneableTags$1[errorTag$2]=cloneableTags$1[funcTag$3]=cloneableTags$1[weakMapTag$3]=!1;var CLONE_DEEP_FLAG$2=1,CLONE_SYMBOLS_FLAG$2=4;function cloneDeep$2(e){return baseClone$2(e,CLONE_DEEP_FLAG$2|CLONE_SYMBOLS_FLAG$2)}function baseValues(e,t){return arrayMap(t,(function(t){return e[t]}))}function values(e){return null==e?[]:baseValues(e,keys$4(e))}var ConnectionManager=function(e){_inherits(o,e);var t,r,n,i=_createSuper(o);function o(e){var t;return _classCallCheck(this,o),t=i.call(this),__publicField(_assertThisInitialized(t),"id"),__publicField(_assertThisInitialized(t),"_monitor"),__publicField(_assertThisInitialized(t),"logger"),__publicField(_assertThisInitialized(t),"_getAccessManager"),__publicField(_assertThisInitialized(t),"_connectionPool",new Map),__publicField(_assertThisInitialized(t),"_curConnection"),__publicField(_assertThisInitialized(t),"_hasReportBrowerWarning",!1),__publicField(_assertThisInitialized(t),"_reconnectTimer"),__publicField(_assertThisInitialized(t),"_connecting",!1),__publicField(_assertThisInitialized(t),"_isFirstTimeConnected",!0),__publicField(_assertThisInitialized(t),"_feedbackNodes",[]),__publicField(_assertThisInitialized(t),"_preIceStartTime",-1),__publicField(_assertThisInitialized(t),"_tcpOnlyTimer"),__publicField(_assertThisInitialized(t),"_destroyed",!1),t._ctx=e,t.id=e.id,t._monitor=getMonitor(t.id),t.logger=new Logger$1$1("ConnectionManager",3,t.id),t.logger.info("constructor","invoke"),t._getAccessManager=new IceConfigRequestManager(e),t}return _createClass(o,[{key:"connect",value:function(){var e=this;this.logger.info("connect","invoke");try{PeerConnection.checkSupported()}catch(e2){this.safeEmit("disconnected",e2)}this._connecting||(this._onConnectStart("init"),Promise.resolve().then((function(){return e.emit("__onGetIceConfigHook")})),this._getAccess())}},{key:"reconnectByNodeChange",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.info("reconnectByNodeChange","invoke %o",t),o=t.nodes,a=t.reason,null==(r=this._monitor)||r.report("rtc_node_change",{error_code:0,message:JSON.stringify(t),reason:JSON.stringify(a)}),sdkCache.clearAccessNode(this._ctx.appId),s=(null==(i=null==(n=this._curConnection)?void 0:n.node.publicIPs[0])?void 0:i.ip)||"",this._closeCurrentConnection(),this._clearConnectionPool(),this._clearReconnectTimer(),this._onConnectStart("node change"),Array.isArray(o)&&o.length>0?this._startIceConnect(o):this._getAccess([{feedbackIP:s,feedbackReason:{type:"NODE_CHANGED",reason:a}}]);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"reconnect",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.length>1&&void 0!==n[1]&&n[1],this.logger.info("reconnect","invoke. "+(r?"ICE over TCP":"")),this._closeCurrentConnection(),this._clearConnectionPool(),this._clearReconnectTimer(),this._onConnectStart(t),this._getAccess(void 0,r);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"destroy",value:function(){this.logger.info("destroy","invoke"),this._destroyed=!0,this.safeEmit("disconnected",new SDKError(ErrorCode.OPERATION_CANCEL,"destroy")),_get(_getPrototypeOf(o.prototype),"removeAllListeners",this).call(this),this._clearReconnectTimer(),this._clearConnectionPool(),this._getAccessManager.destroy(),this._closeCurrentConnection()}},{key:"_getAccess",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._getAccessManager.getICENode(e).then((function(e){t.emit("__onGetIceSuccessHook",e),t._startIceConnect(e,r)})).catch((function(e){t.safeEmit("disconnected",e)}))}},{key:"_startIceConnect",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._destroyed){this.logger.info("_startIceConnect","invoke");var n=genUuid$1();this._preIceStartTime=getServerNow();var i=this._ctx.joinRoomConfig.useTcpJoin,o=this._ctx.joinRoomConfig.useTcpJoinDelay,a=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(i){var o,a,s,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r&&((i=cloneDeep$2(i)).iceConfig.tcpOnly=!0),o={node:i},e.prev=2,a=new PeerConnection(t._ctx,n),o.pc=a,t._connectionPool.set(a.uuid,o),e.next=7,a.connect(i);case 7:return s=e.sent,c=new DataChannelSignaling(t.id,s),o.signaling=c,e.next=12,c.sendPingSignaling();case 12:t._onConnectSuccess({node:i,pc:a,signaling:c,dc:s}),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),t._onConnectionFailed(o,e.t0);case 18:case"end":return e.stop()}}),e,null,[[2,15]])})));return function(t){return e.apply(this,arguments)}}();this.emit("__onIceConnectStartHook"),e.forEach(a),i&&!r&&(this.logger.info("_startIceConnect","tcp-only will try after ".concat(o,"ms")),this._tcpOnlyTimer=window.setTimeout((function(){t.emit("connectWidthTcp"),e.forEach((function(e){(e=cloneDeep$2(e)).iceConfig.tcpOnly=!0,a(e)})),delete t._tcpOnlyTimer}),o))}}},{key:"_onConnectSuccess",value:function(e){var t,r,n,i=this;this.logger.info("connect","peer_%s connect success.",e.pc.uuid),this.emit("__onIceConnectSuccessHook",e),this._curConnection?(e.pc.destroy(),null==(n=e.signaling)||n.destroy(),this._connectionPool.delete(e.pc.uuid)):(this._curConnection=e,this._addConnectionHandler(e.pc),null==(r=this._monitor)||r.set({connection_id:e.pc.getConnectionId(),rtc_vid:(null==(t=e.node.iceConfig)?void 0:t._abtest_vid)||""}),this._connectionPool.delete(e.pc.uuid),this._feedbackNodes.forEach((function(e){return i._feedbackBySignaling(e)})),this._feedbackNodes=[],this._onConnectEnded(e))}},{key:"_onConnectionFailed",value:function(e,t){var r,n,i=this;this.logger.info("connect","peer_%s connect failed. %s",(null==(r=e.pc)?void 0:r.uuid)||"",t.message),this.emit("__onIceConnectFailedHook",e),t.code!==ConnectFailCode.DESTROY&&t.code!==ErrorCode.OPERATION_CANCEL&&(this._curConnection?this._feedbackBySignaling(e.node):this._feedbackNodes.push(e.node),this.logger.info("connect","remove cache node"),sdkCache.deleteAccessNode(this._ctx.appId,e.node),e.pc&&(this._connectionPool.delete(e.pc.uuid),e.pc.destroy()),null==(n=e.signaling)||n.destroy()),0!==this._connectionPool.size||this._curConnection||this._destroyed||(this.logger.error("connect","establish peerConnection failed"),this._checkBrowserUA(),getServerNow()-this._preIceStartTime<1e3?(this._clearReconnectTimer(),this._reconnectTimer=window.setTimeout((function(){delete i._reconnectTimer,i._reconnectWithIceFailed(i._feedbackNodes)}),1e3)):this._reconnectWithIceFailed(this._feedbackNodes))}},{key:"_feedbackBySignaling",value:function(e){var t;null==(t=this._curConnection)||t.signaling.sendSignaling("scheduleMessage",{type:"feedback",body:{feedbackIP:e.publicIPs[0].ip,feedbackReason:{type:"ICE_FAILED",reason:{}}}})}},{key:"_reconnectWithIceFailed",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._onConnectStart("ice failed"),this.logger.warn("reconnect","because of ice failed"),this._getAccess(t.map((function(e){return{feedbackIP:e.publicIPs[0].ip,feedbackReason:{type:"ICE_FAILED",reason:{}}}})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_checkBrowserUA",value:function(){var e;!this._hasReportBrowerWarning&&this._ctx.joinRoomConfig.isBlackBrower()&&(this._hasReportBrowerWarning=!0,null==(e=this._monitor)||e.report("rtc_error",{error_code:RtcErrorCode.BLACK_BROWSER,message:"failed to establish data-channel, and the current browser is on the browser blacklist."}))}},{key:"_onConnectStart",value:function(e){var t,r;this.logger.info("_onConnectStart","invoke, reason: ".concat(e)),this._connecting=!0,this.safeEmit(this._isFirstTimeConnected?"connecting":"reconnecting");var n=genUuid$1();null==(t=this._monitor)||t.set({connect_session_id:n}),this._isFirstTimeConnected||null==(r=this._monitor)||r.report("rtc_reconnect",{error_code:1002,message:"peerconnection reconnecting",reconnect_id:n,reconnect_type:"peerconnection"},{reason:e})}},{key:"_onConnectEnded",value:function(e){var t;this.logger.info("_onConnectEnded","invoke"),this._connecting=!1,this._isFirstTimeConnected||null==(t=this._monitor)||t.report("rtc_reconnected",{message:"peerconnection reconnected",reconnect_type:"peerconnection"}),this._isFirstTimeConnected=!1,this.safeEmit("connected",e),e.node.iceConfig.tcpOnly&&(this.logger.info("_onConnectEnded","use tcp only"),reportRtcInvokeStatus(this._ctx.id,"connected_with_tcp_only",JSON.stringify(e.node))),this._tcpOnlyTimer&&(window.clearTimeout(this._tcpOnlyTimer),delete this._tcpOnlyTimer),this._clearConnectionPool()}},{key:"_addConnectionHandler",value:function(e){var t=this;e.on("disconnect",(function(e){t._closeCurrentConnection(),t._clearReconnectTimer(),navigator.onLine?t.reconnect(e):t._reconnectTimer=window.setTimeout((function(){return t.reconnect(e)}),3e3)}))}},{key:"_closeCurrentConnection",value:function(){var e,t;null==(e=this._curConnection)||e.pc.destroy(),null==(t=this._curConnection)||t.signaling.destroy(),delete this._curConnection}},{key:"_clearConnectionPool",value:function(){var e=this;this._connectionPool.forEach((function(t,r){var n,i;null==(n=t.pc)||n.destroy(),null==(i=t.signaling)||i.destroy(),e._connectionPool.delete(r)}))}},{key:"_clearReconnectTimer",value:function(){this._reconnectTimer&&(window.clearTimeout(this._reconnectTimer),delete this._reconnectTimer)}}]),o}(EnhancedEventEmitter),__defProp$4=Object.defineProperty,__getOwnPropDesc$4=Object.getOwnPropertyDescriptor,__decorateClass$4=function(e,t,r,n){for(var i,o=n>1?void 0:n?__getOwnPropDesc$4(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&__defProp$4(t,r,o),o},MediaConnectionState=function(e){return e.DISCONNECTED="disconnected",e.DISCONNECTING="disconnecting",e.CONNECTED="connected",e.CONNECTING="connecting",e}(MediaConnectionState||{}),logRemoteStream=function(e,t,r){r.info(e,"userId: %o, subAudio: %o, subVideo: %o, audioMid: %o, videoMid: %o, sequenceId: %o",t.userId,t.subAudio,t.subVideo,t.audioMid,t.videoMid,t.sequenceId)},MediaServerClient=function(e){_inherits(I,e);var t,r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R,C,k=_createSuper(I);function I(e){var t;return _classCallCheck(this,I),t=k.call(this),__publicField(_assertThisInitialized(t),"id"),__publicField(_assertThisInitialized(t),"publicStream",!1),__publicField(_assertThisInitialized(t),"_token"),__publicField(_assertThisInitialized(t),"_roomId"),__publicField(_assertThisInitialized(t),"_roomAttributes"),__publicField(_assertThisInitialized(t),"_vendorConfig",{enableMultiVendor:!1,vendorCode:0}),__publicField(_assertThisInitialized(t),"_clientId"),__publicField(_assertThisInitialized(t),"_businessId"),__publicField(_assertThisInitialized(t),"_userInfo"),__publicField(_assertThisInitialized(t),"_authorization"),__publicField(_assertThisInitialized(t),"_sessionId",""),__publicField(_assertThisInitialized(t),"_liveControlMessage"),__publicField(_assertThisInitialized(t),"isReconnecting",!1),__publicField(_assertThisInitialized(t),"_ontrackCallbackMap",new Map),__publicField(_assertThisInitialized(t),"_subResolves",{}),__publicField(_assertThisInitialized(t),"supportConcurrent",!1),__publicField(_assertThisInitialized(t),"_handler"),__publicField(_assertThisInitialized(t),"_pubSubLock"),__publicField(_assertThisInitialized(t),"_joinLeaveLock"),__publicField(_assertThisInitialized(t),"_state"),__publicField(_assertThisInitialized(t),"_dataChannelSignal"),__publicField(_assertThisInitialized(t),"_joinRoomStartTs"),__publicField(_assertThisInitialized(t),"_monitor"),__publicField(_assertThisInitialized(t),"logger"),__publicField(_assertThisInitialized(t),"_roomProfile",RoomProfileType.communication),__publicField(_assertThisInitialized(t),"_context"),__publicField(_assertThisInitialized(t),"_connectionManager"),__publicField(_assertThisInitialized(t),"_joinRoom5xxTimer"),__publicField(_assertThisInitialized(t),"_joinResolve"),__publicField(_assertThisInitialized(t),"_joinReject"),__publicField(_assertThisInitialized(t),"_pubSubBackOff",{}),t.id=e.id,t._monitor=getMonitor(t.id),t.logger=new Logger$1$1("MediaServerClient",2,t.id),t.logger.info("constructor","invoke"),t._pubSubLock=new PromiseLock2("pubSubLock"),t._joinLeaveLock=new PromiseLock2("joinLeaveLock"),t._state="disconnected",t._roomAttributes={multiChatMode:!1,bigRoomMode:!1},t._pubSubBackOff={},t._context=e,t._connectionManager=new ConnectionManager(e),t._addConnectHandler(),t}return _createClass(I,[{key:"_addSignalEventHandler",value:function(){var e,t,r=this;[SignalEvent.ON_ADD_STREAM,SignalEvent.ON_ADD_STREAM_LIST,SignalEvent.ON_REMOVE_STREAM,SignalEvent.ON_REMOVE_STREAM_LIST,SignalEvent.USER_CONNECTION,SignalEvent.USER_CONNECTION_LIST,SignalEvent.USER_DISCONNECTION,SignalEvent.USER_DISCONNECTION_LIST,SignalEvent.ON_UPDATE_STREAM_ATTRIBUTES,SignalEvent.ON_UPDATE_ROOM_ATTRIBUTES,SignalEvent.ON_PUSH_TRACK,SignalEvent.ON_REMOVE_TRACK,SignalEvent.ON_CUSTOM_MESSAGE,SignalEvent.USER_MESSAGE_RECEIVED,SignalEvent.USER_BINARY_MESSAGE_RECEIVED,SignalEvent.POST_PROCESSING_MESSAGE,SignalEvent.ON_USER_TOKEN_WILL_EXPIRE,SignalEvent.STREAM_CONTROL_MESSAGE,SignalEvent.ON_UPDATE_USER_ATTRIBUTES,SignalEvent.ON_SPEAKER_CHANGE,MediaServerSignalEvent.RSCP,MediaServerSignalEvent.RTT,SignalEvent.ON_STREAM_FAILED,SignalEvent.ON_NOTIFY_RECONNECT,MediaServerSignalEvent.SSC,SignalEvent.ON_FORWARD_DST_ROOM_USER_KICK].forEach((function(e){var t;null==(t=r._dataChannelSignal)||t.on(e,(function(t){r.safeEmit(e,t)}))})),null==(e=this._dataChannelSignal)||e.on(SignalEvent.NODE_CHANGE,(function(e){r._connectionManager.reconnectByNodeChange(e)})),null==(t=this._dataChannelSignal)||t.on(SignalEvent.ON_NOTIFY_RECONNECT,(function(){r._connectionManager.reconnect("recv notifyReconnect signaling")}))}},{key:"_removeSignalEventHandler",value:function(){var e,t;null==(e=this._dataChannelSignal)||e.removeAllListeners(),null==(t=this._handler)||t.removeAllListeners()}},{key:"connectionState",get:function(){return this._state},set:function(e){this._state!==e&&(this.safeEmit(StateEvent.ON_CONNECTION_STATE_CHANGE,{prev:this._state,next:e}),this._state=e)}},{key:"businessId",set:function(e){this._businessId=e}},{key:"setLiveControlMessage",value:function(e){this._liveControlMessage=e}},{key:"connect",value:function(){var e=this;return new Promise((function(t,r){e._connectionManager.once("connected",(function(){return t()})),e._connectionManager.once("disconnected",r),e._connectionManager.connect()}))}},{key:"join",value:(C=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("join()","info: %o",t),this._token=t.token,this._roomId=t.roomId,this._clientId=t.userInfo.userId,this._businessId=t.userInfo.businessId,this._userInfo=t.userInfo,this._roomProfile=t.roomProfile,this._reportJoinRoomStart(),e.next=3,new Promise((function(e,t){r._joinResolve=e,r._joinReject=t,(r._handler?Promise.resolve():r.connect()).then((function(){r._callJoinRoom()})).catch((function(e){var t=Array.isArray(e)&&e.length>0?e[0]:e;r._joinRoomFailed(t.message)}))}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"_callJoinRoom",value:(R=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R=this,C=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=C.length>0&&void 0!==C[0]&&C[0],this.logger.info("_callJoinRoom","invoke"),e.t0=Utils.token2auth(this._context.appId,this._roomId,this._clientId,this._token),e.t1=this._sessionId,e.t2=Date.now(),e.t3=this._liveControlMessage,e.t4={extra_info:this._userInfo.extraInfo,role:this._userInfo.role},e.next=9,null==(r=this._handler)?void 0:r.getDefaultSdp();case 9:return e.t5=e.sent,e.next=12,internalGetSupportedCodecs();case 12:if(e.t6=e.sent,e.t7=window.navigator.userAgent,e.t8=Config2.VERSION,e.t9=sdkCache.getDeviceId(),e.t10=this._context.appId,e.t11=this._roomId,e.t12=this._clientId,e.t13=this._businessId,e.t14=this._context.useCloudProxy,e.t15=RoomProfileMap[this._roomProfile]?"".concat(RoomProfileMap[this._roomProfile][0]):"0",e.t16={supportedCodecs:e.t6,deviceType:"web",userAgent:e.t7,sdkVersion:e.t8,deviceId:e.t9,appId:e.t10,roomId:e.t11,userId:e.t12,businessId:e.t13,enableCloudProxy:e.t14,channelProfile:e.t15},e.t17={supportTokenExpireCallBack:!0,enableSceneConfigV2:!0,enableUnBundleMode:!0,enableAudioMux:!0,enableBigRoomMode:!0,needNegotiateSDP:!0,supportMultiVendor:!0},p={Authorization:e.t0,sessionId:e.t1,timestamp:e.t2,controlMessage:e.t3,userAttributes:e.t4,sdpInfo:e.t5,params:e.t16,options:e.t17},this._context.joinRoomParams)for(_=0,h=Object.entries(this._context.joinRoomParams);_<h.length;_++)f=_slicedToArray(h[_],2),m=f[0],g=f[1],p.params[m]=g;return getParameter("SIGNAL_CROP_JOINROOM")&&(null==(n=p.sdpInfo)?void 0:n.sdp)&&(p.sdpInfo.sdp=cropSdpMediaSection(p.sdpInfo.sdp)),Promise.resolve().then((function(){return R.emit("onSendingJoinMessageHook")})),e.prev=27,v=t?"reconnected":"joinRoom",e.next=31,this._joinRoomWithRetry(v,p);case 31:y=e.sent,this.logger.success("join","send join message success"),S=y.config||{},E=S.engine_WEB,this.connectionState="connected",this._authorization=p.Authorization,sdkCache.setEngineWebConfig(this._context.appId,this._roomId,E),this._context&&(this._context.serverConfig={videoCodec:(null==E?void 0:E.video_codec)||"H264",audioRed:!!(null==E?void 0:E.pub_audio_red),muteReplaceUnsub:!!(null==(i=y.config)?void 0:i.mute_replace_unsub),simulcastOnDemand:!(!1===(null==(s=null==(a=null==(o=y.config)?void 0:o.engine_VPM)?void 0:a.ondemand)?void 0:s.enable)),forceUniHandler:1===(null==(u=null==(c=null==y?void 0:y.config)?void 0:c.vendor_param)?void 0:u.vendor_stream_sub_mode)},"boolean"==typeof(null==E?void 0:E.av_sync)&&(this._context.avSync=E.av_sync)),y.vendorConfig&&(this._vendorConfig=y.vendorConfig),AudioStallObserver.setAudioStallConfig(E),(null==(l=null==y?void 0:y.relayMessage)?void 0:l.sdp)&&(null==(d=this._handler)||d.createAVMlineAnswerTpl(y.relayMessage.sdp)),this.emit("joinSuccess",{joinRes:y,reconnect:t}),this._joinRoomSuccess(y),e.next=41;break;case 37:e.prev=37,e.t18=e.catch(27),T={461:ErrorCode.ROOM_FORBIDDEN,462:ErrorCode.USER_FORBIDDEN},(null==e.t18?void 0:e.t18.code)>=700&&(null==e.t18?void 0:e.t18.code)<800?this._joinRoomFailed("token_error",ErrorCode.INVALID_TOKEN):T[null==e.t18?void 0:e.t18.code]?this._joinRoomFailed((null==e.t18?void 0:e.t18.message)||T[null==e.t18?void 0:e.t18.code],T[null==e.t18?void 0:e.t18.code]):(null==e.t18?void 0:e.t18.code)===ErrorCode.TIME_OUT&&this._context.joinRoomConfig.useTcpAfterJoinTimeout?(b="joinRoom timeout, retry with tcp only",this.logger.error("join",b),this.safeEmit(RoomEvent.ON_REJOIN_WITH_TCP),this._connectionManager.reconnect(b,!0)):e.t18.code===ErrorCode.OPERATION_CANCEL&&"connecting"===this.connectionState||this._joinRoomFailed((null==e.t18?void 0:e.t18.message)||"signaling_error");case 41:case"end":return e.stop()}}),e,this,[[27,37]])}))),function(){return R.apply(this,arguments)})},{key:"_getVendorPubSdpInfo",value:(b=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new PeerConnection(this._context,""),t.vendorHandler=new VendorHandler(this._context,r),t.pcSessionId&&(t.vendorHandler.peerConnectionId=t.pcSessionId),e.next=4,t.vendorHandler.publish(t);case 4:return n=e.sent,i=t.vendorHandler,e.abrupt("return",(i.on("ice_state",(function(e){o.emit(StateEvent.ON_VENDOR_CONNECTION_STATE_CHANGE,{state:{checking:ConnectionState.CONNECTION_STATE_CONNECTING,connected:ConnectionState.CONNECTION_STATE_CONNECTED,disconnected:ConnectionState.CONNECTION_STATE_RECONNECTING}[e],userId:o._clientId})})),i.once("disconnect",_asyncToGenerator(_regeneratorRuntime().mark((function e(){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.removeAllListeners(),"connected"!==(null==(n=null==(r=o._handler)?void 0:r.pc)?void 0:n.iceConnectionState)){e.next=9;break}return e.next=4,o.unpublish(t);case 4:return e.next=6,o.publish(t);case 6:t.vendorHandler&&t.statsReport.setVar(t.vendorHandler),e.next=10;break;case 9:o.logger.info("vendor ice failed",t.streamId);case 10:case"end":return e.stop()}}),e)})))),[i,n]));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"publish",value:(T=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._publish(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"_publish",value:(E=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R,C,k,I,A,O=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("publish()","localStream: %o",t),g=t.videoTrack,v=t.audioTrack,y=getServerNow(),E="",T="",b=this._handler,"H264"!==(null==(o=null==(i=this._context)?void 0:i.serverConfig)?void 0:o.videoCodec)){e.next=8;break}return e.next=6,isH264EncodeSupported();case 6:if(e.sent){e.next=8;break}throw new SDKError(ErrorCode.PUBLISH_FAILED,"h264 is not supported");case 8:if(!this._vendorConfig.enableMultiVendor){e.next=18;break}return e.next=11,this._getVendorPubSdpInfo(t);case 11:r=e.sent,n=_slicedToArray(r,2),b=n[0],S=n[1],e.next=21;break;case 18:return e.next=20,this._handler.publish(t);case 20:S=e.sent;case 21:return null==(a=t.observer)||a.setHandler(b),this.emit("_test_pub_sdpInfo_",S),E=S.audioMid,T=S.videoMid,t.pubAttributes={localaudio:!!v,localvideo:!!g,videostream:t.pubVideo,audiostream:t.pubAudio,extvideo:!!(g instanceof CustomVideoLocalTrack),extaudio:!!(v instanceof CustomAudioLocalTrack),videoDescriptions:S.videoDescriptions},R={attributes:_objectSpread2({},t.pubAttributes),audio:!0,video:!0,screen:t.isScreen,audioMid:E,videoMid:T,sdpInfo:{msid:t.stream.id,type:S.type,sdp:S.partialSdp,semantics:S.semantics},peerConnectionMode:null==S?void 0:S.peerConnectionMode,supportMultiVendor:!0},(C=!this._vendorConfig.enableMultiVendor&&t.enableSimulcast&&(null==(c=null==(s=this._context)?void 0:s.serverConfig)?void 0:c.simulcastOnDemand)&&(null==(u=S.subVideoDescriptions)?void 0:u.length))&&(R.attributes.subVideoDescriptions=S.subVideoDescriptions),(null==S?void 0:S.peerConnectionId)&&(R.peerConnectionId=S.peerConnectionId),e.prev=28,this.emit("_test_pub_body_",R),e.next=32,null==(l=this._dataChannelSignal)?void 0:l.sendSignaling("publish",R);case 32:k=e.sent,e.next=54;break;case 35:return e.prev=35,e.t0=e.catch(28),e.t0 instanceof Error?null==(d=this._monitor)||d.report("rtc_publish_stat",{result:"fail",is_screen:"0",start:y,message:"".concat(e.t0.name,": ").concat(e.t0.message)}):e.t0 instanceof SDKError&&(null==(p=this._monitor)||p.report("rtc_publish_stat",{result:"fail",is_screen:"0",start:y,message:"".concat(e.t0.code,": ").concat(e.t0.message)})),e.next=40,null==b?void 0:b.rollback({msid:t.stream.id,stream:t,audioMid:E,videoMid:T});case 40:if(!(e.t0.code>=500&&e.t0.code<600)){e.next=53;break}if(this.emit("_test_pub_5xx_"),!((I=this.getPubSubBackOff(t.id)).retryDuration<6e4)){e.next=52;break}return this.logger.info("pubRetry",t.id,I.retryDuration),e.next=47,new Promise((function(e){return setTimeout(e,I.interval)}));case 47:return I.retryDuration+=I.interval,I.interval=I.interval>4e3?8e3:2*I.interval,t.resetStream(),this.emit(RoomEvent.PUB_RETRY,{screen:t.isScreen}),e.abrupt("return",this._publish(t));case 52:this.logger.info("pubRetry","end"),delete this._pubSubBackOff[t.id];case 53:throw e.t0;case 54:if(null==(f=this._monitor)||f.report("rtc_recv_answer",{error_code:0,answer_type:null==k?void 0:k.relayMessage.type,sequence_id:(null==(_=null==k?void 0:k.relayMessage)?void 0:_.sequenceId)||0,message:null==(h=null==k?void 0:k.relayMessage)?void 0:h.sdp,direction:"up",stream_id:"",stream_user_id:"",pc_session_id:(null==b?void 0:b.peerConnectionId)||""}),A=new Promise((function(e,r){var n,i;null==b||b.handleAck({action:SdpAction.publish,streamId:k.streamId,audioMid:E,videoMid:T,audioTransceiverInit:null==S?void 0:S.audioTransceiverInit,videoTransceiverInit:null==S?void 0:S.videoTransceiverInit,signalingAck:{sdp:null==(n=null==k?void 0:k.relayMessage)?void 0:n.sdp,sequenceId:null==(i=null==k?void 0:k.relayMessage)?void 0:i.sequenceId},sdp:null==S?void 0:S.sdp,stream:t,onSuccess:function(){O.logger.info("publish()","publish success"),e(0)},onFail:function(e){O.logger.info("publish()","publish fail"),r(e)}})})),e.t1=!isFirefox,!e.t1){e.next=60;break}return e.next=60,A;case 60:this.emit("___afterHandleAckInPub"),C&&this.emit(MediaServerSignalEvent.RSCP,[{StreamIds:[t.stream.id],Metadata:{VideoIndex:0}}],!0),t.streamId=k.streamId,t.videoMid=T,t.audioMid=E,t.subVideoDescriptions=S.subVideoDescriptions,null==(m=this._monitor)||m.report("rtc_publish_stat",{result:"success",is_screen:"0",start:y,message:"unknown"});case 67:case"end":return e.stop()}}),e,this,[[28,35]])}))),function(e){return E.apply(this,arguments)})},{key:"updatePubTrack",value:(S=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R,C,k,I,A,O,M;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updatePubTrack()","localStream: %o",t),s=t.videoTrack,c=t.audioTrack,u=t.pubAudio,l=t.pubVideo,d=t.vendorHandler||this.handler,p=null==c?void 0:c.preprocessingTrack,_=null==s?void 0:s.preprocessingTrack,!l||!_){e.next=10;break}return e.next=7,null==(r=t.videoTransceiver)?void 0:r.sender.replaceTrack(_);case 7:this.updateVideoDescriptions(t),e.next=12;break;case 10:return e.next=12,null==(n=t.videoTransceiver)?void 0:n.sender.replaceTrack(null);case 12:if(null==d||d.updateMaxBitrate(t),!u||!p){e.next=20;break}return h=c.mixType,(f=c.mixedAudioTrack)&&h!==AudioMixingType.PLAYOUT&&p.enabled&&(p=f),e.next=18,null==(i=t.audioTransceiver)?void 0:i.sender.replaceTrack(p);case 18:e.next=23;break;case 20:return e.next=22,null==(o=t.audioTransceiver)?void 0:o.sender.replaceTrack(null);case 22:reportRtcInvokeStatus(this.id,"MediaClient.updatePubTrack(audio)","null");case 23:this.emit("___onAfterReplaceTrack");try{reportRtcInvokeStatus(this.id,"MediaClient.updatePubTrack",JSON.stringify({audioStreamTrack:mediaTrackStringify(p),videoStreamTrack:mediaTrackStringify(_)}))}catch(P){}for(m={localaudio:!!c,localvideo:!!s,videostream:l,audiostream:u,extvideo:!!(s instanceof CustomVideoLocalTrack),extaudio:!!(c instanceof CustomAudioLocalTrack)},g={},v=0,y=Object.entries(m);v<y.length;v++)S=_slicedToArray(y[v],2),E=S[0],(T=S[1])!==Reflect.get(t.pubAttributes,E)&&Reflect.set(g,E,T);if(Object.keys(g).length){e.next=29;break}return e.abrupt("return");case 29:return t.observer&&(b=t.observer,R=g.audiostream,C=g.videostream,k=g.localaudio,I=g.localvideo,A=g.extaudio,O=g.extvideo,void 0!==I?void 0!==O?b.setPushVideo(O):b.setEnableVideo(I):void 0!==C&&b.setUnmuteVideo(C),void 0!==k?void 0!==A?b.setPushAudio(A):b.setEnableAudio(k):void 0!==R&&b.setUnmuteAudio(R)),t.pubAttributes=_objectSpread2(_objectSpread2({},t.pubAttributes),m),M={roomId:this._roomId,streamId:t.streamId,attributes:g},e.next=34,null==(a=this._dataChannelSignal)?void 0:a.sendSignaling("updateStreamAttributes",M);case 34:if(this.emit("___onAfterUpdateSignaling"),e.t0=isFirefox,!e.t0){e.next=39;break}return e.next=39,null==d?void 0:d.setCurrentDescription();case 39:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"updateToken",value:(y=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updateToken()","newToken: %o",t),this._token=t,this._context.appId&&(null==(r=this._userInfo)?void 0:r.userId)&&this._roomId){e.next=2;break}return e.abrupt("return");case 2:return o={roomId:this._roomId,userId:null==(n=this._userInfo)?void 0:n.userId,appId:this._context.appId,token:"Bearer ".concat(t)},e.prev=3,e.next=6,null==(i=this._dataChannelSignal)?void 0:i.sendSignaling("updateToken",o);case 6:e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(3),new SDKError(ErrorCode.UPDATE_TOKEN_WITH_INVALID_TOKEN,"invoke updateToken with an invalid token");case 11:case"end":return e.stop()}}),e,this,[[3,8]])}))),function(e){return y.apply(this,arguments)})},{key:"updateVideoDescriptions",value:(v=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1===t.pubAttributes.videoDescriptions.length){e.next=2;break}return e.abrupt("return");case 2:if((null==(o=null==(n=null==(r=t.videoTrack)?void 0:r.preprocessingTrack)?void 0:n.getSettings())?void 0:o.width)&&(null==o?void 0:o.height)&&(null==o?void 0:o.frameRate)){e.next=5;break}return e.abrupt("return");case 5:a=t.pubAttributes.videoDescriptions[0],o.width===a.width&&o.height===a.height&&o.frameRate===a.framerate||(a.width=o.width,a.height=o.height,a.framerate=o.frameRate,a.maxkbps=t.videoEncodeConfig[0].maxKbps||a.maxkbps,null==(i=this._dataChannelSignal)||i.sendSignaling("updateStreamAttributes",{roomId:this._roomId,streamId:t.streamId,attributes:{videoDescriptions:[a]}}));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"unpublish",value:(g=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("unpublish()","localStream: %o",t),n={roomId:this._roomId,initStreamId:t.initStreamId,streamId:t.streamId},null==(r=this._dataChannelSignal)||r.sendSignaling("unpublish",n),i=t.vendorHandler||this._handler,e.next=6,null==i?void 0:i.handleAck({action:SdpAction.unpublish,audioMid:t.audioMid,videoMid:t.videoMid,stream:t,streamId:t.streamId});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"_getVendorSubSdpInfo",value:(m=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new PeerConnection(this._context,""),t.vendorHandler=new VendorHandler(this._context,n),t.pcSessionId&&(t.vendorHandler.peerConnectionId=t.pcSessionId),(i=t.vendorHandler).on("ontrack",r),e.next=6,t.vendorHandler.subscribe(t);case 6:return o=e.sent,e.abrupt("return",(i.on("ice_state",(function(e){a.emit(StateEvent.ON_VENDOR_CONNECTION_STATE_CHANGE,{state:{checking:ConnectionState.CONNECTION_STATE_CONNECTING,connected:ConnectionState.CONNECTION_STATE_CONNECTED,disconnected:ConnectionState.CONNECTION_STATE_RECONNECTING}[e],userId:t.userId})})),i.once("disconnect",_asyncToGenerator(_regeneratorRuntime().mark((function e(){var r,n,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==i||i.removeAllListeners(),"connected"===(null==(n=null==(r=a._handler)?void 0:r.pc)?void 0:n.iceConnectionState)){e.next=2;break}return e.abrupt("return",void a.logger.info("vendor ice failed",t.streamId));case 2:return o=t.subMediaType,e.next=5,a.unsubscribe(t);case 5:return e.next=7,a.subscribe(t,o);case 7:t.vendorHandler&&t.statsReport.setVar(t.vendorHandler),a.emit(RoomEvent.RESUBSCRIBE,{stream:t});case 9:case"end":return e.stop()}}),e)})))),[i,o]));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"subscribe",value:(f=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._subscribe(t,r,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return f.apply(this,arguments)})},{key:"_subscribe",value:(h=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R,C,k,I,A,O,M,P,w,D,N,x,L,$,B,U,F,V=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("subscribe()","mediaType: %o",r),logRemoteStream("subscribe()",t,this.logger),t.streamState=StreamState.SUB_ING,y=!1,S=!1,audioInMediaType(r)&&(S=!0),videoInMediaType(r)&&(y=!0),y||!this.multiChatMode()){e.next=4;break}return e.abrupt("return",void(t.streamState=StreamState.INIT));case 4:if(E=getServerNow(),T=t.subVideo,b=[],this._subResolves[t.streamId]||(this._subResolves[t.streamId]=[]),b.push(new Promise((function(e,r){V._subResolves[t.streamId].push(e);var n=setTimeout((function(){return r(new SDKError(ErrorCode.TIME_OUT,"wait video timeout for userId: ".concat(t.userId)))}),6e4);t.on("ontrack",(function r(i){"video"===i.mediaType&&(V.logger.info("remoteStream ".concat(t.userId," received video track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),this.multiChatMode()||b.push(new Promise((function(e,r){V._subResolves[t.streamId].push(e);var n=setTimeout((function(){return r(new SDKError(ErrorCode.TIME_OUT,"wait audio timeout for userId: ".concat(t.userId)))}),6e4);t.on("ontrack",(function r(i){"audio"===i.mediaType&&(V.logger.info("remoteStream ".concat(t.userId," received audio track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),R=function(e){t.ontrack(e)},null==(c=this._handler)||c.on("ontrack",R),this._ontrackCallbackMap.set(t,R),k=this._handler,(null==(u=this._context.serverConfig)?void 0:u.forceUniHandler)||!t.enableVendorMode){e.next=19;break}return e.next=12,this._getVendorSubSdpInfo(t,R);case 12:i=e.sent,o=_slicedToArray(i,2),k=o[0],C=o[1],e.next=22;break;case 19:return e.next=21,this._handler.subscribe(t,{multiChatMode:this.multiChatMode()});case 21:C=e.sent;case 22:if(null==(l=t.observer)||l.setHandler(k),A=(I=C).audioMid,O=I.videoMid,t.subVideo=y,M={spatialLayer:(null==n?void 0:n.spatialLayer)||0,temporalLayer:0,spatialSubLayer:(null==n?void 0:n.spatialSubLayer)||-1},P={audio:!this.multiChatMode(),video:!0,data:!0,screen:t.isScreen,browser:"chrome-stable",videoMid:O,audioMid:A,sdpInfo:{sdp:null==C?void 0:C.partialSdp,semantics:null==C?void 0:C.semantics,type:null==C?void 0:C.type},streamUserId:t.userId,streamId:t.streamId,config:{enableMediaType:{audio:!!this.multiChatMode()||S,video:y},qualityLayer:M},extra:{enableSendRTT:!0},peerConnectionMode:null==C?void 0:C.peerConnectionMode,supportMultiVendor:!0},(null==C?void 0:C.peerConnectionId)&&(P.peerConnectionId=C.peerConnectionId),w=this._context||{},D=w.subscribeFallbackOption,N=w.userPriority,"number"==typeof D&&(P.config.fallbackOption=D),N.has(t.userId)&&(P.config.priority=N.get(t.userId)),(null==C?void 0:C.allSsrc)&&(P.extra.subscribeSSRC=C.allSsrc),e.t0=null==C?void 0:C.signalingAck,!e.t0){e.next=35;break}return e.next=35,new Promise((function(e,r){null==k||k.handleAck({action:SdpAction.subscribe,streamId:t.streamId,audioMid:A,videoMid:O,audioTransceiverInit:null==C?void 0:C.audioTransceiverInit,videoTransceiverInit:null==C?void 0:C.videoTransceiverInit,signalingAck:null==C?void 0:C.signalingAck,stream:t,sdp:C.sdp,onSuccess:function(){V.logger.info("ssrc","success"),e(0)},onFail:function(e){V.logger.info("ssrc","fail",e),r(e)}})}));case 35:return e.prev=35,this.emit("_test_sub_body_",P),e.next=39,null==(d=this._dataChannelSignal)?void 0:d.sendSignaling("subscribe",P);case 39:x=e.sent,e.next=60;break;case 42:if(e.prev=42,e.t1=e.catch(35),t.streamState=StreamState.INIT,e.t1 instanceof Error&&(null==(p=this._monitor)||p.report("rtc_subscribe_stat",{result:"fail",start:E,message:e.t1.message,stream_user_id:t.userId})),!(e.t1.code>=500&&e.t1.code<600)){e.next=56;break}if(this.emit("_test_sub_5xx_"),!((L=this.getPubSubBackOff(t.streamId)).retryDuration<6e4)){e.next=55;break}return this.logger.info("subRetry",t.streamId,L.retryDuration),e.next=51,new Promise((function(e){return setTimeout(e,L.interval)}));case 51:return L.retryDuration+=L.interval,L.interval=L.interval>4e3?8e3:2*L.interval,this.emit(RoomEvent.SUB_RETRY,{screen:t.isScreen,userId:t.userId}),e.abrupt("return",this._subscribe(t,r,n));case 55:this.logger.info("subRetry","end",t.streamId),delete this._pubSubBackOff[t.streamId];case 56:return t.subVideo=T,e.next=59,null==k?void 0:k.rollback({msid:t.streamId,stream:t});case 59:throw e.t1;case 60:if(x.relayMessage){e.next=62;break}throw null==(_=this._monitor)||_.report("rtc_error",{error_code:-1009,message:"relayMessage is null"}),new SDKError(ErrorCode.UNEXPECTED_ERROR,"unable to subscribe");case 62:if($=null!==(a=null==x?void 0:x.relayMessage)&&void 0!==a?a:{},B=$.audioMid,U=$.videoMid,_defineProperty$1(s={},A,B),_defineProperty$1(s,O,U),F=s,this.logger.info("sub midmap",t.userId,F),t.videoMid=O,t.audioMid=A,t.subMediaType=r,t.streamState=StreamState.SUB_ED,t.subLayer=M,null==(g=this._monitor)||g.report("rtc_recv_answer",{error_code:0,answer_type:null==(h=null==x?void 0:x.relayMessage)?void 0:h.type,sequence_id:(null==(f=null==x?void 0:x.relayMessage)?void 0:f.sequenceId)||0,message:null==(m=null==x?void 0:x.relayMessage)?void 0:m.sdp,direction:"down",stream_id:t.streamId,stream_user_id:t.userId,pc_session_id:(null==k?void 0:k.peerConnectionId)||""}),e.t2=null==C?void 0:C.signalingAck,e.t2){e.next=74;break}return e.next=74,new Promise((function(e,r){var n,i;null==k||k.handleAck({action:SdpAction.subscribe,streamId:t.streamId,audioMid:A,videoMid:O,audioTransceiverInit:null==C?void 0:C.audioTransceiverInit,videoTransceiverInit:null==C?void 0:C.videoTransceiverInit,signalingAck:{sdp:null==(n=null==x?void 0:x.relayMessage)?void 0:n.sdp,sequenceId:null==(i=null==x?void 0:x.relayMessage)?void 0:i.sequenceId},stream:t,sdp:C.sdp,onSuccess:function(){V.logger.info("sub ack","success"),e(0)},onFail:function(e){V.logger.info("sub ack","fail",e),r(e)}})}));case 74:return e.next=76,Promise.all(b);case 76:this.multiChatMode()||(t.subAudio=S),null==(v=this._monitor)||v.report("rtc_subscribe_stat",{result:"success",start:E,message:"unknown",stream_user_id:t.userId}),this._context&&t.startReport((function(e){return V.emit("onRemoteStreamStats",e)}),k);case 79:case"end":return e.stop()}}),e,this,[[35,42]])}))),function(e,t,r){return h.apply(this,arguments)})},{key:"controlMessage",value:(_=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("controlMessage()","params: %o",t),n=t,"transcode"===t.type&&(n.roomId=this._roomId),e.next=5,null==(r=this._dataChannelSignal)?void 0:r.sendSignaling("controlMessage",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)})},{key:"updateUserAttributes",value:(p=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("updateUserAttributes()","attributes: %o",t),e.next=3,null==(r=this._dataChannelSignal)?void 0:r.sendSignaling("updateUserAttributes",{roomId:this._roomId,sessionId:this._sessionId,attributes:t});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"updateSubTrackLayer",value:(d=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updateSubTrack()","subLayer: %o",r),t.subLayer.spatialLayer!==r.spatialLayer||t.subLayer.spatialSubLayer!==r.spatialSubLayer){e.next=2;break}return e.abrupt("return",void this.logger.warn("updateSubTrack()","subLayer no change"));case 2:return i={roomId:this._roomId,streamList:[t.streamId],streamId:t.streamId,streamUserId:t.userId,config:{qualityLayer:r}},e.next=5,null==(n=this._dataChannelSignal)?void 0:n.sendSignaling("updateSubscribe",i);case 5:return t.subLayer=r,e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"updateSubPriority",value:(l=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updateSubPriority()","priority: %o",r),t.priority!==r){e.next=2;break}return e.abrupt("return",(this.logger.warn("updateSubPriority()","priority no change"),t));case 2:return i={roomId:this._roomId,streamList:[t.streamId],streamId:t.streamId,streamUserId:t.userId,config:{priority:r}},e.next=5,null==(n=this._dataChannelSignal)?void 0:n.sendSignaling("updateSubscribe",i);case 5:return t.priority=r,e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"updateSubMediaType",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!1,s=!1,audioInMediaType(r)&&(s=!0),videoInMediaType(r)&&(a=!0),c={roomId:this._roomId,streamList:[t.streamId],config:{enableMediaType:{video:a,audio:!!this.multiChatMode()||s}}},e.next=5,null==(n=this._dataChannelSignal)?void 0:n.sendSignaling("updateSubscribe",c);case 5:return this.multiChatMode()||(null==(i=t.observer)||i.setUnmuteAudio(s),t.subAudio=s),null==(o=t.observer)||o.setUnmuteVideo(a),t.subVideo=a,t.subMediaType=r,e.abrupt("return",t);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"subscribe4pushTrack",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l,d=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("subscribe4pushTrack()","streamInfo: %o",r),logRemoteStream("subscribe4pushTrack()",t,this.logger),t.subAudio=!0,e.next=3,null==(n=this._handler)?void 0:n.subscribe(t,{multiChatMode:this.multiChatMode()});case 3:if(a=e.sent){e.next=6;break}throw new SDKError(ErrorCode.ADD_TRANSCEIVER_FAILED,"add transceiver failed");case 6:return s=a.audioMid,c=a.videoMid,(u=[]).push(new Promise((function(e,r){var n=setTimeout((function(){return r(new SDKError(ErrorCode.TIME_OUT,"wait audio timeout for userId: ".concat(t.userId)))}),6e4);t.on("ontrack",(function r(i){"audio"===i.mediaType&&(d.logger.success("remoteStream ".concat(t.userId," received audio track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),l=function(e){t.ontrack(e)},null==(i=this._handler)||i.on("ontrack",l),this._ontrackCallbackMap.set(t,l),e.next=13,null==(o=this._handler)?void 0:o.handleAck({action:SdpAction.pushtrack,streamId:t.streamId,audioMid:s,videoMid:c,stream:t,audioTransceiverInit:null==a?void 0:a.audioTransceiverInit,videoTransceiverInit:null==a?void 0:a.videoTransceiverInit,signalingAck:null==r?void 0:r.message,sdp:a.sdp});case 13:return e.next=15,Promise.all(u);case 15:this._context&&t.startReport((function(e){return d.emit("onRemoteStreamStats",e)}),this._handler);case 16:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"unsubscribe4removeTrack",value:(s=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,o,a,s,c,u,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(logRemoteStream("unsubscribe4removeTrack()",t,this.logger),this.logger.info("unsubscribe4removeTrack()","sequenceId: ",r.sequenceId,"trackType: ",n),!(r.sequenceId<t.sequenceId)){e.next=2;break}return e.abrupt("return",void this.logger.warn("unsubscribe4removeTrack()","sequenceId return"));case 2:return u=!!((c=n+1)&MediaType.AUDIO),l=!!(c&MediaType.VIDEO),e.next=5,null==(i=this._handler)?void 0:i.handleAck({action:SdpAction.removetrack,streamId:t.streamId,audioMid:t.audioMid,videoMid:t.videoMid,stream:t});case 5:null==(o=t.observer)||o.setPushTrack(!1),null==(a=t.observer)||a.setUnmuteAudio(!u),t.subAudio=!u,null==(s=t.observer)||s.setUnmuteVideo(!l),t.subVideo=!l,t.subMediaType=t.subMediaType-(t.subMediaType&c),t.virtual&&(t.clean(),t.resetHasSubscribed(),t.statsReport.unsubscribe());case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return s.apply(this,arguments)})},{key:"unsubscribe",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return logRemoteStream("unsubscribe()",t,this.logger),o={roomId:this._roomId,streamId:t.streamId,userId:t.userId},a=t.vendorHandler||this.handler,null==(r=this._dataChannelSignal)||r.sendSignaling("unsubscribe",o).catch((function(){})),t.streamState=StreamState.INIT,t.subVideo=!1,null==(n=t.observer)||n.setSubscribeVideo(!1),!this.multiChatMode()&&(null==(i=t.observer)||i.setSubscribeAudio(!1)),e.next=5,null==a?void 0:a.handleAck({action:SdpAction.unsubscribe,streamId:t.streamId,audioMid:t.audioMid,videoMid:t.videoMid,stream:t});case 5:s=e.sent,this._subResolves[s]&&this._subResolves[s].forEach((function(e){return e(0)})),this.logger.info("unsubscribe","clean unsub ".concat(t.userId)),t.clean(),t.subMediaType=ExtendMediaType.NONE,this.removeOnTrackListener(t),t.statsReport.unsubscribe();case 7:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"removeOnTrackListener",value:function(e){var t=this._ontrackCallbackMap.get(e);if(t){var r=e.vendorHandler||this._handler;null==r||r.off("ontrack",t),this._ontrackCallbackMap.delete(e)}}},{key:"handleRemoveStream",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:logRemoteStream("handleRemoveStream()",t,this.logger),t.subVideo=!1,t.streamState!==StreamState.INIT&&this.unsubscribe(t);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"leave",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("leave()"),this._stopJoinRoom5xxRetry(),this._joinRoomFailed("leave_room"),"connected"===this.connectionState){e.next=2;break}return e.abrupt("return",Promise.reject(new SDKError(ErrorCode.NOT_CONNECTED_YET,"server not connected")));case 2:return r={Authorization:this._authorization,roomId:this._roomId,sessionId:this._sessionId},e.next=5,this._joinLeaveLock.lock();case 5:return n=e.sent,e.prev=6,e.next=9,null==(t=this._dataChannelSignal)?void 0:t.sendSignaling("leaveRoom",r);case 9:n(),e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(6),n(),e.t0;case 15:case"end":return e.stop()}}),e,this,[[6,12]])}))),function(){return i.apply(this,arguments)})},{key:"subscribePublicStream",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==(r=this._handler)?void 0:r.subscribe(t,{multiChatMode:!1});case 2:if(s=e.sent){e.next=5;break}throw new SDKError(ErrorCode.ADD_TRANSCEIVER_FAILED,"add transceiver failed");case 5:return c=getServerNow(),u=s.audioMid,l=s.videoMid,e.t0=this._context.appId,e.t1=t.streamId,e.t2=!0,e.t3=!0,e.t4=!0,e.t5=u,e.t6=l,e.t7={sdp:null==s?void 0:s.partialSdp,semantics:null==s?void 0:s.semantics,type:null==s?void 0:s.type},e.next=18,internalGetSupportedCodecs();case 18:return e.t8=e.sent,e.t9=window.navigator.userAgent,e.t10=Config2.VERSION,e.t11=sdkCache.getDeviceId(),e.t12=this._context.appId,e.t13=this._businessId,e.t14=this._context.useCloudProxy,e.t15={supportedCodecs:e.t8,deviceType:"web",userAgent:e.t9,sdkVersion:e.t10,deviceId:e.t11,appId:e.t12,businessId:e.t13,enableCloudProxy:e.t14},e.t16={enableMediaType:{audio:!0,video:!0},qualityLayer:{spatialLayer:0,temporalLayer:0}},d={appId:e.t0,streamId:e.t1,audio:e.t2,video:e.t3,data:e.t4,audioMid:e.t5,videoMid:e.t6,sdpInfo:e.t7,params:e.t15,config:e.t16},e.next=30,null==(n=this._dataChannelSignal)?void 0:n.sendSignaling("startPullStream",d);case 30:return p=e.sent,_=[],this._subResolves[t.streamId]=[],_.push(new Promise((function(e,r){v._subResolves[t.streamId].push(e);var n=setTimeout((function(){return r(new SDKError(ErrorCode.TIME_OUT,"wait video timeout for streamId: ".concat(t.streamId)))}),6e4);t.on("ontrack",(function r(i){"video"===i.mediaType&&(v.logger.success("remoteStream ".concat(t.userId," received video track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),_.push(new Promise((function(e,r){v._subResolves[t.streamId].push(e);var n=setTimeout((function(){return r(new SDKError(ErrorCode.TIME_OUT,"wait audio timeout for streamId: ".concat(t.streamId)))}),6e4);t.on("ontrack",(function r(i){"audio"===i.mediaType&&(v.logger.success("remoteStream ".concat(t.userId," received audio track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),h=function(e){t.ontrack(e)},null==(i=this._handler)||i.on("ontrack",h),this._ontrackCallbackMap.set(t,h),f=null==p?void 0:p.relayMessage,m=f.sequenceId,g=f.sdp,t.videoMid=l,t.audioMid=u,t.sequenceId=m,t.streamState=StreamState.SUB_ED,t.subAudio=!0,t.subVideo=!0,e.next=44,null==(o=this._handler)?void 0:o.handleAck({action:SdpAction.subscribe,streamId:t.streamId,audioMid:u,videoMid:l,audioTransceiverInit:null==s?void 0:s.audioTransceiverInit,videoTransceiverInit:null==s?void 0:s.videoTransceiverInit,signalingAck:{sdp:g,sequenceId:m},stream:t});case 44:return e.next=46,Promise.all(_);case 46:null==(a=this._monitor)||a.report("rtc_subscribe_stat",{result:"success",start:c,message:"unknown",stream_user_id:t.userId}),this._context&&t.startReport((function(e){return v.emit("onRemoteStreamStats",e)}),this._handler);case 48:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"unsubscribePublicStream",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return logRemoteStream("unsubscribePublicStream()",t,this.logger),i={appId:this._context.appId,streamId:t.streamId},e.prev=2,e.next=5,null==(r=this._dataChannelSignal)?void 0:r.sendSignaling("stopPullStream",i);case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:return t.streamState=StreamState.INIT,t.subVideo=!1,t.subAudio=!1,e.next=14,null==(n=this._handler)?void 0:n.handleAck({action:SdpAction.unsubscribe,streamId:t.streamId,audioMid:t.audioMid,videoMid:t.videoMid,stream:t});case 14:t.clean(),t.subMediaType=ExtendMediaType.NONE,this.removeOnTrackListener(t),t.statsReport.unsubscribe();case 18:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(e){return r.apply(this,arguments)})},{key:"destroy",value:function(){var e,t,r;this.logger.info("destroy()"),this._joinRoomFailed("leave_room"),this._token=void 0,this._roomId=void 0,this._clientId=void 0,this._authorization=void 0,this._sessionId="",this._pubSubBackOff={},this._stopJoinRoom5xxRetry(),null==(e=this._handler)||e.destroy(),this._handler=void 0,null==(t=this._dataChannelSignal)||t.destroy(),this._dataChannelSignal=void 0,this._connectionManager.destroy(),null==(r=this._monitor)||r.set({connection_id:""}),this._removeSignalEventHandler(),this.removeAllListeners(),this.connectionState="disconnected"}},{key:"sendUserMessage",value:function(e,t){var r;return null==(r=this._dataChannelSignal)?void 0:r.sendP2PMessage({to:e,from:this._userInfo.userId,room:this._roomId,app:this._context.appId,msg:t})}},{key:"sendRoomMessage",value:function(e){var t;return null==(t=this._dataChannelSignal)?void 0:t.sendSignaling("customMessage",e)}},{key:"_joinRoomWithRetry",value:function(e,t,r){var n=this;return new Promise((function(i,o){n._dataChannelSignal.sendSignaling(e,t,void 0,1e4).then((function(e){n.emit("onJoinRoomAck",e),i(e)})).catch((function(a){if(r=r||new RetryLimiter,a.code>=500&&a.code<600&&getServerNow()-r.initTs<6e4){var s=r.getRetryDelay();return n.logger.warn("_joinRoomWithRetry","joinRoom failed(code: ".concat(a.code,"), will retry after ").concat(s,"ms")),void(n._joinRoom5xxTimer=window.setTimeout((function(){delete n._joinRoom5xxTimer,n._joinRoomWithRetry(e,t,r).then(i).catch(o)}),s))}o(a)}))}))}},{key:"_stopJoinRoom5xxRetry",value:function(){this._joinRoom5xxTimer&&(clearTimeout(this._joinRoom5xxTimer),delete this._joinRoom5xxTimer)}},{key:"_addConnectHandler",value:function(){var e=this;this._connectionManager.on("connected",(function(t){var r,n,i;e.logger.info("connectStateChange","connected"),null==(r=e._dataChannelSignal)||r.destroy(),null==(n=e._handler)||n.destroy(),e._handler=createHandler(e._context,t.pc),e._dataChannelSignal=t.signaling,e.supportConcurrent="chrome"===(null==(i=e._handler)?void 0:i.name),e._addSignalEventHandler(),e.isReconnecting&&(e.publicStream?e.emit("connectSuccess",{reconnect:!0}):(e._reportJoinRoomStart(),e._callJoinRoom(!0)))})),this._connectionManager.on("disconnected",(function(t){e.connectionState="disconnected",e.logger.error("connectStateChange","disconnected. %o",t),e.isReconnecting&&e.safeEmit(RoomEvent.RECONNECT_FAILED)})),this._connectionManager.on("connecting",(function(){var t;e.isReconnecting=!1,null==(t=e._handler)||t.destroy(),delete e._handler,e.connectionState="connecting",e.logger.info("connectStateChange","connecting")})),this._connectionManager.on("reconnecting",(function(){var t;e.connectionState="disconnected",e.isReconnecting=!0,null==(t=e._handler)||t.destroy(),delete e._handler,e.connectionState="connecting",e.logger.warn("connectStateChange","reconnecting"),e.safeEmit("reconnecting")})),this._connectionManager.on("connectWidthTcp",(function(){e.safeEmit(RoomEvent.ON_ICE_CONNECT_WITH_TCP)})),["__onGetIceConfigHook","__onIceConnectSuccessHook"].forEach((function(t){e._connectionManager.on(t,(function(){return e.emit(t)}))}))}},{key:"_reportJoinRoomStart",value:function(){var e;this._joinRoomStartTs=getServerNow(),this.emit("__joinRoomStartReport"),null==(e=this._monitor)||e.report("join_room",{type:"begin",start:this._joinRoomStartTs,result:!1,reason:""},{enable_cloud_proxy:this._context.useCloudProxy,expectedIDC:this._context.expectedIDC})}},{key:"getPubSubBackOff",value:function(e){return this._pubSubBackOff[e]||(this._pubSubBackOff[e]={interval:1e3,retryDuration:0}),this._pubSubBackOff[e]}},{key:"_joinRoomSuccess",value:function(e){var t,r;this._joinReject&&this._joinResolve&&(this._joinResolve(e),delete this._joinReject,delete this._joinResolve),this._joinRoomStartTs&&(this.emit("__joinRoomSuccessReport"),null==(t=this._monitor)||t.report("join_room",{type:"end",start:this._joinRoomStartTs,result:!0,reason:""},{enable_cloud_proxy:this._context.useCloudProxy,expectedIDC:this._context.expectedIDC}),null==(r=this._monitor)||r.report("rtc_join_room",{error_code:0,deviceModel:"web",deviceManufacturer:"web",elapse:getServerNow()-this._joinRoomStartTs}),delete this._joinRoomStartTs)}},{key:"_joinRoomFailed",value:function(e,t){var r;this._joinReject&&this._joinResolve&&(this._joinReject(new SDKError(t||ErrorCode.JOIN_ROOM_FAILED,e)),delete this._joinReject,delete this._joinResolve),this._joinRoomStartTs&&(this.emit("__joinRoomFailedReport"),null==(r=this._monitor)||r.report("join_room",{type:"end",start:this._joinRoomStartTs,result:!1,reason:e},{enable_cloud_proxy:this._context.useCloudProxy,expectedIDC:this._context.expectedIDC}),delete this._joinRoomStartTs)}},{key:"multiChatMode",value:function(){var e;return null==(e=this._roomAttributes)?void 0:e.multiChatMode}},{key:"sendForwardStreamSignal",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,o,a=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={forwardStreamType:t,roomId:r},e.abrupt("return",(("start"===t||"update"===t)&&(o.dstRoomInfos=null==n?void 0:n.map((function(e){return{dstRoomId:e.roomId,dstToken:Utils.token2auth(a._context.appId,e.roomId,a._clientId,e.token)}}))),null==(i=this._dataChannelSignal)?void 0:i.sendSignaling("forwardStream",o)));case 2:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})},{key:"handler",get:function(){return this._handler}},{key:"roomAttributes",get:function(){return this._roomAttributes},set:function(e){this._roomAttributes=e}},{key:"vendorConfig",get:function(){return this._vendorConfig}}]),I}(EnhancedEventEmitter);function checkConnection(e,t,r){var n=r.value;return r.value=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var r,i,o,a=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._handler&&"connected"===this._state){e.next=2;break}throw new SDKError(ErrorCode.NOT_CONNECTED_YET,"error in ".concat(t,": try again after joined"));case 2:for(r=a.length,i=new Array(r),o=0;o<r;o++)i[o]=a[o];return e.next=5,n.apply(this,i);case 5:case"end":return e.stop()}}),e,this)}))),r}function pubSubLock(e,t,r){var n=r.value;return r.value=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,i,o,a=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._pubSubLock.lock();case 2:for(t=e.sent,this.supportConcurrent&&t(),e.prev=4,r=a.length,i=new Array(r),o=0;o<r;o++)i[o]=a[o];return e.next=8,n.apply(this,i);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,this.supportConcurrent||t(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[4,,9,12]])}))),r}function interrupt(e,t,r){var n=r.value;return r.value=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,i,o,a=this,s=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=s.length,r=new Array(t),i=0;i<t;i++)r[i]=s[i];return o=!1,e.abrupt("return",new Promise(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,i){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.on("INTERRUPT",(function(){o=!0,i(new SDKError(ErrorCode.OPERATION_CANCEL,"operation not finish when leave"))})),e.prev=1,e.t0=t,e.next=5,n.apply(a,r);case 5:e.t1=e.sent,(0,e.t0)(e.t1),e.next=12;break;case 9:e.prev=9,e.t2=e.catch(1),o||i(e.t2);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,r){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e)}))),r}__decorateClass$4([interrupt],MediaServerClient.prototype,"join",1),__decorateClass$4([pubSubLock,checkConnection],MediaServerClient.prototype,"publish",1),__decorateClass$4([pubSubLock,checkConnection],MediaServerClient.prototype,"updatePubTrack",1),__decorateClass$4([checkConnection],MediaServerClient.prototype,"updateVideoDescriptions",1),__decorateClass$4([pubSubLock,checkConnection],MediaServerClient.prototype,"unpublish",1),__decorateClass$4([pubSubLock,checkConnection],MediaServerClient.prototype,"subscribe",1),__decorateClass$4([checkConnection],MediaServerClient.prototype,"controlMessage",1),__decorateClass$4([checkConnection],MediaServerClient.prototype,"updateUserAttributes",1),__decorateClass$4([checkConnection],MediaServerClient.prototype,"updateSubTrackLayer",1),__decorateClass$4([checkConnection],MediaServerClient.prototype,"updateSubPriority",1),__decorateClass$4([pubSubLock,checkConnection],MediaServerClient.prototype,"subscribe4pushTrack",1),__decorateClass$4([pubSubLock,checkConnection],MediaServerClient.prototype,"unsubscribe4removeTrack",1),__decorateClass$4([pubSubLock,checkConnection],MediaServerClient.prototype,"unsubscribe",1),__decorateClass$4([checkConnection],MediaServerClient.prototype,"handleRemoveStream",1),__decorateClass$4([pubSubLock],MediaServerClient.prototype,"subscribePublicStream",1),__decorateClass$4([pubSubLock],MediaServerClient.prototype,"unsubscribePublicStream",1);var reportFirstFrameRecvError=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i){var o,a,s,c,u,l,d,p,_,h,f,m,g;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u="",l=-1,d="video"===t?null==(o=null==n?void 0:n.videoTrack)?void 0:o.originTrack:null==(a=null==n?void 0:n.audioTrack)?void 0:a.originTrack,p="video"===t?null==(s=null==n?void 0:n.videoTransceiver)?void 0:s.receiver:null==(c=null==n?void 0:n.audioTransceiver)?void 0:c.receiver,e.prev=3,e.t0=null==r?void 0:r.pc,!e.t0){e.next=9;break}return e.next=8,getStats$1(null==r?void 0:r.pc,d);case 8:e.t0=e.sent;case 9:return _=e.t0,h=(_||[]).find((function(e){return"inbound-rtp"===e.type})),e.next=13,null==p?void 0:p.getStats();case 13:if(f=e.sent,m=[],null==f||f.forEach((function(e){return m.push(e.type)})),e.t1=(null==r?void 0:r.pc)&&0===(null==_?void 0:_.length)&&0!==m.length,!e.t1){e.next=21;break}return e.next=20,getStats$1(r.pc);case 20:g=e.sent;case 21:u=JSON.stringify({type:t,reports:_.map((function(e){return e.type})),reports2:m,pc:(null==r?void 0:r.pc)||null,track:(null==d?void 0:d.id)||null,bytes:null==h?void 0:h.bytesReceived,framesReceived:null==h?void 0:h.framesReceived,packetsReceived:null==h?void 0:h.packetsReceived,allReports:g}),e.next=27;break;case 24:e.prev=24,e.t2=e.catch(3),l=-999,u=e.t2.mseeage||JSON.stringify(e.t2);case 27:null==i||i.report("rtc_invoke_status",{sdk_api_name:"first_frame_recv_timeout",error_code:l,message:u,stream_id:(null==n?void 0:n.streamId)||"",stream_user_id:null==n?void 0:n.userId,elapse:0}),e.next=32;break;case 30:e.prev=30,e.t3=e.catch(0);case 32:case"end":return e.stop()}}),e,null,[[0,30],[3,24]])})));return function(t,r,n,i){return e.apply(this,arguments)}}(),reportFirstFrameSendError=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i){var o,a,s,c,u,l,d,p,_,h,f,m,g;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u="",l=-1,d="video"===t?null==(o=null==n?void 0:n.videoTrack)?void 0:o.preprocessingTrack:null==(a=null==n?void 0:n.audioTrack)?void 0:a.preprocessingTrack,p="video"===t?null==(s=null==n?void 0:n.videoTransceiver)?void 0:s.sender:null==(c=null==n?void 0:n.audioTransceiver)?void 0:c.sender,e.prev=3,e.t0=null==r?void 0:r.pc,!e.t0){e.next=9;break}return e.next=8,getStats$1(null==r?void 0:r.pc,d);case 8:e.t0=e.sent;case 9:return _=e.t0,h=(_||[]).find((function(e){return"outbound-rtp"===e.type})),e.next=13,null==p?void 0:p.getStats();case 13:if(f=e.sent,m=[],null==f||f.forEach((function(e){return m.push(e.type)})),e.t1=(null==r?void 0:r.pc)&&0===_.length&&0!==m.length,!e.t1){e.next=21;break}return e.next=20,getStats$1(r.pc);case 20:g=e.sent;case 21:u=JSON.stringify({type:t,reports:_.map((function(e){return e.type})),reports2:m,pc:(null==r?void 0:r.pc)||null,track:(null==d?void 0:d.id)||null,bytes:null==h?void 0:h.bytesSent,framesSent:null==h?void 0:h.framesSent,packetsSent:null==h?void 0:h.packetsSent,allReports:g}),e.next=27;break;case 24:e.prev=24,e.t2=e.catch(3),l=-999,u=e.t2.mseeage||JSON.stringify(e.t2);case 27:null==i||i.report("rtc_invoke_status",{sdk_api_name:"first_frame_send_timeout",error_code:l,message:u,stream_id:(null==n?void 0:n.streamId)||"",stream_user_id:null==n?void 0:n.userId,elapse:0}),e.next=32;break;case 30:e.prev=30,e.t3=e.catch(0);case 32:case"end":return e.stop()}}),e,null,[[0,30],[3,24]])})));return function(t,r,n,i){return e.apply(this,arguments)}}(),RecvFrameObserver=function(e){_inherits(a,e);var t,r,n,i,o=_createSuper(a);function a(e,t){var r;return _classCallCheck(this,a),r=o.call(this),__publicField(_assertThisInitialized(r),"_audioEventSessionId",genEventSessionId()),__publicField(_assertThisInitialized(r),"_videoEventSessionId",genEventSessionId()),__publicField(_assertThisInitialized(r),"_handler"),__publicField(_assertThisInitialized(r),"_stream"),__publicField(_assertThisInitialized(r),"_firstAudioFrameTimer"),__publicField(_assertThisInitialized(r),"_firstVideoFrameTimer"),__publicField(_assertThisInitialized(r),"_transportDelayInterval"),__publicField(_assertThisInitialized(r),"_transportDelay"),__publicField(_assertThisInitialized(r),"_firstVideoFrameInterval"),__publicField(_assertThisInitialized(r),"_firstAudioFrameInterval"),__publicField(_assertThisInitialized(r),"_isScreen",!1),__publicField(_assertThisInitialized(r),"_audioFirstFrameState",0),__publicField(_assertThisInitialized(r),"_videoFirstFrameState",0),__publicField(_assertThisInitialized(r),"_timeout",1e4),__publicField(_assertThisInitialized(r),"_currentAudioRecv",{startTime:0,eventSessionId:0,type:"login"}),__publicField(_assertThisInitialized(r),"_currentVideoRecv",{startTime:0,eventSessionId:0,type:"login"}),__publicField(_assertThisInitialized(r),"_login",!1),__publicField(_assertThisInitialized(r),"_unMuteAudio",!1),__publicField(_assertThisInitialized(r),"_enableAudio",!1),__publicField(_assertThisInitialized(r),"_unMuteVideo",!1),__publicField(_assertThisInitialized(r),"_enableVideo",!1),__publicField(_assertThisInitialized(r),"_remoteUnmuteAudio",!1),__publicField(_assertThisInitialized(r),"_remoteUnmuteVideo",!1),__publicField(_assertThisInitialized(r),"_audioExternal",!1),__publicField(_assertThisInitialized(r),"_pushAudio",!1),__publicField(_assertThisInitialized(r),"_videoExternal",!1),__publicField(_assertThisInitialized(r),"_pushVideo",!1),__publicField(_assertThisInitialized(r),"_autoSubscribeVideo",!1),__publicField(_assertThisInitialized(r),"_autoSubscribeAudio",!1),__publicField(_assertThisInitialized(r),"_autoSubscribe",!1),__publicField(_assertThisInitialized(r),"_publishVideo",!1),__publicField(_assertThisInitialized(r),"_publishAudio",!1),__publicField(_assertThisInitialized(r),"_subscribeAudio",!1),__publicField(_assertThisInitialized(r),"_subscribeVideo",!1),__publicField(_assertThisInitialized(r),"_subscribe",!1),__publicField(_assertThisInitialized(r),"_pushTrack",!1),__publicField(_assertThisInitialized(r),"_multiChatMode",!1),__publicField(_assertThisInitialized(r),"_monitor"),__publicField(_assertThisInitialized(r),"logger"),r._stream=e,r._handler=t,r.getTransportDelay(),r._monitor=getMonitor(e.engineId),r.logger=new Logger$1$1("RecvFrameObserver",0,e.engineId),r}return _createClass(a,[{key:"beginRecvFrame",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTransportDelay();case 2:g=this._transportDelay,v=!0,["login","unmute","subscribe","push_track"].indexOf(r)>=0&&(g=0,v=!1),"audio"===t?(v||this._audioEventSessionId++,this._currentAudioRecv={startTime:Date.now(),eventSessionId:this._audioEventSessionId,type:r},y={media_type:t,event_type:"begin_recv",type:r,is_screen:!!(null==(n=this._stream)?void 0:n.isScreen),start:null==(i=this._currentAudioRecv)?void 0:i.startTime,event_session_id:this._audioEventSessionId,stream_user_id:null==(o=this._stream)?void 0:o.userId,transport_delay:g,vendor_mode:(null==(a=this._stream)?void 0:a.vendorCode)||0,pc_session_id:(null==(s=this._stream)?void 0:s.pcSessionId)||(null==(c=this._handler)?void 0:c.peerConnectionId)},this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstAudioFrameTimer=window.setTimeout((function(){reportFirstFrameRecvError("audio",E._handler,E._stream,E._monitor),E.stopRecvFrame("audio","timeout"),E._firstAudioFrameInterval&&window.clearInterval(E._firstAudioFrameInterval)}),this._timeout),this.logger.info("rtcFirstFrameRecv",JSON.stringify(y)),null==(u=this._monitor)||u.report("rtc_first_frame",y),this._watchForFirstAudioFrameRecv(),this._audioFirstFrameState=1,this._login=!0,this._unMuteAudio=!0,this._enableAudio=!0,this._remoteUnmuteAudio=!0):"video"===t&&(v||this._videoEventSessionId++,this._currentVideoRecv={startTime:Date.now(),eventSessionId:this._videoEventSessionId,type:r},S={media_type:t,event_type:"begin_recv",type:r,is_screen:!!(null==(l=this._stream)?void 0:l.isScreen),start:null==(d=this._currentVideoRecv)?void 0:d.startTime,event_session_id:this._videoEventSessionId,stream_user_id:null==(p=this._stream)?void 0:p.userId,transport_delay:g,vendor_mode:(null==(_=this._stream)?void 0:_.vendorCode)||0,pc_session_id:(null==(h=this._stream)?void 0:h.pcSessionId)||(null==(f=this._handler)?void 0:f.peerConnectionId)},this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstVideoFrameTimer=window.setTimeout((function(){reportFirstFrameRecvError("video",E._handler,E._stream,E._monitor),E.stopRecvFrame("video","timeout"),E._firstVideoFrameInterval&&window.clearInterval(E._firstVideoFrameInterval)}),this._timeout),this._watchForFirstVideoFrameRecv(),this.logger.info("rtcFirstFrameRecv",JSON.stringify(S)),null==(m=this._monitor)||m.report("rtc_first_frame",S),this._videoFirstFrameState=1,this._login=!0,this._unMuteVideo=!0,this._enableVideo=!0,this._remoteUnmuteVideo=!0);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"stopRecvFrame",value:function(e,t){var r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g;if("audio"===e){if(1!==this._audioFirstFrameState)return;var v={event_type:"recv_end",media_type:e,is_screen:!!(null==(r=this._stream)?void 0:r.isScreen),start:null==(n=this._currentAudioRecv)?void 0:n.startTime,reason:t,result:!1,stream_user_id:null==(i=this._stream)?void 0:i.userId,event_session_id:this._audioEventSessionId,type:null==(o=this._currentAudioRecv)?void 0:o.type,vendor_mode:(null==(a=this._stream)?void 0:a.vendorCode)||0,pc_session_id:(null==(s=this._stream)?void 0:s.pcSessionId)||(null==(c=this._handler)?void 0:c.peerConnectionId)};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),delete this._currentAudioRecv,this.logger.info("rtcFirstFrameRecv",JSON.stringify(v)),null==(u=this._monitor)||u.report("rtc_first_frame",v),this._audioFirstFrameState=2}else if("video"===e){if(1!==this._videoFirstFrameState)return;var y={event_type:"recv_end",media_type:e,is_screen:!!(null==(l=this._stream)?void 0:l.isScreen),start:null==(d=this._currentVideoRecv)?void 0:d.startTime,reason:t,result:!1,stream_user_id:null==(p=this._stream)?void 0:p.userId,event_session_id:this._videoEventSessionId,type:null==(_=this._currentVideoRecv)?void 0:_.type,vendor_mode:(null==(h=this._stream)?void 0:h.vendorCode)||0,pc_session_id:(null==(f=this._stream)?void 0:f.pcSessionId)||(null==(m=this._handler)?void 0:m.peerConnectionId)};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),delete this._currentVideoRecv,this.logger.info("rtcFirstFrameRecv",JSON.stringify(y)),null==(g=this._monitor)||g.report("rtc_first_frame",y),this._videoFirstFrameState=2}}},{key:"recvFrameFinish",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTransportDelay();case 2:if(h=this._transportDelay,"audio"!==t){e.next=14;break}if(1===this._audioFirstFrameState){e.next=6;break}return e.abrupt("return");case 6:if(this._currentAudioRecv){e.next=8;break}return e.abrupt("return");case 8:f=this._currentAudioRecv,m=f.type,g=f.startTime,["login","unmute","subscribe","push_track"].indexOf(m)>=0&&(h=0),v={event_type:"recv_end",media_type:t,start:g,result:!0,is_screen:!!(null==(r=this._stream)?void 0:r.isScreen),stream_user_id:null==(n=this._stream)?void 0:n.userId,event_session_id:this._audioEventSessionId,type:m,transport_delay:h,vendor_mode:(null==(i=this._stream)?void 0:i.vendorCode)||0,pc_session_id:(null==(o=this._stream)?void 0:o.pcSessionId)||(null==(a=this._handler)?void 0:a.peerConnectionId)},delete this._currentAudioRecv,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this.logger.info("rtcFirstFrameRecv",JSON.stringify(v)),null==(s=this._monitor)||s.report("rtc_first_frame",v),this.emit("recvAudioFirstFrame"),this._audioFirstFrameState=3,e.next=23;break;case 14:if("video"!==t){e.next=23;break}if(1===this._videoFirstFrameState){e.next=17;break}return e.abrupt("return");case 17:if(this._currentVideoRecv){e.next=19;break}return e.abrupt("return");case 19:y=this._currentVideoRecv,S=y.type,E=y.startTime,["login","unmute","subscribe","push_track"].indexOf(S)>=0&&(h=0),T={event_type:"recv_end",media_type:t,is_screen:!!(null==(c=this._stream)?void 0:c.isScreen),start:E,result:!0,stream_user_id:null==(u=this._stream)?void 0:u.userId,event_session_id:this._videoEventSessionId,type:S,transport_delay:h,vendor_mode:(null==(l=this._stream)?void 0:l.vendorCode)||0,pc_session_id:(null==(d=this._stream)?void 0:d.pcSessionId)||(null==(p=this._handler)?void 0:p.peerConnectionId)},delete this._currentVideoRecv,this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this.logger.info("rtcFirstFrameRecv",JSON.stringify(T)),null==(_=this._monitor)||_.report("rtc_first_frame",T),this.emit("recvVideoFirstFrame"),this._videoFirstFrameState=3;case 23:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"setLogin",value:function(e){var t,r,n,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{audio:!0,video:!0};this._login!==e&&(this._login=e,e&&(null==(t=this._stream)?void 0:t.hasAudio)&&o.audio&&this.beginRecvFrame("audio","login"),e&&(null==(r=this._stream)?void 0:r.hasVideo)&&o.video&&this.beginRecvFrame("video","login"),!e&&(null==(n=this._stream)?void 0:n.hasAudio)&&this.stopRecvFrame("audio","leave_room"),!e&&(null==(i=this._stream)?void 0:i.hasVideo)&&this.stopRecvFrame("video","leave_room"))}},{key:"setUnmuteAudio",value:function(e){var t,r,n;if(this._unMuteAudio!==e){this._unMuteAudio=e;var i=!!(null==(t=this._stream)?void 0:t.hasAudio);(null==(r=this._stream)?void 0:r.audioHasCapture)&&(null==(n=this._stream)?void 0:n.audioHasPublish)&&(this._unMuteAudio&&i?this.beginRecvFrame("audio","unmute"):i&&this.stopRecvFrame("audio","mute"))}}},{key:"setRemoteUnmuteAudio",value:function(e){this._remoteUnmuteAudio!==e&&(this._remoteUnmuteAudio=e,this._remoteUnmuteAudio?this.beginRecvFrame("audio","remote_unmute"):this.stopRecvFrame("audio","remote_mute"))}},{key:"setEnableAudio",value:function(e){var t;this._enableAudio!==e&&(this._enableAudio=e,this._enableAudio?this.beginRecvFrame("audio","enable"):(null==(t=this._stream)?void 0:t.hasAudio)&&this.stopRecvFrame("audio","disable"))}},{key:"setUnmuteVideo",value:function(e){var t,r,n;if(this._unMuteVideo!==e){this._unMuteVideo=e;var i=!!(null==(t=this._stream)?void 0:t.hasVideo);(null==(r=this._stream)?void 0:r.videoHasCapture)&&(null==(n=this._stream)?void 0:n.videoHasPublish)&&(this._unMuteVideo&&i?this.beginRecvFrame("video","unmute"):i&&this.stopRecvFrame("video","mute"))}}},{key:"setHandler",value:function(e){this._handler=e}},{key:"setRemoteUnmuteVideo",value:function(e){this._remoteUnmuteVideo!==e&&(this._remoteUnmuteVideo=e,this._remoteUnmuteVideo?this.beginRecvFrame("video","remote_unmute"):this.stopRecvFrame("video","remote_mute"))}},{key:"setEnableVideo",value:function(e){this._enableVideo!==e&&(this._enableVideo=e,this._enableVideo?this.beginRecvFrame("video","enable"):this.stopRecvFrame("video","disable"))}},{key:"setExternalAudioSource",value:function(e){this._audioExternal=e}},{key:"setPushAudio",value:function(e){var t;this._audioExternal&&this._pushAudio!==e&&(this._pushAudio=e),this._pushAudio&&this.beginRecvFrame("audio","push"),!e&&(null==(t=this._stream)?void 0:t.hasAudio)&&this.stopRecvFrame("audio","stop_push")}},{key:"setExternalVideoSource",value:function(e){this._videoExternal=e}},{key:"setPushVideo",value:function(e){var t;this._videoExternal&&this._pushVideo!==e&&(this._pushVideo=e),this._pushVideo&&this.beginRecvFrame("video","push"),!e&&(null==(t=this._stream)?void 0:t.hasVideo)&&this.stopRecvFrame("video","stop_push")}},{key:"setPublishVideo",value:function(e){var t;this._publishVideo!==e&&(this._publishVideo=e),this._publishVideo&&this.beginRecvFrame("video","publish"),!e&&(null==(t=this._stream)?void 0:t.hasVideo)&&this.stopRecvFrame("video","unpublish")}},{key:"setPublishAudio",value:function(e){var t;this._publishAudio!==e&&(this._publishAudio=e),this._publishAudio&&this.beginRecvFrame("audio","publish"),!e&&(null==(t=this._stream)?void 0:t.hasAudio)&&this.stopRecvFrame("audio","unpublish")}},{key:"setAutoSubscribe",value:function(e){this._autoSubscribe=e}},{key:"setAutoSubscribeVideo",value:function(e){this._autoSubscribeVideo=e}},{key:"setAutoSubscribeAudio",value:function(e){this._autoSubscribeAudio=e}},{key:"setSubscribeAudio",value:function(e){var t,r;this._autoSubscribeAudio||this._subscribeAudio===e||(this._subscribe=e,e&&(null==(t=this._stream)?void 0:t.hasAudio)&&this.beginRecvFrame("audio","subscribe")),!e&&(null==(r=this._stream)?void 0:r.hasAudio)&&this.stopRecvFrame("audio","unsubscribe")}},{key:"setSubscribeVideo",value:function(e){var t,r;this._autoSubscribeVideo||this._subscribeVideo===e||(this._subscribeVideo=e,e&&(null==(t=this._stream)?void 0:t.hasVideo)&&this.beginRecvFrame("video","subscribe")),!e&&(null==(r=this._stream)?void 0:r.hasVideo)&&this.stopRecvFrame("video","unsubscribe")}},{key:"setPushTrack",value:function(e){var t;this._pushTrack!==e&&(this._pushTrack=e,e&&!this._isScreen&&this.beginRecvFrame("audio","push_track"),!e&&(null==(t=this._stream)?void 0:t.hasAudio)&&this.stopRecvFrame("audio","remove_track"))}},{key:"setMultiChatMode",value:function(e){this._multiChatMode=e}},{key:"setTimeout",value:function(e){this._timeout=e}},{key:"_watchForFirstVideoFrameRecv",value:function(){var e=this,t=-1,r=-1;this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval),this._firstVideoFrameInterval=window.setInterval(_asyncToGenerator(_regeneratorRuntime().mark((function n(){var i,o,a,s,c,u,l;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(null==(i=e._handler)?void 0:i.pc)||!(null==(a=null==(o=e._stream)?void 0:o.videoTrack)?void 0:a.preprocessingTrack)){n.next=8;break}return n.next=3,getStats$1(null==(s=e._handler)?void 0:s.pc,null==(u=null==(c=e._stream)?void 0:c.videoTrack)?void 0:u.preprocessingTrack);case 3:if(!(l=n.sent.find((function(e){return"inbound-rtp"===e.type})))||!(l.framesReceived>t||l.packetsReceived>r)){n.next=8;break}if(-1!==t||-1!==r){n.next=7;break}return n.abrupt("return",(t=l.framesReceived,void(r=l.packetsReceived)));case 7:e.recvFrameFinish("video"),window.clearInterval(e._firstVideoFrameInterval);case 8:case"end":return n.stop()}}),n)}))),200)}},{key:"_watchForFirstAudioFrameRecv",value:function(){var e=this,t=-1,r=-1;this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval),this._firstAudioFrameInterval=window.setInterval(_asyncToGenerator(_regeneratorRuntime().mark((function n(){var i,o,a,s,c,u,l;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(null==(i=e._handler)?void 0:i.pc)||!(null==(a=null==(o=e._stream)?void 0:o.audioTrack)?void 0:a.originTrack)){n.next=8;break}return n.next=3,getStats$1(null==(s=e._handler)?void 0:s.pc,null==(u=null==(c=e._stream)?void 0:c.audioTrack)?void 0:u.originTrack);case 3:if(!(l=n.sent.find((function(e){return"inbound-rtp"===e.type})))||!(l.totalSamplesReceived>t||l.packetsReceived>r)){n.next=8;break}if(-1!==t||-1!==r){n.next=7;break}return n.abrupt("return",(t=l.totalSamplesReceived,void(r=l.packetsReceived)));case 7:e.recvFrameFinish("audio"),window.clearInterval(e._firstAudioFrameInterval);case 8:case"end":return n.stop()}}),n)}))),200)}},{key:"getTransportDelay",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTransportDelayIntl();case 2:window.clearInterval(this._transportDelayInterval),this._transportDelayInterval=window.setInterval(_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getTransportDelayIntl();case 2:case"end":return e.stop()}}),e)}))),2e3);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getTransportDelayIntl",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null==(t=this._handler)?void 0:t.pc)){e.next=7;break}return e.next=3,getStats$1(null==(r=this._handler)?void 0:r.pc);case 3:n=e.sent,i=n.find((function(e){return"transport"===e.type&&"connected"===e.dtlsState})),(o=n.find((function(e){return"candidate-pair"===e.type&&"succeeded"===e.state&&e.id===(null==i?void 0:i.selectedCandidatePairId)})))&&(this._transportDelay=Math.round(1e3*o.currentRoundTripTime/2));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"reset",value:function(){this._currentAudioRecv={startTime:0,eventSessionId:0,type:"login"},this._currentVideoRecv={startTime:0,eventSessionId:0,type:"login"},this._login=!1,this._unMuteAudio=!1,this._enableAudio=!1,this._unMuteVideo=!1,this._remoteUnmuteAudio=!1,this._remoteUnmuteVideo=!1,this._enableVideo=!1,this._audioExternal=!1,this._pushAudio=!1,this._videoExternal=!1,this._pushVideo=!1,this._autoSubscribeVideo=!1,this._autoSubscribeAudio=!1,this._autoSubscribe=!1,this._subscribeAudio=!1,this._subscribeVideo=!1,this._subscribe=!1,this._pushTrack=!1,this._multiChatMode=!1,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval),this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval),this._transportDelayInterval&&window.clearInterval(this._transportDelayInterval)}},{key:"audioFirstFrameReceived",get:function(){return 3===this._audioFirstFrameState}},{key:"FirstFrameReceived",get:function(){return 3===this._audioFirstFrameState}}]),a}(eventemitter3Exports.EventEmitter),SendFrameObserver=function(){function e(t,r){_classCallCheck(this,e),__publicField(this,"_audioEventSessionId",genEventSessionId()),__publicField(this,"_videoEventSessionId",genEventSessionId()),__publicField(this,"_pcSessionId"),__publicField(this,"_handler"),__publicField(this,"_firstAudioFrameTimer"),__publicField(this,"_firstVideoFrameTimer"),__publicField(this,"_stream"),__publicField(this,"_firstVideoFrameInterval"),__publicField(this,"_firstAudioFrameInterval"),__publicField(this,"_currentAudioSend",{startTime:0,eventSessionId:0,type:"login"}),__publicField(this,"_currentVideoSend",{startTime:0,eventSessionId:0,type:"login"}),__publicField(this,"_login",!1),__publicField(this,"_publisher",!1),__publicField(this,"_unMuteAudio",!1),__publicField(this,"_enableAudio",!1),__publicField(this,"_unMuteVideo",!1),__publicField(this,"_enableVideo",!1),__publicField(this,"_audioExternal",!1),__publicField(this,"_pushAudio",!1),__publicField(this,"_videoExternal",!1),__publicField(this,"_pushVideo",!1),__publicField(this,"_autoPublish",!1),__publicField(this,"_publish",!1),__publicField(this,"_timeout",1e4),__publicField(this,"_audioFirstFrameState",0),__publicField(this,"_videoFirstFrameState",0),__publicField(this,"_monitor"),__publicField(this,"logger"),this._stream=t,this._handler=r,this._monitor=getMonitor(t.engineId),this.logger=new Logger$1$1("SendFrameObserver",0,t.engineId)}var t,r;return _createClass(e,[{key:"beginSendFrame",value:function(e,t){var r,n,i,o,a,s,c,u,l,d,p,_,h=this;if("audio"===e){this._audioEventSessionId++,this._currentAudioSend={startTime:Date.now(),eventSessionId:this._audioEventSessionId,type:t};var f={event_type:"begin_send",media_type:e,is_screen:!!(null==(r=this._stream)?void 0:r.isScreen),type:t,start:null==(n=this._currentAudioSend)?void 0:n.startTime,event_session_id:this._audioEventSessionId,vendor_mode:(null==(i=this._stream)?void 0:i.vendorCode)||0,pc_session_id:(null==(o=this._stream)?void 0:o.pcSessionId)||(null==(a=this._handler)?void 0:a.peerConnectionId)};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstAudioFrameTimer=window.setTimeout((function(){reportFirstFrameSendError("audio",h._handler,h._stream,h._monitor),h.stopSendFrame("audio","timeout"),h._firstAudioFrameInterval&&window.clearInterval(h._firstAudioFrameInterval)}),this._timeout),this.logger.info("rtcFirstFrameSend",JSON.stringify(f)),null==(s=this._monitor)||s.report("rtc_first_frame",f),this._watchForFirstAudioFrameSend(),this._audioFirstFrameState=1,this._login=!0,this._publisher=!0,this._publish=!0,this._unMuteAudio=!0,this._pushAudio||(this._enableAudio=!0)}else if("video"===e){this._videoEventSessionId++,this._currentVideoSend={startTime:Date.now(),eventSessionId:this._videoEventSessionId,type:t};var m={event_type:"begin_send",media_type:e,is_screen:!!(null==(c=this._stream)?void 0:c.isScreen),type:t,start:null==(u=this._currentVideoSend)?void 0:u.startTime,event_session_id:this._videoEventSessionId,vendor_mode:(null==(l=this._stream)?void 0:l.vendorCode)||0,pc_session_id:(null==(d=this._stream)?void 0:d.pcSessionId)||(null==(p=this._handler)?void 0:p.peerConnectionId)};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstVideoFrameTimer=window.setTimeout((function(){reportFirstFrameSendError("video",h._handler,h._stream,h._monitor),h.stopSendFrame("video","timeout"),h._firstVideoFrameInterval&&window.clearInterval(h._firstVideoFrameInterval)}),this._timeout),this._watchForFirstVideoFrameSend(),this.logger.info("rtcFirstFrameSend",JSON.stringify(m)),null==(_=this._monitor)||_.report("rtc_first_frame",m),this._videoFirstFrameState=1,this._login=!0,this._publisher=!0,this._publish=!0,this._unMuteVideo=!0,this._pushVideo||(this._enableVideo=!0)}}},{key:"stopSendFrame",value:function(e,t){var r,n,i,o,a,s,c,u,l,d,p,_,h,f;if("audio"===e){if(1!==this._audioFirstFrameState)return;var m={event_type:"sent_end",media_type:e,is_screen:!!(null==(r=this._stream)?void 0:r.isScreen),start:null==(n=this._currentAudioSend)?void 0:n.startTime,reason:t,result:!1,event_session_id:this._audioEventSessionId,type:null==(i=this._currentAudioSend)?void 0:i.type,vendor_mode:(null==(o=this._stream)?void 0:o.vendorCode)||0,pc_session_id:(null==(a=this._stream)?void 0:a.pcSessionId)||(null==(s=this._handler)?void 0:s.peerConnectionId)};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),delete this._currentAudioSend,this.logger.info("rtcFirstFrameSend",JSON.stringify(m)),null==(c=this._monitor)||c.report("rtc_first_frame",m),this._audioFirstFrameState=2}else if("video"===e){if(1!==this._videoFirstFrameState)return;var g={event_type:"sent_end",media_type:e,start:null==(u=this._currentVideoSend)?void 0:u.startTime,is_screen:!!(null==(l=this._stream)?void 0:l.isScreen),reason:t,result:!1,event_session_id:this._videoEventSessionId,type:null==(d=this._currentVideoSend)?void 0:d.type,vendor_mode:(null==(p=this._stream)?void 0:p.vendorCode)||0,pc_session_id:(null==(_=this._stream)?void 0:_.pcSessionId)||(null==(h=this._handler)?void 0:h.peerConnectionId)};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),delete this._currentVideoSend,this.logger.info("rtcFirstFrameSend",JSON.stringify(g)),null==(f=this._monitor)||f.report("rtc_first_frame",g),this._videoFirstFrameState=2}}},{key:"sendFrameFinish",value:function(e){var t,r,n,i,o,a,s,c,u,l;if("audio"===e){if(1!==this._audioFirstFrameState)return;if(!this._currentAudioSend)return;var d=this._currentAudioSend,p=d.type,_=d.startTime,h={event_type:"sent_end",media_type:e,is_screen:!!(null==(t=this._stream)?void 0:t.isScreen),start:_,result:!0,event_session_id:this._audioEventSessionId,type:p,vendor_mode:(null==(r=this._stream)?void 0:r.vendorCode)||0,pc_session_id:(null==(n=this._stream)?void 0:n.pcSessionId)||(null==(i=this._handler)?void 0:i.peerConnectionId)};delete this._currentAudioSend,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this.logger.info("rtcFirstFrameSend",JSON.stringify(h)),null==(o=this._monitor)||o.report("rtc_first_frame",h),this._audioFirstFrameState=3}else if("video"===e){if(1!==this._videoFirstFrameState)return;if(!this._currentVideoSend)return;var f=this._currentVideoSend,m=f.type,g=f.startTime,v={event_type:"sent_end",media_type:e,is_screen:!!(null==(a=this._stream)?void 0:a.isScreen),start:g,result:!0,event_session_id:this._videoEventSessionId,type:m,vendor_mode:(null==(s=this._stream)?void 0:s.vendorCode)||0,pc_session_id:(null==(c=this._stream)?void 0:c.pcSessionId)||(null==(u=this._handler)?void 0:u.peerConnectionId)};delete this._currentVideoSend,this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this.logger.info("rtcFirstFrameSend",JSON.stringify(v)),null==(l=this._monitor)||l.report("rtc_first_frame",v),this._videoFirstFrameState=3}}},{key:"setLogin",value:function(e){var t,r;this._login!==e&&(this._login=e,e&&((null==(t=this._stream)?void 0:t.videoTrack)&&this.beginSendFrame("video","login"),(null==(r=this._stream)?void 0:r.audioTrack)&&this.beginSendFrame("audio","login")),!e&&this._audioSending&&this.stopSendFrame("audio","leave_room"),!e&&this._videoSending&&this.stopSendFrame("video","leave_room"))}},{key:"setPublish",value:function(e){var t,r,n,i;this._publish!==e&&(this._publish=e,e&&((null==(t=this._stream)?void 0:t.videoTrack)&&(null==(r=this._stream)?void 0:r.pubVideo)&&this.beginSendFrame("video","publish"),(null==(n=this._stream)?void 0:n.audioTrack)&&(null==(i=this._stream)?void 0:i.pubAudio)&&this.beginSendFrame("audio","publish")),!e&&this._audioSending&&this.stopSendFrame("audio","unpublish"),!e&&this._videoSending&&this.stopSendFrame("video","unpublish"))}},{key:"setUnmuteAudio",value:function(e){var t;this._unMuteAudio!==e&&(this._unMuteAudio=e,(null==(t=this._stream)?void 0:t.audioHasCapture)&&(e&&this.beginSendFrame("audio","unmute"),!e&&this._audioSending&&this.stopSendFrame("audio","mute")))}},{key:"setEnableAudio",value:function(e){var t;this._enableAudio!==e&&(null==(t=this._stream)?void 0:t.pubAudio)&&(this._enableAudio=e,e&&this.beginSendFrame("audio","enable"),!e&&this._audioSending&&this.stopSendFrame("audio","disable"))}},{key:"setUnmuteVideo",value:function(e){var t;this._unMuteVideo!==e&&(this._unMuteVideo=e,(null==(t=this._stream)?void 0:t.videoHasCapture)&&(e&&this.beginSendFrame("video","unmute"),!e&&this._videoSending&&this.stopSendFrame("video","mute")))}},{key:"setEnableVideo",value:function(e){var t;this._enableVideo!==e&&(null==(t=this._stream)?void 0:t.pubVideo)&&(this._enableVideo=e,e&&this.beginSendFrame("video","enable"),!e&&this._videoSending&&this.stopSendFrame("video","disable"))}},{key:"setExternalAudioSource",value:function(e){this._audioExternal!==e&&(this._audioExternal=e,e&&(this._audioSending&&this.stopSendFrame("audio","disable"),this._enableAudio=!1),e||(this._audioSending&&this.stopSendFrame("audio","stop_push"),this._pushAudio=!1))}},{key:"setPushAudio",value:function(e){this._pushAudio!==e&&(this._pushAudio=e,e&&this.beginSendFrame("audio","push"),!e&&this._audioSending&&this.stopSendFrame("audio","stop_push"))}},{key:"setExternalVideoSource",value:function(e){this._videoExternal!==e&&(this._videoExternal=e,e&&(this._videoSending&&this.stopSendFrame("video","disable"),this._enableVideo=!1),e||(this._videoSending&&this.stopSendFrame("video","stop_push"),this._pushVideo=!1))}},{key:"setPushVideo",value:function(e){this._pushVideo!==e&&(this._pushVideo=e,e&&this.beginSendFrame("video","push"),!e&&this._videoSending&&this.stopSendFrame("video","stop_push"))}},{key:"setAutoPublish",value:function(e){this._autoPublish=e}},{key:"setPublisher",value:function(e){this._publisher!==e&&(this._publisher=e,!e&&this._audioSending&&this.stopSendFrame("audio","audience"),!e&&this._videoSending&&this.stopSendFrame("video","audience"))}},{key:"setTimeout",value:function(e){this._timeout=e}},{key:"setPCSessionId",value:function(e){this._pcSessionId=e}},{key:"setHandler",value:function(e){this._handler=e}},{key:"_getFirstVideoFrameStats",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null==(t=this._handler)?void 0:t.pc)||!(null==(n=null==(r=this._stream)?void 0:r.videoTrack)?void 0:n.preprocessingTrack)){e.next=4;break}return e.next=3,getStats$1(null==(i=this._handler)?void 0:i.pc,null==(o=this._stream)?void 0:o.videoTrack.preprocessingTrack);case 3:return e.abrupt("return",e.sent.filter((function(e){return"outbound-rtp"===e.type})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_getFirstAudioFrameStats",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null==(t=this._handler)?void 0:t.pc)||!(null==(n=null==(r=this._stream)?void 0:r.audioTrack)?void 0:n.preprocessingTrack)){e.next=4;break}return e.next=3,getStats$1(null==(i=this._handler)?void 0:i.pc,null==(o=this._stream)?void 0:o.audioTrack.preprocessingTrack);case 3:return e.abrupt("return",e.sent.find((function(e){return"outbound-rtp"===e.type})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_watchForFirstVideoFrameSend",value:function(){var e=this,t=-1,r=-1;this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval),this._firstVideoFrameInterval=window.setInterval(_asyncToGenerator(_regeneratorRuntime().mark((function n(){var i,o,a;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e._getFirstVideoFrameStats();case 2:if(i=n.sent,o=0,a=0,null==i||i.map((function(e){o+=e.framesSent,a+=e.packetsSent})),!(i&&i.length>0&&(o>t||a>r))){n.next=8;break}if(-1!==t||-1!==r){n.next=7;break}return n.abrupt("return",(t=o,void(r=a)));case 7:e.sendFrameFinish("video"),window.clearInterval(e._firstVideoFrameInterval);case 8:case"end":return n.stop()}}),n)}))),100)}},{key:"_watchForFirstAudioFrameSend",value:function(){var e=this,t=-1;this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval),this._firstAudioFrameInterval=window.setInterval(_asyncToGenerator(_regeneratorRuntime().mark((function r(){var n;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e._getFirstAudioFrameStats();case 2:if(!((n=r.sent)&&n.packetsSent>t)){r.next=7;break}if(-1!==t){r.next=6;break}return r.abrupt("return",void(t=n.packetsSent));case 6:e.sendFrameFinish("audio"),window.clearInterval(e._firstAudioFrameInterval);case 7:case"end":return r.stop()}}),r)}))),100)}},{key:"reset",value:function(){this._login=!1,this._publisher=!1,this._unMuteAudio=!1,this._enableAudio=!1,this._unMuteVideo=!1,this._enableVideo=!1,this._audioExternal=!1,this._pushAudio=!1,this._videoExternal=!1,this._pushVideo=!1,this._autoPublish=!1,this._publish=!1,this._audioFirstFrameState=0,this._videoFirstFrameState=0,this._currentAudioSend={startTime:0,eventSessionId:0,type:"login"},this._currentVideoSend={startTime:0,eventSessionId:0,type:"login"},window.clearTimeout(this._firstAudioFrameTimer),window.clearTimeout(this._firstVideoFrameTimer),window.clearInterval(this._firstAudioFrameInterval),window.clearInterval(this._firstVideoFrameInterval)}},{key:"destroy",value:function(){this.reset(),delete this._stream,delete this._handler}},{key:"_audioSending",get:function(){return 1===this._audioFirstFrameState}},{key:"_videoSending",get:function(){return 1===this._videoFirstFrameState}}]),e}(),CONFIG={audio:{delay:1200,stallRadio:.3},video:{delay:1200,stallRadio:.6},screen_audio:{delay:1600,stallRadio:.8},screen_video:{delay:1600,stallRadio:.8}},NetworkQualityManager=function(){function e(){_classCallCheck(this,e),__publicField(this,"_preUplinkStats",new Map),__publicField(this,"_preDownlinkStats",new Map),__publicField(this,"_timer"),__publicField(this,"_delayTimer"),__publicField(this,"_msc"),__publicField(this,"reportor")}return _createClass(e,[{key:"updateUplinkStats",value:function(e){var t=e.audioStats,r=e.videoStats,n=e.isScreen;if(t.sendKBitrate>0&&t.rtt){var i=n?"screen_audio":"audio",o=t.rtt,a=t._fractionLost,s=t._retransmittedRate,c=this._getQosLevel(o,a||0,s||0),u=this._preUplinkStats.get(i)||[c];this._preUplinkStats.set(i,[].concat(_toConsumableArray(u),[c]).slice(-2))}if(r.sentKBitrate>0&&r.rtt){var l=n?"screen_video":"video",d=r._fractionLost,p=r.rtt,_=r._sendBandWidth,h=r._retransmittedRate;0===_&&(d=Math.max(.65,d));var f=this._getQosLevel(p,d||0,h||0),m=this._preUplinkStats.get(l)||[f];this._preUplinkStats.set(l,[].concat(_toConsumableArray(m),[f]).slice(-2))}this._startNetworkQualityReport()}},{key:"updateDownlinkStats",value:function(e,t){if(t){var r,n,i=this._getStreamActiveState(t),o=i.audioActive,a=i.videoActive,s=e.audioStats,c=e.videoStats,u=e.isScreen,l=e.userId,d=!0,p=!0;if(o)if(0===s.receivedKBitrate)d=!1;else{var _=s.rtt,h=s.audioLossRate,f=s.stallDuration,m=s.statsInterval,g=s.e2eDelay,v=f/m,y=u?"screen_audio":"audio",S=this._getQosLevel(_,h||0,c._retransmittedRate||0),E=this._getDownlinkQoE(y,v,g);r=this._getNetworkQuality(S,E)}if(a)if(0===c.receivedKBitrate||0===c.rtt)p=!1;else{var T=c.rtt,b=c.videoLossRate,R=c.stallDuration,C=c.statsInterval,k=c.e2eDelay,I=c._retransmittedRate,A=R/C,O=u?"screen_video":"video",M=this._getQosLevel(T,b||0,I||0),P=this._getDownlinkQoE(O,A,k);n=this._getNetworkQuality(M,P)}var w="".concat(l).concat(u?"_screen":"");if(d||p){var D=r&&n?Math.ceil((r+n)/2):r||n;if(D){var N=this._preDownlinkStats.get(w)||[D];this._preDownlinkStats.set(w,[].concat(_toConsumableArray(N),[D]).slice(-2)),this._startNetworkQualityReport()}}else this._preDownlinkStats.delete(w)}}},{key:"setMSC",value:function(e){this._msc=e}},{key:"destroy",value:function(){this._timer&&(window.clearInterval(this._timer),delete this._timer),this._delayTimer&&(window.clearTimeout(this._delayTimer),delete this._delayTimer),this._preUplinkStats.clear(),this._preDownlinkStats.clear()}},{key:"_startNetworkQualityReport",value:function(){var e=this;this._delayTimer||this._timer||(this._preUplinkStats.size>0||this._preDownlinkStats.size>0)&&(this._delayTimer=window.setTimeout((function(){delete e._delayTimer,e._reportNetworkQuality(),e._timer=window.setInterval((function(){e._reportNetworkQuality()}),2e3)}),300))}},{key:"_reportNetworkQuality",value:function(){var e,t,r,n,i=this;if(["connected","connecting"].includes(null==(t=null==(e=this._msc)?void 0:e.handler)?void 0:t.getConnectionState())){var o=this._getBetterQualityAndRemoveOldest("audio","up"),a=this._getBetterQualityAndRemoveOldest("video","up");r=o&&a?Math.ceil((o+a)/2):o||a||this._getBetterQualityAndRemoveOldest("screen_video","up")||this._getBetterQualityAndRemoveOldest("screen_audio","up")||NetworkQuality$1.EXCELLENT;var s=Array.from(this._preDownlinkStats.keys()).map((function(e){return i._getBetterQualityAndRemoveOldest(e,"down")})).filter((function(e){return e}));n=Math.ceil(s.reduce((function(e,t){return t+e}),0)/s.length)||NetworkQuality$1.UNKNOWN}else r=n=NetworkQuality$1.DOWN;navigator.onLine||(r=NetworkQuality$1.DOWN,n=NetworkQuality$1.DOWN),"function"==typeof this.reportor&&this.reportor(r,n)}},{key:"_getNetworkQuality",value:function(e,t){return 1===t?Math.max(e-2,1):2===t?e:Math.min(e+1,5)}},{key:"_getQosLevel",value:function(e,t,r){var n;return n=(!e||e<=250)&&t<=.15?1:(!e||e<=500)&&t<=.3?2:(!e||e<=750)&&t<=.45?3:(!e||e<=1e3)&&t<=.6?4:5,r>.5?n=Math.max(n,4):r>.35?n=Math.max(n,3):r>.15&&(n=Math.max(n,2)),n}},{key:"_getUplinkQoE",value:function(e,t){var r=0;switch(e){case"audio":case"video":r=t<.05?1:t<.1?2:3;break;case"screen_video":case"screen_audio":r=t<.04?1:t<.08?2:3}return r}},{key:"_getDownlinkQoE",value:function(e,t,r){var n=CONFIG[e];return t>n.stallRadio||r>n.delay||t>n.stallRadio/2&&r>n.delay/2?3:(t>n.stallRadio/2||n.delay,2)}},{key:"_getBetterQualityAndRemoveOldest",value:function(e,t){var r=NetworkQuality$1.UNKNOWN,n="up"===t?this._preUplinkStats:this._preDownlinkStats,i=n.get(e);if(i){var o=i.filter((function(e){return e}));o.length>0&&(r=Math.min.apply(Math,_toConsumableArray(o))),i.shift(),0===i.length&&n.delete(e)}return r}},{key:"_getStreamActiveState",value:function(e){var t=e.subMediaType,r=e._attributes,n=e.subVideo;return{audioActive:e.subAudio&&audioInMediaType(t)&&r.localaudio&&r.audiostream,videoActive:n&&videoInMediaType(t)&&r.localvideo&&r.videostream}}}]),e}(),VideoSizeObserver=function(){function e(t){_classCallCheck(this,e),__publicField(this,"_timer"),__publicField(this,"_remoteVideoSizeCache",{}),__publicField(this,"_remoteScreenSizeCache",{}),__publicField(this,"onchange"),this._room=t,this._start()}return _createClass(e,[{key:"destroy",value:function(){this._timer&&(window.clearInterval(this._timer),delete this._timer),this._remoteVideoSizeCache={},this._remoteScreenSizeCache={}}},{key:"_start",value:function(){var e=this;this._timer||(this._timer=window.setInterval((function(){var t={},r={};e._room.remoteStreams.forEach((function(n,i){n.forEach((function(n){var o,a,s,c=null==(o=n.videoTrack)?void 0:o.preprocessingTrack;if(c){var u=n.isScreen?e._remoteScreenSizeCache:e._remoteVideoSizeCache,l=u[i]||{},d=l.width,p=void 0===d?0:d,_=l.height,h=void 0===_?0:_,f=0,m=0;if(isFirefox){var g=null==(s=null==(a=null==n?void 0:n.videoTrack)?void 0:a.videoPlayer)?void 0:s.domElement;g&&(f=g.videoWidth,m=g.videoHeight)}else{var v=c.getSettings();f=v.width||0,m=v.height||0}h===m&&p===f||"function"==typeof e.onchange&&e.onchange(i,n.isScreen,f,m),delete u[i],(n.isScreen?r:t)[i]={width:f,height:m}}}))})),Object.keys(e._remoteVideoSizeCache).forEach((function(t){"function"==typeof e.onchange&&e.onchange(t,!1,0,0)})),Object.keys(e._remoteScreenSizeCache).forEach((function(t){"function"==typeof e.onchange&&e.onchange(t,!0,0,0)})),e._remoteVideoSizeCache=t,e._remoteScreenSizeCache=r}),1e3))}}]),e}(),SUBTITLE_PREFIX=Array.from((new TextEncoder).encode("subt")),ERROR_CODE_MAP={1:ErrorCode.SUBTITLE_ERR_POSTPROCESS,2:ErrorCode.SUBTITLE_ERR_CONNECTION_ERROR,3:ErrorCode.SUBTITLE_ERR_PROCESS_ERROR},logger$3=new Logger$1$1("SubtitleTool",1),checkSourceLanguage=function(e){var t;if(e.extraInfo)try{var r=JSON.parse(e.extraInfo);r.source_language&&["zh","en","ja"].indexOf(r.source_language)}catch(i){}else{var n=(null==(t=navigator.language)?void 0:t.substring(0,2))||"";["zh","en","ja"].indexOf(n)>-1&&(e.extraInfo=JSON.stringify({source_language:n}))}},SubtitleTool=function(){function e(t){var r,n,i;_classCallCheck(this,e),__publicField(this,"_taskId"),__publicField(this,"_appId"),__publicField(this,"_roomId"),__publicField(this,"_userId"),__publicField(this,"onEvent"),__publicField(this,"onMessage"),__publicField(this,"_preConfig"),__publicField(this,"_timer"),this._room=t,this._appId=null==(r=this._room._roomInfo)?void 0:r.appId,this._roomId=null==(n=this._room._roomInfo)?void 0:n.roomId,this._userId=null==(i=this._room._roomInfo)?void 0:i.userInfo.userId}var t,r,n;return _createClass(e,[{key:"start",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(logger$3.info("start","Invoke config: %o",t),checkEnum(t.mode,"mode",[SUBTITLE_MODE.ASR_ONLY,SUBTITLE_MODE.ASR_AND_TRANSLATION]),t.mode!==SUBTITLE_MODE.ASR_AND_TRANSLATION||-1!==SUPPORT_LANG.indexOf(t.targetLanguage||"")){e.next=2;break}throw new SDKError(ErrorCode.INVALID_PARAMS,"Invalid targetLanguage.");case 2:if(!this._taskId){e.next=4;break}throw new SDKError(ErrorCode.SUBTITLE_ALREADY_ON,"Already turned on subtitle");case 4:return this._preConfig=t,this._taskId=(Date.now().toString()+this._roomId+this._userId).substring(0,20),e.next=8,this._room.subtitleControlMessage(this._genSubtitleSignaling("started",t,this._taskId));case 8:this._preConfig=t,this._timer=self.setTimeout((function(){var e;null==(e=r.onEvent)||e.call(r,{event:SubtitleEventType.ERROR,errorCode:ErrorCode.TIME_OUT,errorMessage:"start subtitle timeout."}),delete r._timer,r.stop()}),3e4);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"update",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(checkEnum(t.mode,"mode",[SUBTITLE_MODE.ASR_ONLY,SUBTITLE_MODE.ASR_AND_TRANSLATION]),t.mode!==SUBTITLE_MODE.ASR_AND_TRANSLATION||-1!==SUPPORT_LANG.indexOf(t.targetLanguage||"")){e.next=2;break}throw new SDKError(ErrorCode.INVALID_PARAMS,"Invalid targetLanguage.");case 2:if(!this._taskId){e.next=4;break}throw new SDKError(ErrorCode.SUBTITLE_ALREADY_ON,"Already started subtitle");case 4:if(this._taskId){e.next=6;break}throw new SDKError(ErrorCode.SUBTITLE_NOT_TURNED_ON,"Start subtitle first.");case 6:if(e.t0=(null==(r=this._preConfig)?void 0:r.mode)===t.mode&&this._preConfig.targetLanguage===t.targetLanguage,e.t0){e.next=11;break}return this._preConfig=t,e.next=11,this._room.subtitleControlMessage(this._genSubtitleSignaling("update",t,this._taskId));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"stop",value:function(){var e=this;logger$3.info("stop","Invoke"),this._taskId&&this._room.subtitleControlMessage({type:"subtitle",action:"stopped",appId:this._appId,roomId:this._roomId,userId:this._userId,taskId:this._taskId}).finally((function(){var t;delete e._taskId,null==(t=e.onEvent)||t.call(e,{event:SubtitleEventType.STOPPED}),e._clearTimer()}))}},{key:"reconnect",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this._taskId&&this._preConfig,!e.t0){e.next=6;break}return e.next=4,this._room.subtitleControlMessage({type:"subtitle",action:"stopped",appId:this._appId,roomId:this._roomId,userId:this._userId,taskId:this._taskId});case 4:delete this._taskId,this.start(this._preConfig);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return this._preConfig}},{key:"destroy",value:function(){logger$3.info("destroy","Invoke"),this.stop(),delete this._preConfig,delete this._taskId}},{key:"onResult",value:function(e){var t,r,n=e.body,i=n.error,o=n.errorMessage,a=n.eventType;if(0!==i){var s=new SDKError(ERROR_CODE_MAP[i]||ErrorCode.SUBTITLE_ERR_UNKNOWN,o||"");null==(t=this.onEvent)||t.call(this,{event:SubtitleEventType.ERROR,errorCode:s.code,errorMessage:s.message}),this._clearTimer()}else"SubtitleStarted"===a&&(null==(r=this.onEvent)||r.call(this,{event:SubtitleEventType.STARTED}),this._clearTimer())}},{key:"onMessageRecv",value:function(e){var t;if(this._taskId&&this._preConfig){var r=parseSubtitleMessage(e);if(r&&r.length>0){var n=this._preConfig,i=n.mode,o=n.targetLanguage,a=[];r.forEach((function(e){i===SUBTITLE_MODE.ASR_ONLY?e.mode===i&&a.push(e):i===SUBTITLE_MODE.ASR_AND_TRANSLATION&&(e.language!==o&&e.mode!==SUBTITLE_MODE.ASR_ONLY||a.push(e),e.mode===SUBTITLE_MODE.ASR_ONLY&&e.language===o&&a.push(_objectSpread2(_objectSpread2({},e),{},{mode:SUBTITLE_MODE.ASR_AND_TRANSLATION})))})),a.length>0&&(null==(t=this.onMessage)||t.call(this,a))}return!!r}return!1}},{key:"_genSubtitleSignaling",value:function(e,t,r){return{taskId:r,type:"subtitle",action:e,roomId:this._roomId,appId:this._appId,userId:this._userId,subtitleMeta:{subtitleConfig:{mode:t.mode,usersConfig:[{userId:this._userId,targetLanguages:[t.targetLanguage||""]}]},vendorConfig:{type:0}}}}},{key:"_clearTimer",value:function(){this._timer&&(self.clearTimeout(this._timer),delete this._timer)}}]),e}(),parseSubtitleMessage=function(e){var t=e.message;if(t instanceof ArrayBuffer&&t.byteLength>8)try{var r=new DataView(t,0),n=0;if(SUBTITLE_PREFIX.every((function(e){return r.getUint8(n++)===e}))){var i=r.getUint32(n);if(n+=4,i===r.byteLength-8){var o=Utils.ab2str(t.slice(8)),a=JSON.parse(o),s=a.data;if("subtitle"===a.type)return s}}}catch(c){}return!1},SUPPORT_LANG=["zh","zh-Hant","tn","vi","iu","it","id","hi","en","ho","he","es","el","uk","ur","tk","tr","ti","ty","tl","to","th","ta","te","sl","sk","ss","eo","sm","sg","st","sv","ja","tw","qu","pt","pa","no","nb","nr","my","bn","mn","mh","mk","ml","mr","ms","lu","ro","lt","lv","lo","kj","hr","kn","ki","cs","ca","nl","ko","ht","gu","ka","kl","km","lg","kg","fi","fj","fr","ru","ng","de","tt","da","ts","cv","fa","bs","pl","bi","nd","ba","bg","az","ar","af","sq","ab","os","ee","et","ay","lzh","am","ckb","cy","gl","ha","hy","ig","kmr","ln","nso","ny","om","sn","so","sr","sw","xh","yo","zu"],__defProp$3=Object.defineProperty,__getOwnPropDesc$3=Object.getOwnPropertyDescriptor,__decorateClass$3=function(e,t,r,n){for(var i,o=n>1?void 0:n?__getOwnPropDesc$3(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&__defProp$3(t,r,o),o},ForwardStreamManager=function(){function e(t){_classCallCheck(this,e),__publicField(this,"_forwardDstRooms",new Map),__publicField(this,"forwardStreamState","stopped"),__publicField(this,"_monitor"),this._room=t,this._monitor=getMonitor(this._room.id)}var t,r,n,i,o,a;return _createClass(e,[{key:"startForwardStream2Rooms",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("running"!==this.forwardStreamState&&"paused"!==this.forwardStreamState){e.next=2;break}throw new SDKError(ErrorCode.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke startForwardStreamToRooms in state: ".concat(this.forwardStreamState));case 2:return e.next=4,this._sendForwardStreamSignaling("start",this._room.roomInfo.roomId,t);case 4:return r=e.sent,this._updateDstRooms(t,r),n=this._transformForwardStreamResult(r),e.abrupt("return",(this.forwardStreamState="running",n));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"updateForwardStream2Rooms",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("stopped"!==this.forwardStreamState){e.next=2;break}throw new SDKError(ErrorCode.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke updateForwardStreamToRooms in state: ".concat(this.forwardStreamState));case 2:if(r=this._mockForwardStreamResult(t),e.t0="running"===this.forwardStreamState,!e.t0){e.next=8;break}return e.next=7,this._sendForwardStreamSignaling("update",this._room._roomInfo.roomId,t);case 7:r=e.sent;case 8:return this._updateDstRooms(t,r),e.abrupt("return",this._transformForwardStreamResult(r));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"stopForwardStream2Rooms",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("stopped"!==this.forwardStreamState){e.next=2;break}throw new SDKError(ErrorCode.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke stopForwardStreamToRooms in state: ".concat(this.forwardStreamState));case 2:if(t=this._mockForwardStreamResult([]),e.t0="running"===this.forwardStreamState,!e.t0){e.next=8;break}return e.next=7,this._sendForwardStreamSignaling("stop",this._room._roomInfo.roomId);case 7:t=e.sent;case 8:if(this._updateDstRooms([],t),!(_toConsumableArray(this._forwardDstRooms.keys()).length>0)){e.next=11;break}throw new SDKError(ErrorCode.UNEXPECTED_ERROR,"stopforwardstream failed: ".concat(JSON.stringify(t)));case 11:return r=this._transformForwardStreamResult(t),e.abrupt("return",(this.forwardStreamState="stopped",r));case 13:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"pauseForwardStream2AllRooms",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("paused"!==this.forwardStreamState&&"stopped"!==this.forwardStreamState){e.next=2;break}throw new SDKError(ErrorCode.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke pauseForwardStreamToAllRooms in state: ".concat(this.forwardStreamState));case 2:return e.next=4,this._sendForwardStreamSignaling("stop",this._room._roomInfo.roomId);case 4:return t=e.sent,r=this._transformForwardStreamResult(t),e.abrupt("return",(this.forwardStreamState="paused",r));case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"resumeForwardStream2AllRooms",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.length>0&&void 0!==i[0]&&i[0]||!["running","stopped"].includes(this.forwardStreamState)){e.next=3;break}throw new SDKError(ErrorCode.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke resumeForwardStreamToAllRooms in state: ".concat(this.forwardStreamState));case 3:return t=this._getDstRooms(),e.next=6,this._sendForwardStreamSignaling("start",this._room._roomInfo.roomId,t);case 6:return r=e.sent,this._updateDstRooms(t,r),n=this._transformForwardStreamResult(r),e.abrupt("return",(this.forwardStreamState="running",n));case 10:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"resumeFromReconnect",value:function(){var e=this;"running"===this.forwardStreamState&&this.resumeForwardStream2AllRooms(!0).then((function(t){t.forEach((function(t){t.state===ForwardStreamState.FORWARD_STREAM_STATE_FAILURE&&e._room.safeEmit(RoomEvent.ON_FORWARD_STREAM_ERROR,t)}))}))}},{key:"onForwardDstRoomUserKick",value:function(e){var t=[{dstRoomId:e.dstRoomId,code:200,forwardStreamType:"stop"}];this._updateDstRooms([],t),this._room.safeEmit(RoomEvent.ON_FORWARD_STREAM_ERROR,{roomId:e.dstRoomId,state:ForwardStreamState.FORWARD_STREAM_STATE_FAILURE,error:ForwardStreamError.FORWARD_STREAM_ERROR_REMOTE_KICKED})}},{key:"clear",value:function(){this._forwardDstRooms.clear(),this.forwardStreamState="stopped"}},{key:"_mockForwardStreamResult",value:function(e){var t=this,r=[];return this._forwardDstRooms.forEach((function(e,t){r.push({dstRoomId:t,forwardStreamType:"stop",code:200})})),e.forEach((function(e){var n,i=r.findIndex((function(t){return t.dstRoomId===e.roomId}));-1===i?r.push({dstRoomId:e.roomId,forwardStreamType:"start",code:e.roomId===(null==(n=t._room.roomInfo)?void 0:n.roomId)?400:200}):r[i].forwardStreamType="update"})),r}},{key:"_transformForwardStreamResult",value:function(e){e||(e=[]);var t,r=[],n=_createForOfIteratorHelper(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,o=i.dstRoomId,a=i.code,s={roomId:o,state:ForwardStreamState.FORWARD_STREAM_STATE_SUCCESS,error:ForwardStreamError.FORWARD_STREAM_ERROR_OK};200===a||(400===a?(s.state=ForwardStreamState.FORWARD_STREAM_STATE_FAILURE,s.error=ForwardStreamError.FORWARD_STREAM_ERROR_REMOTE_KICKED):a>=700&&a<800?(s.state=ForwardStreamState.FORWARD_STREAM_STATE_FAILURE,s.error=ForwardStreamError.FORWARD_STREAM_ERROR_INVALID_TOKEN):(s.state=ForwardStreamState.FORWARD_STREAM_STATE_FAILURE,s.error=ForwardStreamError.FORWARD_STREAM_ERROR_RESPONSE)),r.push(s)}}catch(err2){n.e(err2)}finally{n.f()}return r}},{key:"_updateDstRooms",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];0===(null==r?void 0:r.length)&&this._forwardDstRooms.clear(),r.forEach((function(r){var n=r.dstRoomId,i=r.code,o=r.forwardStreamType;if(200===i)if("stop"===o)t._forwardDstRooms.delete(n);else{var a,s=e.find((function(e){return e.roomId===n}));if(!s&&!t._forwardDstRooms.has(n))throw new SDKError(ErrorCode.UNEXPECTED_ERROR,"unknow roomid ".concat(n," in signaling return"));var c=null!==(a=t._forwardDstRooms.get(n))&&void 0!==a?a:{token:void 0};c=Object.assign(c,s),t._forwardDstRooms.set(n,c)}else t._forwardDstRooms.has(n)&&t._forwardDstRooms.delete(n)}))}},{key:"_getDstRooms",value:function(){var e=[];return this._forwardDstRooms.forEach((function(t,r){e.push({roomId:r,token:t.token})})),e}},{key:"_sendForwardStreamSignaling",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,o,a,s,c,u,l,d,p;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u="".concat(genEventSessionId()),"stop"!==t&&(l=n.map((function(e){return e.roomId})),null==(i=this._monitor)||i.report("rtc_forward_stream",{type:"begin",dst_rooms:"{ ".concat(l.map((function(e){return'"'.concat(e,'"')})).join(",")," }"),event_session_id:u})),e.next=4,this._room._mediaServerClient.sendForwardStreamSignal(t,r,n);case 4:if(d=e.sent,p=[],200===(null==d?void 0:d.code)){e.next=8;break}throw"stop"!==t&&(null==n||n.forEach((function(e){p.push({dst_room_id:e.roomId,result:"server error ".concat(null==d?void 0:d.code)})})),null==(o=this._monitor)||o.report("rtc_forward_stream",{type:"end",dst_rooms:JSON.stringify(p),event_session_id:u})),new SDKError(ErrorCode.UNEXPECTED_ERROR,"server side internal error, error code: ".concat(d));case 8:return e.abrupt("return",("stop"!==t&&(null==(a=d.forwardStreamResults)||a.forEach((function(e){p.push({dst_room_id:e.dstRoomId,result:"dst room lost"})})),null==(s=d.forwardStreamResults)||s.forEach((function(e){var t=p.find((function(t){return t.dst_room_id===e.dstRoomId}));t&&(200===e.code?"update"===e.forwardStreamType?t.result="update":t.result="success":t.result="server error ".concat(e.code))})),null==(c=this._monitor)||c.report("rtc_forward_stream",{type:"end",dst_rooms:JSON.stringify(p),event_session_id:u})),d.forwardStreamResults));case 9:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})}]),e}();function withRoomId(e,t,r){var n=r.value;return r.value=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var r,i,o,a,s=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=s.length,o=new Array(i),a=0;a<i;a++)o[a]=s[a];if(!(null==(r=this._room._roomInfo)?void 0:r.roomId)){e.next=5;break}return e.next=4,n.apply(this,o);case 4:return e.abrupt("return",e.sent);case 5:throw new SDKError(ErrorCode.NOT_CONNECTED_YET,"error in ".concat(t,": try again after joined"));case 6:case"end":return e.stop()}}),e,this)}))),r}__decorateClass$3([withRoomId],ForwardStreamManager.prototype,"startForwardStream2Rooms",1),__decorateClass$3([withRoomId],ForwardStreamManager.prototype,"updateForwardStream2Rooms",1),__decorateClass$3([withRoomId],ForwardStreamManager.prototype,"stopForwardStream2Rooms",1),__decorateClass$3([withRoomId],ForwardStreamManager.prototype,"pauseForwardStream2AllRooms",1),__decorateClass$3([withRoomId],ForwardStreamManager.prototype,"resumeForwardStream2AllRooms",1);var virtualStreamAttributes={audiostream:!0,extaudio:!1,extvideo:!1,localaudio:!0,localvideo:!1,videoDescriptions:[],videostream:!1,publishTime:0},Room=function(e){_inherits(M,e);var t,r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R,C,k,I,A,O=_createSuper(M);function M(e,t){var r;return _classCallCheck(this,M),r=O.call(this),__publicField(_assertThisInitialized(r),"id"),__publicField(_assertThisInitialized(r),"_mediaServerClient"),__publicField(_assertThisInitialized(r),"_localStream"),__publicField(_assertThisInitialized(r),"_localScreenStream"),__publicField(_assertThisInitialized(r),"_remoteUsers",new Map),__publicField(_assertThisInitialized(r),"_remoteStreams",new Map),__publicField(_assertThisInitialized(r),"_remoteStreamStreamIdUserIdMap",{}),__publicField(_assertThisInitialized(r),"_virtualStreams",[]),__publicField(_assertThisInitialized(r),"_context"),__publicField(_assertThisInitialized(r),"_sessionId"),__publicField(_assertThisInitialized(r),"_connectionLostTimer"),__publicField(_assertThisInitialized(r),"_serverConfig"),__publicField(_assertThisInitialized(r),"_roomConfig"),__publicField(_assertThisInitialized(r),"_roomInfo"),__publicField(_assertThisInitialized(r),"_userDuplicateLoginTimerMap",new Map),__publicField(_assertThisInitialized(r),"_networkQualityManager"),__publicField(_assertThisInitialized(r),"_videoSizeObserver"),__publicField(_assertThisInitialized(r),"_hasPublished",!1),__publicField(_assertThisInitialized(r),"_subtitleTool"),__publicField(_assertThisInitialized(r),"_csrcUserIdMap"),__publicField(_assertThisInitialized(r),"_publishOnDemandItem"),__publicField(_assertThisInitialized(r),"_onceTriggerBySignal",!1),__publicField(_assertThisInitialized(r),"_pubTransceiverReady",!1),__publicField(_assertThisInitialized(r),"_publishOnDemandBusy",!1),__publicField(_assertThisInitialized(r),"_monitor"),__publicField(_assertThisInitialized(r),"logger"),__publicField(_assertThisInitialized(r),"_forwardStreamManager"),r.id=t.id,r.logger=new Logger$1$1("Room",1,t.id),r.logger.info("constructor","invoke"),r._roomConfig=e,r._mediaServerClient=new MediaServerClient(t),r._networkQualityManager=new NetworkQualityManager,r._networkQualityManager.reportor=r._reportNetworkQuality.bind(_assertThisInitialized(r)),r._videoSizeObserver=new VideoSizeObserver(_assertThisInitialized(r)),r._videoSizeObserver.onchange=r._emitVideoSizeChange.bind(_assertThisInitialized(r)),r._context=t,r._csrcUserIdMap={},r._monitor=getMonitor(r.id),r._forwardStreamManager=new ForwardStreamManager(_assertThisInitialized(r)),r._addHandlerEventHandler(),r}return _createClass(M,[{key:"hasScreenPublished",get:function(){var e;return null==(e=this._localScreenStream)?void 0:e.hasPublished}},{key:"hasPublished",get:function(){var e;return null==(e=this._localStream)?void 0:e.hasPublished}},{key:"connectionState",get:function(){return this._mediaServerClient.connectionState}},{key:"remoteUsers",get:function(){return this._remoteUsers}},{key:"remoteStreams",get:function(){return this._remoteStreams}},{key:"localStream",get:function(){return this._localStream}},{key:"localScreenStream",get:function(){return this._localScreenStream}},{key:"roomInfo",get:function(){return this._roomInfo}},{key:"roomConfig",set:function(e){this._roomConfig=e}},{key:"_addHandlerEventHandler",value:function(){var e,t,r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R,C,k,I,A,O,M,P,w,D,N,x=this;null==(e=this._mediaServerClient)||e.on(SignalEvent.ON_ADD_STREAM,this._onAddStream.bind(this)),null==(t=this._mediaServerClient)||t.on(SignalEvent.ON_ADD_STREAM_LIST,(function(e){Array.isArray(null==e?void 0:e.streamList)&&e.streamList.forEach((function(e){return x._onAddStream(e)}))})),null==(r=this._mediaServerClient)||r.on(SignalEvent.ON_REMOVE_STREAM,this._onRemoveStream.bind(this)),null==(n=this._mediaServerClient)||n.on(SignalEvent.ON_REMOVE_STREAM_LIST,(function(e){Array.isArray(null==e?void 0:e.streamList)&&e.streamList.forEach((function(e){return x._onRemoveStream(e)}))})),null==(i=this._mediaServerClient)||i.on(SignalEvent.USER_CONNECTION,this._onUserConnection.bind(this)),null==(o=this._mediaServerClient)||o.on(SignalEvent.USER_CONNECTION_LIST,(function(e){Array.isArray(null==e?void 0:e.userList)&&e.userList.forEach((function(e){return x._onUserConnection(e)}))})),null==(a=this._mediaServerClient)||a.on(SignalEvent.USER_DISCONNECTION,this._onUserDisconnection.bind(this)),null==(s=this._mediaServerClient)||s.on(SignalEvent.USER_DISCONNECTION_LIST,(function(e){Array.isArray(null==e?void 0:e.userList)&&e.userList.forEach((function(e){return x._onUserDisconnection(e)}))})),null==(c=this._mediaServerClient)||c.on(SignalEvent.ON_UPDATE_ROOM_ATTRIBUTES,this._onUpdateRoomAttributes.bind(this)),null==(u=this._mediaServerClient)||u.on(SignalEvent.ON_UPDATE_USER_ATTRIBUTES,this._onUpdateUserAttributes.bind(this)),null==(l=this._mediaServerClient)||l.on(SignalEvent.ON_UPDATE_STREAM_ATTRIBUTES,this._onUpdateStreamAttributes.bind(this)),null==(d=this._mediaServerClient)||d.on(SignalEvent.ON_PUSH_TRACK,this._onPushTrack.bind(this)),null==(p=this._mediaServerClient)||p.on(SignalEvent.ON_REMOVE_TRACK,this._onRemoveTrack.bind(this)),null==(_=this._mediaServerClient)||_.on(SignalEvent.ON_CUSTOM_MESSAGE,this._onCustomMessage.bind(this)),null==(h=this._mediaServerClient)||h.on(SignalEvent.USER_MESSAGE_RECEIVED,this._onUserMessageReceived.bind(this)),null==(f=this._mediaServerClient)||f.on(SignalEvent.USER_BINARY_MESSAGE_RECEIVED,this._onUserBinaryMessageReceived.bind(this)),null==(m=this._mediaServerClient)||m.on(SignalEvent.POST_PROCESSING_MESSAGE,this._onPostProcessingMessage.bind(this)),null==(g=this._mediaServerClient)||g.on(SignalEvent.ON_USER_TOKEN_WILL_EXPIRE,this._onUserTokenWillExpire.bind(this)),null==(v=this._mediaServerClient)||v.on(SignalEvent.STREAM_CONTROL_MESSAGE,this._onStreamControlMessage.bind(this)),null==(y=this._mediaServerClient)||y.on(SignalEvent.ON_STREAM_FAILED,this._onStreamFailed.bind(this)),null==(S=this._mediaServerClient)||S.on(MediaServerSignalEvent.RSCP,(function(e,t){e.find((function(e){var t,r,n;return null==(n=null==e?void 0:e.StreamIds)?void 0:n.includes(null==(r=null==(t=x._localStream)?void 0:t.stream)?void 0:r.id)}))&&(t?x._pubTransceiverReady=!0:x._onceTriggerBySignal=!0,t&&x._onceTriggerBySignal||(x._publishOnDemandItem=e),x._pubTransceiverReady&&x._onPublishOnDemand())})),null==(E=this._mediaServerClient)||E.on(MediaServerSignalEvent.RTT,this._onRTT.bind(this)),null==(T=this._mediaServerClient)||T.on(MediaServerSignalEvent.SSC,this._onSSC.bind(this)),null==(b=this._mediaServerClient)||b.on(StateEvent.ON_CONNECTION_STATE_CHANGE,this._onConnectionStateChange.bind(this)),null==(R=this._mediaServerClient)||R.on(StateEvent.ON_VENDOR_CONNECTION_STATE_CHANGE,(function(e){return x.emit(StateEvent.ON_VENDOR_CONNECTION_STATE_CHANGE,e)})),null==(C=this._mediaServerClient)||C.on(SignalEvent.ON_SPEAKER_CHANGE,this._onMeetingSpeakerChange.bind(this)),null==(k=this._mediaServerClient)||k.on("onRemoteStreamStats",(function(e){x._networkQualityManager.updateDownlinkStats(e,x._findRemoteStreamByScreen(e.userId,e.isScreen)),x.emit(RoomEvent.ON_REMOTE_STREAM_STATS,getPublicStats(e))})),null==(I=this._mediaServerClient)||I.on(RoomEvent.RESUBSCRIBE,(function(e){x.emit(RoomEvent.RESUBSCRIBE,e)})),null==(A=this._mediaServerClient)||A.on(RoomEvent.RECONNECT_FAILED,(function(){x.emit(RoomEvent.RECONNECT_FAILED)})),null==(O=this._mediaServerClient)||O.on("joinSuccess",this._onJoinSucc.bind(this)),null==(M=this._mediaServerClient)||M.on(SignalEvent.ON_FORWARD_DST_ROOM_USER_KICK,this._forwardStreamManager.onForwardDstRoomUserKick.bind(this._forwardStreamManager)),null==(P=this._mediaServerClient)||P.on(RoomEvent.ON_REJOIN_WITH_TCP,(function(){x.emit(RoomEvent.ON_REJOIN_WITH_TCP)})),null==(w=this._mediaServerClient)||w.on(RoomEvent.ON_ICE_CONNECT_WITH_TCP,(function(){x.emit(RoomEvent.ON_ICE_CONNECT_WITH_TCP)})),null==(D=this._mediaServerClient)||D.on(RoomEvent.PUB_RETRY,(function(e){x.emit(RoomEvent.PUB_RETRY,e)})),null==(N=this._mediaServerClient)||N.on(RoomEvent.SUB_RETRY,(function(e){x.emit(RoomEvent.SUB_RETRY,e)}))}},{key:"_onLocalStreamStats",value:function(e){this._networkQualityManager.updateUplinkStats(e),this.emit(RoomEvent.ON_LOCAL_STREAM_STATS,getPublicStats(e))}},{key:"_removeHandlerEventHandler",value:function(){var e;null==(e=this._mediaServerClient)||e.removeAllListeners()}},{key:"connect",value:(A=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setSessionId(),e.next=3,this._mediaServerClient.connect();case 3:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"join",value:(I=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i,o){var a,s,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==(a=this._monitor)||a.set({rtc_app_id:t,room_id:r,user_id:i.userId}),this.logger.info("join()"),this._mediaServerClient.setLiveControlMessage(o),this._roomInfo={appId:t,roomId:r,token:n,userInfo:i,roomProfile:this._roomConfig.roomProfileType},this.setSessionId(),e.prev=1,e.next=4,this._mediaServerClient.join(this._roomInfo);case 4:return c=e.sent,e.abrupt("return",((null==(s=c.roomAttributes)?void 0:s.multiChatMode)&&this._handleFFAudioTrack(),this._initSubtitleTool(),{users:c.clients,streams:c.streams}));case 8:if(e.prev=8,e.t0=e.catch(1),e.t0.code===ErrorCode.OPERATION_CANCEL){e.next=12;break}throw e.t0;case 12:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e,t,r,n,i){return I.apply(this,arguments)})},{key:"publishScreen",value:(k=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i,o){var a,s,c,u,l,d,p,_,h,f,m,g;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("publishScreen()"),this._localScreenStream||(this._localScreenStream=new LocalStream(this._context),(null==(s=null==(a=this._mediaServerClient)?void 0:a.vendorConfig)?void 0:s.enableMultiVendor)&&(this._localScreenStream.pcSessionId=genUuid$1()),this._localScreenStream.isScreen=!0,this._mediaServerClient.handler&&(this._localScreenStream.observer=new SendFrameObserver(this._localScreenStream,this._mediaServerClient.handler))),h=!1,f=!1,m=!1,g=!1,!this._localScreenStream.videoTrack&&r?(r instanceof CustomVideoLocalTrack&&(f=!0),h=!0):this._localScreenStream.videoTrack&&!r&&(h=!1),!this._localScreenStream.audioTrack&&n?(n instanceof CustomAudioLocalTrack&&(g=!0),m=!0):this._localScreenStream.audioTrack&&!n&&(m=!1),this._localScreenStream.videoTrack=r,this._localScreenStream.audioTrack=n,this._localScreenStream.videoEncodeConfig=t,i&&(audioInMediaType(i)&&(this._localScreenStream.pubAudio=o===PubState.PUB),videoInMediaType(i)&&(this._localScreenStream.pubVideo=o===PubState.PUB),this.logger.info("publishScreen mediaType","pubAudio: %o, pubVideo: %o",this._localScreenStream.pubAudio,this._localScreenStream.pubVideo)),this._localScreenStream.pubAudio||this._localScreenStream.pubVideo){e.next=4;break}return e.abrupt("return",(null==(c=this._localScreenStream)?void 0:c.hasPublished)?this.unpublishScreen():void 0);case 4:if(!this._localScreenStream.hasPublished){e.next=11;break}return f?null==(l=this._localScreenStream.observer)||l.setPushVideo(h):null==(d=this._localScreenStream.observer)||d.setEnableVideo(h),g?null==(p=this._localScreenStream.observer)||p.setPushAudio(m):null==(_=this._localScreenStream.observer)||_.setEnableAudio(m),e.next=9,this.updatePubScreenTrack();case 9:e.next=14;break;case 11:return null==(u=this._localScreenStream.observer)||u.setPublish(!0),e.next=14,this._mediaServerClient.publish(this._localScreenStream);case 14:this._localScreenStream.pubAudio||this._localScreenStream.pubVideo?this._mediaServerClient.handler&&this._localScreenStream.startReport(this._onLocalStreamStats.bind(this),this._localScreenStream.vendorHandler||this._mediaServerClient.handler):this._localScreenStream.stopReport("unpublish screen");case 15:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n,i){return k.apply(this,arguments)})},{key:"updatePubScreenTrack",value:(C=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updatePubScreenTrack","Invoke updatePubScreenTrack"),e.t0=this._localScreenStream,!e.t0){e.next=5;break}return e.next=5,this._mediaServerClient.updatePubTrack(this._localScreenStream);case 5:case"end":return e.stop()}}),e,this)}))),function(){return C.apply(this,arguments)})},{key:"unpublishScreen",value:(R=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("unpublish","Invoke unpublishScreen"),e.t0=this._localScreenStream,!e.t0){e.next=9;break}return null==(t=this._localScreenStream.observer)||t.setPublish(!1),e.next=6,this._mediaServerClient.unpublish(this._localScreenStream);case 6:this._localScreenStream.stopReport("unpublish screen"),this._localScreenStream.clean(),this._localScreenStream=void 0;case 9:case"end":return e.stop()}}),e,this)}))),function(){return R.apply(this,arguments)})},{key:"liveControlMessage",value:(b=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("controlMessage","Invoke controlMessage"),null==(r=t.transcodeMeta)||r.layout.regions.forEach((function(e){n.roomInfo&&(e.roomID=n.roomInfo.roomId)})),e.next=4,this._mediaServerClient.controlMessage(t);case 4:this._mediaServerClient.setLiveControlMessage("stopped"===t.action?void 0:t);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"publicStreamControlMessage",value:(T=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"stopped"===t.action&&delete t.publicStreamMeta,e.next=3,this._mediaServerClient.controlMessage(t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"subtitleControlMessage",value:(E=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._mediaServerClient.controlMessage(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"updateUserAttributes",value:(S=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("updateUserAttributes","Invoke updateUserAttributes"),t.role&&this._roomInfo&&(this._roomInfo.userInfo.role=t.role),e.next=4,this._mediaServerClient.updateUserAttributes(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"publish",value:(y=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i,o,a){var s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R,C=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=C.length>6&&void 0!==C[6]&&C[6],this.logger.info("publish","Invoke publish"),g=!1,this._localStream||(this._localStream=new LocalStream(this._context),(null==(u=null==(c=this._mediaServerClient)?void 0:c.vendorConfig)?void 0:u.enableMultiVendor)&&(this._localStream.pcSessionId=genUuid$1()),this._mediaServerClient.handler&&(this._localStream.observer=new SendFrameObserver(this._localStream,this._mediaServerClient.handler)),g=!0,this._localStream.vendorCode=(null==(l=this._mediaServerClient.vendorConfig)?void 0:l.vendorCode)||0),this._localStream.videoTrack=n,this._localStream.audioTrack=i,this._localStream.videoEncodeConfig=t,this._localStream.enableSimulcast=r,v=this._localStream,y=v.pubAudio,S=v.pubVideo,o&&(audioInMediaType(o)&&(this._localStream.pubAudio=a===PubState.PUB),videoInMediaType(o)&&(this._localStream.pubVideo=a===PubState.PUB),this.logger.info("publish mediaType","pubAudio: %o, pubVideo: %o",this._localStream.pubAudio,this._localStream.pubVideo)),!this._localStream.hasPublished){e.next=17;break}return e.prev=6,this.emit("___onMediaServerClientPublish"),e.next=10,this.updatePubTrack();case 10:e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(6),this._localStream.pubAudio=y,this._localStream.pubVideo=S,e.t0;case 15:e.next=31;break;case 17:if(this._localStream.pubAudio||this._localStream.pubVideo){e.next=19;break}return e.abrupt("return");case 19:return e.prev=19,s?null==(d=this._localStream.observer)||d.setLogin(!0):g&&(E=!!this._localStream.videoTrack,T=!!this._localStream.audioTrack,b=this._localStream.videoTrack instanceof CustomVideoLocalTrack,R=this._localStream.audioTrack instanceof CustomAudioLocalTrack,this._roomConfig.isAutoPublish&&!this._hasPublished?(E&&(b?null==(p=this._localStream.observer)||p.setPushVideo(!0):null==(_=this._localStream.observer)||_.setEnableVideo(!0)),T&&(R?null==(h=this._localStream.observer)||h.setPushAudio(!0):null==(f=this._localStream.observer)||f.setEnableAudio(!0))):null==(m=this._localStream.observer)||m.setPublish(!0)),this.emit("___onMediaServerClientPublish"),e.next=24,this._mediaServerClient.publish(this._localStream);case 24:this._hasPublished=!0,this.emit(RoomEvent.ON_PUBLISH_RESULT,{isScreen:!1,state:PublishState.PUBLISH_SUCC}),e.next=31;break;case 28:throw e.prev=28,e.t1=e.catch(19),this.emit(RoomEvent.ON_PUBLISH_RESULT,{isScreen:!1,state:PublishState.PUBLISH_FAIL}),delete this._localStream,e.t1;case 31:this._localStream.pubAudio||this._localStream.pubVideo?this._mediaServerClient.handler&&this._localStream.startReport(this._onLocalStreamStats.bind(this),this._localStream.vendorHandler||this._mediaServerClient.handler):this._localStream.stopReport("unpublish");case 32:case"end":return e.stop()}}),e,this,[[6,12],[19,28]])}))),function(e,t,r,n,i,o){return y.apply(this,arguments)})},{key:"updatePubTrack",value:(v=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updatePubTrack","Invoke updatePubTrack"),e.t0=this._localStream,!e.t0){e.next=5;break}return e.next=5,this._mediaServerClient.updatePubTrack(this._localStream);case 5:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"unpublish",value:(g=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("unpublish","Invoke unpublish"),e.t0=this._localStream,!e.t0){e.next=8;break}return e.next=5,this._mediaServerClient.unpublish(this._localStream);case 5:this._localStream.stopReport("unpublish"),this._localStream.clean(),this._localStream=void 0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"subscribe",value:(m=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,o,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("subscribe","remoteStream %o",t),!t.hasSubscribed){e.next=10;break}if((o=t.subMediaType|r)===t.subMediaType){e.next=8;break}return e.next=5,null==(i=this._mediaServerClient)?void 0:i.updateSubMediaType(t,o);case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=void 0;case 9:return e.abrupt("return",e.t0);case 10:return n&&(a=this._getSubLayer(n,t)),e.next=13,this._mediaServerClient.subscribe(t,r,a);case 13:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return m.apply(this,arguments)})},{key:"updateSubVideoConfig",value:(f=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=this._findRemoteStreamByScreen(t,!1))&&a.hasSubscribed&&!((null==(i=null==(n=null==a?void 0:a.attributes)?void 0:n.videoDescriptions)?void 0:i.length)<=1)){e.next=3;break}return e.abrupt("return");case 3:return s=this._getSubLayer(r,a),e.abrupt("return",(a.originalStreamIndex=s.spatialLayer,null==(o=this._mediaServerClient)?void 0:o.updateSubTrackLayer(a,s)));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"_getSubLayer",value:function(e,t){for(var r,n,i,o,a,s=null==t?void 0:t.attributes,c=s.videoDescriptions,u=s.subVideoDescriptions,l=Array.isArray(u)?u:c,d=-1,p=e.width*e.height,_=0;_<(null==l?void 0:l.length);_++)if(p>=(null==(i=l[_])?void 0:i.width)*(null==(o=l[_])?void 0:o.height)){d=_;break}var h=l[0];if(-1===d)h=l[d=l.length-1];else if(0!==d){var f=l[d-1].width*l[d-1].height,m=(f-p)/(f-l[d].width*l[d].height);h=m<.1?l[d-1]:l[d],d=m<.1?d-1:d}return a=null!==(r=null==h?void 0:h.sub_index)&&void 0!==r?r:-1,{spatialLayer:null!==(n=null==h?void 0:h.video_index)&&void 0!==n?n:d,spatialSubLayer:a}}},{key:"unsubscribe",value:(h=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("unsubscribe","Invoke unsubscribe"),t.hasSubscribed){e.next=2;break}return e.abrupt("return");case 2:if(o=t.subMediaType-(t.subMediaType&r),(null==(n=this._context.serverConfig)?void 0:n.muteReplaceUnsub)||!(o===ExtendMediaType.NONE||this.multiChatMode&&o===MediaType.AUDIO)){e.next=7;break}return e.next=6,this._mediaServerClient.unsubscribe(t);case 6:return e.abrupt("return",e.sent);case 7:return e.next=9,null==(i=this._mediaServerClient)?void 0:i.updateSubMediaType(t,o);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"startSubtitle",value:(_=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._subtitleTool){e.next=2;break}throw new SDKError(ErrorCode.INVOKED_BEFORE_JOIN_ROOM,"join first");case 2:return e.next=4,this._subtitleTool.start(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)})},{key:"stopSubtitle",value:(p=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==(t=this._subtitleTool)||t.stop();case 1:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"startForwardStream2Rooms",value:(d=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.startForwardStream2Rooms(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"updateForwardStream2Rooms",value:(l=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.updateForwardStream2Rooms(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"stopForwardStream2Rooms",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.stopForwardStream2Rooms());case 1:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"pauseForwardStream2AllRooms",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.pauseForwardStream2AllRooms());case 1:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"resumeForwardStream2AllRooms",value:(s=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.resumeForwardStream2AllRooms());case 1:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"leave",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o,a,s,c,u,l,d=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=d.length>0&&void 0!==d[0]&&d[0],this.logger.info("leave","Invoke leave"),s=getServerNow(),null==(r=this._subtitleTool)||r.destroy(),delete this._subtitleTool,delete this._sessionId,e.prev=4,c=_createForOfIteratorHelper(this._remoteStreams.values());try{for(c.s();!(u=c.n()).done;)l=u.value,Array.isArray(l)&&l.forEach((function(e){var t;null==(t=e.observer)||t.setLogin(!1)}))}catch(err2){c.e(err2)}finally{c.f()}return this._localStream&&(null==(n=this._localStream.observer)||n.setLogin(!1)),e.next=10,this._mediaServerClient.leave().catch((function(){}));case 10:this.destroy(),null==(i=this._monitor)||i.report("rtc_leave_room",{error_code:0,message:"",elapse:getServerNow()-s}),null==(o=this._monitor)||o.set({room_id:"",user_id:"",rtc_session_id:"",rtc_vid:""}),e.next=20;break;case 15:if(e.prev=15,e.t0=e.catch(4),!t){e.next=19;break}throw e.t0;case 19:this.destroy(),e.t0 instanceof Error&&(null==(a=this._monitor)||a.report("rtc_leave_room",{error_code:-1,message:e.t0.message,elapse:getServerNow()-s}));case 20:case"end":return e.stop()}}),e,this,[[4,15]])}))),function(){return a.apply(this,arguments)})},{key:"updateRemoteUserPriority",value:function(e){var t,r=this;null==(t=this.remoteStreams.get(e))||t.forEach((function(t){var n=(r._context||{}).userPriority;t.hasSubscribed&&n.has(e)&&r._mediaServerClient.updateSubPriority(t,n.get(e))}))}},{key:"destroy",value:function(){var e,t,r;this.logger.info("destroy","Invoke destroy"),reportRtcInvokeStatus(this.id,"room_destroy","".concat((new Error).stack)),null==(e=this._subtitleTool)||e.destroy(),delete this._subtitleTool,this._mediaServerClient.destroy(),this._removeHandlerEventHandler(),this._roomInfo=void 0,this._remoteUsers=new Map;var n,i=_createForOfIteratorHelper(this._remoteStreams);try{for(i.s();!(n=i.n()).done;){var o=_slicedToArray(n.value,2)[1];Array.isArray(o)&&o.forEach((function(e){e&&e.destroy()}))}}catch(err2){i.e(err2)}finally{i.f()}this._virtualStreams.forEach((function(e){null==e||e.clean()})),this._remoteStreams=new Map,this._localStream&&(null==(t=this._localStream)||t.clean(),this._localStream=void 0),this._localScreenStream&&(null==(r=this._localScreenStream)||r.clean(),this._localScreenStream=void 0),this._removeHandlerEventHandler(),clearTimeout(this._connectionLostTimer),this._userDuplicateLoginTimerMap.forEach((function(e){clearTimeout(e)})),this._userDuplicateLoginTimerMap.clear(),this._networkQualityManager.destroy(),this._videoSizeObserver.destroy(),this._csrcUserIdMap={},this._virtualStreams=[],this._remoteStreamStreamIdUserIdMap={},this._forwardStreamManager.clear()}},{key:"updateToken",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("updateToken","Invoke updateToken"),this._roomInfo&&(this._roomInfo.token=t),e.prev=1,e.next=4,this._mediaServerClient.updateToken(t);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),this.safeEmit(RoomEvent.ON_ROOM_ERROR,{errorCode:ErrorCode.UPDATE_TOKEN_WITH_INVALID_TOKEN}),e.t0;case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return o.apply(this,arguments)})},{key:"sendUserMessage",value:function(e,t){var r;return null==(r=this._mediaServerClient)?void 0:r.sendUserMessage(e,t)}},{key:"setSessionId",value:function(){var e;this._sessionId||(this._sessionId=v4(),this._mediaServerClient._sessionId=this._sessionId,null==(e=this._monitor)||e.set({rtc_session_id:this._sessionId}))}},{key:"sendRoomMessage",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=s.length>1&&void 0!==s[1]&&s[1],a={clientId:null==(n=this._roomInfo)?void 0:n.userInfo.userId,binary:r,message:"",roomId:null==(i=this._roomInfo)?void 0:i.roomId},!r){e.next=8;break}return e.next=5,Utils.ab2b64str(t);case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=t;case 9:return a.message=e.t0,e.abrupt("return",null==(o=this._mediaServerClient)?void 0:o.sendRoomMessage(a));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_onJoinSucc",value:function(e){var t,r=this,n=e.joinRes,i=e.reconnect;this.logger.info("_onJoinSucc()","invoke. "+(i?"[reconnect]":"")),this._serverConfig=n.config,this._mediaServerClient.roomAttributes=n.roomAttributes;var o=[],a=[],s=[],c=[],u=[];null==(t=n.clientsDetail)||t.forEach((function(e){if(e.attributes&&(e.attributes.serverMuteVideo&&r.safeEmit(RoomEvent.ON_VIDEO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteVideo}),e.attributes.serverMuteAudio&&r.safeEmit(RoomEvent.ON_AUDIO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteAudio})),e.clientId!==n.clientId){var t=r._remoteUsers.get(e.clientId);t?t._stillExist=!0:o.push(e)}}));var l,d=_createForOfIteratorHelper(this._remoteUsers.values());try{for(d.s();!(l=d.n()).done;){var p=l.value;p._stillExist||a.push({clientId:p.userId}),delete p._stillExist}}catch(err2){d.e(err2)}finally{d.f()}n.streams.forEach((function(e){var t=r._findRemoteStreamByScreen(e.clientId,e.screen);t?(t.stillExist=!0,t.streamId=e.streamId,u.push(e)):c.push(e)}));var _,h=_createForOfIteratorHelper(this._remoteStreams.values());try{for(h.s();!(_=h.n()).done;){var f=_.value;Array.isArray(f)&&f.forEach((function(e){e.stillExist?delete e.stillExist:s.push({clientId:e.userId,streamId:e.streamId,message:RemoveStreamMessage.clientDisconnected})}))}}catch(err2){h.e(err2)}finally{h.f()}a.forEach((function(e){return r._onUserDisconnection(e)})),o.forEach((function(e){return r._onUserConnection(e)})),s.forEach((function(e){return r._onRemoveStream(e)})),c.forEach((function(e){return r._onAddStream(e,{fromSignal:!1})})),u.forEach((function(e){return r._onUpdateStreamAttributes(e)})),i&&this._handleSendOrRecvStreamAfterReconnect()}},{key:"_handleSendOrRecvStreamAfterReconnect",value:function(){var e,t,r,n,i=this;this._localStream&&(this._localStream.clean(),this._localStream.vendorCode=(null==(e=this._mediaServerClient.vendorConfig)?void 0:e.vendorCode)||0,null==(t=this._localStream.observer)||t.setLogin(!0),this._mediaServerClient.publish(this._localStream).then((function(){var e;i._mediaServerClient.handler&&(null==(e=i._localStream)||e.startReport(i._onLocalStreamStats.bind(i),i._localStream.vendorHandler||i._mediaServerClient.handler)),i.emit(RoomEvent.ON_PUBLISH_RESULT,{isScreen:!1,state:PublishState.PUBLISH_SUCC,retry:!0})})).catch((function(e){i.logger.error("failed repub error:".concat(e)),i.emit(RoomEvent.ON_PUBLISH_RESULT,{isScreen:!1,state:PublishState.PUBLISH_FAIL,errorCode:e.code,retry:!0})}))),this._localScreenStream&&(this._localScreenStream.clean(),null==(r=this._localScreenStream.observer)||r.setLogin(!0),this._mediaServerClient.publish(this._localScreenStream).then((function(){var e;i._mediaServerClient.handler&&(null==(e=i._localScreenStream)||e.startReport(i._onLocalStreamStats.bind(i),i._localScreenStream.vendorHandler||i._mediaServerClient.handler)),i.emit(RoomEvent.ON_PUBLISH_RESULT,{isScreen:!0,state:PublishState.PUBLISH_SUCC,retry:!0})})).catch((function(e){i.logger.error("failed repub screen stream error:".concat(e)),i.emit(RoomEvent.ON_PUBLISH_RESULT,{isScreen:!0,state:PublishState.PUBLISH_FAIL,errorCode:e.code,retry:!0})})));var o,a=_createForOfIteratorHelper(this._remoteStreams.values());try{for(a.s();!(o=a.n()).done;){var s=o.value;Array.isArray(s)&&s.forEach(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.hasSubscribed){e.next=16;break}return t.resetHasSubscribed(),e.prev=2,i.logger.info("start resubscribe ".concat(t.userId," with ").concat(t.subMediaType)),e.next=6,i._mediaServerClient.subscribe(t,t.subMediaType);case 6:i.logger.info("success resubscribe ".concat(t.userId," with ").concat(t.subMediaType)),i.safeEmit(RoomEvent.RESUBSCRIBE,{stream:t}),i.emit(RoomEvent.ON_SUBSCRIBE_RESULT,{userId:t.userId,isScreen:t.isScreen,retry:!0}),e.next=16;break;case 11:if(e.prev=11,e.t0=e.catch(2),i.emit(RoomEvent.ON_SUBSCRIBE_RESULT,{userId:t.userId,isScreen:t.isScreen,errorCode:e.t0.code,retry:!0}),i.logger.error("failed resubscribe ".concat(t.userId," with ").concat(t.subMediaType,", error:").concat(e.t0)),e.t0.code!==ErrorCode.NOT_CONNECTED_YET){e.next=15;break}return e.abrupt("return",void(t.streamState=StreamState.SUB_ED));case 15:t.clean(),null==t||t.resetHasSubscribed();case 16:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t){return e.apply(this,arguments)}}())}}catch(err2){a.e(err2)}finally{a.f()}null==(n=this._subtitleTool)||n.reconnect(),this._forwardStreamManager.resumeFromReconnect()}},{key:"_handleFFAudioTrack",value:function(){var e,t,r,n,i=null==(t=null==(e=this._mediaServerClient)?void 0:e.handler)?void 0:t.audioTrack4ff,o=null==(n=null==(r=this._mediaServerClient)?void 0:r.handler)?void 0:n.getTransceivers();if(i&&Array.isArray(o)){var a=o.find((function(e){var t;return(null==(t=null==e?void 0:e.receiver)?void 0:t.track)===i}));if(a){var s=new RemoteStream(this._context,"ff-stream","ff-stream",!1,!1,virtualStreamAttributes);s.virtual=!0,s.audioTransceiver=a,s.audioMid="0",s.audioTrack=createRemoteAudioTrack(i),this._virtualStreams.push(s),this.safeEmit(RoomEvent.SUBSCRIBE_PUSH_TRACK,{stream:s})}}}},{key:"_findRemoteStream",value:function(e,t){var r=this._remoteStreams.get(e);return Array.isArray(r)?r.find((function(e){return e.streamId===t})):null}},{key:"_findRemoteStreamByScreen",value:function(e,t){var r=this._remoteStreams.get(e);return Array.isArray(r)?r.find((function(e){return e.isScreen===t})):null}},{key:"_onAddStream",value:function(e){var t,r,n,i,o,a,s,c,u,l,d,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_=p.needEmit,h=void 0===_||_,f=p.fromSignal,m=void 0===f||f,g=p.virtual,v=void 0!==g&&g;if(e.clientId!==(null==(t=this._roomInfo)?void 0:t.userInfo.userId)){var y=this._roomConfig,S=y.isAutoSubscribeAudio,E=y.isAutoSubscribeVideo,T=this._findRemoteStreamByScreen(e.clientId,e.screen);if(T&&T.streamId!==e.streamId){var b=null==(r=this._remoteStreams.get(e.clientId))?void 0:r.filter((function(e){return e.streamId!==T.streamId}));T.clean(),this._remoteStreams.set(e.clientId,b||[])}var R=this._findRemoteStream(e.clientId,e.streamId);if(this._remoteStreamStreamIdUserIdMap[e.streamId]=e.clientId,R)R.attributes=e.attributes;else if((R=new RemoteStream(this._context,e.clientId,e.streamId,e.screen,!1,e.attributes)).virtual=v,this._initStreamListeners(R),!v){var C=this._remoteStreams.get(e.clientId);C?C.push(R):this._remoteStreams.set(e.clientId,[R])}if(this._mediaServerClient.handler&&(R.observer=new RecvFrameObserver(R,this._mediaServerClient.handler)),!R.isScreen&&E&&(m&&R.hasVideo&&(R.attributes.extvideo?(null==(n=R.observer)||n.setExternalVideoSource(!0),null==(i=R.observer)||i.setPushVideo(!0)):(null==(o=R.observer)||o.setExternalVideoSource(!1),null==(a=R.observer)||a.setPublishVideo(!0))),m&&R.hasAudio&&S&&!this._mediaServerClient.roomAttributes.multiChatMode&&(R.attributes.extaudio?(null==(s=R.observer)||s.setExternalAudioSource(!0),null==(c=R.observer)||c.setPushAudio(!0)):(null==(u=R.observer)||u.setExternalAudioSource(!1),null==(l=R.observer)||l.setPublishAudio(!0))),h&&!m)){var k=this._roomConfig,I=k.isAutoSubscribeAudio,A=k.isAutoSubscribeVideo;null==(d=R.observer)||d.setLogin(!0,{audio:!!I&&!this.multiChatMode,video:!!A})}return h&&this.safeEmit(SignalEvent.ON_ADD_STREAM,{stream:R}),R}}},{key:"_onUserConnection",value:function(e){var t;if(e.clientId!==(null==(t=this._roomInfo)?void 0:t.userInfo.userId)){var r=this._userDuplicateLoginTimerMap.get(e.clientId);if("number"==typeof r)return this._userDuplicateLoginTimerMap.delete(e.clientId),void self.clearTimeout(r);var n={userId:e.clientId,extraInfo:e.attributes.extra_info};this._remoteUsers.set(e.clientId,_objectSpread2({},n)),this.safeEmit(SignalEvent.USER_CONNECTION,{userInfo:n}),e.attributes&&(e.attributes.serverMuteVideo&&this.safeEmit(RoomEvent.ON_VIDEO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteVideo}),e.attributes.serverMuteAudio&&this.safeEmit(RoomEvent.ON_AUDIO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteAudio}))}}},{key:"_onUserDisconnection",value:function(e){var t,r=this,n=e.clientId,i=e.tag,o=e.code,a=e.forbiddenTime;if(n)if(n===(null==(t=this.roomInfo)?void 0:t.userInfo.userId)){var s=null;i===UserDisconnectionTag.kickedByAdmin?s=ErrorCode.KICKED_OUT:i===UserDisconnectionTag.onUserTokenDidExpire?s=ErrorCode.TOKEN_EXPIRED:i===UserDisconnectionTag.userDuplicateLogin&&(s=ErrorCode.DUPLICATE_LOGIN),o===UserDisconnectionCode.roomDismissByAdmin&&(s=ErrorCode.ROOM_DISMISS),s&&this.safeEmit(RoomEvent.ON_ROOM_ERROR,{errorCode:s,forbiddenTime:a})}else{var c=UserOfflineReason.DROPPED;i===UserDisconnectionTag.userLeave?c=UserOfflineReason.QUIT:i===UserDisconnectionTag.kickedByAdmin?c=UserOfflineReason.KICKED_BY_ADMIN:i===UserDisconnectionTag.roleChanged&&(c=UserOfflineReason.SWITCH_TO_INVISIBLE);var u=function(){var e;r._remoteUsers.delete(n),null==(e=r._remoteStreams.get(n))||e.forEach((function(e){r._onRemoveStream({clientId:e.userId,streamId:e.streamId,message:RemoveStreamMessage.clientDisconnected})})),r._remoteStreams.delete(n),r.safeEmit(RoomEvent.ON_USER_LEAVE,{userInfo:{userId:n},reason:c})};if(i===UserDisconnectionTag.userDuplicateLogin){var l=this._userDuplicateLoginTimerMap.get(n);l&&self.clearTimeout(l);var d=self.setTimeout(u,5e3);this._userDuplicateLoginTimerMap.set(n,d)}else u()}}},{key:"_onRemoveStream",value:function(e){var t,r,n,i,o=this;if(e.clientId!==(null==(t=this._roomInfo)?void 0:t.userInfo.userId)){var a=this._remoteStreams.get(e.clientId);if(a){var s=a.find((function(t){return t.streamId===e.streamId}));s&&(null==(r=this._mediaServerClient)||r.handleRemoveStream(s).then((function(){var t=o._remoteStreams.get(e.clientId);t&&(t=t.filter((function(t){return t.streamId!==e.streamId||(t.clean(),!1)})),o._remoteStreams.set(e.clientId,t))})).finally((function(){o.safeEmit(SignalEvent.ON_REMOVE_STREAM,{stream:s,reason:e.message,callback:function(){return s.destroy()}})})),s.hasVideo&&(null==(n=s.observer)||n.setPublishVideo(!1)),s.hasAudio&&!this._mediaServerClient.roomAttributes.multiChatMode&&(null==(i=s.observer)||i.setPublishAudio(!1)))}}}},{key:"_onUpdateUserAttributes",value:function(e){e.attributes&&(e.attributes.serverMuteVideo&&this.safeEmit(RoomEvent.ON_VIDEO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteVideo}),e.attributes.serverMuteAudio&&this.safeEmit(RoomEvent.ON_AUDIO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteAudio}))}},{key:"_onUpdateRoomAttributes",value:function(e){var t;e.roomAttributes&&(this._mediaServerClient.roomAttributes=_objectSpread2(_objectSpread2({},this._mediaServerClient.roomAttributes),e.roomAttributes)),(null==(t=e.roomAttributes)?void 0:t.multiChatMode)&&this._handleFFAudioTrack()}},{key:"_onUpdateStreamAttributes",value:function(e){var t,r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y=this._roomConfig,S=y.isAutoSubscribeAudio,E=y.isAutoSubscribeVideo,T=e.clientId,b=e.streamId,R=e.attributes,C=this._findRemoteStream(T,b);if(C){var k=C.attributes,I=_objectSpread2(_objectSpread2({},k),R),A=!1,O=I.localaudio!==k.localaudio,M=!1,P=!1,w=I.localvideo!==k.localvideo,D=!1,N=ExtendMediaType.NONE,x=ExtendMediaType.NONE;I.audiostream!==k.audiostream&&(A=I.localaudio,M=!!I.audiostream,I.audiostream?N|=MediaType.AUDIO:x|=MediaType.AUDIO),I.videostream!==k.videostream&&(P=I.localvideo,D=!!I.videostream,I.videostream?N|=MediaType.VIDEO:x|=MediaType.VIDEO),N&&this.safeEmit(RoomEvent.ON_USER_PUBLISH_STATE_CHANGE,{userId:T,mediaType:N,isScreen:C.isScreen,pubState:PubState.PUB,remoteStream:C}),x&&this.safeEmit(RoomEvent.ON_USER_PUBLISH_STATE_CHANGE,{userId:T,mediaType:x,isScreen:C.isScreen,pubState:PubState.UNPUB,remoteStream:C}),C.attributes=I,I.localaudio!==k.localaudio&&(I.localaudio?(S&&I.audiostream&&(I.extaudio?(null==(t=C.observer)||t.setExternalAudioSource(!0),null==(r=C.observer)||r.setPushAudio(!0)):(null==(n=C.observer)||n.setExternalAudioSource(!1),null==(i=C.observer)||i.setEnableAudio(!0))),this.safeEmit(RoomEvent.ON_USER_START_AUDIO_CAPTURE,{userId:T},C)):(I.extaudio?(null==(o=C.observer)||o.setExternalAudioSource(!0),null==(a=C.observer)||a.setPushAudio(!1)):(null==(s=C.observer)||s.setExternalAudioSource(!1),null==(c=C.observer)||c.setEnableAudio(!1)),!C.isScreen&&this.safeEmit(RoomEvent.ON_USER_STOP_AUDIO_CAPTURE,{userId:T}))),I.localvideo!==k.localvideo&&(I.localvideo?(E&&I.videostream&&(I.extvideo?(null==(u=C.observer)||u.setExternalVideoSource(!0),null==(l=C.observer)||l.setPushVideo(!0)):(null==(d=C.observer)||d.setExternalVideoSource(!1),null==(p=C.observer)||p.setEnableVideo(!0))),this.safeEmit(RoomEvent.ON_USER_START_VIDEO_CAPTURE,{userId:T})):(I.extvideo?(null==(_=C.observer)||_.setExternalVideoSource(!0),null==(h=C.observer)||h.setPushVideo(!1)):(null==(f=C.observer)||f.setExternalVideoSource(!1),null==(m=C.observer)||m.setEnableVideo(!1)),!C.isScreen&&this.safeEmit(RoomEvent.ON_USER_STOP_VIDEO_CAPTURE,{userId:T}))),A&&!O&&(null==(g=C.observer)||g.setRemoteUnmuteAudio(M)),P&&!w&&(null==(v=C.observer)||v.setRemoteUnmuteVideo(D))}}},{key:"_onPushTrack",value:function(e){var t,r,n=this;if(null==(t=e.streamId)?void 0:t.startsWith("audio_mux")){var i=this._onAddStream(_objectSpread2(_objectSpread2({},e),{},{attributes:virtualStreamAttributes}),{needEmit:!1,fromSignal:!1,virtual:!0});i&&this._mediaServerClient.subscribe4pushTrack(i,e).then((function(){n.safeEmit(RoomEvent.SUBSCRIBE_PUSH_TRACK,{stream:i}),n._virtualStreams.push(i)})).catch((function(e){n.logger.error("subscribe","push track failed %o",e)}))}else null==(r=this._monitor)||r.report("rtc_error",{message:"onPushTrack, userId: ".concat(e.clientId,", ").concat(e.streamId),error_code:RtcErrorCode.TRACK_ERROR})}},{key:"_onRemoveTrack",value:function(e){var t,r=e.clientId,n=e.streamId,i=e.message,o=e.trackType;this.logger.info("_onRemoveTrack","remove track: %o",r);var a=this._findRemoteStream(r,n);a&&(a.removeTrack=!0,null==(t=this._mediaServerClient)||t.unsubscribe4removeTrack(a,i,o),this.emit(RoomEvent.REMOVE_PUSH_TRACK,{stream:a,mediaType:o+1}))}},{key:"_onMeetingSpeakerChange",value:function(e){if(Array.isArray(null==e?void 0:e.speakerCsrcInfo)){var t={};null==e||e.speakerCsrcInfo.forEach((function(e){var r=e.csrc,n=e.userId;e.isScreen||(t[r]=n)})),this._csrcUserIdMap=t}Array.isArray(e.muxStreamInUse)&&this._virtualStreams.forEach((function(t){var r;(null==(r=e.muxStreamInUse)?void 0:r.includes(t.streamId))?t.virtualOccupy=!0:t.virtualOccupy=!1}))}},{key:"getActiveSpeakerInMultiChatMode",value:function(){var e=this,t=[];return this._virtualStreams.forEach((function(r){var n,i=null==(n=r.audioTransceiver)?void 0:n.receiver;if(i){var o=_slicedToArray(i.getContributingSources()||[],1)[0];if(o){var a=o.audioLevel,s=o.source;e._csrcUserIdMap[s]&&t.push({userId:e._csrcUserIdMap[s],audioLevel:a})}}})),t.length&&t.sort((function(e,t){return e.audioLevel-t.audioLevel})),t}},{key:"_onReconnecting",value:function(){var e,t,r=this;if(this._roomInfo){var n,i=_createForOfIteratorHelper(this._remoteStreams.values());try{for(i.s();!(n=i.n()).done;){var o=n.value;Array.isArray(o)&&o.forEach((function(e){return e.clean()}))}}catch(err2){i.e(err2)}finally{i.f()}this._virtualStreams.forEach((function(e){r.emit(RoomEvent.REMOVE_PUSH_TRACK,{stream:e,mediaType:MediaType.AUDIO}),e.clean()})),this._virtualStreams=[],null==(e=this.localStream)||e.clean(),null==(t=this.localScreenStream)||t.clean()}}},{key:"_onConnectionStateChange",value:function(e){var t,r=this;if(e.next===MediaConnectionState.DISCONNECTED)t=ConnectionState.CONNECTION_STATE_DISCONNECTED;else if(e.next===MediaConnectionState.CONNECTED)clearTimeout(this._connectionLostTimer),t=this._mediaServerClient.isReconnecting?ConnectionState.CONNECTION_STATE_RECONNECTED:ConnectionState.CONNECTION_STATE_CONNECTED;else{if(e.next!==MediaConnectionState.CONNECTING)return;this._mediaServerClient.isReconnecting?(t=ConnectionState.CONNECTION_STATE_RECONNECTING,this._onReconnecting()):t=ConnectionState.CONNECTION_STATE_CONNECTING}e.prev===MediaConnectionState.CONNECTED&&e.next===MediaConnectionState.DISCONNECTED&&(this._connectionLostTimer=window.setTimeout((function(){r.safeEmit(StateEvent.ON_CONNECTION_STATE_CHANGE,{state:ConnectionState.CONNECTION_STATE_LOST})}),1e4)),this._networkQualityManager.setMSC(this._mediaServerClient),this.safeEmit(StateEvent.ON_CONNECTION_STATE_CHANGE,{state:t})}},{key:"_initStreamListeners",value:function(e){var t=this;e.on("ontrack",(function(e){e.track})),e.on("onSEIMessage",(function(r){var n;t.emit(RoomEvent.ON_SEI_MESSAGED_RECEIVED,{sei:r,remoteStreamKey:{userId:e.userId,roomId:null==(n=t._roomInfo)?void 0:n.roomId,streamIndex:e.isScreen?StreamIndex.STREAM_INDEX_SCREEN:StreamIndex.STREAM_INDEX_MAIN}})}))}},{key:"_onCustomMessage",value:function(e){this.safeEmit(SignalEvent.ON_CUSTOM_MESSAGE,e)}},{key:"_onUserMessageReceived",value:function(e){this.safeEmit(SignalEvent.USER_MESSAGE_RECEIVED,{userId:e.from,message:e.msg})}},{key:"_onUserBinaryMessageReceived",value:function(e){var t,r={userId:e.from,message:e.msg};(null==(t=this._subtitleTool)?void 0:t.onMessageRecv(r))||this.safeEmit(SignalEvent.USER_BINARY_MESSAGE_RECEIVED,r)}},{key:"_initSubtitleTool",value:function(){var e=this;this._subtitleTool=new SubtitleTool(this),this._subtitleTool.onEvent=function(t){e.emit(RoomEvent.ON_SUBTITLE_STATE_CHANGED,t)},this._subtitleTool.onMessage=function(t){e.emit(RoomEvent.ON_SUBTITLE_MESSAGE_RECEIVED,t)}}},{key:"_onPostProcessingMessage",value:function(e){var t;if(e.body)if("subtitleCallback"!==e.type){var r=e.body,n=r.error||0,i=StreamMixingEventType.START,o=["success","parameter error","subscription timeout","ffmpeg error","cdn error","publish error"];if("2.0"===r.protocol){switch(r.eventType){case"TranscodeStarted":0!==r.error&&(i=StreamMixingEventType.START_FAILED);break;case"TranscodeStateChanged":i=0!==r.error?StreamMixingEventType.START_FAILED:StreamMixingEventType.START_SUCCESS;break;case"TranscodeStopped":i=0!==r.error?StreamMixingEventType.STOP_FAILED:StreamMixingEventType.STOP_SUCCESS;break;case"TranscodeUpdated":i=0!==r.error?StreamMixingEventType.UPDATE_FAILED:StreamMixingEventType.UPDATE_SUCCESS}this.safeEmit(SignalEvent.POST_PROCESSING_MESSAGE,{code:n,protocol:r.protocol,error:r.error,eventType:i,message:o[n]})}this.safeEmit(SignalEvent.POST_PROCESSING_MESSAGE,{code:n,message:o[n],type:e.type})}else null==(t=this._subtitleTool)||t.onResult(e)}},{key:"_onUserTokenWillExpire",value:function(){this.safeEmit(SignalEvent.ON_USER_TOKEN_WILL_EXPIRE,null)}},{key:"_onStreamFailed",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("publish"!==t.type){e.next=9;break}if((null==(r=this.localStream)?void 0:r.streamId)===t.streamId?c=this.localStream:(null==(n=this.localScreenStream)?void 0:n.streamId)===t.streamId&&(c=this.localScreenStream),c){e.next=3;break}return e.abrupt("return");case 3:return null==c||c.clean(),e.next=6,null==(i=this._mediaServerClient)?void 0:i.unpublish(c).catch((function(){}));case 6:null==(o=this._mediaServerClient)||o.publish(c).catch((function(){})),e.next=18;break;case 9:if("subscribe"!==t.type){e.next=18;break}if(u=this._remoteStreamStreamIdUserIdMap[t.streamId],l=this._findRemoteStream(u,t.streamId),e.t0=l,!e.t0){e.next=18;break}return e.next=15,null==(a=this._mediaServerClient)?void 0:a.unsubscribe(l);case 15:return e.next=17,null==(s=this._mediaServerClient)?void 0:s.subscribe(l,l.subMediaType,l.subLayer);case 17:this.safeEmit(RoomEvent.RESUBSCRIBE,{stream:l});case 18:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_onStreamControlMessage",value:function(e){var t,r;e.type===StreamControlType.PushLimitWarn&&((null==(t=this._localStream)?void 0:t.pubAudio)||(null==(r=this._localStream)?void 0:r.pubVideo)||this.unpublish())}},{key:"_onPublishOnDemand",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o,a,s,c,u,l,d,p,_,h;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._publishOnDemandItem||this._publishOnDemandBusy||!1===(null==(n=null==(r=null==(t=this._serverConfig)?void 0:t.engine_VPM)?void 0:r.ondemand)?void 0:n.enable)){e.next=15;break}if(!(null==(i=this._localStream)?void 0:i.enableSimulcast)||!(null==(o=this._localStream)?void 0:o.videoTransceiver)){e.next=12;break}return this._publishOnDemandBusy=!0,u=this._publishOnDemandItem,this._publishOnDemandItem=void 0,l=[],d=null==(a=this._localStream)?void 0:a.stream.id,p=null==(s=this._localStream)?void 0:s.videoTransceiver.sender,_=p.getParameters(),Array.isArray(_.encodings)&&Array.isArray(u)&&(h={},this.logger.info("_onPublishOnDemand exec","usedDescriptions: %o",u),u.forEach((function(e){var t;if(null==(t=null==e?void 0:e.StreamIds)?void 0:t.includes(d)){var r=null==e?void 0:e.Metadata.VideoIndex;h[r]=!0}})),_.encodings=_.encodings.map((function(e){if(e.rid){h[e.rid]?e.active=!0:e.active=!1;var t=Number(e.rid);l[t]=e.active}return e})),this._context&&(this._context.activeSimStreams=l)),e.next=9,p.setParameters(_);case 9:this._publishOnDemandBusy=!1,e.next=14;break;case 12:if(null==(c=this._localStream)?void 0:c.videoTransceiver){e.next=14;break}return e.abrupt("return");case 14:this._onPublishOnDemand();case 15:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_onRTT",value:function(e){var t,r=e.StreamIds,n=e.Metadata;if(r.length&&n){var i=r[0];(null==(t=this._context)?void 0:t.streamRTT)&&(this._context.streamRTT[i]={audio:n.audio_rtt,video:n.video_rtt})}}},{key:"_onSSC",value:function(e){var t=e.StreamIds,r=e.Metadata,n=t[0],i=this._remoteStreamStreamIdUserIdMap[n],o=this._findRemoteStream(i,n),a={userId:i,isScreen:!!o&&o.isScreen,beforeVideoIndex:r.ssc_items[0].prev_layer_id,afterVideoIndex:r.ssc_items[0].cur_layer_id,beforeEnable:0!==r.ssc_items[0].prev_video_open,afterEnable:0!==r.ssc_items[0].cur_video_open,reason:r.ssc_items[0].change_reason};this.emit(RoomEvent.ON_SIMULCAST_SUBSCRIBE_FALLBACK,a)}},{key:"_reportNetworkQuality",value:function(e,t){this.emit(RoomEvent.ON_NETWORK_QUALITY,e,t)}},{key:"_emitVideoSizeChange",value:function(e,t,r,n){var i;this.emit(RoomEvent.ON_REMOTE_VIDEO_SIZE_CHANGED,{roomId:null==(i=this.roomInfo)?void 0:i.roomId,userId:e,streamIndex:t?StreamIndex.STREAM_INDEX_SCREEN:StreamIndex.STREAM_INDEX_MAIN},{width:r,height:n})}},{key:"multiChatMode",get:function(){var e;return null==(e=this._mediaServerClient)?void 0:e.multiChatMode()}},{key:"setAudioEncodeMaxBitrate",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null==(o=t===StreamIndex.STREAM_INDEX_MAIN?this.localStream:this.localScreenStream)?void 0:o.pubAudio)){e.next=8;break}if(a=null==(n=o.audioTransceiver)?void 0:n.sender.getParameters(),e.t0=null==a?void 0:a.encodings.length,!e.t0){e.next=8;break}return a.encodings[0].maxBitrate=1e3*r,e.next=8,null==(i=o.audioTransceiver)?void 0:i.sender.setParameters(a);case 8:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),M}(EnhancedEventEmitter),createElement=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=document.createElement(e);return t.id&&(r.id=t.id),t.classList&&t.classList.forEach((function(e){r.classList.add(e)})),t.style&&Object.assign(r.style,t.style),t.attributes&&Object.entries(t.attributes).forEach((function(e){var t=_slicedToArray(e,2),n=t[0],i=t[1];"muted"===n?r.muted=!0:r.setAttribute(n,i)})),r},MEDIA_EVENTS=["play","playing","pause","ended","error","seeking","seeked","waiting","canplay","canplaythrough","durationchange","volumechange","loadedmetadata","loadeddata","loadstart","timeupdate"],AUDIO_ATTRIBUTES={playsinline:"","webkit-playsinline":""},VIDEO_ATTRIBUTES={playsinline:"","webkit-playsinline":"","x5-playsinline":"","x5-video-player-type":"h5","x-webkit-airplay":"allow",preload:"",muted:""},VideoPlayer=function(e){_inherits(n,e);var t,r=_createSuper(n);function n(e,t){var i;_classCallCheck(this,n),i=r.call(this),__publicField(_assertThisInitialized(i),"_containerDom"),__publicField(_assertThisInitialized(i),"_videoDom"),__publicField(_assertThisInitialized(i),"userId"),__publicField(_assertThisInitialized(i),"renderMode"),__publicField(_assertThisInitialized(i),"mirrorType",MirrorType.MIRROR_TYPE_NONE),__publicField(_assertThisInitialized(i),"isScreen"),__publicField(_assertThisInitialized(i),"isLocal"),__publicField(_assertThisInitialized(i),"played",!1),__publicField(_assertThisInitialized(i),"_needLoad",!1),__publicField(_assertThisInitialized(i),"_emitPlayFailed",!1),__publicField(_assertThisInitialized(i),"_videoContainer"),__publicField(_assertThisInitialized(i),"_safari15VideoTimer"),__publicField(_assertThisInitialized(i),"_monitor"),__publicField(_assertThisInitialized(i),"logger"),__publicField(_assertThisInitialized(i),"_onLocalTrackMute"),__publicField(_assertThisInitialized(i),"_onInterruptionEnd"),__publicField(_assertThisInitialized(i),"_needResume",!1),__publicField(_assertThisInitialized(i),"_rotate",0),__publicField(_assertThisInitialized(i),"_rotateDom"),__publicField(_assertThisInitialized(i),"_resizeObserver"),__publicField(_assertThisInitialized(i),"_hasManuallyPaused",!1),__publicField(_assertThisInitialized(i),"_stream"),__publicField(_assertThisInitialized(i),"emitVideoEvent",(function(e){var t,r,n={type:"video",rawEvent:e,readyState:(null==(t=i._videoDom)?void 0:t.readyState)||0,userId:i.userId,eventName:e.type,currentTime:(null==(r=i._videoDom)?void 0:r.currentTime)||0,isScreen:i.isScreen};switch(i.emit("playback_event",n),e.type){case"canplay":i.refreshRenderSize("the video started playing."),i._internalPlay();break;case"loadeddata":i._internalPlay();break;case"playing":i.logger.info("VideoPlayerPlaying","[userId-".concat(i.userId,"] video element playing"));break;case"pause":i.logger.info("VideoPlayerPause","[userId-".concat(i.userId,"] video element pause")),i._needResume&&(i.logger.info("VideoPlayerPause","[userId-".concat(i.userId,"] video element resume")),i._internalPlay(),i._needResume=!1)}})),__publicField(_assertThisInitialized(i),"_internalPlay",(function(){var e,t;if(reportRtcInvokeStatus(i.engineId,"video _internalPlay",{paused:null==(e=i._videoDom)?void 0:e.paused,hasManuallyPaused:i._hasManuallyPaused}),!i._hasManuallyPaused&&(null==(t=i._videoDom)?void 0:t.paused)){var r=i._videoDom.play();(null==r?void 0:r.then)&&r.then((function(){var e;i.isLocal&&isCriOS&&!i._needLoad&&(null==(e=i._videoDom)||e.load(),i._needLoad=!0)})).catch((function(e){var t,r,n,o;i._emitPlayFailed||("AbortError"!==e.name?(i._emitPlayFailed=!0,null==(r=i._monitor)||r.report("rtc_error",{message:"video autoplay failed, userId: ".concat(i.userId,", ").concat(e.name),error_code:RtcErrorCode.AUTOPLAY_FAILED}),i.emit("playback_event",{type:"video",rawEvent:e,readyState:(null==(n=i._videoDom)?void 0:n.readyState)||0,userId:i.userId,eventName:"autoplay-error",currentTime:(null==(o=i._videoDom)?void 0:o.currentTime)||0,isScreen:i.isScreen})):null==(t=i._monitor)||t.report("rtc_error",{message:"video autoplay failed, userId: ".concat(i.userId,", ").concat(e.name),error_code:RtcErrorCode.AUTOPLAY_FAILED}))}))}})),i.engineId=e;var o=t.renderDom;i._monitor=getMonitor(e),i.logger=new Logger$1$1("Player",0,e);var a=t.userId,s=t.isScreen?VideoRenderMode.RENDER_MODE_FIT:VideoRenderMode.RENDER_MODE_HIDDEN;i.renderMode=void 0!==t.renderMode?t.renderMode:s,i._rotate=Number(t.rotation||0);var c="string"==typeof o?document.getElementById(o):o;if(!c)throw new SDKError(ErrorCode.CANT_FIND_DOM,"can't find dom");return i._videoContainer=document.createElement("div"),i._videoContainer.style.width="100%",i._videoContainer.style.height="100%",i._videoContainer.style.position="relative",i._videoContainer.style.overflow="hidden",i._containerDom=c,i.userId=a,i.isLocal=!!t.isLocal,i.isScreen=!!t.isScreen,i._initVideo(),!i.isLocal||15!==(null==iOSVersion?void 0:iOSVersion[0])&&15!==safariVersion||(i._safari15VideoTimer=window.setTimeout((function(){try{i._videoContainer.style.display="block",setTimeout((function(){i._videoContainer.style.display="flex"}),500)}catch(e){}}),1e3)),i}return _createClass(n,[{key:"_initVideo",value:function(){var e=this;this._videoDom||(this._videoDom=createElement("video",{style:{width:"100%",height:"100%"},attributes:VIDEO_ATTRIBUTES}),this._videoDom.id="".concat(this.userId,"_").concat(genUuid()),this.setRenderMode(this.renderMode),this.mirror(this.mirrorType===MirrorType.MIRROR_TYPE_RENDER)),this._containerDom.appendChild(this._videoContainer),[90,270].indexOf(this._rotate)>-1?(this._rotateDom=this._createRotationDiv(),this._rotateDom.appendChild(this._videoDom),this._videoContainer.appendChild(this._rotateDom)):(180===this._rotate&&(this._videoContainer.style.transform="rotate(180deg)"),this._videoContainer.appendChild(this._videoDom)),this._initListeners(),this._onLocalTrackMute=function(){e._needResume=!0},this._onInterruptionEnd=function(){e.logger.warn("resume player after iOS interruption"),e._internalPlay()},internalEventBus.on(InternalEvent.ON_IOS_LOCAL_TRACK_MUTE,this._onLocalTrackMute),internalEventBus.on(InternalEvent.ON_IOS_LOCAL_TRACK_UNMUTE,this._onInterruptionEnd),internalEventBus.on(InternalEvent.ON_IOS_INTERRUPTION_END,this._onInterruptionEnd)}},{key:"_createRotationDiv",value:function(){var e=this,t=document.createElement("div");return t.style.transform="rotate(".concat(this._rotate,"deg)"),180!==this._rotate&&(t.style.position="absolute",this.refreshRenderSize("init"),window.ResizeObserver&&(this._resizeObserver=new ResizeObserver((function(){e.refreshRenderSize("the container size has changed.")})),this._resizeObserver.observe(this._containerDom))),t}},{key:"refreshRenderSize",value:function(e){var t,r;if(this._rotateDom){this.logger.print("refreshRenderSize","Because ".concat(e));var n=Number(window.getComputedStyle(this._containerDom).width.replace("px","")),i=Number(window.getComputedStyle(this._containerDom).height.replace("px","")),o=null==(t=this._videoDom)?void 0:t.videoWidth,a=null==(r=this._videoDom)?void 0:r.videoHeight;if(n&&i&&a&&o){var s,c;if(this.renderMode===VideoRenderMode.RENDER_MODE_FILL)s=i,c=n;else{var u=this.renderMode===VideoRenderMode.RENDER_MODE_HIDDEN?Math.max(n/a,i/o):Math.min(n/a,i/o);s=o*u,c=a*u}this._rotateDom.style.width="".concat(s,"px"),this._rotateDom.style.height="".concat(c,"px"),this._rotateDom.style.left=(n-s)/2+"px",this._rotateDom.style.top=(i-c)/2+"px"}}}},{key:"_initListeners",value:function(){var e=this;this._videoDom&&MEDIA_EVENTS.forEach((function(t){var r;null==(r=e._videoDom)||r.addEventListener(t,e.emitVideoEvent)}))}},{key:"_removeListeners",value:function(){var e=this;this._videoDom&&MEDIA_EVENTS.forEach((function(t){var r;null==(r=e._videoDom)||r.removeEventListener(t,e.emitVideoEvent)}))}},{key:"setRenderMode",value:function(e){this.renderMode=e,this._videoDom&&(this.renderMode===VideoRenderMode.RENDER_MODE_FIT?this._videoDom.style.objectFit="contain":this.renderMode===VideoRenderMode.RENDER_MODE_FILL?this._videoDom.style.objectFit="fill":this._videoDom.style.objectFit="cover")}},{key:"playVideo",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this._videoDom,this._stream=r,this.logger.info("playVideo","play video track: ".concat(this.userId)),!(i&&i.srcObject instanceof MediaStream&&i.srcObject.getTrackById(null==(n=t.preprocessingTrack)?void 0:n.id))){e.next=4;break}try{reportRtcInvokeStatus(this.engineId,"playVideo","play video repeatedly",0,this.userId)}catch(s){}return e.abrupt("return");case 4:i||(this._initVideo(),i=this._videoDom),this.logger.info("playVideo","play video by dom: ".concat(null==i?void 0:i.id)),o=new MediaStream,t.videoPlayer=this,o.addTrack(t.preprocessingTrack),i.srcObject=o,i&&!this._containerDom.contains(this._videoContainer)&&this._containerDom.appendChild(this._videoContainer),i&&!this._videoContainer.contains(i)&&this._videoContainer.appendChild(i),setTimeout((function(){return a._internalPlay()})),r&&Config2.VIDEO_STALL&&r.startVideoStallObserve(this),this.played=!0;case 7:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"updateSrcObject",value:function(e){var t=e.preprocessingTrack;if(t&&this._videoDom){var r=new MediaStream;r.addTrack(t),this._videoDom.srcObject=r}}},{key:"removeTrack",value:function(){var e,t=null==(e=this._videoDom)?void 0:e.srcObject;if(t){var r=t.getVideoTracks();(null==r?void 0:r.length)&&r.forEach((function(e){t.removeTrack(e)}))}}},{key:"manuallyPlay",value:function(){if(this.logger.info("Invoke VideoPlayer.manuallyPlay",this.userId,this.isScreen),this._emitPlayFailed=!1,this._hasManuallyPaused=!1,!this._videoDom)throw new SDKError(ErrorCode.INVALID_PARAMS,"Player not found");return 0!==this._videoDom.readyState||isWeChat?this._videoDom.play():Promise.resolve()}},{key:"manuallyPause",value:function(){if(this.logger.print("Invoke VideoPlayer.manuallyPause",this.userId,this.isScreen),this.played){if(this._hasManuallyPaused=!0,!this._videoDom)throw new SDKError(ErrorCode.INVALID_PARAMS,"Player not found");return this._videoDom.pause()}}},{key:"mirror",value:function(e){this.logger.info("mirror","".concat(this.userId," set mirror: ").concat(e)),this.mirrorType=e?MirrorType.MIRROR_TYPE_RENDER:MirrorType.MIRROR_TYPE_NONE,this._videoDom&&(this._videoDom.style.transform=e?"rotateY(180deg)":"")}},{key:"stop",value:function(){var e,t,r,n=this,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=this._containerDom;this.logger.info("stop","stop video track: ".concat(this.userId)),null==(e=this._stream)||e.stopVideoStallObserve(),this._videoDom&&(i||(this._videoDom.srcObject=null),(null==o?void 0:o.contains(this._videoContainer))&&o.removeChild(this._videoContainer),null==(t=this._videoContainer)||t.childNodes.forEach((function(e){e!==n._videoDom&&e!==n._rotateDom||n._videoContainer.removeChild(e)})),(null==(r=this._rotateDom)?void 0:r.contains(this._videoDom))&&this._rotateDom.removeChild(this._videoDom)),this._hasManuallyPaused=!1,this.played=!1}},{key:"destroy",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.logger.info("destroy","video player: ".concat(this.userId)),this.stop(t),null==(e=this._resizeObserver)||e.disconnect(),_get(_getPrototypeOf(n.prototype),"removeAllListeners",this).call(this),this._removeListeners(),internalEventBus.off(InternalEvent.ON_IOS_LOCAL_TRACK_MUTE,this._onLocalTrackMute),internalEventBus.off(InternalEvent.ON_IOS_LOCAL_TRACK_UNMUTE,this._onInterruptionEnd),internalEventBus.off(InternalEvent.ON_IOS_INTERRUPTION_END,this._onInterruptionEnd),this._videoDom&&delete this._videoDom,this._safari15VideoTimer&&(window.clearInterval(this._safari15VideoTimer),this._safari15VideoTimer=void 0)}},{key:"domElement",get:function(){return this._videoDom}}]),n}(eventemitter3Exports.EventEmitter),AudioPlayer=function(e){_inherits(i,e);var t,r,n=_createSuper(i);function i(e,t){var r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{divId:void 0,muted:!1,isScreen:!1},a=o.divId,s=o.muted,c=o.isScreen;if(_classCallCheck(this,i),r=n.call(this),__publicField(_assertThisInitialized(r),"_containerDom"),__publicField(_assertThisInitialized(r),"_audioDom"),__publicField(_assertThisInitialized(r),"_fakeAudioDom"),__publicField(_assertThisInitialized(r),"userId"),__publicField(_assertThisInitialized(r),"muted",!1),__publicField(_assertThisInitialized(r),"_emitPlayFailed",!1),__publicField(_assertThisInitialized(r),"played",!1),__publicField(_assertThisInitialized(r),"isScreen"),__publicField(_assertThisInitialized(r),"_wechatTimer"),__publicField(_assertThisInitialized(r),"_edgeTimer"),__publicField(_assertThisInitialized(r),"_monitor"),__publicField(_assertThisInitialized(r),"logger"),__publicField(_assertThisInitialized(r),"_pasued",!0),__publicField(_assertThisInitialized(r),"emitAudioEvent",(function(e){var t,n,i,o,a={type:"audio",rawEvent:e,readyState:(null==(t=r._audioDom)?void 0:t.readyState)||0,userId:r.userId,eventName:e.type,currentTime:(null==(n=r._audioDom)?void 0:n.currentTime)||0};"playing"===e.type&&r.logger.info("AudioPlayerPlaying","[userId-".concat(r.userId,"] audio element playing")),"pause"===e.type&&(r.logger.info("AudioPlayerPause","[userId-".concat(r.userId,"] audio element pause")),!r._pasued&&(null==(o=null==(i=r._audioDom)?void 0:i.srcObject)?void 0:o.active)&&r._internalPlay()),isAndroid&&isWeChat&&("canplay"===e.type?(clearTimeout(r._wechatTimer),r._wechatTimer=window.setTimeout((function(){r._autoPlayError("wechat")}),500)):"playing"===e.type&&clearTimeout(r._wechatTimer)),isMobile$1&&isEdge&&"error"===e.type&&(clearTimeout(r._edgeTimer),r._edgeTimer=window.setTimeout((function(){var e;0===(null==(e=r._audioDom)?void 0:e.currentTime)&&r._autoPlayError("edge")}),500)),r.emit("playback_event",a)})),__publicField(_assertThisInitialized(r),"_internalPlay",(function(){var e,t,n;if(reportRtcInvokeStatus(r.engineId,"audio _internalPlay",{paused:null==(e=r._audioDom)?void 0:e.paused,userId:r.userId,screen:r.isScreen}),null==(t=r._audioDom)?void 0:t.paused)try{var i=r._audioDom.play(),o=audioContextManager.getAudioContextInstance();if("suspended"===o.state){var a=o.resume(),s=setTimeout((function(){var e;"suspended"===o.state&&(r._autoPlayError("AudioContext cannot resume"),null==(e=r._monitor)||e.report("rtc_error",{message:"audio autoplay failed, userId: ".concat(r.userId,": Cannot resume the AudioContext"),error_code:RtcErrorCode.AUTOPLAY_FAILED})),clearTimeout(s)}));a.then((function(){clearTimeout(s)}))}(null==i?void 0:i.then)&&(isAndroid&&isMobile$1&&(i=i.then((function(){return new Promise((function(e){setTimeout(_asyncToGenerator(_regeneratorRuntime().mark((function t(){var n;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return null==(n=r._audioDom)||n.pause(),r._audioDom.volume=1,t.next=4,r._audioDom.play();case 4:e();case 5:case"end":return t.stop()}}),t)}))),500)}))}))),i.then((function(){reportRtcInvokeStatus(r.engineId,"_internalPlay successfully",{userId:r.userId,screen:r.isScreen}),r._pasued=!1})).catch((function(e){var t;r._autoPlayError(e),null==(t=r._monitor)||t.report("rtc_error",{message:"audio autoplay failed, userId: ".concat(r.userId,": ").concat(e.message," ").concat(e.name),error_code:RtcErrorCode.AUTOPLAY_FAILED})})))}catch(c){r._autoPlayError(c),null==(n=r._monitor)||n.report("rtc_error",{message:"audio autoplay failed, userId: ".concat(r.userId,": ").concat(c.message," ").concat(c.name),error_code:RtcErrorCode.AUTOPLAY_FAILED})}})),r.engineId=e,a){var u=document.getElementById(a);if(!u)throw new SDKError(ErrorCode.CANT_FIND_DOM,"can't find dom");r._containerDom=u}else r._containerDom=document.body;return r.userId=t,r.muted=s,r.isScreen=c,r._monitor=getMonitor(e),r.logger=new Logger$1$1("Player",0,e),r._initAudio(),_possibleConstructorReturn(r)}return _createClass(i,[{key:"_initAudio",value:function(){this._audioDom||(this._audioDom=createElement("audio",{style:{display:"none"},attributes:AUDIO_ATTRIBUTES}),this._audioDom.volume=this.muted?0:1,this._audioDom.muted=this.muted,this._audioDom.id="".concat(this.userId,"_").concat(genUuid()),this._containerDom.appendChild(this._audioDom)),this._initListeners()}},{key:"_initListeners",value:function(){var e=this;this._audioDom&&MEDIA_EVENTS.forEach((function(t){var r;null==(r=e._audioDom)||r.addEventListener(t,e.emitAudioEvent)}))}},{key:"_removeListeners",value:function(){var e=this;this._audioDom&&(MEDIA_EVENTS.forEach((function(t){var r;null==(r=e._audioDom)||r.removeEventListener(t,e.emitAudioEvent)})),this._audioDom.removeEventListener("canplay",this._internalPlay),this._audioDom.removeEventListener("loadeddata",this._internalPlay))}},{key:"playAudio",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("playAudio","play audio track: ".concat(this.userId)),!((n=this._audioDom)&&n.srcObject instanceof MediaStream&&n.srcObject.getTrackById(null==(r=t.preprocessingTrack)?void 0:r.id))){e.next=4;break}return e.abrupt("return");case 4:n||(this._initAudio(),n=this._audioDom),i=new MediaStream,t instanceof runtimeTrackCls.RemoteAudioTrack?(this._fakeAudioDom=new Audio,this._fakeAudioDom.muted=!0,this._fakeAudioDom.srcObject=new MediaStream([t.originTrack]),i.addTrack(t.preprocessingTrack)):i.addTrack(t.preprocessingTrack),isAndroid&&isMobile$1&&(this._audioDom.volume=0),n.srcObject=i,null==n||n.addEventListener("canplay",this._internalPlay),null==n||n.addEventListener("loadeddata",this._internalPlay),setTimeout((function(){return o._internalPlay()})),this.played=!0;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_autoPlayError",value:function(e){var t,r;this._emitPlayFailed||(this._emitPlayFailed=!0,this.emit("playback_event",{type:"audio",rawEvent:e,readyState:(null==(t=this._audioDom)?void 0:t.readyState)||0,userId:this.userId,eventName:"autoplay-error",currentTime:(null==(r=this._audioDom)?void 0:r.currentTime)||0}))}},{key:"pause",value:function(){if(!this._audioDom)throw new SDKError(ErrorCode.INVALID_PARAMS,"Player not found");this._pasued=!0,this._audioDom.pause()}},{key:"manuallyPause",value:function(){return this.pause()}},{key:"manuallyPlay",value:function(){var e,t=this;if(this.logger.info("Invoke AudioPlayer.manuallyPlay"),this._emitPlayFailed=!1,!this._audioDom)throw new SDKError(ErrorCode.INVALID_PARAMS,"Player not found");if(!this.played)return Promise.resolve();this._audioDom.volume=1,this._audioDom.muted=!1,null==(e=this._fakeAudioDom)||e.play();var r=[],n=this._audioDom.play();(null==n?void 0:n.then)&&r.push(n);var i=audioContextManager.getAudioContextInstance();if("suspended"===i.state){var o=i.resume();(null==o?void 0:o.then)&&r.push(o)}(r.length>0?Promise.all(r):Promise.resolve(n)).then((function(){t._pasued=!1}))}},{key:"setPlaybackDevice",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("setPlaybackDevice","setPlaybackDevice: ".concat(t)),e.next=3,dd$1.enumerateAudioPlaybackDevices();case 3:if(e.t1=e.sent.map((function(e){return e.deviceId})).includes(t),!e.t1){e.next=6;break}e.t1=this._audioDom;case 6:if(e.t0=e.t1,!e.t0){e.next=9;break}e.t0=this._audioDom.setSinkId;case 9:if(e.t2=e.t0,!e.t2){e.next=13;break}return e.next=13,this._audioDom.setSinkId(t);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"stop",value:function(){var e=this._containerDom;this.logger.info("stopAudio","stop audio track: ".concat(this.userId)),this._audioDom&&(this._audioDom.srcObject=null,(null==e?void 0:e.contains(this._audioDom))&&e.removeChild(this._audioDom)),this._fakeAudioDom&&(this._fakeAudioDom.srcObject=null,this._fakeAudioDom=void 0),this.played=!1}},{key:"domElement",get:function(){return this._audioDom}},{key:"destroy",value:function(){this.logger.info("destroy","audio player: ".concat(this.userId)),this.stop(),_get(_getPrototypeOf(i.prototype),"removeAllListeners",this).call(this),this._removeListeners(),this._audioDom&&(this._audioDom.srcObject=null,delete this._audioDom),this._edgeTimer&&clearTimeout(this._edgeTimer)}}]),i}(eventemitter3Exports.EventEmitter);function playRemoteStream(e,t,r,n){var i=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,i){var o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=null==n?void 0:n.get(i),Array.isArray(o)&&(o=null==o?void 0:o.find((function(e){return e.isScreen===r}))),e.t0=t,!e.t0){e.next=10;break}if(!t.played){e.next=9;break}return e.next=7,t.manuallyPlay();case 7:e.next=10;break;case 9:o&&(t instanceof VideoPlayer&&o.videoTrack&&t.playVideo(o.videoTrack,o),t instanceof AudioPlayer&&o.audioTrack&&t.playAudio(o.audioTrack));case 10:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();if(t)return i(e.get(t),t);var o=[];return e.forEach((function(e,t){return o.push(i(e,t))})),Promise.all(o)}var isValidAudioFile=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Audio(URL.createObjectURL(new Blob([t],r))),e.prev=1,n.muted=!0,e.next=5,n.play();case 5:return n.pause(),e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(1),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,r){return e.apply(this,arguments)}}(),__defProp$2=Object.defineProperty,__getOwnPropDesc$2=Object.getOwnPropertyDescriptor,__decorateClass$2=function(e,t,r,n){for(var i,o=n>1?void 0:n?__getOwnPropDesc$2(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&__defProp$2(t,r,o),o},AudioMixingManager=function(){function e(t,r){_classCallCheck(this,e),__publicField(this,"_sharedAudioContext",new AudioContext),__publicField(this,"_audioDestination",this._sharedAudioContext.createMediaStreamDestination()),__publicField(this,"_localGainNode",this._sharedAudioContext.createGain()),__publicField(this,"_bufferGainNode",this._sharedAudioContext.createGain()),__publicField(this,"_audioBufferSource"),__publicField(this,"_localSource"),__publicField(this,"_context"),__publicField(this,"_failedAudioList",[]),__publicField(this,"_startingIds",new Map),__publicField(this,"_revokeURLs",new Set),__publicField(this,"mixingMap",new Map),__publicField(this,"resourcesCache",new Map),__publicField(this,"volumeConfig",new Map),__publicField(this,"cachedBuffer",[]),__publicField(this,"id","AudioMixingManager"),this.engineId=r,this._context=t,this._localGainNode.gain.value=1}var t,r,n;return _createClass(e,[{key:"mixMediaStream",value:function(e){this._localSource&&this._localSource.disconnect(this._localGainNode),this._localSource=this._sharedAudioContext.createMediaStreamSource(e),this._localSource.connect(this._localGainNode).connect(this._audioDestination)}},{key:"startAudioMixing",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,o,a,s,c,u,l,d,p,_,h,f,m,g=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this._startingIds.get(t)){e.next=2;break}return e.abrupt("return",void console.warn("AudioMixing task id: ".concat(t," is starting")));case 2:if(this._startingIds.set(t,t),i=n.playCount,checkEnum(o=n.type,"mixingType",values(AudioMixingType)),a=this._context.getLocalAudioTrack()){e.next=8;break}return e.abrupt("return");case 8:if((s=a.preprocessingTrack)&&this.mixMediaStream(new MediaStream([s])),a.once("needReplaceTrack",(function(){g.mixMediaStream(new MediaStream([a.preprocessingTrack]))})),null==(c=this.mixingMap.get(t))?void 0:c.audioNode){c.audioNode.pause(),this._context.emitMessage({mixId:t,state:AudioMixingState.AUDIO_MIXING_STATE_STOPPED,error:AudioMixingError.AUDIO_MIXING_ERROR_OK});try{c.gainNode.disconnect(this._audioDestination),c.audioSource.disconnect(c.gainNode)}catch(v){}}if(!(l=this.resourcesCache.get(t))||l.filePath!==r){e.next=17;break}u=l.getAudioNode(),e.next=26;break;case 17:return e.next=19,fetch(r,{mode:"cors",credentials:"include"}).then((function(e){if(e.ok)return e.arrayBuffer();throw g._context.emitMessage({mixId:t,state:AudioMixingState.AUDIO_MIXING_STATE_FAILED,error:AudioMixingError.AUDIO_MIXING_ERROR_START_FAILED}),new SDKError(ErrorCode.LOAD_RESOURCES_FAILED,e.statusText)}));case 19:return d=e.sent,r.endsWith("mp3")?p={type:"audio/mpeg"}:r.endsWith("aac")&&(p={type:"audio/aac"}),e.next=23,isValidAudioFile(d,p);case 23:if(e.sent){e.next=25;break}throw this._context.emitMessage({mixId:t,state:AudioMixingState.AUDIO_MIXING_STATE_FAILED,error:AudioMixingError.AUDIO_MIXING_ERROR_START_FAILED}),new SDKError(ErrorCode.LOAD_RESOURCES_FAILED,"invalid audio resource");case 25:(u=new Audio).crossOrigin="anonymous",u.src=URL.createObjectURL(new Blob([d],p));case 26:return i<=0?u.loop=!0:i>0&&(_=i,u.onended=function(){--_>0?u.play():(g.mixingMap.delete(t),g._context.emitMessage({mixId:t,state:AudioMixingState.AUDIO_MIXING_STATE_FINISHED,error:AudioMixingError.AUDIO_MIXING_ERROR_OK}))}),e.prev=27,e.next=30,u.play();case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(27),console.error(e.t0),this._failedAudioList.push(u),this._context.onAutoPlayFailed({userId:this.id,kind:"audio",streamIndex:StreamIndex.STREAM_INDEX_MAIN,mediaType:MediaType.AUDIO});case 35:if(this._startingIds.delete(t),h=this._sharedAudioContext.createMediaElementSource(u),f=this._sharedAudioContext.createGain(),m=this.volumeConfig.get(t),f.gain.value=m?m/100:1,h.connect(f).connect(this._audioDestination),this.mixingMap.set(t,{audioSource:h,audioNode:u,gainNode:f,type:"file"}),o===AudioMixingType.PUBLISH)try{f.disconnect(this._sharedAudioContext.destination)}catch(v){}else f.connect(this._sharedAudioContext.destination);this._context.updateLocalAudioTrack(this._audioDestination.stream.getAudioTracks()[0],n.type),this._context.emitMessage({mixId:t,state:AudioMixingState.AUDIO_MIXING_STATE_PLAYING,error:AudioMixingError.AUDIO_MIXING_ERROR_OK});case 39:case"end":return e.stop()}}),e,this,[[27,32]])}))),function(e,t,r){return n.apply(this,arguments)})},{key:"stopAudioMixing",value:function(e){var t=this.mixingMap.get(e);t&&"file"===t.type&&(this.mixingMap.delete(e),t.audioNode.pause(),t.audioSource.disconnect(t.gainNode),t.gainNode.disconnect(this._audioDestination),this._context.emitMessage({mixId:e,state:AudioMixingState.AUDIO_MIXING_STATE_STOPPED,error:AudioMixingError.AUDIO_MIXING_ERROR_OK}))}},{key:"pauseAudioMixing",value:function(e){var t=this.mixingMap.get(e);t&&(this._context.emitMessage({mixId:e,state:AudioMixingState.AUDIO_MIXING_STATE_PAUSED,error:AudioMixingError.AUDIO_MIXING_ERROR_OK}),t.audioNode.pause())}},{key:"resumeAudioMixing",value:function(e){var t=this.mixingMap.get(e);t&&(this._context.emitMessage({mixId:e,state:AudioMixingState.AUDIO_MIXING_STATE_PLAYING,error:AudioMixingError.AUDIO_MIXING_ERROR_OK}),t.audioNode.play())}},{key:"preloadAudioMixing",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stopAudioMixing(t),e.next=3,fetch(r,{mode:"cors",credentials:"include"}).then((function(e){if(e.ok)return e.arrayBuffer();throw new SDKError(ErrorCode.LOAD_RESOURCES_FAILED,e.statusText)})).catch((function(e){if(o._context.emitMessage({mixId:t,state:AudioMixingState.AUDIO_MIXING_STATE_FAILED,error:AudioMixingError.AUDIO_MIXING_ERROR_PRELOAD_FAILED}),e instanceof SDKError)throw e;throw new SDKError(ErrorCode.LOAD_RESOURCES_FAILED,"Load resources failed",e)}));case 3:return n=e.sent,r.endsWith("mp3")?i={type:"audio/mpeg"}:r.endsWith("aac")&&(i={type:"audio/aac"}),e.next=7,isValidAudioFile(n,i);case 7:if(e.sent){e.next=9;break}throw this._context.emitMessage({mixId:t,state:AudioMixingState.AUDIO_MIXING_STATE_FAILED,error:AudioMixingError.AUDIO_MIXING_ERROR_PRELOAD_FAILED}),new SDKError(ErrorCode.LOAD_RESOURCES_FAILED,"Load resources failed");case 9:return this._context.emitMessage({mixId:t,state:AudioMixingState.AUDIO_MIXING_STATE_PRELOADED,error:AudioMixingError.AUDIO_MIXING_ERROR_OK}),this.resourcesCache.set(t,{getAudioNode:function(){var e=URL.createObjectURL(new Blob([n],i));return o._revokeURLs.add(e),new Audio(e)},filePath:r,duration:0}),e.next=13,new Promise((function(e){var r=URL.createObjectURL(new Blob([n],i)),a=new Audio(r);a.addEventListener("durationchange",(function(){var n=o.resourcesCache.get(t);n&&(n.duration=a.duration,o.resourcesCache.set(t,n)),URL.revokeObjectURL(r),e(null)}))}));case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"unloadAudioMixing",value:function(e){this.resourcesCache.has(e)&&this.resourcesCache.delete(e)}},{key:"getAudioMixingVolume",value:function(e){var t=this.mixingMap.get(e);return t?100*t.gainNode.gain.value:0}},{key:"setAudioMixingVolume",value:function(e,t){t<0?t=0:t>400&&(t=400),this.volumeConfig.set(e,t);var r=this.mixingMap.get(e);r&&(r.gainNode.gain.value=Number(t)/100)}},{key:"getAudioMixingDuration",value:function(e){var t=this.mixingMap.get(e),r=this.resourcesCache.get(e);return t||r?t?1e3*t.audioNode.duration:r?1e3*r.duration:0:0}},{key:"getAudioMixingCurrentPosition",value:function(e){var t=this.mixingMap.get(e);return t?1e3*t.audioNode.currentTime:0}},{key:"setAudioMixingPosition",value:function(e,t){var r=this.mixingMap.get(e);r&&(r.audioNode.currentTime=t/1e3,r.audioNode.play())}},{key:"enableAudioMixingBuffer",value:function(e){checkEnum(e,"type",values(AudioMixingType));var t=this._context.getLocalAudioTrack();if(t){var r=t.preprocessingTrack;if(r&&this.mixMediaStream(new MediaStream([r])),e===AudioMixingType.PUBLISH)try{this._bufferGainNode.disconnect(this._sharedAudioContext.destination)}catch(n){}else this._bufferGainNode.connect(this._sharedAudioContext.destination);this._context.updateLocalAudioTrack(this._audioDestination.stream.getAudioTracks()[0],e),this._bufferGainNode.connect(this._audioDestination),this._context.emitMessage({mixId:-1,state:AudioMixingState.AUDIO_MIXING_STATE_PCM_ENABLED,error:AudioMixingError.AUDIO_MIXING_ERROR_OK})}}},{key:"disableAudioMixingBuffer",value:function(){if(this.cachedBuffer=[],this._audioBufferSource){try{this._audioBufferSource.onended=null,this._audioBufferSource.disconnect(this._bufferGainNode),this._bufferGainNode.disconnect(this._audioDestination),this._bufferGainNode.disconnect(this._sharedAudioContext.destination)}catch(e2){}finally{this._audioBufferSource=void 0}this._context.updateLocalAudioTrack(),this._context.emitMessage({mixId:-1,state:AudioMixingState.AUDIO_MIXING_STATE_PCM_DISABLED,error:AudioMixingError.AUDIO_MIXING_ERROR_OK})}}},{key:"pushAudioMixingBuffer",value:function(e){var t=this;if(!(this._audioBufferSource&&(this.cachedBuffer.push(e),this.cachedBuffer.length>0))){this._audioBufferSource=this._sharedAudioContext.createBufferSource(),this._audioBufferSource.buffer=e,this._audioBufferSource.connect(this._bufferGainNode);try{this._audioBufferSource.start()}catch(r){this._failedAudioList.push(this._audioBufferSource)}this._audioBufferSource.onended=function(){var e;if(null==(e=t._audioBufferSource)||e.disconnect(t._bufferGainNode),t._audioBufferSource=void 0,t.cachedBuffer.length){var r=t.cachedBuffer.shift();r&&t.pushAudioMixingBuffer(r)}}}}},{key:"stopAll",value:function(){var e=this;if(this._localSource)try{this._localSource.disconnect(this._localGainNode),delete this._localSource}catch(e2){}this.mixingMap.forEach((function(t,r){e.stopAudioMixing(r)}))}},{key:"mixTrack",get:function(){return this._audioDestination.stream.getAudioTracks()[0]}},{key:"sharedAudioContext",get:function(){return this._sharedAudioContext}},{key:"resumeLocalPlay",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r=_createForOfIteratorHelper(this._failedAudioList),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=22;break}if(i=n.value,e.prev=6,!(i instanceof HTMLAudioElement)){e.next=13;break}return i.muted=!1,e.next=11,i.play();case 11:e.next=14;break;case 13:i.start();case 14:e.next=20;break;case 16:return e.prev=16,e.t0=e.catch(6),t.push(i),console.error(e.t0),this._context.onAutoPlayFailed({userId:this.id,kind:"audio",streamIndex:StreamIndex.STREAM_INDEX_MAIN,mediaType:MediaType.AUDIO}),e.abrupt("break",22);case 20:e.next=4;break;case 22:e.next=27;break;case 24:e.prev=24,e.t1=e.catch(2),r.e(e.t1);case 27:return e.prev=27,r.f(),e.finish(27);case 30:this._failedAudioList=t;case 31:case"end":return e.stop()}}),e,this,[[2,24,27,30],[6,16]])}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e=this._sharedAudioContext;"closed"!==e.state&&"function"==typeof e.close&&e.close(),this.cachedBuffer=[],this.mixingMap.clear(),this.resourcesCache.clear(),this.volumeConfig.clear(),this._startingIds=new Map,this._revokeURLs.forEach((function(e){URL.revokeObjectURL(e)}))}}]),e}();__decorateClass$2([reportRtcSdkApiCall("id","filePath","options")],AudioMixingManager.prototype,"startAudioMixing",1),__decorateClass$2([reportRtcSdkApiCall("id")],AudioMixingManager.prototype,"stopAudioMixing",1),__decorateClass$2([reportRtcSdkApiCall("id")],AudioMixingManager.prototype,"pauseAudioMixing",1),__decorateClass$2([reportRtcSdkApiCall("id")],AudioMixingManager.prototype,"resumeAudioMixing",1),__decorateClass$2([reportRtcSdkApiCall("id")],AudioMixingManager.prototype,"preloadAudioMixing",1),__decorateClass$2([reportRtcSdkApiCall("id")],AudioMixingManager.prototype,"unloadAudioMixing",1),__decorateClass$2([reportRtcSdkApiCall("id")],AudioMixingManager.prototype,"getAudioMixingVolume",1),__decorateClass$2([reportRtcSdkApiCall("id","volume")],AudioMixingManager.prototype,"setAudioMixingVolume",1),__decorateClass$2([reportRtcSdkApiCall("id")],AudioMixingManager.prototype,"getAudioMixingDuration",1),__decorateClass$2([reportRtcSdkApiCall("id")],AudioMixingManager.prototype,"getAudioMixingCurrentPosition",1),__decorateClass$2([reportRtcSdkApiCall("id","position")],AudioMixingManager.prototype,"setAudioMixingPosition",1),__decorateClass$2([reportRtcSdkApiCall("type")],AudioMixingManager.prototype,"enableAudioMixingBuffer",1),__decorateClass$2([reportRtcSdkApiCall()],AudioMixingManager.prototype,"disableAudioMixingBuffer",1),__decorateClass$2([reportRtcSdkApiCall("buffer")],AudioMixingManager.prototype,"pushAudioMixingBuffer",1);var UserRole=function(e){return e.NORMAL_USER="normalUser",e.SILENT_USER="silentUser",e}(UserRole||{}),RTMClient=function(e){_inherits(c,e);var t,r,n,i,o,a,s=_createSuper(c);function c(e){var t;return _classCallCheck(this,c),t=s.call(this),__publicField(_assertThisInitialized(t),"_dataChannelSignal"),__publicField(_assertThisInitialized(t),"_handler"),__publicField(_assertThisInitialized(t),"_dataChannelSignalState",MediaConnectionState.DISCONNECTED),__publicField(_assertThisInitialized(t),"_loginSessionId",null),__publicField(_assertThisInitialized(t),"_userId",null),__publicField(_assertThisInitialized(t),"_token",null),__publicField(_assertThisInitialized(t),"_loginResolveCallback"),__publicField(_assertThisInitialized(t),"_loginRejectCallback"),__publicField(_assertThisInitialized(t),"_wait_login_token",!1),__publicField(_assertThisInitialized(t),"_serverParamsCache"),__publicField(_assertThisInitialized(t),"id"),__publicField(_assertThisInitialized(t),"_connectionManager"),__publicField(_assertThisInitialized(t),"isReconnecting",!1),__publicField(_assertThisInitialized(t),"logger"),t._ctx=e,t.id=e.id,t.logger=new Logger$1$1("RTMClient",1,e.id),t._connectionManager=new ConnectionManager(e),t._addConnectHandler(),t}return _createClass(c,[{key:"login",value:function(e,t){var r=this;return new Promise((function(n,i){var o;if(r.logger.info("login","invoke login, token: %o, userId: %o",e,t),r._loginSessionId)throw new SDKError(ErrorCode.ALREADY_LOGIN,"Already logined");if(r._loginResolveCallback)throw new SDKError(ErrorCode.LOGIN_FAILED,"Is logging in, please try again later.");r._userId=t,r._token=e,null==(o=getMonitor(r.id))||o.set({rtm_user_id:t}),r._loginResolveCallback=n,r._loginRejectCallback=i,r._dataChannelSignal?r._login():r.connect().then((function(){r._login()}))}))}},{key:"logout",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new SDKError(ErrorCode.NOT_LOGIN,"login first");case 2:return e.next=4,null==(t=this._dataChannelSignal)?void 0:t.sendSignaling("logout",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._ctx.appId},{functionType:SIGNALING_FUNCTION_TYPE.C2RTM}).catch((function(){}));case 4:this._clearState();case 5:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"updateLoginToken",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this._token=t,new Promise((function(e,t){r._wait_login_token?(r._loginResolveCallback=e,r._loginRejectCallback=t,r._login()):e()}))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getPeerOnlineStatus",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new SDKError(ErrorCode.NOT_LOGIN,"login first");case 2:return this._checkDataChannelSignal(),e.next=5,this._dataChannelSignal.sendSignaling("getPeerOnlineStatus",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._ctx.appId,peerUserId:t},{functionType:SIGNALING_FUNCTION_TYPE.C2RTM});case 5:return r=e.sent,e.abrupt("return",null==r?void 0:r.status);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"sendUserMessageOutsideRoom",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new SDKError(ErrorCode.NOT_LOGIN,"login first");case 2:return e.abrupt("return",(this._checkDataChannelSignal(),this._dataChannelSignal.sendP2PMessage({from:this._userId,app:this._ctx.appId,to:t,room:"",msg:r})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"setServerParams",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,checkString(t,"signature"),checkString(r,"url"),this._loginSessionId&&this._userId){e.next=3;break}throw new SDKError(ErrorCode.NOT_LOGIN,"login first");case 3:return this._checkDataChannelSignal(),e.next=6,this._dataChannelSignal.sendSignaling("setServerParams",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._ctx.appId,signature:t,url:r},{functionType:SIGNALING_FUNCTION_TYPE.C2RTM}).catch((function(e){throw new SDKError(ErrorCode.UNEXPECTED_ERROR,e.msg)}));case 6:this._serverParamsCache={signature:t,url:r},this.emit("onServerParamsSetResult"),e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(0),this.emit("onServerParamsSetResult",e.t0),e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(e,t){return r.apply(this,arguments)})},{key:"sendServerMessage",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new SDKError(ErrorCode.NOT_LOGIN,"login first");case 2:return e.abrupt("return",(this._checkDataChannelSignal(),this._dataChannelSignal.sendP2PMessage({from:this._userId,app:this._ctx.appId,to:"",room:"",type:DC_MESSAGE_FUNCTION_TYPE.BUSINESS_SERVER,msg:t})));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e;this.logger.info("destroy","invoke."),_get(_getPrototypeOf(c.prototype),"removeAllListeners",this).call(this),this._loginResolveCallback&&this._loginRejectCallback&&(this._loginRejectCallback(new SDKError(ErrorCode.LOGIN_FAILED,"logout")),delete this._loginResolveCallback,delete this._loginRejectCallback),null==(e=this._dataChannelSignal)||e.destroy(),delete this._dataChannelSignal,this._clearState(),this._connectionManager.destroy(),delete this._serverParamsCache}},{key:"_login",value:function(){var e=this;if(this._userId){var t=genUuid();this._checkDataChannelSignal(),this._dataChannelSignal.sendSignaling("login",{Token:Utils.token2auth(this._ctx.appId,null,this._userId,this._token),timestamp:Date.now(),loginSessionId:t,params:{deviceType:"web",userAgent:window.navigator.userAgent,sdkVersion:Config2.VERSION,deviceId:sdkCache.getDeviceId(),appId:this._ctx.appId,userId:this._userId}},{functionType:SIGNALING_FUNCTION_TYPE.C2RTM}).then((function(){"function"==typeof e._loginResolveCallback&&e._loginResolveCallback(),e._loginSessionId=t,RTSMsgReportor.setRtsSessionId(e.id,t),e._wait_login_token=!1,e._serverParamsCache&&e.setServerParams(e._serverParamsCache.signature,e._serverParamsCache.url)})).catch((function(t){var r,n,i=t||{},o=i.code,a=i.message;e._wait_login_token=!1,o>=700&&o<800?708===o?(r=ErrorCode.INVALID_PARAMS,n="Invalid userId"):(r=ErrorCode.INVALID_TOKEN,n="Invalid token",e._wait_login_token=!0,e._loginRejectCallback||e.emit("onRTMTokenError")):(r=ErrorCode.LOGIN_FAILED,n="login failed"),"function"==typeof e._loginRejectCallback&&e._loginRejectCallback(new SDKError(r,a||n))})).finally((function(){delete e._loginResolveCallback,delete e._loginRejectCallback}))}}},{key:"connect",value:function(){var e=this;return new Promise((function(t,r){e._connectionManager.once("connected",(function(){return t()})),e._connectionManager.once("disconnected",r),e._connectionManager.connect()}))}},{key:"_checkDataChannelSignal",value:function(){if(!this._dataChannelSignal||this._dataChannelSignalState!==MediaConnectionState.CONNECTED)throw new SDKError(ErrorCode.NOT_CONNECTED_YET,"datachannel not connect")}},{key:"_addConnectHandler",value:function(){var e=this;this._connectionManager.on("connected",(function(t){var r,n;e._dataChannelSignalState=MediaConnectionState.CONNECTED,e.logger.info("connectStateChange","connected"),null==(r=e._handler)||r.destroy(),null==(n=e._dataChannelSignal)||n.destroy(),e._handler=createHandler(e._ctx,t.pc),e._dataChannelSignal=t.signaling,e._addSignalEventHandler(),e.isReconnecting&&e._login()})),this._connectionManager.on("disconnected",(function(t){e._dataChannelSignalState=MediaConnectionState.DISCONNECTED,e.logger.warn("connectStateChange","disconnected. %o",t),e.isReconnecting&&(e.emit("onUserDisconnection"),e._clearState())})),this._connectionManager.on("connecting",(function(){var t;e.isReconnecting=!1,null==(t=e._handler)||t.destroy(),delete e._handler,e._dataChannelSignalState=MediaConnectionState.CONNECTING,e.logger.info("connectStateChange","connecting")})),this._connectionManager.on("reconnecting",(function(){var t;e.isReconnecting=!0,null==(t=e._handler)||t.destroy(),delete e._handler,e._dataChannelSignalState=MediaConnectionState.CONNECTING,e.logger.warn("connectStateChange","reconnecting")}))}},{key:"_addSignalEventHandler",value:function(){var e,t,r,n=this;null==(e=this._dataChannelSignal)||e.on(SignalEvent.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM,(function(e){n.emit("onUserMessageReceivedOutsideRoom",{userId:e.from,message:e.msg})})),null==(t=this._dataChannelSignal)||t.on(SignalEvent.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM,(function(e){n.emit("onUserBinaryMessageReceivedOutsideRoom",{userId:e.from,message:e.msg})})),null==(r=this._dataChannelSignal)||r.on(SignalEvent.USER_DISCONNECTION,(function(){n.emit("onUserDisconnection"),n._clearState()}))}},{key:"_clearState",value:function(){this._userId=null,this._token=null,this._loginSessionId=null,RTSMsgReportor.setRtsSessionId(this.id,"")}}]),c}(eventemitter3Exports.EventEmitter),AudioProfileManager=function(){function e(t){_classCallCheck(this,e),__publicField(this,"_roomId"),__publicField(this,"_constraints",{}),__publicField(this,"_profile"),__publicField(this,"_customMaxBitrate",0),this._appId=t}return _createClass(e,[{key:"setRoomId",value:function(e){this._roomId=e}},{key:"setAudioProfile",value:function(e){this._profile=e,this._customMaxBitrate=0}},{key:"customMaxBitrate",get:function(){return this._customMaxBitrate}},{key:"setCustomMaxBitrate",value:function(e){var t=sdkCache.getEngineWebConfig(this._appId,this._roomId||"").audio_encode;this._customMaxBitrate=(null==t?void 0:t.bitrate)?0:1e3*e}},{key:"getOpusConfigStr",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=sdkCache.getEngineWebConfig(this._appId,this._roomId||""),r=t.audio_encode,n=this.getConstraints(),i=n.sampleRate,o=n.channelCount,a="number"==typeof i?i:null==i?void 0:i.exact,s="number"==typeof o?o:null==o?void 0:o.exact,c={};e.split(";").forEach((function(e){var t=_slicedToArray(e.split("="),2),r=t[0],n=t[1];r&&n&&(c[r]=n)}));var u=(null==r?void 0:r.bitrate)||this._customMaxBitrate||this._getConfigByAudioProfile().bitrate;u&&(c.maxaveragebitrate=u);var l=(null==r?void 0:r.enc_sample_rate)||a;l&&(c["sprop-maxcapturerate"]=l);var d=(null==r?void 0:r.playback_rate)||a;return d&&(c.maxplaybackrate=d),(s&&s>1||(null==r?void 0:r.stereo))&&(c["sprop-stereo"]=1,c.stereo=1),(null==r?void 0:r.dtx)&&(c.usedtx=1),Object.keys(c).map((function(e){return"".concat(e,"=").concat(c[e])})).join(";")}},{key:"updateConstraints",value:function(e){this._constraints=_objectSpread2(_objectSpread2({},this._constraints),e)}},{key:"getConstraints",value:function(){var e=_objectSpread2({},this._constraints),t=sdkCache.getEngineWebConfig(this._appId,this._roomId||"").audio_capture;isUndefined$2(null==t?void 0:t.sample_rate)||(e.sampleRate=t.sample_rate),isUndefined$2(null==t?void 0:t.channel)||(e.channelCount=t.channel),isUndefined$2(null==t?void 0:t.agc)||(e.autoGainControl=t.agc),isUndefined$2(null==t?void 0:t.ans)||(e.noiseSuppression=t.ans),isUndefined$2(null==t?void 0:t.aec)||(e.echoCancellation=t.aec);var r=this._getConfigByAudioProfile(),n=r.sampleRate,i=r.channel;return isUndefined$2(e.sampleRate)&&!isUndefined$2(n)&&(e.sampleRate=n),isUndefined$2(e.channelCount)&&!isUndefined$2(i)&&(e.channelCount=i),e}},{key:"_getConfigByAudioProfile",value:function(){var e={};switch(this._profile){case AudioProfileType.fluent:e.sampleRate=16e3,e.bitrate=24e3;break;case AudioProfileType.standard:e.sampleRate=48e3,e.bitrate=48e3;break;case AudioProfileType.hd:e.sampleRate=48e3,e.bitrate=128e3,e.channel=2;break;case AudioProfileType.standardStereo:e.sampleRate=48e3,e.bitrate=8e4,e.channel=2;break;case AudioProfileType.hdMono:e.sampleRate=48e3,e.bitrate=128e3}return e}}]),e}(),OutsideRoom=function(e){_inherits(o,e);var t,r,n,i=_createSuper(o);function o(e,t,r){var n,a=r.businessId;return _classCallCheck(this,o),n=i.call(this),__publicField(_assertThisInitialized(n),"_mediaServerClient"),__publicField(_assertThisInitialized(n),"_appId"),__publicField(_assertThisInitialized(n),"remoteStreams"),__publicField(_assertThisInitialized(n),"_businessId"),__publicField(_assertThisInitialized(n),"_ctx"),n.id=e,n._appId=t,n.remoteStreams=new Map,n._businessId=a,n._ctx={id:n.id,appId:n._appId,avSync:!0,audioProfileManager:new AudioProfileManager(n._appId),useCloudProxy:!1,userPriority:new Map,joinRoomConfig:new JoinRoomConfig(n.id)},n}return _createClass(o,[{key:"connect",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._mediaServerClient=new MediaServerClient(this._ctx),this._mediaServerClient.publicStream=!0,this._businessId&&(this._mediaServerClient.businessId=this._businessId),this._bindEvents(),e.next=6,this._mediaServerClient.connect();case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"startPlayPublicStream",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.remoteStreams.get(t)){e.next=2;break}throw new SDKError(ErrorCode.REPEAT_PLAY,"repeat play public media stream");case 2:return(r=new RemoteStream(this._ctx,t,t,!1,!0,{audiostream:!0,localaudio:!0,videostream:!0,localvideo:!0,extaudio:!1,extvideo:!1,videoDescriptions:[]})).on("onSEIMessage",(function(e){if(e instanceof Uint8Array)for(var t=splitPublicStreamSei(e),i=0;i<t.seiCount;i++)n.emit(RoomEvent.ON_SEI_MESSAGED_RECEIVED,{sei:t.seis[i],publicStreamId:r.streamId})})),e.next=6,this._mediaServerClient.subscribePublicStream(r);case 6:return this.remoteStreams.set(t,r),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"stopPlayPublicStream",value:function(e){var t=this.remoteStreams.get(e);if(t)return this.remoteStreams.delete(e),this._mediaServerClient.unsubscribePublicStream(t)}},{key:"destroy",value:function(){var e;this.remoteStreams.forEach((function(e){e.clean()})),this.remoteStreams=new Map,null==(e=this._mediaServerClient)||e.destroy(),this.removeAllListeners()}},{key:"_handleReconnected",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=_createForOfIteratorHelper(this.remoteStreams);try{for(n=function(){var e=_slicedToArray(r.value,2),t=e[0],n=e[1];n.clean(),n.statsReport.unsubscribe(),i.remoteStreams.delete(t),i.startPlayPublicStream(t).then((function(){var e=i.remoteStreams.get(t);i.safeEmit(RoomEvent.RESUBSCRIBE,{stream:e})}))},t.s();!(r=t.n()).done;)n()}catch(err2){t.e(err2)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_bindEvents",value:function(){var e,t,r=this;null==(e=this._mediaServerClient)||e.on("connectSuccess",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.reconnect;t&&r._handleReconnected()})),null==(t=this._mediaServerClient)||t.on("onRemoteStreamStats",(function(e){r.emit("onRemoteStreamStats",e)}))}}]),o}(EnhancedEventEmitter),logger$2=new Logger$1$1("AudioDeviceManager",1),AudioDeviceManager=function(e){_inherits(c,e);var t,r,n,i,o,a,s=_createSuper(c);function c(e){var t;return _classCallCheck(this,c),t=s.call(this),__publicField(_assertThisInitialized(t),"_audioLevelFetcher"),__publicField(_assertThisInitialized(t),"_playbackDeviceTestTimer"),__publicField(_assertThisInitialized(t),"_audioElement"),__publicField(_assertThisInitialized(t),"_audioTrack"),__publicField(_assertThisInitialized(t),"_mediaRecorder"),__publicField(_assertThisInitialized(t),"_recoderTimer"),__publicField(_assertThisInitialized(t),"_isAudioPlaybackDeviceTesting",!1),__publicField(_assertThisInitialized(t),"_isAudioDeviceRecordTesting",!1),__publicField(_assertThisInitialized(t),"_audioCaptureAndRecoderResolve"),__publicField(_assertThisInitialized(t),"_onAutoplayFailed"),__publicField(_assertThisInitialized(t),"_audioPlaybackDeviceId"),t._extensionManager=e,t}return _createClass(c,[{key:"audioTrack",get:function(){return this._audioTrack}},{key:"startAudioPlaybackDeviceTest",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isAudioPlaybackDeviceTesting&&!this._isAudioDeviceRecordTesting){e.next=2;break}throw new SDKError(ErrorCode.REPEAT_DEVICE_TEST,"device test cannot be called repeatedly at the same time.");case 2:return this._isAudioPlaybackDeviceTesting=!0,logger$2.info("startAudioPlaybackDeviceTest()","Invoke"),e.prev=3,e.next=6,this._playAudioFile(t,{loop:!0});case 6:e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(3),logger$2.error("startAudioPlaybackDeviceTest()","error",e.t0),this.stopAudioPlaybackDeviceTest(),e.t0;case 11:this._startEmitAudioPlaybackDeviceTestVolume(r);case 12:case"end":return e.stop()}}),e,this,[[3,8]])}))),function(e,t){return a.apply(this,arguments)})},{key:"stopAudioPlaybackDeviceTest",value:function(){this._isAudioPlaybackDeviceTesting&&(logger$2.info("stopAudioPlaybackDeviceTest()","Invoke"),this._isAudioPlaybackDeviceTesting=!1,this._stopEmitAudioPlaybackDeviceTestVolume(),this._destroyAudioElement())}},{key:"startAudioDeviceRecordTest",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,o=this,a=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=a.length>3&&void 0!==a[3]?a[3]:3e4,window.MediaRecorder){e.next=3;break}throw new SDKError(ErrorCode.NOT_SUPPORTED,"Your browser does not support MediaRecorder.");case 3:if(!this._isAudioDeviceRecordTesting&&!this._isAudioPlaybackDeviceTesting){e.next=5;break}throw new SDKError(ErrorCode.REPEAT_DEVICE_TEST,"device test cannot be called repeatedly at the same time.");case 5:return this._isAudioDeviceRecordTesting=!0,logger$2.info("startAudioDeviceRecordTest()","Invoke"),this._recoderTimer=window.setTimeout((function(){logger$2.info("startAudioDeviceRecordTest()","".concat(i,'ms automatic call method "stopAudioDeviceRecordAndPlayTest"')),o._stopAudioCaptureAndRecoder()}),i),e.prev=6,this._onAutoplayFailed=r,e.next=10,this._startAudioCaptureAndRecoder(t,null!=n?n:100);case 10:e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(6),this._isAudioDeviceRecordTesting=!1,delete this._onAutoplayFailed,e.t0;case 15:delete this._audioCaptureAndRecoderResolve;case 16:case"end":return e.stop()}}),e,this,[[6,12]])}))),function(e,t,r){return o.apply(this,arguments)})},{key:"stopAudioDeviceRecordAndPlayTest",value:function(){logger$2.info("stopAudioDeviceRecordAndPlayTest()","Invoke"),void 0!==this._recoderTimer&&(clearTimeout(this._recoderTimer),delete this._recoderTimer),this._stopAudioCaptureAndRecoder()}},{key:"stopAudioDevicePlayTest",value:function(){this._isAudioDeviceRecordTesting&&(logger$2.info("stopAudioDevicePlayTest()","Invoke"),this._isAudioDeviceRecordTesting=!1,this.stopAudioDeviceRecordAndPlayTest(),this._stopEmitAudioPlaybackDeviceTestVolume(),this._destroyAudioElement()),delete this._onAutoplayFailed}},{key:"getRecordTrack",value:function(){return this._audioTrack}},{key:"setSinkId",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(logger$2.info("setSinkId()","Invoke"),void 0!==HTMLAudioElement.prototype.setSinkId){e.next=2;break}throw new SDKError(ErrorCode.NOT_SUPPORTED,"setSinkId not supported by current browser");case 2:return e.next=4,dd$1.getDeviceById(t);case 4:if(r=e.sent){e.next=7;break}throw new SDKError(ErrorCode.INVALID_DEVICE_ID,"audio playback device id ".concat(t," is invalid"));case 7:return e.abrupt("return",(this._audioPlaybackDeviceId=t,this._setAudioCtxSinkId(),r));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getSinkId",value:function(){return this._audioPlaybackDeviceId}},{key:"destroy",value:function(){logger$2.info("destroy()","Invoke"),_get(_getPrototypeOf(c.prototype),"removeAllListeners",this).call(this),this.stopAudioPlaybackDeviceTest(),this.stopAudioDevicePlayTest()}},{key:"_playAudioFile",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(logger$2.info("_playAudioFile()","Invoke url=".concat(t,"; loop=").concat(r.loop)),new Promise((function(e,i){var o=createElement("audio",{attributes:{src:t,crossOrigin:"anonymous"}});n._audioElement=o,o.loop=r.loop,n._audioLevelFetcher=new AudioLevelFetcher(o),o.onplaying=function(){o.onplaying=null,logger$2.info("_playAudioFile()","onplaying"),e()},o.onerror=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:logger$2.error("_playAudioFile()","onerror",t),n=t.message||(null==(r=null==o?void 0:o.error)?void 0:r.message),i(new SDKError(ErrorCode.LOAD_RESOURCES_FAILED,"Failed to play recorded audio"+(n?", reason: ".concat(n):".")));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n._setAudioCtxSinkId().then((function(){var e,t;return null==(t=null==(e=o.play())?void 0:e.catch)?void 0:t.call(e,(function(e){logger$2.warn("_playAudioFile()","autoplay error",e);var t="Failed to play recorded audio, ".concat(e.name,": ").concat(e.message);"NotAllowedError"===e.name&&n._onAutoplayFailed?n._onAutoplayFailed((function(){var e;return Promise.all([null==(e=n._audioLevelFetcher)?void 0:e.resume(),o.play()])})):i(new SDKError(ErrorCode.LOAD_RESOURCES_FAILED,t))}))}))}))));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"_destroyAudioElement",value:function(){this._audioElement&&(logger$2.info("_destroyAudioElement()","Invoke"),this._audioElement.onplaying=null,this._audioElement.onerror=null,this._audioElement.src="",delete this._audioElement,"function"==typeof this._audioCaptureAndRecoderResolve&&this._audioCaptureAndRecoderResolve())}},{key:"_startEmitAudioPlaybackDeviceTestVolume",value:function(e){var t=this;e=Math.max(e,100),this._audioElement&&(logger$2.info("_startEmitAudioPlaybackDeviceTestVolume()","start timer(".concat(e,"ms)")),this._playbackDeviceTestTimer=self.setInterval((function(){t._audioLevelFetcher&&t.emit("onAudioPlaybackDeviceTestVolume",t._audioLevelFetcher.getAudioLevel())}),e))}},{key:"_stopEmitAudioPlaybackDeviceTestVolume",value:function(){var e;void 0!==this._playbackDeviceTestTimer&&(logger$2.info("_stopEmitAudioPlaybackDeviceTestVolume()","stop timer"),self.clearInterval(this._playbackDeviceTestTimer),delete this._playbackDeviceTestTimer),null==(e=this._audioLevelFetcher)||e.destroy(),delete this._audioLevelFetcher}},{key:"_startAudioCaptureAndRecoder",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,createMicrophoneAudioTrack({},this._extensionManager);case 2:return this._audioTrack=e.sent,this._audioTrack.setVolume(r+.01),n=new MediaStream([this._audioTrack.preprocessingTrack]),e.abrupt("return",(logger$2.info("startAudioDeviceRecordTest()","create microphone track success!"),new Promise((function(e,r){var o;"function"==typeof MediaRecorder.isTypeSupported&&(o=["audio/webm","audio/mp4"].find((function(e){return MediaRecorder.isTypeSupported(e)})),logger$2.info("startAudioDeviceRecordTest()","use mimeType: ".concat(o))),i._mediaRecorder=new MediaRecorder(n,o?{mimeType:o}:void 0);var a=i._mediaRecorder.mimeType;i._mediaRecorder.ondataavailable=function(){var n=_asyncToGenerator(_regeneratorRuntime().mark((function n(o){var s,c;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!i._isAudioDeviceRecordTesting){n.next=14;break}return logger$2.info("startAudioDeviceRecordTest()","get recorded file(mimeType: ".concat(a,").")),c=new Blob([o.data],{type:a}),n.prev=3,n.next=6,i._playAudioFile(URL.createObjectURL(c),{loop:!1});case 6:n.next=11;break;case 8:return n.prev=8,n.t0=n.catch(3),n.abrupt("return",r(n.t0));case 11:i._startEmitAudioPlaybackDeviceTestVolume(t),null==(s=i._audioElement)||s.addEventListener("ended",(function(){i.stopAudioDevicePlayTest(),e()})),i._audioCaptureAndRecoderResolve=e,n.next=15;break;case 14:e();case 15:case"end":return n.stop()}}),n,null,[[3,8]])})));return function(e){return n.apply(this,arguments)}}(),i._mediaRecorder.onerror=function(e){r(new SDKError(ErrorCode.AUDIO_DEVICE_TEST_FAILED,e.message||"mediaRecorder error"))},i._audioCaptureAndRecoderResolve=e,i._mediaRecorder.start()}))));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"_stopAudioCaptureAndRecoder",value:function(){var e;this._mediaRecorder&&("recording"===this._mediaRecorder.state&&this._mediaRecorder.stop(),delete this._mediaRecorder),null==(e=this._audioTrack)||e.close(),delete this._audioTrack}},{key:"_setAudioCtxSinkId",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._audioPlaybackDeviceId){"default"===n&&(n="");try{null==(r=null==(t=audioContextManager.getAudioContextInstance())?void 0:t.setSinkId)||r.call(t,n),logger$2.info("setSinkId","ctx.sinkId=".concat(n))}catch(i){logger$2.error("setSinkId","failed, ".concat(i.name," - ").concat(i.message))}}case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),c}(eventemitter3Exports.EventEmitter),logger$1=new Logger$1$1("VideoSnapshot",1),getPlayingVideoDom=function(e){var t=null==e?void 0:e.domElement;if(t&&!t.paused&&4===t.readyState)return t},takeSnapshot=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,o,a,s,c,u,l,d;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=document.createElement("canvas"),o=i.getContext("2d")){e.next=3;break}throw new Error("canvas.getContext error");case 3:if(a=function(e,t,n){return t=t||e.width,n=n||e.height,i.width=t,i.height=n,r?o.setTransform(-1,0,0,1,t,0):o.setTransform(1,0,0,1,0,0),o.drawImage(e,0,0,t,n),o.getImageData(0,0,t,n)},s=Date.now(),!(c=getPlayingVideoDom(n))){e.next=10;break}return logger$1.info("takeSnapshot","VideoPlayer already set."),e.next=8,a(c,c.videoWidth,c.videoHeight);case 8:return u=e.sent,e.abrupt("return",(logger$1.info("takeSnapshot","success, cost ".concat(Date.now()-s,"ms")),u));case 10:if(!window.ImageCapture){e.next=22;break}if("live"!==(l=new window.ImageCapture(t)).track.readyState||!l.track.enabled||l.track.muted){e.next=22;break}return logger$1.info("takeSnapshot","use ImageCapture"),e.t0=a,e.next=17,l.grabFrame();case 17:return e.t1=e.sent,e.next=20,(0,e.t0)(e.t1);case 20:return d=e.sent,e.abrupt("return",(logger$1.info("takeSnapshot","success, cost ".concat(Date.now()-s,"ms")),d));case 22:return e.abrupt("return",(logger$1.info("takeSnapshot","use temp video"),new Promise((function(e,r){var n=new MediaStream([t]),i=document.createElement("video");i.setAttribute("playsinline",""),i.muted=!0,document.body.appendChild(i),i.onplaying=function(){var r=a(i,i.videoWidth,i.videoHeight);logger$1.info("takeSnapshot","success, cost ".concat(Date.now()-s,"ms")),e(r),n.removeTrack(t),i.srcObject=null,i.load()},i.onerror=r,i.srcObject=n,i.play()}))));case 23:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),getDefaultValue=function(){return{url:"",video:{codec:TRANSCODING_VIDEO_CODEC.H264,width:640,height:360,fps:15,gop:2,kBitRate:getKBitRate(640,360,15)},audio:{codec:"AAC",kBitRate:64,sampleRate:48e3,channels:2,AACProfile:AAC_PROFILE.LC},layout:{regions:[],appData:"",backgroundColor:"#000000"}}};function getKBitRate(e,t,r){return e*t<=288e3?r<=15?800:1200:e*t<=864e3?r<=15?1200:1800:e*t<=1152e3?r<=15?1600:2400:e*t<=2592e3?r<=15?2500:3750:r<=15?3300:5e3}function checkRtmpUrl(e){if("string"!=typeof e||!/^rtmps?:\/\//.test(e))throw new SDKError(ErrorCode.INVALID_PARAMS,"Invalid rtmp address")}function checkTranscodeRegions(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!(null==e?void 0:e.length))throw new SDKError(ErrorCode.INVALID_PARAMS,"regions should not be empty.");var t,r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if("string"!=typeof n.userId)throw new SDKError(ErrorCode.INVALID_PARAMS,"region.userId(".concat(n.userId,") should be a string."));if("boolean"!=typeof n.isScreenStream)throw new SDKError(ErrorCode.INVALID_PARAMS,"region.isScreenStream(".concat(n.isScreenStream,") should be a boolean."))}}catch(err2){r.e(err2)}finally{r.f()}}function getTranscodeControlMessage(e,t){var r,n,i,o=function(e,r){var n=e.reduce((function(e,t){return null==e?void 0:e[t]}),t),i=e.reduce((function(e,t){return null==e?void 0:e[t]}),getDefaultValue());return n&&r(n)?n:i},a=function(e){return e%2==0?e:e+1},s=a(o(["video","width"],(function(e){return e>=2&&e<=1920}))),c=a(o(["video","height"],(function(e){return e>=2&&e<=1920}))),u=o(["video","fps"],(function(e){return e>=1&&e<=60})),l=(null==(r=t.video)?void 0:r.kBitRate)||0,d=o(["audio","sampleRate"],(function(e){return!![32e3,44100,48e3].find((function(t){return t===e||t/1e3===e}))}));return{type:"transcode",action:e,transcodeMeta:{transcode:{url:t.url},control:{protocol:"2.0"},audio:{codec:o(["audio","codec"],(function(e){return"AAC"===e})),bitRate:1e3*o(["audio","kBitRate"],(function(e){return e>=32&&e<=192})),sampleRate:d<100?1e3*d:d,channels:o(["audio","channels"],(function(e){return[1,2].includes(e)})),profile:o(["audio","AACProfile"],(function(e){return[AAC_PROFILE.LC,AAC_PROFILE.HEv1,AAC_PROFILE.HEv2].includes(e)}))},video:{codec:o(["video","codec"],(function(e){return["H264","H265"].includes(e)})),fps:u,gop:o(["video","gop"],(function(e){return e>=1&&e<=5}))*u,bitRate:1e3*(l>=16&&l<=1e4?l:getKBitRate(s,c,u)),width:s,height:c},layout:{canvas:{bgnd:o(["layout","backgroundColor"],(function(e){return/^#([0-9a-fA-F]{6}|[0-9a-fA-F]{3})$/.test(e)}))},regions:(null==(i=null==(n=t.layout)?void 0:n.regions)?void 0:i.map((function(e){return{alpha:!e.alpha||Number(e.alpha)>1||Number(e.alpha)<=0?1:Number(e.alpha),uid:e.userId,zorder:!e.zorder||Number(e.zorder)<0||Number(e.zorder)>100?0:Number(e.zorder),x:!e.x||Number(e.x)>=1||Number(e.x)<0?0:Number(e.x),y:!e.y||Number(e.y)>=1||Number(e.y)<0?0:Number(e.y),w:!e.w||Number(e.w)>1||Number(e.w)<=0?1:Number(e.w),h:!e.h||Number(e.h)>1||Number(e.h)<=0?1:Number(e.h),renderMode:e.renderMode&&[1,2,3].includes(e.renderMode)?e.renderMode:1,contentControl:e.contentControl&&[0,1,2].includes(e.contentControl)?e.contentControl:0,screen:!!e.isScreenStream}})))||[],app_data:o(["layout","appData"],(function(e){return"string"==typeof e}))}}}}function checkStartParams(e){var t;checkRtmpUrl(e.url),checkTranscodeRegions(null==(t=e.layout)?void 0:t.regions)}function checckUpdateParams(e){var t;e.url&&checkRtmpUrl(e.url),checkTranscodeRegions(null==(t=e.layout)?void 0:t.regions)}function getStartParams(e){return getTranscodeControlMessage("started",e)}function getUpdateParams(e){return getTranscodeControlMessage("layoutChanged",e)}var LiveTranscoding={getDefaultValue:getDefaultValue,checkStartParams:checkStartParams,checckUpdateParams:checckUpdateParams,getStartParams:getStartParams,getUpdateParams:getUpdateParams},remoteAudioReplayTimer,MEDIA_STATES=["currentTime","duration","ended","error","muted","networkState","paused","readyState","seekable","sinkId","src","volume"],AUDIOCONTEXT_STATES=["currentTime","sampleRate","state","baseLatency","outputLatency","sinkId"],TRACK_STATES=["contentHint","enabled","id","kind","label","muted","readyState"],TRANSCEIVER_STATES=["currentDirection","direction","mid","stopped"],ac;function getStats(e){return _getStats.apply(this,arguments)}function _getStats(){return _getStats=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Date.now(),n=[],e.t0=t&&t._room&&t._room._mediaServerClient&&t._room._mediaServerClient._handler&&t._room._mediaServerClient._handler._peerConnection,!e.t0){e.next=7;break}return e.next=6,t._room._mediaServerClient._handler._peerConnection.getStats();case 6:n=e.sent;case 7:return i=[],e.abrupt("return",(n.forEach((function(e){i.push(e)})),{timestamp:r,stats:i}));case 9:case"end":return e.stop()}}),e)}))),_getStats.apply(this,arguments)}function formatSrcObject(e){var t={};if(e instanceof MediaStream){t.id=e.id,t.active=e.active;var r=e.getTracks();t.tracks=r.map((function(e){return Object.fromEntries(TRACK_STATES.map((function(t){return[t,e[t]]})))}))}return t}function getMediaElementState(e){return _getMediaElementState.apply(this,arguments)}function _getMediaElementState(){return _getMediaElementState=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Date.now(),n=[],t._videoPlayer&&n.push({userId:"__local__",mediaType:"video",isScreen:!1,isPublic:!1,ele:t._videoPlayer._videoDom}),t._screenPlayer&&n.push({userId:"__local__",mediaType:"video",isScreen:!0,isPublic:!1,ele:t._screenPlayer._videoDom}),t._remoteVideoPlayer.forEach((function(e,t){n.push({userId:t,mediaType:"video",isScreen:!1,isPublic:!1,ele:e?e._videoDom:void 0})})),t._remoteScreenPlayer.forEach((function(e,t){n.push({userId:t,mediaType:"video",isScreen:!0,isPublic:!1,ele:e?e._videoDom:void 0})})),t._remoteAudioPlayer.forEach((function(e,t){n.push({userId:t,mediaType:"audio",isScreen:!1,isPublic:!1,ele:e?e._audioDom:void 0,fakeEle:e?e._fakeAudioDom:void 0})})),t._remoteScreenAudioPlayer&&t._remoteScreenAudioPlayer.forEach((function(e,t){n.push({userId:t,mediaType:"audio",isScreen:!0,isPublic:!1,ele:e?e._audioDom:void 0,fakeEle:e?e._fakeAudioDom:void 0})})),t._publicStreamVideoPlayer&&t._publicStreamVideoPlayer.forEach((function(e,t){n.push({userId:t,mediaType:"video",isScreen:!1,isPublic:!0,ele:e?e._videoDom:void 0})})),t._publicStreamAudioPlayer&&t._publicStreamAudioPlayer.forEach((function(e,t){n.push({userId:t,mediaType:"audio",isScreen:!1,isPublic:!0,ele:e?e._audioDom:void 0,fakeEle:e?e._fakeAudioDom:void 0})})),e.abrupt("return",{timestamp:r,elementStats:n.map((function(e){var t=e.ele,r=e.fakeEle,n=_objectWithoutProperties(e,_excluded3$1),i=_objectSpread2({ele:_objectSpread2({srcObject:t?formatSrcObject(t.srcObject):void 0},Object.fromEntries(MEDIA_STATES.map((function(e){return[e,t[e]]}))))},n);return r&&(i.fakeEle=_objectSpread2({srcObject:formatSrcObject(r.srcObject)},Object.fromEntries(MEDIA_STATES.map((function(e){return[e,r[e]]}))))),i}))});case 3:case"end":return e.stop()}}),e)}))),_getMediaElementState.apply(this,arguments)}function findAudioContextInEngine(e){var t=[],r=[];e&&e._room&&e._room._remoteStreams&&(r=e._room._remoteStreams.values());var n,i=_createForOfIteratorHelper(r);try{for(i.s();!(n=i.n()).done;){n.value.forEach((function(e){e.audioTrack&&t.push(e.audioTrack)}))}}catch(err2){i.e(err2)}finally{i.f()}e._localAudioTrack&&t.push(e._localAudioTrack),e._localScreenAudioTrack&&t.push(e._localScreenAudioTrack);for(var o=0,a=t;o<a.length;o++){var s=a[o];if(s._audioLevelFetcher&&s._audioLevelFetcher._ctx)return s._audioLevelFetcher._ctx;if(s._ac)return s._ac;if(s._audioFetchMap&&Array.from(s._audioFetchMap.values()).length)return Array.from(s._audioFetchMap.values())[0]._ctx;if(s._ap&&s._ap._ac)return s._ap._ac}return null}function getAudioContextState(e){return _getAudioContextState.apply(this,arguments)}function _getAudioContextState(){return _getAudioContextState=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Date.now(),n=findAudioContextInEngine(t),i={},e.abrupt("return",n?(AUDIOCONTEXT_STATES.forEach((function(e){i[e]=n[e]})),{timestamp:r,acState:i}):{timestamp:r,acState:void 0});case 2:case"end":return e.stop()}}),e)}))),_getAudioContextState.apply(this,arguments)}function getTrack(e){var t=[];e._localAudioTrack&&t.push({userId:"__local__",mediaType:"audio",isScreen:!1,isPublic:!1,isVirtual:!1,orgTrack:e._localAudioTrack._originTrack,mediaTrack:e._localAudioTrack._mediaTrack,preprocessingTrack:e._localAudioTrack._preProcessingTrack}),e._localScreenAudioTrack&&t.push({userId:"__local__",mediaType:"audio",isScreen:!0,isPublic:!1,isVirtual:!1,orgTrack:e._localScreenAudioTrack._originTrack,mediaTrack:e._localScreenAudioTrack._mediaTrack,preprocessingTrack:e._localScreenAudioTrack._preProcessingTrack}),e._localVideoTrack&&t.push({userId:"__local__",mediaType:"video",isScreen:!1,isPublic:!1,isVirtual:!1,orgTrack:e._localVideoTrack._originTrack,mediaTrack:e._localVideoTrack._mediaTrack,preprocessingTrack:e._localVideoTrack._preProcessingTrack}),e._localScreenVideoTrack&&t.push({userId:"__local__",mediaType:"video",isScreen:!0,isPublic:!1,isVirtual:!1,orgTrack:e._localScreenVideoTrack._originTrack,mediaTrack:e._localScreenVideoTrack._mediaTrack,preprocessingTrack:e._localScreenVideoTrack._preProcessingTrack}),e._room&&e._room._remoteStreams&&e._room._remoteStreams.forEach((function(e,r){e.forEach((function(e){e.audioTrack&&t.push({userId:r,mediaType:"audio",isScreen:e.isScreen,isPublic:!1,isVirtual:!1,orgTrack:e.audioTrack._originTrack,mediaTrack:e.audioTrack._mediaTrack}),e.videoTrack&&t.push({userId:r,mediaType:"video",isScreen:e.isScreen,isPublic:!1,isVirtual:!1,orgTrack:e.videoTrack._originTrack,mediaTrack:e.videoTrack._mediaTrack})}))}));var r=e._publicStreamManager;return r||(r=e._outsideRoom),r&&r.remoteStreams.forEach((function(e,r){e.audioTrack&&t.push({userId:r,mediaType:"audio",isScreen:e.isScreen,isPublic:!0,isVirtual:!1,orgTrack:e.audioTrack._originTrack,mediaTrack:e.audioTrack._mediaTrack}),e.videoTrack&&t.push({userId:r,mediaType:"video",isScreen:e.isScreen,isPublic:!0,isVirtual:!1,orgTrack:e.videoTrack._originTrack,mediaTrack:e.videoTrack._mediaTrack})})),e&&e._room&&e._room._virtualStreams&&e._room._virtualStreams.forEach((function(e,r){e.audioTrack&&t.push({userId:"virtualStream-".concat(r),mediaType:"audio",isScreen:!1,isPublic:!1,isVirtual:!0,orgTrack:e.audioTrack._originTrack,mediaTrack:e.audioTrack._mediaTrack}),e.videoTrack&&t.push({userId:"virtualStream-".concat(r),mediaType:"video",isScreen:!1,isPublic:!1,isVirtual:!0,orgTrack:e.videoTrack._originTrack,mediaTrack:e.videoTrack._mediaTrack})})),t}function getVolumeFromTrack(e,t){return _getVolumeFromTrack.apply(this,arguments)}function _getVolumeFromTrack(){return _getVolumeFromTrack=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return(n=new MediaStream).addTrack(t),i=r.createMediaStreamSource(n),o=r.createAnalyser(),i.connect(o),"suspended"===r.state&&(console.warn(r.state),r.resume()),a=new Uint8Array(2048),o.getByteTimeDomainData(a),e.next=10,new Promise((function(e){setTimeout(e,50)}));case 10:return o.getByteTimeDomainData(a),e.next=13,new Promise((function(e){setTimeout(e,50)}));case 13:return s=0,a.forEach((function(e){return s=Math.max(s,Math.abs(e-128))})),u=(c=s/128*256)>2?c:0,e.abrupt("return",(i.disconnect(),o.disconnect(),u));case 17:case"end":return e.stop()}}),e)}))),_getVolumeFromTrack.apply(this,arguments)}function getVolume(e){return _getVolume.apply(this,arguments)}function _getVolume(){return _getVolume=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Date.now(),ac||(ac=new AudioContext),e.t0="suspended"===ac.state,!e.t0){e.next=6;break}return e.next=6,new Promise((function(e){var r=setTimeout((function(){console.warn("[RTC_AMBULANCE] AudioContext resume failed, try to find one in RTCEngine"),(ac=findAudioContextInEngine(t))&&console.warn("[RTC_AMBULANCE] find AudioContext in RTCEngine success"),e()}),1e3);ac.resume().then((function(){clearTimeout(r),e()}),(function(){clearTimeout(r),ac=null,e()}))}));case 6:if(ac){e.next=8;break}return e.abrupt("return",void console.error("[RTC_AMBULANCE] get volume is not supported"));case 8:return n=getTrack(t),i=[],e.next=11,Promise.all(n.filter((function(e){return"audio"===e.mediaType})).map(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,o,a,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.orgTrack,n=t.mediaTrack,o=t.preprocessingTrack,a=_objectWithoutProperties(t,_excluded4$1),s=_objectSpread2({},a),e.next=4,Promise.all([getVolumeFromTrack(r,ac).then((function(e){s.orgTrackVolume=e})),getVolumeFromTrack(n,ac).then((function(e){s.mediaTrackVolume=e})),getVolumeFromTrack(o,ac).then((function(e){s.preprocessingTrackVolume=e}))]);case 4:i.push(s);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return e.abrupt("return",{timestamp:r,trackVolumes:i});case 12:case"end":return e.stop()}}),e)}))),_getVolume.apply(this,arguments)}function getTrackState(e){return _getTrackState.apply(this,arguments)}function _getTrackState(){return _getTrackState=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{timestamp:Date.now(),trackStates:getTrack(t).map((function(e){var t=e.orgTrack,r=e.mediaTrack,n=e.preprocessingTrack,i=_objectWithoutProperties(e,_excluded5$1);return _objectSpread2({orgTrack:t?Object.fromEntries(TRACK_STATES.map((function(e){return[e,t[e]]}))):void 0,mediaTrack:r?Object.fromEntries(TRACK_STATES.map((function(e){return[e,r[e]]}))):void 0,preprocessingTrack:n?Object.fromEntries(TRACK_STATES.map((function(e){return[e,n[e]]}))):void 0},i)}))});case 1:case"end":return e.stop()}}),e)}))),_getTrackState.apply(this,arguments)}function formatSenderOrReceiver(e){if(e){var t={track:e.track?e.track.id:void 0,transport:{state:e.transport?e.transport.state:void 0}};return e.transport&&e.transport.iceTransport&&(t.iceTransport={state:e.transport.iceTransport.state,role:e.transport.iceTransport.role,gatheringState:e.transport.iceTransport.gatheringState,component:e.transport.iceTransport.component}),t}}function getTranceiverState(e){return _getTranceiverState.apply(this,arguments)}function _getTranceiverState(){return _getTranceiverState=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Date.now(),n=[],t._room&&t._room._mediaServerClient&&t._room._mediaServerClient._handler&&t._room._mediaServerClient._handler._peerConnection&&(n=t._room._mediaServerClient._handler._peerConnection.getTransceivers()),i=[],e.abrupt("return",(n.forEach((function(e){var t=_objectSpread2({sender:formatSenderOrReceiver(e.sender),receiver:formatSenderOrReceiver(e.receiver)},Object.fromEntries(TRANSCEIVER_STATES.map((function(t){return[t,e[t]]}))));i.push(t)})),{timestamp:r,tranceiverStates:i}));case 5:case"end":return e.stop()}}),e)}))),_getTranceiverState.apply(this,arguments)}function _ambulance2(e){return _ambulance.apply(this,arguments)}function _ambulance(){return _ambulance=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={stats:[],mediaElementStates:[],audioContextStates:[],volumes:[],trackStates:[],tranceiverStates:[]},n=[],e.next=3,new Promise((function(e){var i,o=0;i=setTimeout((function a(){n.push(getStats(t).then((function(e){r.stats.push(e)})),getMediaElementState(t).then((function(e){r.mediaElementStates.push(e)})),getAudioContextState(t).then((function(e){r.audioContextStates.push(e)})),getVolume(t).then((function(e){r.volumes.push(e)})),getTrackState(t).then((function(e){r.trackStates.push(e)})),getTranceiverState(t).then((function(e){r.tranceiverStates.push(e)}))),++o>=10?Promise.all(n).then((function(){e()})):(clearTimeout(i),i=setTimeout(a,500))}),500)}));case 3:return console.log("RTC_AMBULANCE",r),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)}))),_ambulance.apply(this,arguments)}var __defProp$1$1=Object.defineProperty,__getOwnPropDesc$1=Object.getOwnPropertyDescriptor,__decorateClass$1=function(e,t,r,n){for(var i,o=n>1?void 0:n?__getOwnPropDesc$1(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&__defProp$1$1(t,r,o),o},RTCEngine$1=function(e){_inherits(ke,e);var t,r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R,C,k,I,A,O,M,P,w,D,N,x,L,$,B,U,F,V,G,j,K,H,z,Y,W,q,X,J,Z,Q,ee,te,re,ne,ie,oe,ae,se,ce,ue,le,de,pe,_e,he,fe,me,ge,ve,ye,Se,Ee,Te,be,Re,Ce=_createSuper(ke);function ke(e,t,r){var n;return _classCallCheck(this,ke),n=Ce.call(this),__publicField(_assertThisInitialized(n),"monitor"),__publicField(_assertThisInitialized(n),"logger"),__publicField(_assertThisInitialized(n),"_room"),__publicField(_assertThisInitialized(n),"_publicStreamManager"),__publicField(_assertThisInitialized(n),"_appId"),__publicField(_assertThisInitialized(n),"_businessId"),__publicField(_assertThisInitialized(n),"_visibility",!0),__publicField(_assertThisInitialized(n),"_localVideoTrack"),__publicField(_assertThisInitialized(n),"_localAudioTrack"),__publicField(_assertThisInitialized(n),"_localImgVideoTrack"),__publicField(_assertThisInitialized(n),"_localImgScreenTrack"),__publicField(_assertThisInitialized(n),"_localScreenVideoTrack"),__publicField(_assertThisInitialized(n),"_localScreenAudioTrack"),__publicField(_assertThisInitialized(n),"_tempMixingAudioTrack"),__publicField(_assertThisInitialized(n),"_localAudioVolume",100),__publicField(_assertThisInitialized(n),"_localScreenAudioVolume",100),__publicField(_assertThisInitialized(n),"_remoteAudioVolume",new Map),__publicField(_assertThisInitialized(n),"_remoteScreenAudioVolume",new Map),__publicField(_assertThisInitialized(n),"_publicAudioVolume",new Map),__publicField(_assertThisInitialized(n),"_videoPlayer"),__publicField(_assertThisInitialized(n),"_screenPlayer"),__publicField(_assertThisInitialized(n),"_remoteVideoPlayer",new Map),__publicField(_assertThisInitialized(n),"_remoteScreenPlayer",new Map),__publicField(_assertThisInitialized(n),"_remoteAudioPlayer",new Map),__publicField(_assertThisInitialized(n),"_remoteScreenAudioPlayer",new Map),__publicField(_assertThisInitialized(n),"_publicStreamAudioPlayer",new Map),__publicField(_assertThisInitialized(n),"_publicStreamVideoPlayer",new Map),__publicField(_assertThisInitialized(n),"_publicStreamIds",new Map),__publicField(_assertThisInitialized(n),"_roomConfig"),__publicField(_assertThisInitialized(n),"_videoStreamConstraints",_objectSpread2({},defaultVideoEncoderConfig)),__publicField(_assertThisInitialized(n),"_audioStreamConstraints",{}),__publicField(_assertThisInitialized(n),"_enableSimulcast",!1),__publicField(_assertThisInitialized(n),"_videoStreamEncodeConfig",[_objectSpread2({},defaultVideoEncoderConfig)]),__publicField(_assertThisInitialized(n),"_screenStreamEncodeConfig",[_objectSpread2({},defaultScreenEncoderConfig)]),__publicField(_assertThisInitialized(n),"_dummyMainImage"),__publicField(_assertThisInitialized(n),"_dummyScreenImage"),__publicField(_assertThisInitialized(n),"_trackSourceType"),__publicField(_assertThisInitialized(n),"_liveTranscodeConfig"),__publicField(_assertThisInitialized(n),"_startCloudProxyTimestamp"),__publicField(_assertThisInitialized(n),"_localVideoDeviceId"),__publicField(_assertThisInitialized(n),"_localAudioDeviceId"),__publicField(_assertThisInitialized(n),"_pauseAllSubscribeState",{audio:void 0,video:void 0,resumeStreamIds:{}}),__publicField(_assertThisInitialized(n),"_audioVolumeIndicationTimer"),__publicField(_assertThisInitialized(n),"_dummyMainTimer"),__publicField(_assertThisInitialized(n),"_dummyScreenTimer"),__publicField(_assertThisInitialized(n),"_audioPropertiesReportTimer",null),__publicField(_assertThisInitialized(n),"_mirrorType",MirrorType.MIRROR_TYPE_RENDER),__publicField(_assertThisInitialized(n),"_audioMixingManager"),__publicField(_assertThisInitialized(n),"_pubLock"),__publicField(_assertThisInitialized(n),"_subLocks"),__publicField(_assertThisInitialized(n),"_audioCaptureLock"),__publicField(_assertThisInitialized(n),"_videoCaptureLock"),__publicField(_assertThisInitialized(n),"_screenCaptureLock"),__publicField(_assertThisInitialized(n),"_subScreenLocks"),__publicField(_assertThisInitialized(n),"_rtmClient"),__publicField(_assertThisInitialized(n),"_messageStatisticsObserver"),__publicField(_assertThisInitialized(n),"_tempRoomInfo"),__publicField(_assertThisInitialized(n),"_originIceConfigRequestUrls"),__publicField(_assertThisInitialized(n),"_originConfigServerUrls"),__publicField(_assertThisInitialized(n),"_originLogServerUrl"),__publicField(_assertThisInitialized(n),"_extensionManager"),__publicField(_assertThisInitialized(n),"_audioDeviceManager"),__publicField(_assertThisInitialized(n),"_remoteVideoConfig",new Map),__publicField(_assertThisInitialized(n),"_config"),__publicField(_assertThisInitialized(n),"_needClosePreTrack",!1),__publicField(_assertThisInitialized(n),"_ctx"),__publicField(_assertThisInitialized(n),"_updateMixAudioTrack",function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,i,o=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]?o[1]:AudioMixingType.PLAYOUT_AND_PUBLISH,n.logger.info("_updateMixAudioTrack()"),!n._localAudioTrack){e.next=10;break}if(t?(n._localAudioTrack.mixType=r,n._localAudioTrack.mixedAudioTrack=t):(delete n._localAudioTrack.mixType,delete n._localAudioTrack.mixedAudioTrack),e.t0=null==(i=n._room)?void 0:i.hasPublished,!e.t0){e.next=8;break}return e.next=8,n._updatePublish();case 8:e.next=11;break;case 10:t&&(n._tempMixingAudioTrack={track:t,type:r});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),__publicField(_assertThisInitialized(n),"_onAudioMixingMessage",(function(e){n.safeEmit(EngineEventsTypes.onAudioMixingStateChanged,e)})),__publicField(_assertThisInitialized(n),"_onAudioMixingAutoplayFailed",(function(e){n.safeEmit(EngineEventsTypes.onAutoplayFailed,e)})),n.id=t,n._appId=e,n._pubLock=new PromiseLock2("pubLock"),n._subLocks=new Map,n._subScreenLocks=new Map,n._audioCaptureLock=new PromiseLock2("audioCap"),n._videoCaptureLock=new PromiseLock2("videoCap"),n._screenCaptureLock=new PromiseLock2("screenCap"),n._addDeviceEventHandler(),n._extensionManager=new ExtensionManager(t),n._audioDeviceManager=new AudioDeviceManager(n._extensionManager),n._audioMixingManager=new AudioMixingManager({getLocalAudioTrack:function(){return n._localAudioTrack},updateLocalAudioTrack:n._updateMixAudioTrack,emitMessage:n._onAudioMixingMessage,onAutoPlayFailed:n._onAudioMixingAutoplayFailed},t),n._ctx={id:t,appId:e,avSync:!0,streamRTT:{},useCloudProxy:!1,audioProfileManager:new AudioProfileManager(e),userPriority:new Map,expectedIDC:null==r?void 0:r.expectedIDC,joinRoomConfig:new JoinRoomConfig(t)},window.__rtc_engine__=_assertThisInitialized(n),window["__rtc_engine__".concat(Math.floor(100*Math.random()+1))]=_assertThisInitialized(n),n._trackSourceType={video:VideoSourceType.VIDEO_SOURCE_TYPE_INTERNAL,screenVideo:VideoSourceType.VIDEO_SOURCE_TYPE_INTERNAL,audio:AudioSourceType.AUDIO_SOURCE_TYPE_INTERNAL,screenAudio:AudioSourceType.AUDIO_SOURCE_TYPE_INTERNAL},n._config=r,n._rtmClient=new RTMClient(n._ctx),n._handleRTMClient(n._rtmClient),n._handleAudioDeviceManager(),n._messageStatisticsObserver=new MessageStatisticsObserver(t),n.monitor=getMonitor(t),n.logger=new Logger$1$1("Engine",0,t),RTSMsgReportor.createRTSMsgReportor(n.id),n._getServerConfig(),n.monitor.reportLongString("NativeDetector",JSON.stringify(detectorResults)),n}return _createClass(ke,[{key:"appId",get:function(){return this._appId},set:function(e){this._appId=e}},{key:"updateToken",value:(Re=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updateToken()","token: %s",t),checkString(t,"token"),!this.waitForNewToken||!this._tempRoomInfo){e.next=6;break}return r=this._tempRoomInfo,n=r.config,i=r.userInfo,o=r.roomId,delete this._tempRoomInfo,e.next=5,this.joinRoom(t,o,i,n);case 5:return e.abrupt("return",e.sent);case 6:if(this._room){e.next=8;break}throw new SDKError(ErrorCode.UPDATE_TOKEN_BEFORE_JOIN,"update token before join room");case 8:return e.next=10,this._room.updateToken(t);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return Re.apply(this,arguments)})},{key:"setVideoCaptureDevice",value:(be=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("setVideoCaptureDevice()","deviceId: %s",t),checkString(t,"deviceId"),this._localVideoDeviceId=t,this._localVideoTrack){e.next=2;break}return e.abrupt("return");case 2:if(!isWeChat||!isAndroid){e.next=5;break}if(this._localVideoTrack.originTrack.getSettings().deviceId!==t){e.next=5;break}return e.abrupt("return");case 5:return o=assignIn$1({},this._videoStreamConstraints),"user"===t||"environment"===t||"left"===t||"right"===t?(delete o.deviceId,o.facingMode=t):!isDingTalk||isIOS?o.deviceId={exact:t}:delete o.deviceId,isAndroid&&isChrome&&chromeVersion>=85&&chromeVersion<=91&&(null==(r=this._videoPlayer)||r.removeTrack()),this._needClosePreTrack=this._needClosePreTrack||isAndroid&&isChrome,this._needClosePreTrack&&(this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close(),delete this._localVideoTrack),this.logger.info("setVideoCaptureDevice()","start createCameraVideoTrack..."),e.next=9,createCameraVideoTrack(o,this._extensionManager).catch((function(e){if(s._localVideoTrack&&!s._localVideoTrack.dummy)return s.logger.warn("setVideoCaptureDevice()","createCameraVideoTrack failed, stop pre VideoTrack."),s._removeLocalTrackEvents(s._localVideoTrack),s._localVideoTrack.close(),delete s._localVideoTrack,createCameraVideoTrack(o,s._extensionManager).then((function(e){return s._needClosePreTrack=!0,e})).catch(_asyncToGenerator(_regeneratorRuntime().mark((function t(){var r;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s.logger.error("setVideoCaptureDevice()","createCameraVideoTrack failed, rollback."),t.next=3,createCameraVideoTrack(s._videoStreamConstraints,s._extensionManager);case 3:throw r=t.sent,s._switchTrack(r),e;case 5:case"end":return t.stop()}}),t)}))));throw e}));case 9:return a=e.sent,this.logger.success("setVideoCaptureDevice()","createCameraVideoTrack success."),this._videoStreamConstraints=o,this._localVideoTrack&&(this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close()),(null==(n=this._videoStreamEncodeConfig[0])?void 0:n.contentHint)&&a.setContentHint(null==(i=this._videoStreamEncodeConfig[0])?void 0:i.contentHint),e.next=16,this._switchTrack(a);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return be.apply(this,arguments)})},{key:"setAudioCaptureDevice",value:(Te=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("setAudioCaptureDevice()","deviceId: %s",t),checkString(t,"deviceId"),this._localAudioDeviceId=t,this._localAudioTrack){e.next=2;break}return e.abrupt("return");case 2:return this._ctx.audioProfileManager.updateConstraints({deviceId:{exact:t}}),this._localAudioTrack.close(),this._removeLocalTrackEvents(this._localAudioTrack),e.next=5,createMicrophoneAudioTrack(this._ctx.audioProfileManager.getConstraints(),this._extensionManager);case 5:if(n=e.sent,this._initLocalTrackEvents(n),this._localAudioTrack=n,this._localAudioTrack.setVolume(this._localAudioVolume),e.t0=this._room&&(null==(r=this._room.localStream)?void 0:r.pubAudio),!e.t0){e.next=13;break}return e.next=13,this._updatePublish();case 13:case"end":return e.stop()}}),e,this)}))),function(e){return Te.apply(this,arguments)})},{key:"_addDeviceEventHandler",value:function(){dd$1.on(EngineEventsTypes.onVideoDeviceStateChanged,this._onVideoDeviceStateChange.bind(this)),dd$1.on(EngineEventsTypes.onAudioDeviceStateChanged,this._onAudioDeviceStateChange.bind(this))}},{key:"_addHandlerEventHandler",value:function(){var e,t,r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R,C,k,I,A,O,M,P,w,D,N,x,L,$,B=this;null==(e=this._room)||e.on(SignalEvent.ON_ADD_STREAM,this._onAddStream.bind(this)),null==(t=this._room)||t.on(SignalEvent.ON_REMOVE_STREAM,this._onRemoveStream.bind(this)),null==(r=this._room)||r.on(SignalEvent.USER_CONNECTION,this._onUserConnection.bind(this)),null==(n=this._room)||n.on(RoomEvent.ON_USER_LEAVE,this._onUserLeave.bind(this)),null==(i=this._room)||i.on(RoomEvent.ON_ROOM_ERROR,this._onRoomError.bind(this)),null==(o=this._room)||o.on(RoomEvent.ON_NETWORK_QUALITY,this._onNetworkQuality.bind(this)),null==(a=this._room)||a.on(SignalEvent.ON_CUSTOM_MESSAGE,this._onCustomMessage.bind(this)),null==(s=this._room)||s.on(SignalEvent.USER_MESSAGE_RECEIVED,this._onUserMessageReceived.bind(this)),null==(c=this._room)||c.on(SignalEvent.USER_BINARY_MESSAGE_RECEIVED,this._onUserBinaryMessageReceived.bind(this)),null==(u=this._room)||u.on(SignalEvent.ON_USER_TOKEN_WILL_EXPIRE,this._onUserTokenWillExpire.bind(this)),null==(l=this._room)||l.on(SignalEvent.POST_PROCESSING_MESSAGE,(function(e){"2.0"===e.protocol?B._onStreamMixingEvent({error:e.error,event:e.eventType,message:e.message}):"publicStreamCallback"===e.type?B._onPushPublicStreamResult(e):"transcodeStatusCallback"===e.type&&B._onLiveTranscodingResult(e)})),null==(d=this._room)||d.on(StateEvent.ON_CONNECTION_STATE_CHANGE,this._onConnectionStateChange.bind(this)),null==(p=this._room)||p.on(StateEvent.ON_VENDOR_CONNECTION_STATE_CHANGE,(function(e){return B.safeEmit(EngineEventsTypes.onVendorConnectionStateChanged,e)})),null==(_=this._room)||_.on(RoomEvent.RESUBSCRIBE,this._onResubscribe.bind(this)),null==(h=this._room)||h.on(RoomEvent.SUBSCRIBE_PUSH_TRACK,this._onSubscribePushTrack.bind(this)),null==(f=this._room)||f.on(RoomEvent.REMOVE_PUSH_TRACK,this._onRemovePushTrack.bind(this)),null==(m=this._room)||m.on(RoomEvent.ON_PUBLISH_RESULT,(function(e){var t,r=!(e.retry||!(null==(t=B._room)?void 0:t._roomConfig.isAutoPublish));r&&B.safeEmit(EngineEventsTypes.onAutoPublishResult,e),B.safeEmit(EngineEventsTypes.onPublishResult,{isScreen:e.isScreen,isAutoPublish:r,errorCode:e.errorCode})})),null==(g=this._room)||g.on(RoomEvent.ON_SUBSCRIBE_RESULT,(function(e){B.safeEmit(EngineEventsTypes.onSubscribeResult,{userId:e.userId,isScreen:e.isScreen,isAutoSubscribe:!1,errorCode:e.errorCode})})),null==(v=this._room)||v.on(RoomEvent.ON_REMOTE_STREAM_STATS,(function(e){B.safeEmit(EngineEventsTypes.onRemoteStreamStats,e)})),null==(y=this._room)||y.on(RoomEvent.ON_LOCAL_STREAM_STATS,(function(e){B.safeEmit(EngineEventsTypes.onLocalStreamStats,e)})),null==(S=this._room)||S.on(RoomEvent.ON_SUBTITLE_STATE_CHANGED,(function(e){B.safeEmit(EngineEventsTypes.onSubtitleStateChanged,e)})),null==(E=this._room)||E.on(RoomEvent.ON_SUBTITLE_MESSAGE_RECEIVED,(function(e){B.safeEmit(EngineEventsTypes.onSubtitleMessageReceived,e)})),null==(T=this._room)||T.on(RoomEvent.ON_USER_PUBLISH_STATE_CHANGE,this._onUserPublishStateChange.bind(this)),null==(b=this._room)||b.on(RoomEvent.ON_USER_START_AUDIO_CAPTURE,(function(e,t){var r=e.userId;B._updateAudioPlayerState(t),B.safeEmit(EngineEventsTypes.onUserStartAudioCapture,{userId:r})})),null==(R=this._room)||R.on(RoomEvent.ON_USER_STOP_AUDIO_CAPTURE,(function(e){var t=e.userId;B.safeEmit(EngineEventsTypes.onUserStopAudioCapture,{userId:t})})),null==(C=this._room)||C.on(RoomEvent.ON_USER_START_VIDEO_CAPTURE,(function(e){var t=e.userId;B.safeEmit(EngineEventsTypes.onUserStartVideoCapture,{userId:t})})),null==(k=this._room)||k.on(RoomEvent.ON_USER_STOP_VIDEO_CAPTURE,(function(e){var t=e.userId;B.safeEmit(EngineEventsTypes.onUserStopVideoCapture,{userId:t})})),null==(I=this._room)||I.on(RoomEvent.ON_SEI_MESSAGED_RECEIVED,(function(e){B.safeEmit(EngineEventsTypes.onSEIMessageReceived,e)})),null==(A=this._room)||A.on(RoomEvent.ON_REMOTE_VIDEO_SIZE_CHANGED,(function(e,t){B.safeEmit(EngineEventsTypes.onRemoteVideoSizeChanged,e,t)})),null==(O=this._room)||O.on(RoomEvent.ON_SIMULCAST_SUBSCRIBE_FALLBACK,(function(e){return B.safeEmit(EngineEventsTypes.onSimulcastSubscribeFallback,e)})),null==(M=this._room)||M.on(RoomEvent.RECONNECT_FAILED,(function(){B.safeEmit(EngineEventsTypes.onError,{errorCode:ErrorCode.RECONNECT_FAILED})})),null==(P=this._room)||P.on(RoomEvent.ON_VIDEO_STREAM_BANNED,(function(e){B.safeEmit(EngineEventsTypes.onVideoStreamBanned,{uid:e.uid,banned:e.banned})})),null==(w=this._room)||w.on(RoomEvent.ON_AUDIO_STREAM_BANNED,(function(e){B.safeEmit(EngineEventsTypes.onAudioStreamBanned,{uid:e.uid,banned:e.banned})})),null==(D=this._room)||D.on(RoomEvent.ON_FORWARD_STREAM_ERROR,(function(e){B.safeEmit(EngineEventsTypes.onForwardStreamError,e)})),null==(N=this._room)||N.on(RoomEvent.ON_REJOIN_WITH_TCP,(function(){B.safeEmit(EngineEventsTypes.onRejoinWithTcp)})),null==(x=this._room)||x.on(RoomEvent.ON_ICE_CONNECT_WITH_TCP,(function(){B.safeEmit(EngineEventsTypes.onIceConnectWithTcp)})),null==(L=this._room)||L.on(RoomEvent.PUB_RETRY,(function(e){B.safeEmit(EngineEventsTypes.onPublishRetry,e)})),null==($=this._room)||$.on(RoomEvent.SUB_RETRY,(function(e){B.safeEmit(EngineEventsTypes.onSubscribeRetry,e)}))}},{key:"safeEmit",value:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return isReportCallback(e)&&reportRtcSdkCallback(this.id,e,n),(t=_get(_getPrototypeOf(ke.prototype),"safeEmit",this)).call.apply(t,[this,e].concat(n))}},{key:"_removeHandlerEventHandler",value:function(){var e;null==(e=this._room)||e.removeAllListeners()}},{key:"connect",value:(Ee=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this._room,e.t0){e.next=6;break}return this._room=new Room({isAutoPublish:!0,isAutoSubscribeAudio:!0,isAutoSubscribeVideo:!0,roomProfileType:RoomProfileType.communication},this._ctx),this._addHandlerEventHandler(),e.next=6,this._room.connect(this._appId);case 6:case"end":return e.stop()}}),e,this)}))),function(){return Ee.apply(this,arguments)})},{key:"joinRoom",value:(Se=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i){var o,a,s,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("joinRoom()","token: %o roomId: %o, userInfo: %o, roomConfig: %o",t,r,n,i),isEmpty(t)||checkString(t,"token"),checkRoomId(r),checkUserInfo(n),checkRoomConfig(i=assignIn$1({isAutoPublish:!0,isAutoSubscribeAudio:!0,isAutoSubscribeVideo:!0,roomProfileType:RoomProfileType.communication},i)),(null==(o=this._room)?void 0:o.connectionState)!==MediaConnectionState.CONNECTED){e.next=2;break}throw new SDKError(ErrorCode.REPEAT_JOIN,"Already joined");case 2:return this._room||(this._room=new Room(i,this._ctx),this._addHandlerEventHandler()),this._room.roomConfig=i,a=this._liveTranscodeConfig&&LiveTranscoding.getStartParams(this._liveTranscodeConfig),s=_objectSpread2(_objectSpread2({},n),{},{businessId:this._businessId,role:this._visibility?UserRole.NORMAL_USER:UserRole.SILENT_USER}),e.prev=4,this._ctx.useCloudProxy&&(this._startCloudProxyTimestamp=Date.now()),checkSourceLanguage(s),e.next=8,this._room.join(this._appId,r,t,s,a);case 8:return c=e.sent,e.abrupt("return",(this._roomConfig=i,this._ctx.audioProfileManager.setRoomId(r),this._tempRoomInfo&&delete this._tempRoomInfo,i.isAutoPublish&&(this._visibility?this._updatePublish({invokeByJoinRoom:!0,mediaType:MediaType.AUDIO_AND_VIDEO}):(this.safeEmit(EngineEventsTypes.onAutoPublishResult,{isScreen:!1,state:PublishState.PUBLISH_FAIL}),this.safeEmit(EngineEventsTypes.onPublishResult,{isScreen:!1,isAutoPublish:!0,errorCode:ErrorCode.NO_PUBLISH_PERMISSION}))),RTSMsgReportor.setRoomId(this.id,r),RTSMsgReportor.setUserId(this.id,n.userId),c));case 12:throw e.prev=12,e.t0=e.catch(4),e.t0.code===ErrorCode.INVALID_TOKEN&&(this._tempRoomInfo={config:i,roomId:r,userInfo:s}),this._room.destroy(),delete this._room,e.t0;case 15:case"end":return e.stop()}}),e,this,[[4,12]])}))),function(e,t,r,n){return Se.apply(this,arguments)})},{key:"leaveRoom",value:(ye=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]&&i[0],this.logger.info("leaveRoom()"),!t){e.next=7;break}return e.next=5,null==(r=this._room)?void 0:r.leave(t);case 5:e.next=8;break;case 7:null==(n=this._room)||n.leave(t).catch();case 8:this._removeHandlerEventHandler(),this._subLocks=new Map,this._subScreenLocks=new Map,this._ctx.audioProfileManager.setRoomId(),this._liveTranscodeConfig&&this.stopLiveTranscoding(),this._room=void 0,this._remoteAudioPlayer.forEach((function(e){return e.destroy()})),this._remoteAudioPlayer=new Map,this._remoteScreenAudioPlayer.forEach((function(e){return e.destroy()})),this._remoteScreenAudioPlayer=new Map,this._remoteScreenPlayer.forEach((function(e){return e.destroy()})),this._remoteScreenPlayer=new Map,this._remoteVideoPlayer.forEach((function(e){return e.destroy()})),this._remoteVideoPlayer=new Map,this._roomConfig=void 0,this._publicStreamIds=new Map,RTSMsgReportor.setRoomId(this.id,""),RTSMsgReportor.setUserId(this.id,"");case 26:case"end":return e.stop()}}),e,this)}))),function(){return ye.apply(this,arguments)})},{key:"_destroyLocalTrack",value:function(){this._localAudioTrack&&(this._removeLocalTrackEvents(this._localAudioTrack),this._localAudioTrack.close(),this._localAudioTrack=void 0),this._localVideoTrack&&(this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close(),this._localVideoTrack=void 0),this._localScreenAudioTrack&&(this._removeLocalTrackEvents(this._localScreenAudioTrack),this._localScreenAudioTrack.close(),this._localScreenAudioTrack=void 0),this._localScreenVideoTrack&&(this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.close(),this._localScreenVideoTrack=void 0),this._localImgVideoTrack&&(this._localImgVideoTrack.stop(),this._localImgVideoTrack=void 0),this._localImgScreenTrack&&(this._localImgScreenTrack.stop(),this._localImgScreenTrack=void 0)}},{key:"destroy",value:function(){var e,t,r;this.logger.info("destroy()"),this.removeAllListeners(),this._removeHandlerEventHandler(),null==(e=this._room)||e.destroy(),this._room=void 0,null==(t=this._videoPlayer)||t.destroy(),this._subLocks=new Map,this._subScreenLocks=new Map,this._audioCaptureLock=new PromiseLock2("audioCap"),this._videoCaptureLock=new PromiseLock2("videoCap"),this._screenCaptureLock=new PromiseLock2("screenCap"),this._videoPlayer=void 0,this._screenPlayer=void 0,this._videoStreamConstraints={},this._videoStreamEncodeConfig=[defaultVideoEncoderConfig],this._screenStreamEncodeConfig=[defaultScreenEncoderConfig],this._pauseAllSubscribeState={audio:void 0,video:void 0,resumeStreamIds:{}},this._messageStatisticsObserver.destroy(),this.monitor.destroy(),RTSMsgReportor.destroyRTSMsgReportor(this.id),clearInterval(this._audioVolumeIndicationTimer),clearInterval(this._dummyMainTimer),clearInterval(this._dummyScreenTimer),this._audioVolumeIndicationTimer=void 0,this._stopAudioPropertiesReport(),this._destroyLocalTrack(),internalEventBus.on("".concat(this.id,"capture-end"),this._destroyLocalTrack.bind(this)),this._remoteAudioPlayer.forEach((function(e){return e.destroy()})),this._remoteAudioPlayer=new Map,this._remoteScreenAudioPlayer.forEach((function(e){return e.destroy()})),this._remoteScreenAudioPlayer=new Map,this._remoteScreenPlayer.forEach((function(e){return e.destroy()})),this._remoteScreenPlayer=new Map,this._remoteVideoPlayer.forEach((function(e){return e.destroy()})),this._remoteVideoPlayer=new Map,this._publicStreamAudioPlayer.forEach((function(e){return e.destroy()})),this._publicStreamAudioPlayer=new Map,this._publicStreamVideoPlayer.forEach((function(e){return e.destroy()})),this._publicStreamVideoPlayer=new Map,this._roomConfig=void 0,this._audioMixingManager.destroy(),this._rtmClient.destroy(),null==(r=this._publicStreamManager)||r.destroy(),this._publicStreamIds=new Map,this._audioDeviceManager.destroy(),this._remoteVideoConfig=new Map,this._ctx.userPriority.clear(),this._extensionManager.destroy(),this._ctx.avSync=!0,this._localAudioVolume=100,this._localScreenAudioVolume=100,this._remoteAudioVolume.clear(),this._remoteScreenAudioVolume.clear(),this._publicAudioVolume.clear()}},{key:"publishStream",value:(ve=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("publishStream()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),e.t0=videoInMediaType(t)&&!this._localVideoTrack&&this._localImgVideoTrack,!e.t0){e.next=8;break}return e.next=7,createDummyVideoLocalTrack(this._localImgVideoTrack,this._extensionManager);case 7:this._localVideoTrack=e.sent;case 8:return e.next=10,this._updatePublish({mediaType:t});case 10:case"end":return e.stop()}}),e,this)}))),function(e){return ve.apply(this,arguments)})},{key:"unpublishStream",value:(ge=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("unpublishStream()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),!r){e.next=2;break}return e.abrupt("return",null==(n=this._room)?void 0:n.unpublish());case 2:return e.next=4,this._updatePublish({mediaType:t,pubState:PubState.UNPUB});case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return ge.apply(this,arguments)})},{key:"publishScreen",value:(me=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("publishScreen()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),e.prev=1,e.t0=videoInMediaType(t)&&!this._localScreenVideoTrack&&this._localImgScreenTrack,!e.t0){e.next=7;break}return e.next=6,createDummyScreenVideoLocalTrack(this._localImgScreenTrack,this._extensionManager);case 6:this._localScreenVideoTrack=e.sent;case 7:return e.next=9,this._updateScreenPublish({mediaType:t,pubState:PubState.PUB});case 9:e.next=14;break;case 11:throw e.prev=11,e.t1=e.catch(1),e.t1 instanceof SDKError?e.t1:new SDKError(ErrorCode.UNEXPECTED_ERROR,"unexpected error",e.t1);case 14:case"end":return e.stop()}}),e,this,[[1,11]])}))),function(e){return me.apply(this,arguments)})},{key:"unpublishScreen",value:(fe=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("unpublishScreen()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),e.next=5,this._updateScreenPublish({mediaType:t,pubState:PubState.UNPUB});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return fe.apply(this,arguments)})},{key:"subscribeStream",value:(he=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.logger.info("subscribeStream()","userId: %o, mediaType: %o",t,r),this._subscribe(!1,t,r)));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return he.apply(this,arguments)})},{key:"_subscribe",value:(_e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n!==MediaType.AUDIO||!(null==(i=this._room)?void 0:i.multiChatMode)){e.next=2;break}return e.abrupt("return",void this.logger.warn("subscribeStream()","due to multiChatMode return"));case 2:if(d=this._room.remoteStreams.get(r),p=null==d?void 0:d.find((function(e){return e.isScreen===t}))){e.next=5;break}throw new SDKError(ErrorCode.STREAM_NOT_EXIST,"stream not exist");case 5:return _=this._pauseAllSubscribeState.audio,h=this._pauseAllSubscribeState.video,this._pauseAllSubscribeState.audio&&(n-=n&MediaType.AUDIO),this._pauseAllSubscribeState.video&&(n-=n&MediaType.VIDEO),this.logger.warn("subscribeStream()","due to pauseAll mediaType: %o",n),f=p.hasSubscribed,m=this._remoteVideoConfig.get(r)||(null==(o=this._roomConfig)?void 0:o.remoteVideoConfig),p.originalMediaType=n,e.next=11,this._room.subscribe(p,n,m);case 11:audioInMediaType(n)&&this._updateAudioPlayerState(p),videoInMediaType(n)&&this._updateVideoPlayerState(p),g=0,v=0,_!==this._pauseAllSubscribeState.audio&&(this._pauseAllSubscribeState.audio?g|=MediaType.AUDIO:v|=MediaType.AUDIO),h!==this._pauseAllSubscribeState.video&&(this._pauseAllSubscribeState.video?g|=MediaType.VIDEO:v|=MediaType.VIDEO),g&&this.pauseAllSubscribedStream(g),v&&this.resumeAllSubscribedStream(v),this._pauseAllSubscribeState.resumeStreamIds[p.streamId]=p.streamId,(p.audioTrack||p.videoTrack)&&(y=!(t||!(null==(a=this._roomConfig)?void 0:a.isAutoSubscribeAudio)&&!(null==(s=this._roomConfig)?void 0:s.isAutoSubscribeVideo)),S={userId:r,isScreen:!1,state:SubscribeState.SUBSCRIBE_SUCC},y&&this.safeEmit(EngineEventsTypes.onAutoSubscribeResult,S),this.safeEmit(EngineEventsTypes.onSubscribeResult,{userId:r,isScreen:t,isAutoSubscribe:y})),!(null==(c=this._room)?void 0:c.multiChatMode)&&!f&&audioInMediaType(n)&&p.hasAudio&&(null==(u=p.observer)||u.setSubscribeAudio(!0)),!f&&videoInMediaType(n)&&p.hasVideo&&(null==(l=p.observer)||l.setSubscribeVideo(!0));case 16:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return _e.apply(this,arguments)})},{key:"unsubscribeStream",value:(pe=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.logger.info("unsubscribeStream()","userId: %o, mediaType: %o",t,r),this._unsubscribe(!1,t,r)));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return pe.apply(this,arguments)})},{key:"subscribeScreen",value:(de=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.logger.info("subscribeScreen() userId: %o, mediaType: %o",t,r),this._subscribe(!0,t,r)));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return de.apply(this,arguments)})},{key:"unsubscribeScreen",value:(le=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.logger.info("unsubscribeScreen() userId: %o, mediaType: %o",t,r),this._unsubscribe(!0,t,r)));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return le.apply(this,arguments)})},{key:"_unsubscribe",value:function(e,t,r,n){var i,o=this;if(r!==MediaType.AUDIO||!(null==(i=this._room)?void 0:i.multiChatMode)){var a,s=this._room.remoteStreams.get(t),c=null==s?void 0:s.find((function(t){return t.isScreen===e}));if(!c)throw new SDKError(ErrorCode.STREAM_NOT_EXIST,"stream not exist");if(isAndroid&&chromeVersion&&chromeVersion>=85&&chromeVersion<=91&&r!==MediaType.AUDIO)null==(a=e?this._remoteScreenPlayer.get(t):this._remoteVideoPlayer.get(t))||a.stop();return this._room.unsubscribe(c,r).then((function(){n||delete o._pauseAllSubscribeState.resumeStreamIds[c.streamId]}))}this.logger.warn("subscribeStream()","due to multiChatMode return")}},{key:"setRemoteVideoConfig",value:(ue=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.logger.info("setRemoteVideoConfig() userId: %o, remoteVideoConfig: %o",t,r),checkUserId(t),checkRemoteConfig(r),this._remoteVideoConfig.set(t,r),null==(n=this._room)?void 0:n.updateSubVideoConfig(t,r).then((function(){}))));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return ue.apply(this,arguments)})},{key:"startVideoCapture",value:(ce=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u,l,d,p,_,h=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("startVideoCapture()","deviceId: %s",t),isEmpty(t)||checkString(t,"deviceId"),t=t||this._localVideoDeviceId,this._localVideoDeviceId=t,this._trackSourceType.video!==VideoSourceType.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=2;break}throw new SDKError(ErrorCode.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");case 2:if(!this._localVideoTrack||this._localVideoTrack.dummy){e.next=4;break}throw new SDKError(ErrorCode.REPEAT_CAPTURE,"Has already capture");case 4:return c=this._videoStreamConstraints,t&&("user"===t||"environment"===t||"left"===t||"right"===t?(c.facingMode=t,delete c.deviceId):!isDingTalk||isIOS?c.deviceId={exact:t}:delete c.deviceId,this._videoStreamConstraints=c),u={},e.next=9,createCameraVideoTrack(c,this._extensionManager);case 9:if(l=e.sent,(null==(r=this._videoStreamEncodeConfig[0])?void 0:r.contentHint)&&l.setContentHint(null==(n=this._videoStreamEncodeConfig[0])?void 0:n.contentHint),this._initLocalTrackEvents(l),this._localVideoTrack=l,null==(i=this._videoPlayer)||i.playVideo(l),(d=l.originTrack)&&(u=d.getSettings(),p={width:u.width,height:u.height},this._localVideoTrack.resolution=p,this.autoResetVideoEncoderConfig(u),setTimeout((function(){return h.safeEmit(EngineEventsTypes.onLocalVideoSizeChanged,{streamIndex:StreamIndex.STREAM_INDEX_MAIN,info:p})}))),internalEventBus.emit("".concat(this.id,"capture-end")),this._room){e.next=15;break}return e.abrupt("return",u);case 15:return _=this._room._roomConfig.isAutoPublish,e.abrupt("return",(((null==(o=this._room.localStream)?void 0:o.pubVideo)||_)&&this._visibility&&this._updatePublish(),null==(s=null==(a=this._room.localStream)?void 0:a.observer)||s.setEnableVideo(!0),u));case 17:case"end":return e.stop()}}),e,this)}))),function(e){return ce.apply(this,arguments)})},{key:"stopVideoCapture",value:(se=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("stopVideoCapture()"),this._trackSourceType.video!==VideoSourceType.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=2;break}throw new SDKError(ErrorCode.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");case 2:if(null==(t=this._videoPlayer)||t.stop(),this._localVideoTrack&&!this._localVideoTrack.dummy&&((o=this._extensionManager.getPluginByName(RTCExtensionType.PRE_PROCESSING,"RTCBeautyExtension"))&&o.emit("stop"),this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close(),this._localImgVideoTrack?(this._localVideoTrack.setTrack(this._localImgVideoTrack,this._extensionManager),this._localVideoTrack.dummy=!0):this._localVideoTrack=void 0),e.t0=this._room,!e.t0){e.next=10;break}if(e.t1=null==(r=this._room.localStream)?void 0:r.pubVideo,!e.t1){e.next=9;break}return e.next=9,this._updatePublish();case 9:null==(i=null==(n=this._room.localStream)?void 0:n.observer)||i.setEnableVideo(!1);case 10:case"end":return e.stop()}}),e,this)}))),function(){return se.apply(this,arguments)})},{key:"startAudioCapture",value:(ae=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("startAudioCapture()","deviceId: $o",t),isEmpty(t)||checkString(t,"deviceId"),t=t||this._localAudioDeviceId,this._localAudioDeviceId=t,this._trackSourceType.audio!==AudioSourceType.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=2;break}throw new SDKError(ErrorCode.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");case 2:if(!this._localAudioTrack){e.next=4;break}throw new SDKError(ErrorCode.REPEAT_CAPTURE,"Has already capture");case 4:return t&&this._ctx.audioProfileManager.updateConstraints({deviceId:{exact:t}}),o={},e.next=8,createMicrophoneAudioTrack(this._ctx.audioProfileManager.getConstraints(),this._extensionManager);case 8:if((a=e.sent).originTrack&&(o=a.originTrack.getSettings()),this._initLocalTrackEvents(a),this._localAudioTrack=a,this._localAudioTrack.setVolume(this._localAudioVolume),this._tempMixingAudioTrack&&(this._localAudioTrack.mixType=this._tempMixingAudioTrack.type,this._localAudioTrack.mixedAudioTrack=this._tempMixingAudioTrack.track,delete this._tempMixingAudioTrack),internalEventBus.emit("".concat(this.id,"capture-end")),this._room){e.next=11;break}return e.abrupt("return",o);case 11:return s=this._room._roomConfig.isAutoPublish,e.abrupt("return",(((null==(r=this._room.localStream)?void 0:r.pubAudio)||s)&&this._visibility&&this._updatePublish(),null==(i=null==(n=this._room.localStream)?void 0:n.observer)||i.setEnableAudio(!0),o));case 13:case"end":return e.stop()}}),e,this)}))),function(e){return ae.apply(this,arguments)})},{key:"stopAudioCapture",value:(oe=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("stopAudioCapture()"),this._trackSourceType.audio!==AudioSourceType.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=2;break}throw new SDKError(ErrorCode.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");case 2:if(this._localAudioTrack&&(this._removeLocalTrackEvents(this._localAudioTrack),this._localAudioTrack.close()),this._localAudioTrack=void 0,this._audioMixingManager.stopAll(),e.t0=this._room,!e.t0){e.next=12;break}if(e.t1=null==(t=this._room.localStream)?void 0:t.pubAudio,!e.t1){e.next=11;break}return e.next=11,this._updatePublish();case 11:null==(n=null==(r=this._room.localStream)?void 0:r.observer)||n.setEnableAudio(!1);case 12:case"end":return e.stop()}}),e,this)}))),function(){return oe.apply(this,arguments)})},{key:"checkAudioAndVideoDeviceId",value:function(e,t){var r;return this.logger.print("startAudioAndVideoCapture","optionsOrAudioDeviceId: $o",e,"videoDeviceId: $o",t),isEmpty(t)||checkString(t,"videoDeviceId"),isEmpty(e)||("string"==typeof e?(checkString(e,"audioDeviceId"),r=e):(r=null==e?void 0:e.audioDeviceId,t=null==e?void 0:e.videoDeviceId,checkString(r,"audioDeviceId"),checkString(t,"videoDeviceId"))),t=t||this._localVideoDeviceId,this._localVideoDeviceId=t,r=r||this._localAudioDeviceId,this._localAudioDeviceId=r,{audioDeviceId:r,videoDeviceId:t}}},{key:"startAudioAndVideoCapture",value:(ie=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("startAudioAndVideoCapture","optionsOrAudioDeviceId: $o",t,"videoDeviceId: $o",r),p=this.checkAudioAndVideoDeviceId(t,r),_=p.audioDeviceId,h=p.videoDeviceId,r=h,this._trackSourceType.video!==VideoSourceType.VIDEO_SOURCE_TYPE_EXTERNAL&&this._trackSourceType.audio!==AudioSourceType.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=4;break}throw new SDKError(ErrorCode.STREAM_TYPE_NOT_MATCH,this._trackSourceType.video===VideoSourceType.VIDEO_SOURCE_TYPE_EXTERNAL?"setVideoSourceType as internal first":"setAudioSourceType as internal first");case 4:if(!this._localVideoTrack||this._localVideoTrack.dummy){e.next=6;break}throw new SDKError(ErrorCode.REPEAT_CAPTURE,"video has already capture");case 6:if(!this._localAudioTrack){e.next=8;break}throw new SDKError(ErrorCode.REPEAT_CAPTURE,"audio has already capture");case 8:return f=this._videoStreamConstraints,r&&("user"===r||"environment"===r||"left"===r||"right"===r?(f.facingMode=r,delete f.deviceId):!isDingTalk||isIOS?f.deviceId={exact:r}:delete f.deviceId,this._videoStreamConstraints=f),_&&this._ctx.audioProfileManager.updateConstraints({deviceId:{exact:_}}),m={},g={},e.next=13,createMicrophoneAndCameraTrack(this._ctx.audioProfileManager.getConstraints(),f,this._extensionManager);case 13:if(v=e.sent,y=v.audioTrack,S=v.videoTrack,(null==(n=this._videoStreamEncodeConfig[0])?void 0:n.contentHint)&&S.setContentHint(null==(i=this._videoStreamEncodeConfig[0])?void 0:i.contentHint),this._initLocalTrackEvents(S),this._localVideoTrack=S,null==(o=this._videoPlayer)||o.playVideo(S),this._initLocalTrackEvents(y),this._localAudioTrack=y,this._localAudioTrack.setVolume(this._localAudioVolume),this._tempMixingAudioTrack&&(this._localAudioTrack.mixType=this._tempMixingAudioTrack.type,this._localAudioTrack.mixedAudioTrack=this._tempMixingAudioTrack.track,delete this._tempMixingAudioTrack),E=S.originTrack,m=E.getSettings(),T={width:m.width||0,height:m.height||0},this._localVideoTrack.resolution=T,this.autoResetVideoEncoderConfig(m),setTimeout((function(){return R.safeEmit(EngineEventsTypes.onLocalVideoSizeChanged,{streamIndex:StreamIndex.STREAM_INDEX_MAIN,info:T})})),E=y.originTrack,g=E.getSettings(),internalEventBus.emit("".concat(this.id,"capture-end")),this._room){e.next=22;break}return e.abrupt("return",{audioTrackSettings:g,videoTrackSettings:m});case 22:return b=this._room._roomConfig.isAutoPublish,e.abrupt("return",(((null==(a=this._room.localStream)?void 0:a.pubVideo)||(null==(s=this._room.localStream)?void 0:s.pubAudio)||b)&&this._visibility&&this._updatePublish(),null==(u=null==(c=this._room.localStream)?void 0:c.observer)||u.setEnableVideo(!0),null==(d=null==(l=this._room.localStream)?void 0:l.observer)||d.setEnableAudio(!0),{audioTrackSettings:g,videoTrackSettings:m}));case 24:case"end":return e.stop()}}),e,this)}))),function(e,t){return ie.apply(this,arguments)})},{key:"startVideoAndAudioCapture",value:(ne=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.startAudioAndVideoCapture(r,t));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return ne.apply(this,arguments)})},{key:"getAudioMixingManager",value:function(){return this.logger.info("getAudioMixingManager()","invoke"),this._audioMixingManager}},{key:"startScreenCapture",value:(re=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g=this,v=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=v.length>0&&void 0!==v[0]?v[0]:{},this.logger.info("startScreenCapture()","config: %o",t),l=t.enableAudio,d=void 0!==l&&l,this._trackSourceType.screenVideo!==VideoSourceType.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=5;break}throw new SDKError(ErrorCode.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");case 5:if(this._trackSourceType.screenAudio!==AudioSourceType.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=7;break}throw new SDKError(ErrorCode.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");case 7:return e.next=9,createScreenTracks(d,this._extensionManager,this._screenStreamEncodeConfig[0]);case 9:if(p=e.sent,_=_slicedToArray(p,2),h=_[0],null==(f=_[1])||f.setVolume(this._localScreenAudioVolume),this._localScreenVideoTrack&&!this._localScreenVideoTrack.dummy&&(this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.close()),null==(r=this._localScreenAudioTrack)||r.close(),delete this._localScreenAudioTrack,this._localScreenVideoTrack=h,(null==(n=this._screenStreamEncodeConfig[0])?void 0:n.contentHint)&&h.setContentHint(null==(i=this._screenStreamEncodeConfig[0])?void 0:i.contentHint),(m=h.originTrack)&&setTimeout((function(){var e=m.getSettings(),t={width:e.width,height:e.height};h.resolution=t,g.safeEmit(EngineEventsTypes.onLocalVideoSizeChanged,{streamIndex:StreamIndex.STREAM_INDEX_SCREEN,info:{width:e.width,height:e.height}})}),500),f&&(this._localScreenAudioTrack=f,this._initLocalTrackEvents(f)),null==(o=this._screenPlayer)||o.playVideo(this._localScreenVideoTrack),this._initLocalTrackEvents(this._localScreenVideoTrack,!0),e.t0=(null==(s=null==(a=this._room)?void 0:a.localScreenStream)?void 0:s.pubAudio)||(null==(u=null==(c=this._room)?void 0:c.localScreenStream)?void 0:u.pubVideo),!e.t0){e.next=23;break}return e.next=23,this._updateScreenPublish();case 23:case"end":return e.stop()}}),e,this)}))),function(){return re.apply(this,arguments)})},{key:"stopScreenCapture",value:(te=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("stopScreenCapture()"),null==(t=this._screenPlayer)||t.stop(),this._localScreenVideoTrack&&(this._localScreenVideoTrack.dummy||(this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.close(),this._localImgScreenTrack&&(this._localScreenVideoTrack.setTrack(this._localImgScreenTrack,this._extensionManager),this._localScreenVideoTrack.dummy=!0))),this._localScreenAudioTrack&&(this._removeLocalTrackEvents(this._localScreenAudioTrack),this._localScreenAudioTrack.close()),this._localScreenAudioTrack=void 0,e.t0=(null==(n=null==(r=this._room)?void 0:r.localScreenStream)?void 0:n.pubAudio)||(null==(o=null==(i=this._room)?void 0:i.localScreenStream)?void 0:o.pubVideo),!e.t0){e.next=9;break}return e.next=9,this._updateScreenPublish();case 9:case"end":return e.stop()}}),e,this)}))),function(){return te.apply(this,arguments)})},{key:"setLocalVideoPlayer",value:function(e,t){var r,n,i,o;if(this.logger.info("setLocalVideoPlayer()","streamIndex: %o, videoPlayerOption: %o",e,t),checkEnum(e,"streamIndex",[StreamIndex.STREAM_INDEX_MAIN,StreamIndex.STREAM_INDEX_SCREEN]),null==t?void 0:t.renderDom){var a=_objectSpread2(_objectSpread2({userId:this._getUserId()},t),{},{isLocal:!0});if(delete a.rotation,checkVideoPlayerOption(a),e===StreamIndex.STREAM_INDEX_MAIN&&!this._videoPlayer)return this._videoPlayer=new VideoPlayer(this.id,a),this._initPlayerEvents(this._videoPlayer,!1,e),this._videoPlayer.mirror(!!this._mirrorType),this._localVideoTrack&&!this._localVideoTrack.dummy&&(null==(i=this._config)?void 0:i.autoPlayPolicy)!==RTCAutoPlayPolicy.PLAY_MANUALLY&&this._videoPlayer.playVideo(this._localVideoTrack),this._videoPlayer.domElement;if(e===StreamIndex.STREAM_INDEX_SCREEN&&!this._screenPlayer)return this._screenPlayer=new VideoPlayer(this.id,_objectSpread2(_objectSpread2({},a),{},{isScreen:!0,isLocal:!0})),this._initPlayerEvents(this._screenPlayer,!1,e),this._localScreenVideoTrack&&!this._localScreenVideoTrack.dummy&&(null==(o=this._config)?void 0:o.autoPlayPolicy)!==RTCAutoPlayPolicy.PLAY_MANUALLY&&this._screenPlayer.playVideo(this._localScreenVideoTrack),this._screenPlayer.domElement;if(void 0!==t.renderMode){var s=e===StreamIndex.STREAM_INDEX_MAIN?this._videoPlayer:this._screenPlayer;null==s||s.setRenderMode(t.renderMode)}}else e===StreamIndex.STREAM_INDEX_MAIN?(null==(r=this._videoPlayer)||r.destroy(!0),delete this._videoPlayer):(null==(n=this._screenPlayer)||n.destroy(),delete this._screenPlayer)}},{key:"startLiveTranscoding",value:(ee=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("startLiveTranscoding()","transcode: %o",t),LiveTranscoding.checkStartParams(t),this._liveTranscodeConfig=t,!((n=null==(r=this._room)?void 0:r.roomInfo)&&n.roomId.length+n.userInfo.userId.length>126)){e.next=4;break}throw new SDKError(ErrorCode.INVALID_PARAMS,"The roomId+userId must be within 126 bytes");case 4:if(e.prev=4,this.safeEmit(EngineEventsTypes.onStreamMixingEvent,{event:StreamMixingEventType.START,error:0,message:""}),e.t0=this._room&&this._room.connectionState===MediaConnectionState.CONNECTED,!e.t0){e.next=10;break}return e.next=10,this._room.liveControlMessage(LiveTranscoding.getStartParams(this._liveTranscodeConfig));case 10:e.next=15;break;case 12:throw e.prev=12,e.t1=e.catch(4),e.t1 instanceof SDKError?e.t1:new SDKError(ErrorCode.UNEXPECTED_ERROR,"unexpected error",e.t1);case 15:case"end":return e.stop()}}),e,this,[[4,12]])}))),function(e){return ee.apply(this,arguments)})},{key:"updateLiveTranscoding",value:(Q=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updateLiveTranscoding()","transcode: %o",t),this._liveTranscodeConfig){e.next=2;break}return e.abrupt("return");case 2:return delete(o=assignIn$1({},t)).audio,null==(r=o.video)||delete r.codec,null==(n=o.video)||delete n.gop,LiveTranscoding.checckUpdateParams(o),this._liveTranscodeConfig=assignIn$1(this._liveTranscodeConfig,o),e.prev=4,this.safeEmit(EngineEventsTypes.onStreamMixingEvent,{event:StreamMixingEventType.UPDATE,error:0,message:""}),e.next=8,null==(i=this._room)?void 0:i.liveControlMessage(LiveTranscoding.getUpdateParams(this._liveTranscodeConfig));case 8:e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(4),e.t0 instanceof SDKError?e.t0:new SDKError(ErrorCode.UNEXPECTED_ERROR,"unexpected error",e.t0);case 13:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(e){return Q.apply(this,arguments)})},{key:"stopLiveTranscoding",value:(Z=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("stopLiveTranscoding()"),!this._liveTranscodeConfig){e.next=11;break}return delete this._liveTranscodeConfig,e.prev=2,this.safeEmit(EngineEventsTypes.onStreamMixingEvent,{event:StreamMixingEventType.STOP,error:0,message:""}),e.next=6,null==(t=this._room)?void 0:t.liveControlMessage({action:"stopped",type:"transcode"});case 6:e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(2),e.t0 instanceof SDKError?e.t0:new SDKError(ErrorCode.UNEXPECTED_ERROR,"unexpected error",e.t0);case 11:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(){return Z.apply(this,arguments)})},{key:"startSubtitle",value:(J=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("startSubtitle()","config: %o",t),this._assertNotInRoom(),e.next=4,null==(r=this._room)?void 0:r.startSubtitle(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return J.apply(this,arguments)})},{key:"stopSubtitle",value:function(){var e;this.logger.info("stopSubtitle()","invoke"),null==(e=this._room)||e.stopSubtitle()}},{key:"setBusinessId",value:function(e){return this.logger.info("setBusinessId()","businessId: %s",e),!illegalBusinessId(e)&&!this._room&&(this.monitor.set({rtc_business_id:e}),this._businessId=e,!0)}},{key:"setUserVisibility",value:(X=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("setUserVisibility()","enable: %o",t),t=!!t,e.t0=this._visibility!==t,!e.t0){e.next=18;break}if(!this._room){e.next=17;break}if(this._assertNotInRoom(),this._room.localStream&&(null==(r=this._room.localStream.observer)||r.setPublisher(t)),e.t1=!t,!e.t1){e.next=11;break}return e.next=11,this._room.unpublish();case 11:return e.next=13,this._room.updateUserAttributes({role:t?UserRole.NORMAL_USER:UserRole.SILENT_USER});case 13:this._visibility=t,t&&(null==(n=this._roomConfig)?void 0:n.isAutoPublish)&&this._updatePublish({mediaType:MediaType.AUDIO_AND_VIDEO}),e.next=18;break;case 17:this._visibility=t;case 18:case"end":return e.stop()}}),e,this)}))),function(e){return X.apply(this,arguments)})},{key:"_initPlayerEvents",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:StreamIndex.STREAM_INDEX_MAIN,i=n===StreamIndex.STREAM_INDEX_SCREEN;e.on("playback_event",(function(n){var o,a,s,c;switch(n.eventName){case"timeupdate":return;case"loadeddata":if("audio"===n.type){var u=e.userId.replace("_screen",""),l=null==(a=null==(o=t._room)?void 0:o.remoteStreams.get(u))?void 0:a.find((function(e){return e.isScreen===i})),d=function(){r?t.safeEmit(EngineEventsTypes.onFirstPublicStreamAudioFrameDecoded,{publicStreamId:u}):(t.safeEmit(EngineEventsTypes.onAudioFirstFrameDecoded,{userId:u,isScreen:i}),t.safeEmit(EngineEventsTypes.onRemoteAudioFirstFrame,{userId:u,isScreen:i})),t.monitor.report("first_remote_audio_render",{stream_id:"",stream_user_id:u||""},{isScreen:i})};l&&l.observer&&!l.observer.audioFirstFrameReceived?l.observer.once("recvAudioFirstFrame",d):d()}else{var p={userId:e.userId,height:(null==(s=e.domElement)?void 0:s.videoHeight)||0,width:(null==(c=e.domElement)?void 0:c.videoWidth)||0,isScreen:i};r?(p.publicStreamId=p.userId,delete p.userId,delete p.isScreen,t.safeEmit(EngineEventsTypes.onFirstPublicStreamVideoFrameRendered,p),t.safeEmit(EngineEventsTypes.onFirstPublicStreamVideoFrameDecoded,p)):e.isLocal||(t.safeEmit(EngineEventsTypes.onVideoFirstFrameRendered,p),t.safeEmit(EngineEventsTypes.onVideoFirstFrameDecoded,p),t.safeEmit(EngineEventsTypes.onRemoteVideoFirstFrame,p)),t.monitor.report("first_remote_video_render",{stream_id:"",stream_user_id:n.userId||""},{isScreen:i})}break;case"autoplay-error":return r&&(n.publicStreamId=n.userId),reportRtcInvokeStatus(t.id,"autoplay-error",e instanceof VideoPlayer?"video":"audio",0,n.userId||""),void t.safeEmit(EngineEventsTypes.onAutoplayFailed,{userId:n.userId,kind:e instanceof VideoPlayer?"video":"audio",mediaType:e instanceof VideoPlayer?MediaType.VIDEO:MediaType.AUDIO,streamIndex:e.isScreen?StreamIndex.STREAM_INDEX_SCREEN:StreamIndex.STREAM_INDEX_MAIN})}t.safeEmit(EngineEventsTypes.onPlayerEvent,n)}))}},{key:"_initLocalTrackEvents",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];["track-ended","track-mute","track-unmute"].forEach((function(r){e.on(r,function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(n){var i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.monitor.report("rtc_error",{message:"track-".concat(r," mediaType: ").concat(n.originTrack.kind),error_code:RtcErrorCode.TRACK_ERROR}),i=!1,n!==t._localScreenAudioTrack&&n!==t._localScreenVideoTrack||(i=!0),o=n.originTrack.kind,t.safeEmit({"track-ended":EngineEventsTypes.onTrackEnded,"track-mute":EngineEventsTypes.onTrackMute,"track-unmute":EngineEventsTypes.onTrackUnmute}[r],{kind:o,isScreen:i}),e.t0=isIOS||isIPad,!e.t0){e.next=16;break}if(e.t1="track-mute"===r,!e.t1){e.next=15;break}if(internalEventBus.emit(InternalEvent.ON_IOS_LOCAL_TRACK_MUTE,o),e.t2="audio"===o,!e.t2){e.next=15;break}return e.next=14,t.stopAudioCapture();case 14:t.startAudioCapture();case 15:"track-unmute"===r&&internalEventBus.emit(InternalEvent.ON_IOS_LOCAL_TRACK_UNMUTE,o);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),e.on("resolution-change",(function(e){t._extensionManager.getPluginsByType(RTCExtensionType.PRE_PROCESSING).forEach((function(t){var n;null==(n=null==t?void 0:t.applyConstraints)||n.call(t,r?StreamIndex.STREAM_INDEX_SCREEN:StreamIndex.STREAM_INDEX_MAIN,e)})),t.safeEmit(EngineEventsTypes.onLocalVideoSizeChanged,{streamIndex:r?StreamIndex.STREAM_INDEX_SCREEN:StreamIndex.STREAM_INDEX_MAIN,info:e})}))}},{key:"_removeLocalTrackEvents",value:function(e){e.removeAllListeners("track-ended"),e.removeAllListeners("track-mute"),e.removeAllListeners("track-unmute"),e.removeAllListeners("resolution-change")}},{key:"setRemoteVideoPlayer",value:function(e,t){var r,n,i,o,a,s;this.logger.info("setRemoteVideoPlayer()","streamIndex: %o, videoPlayerOption: %o",e,t),checkEnum(e,"streamIndex",[StreamIndex.STREAM_INDEX_MAIN,StreamIndex.STREAM_INDEX_SCREEN]),checkVideoPlayerOption(t);var c=t.userId;if(e===StreamIndex.STREAM_INDEX_MAIN){if(null==(r=this._remoteVideoPlayer.get(c))||r.destroy(),!t.renderDom)return;var u=new VideoPlayer(this.id,t);this._initPlayerEvents(u,!1,e),this._remoteVideoPlayer.set(c,u);var l=null==(i=null==(n=this._room)?void 0:n.remoteStreams.get(c))?void 0:i.find((function(e){return!e.isScreen}));return l&&this._updateVideoPlayerState(l),u.domElement}if(null==(o=this._remoteScreenPlayer.get(c))||o.destroy(),t.renderDom){var d=new VideoPlayer(this.id,_objectSpread2(_objectSpread2({},t),{},{isScreen:!0}));this._remoteScreenPlayer.set(c,d),this._initPlayerEvents(d,!1,e);var p=null==(s=null==(a=this._room)?void 0:a.remoteStreams.get(c))?void 0:s.find((function(e){return e.isScreen}));return p&&this._updateVideoPlayerState(p),d.domElement}}},{key:"setLocalVideoMirrorType",value:function(e){this.logger.info("setLocalVideoMirrorType()","mirrorType: %o",e),checkEnum(e,"mirrorType",[MirrorType.MIRROR_TYPE_NONE,MirrorType.MIRROR_TYPE_RENDER]),this._mirrorType=e,this._videoPlayer&&this._videoPlayer.mirror(!!e)}},{key:"setAudioPlaybackDevice",value:(q=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("setAudioPlaybackDevice()","deviceId: %s",t),checkString(t,"deviceId"),e.next=3,this._audioDeviceManager.setSinkId(t);case 3:r=e.sent,this._remoteAudioPlayer.forEach((function(e){e.setPlaybackDevice(t)})),this._remoteScreenAudioPlayer.forEach((function(e){e.setPlaybackDevice(t)})),this.safeEmit(EngineEventsTypes.onAudioPlaybackDeviceChanged,r),this.monitor.report("rtc_audio_device",{audio_event:"playout_device_switch",message:JSON.stringify(r),error_code:0});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return q.apply(this,arguments)})},{key:"play",value:(W=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=g.length>1&&void 0!==g[1]?g[1]:MediaType.AUDIO_AND_VIDEO,n=g.length>2?g[2]:void 0,this.logger.info("play()","userId: %s, mediaType: %s, streamIndex: %s",t,r,n),u=!t||t===this._getUserId()||"local_user"===t,l=void 0===n||n===StreamIndex.STREAM_INDEX_MAIN,d=void 0===n||n===StreamIndex.STREAM_INDEX_SCREEN,p=r!==MediaType.VIDEO,_=r!==MediaType.AUDIO,h=[],u&&_&&(l&&this._localVideoTrack&&(null==(i=this._videoPlayer)||i.mirror(!!this._mirrorType),h.push(null==(o=this._videoPlayer)?void 0:o.manuallyPlay())),d&&this._localScreenVideoTrack&&h.push(null==(a=this._screenPlayer)?void 0:a.manuallyPlay())),t===this._audioMixingManager.id&&h.push(this._audioMixingManager.resumeLocalPlay()),f=null==(s=this._room)?void 0:s.remoteStreams,_&&l&&h.push(playRemoteStream(this._remoteVideoPlayer,t,!1,f)),_&&d&&h.push(playRemoteStream(this._remoteScreenPlayer,t,!0,f)),p&&l&&h.push(playRemoteStream(this._remoteAudioPlayer,t,!1,f)),_&&d&&h.push(playRemoteStream(this._remoteScreenAudioPlayer,t,!0,f)),m=null==(c=this._publicStreamManager)?void 0:c.remoteStreams,e.abrupt("return",(p&&h.push(playRemoteStream(this._publicStreamVideoPlayer,t,!1,m)),_&&h.push(playRemoteStream(this._publicStreamAudioPlayer,t,!1,m)),Promise.all(h).then((function(){}))));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return W.apply(this,arguments)})},{key:"pauseAllSubscribedStream",value:(Y=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("pauseAllSubscribedStream()","mediaType: %o",t),this._checkMediaType(t),audioInMediaType(t)&&(a._pauseAllSubscribeState.audio=!0),videoInMediaType(t)&&(a._pauseAllSubscribeState.video=!0),this._room){e.next=3;break}return e.abrupt("return",Promise.resolve());case 3:r=[],n=_createForOfIteratorHelper(this._room.remoteStreams.values());try{for(n.s();!(i=n.n()).done;)o=i.value,Array.isArray(o)&&o.forEach((function(e){if(e.hasSubscribed){a._pauseAllSubscribeState.resumeStreamIds[e.streamId]=e.streamId;var n=a._unsubscribe(e.isScreen,e.userId,t,!0);n&&r.push(n)}}))}catch(err2){n.e(err2)}finally{n.f()}return e.abrupt("return",Promise.all(r).then((function(){})));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return Y.apply(this,arguments)})},{key:"resumeAllSubscribedStream",value:(z=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("resumeAllSubscribedStream()","mediaType: %o",t),this._checkMediaType(t),audioInMediaType(t)&&(a._pauseAllSubscribeState.audio=!1),videoInMediaType(t)&&(a._pauseAllSubscribeState.video=!1),this._room){e.next=3;break}return e.abrupt("return",Promise.resolve());case 3:r=[],n=_createForOfIteratorHelper(this._room.remoteStreams.values());try{for(n.s();!(i=n.n()).done;)o=i.value,Array.isArray(o)&&o.forEach((function(e){if(a._pauseAllSubscribeState.resumeStreamIds[e.streamId]){delete a._pauseAllSubscribeState.resumeStreamIds[e.streamId];var n=a._subscribe(e.isScreen,e.userId,t);n&&r.push(n)}}))}catch(err2){n.e(err2)}finally{n.f()}return e.abrupt("return",Promise.all(r).then((function(){var e;null==(e=a._room)||e.remoteStreams.forEach((function(e){Array.isArray(e)&&e.forEach((function(e){a._updateAudioPlayerState(e),a._updateVideoPlayerState(e)}))}))})));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return z.apply(this,arguments)})},{key:"sendUserMessage",value:(H=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return checkUserId(t),checkBufferSize(r),this._assertNotInRoom(),o=Date.now(),e.abrupt("return",null==(i=null==(n=this._room)?void 0:n.sendUserMessage(t,r))?void 0:i.then((function(e){return a._messageStatisticsObserver.countP2PMessage(!0,t,!1,o,e),e.id})).catch((function(e){throw a._messageStatisticsObserver.countP2PMessage(!1,t,!1,o,e),e})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return H.apply(this,arguments)})},{key:"sendUserBinaryMessage",value:(K=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return checkUserId(t),checkArrayBuffer(r,"message"),checkBufferSize(r),this._assertNotInRoom(),o=Date.now(),e.abrupt("return",null==(i=null==(n=this._room)?void 0:n.sendUserMessage(t,r))?void 0:i.then((function(e){return a._messageStatisticsObserver.countP2PMessage(!0,t,!0,o,e),e.id})).catch((function(e){throw a._messageStatisticsObserver.countP2PMessage(!1,t,!0,o,e),e})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return K.apply(this,arguments)})},{key:"sendRoomMessage",value:(j=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return checkBufferSize(t),this._assertNotInRoom(),i=Date.now(),e.abrupt("return",null==(n=null==(r=this._room)?void 0:r.sendRoomMessage(t))?void 0:n.then((function(e){var t,r;return o._messageStatisticsObserver.countRoomMessage(!0,null==(r=null==(t=o._room)?void 0:t.roomInfo)?void 0:r.roomId,!1,i),e})).catch((function(e){var t,r;throw o._messageStatisticsObserver.countRoomMessage(!1,null==(r=null==(t=o._room)?void 0:t.roomInfo)?void 0:r.roomId,!1,i),e})));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)})},{key:"sendRoomBinaryMessage",value:(G=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return checkBufferSize(t),this._assertNotInRoom(),i=Date.now(),e.abrupt("return",null==(n=null==(r=this._room)?void 0:r.sendRoomMessage(t,!0))?void 0:n.then((function(e){var t,r;return o._messageStatisticsObserver.countRoomMessage(!0,null==(r=null==(t=o._room)?void 0:t.roomInfo)?void 0:r.roomId,!0,i),e})).catch((function(e){var t,r;throw o._messageStatisticsObserver.countRoomMessage(!1,null==(r=null==(t=o._room)?void 0:t.roomInfo)?void 0:r.roomId,!0,i),e})));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"setAudioCaptureConfig",value:(V=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=r.length>0&&void 0!==r[0]?r[0]:{},this.logger.info("setAudioCaptureConfig()","config: %o",t),delete t.deviceId,checkSupportedConstraints(t),this._shouldUpdateAudioConf("setAudioCaptureConfig")&&this._ctx.audioProfileManager.updateConstraints(t);case 2:case"end":return e.stop()}}),e,this)}))),function(){return V.apply(this,arguments)})},{key:"setVideoCaptureConfig",value:(F=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.abrupt("return",(this.logger.info("setVideoCaptureConfig()","config: %o",t),this._setVideoCaptureConfig(t)));case 2:case"end":return e.stop()}}),e,this)}))),function(){return F.apply(this,arguments)})},{key:"_setVideoCaptureConfig",value:(U=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(delete(t=i.length>0&&void 0!==i[0]?i[0]:{}).deviceId,checkSupportedConstraints(t),n=_objectSpread2(_objectSpread2({},t),{},{deviceId:this._videoStreamConstraints.deviceId}),e.t0=this._localVideoTrack,!e.t0){e.next=7;break}return e.next=7,this._localVideoTrack.updateVideoCaptureConfig(n);case 7:return this._videoStreamConstraints=n,e.abrupt("return",(null==(r=this._localVideoTrack)?void 0:r.originTrack.getSettings())||{});case 9:case"end":return e.stop()}}),e,this)}))),function(){return U.apply(this,arguments)})},{key:"enableSimulcastMode",value:function(e){var t;return this.logger.info("enableSimulcastMode()","enabled: %o",e),this._enableSimulcast=e,14!==iOSVersion[0]&&((null==(t=this._room)?void 0:t.hasPublished)&&warnDevelopers("You must call this API before publishing the video streams"),!0)}},{key:"setVideoEncoderConfig",value:(B=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this.logger.info("setVideoEncoderConfig()"," descriptions: %o",t),Array.isArray(t)||(t=[t]),checkVideoEncoderConfig(t=t.filter((function(e){return!!e}))),t.length>3&&(warnDevelopers("setVideoEncoderConfig: You can set parameters for up to 3 streams"),t=t.slice(0,3)),o=1;o<t.length;o++)a=constraints2number(t[0].width)/constraints2number(t[o].width)||1,Math.floor(a)!==a&&warnDevelopers("setVideoEncoderConfig: The resolution setting needs to be an integer multiple");return t.sort((function(e,t){return t.maxKbps-e.maxKbps})),this._localVideoTrack&&(null==(r=t[0])?void 0:r.contentHint)&&this._localVideoTrack.setContentHint(null==(n=t[0])?void 0:n.contentHint),e.next=6,this._setVideoCaptureConfig(_objectSpread2({},t[0]));case 6:this._videoStreamEncodeConfig=t,this._updateDummyCaptureImage(StreamIndex.STREAM_INDEX_MAIN),(null==(i=this._room)?void 0:i.hasPublished)&&this._updatePublish();case 9:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"setVideoEncoderAutoConfigList",value:function(e){if(Array.isArray(e))return e.sort((function(e,t){return e.maxKbps-t.maxKbps})),_setVideoEncoderAutoConfigList(e)}},{key:"autoResetVideoEncoderConfig",value:function(e){var t=getVideoEncoderAutoConfigList();if(t.length){this._videoStreamEncodeConfig.length||(this._videoStreamEncodeConfig=[defaultVideoEncoderConfig]);var r=this._videoStreamEncodeConfig[0],n=e.width||constraints2number(r.width),i=e.height||constraints2number(r.height),o=n*i;if(!(constraints2number(r.width)*constraints2number(r.height)<=o)){var a,s,c=t[0];t.forEach((function(e){var t=constraints2number(e.width)*constraints2number(e.height);a||(o<t?a=e:c=e)})),s=a&&constraints2number(a.width)*constraints2number(a.height)-o<o-constraints2number(c.width)*constraints2number(c.height)?Object.assign({},a):Object.assign({},c),this._videoStreamEncodeConfig=this._videoStreamEncodeConfig.filter((function(e){return!(s&&constraints2number(e.width)*constraints2number(e.height)>=o&&(s.maxKbps=Math.min(e.maxKbps,s.maxKbps),1))})),this._videoStreamEncodeConfig.unshift({width:n,height:i,frameRate:e.frameRate?Math.round(e.frameRate):this._videoStreamEncodeConfig[0].frameRate,maxKbps:s.maxKbps}),this.logger.print("autoResetVideoEncoderConfig() result",JSON.stringify(this._videoStreamEncodeConfig)),reportRtcInvokeStatus(this.id,"autoResetVideoEncoderConfig",JSON.stringify(this._videoStreamEncodeConfig))}}}},{key:"setScreenEncoderConfig",value:($=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("setScreenEncoderConfig()","description: %o",t),this._screenStreamEncodeConfig=[t],e.t0=this._localScreenVideoTrack,!e.t0){e.next=9;break}if(e.t1="16.1"!==safariMinorVersion,!e.t1){e.next=8;break}return e.next=8,this._localScreenVideoTrack.updateVideoCaptureConfig(t);case 8:t.contentHint&&this._localScreenVideoTrack.setContentHint(t.contentHint);case 9:this._updateDummyCaptureImage(StreamIndex.STREAM_INDEX_SCREEN),(null==(r=this._room)?void 0:r.hasScreenPublished)&&this._updateScreenPublish();case 11:case"end":return e.stop()}}),e,this)}))),function(e){return $.apply(this,arguments)})},{key:"sendSEIMessage",value:function(e,t,r){var n,i,o,a;if(this.logger.info("sendSEIMessage()","streamIdex: %o, message: %o, repeatCount: %o",e,t,r),!isEncodedTransformSupported())throw new SDKError(ErrorCode.NOT_SUPPORTED,"Browser does not support sending SEI");checkEnum(e,"streamIndex",[StreamIndex.STREAM_INDEX_MAIN,StreamIndex.STREAM_INDEX_SCREEN]),checkNumber(r,"repeatCount",0,30);var s="string"==typeof t?new Uint8Array(Utils.str2ab(t)):t;if(t.length){var c;if(e===StreamIndex.STREAM_INDEX_MAIN){if(!(null==(i=null==(n=this._room)?void 0:n.localStream)?void 0:i.hasPublished))return;c=this._room.localStream}else{if(!(null==(a=null==(o=this._room)?void 0:o.localScreenStream)?void 0:a.hasPublished))return;c=this._room.localScreenStream}if(s.byteLength>4096)this.logger.warn("sei size must not bigger than 4KB");else{var u=genUuid();c.seiList.push({content:s,uuid:u,repeatCount:r}),setTimeout((function(){if(c){var e=c.seiList.findIndex((function(e){return e.uuid===u}));e&&c.seiList.splice(e,1)}}),2e3)}}else this.logger.warn("sei message must not be empty")}},{key:"setAudioVolumeIndicationInterval",value:function(e){var t=this;this.logger.info("setAudioVolumeIndicationInterval()","interval %o: ",e),("number"!=typeof e||e<200)&&(e=200);var r=[];this._audioVolumeIndicationTimer&&clearInterval(this._audioVolumeIndicationTimer),this._audioVolumeIndicationTimer=setInterval((function(){var e,n;r=[],null==(e=t._room)||e.remoteStreams.forEach((function(e,t){var n;if(0!==e.length){var i=e.find((function(e){return!e.isScreen})),o=null==(n=null==i?void 0:i.audioTrack)?void 0:n.getAudioLevel();r.push({userId:t,volume:o||0})}}));var i=null==(n=t._localAudioTrack)?void 0:n.getAudioLevel();r.push({userId:t._getUserId(),volume:i||0}),t.safeEmit(EngineEventsTypes.onAudioVolumeIndication,{speakers:r})}),e)}},{key:"_sendActiveSpeaker",value:function(e,t){var r;if(this._room&&this._room.remoteUsers.size>=1){var n,i,o=e[0],a=t.reduce((function(e,t){return e&&e.audioPropertiesInfo.nonlinearVolume>t.audioPropertiesInfo.nonlinearVolume?e:t}),void 0);if((n=o?a?o.audioPropertiesInfo.nonlinearVolume>a.audioPropertiesInfo.nonlinearVolume?o:a:o:a)&&n.audioPropertiesInfo.nonlinearVolume>-35)(i=n.streamKey?this._room.remoteUsers.get(n.streamKey.userId):null==(r=this._room._roomInfo)?void 0:r.userInfo)&&this.safeEmit(EngineEventsTypes.onActiveSpeaker,{userId:i.userId,extraInfo:i.extraInfo})}}},{key:"enableAudioPropertiesReport",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger.info("enableAudioPropertiesReport()","config %o: ",t);var r=t.enableInBackground,n=void 0===r||r,i=t.localMainReportMode,o=void 0===i?LocalMainReportMode.NORMAL:i,a=t.audioReportMode,s=void 0===a?AudioReportMode.MICROPHONE:a,c=t.interval,u=void 0===c?100:c;this._stopAudioPropertiesReport(),u<=0||(u=Math.max(100,u),this._audioPropertiesReportTimer=self.setInterval((function(){var t,r;if(n||"hidden"!==document.visibilityState){var i=[],a=e._audioDeviceManager.getRecordTrack()||e._localAudioTrack;if(a){var c=null==(r=null==(t=e._room)?void 0:t.localStream)?void 0:r.audioHasPublish,u=!!e._audioDeviceManager.getRecordTrack(),l=a.getAudioLevel(s),d=getNonlinearVolume(l),p={streamIndex:StreamIndex.STREAM_INDEX_MAIN,audioPropertiesInfo:{linearVolume:l,nonlinearVolume:d}};if(c||u)i.push(p);else switch(o){case LocalMainReportMode.DISCONNECT:break;case LocalMainReportMode.RESET:p.audioPropertiesInfo.linearVolume=0,p.audioPropertiesInfo.nonlinearVolume=-127,i.push(p);break;case LocalMainReportMode.NORMAL:i.push(p);break;default:throw new SDKError(ErrorCode.INVALID_PARAMS,"invalid localMainReportMode: ".concat(o," in config"))}}if(e._localScreenAudioTrack){var _=e._localScreenAudioTrack.getAudioLevel();i.push({streamIndex:StreamIndex.STREAM_INDEX_SCREEN,audioPropertiesInfo:{linearVolume:_,nonlinearVolume:getNonlinearVolume(_)}})}if(e.safeEmit(EngineEventsTypes.onLocalAudioPropertiesReport,i),e._room){var h=[];e._room.multiChatMode?e._room.getActiveSpeakerInMultiChatMode().forEach((function(t){var r,n,i,o=255*t.audioLevel;h.push({streamKey:{userId:t.userId,streamIndex:StreamIndex.STREAM_INDEX_MAIN,roomId:null!==(r=null==(i=null==(n=e._room)?void 0:n._roomInfo)?void 0:i.roomId)&&void 0!==r?r:""},audioPropertiesInfo:{linearVolume:o,nonlinearVolume:getNonlinearVolume(o)}})})):e._room.remoteStreams.forEach((function(t,r){t.forEach((function(t){var n,i;if(t.audioTrack){var o,a=t.audioTrack.getAudioLevel();h.push({streamKey:{userId:r,streamIndex:t.isScreen?StreamIndex.STREAM_INDEX_SCREEN:StreamIndex.STREAM_INDEX_MAIN,roomId:null!==(o=null==(i=null==(n=e._room)?void 0:n.roomInfo)?void 0:i.roomId)&&void 0!==o?o:""},audioPropertiesInfo:{linearVolume:a,nonlinearVolume:getNonlinearVolume(a)}})}}))})),e.safeEmit(EngineEventsTypes.onRemoteAudioPropertiesReport,h),e._sendActiveSpeaker(i,h.filter((function(e){return e.streamKey.streamIndex!==StreamIndex.STREAM_INDEX_SCREEN})))}}}),u))}},{key:"setVideoSourceType",value:(L=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R,C,k;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("setVideoSourceType()","index: %o, videoSourceType: %o",t,r),checkEnum(t,"streamIndex",[StreamIndex.STREAM_INDEX_MAIN,StreamIndex.STREAM_INDEX_SCREEN]),checkEnum(r,"VideoSourceType",[VideoSourceType.VIDEO_SOURCE_TYPE_EXTERNAL,VideoSourceType.VIDEO_SOURCE_TYPE_INTERNAL]),T=t===StreamIndex.STREAM_INDEX_MAIN?"video":"screenVideo",this._trackSourceType[T]===r){e.next=23;break}if(this._trackSourceType[T]=r,this.logger.print("setVideoSourceType","set ".concat(T," source type to ").concat(r)),!this._localVideoTrack||t!==StreamIndex.STREAM_INDEX_MAIN){e.next=13;break}if(b=!1,r===VideoSourceType.VIDEO_SOURCE_TYPE_EXTERNAL&&(b=!0,(R=this._extensionManager.getPluginByName(RTCExtensionType.PRE_PROCESSING,"RTCBeautyExtension"))&&R.emit("stop"),this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close()),null==(n=this._videoPlayer)||n.stop(),this._localVideoTrack=void 0,C=null==(i=this._room)?void 0:i._roomConfig.isAutoPublish,b?null==(s=null==(a=null==(o=this._room)?void 0:o.localStream)?void 0:a.observer)||s.setEnableVideo(!1):null==(l=null==(u=null==(c=this._room)?void 0:c.localStream)?void 0:u.observer)||l.setPushVideo(!1),e.t0=(null==(p=null==(d=this._room)?void 0:d.localStream)?void 0:p.pubVideo)||C,!e.t0){e.next=13;break}return e.next=13,this._updatePublish();case 13:if(!this._localScreenVideoTrack||t!==StreamIndex.STREAM_INDEX_SCREEN){e.next=23;break}if(k=!1,r===VideoSourceType.VIDEO_SOURCE_TYPE_EXTERNAL&&(k=!0,this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.close()),null==(_=this._screenPlayer)||_.stop(),this._localScreenVideoTrack=void 0,k?null==(m=null==(f=null==(h=this._room)?void 0:h.localScreenStream)?void 0:f.observer)||m.setEnableVideo(!1):null==(y=null==(v=null==(g=this._room)?void 0:g.localScreenStream)?void 0:v.observer)||y.setPushVideo(!1),e.t1=null==(E=null==(S=this._room)?void 0:S.localScreenStream)?void 0:E.pubVideo,!e.t1){e.next=23;break}return e.next=23,this._updateScreenPublish();case 23:case"end":return e.stop()}}),e,this)}))),function(e,t){return L.apply(this,arguments)})},{key:"setExternalVideoTrack",value:(x=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l,d,p,_,h,f;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("setExternalVideoTrack()","index: %o, track: %o",t,r),checkEnum(t,"streamIndex",[StreamIndex.STREAM_INDEX_MAIN,StreamIndex.STREAM_INDEX_SCREEN]),checkMediaStreamTrack(r),t!==StreamIndex.STREAM_INDEX_MAIN){e.next=14;break}if(this._trackSourceType.video===VideoSourceType.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=3;break}throw new SDKError(ErrorCode.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as external first");case 3:return e.next=5,createCustomVideoLocalTrack(r,this._extensionManager);case 5:if(this._localVideoTrack=e.sent,!r.contentHint&&(null==(n=this._videoStreamEncodeConfig[0])?void 0:n.contentHint)&&this._localVideoTrack.setContentHint(null==(i=this._videoStreamEncodeConfig[0])?void 0:i.contentHint),this._initLocalTrackEvents(this._localVideoTrack),null==(o=this._videoPlayer)||o.playVideo(this._localVideoTrack),f=null==(a=this._room)?void 0:a._roomConfig.isAutoPublish,e.t0=(null==(c=null==(s=this._room)?void 0:s.localStream)?void 0:c.pubVideo)||f,!e.t0){e.next=14;break}return e.next=14,this._updatePublish();case 14:if(t!==StreamIndex.STREAM_INDEX_SCREEN){e.next=27;break}if(this._trackSourceType.screenVideo===VideoSourceType.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=17;break}throw new SDKError(ErrorCode.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as external first");case 17:return e.next=19,createCustomScreenVideoLocalTrack(r,this._extensionManager);case 19:if(this._localScreenVideoTrack=e.sent,this._initLocalTrackEvents(this._localScreenVideoTrack,!0),null==(u=this._screenPlayer)||u.playVideo(this._localScreenVideoTrack),null==(p=null==(d=null==(l=this._room)?void 0:l.localScreenStream)?void 0:d.observer)||p.setPushVideo(!0),e.t1=null==(h=null==(_=this._room)?void 0:_.localScreenStream)?void 0:h.pubVideo,!e.t1){e.next=27;break}return e.next=27,this._updateScreenPublish();case 27:case"end":return e.stop()}}),e,this)}))),function(e,t){return x.apply(this,arguments)})},{key:"setAudioSourceType",value:(N=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("setAudioSourceType()","index: %o, audioSourceType: %o",t,r),checkEnum(t,"streamIndex",[StreamIndex.STREAM_INDEX_MAIN,StreamIndex.STREAM_INDEX_SCREEN]),checkEnum(r,"audioSourceType",[AudioSourceType.AUDIO_SOURCE_TYPE_EXTERNAL,AudioSourceType.AUDIO_SOURCE_TYPE_INTERNAL]),S=t===StreamIndex.STREAM_INDEX_MAIN?"audio":"screenAudio",this._trackSourceType[S]===r){e.next=21;break}if(this._trackSourceType[S]=r,this.logger.print("setVideoSourceType","set ".concat(S," source type to ").concat(r)),!this._localAudioTrack||t!==StreamIndex.STREAM_INDEX_MAIN){e.next=12;break}if(E=!1,this._trackSourceType.audio===AudioSourceType.AUDIO_SOURCE_TYPE_EXTERNAL&&(E=!0,this._removeLocalTrackEvents(this._localAudioTrack),this._localAudioTrack.close()),this._localAudioTrack=void 0,T=null==(n=this._room)?void 0:n._roomConfig.isAutoPublish,E?null==(a=null==(o=null==(i=this._room)?void 0:i.localStream)?void 0:o.observer)||a.setEnableAudio(!1):null==(u=null==(c=null==(s=this._room)?void 0:s.localStream)?void 0:c.observer)||u.setPushAudio(!1),e.t0=(null==(d=null==(l=this._room)?void 0:l.localStream)?void 0:d.pubAudio)||T,!e.t0){e.next=12;break}return e.next=12,this._updatePublish();case 12:if(!this._localScreenAudioTrack||t!==StreamIndex.STREAM_INDEX_SCREEN){e.next=21;break}if(b=!1,this._trackSourceType.audio===AudioSourceType.AUDIO_SOURCE_TYPE_EXTERNAL&&(b=!0,this._removeLocalTrackEvents(this._localScreenAudioTrack),this._localScreenAudioTrack.close()),this._localScreenAudioTrack=void 0,b?null==(h=null==(_=null==(p=this._room)?void 0:p.localScreenStream)?void 0:_.observer)||h.setEnableAudio(!1):null==(g=null==(m=null==(f=this._room)?void 0:f.localScreenStream)?void 0:m.observer)||g.setPushAudio(!1),e.t1=null==(y=null==(v=this._room)?void 0:v.localScreenStream)?void 0:y.pubAudio,!e.t1){e.next=21;break}return e.next=21,this._updateScreenPublish();case 21:case"end":return e.stop()}}),e,this)}))),function(e,t){return N.apply(this,arguments)})},{key:"setExternalAudioTrack",value:(D=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l,d,p,_,h;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("setExternalAudioTrack()","index: %o, track: %o",t,r),checkEnum(t,"streamIndex",[StreamIndex.STREAM_INDEX_MAIN,StreamIndex.STREAM_INDEX_SCREEN]),checkMediaStreamTrack(r),t!==StreamIndex.STREAM_INDEX_MAIN){e.next=14;break}if(this._trackSourceType.audio===AudioSourceType.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=3;break}throw new SDKError(ErrorCode.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as external first");case 3:return e.next=5,createCustomAudioLocalTrack(r,this._extensionManager);case 5:if(this._localAudioTrack=e.sent,this._localAudioTrack.setVolume(this._localAudioVolume),this._initLocalTrackEvents(this._localAudioTrack),h=null==(n=this._room)?void 0:n._roomConfig.isAutoPublish,null==(a=null==(o=null==(i=this._room)?void 0:i.localStream)?void 0:o.observer)||a.setPushAudio(!0),e.t0=(null==(c=null==(s=this._room)?void 0:s.localStream)?void 0:c.pubAudio)||h,!e.t0){e.next=14;break}return e.next=14,this._updatePublish();case 14:if(t!==StreamIndex.STREAM_INDEX_SCREEN){e.next=27;break}if(this._trackSourceType.screenAudio===AudioSourceType.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=17;break}throw new SDKError(ErrorCode.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as external first");case 17:return e.next=19,createCustomScreenAudioLocalTrack(r,this._extensionManager);case 19:if(this._localScreenAudioTrack=e.sent,this._localScreenAudioTrack.setVolume(this._localScreenAudioVolume),this._initLocalTrackEvents(this._localScreenAudioTrack),null==(d=null==(l=null==(u=this._room)?void 0:u.localScreenStream)?void 0:l.observer)||d.setPushAudio(!0),e.t1=null==(_=null==(p=this._room)?void 0:p.localScreenStream)?void 0:_.pubAudio,!e.t1){e.next=27;break}return e.next=27,this._updateScreenPublish();case 27:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"login",value:(w=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.logger.info("login()","token: %o, userInfo: %o",t,r),isEmpty(t)||checkString(t,"token"),checkUserId(r),this._rtmClient.login(t,r)));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return w.apply(this,arguments)})},{key:"logout",value:(P=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.logger.info("logout()"),this._rtmClient.logout()));case 1:case"end":return e.stop()}}),e,this)}))),function(){return P.apply(this,arguments)})},{key:"updateLoginToken",value:(M=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.logger.info("updateLoginToken()","token: %o",t),isEmpty(t)||checkString(t,"token"),this._rtmClient.updateLoginToken(t)));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"getPeerOnlineStatus",value:(O=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.logger.info("getPeerOnlineStatus()","userId: %o",t),checkUserId(t),this._rtmClient.getPeerOnlineStatus(t)));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"sendUserMessageOutsideRoom",value:(A=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return checkUserId(t),checkBufferSize(r),n=Date.now(),e.abrupt("return",this._rtmClient.sendUserMessageOutsideRoom(t,r).then((function(e){return i._messageStatisticsObserver.countUserMessageOutsideRoom(!0,t,!1,n,e),e.id})).catch((function(e){throw i._messageStatisticsObserver.countUserMessageOutsideRoom(!1,t,!1,n,e),e})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return A.apply(this,arguments)})},{key:"sendUserBinaryMessageOutsideRoom",value:(I=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return checkUserId(t),checkArrayBuffer(r,"message"),checkBufferSize(r),n=Date.now(),e.abrupt("return",this._rtmClient.sendUserMessageOutsideRoom(t,r).then((function(e){return i._messageStatisticsObserver.countUserMessageOutsideRoom(!0,t,!0,n,e),e.id})).catch((function(e){throw i._messageStatisticsObserver.countUserMessageOutsideRoom(!1,t,!0,n,e),e})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return I.apply(this,arguments)})},{key:"setServerParams",value:(k=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.logger.info("setServerParams()","signature: %o, url: %0",t,r),this._rtmClient.setServerParams(t,r)));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return k.apply(this,arguments)})},{key:"sendServerMessage",value:(C=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return checkString(t,"message"),checkBufferSize(t),r=Date.now(),e.abrupt("return",this._rtmClient.sendServerMessage(t).then((function(e){n._messageStatisticsObserver.countServerMessage(!0,!1,r,e)})).catch((function(e){throw n._messageStatisticsObserver.countServerMessage(!1,!1,r,e),e})));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"sendServerBinaryMessage",value:(R=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return checkArrayBuffer(t,"message"),checkBufferSize(t),r=Date.now(),e.abrupt("return",this._rtmClient.sendServerMessage(t).then((function(e){n._messageStatisticsObserver.countServerMessage(!0,!0,r,e)})).catch((function(e){throw n._messageStatisticsObserver.countServerMessage(!1,!0,r,e),e})));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"startCloudProxy",value:function(e){if(this._room)throw new SDKError(ErrorCode.START_CLOUD_PROXY_AFTER_JOIN,"[startCloudProxy] should be invoke before join room ");this.logger.info("startCloudProxy()",e),checkString(e.logProxy,"logProxy"),checkString(e.accessProxy,"accessProxy"),checkString(e.configProxy,"configProxy"),this._originIceConfigRequestUrls=getParameter("ICE_CONFIG_REQUEST_URLS"),this._originLogServerUrl=getParameter("LOG_SERVER_URL"),this._originConfigServerUrls=getParameter("CONFIG_REQUEST_DOMAINS"),setParameter("ICE_CONFIG_REQUEST_URLS",e.accessProxy),setParameter("LOG_SERVER_URL",getFullLogServerUrl(e.logProxy)),setParameter("CONFIG_REQUEST_DOMAINS",[e.configProxy]),sdkCache.clearAccessNode(this._appId),sdkCache.clearAccessUrls(),this._ctx.useCloudProxy=!0}},{key:"stopCloudProxy",value:function(){var e,t,r,n;if(this._room)throw new SDKError(ErrorCode.STOP_CLOUD_PROXY_BEFORE_LEAVE,"[stopCloudProxy] should be invoke after leave room ");this.logger.info("stopCloudProxy()"),setParameter("ICE_CONFIG_REQUEST_URLS",null!==(e=null==(n=this._originIceConfigRequestUrls)?void 0:n.map((function(e){return e.replace("https://","").replace("/dispatch/v1/AccessInfo?Action=GetAccessInfo","")})))&&void 0!==e?e:[]),setParameter("LOG_SERVER_URL",null!==(t=this._originLogServerUrl)&&void 0!==t?t:""),setParameter("CONFIG_REQUEST_DOMAINS",null!==(r=this._originConfigServerUrls)&&void 0!==r?r:[]),sdkCache.clearAccessNode(this._appId),sdkCache.clearAccessUrls(),this._ctx.useCloudProxy=!1,this._startCloudProxyTimestamp=void 0}},{key:"startPushPublicStream",value:(b=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("startPushPublicStream()","publicStreamId: %o, publicStreamParam: %o",t,r),checkPublicStreamId(t),this._assertNotInRoom(),!this._publicStreamIds.get(t)){e.next=2;break}throw new SDKError(ErrorCode.REPEAT_PUSH,"repeat push public media stream");case 2:return o=getPublicStreamControlMessage(t,"started",r),e.abrupt("return",null==(i=null==(n=this._room)?void 0:n.publicStreamControlMessage(o))?void 0:i.then((function(){a._publicStreamIds.set(t,t)})));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return b.apply(this,arguments)})},{key:"updatePublicStreamParam",value:(T=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.print("startPushPublicStream()","publicStreamId: %o, publicStreamParam: %o",t,r),checkPublicStreamId(t),this._assertNotInRoom(),i=getPublicStreamControlMessage(t,"layoutChanged",r),e.abrupt("return",null==(n=this._room)?void 0:n.publicStreamControlMessage(i));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return T.apply(this,arguments)})},{key:"stopPushPublicStream",value:(E=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.logger.print("startPushPublicStream()","publicStreamId: %o",t),checkPublicStreamId(t),this._assertNotInRoom(),null==(r=this._room)?void 0:r.publicStreamControlMessage({type:"publicstream",action:"stopped",publicStreamID:t}).then((function(){n._publicStreamIds.delete(t)}))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"startPlayPublicStream",value:(S=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(checkPublicStreamId(t),e.t0=this._publicStreamManager,e.t0){e.next=9;break}return this._publicStreamManager=new OutsideRoom(this.id,this._appId,{businessId:this._businessId}),this._publicStreamManager.on(RoomEvent.RESUBSCRIBE,(function(e){var t,r,n=e.stream;if(n){var i=a._publicStreamAudioPlayer.get(n.streamId);i&&n.audioTrack&&(i.stop(),i.playAudio(null==(t=e.stream)?void 0:t.audioTrack));var o=a._publicStreamVideoPlayer.get(n.streamId);o&&n.videoTrack&&o.playVideo(null==(r=e.stream)?void 0:r.videoTrack)}})),this._publicStreamManager.on("onRemoteStreamStats",(function(e){e.publicStreamId=e.userId,delete e.userId,delete e.isScreen,a.safeEmit(EngineEventsTypes.onPublicStreamStats,e)})),this._publicStreamManager.on(RoomEvent.ON_SEI_MESSAGED_RECEIVED,(function(e){a.safeEmit(EngineEventsTypes.onPublicStreamSEIMessageReceived,e)})),e.next=9,this._publicStreamManager.connect();case 9:return e.next=11,this._publicStreamManager.startPlayPublicStream(t);case 11:n=e.sent,(i=this._publicStreamVideoPlayer.get(t))&&n.videoTrack&&i.playVideo(n.videoTrack,n),!(o=this._publicStreamAudioPlayer.get(t))&&n.audioTrack&&(o=new AudioPlayer(this.id,t,{muted:(null==(r=this._config)?void 0:r.autoPlayPolicy)===RTCAutoPlayPolicy.VIDEO_ONLY,isScreen:!1}),n.audioTrack.setPlayer(o),this._initPlayerEvents(o,!0),o.playAudio(n.audioTrack),this._publicStreamAudioPlayer.set(t,o));case 16:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"stopPlayPublicStream",value:(y=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._publicStreamManager){e.next=2;break}return e.abrupt("return");case 2:this._publicStreamManager.stopPlayPublicStream(t),(r=this._publicStreamAudioPlayer.get(t))&&(r.destroy(),this._publicStreamAudioPlayer.delete(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"setAudioProfile",value:(v=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.info("setAudioProfile()","profile: %o",t),this._shouldUpdateAudioConf("setAudioProfile")&&this._ctx.audioProfileManager.setAudioProfile(t);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"setAudioEncodeMaxBitrate",value:(g=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("setAudioEncodeMaxBitrate()",t),checkNumber(t,"maxBitrate",6,256),this._ctx.audioProfileManager.setCustomMaxBitrate(t),!this._ctx.audioProfileManager.customMaxBitrate){e.next=7;break}if(!isFirefox||!(null==(n=null==(r=this._room)?void 0:r.localStream)?void 0:n.pubAudio)&&!(null==(o=null==(i=this._room)?void 0:i.localScreenStream)?void 0:o.pubAudio)){e.next=3;break}throw new SDKError(ErrorCode.NOT_SUPPORTED,"Your browser does not support set audio encode maxBitrate dynamically.");case 3:return e.next=5,null==(a=this._room)?void 0:a.setAudioEncodeMaxBitrate(StreamIndex.STREAM_INDEX_MAIN,t);case 5:return e.next=7,null==(s=this._room)?void 0:s.setAudioEncodeMaxBitrate(StreamIndex.STREAM_INDEX_SCREEN,t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"setPublicStreamVideoPlayer",value:function(e,t){var r,n;this.logger.print("setPublicStreamVideoPlayer()","publicStreamId: %o, videoPlayerOption: %o",e,t);var i=this._publicStreamVideoPlayer.get(e);if(null==i||i.destroy(),t.renderDom){i=new VideoPlayer(this.id,_objectSpread2(_objectSpread2({},t),{},{userId:e})),this._initPlayerEvents(i,!0),this._publicStreamVideoPlayer.set(e,i);var o=null==(r=this._publicStreamManager)?void 0:r.remoteStreams.get(e);(null==o?void 0:o.videoTrack)&&(null==(n=this._config)?void 0:n.autoPlayPolicy)!==RTCAutoPlayPolicy.PLAY_MANUALLY&&i.playVideo(o.videoTrack,o)}else this._publicStreamVideoPlayer.delete(e)}},{key:"setDummyCaptureImagePath",value:(m=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,i){checkString(r,"filePath");var o=new Image;o.crossOrigin="anonymous",o.src=r,o.onload=function(){t===StreamIndex.STREAM_INDEX_MAIN?n._dummyMainImage=o:n._dummyScreenImage=o;try{n._updateDummyCaptureImage(t),e()}catch(r){i(new SDKError(ErrorCode.UNEXPECTED_ERROR,r.message))}},o.onerror=function(){i(new SDKError(ErrorCode.UNEXPECTED_ERROR,"Load image error"))}})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return m.apply(this,arguments)})},{key:"_updateDummyCaptureImage",value:function(e){var t,r,n,i;if(e===StreamIndex.STREAM_INDEX_MAIN?(n=this._dummyMainImage,i=this._videoStreamEncodeConfig[0]):(n=this._dummyScreenImage,i=this._screenStreamEncodeConfig[0]),n){var o,a,s=document.createElement("canvas"),c=s.getContext("2d"),u=constraints2number(i.width),l=constraints2number(i.height);if(!c)throw new SDKError(ErrorCode.UNEXPECTED_ERROR,"Not support canvas");!u||!l||n.width<=u&&n.height<=l?(o=n.width,a=n.height):(o=Math.min(u,n.width*l/n.height),a=Math.min(l,n.height*u/n.width)),s.width=o,s.height=a,c.drawImage(n,0,0,n.width,n.height,0,0,o,a);var d=window.setInterval((function(){n&&c.drawImage(n,0,0,n.width,n.height,0,0,o,a)}),200);e===StreamIndex.STREAM_INDEX_MAIN?(clearInterval(this._dummyMainTimer),this._dummyMainTimer=d):(clearInterval(this._dummyScreenTimer),this._dummyScreenTimer=d);var p=s.captureStream(5).getVideoTracks()[0];e===StreamIndex.STREAM_INDEX_MAIN?(this._localImgVideoTrack=p,(null==(t=this._localVideoTrack)?void 0:t.dummy)&&this._localVideoTrack.setTrack(this._localImgVideoTrack,this._extensionManager)):(this._localImgScreenTrack=p,(null==(r=this._localScreenVideoTrack)?void 0:r.dummy)&&this._localScreenVideoTrack.setTrack(this._localImgScreenTrack,this._extensionManager))}}},{key:"_addListenExtensionEvent",value:function(e){var t=this;e.on("re-capture-audio",(function(){t._localAudioTrack&&t.stopAudioCapture().then((function(){t.startAudioCapture()}))})),e.on("re-capture-video",(function(){t._localVideoTrack&&!t._localVideoTrack.dummy&&t.stopVideoCapture().then((function(){t.startVideoCapture()}))})),e.on("reset-video-effect",function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(r,n){var i,o,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t._localVideoTrack||t._localVideoTrack.dummy){e.next=18;break}return t._localVideoTrack&&t._removeLocalTrackEvents(t._localVideoTrack),e.prev=2,e.next=5,t._localVideoTrack.generatePreProcessingTrack(t._extensionManager);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),n(e.t0);case 10:if(t._initLocalTrackEvents(t._localVideoTrack),(null==(i=t._videoPlayer)?void 0:i.played)&&(t._videoPlayer.stop(),t._videoPlayer.playVideo(t._localVideoTrack),t._videoPlayer.mirror(!!t._mirrorType)),t.safeEmit(EngineEventsTypes.onLocalStreamTrackChangedByExtension,{streamIndex:StreamIndex.STREAM_INDEX_MAIN,type:"video"}),r(),e.t1=null==(a=null==(o=t._room)?void 0:o.localStream)?void 0:a.pubVideo,!e.t1){e.next=18;break}return e.next=18,t._updatePublish();case 18:r();case 19:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t,r){return e.apply(this,arguments)}}())}},{key:"registerExtension",value:(f=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.monitor=this.monitor,e.prev=1,e.next=4,t.isSupported();case 4:if(e.sent){e.next=6;break}throw new Error("This extension is not supported.");case 6:e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(1),new Error("This extension is not supported.");case 11:return e.next=13,t.init({videoCaptureConfig:this._videoStreamConstraints});case 13:this._extensionManager.register(t),this._addListenExtensionEvent(t),null==(r=this._localAudioTrack)||r.generatePreProcessingTrack(this._extensionManager),null==(n=this._localVideoTrack)||n.generatePreProcessingTrack(this._extensionManager);case 17:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e){return f.apply(this,arguments)})},{key:"defaultTranscoding",value:function(){return JSON.parse(JSON.stringify(LiveTranscoding.getDefaultValue()))}},{key:"_updatePublish",value:(h=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:{},this.logger.info("_updatePublish()","config: %o",t),t=_objectSpread2(_objectSpread2({},{mediaType:void 0,invokeByJoinRoom:!1,pubState:PubState.PUB}),t),this._visibility){e.next=4;break}throw new SDKError(ErrorCode.NO_PUBLISH_PERMISSION,"no publish permission");case 4:return e.next=6,this._pubLock.lock();case 6:if(r=e.sent,!this._room||this._room.connectionState!==MediaConnectionState.CONNECTED){e.next=21;break}return e.prev=8,e.next=11,this._room.publish(this._videoStreamEncodeConfig,this._enableSimulcast,this._localVideoTrack,this._localAudioTrack,t.mediaType,t.pubState,t.invokeByJoinRoom);case 11:e.next=16;break;case 13:throw e.prev=13,e.t0=e.catch(8),e.t0 instanceof SDKError?e.t0:new SDKError(ErrorCode.UNEXPECTED_ERROR,"unexpected error",e.t0);case 16:return e.prev=16,r(),e.finish(16);case 19:e.next=22;break;case 21:r();case 22:case"end":return e.stop()}}),e,this,[[8,13,16,19]])}))),function(){return h.apply(this,arguments)})},{key:"startAudioPlaybackDeviceTest",value:(_=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.print("startAudioPlaybackDeviceTest()","filePath: %o, indicationInterval: %o",t,r),checkString(t,"filePath"),checkNumber(r,"indicationInterval"),e.next=5,this._audioDeviceManager.startAudioPlaybackDeviceTest(t,r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return _.apply(this,arguments)})},{key:"stopAudioPlaybackDeviceTest",value:function(){this.logger.info("stopAudioPlaybackDeviceTest()"),this._audioDeviceManager.stopAudioPlaybackDeviceTest()}},{key:"startAudioDeviceRecordTest",value:(p=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.print("startAudioDeviceRecordTest()","indicationInterval: %o",t),checkNumber(t,"indicationInterval"),e.next=4,this._audioDeviceManager.startAudioDeviceRecordTest(t,r,this._localAudioVolume);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"stopAudioDeviceRecordAndPlayTest",value:function(){this.logger.info("stopAudioDeviceRecordAndPlayTest()"),this._audioDeviceManager.stopAudioDeviceRecordAndPlayTest()}},{key:"stopAudioDevicePlayTest",value:function(){this.logger.info("stopAudioDevicePlayTest()"),this._audioDeviceManager.stopAudioDevicePlayTest()}},{key:"setRemoteUserPriority",value:function(e,t){var r;this.logger.print("setRemoteUserPriority()","userId: %o, priority: %o",e,t);try{checkUserId(e),checkEnum(t,"priority",[RemoteUserPriority.HIGH,RemoteUserPriority.MEDIUM,RemoteUserPriority.LOW])}catch(n){return console.warn(n),!1}return this._ctx.userPriority.set(e,t),null==(r=this._room)||r.updateRemoteUserPriority(e),!0}},{key:"takeLocalSnapshot",value:(d=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("takeLocalSnapshot()","streamIndex: %o",t),checkEnum(t,"streamIndex",[StreamIndex.STREAM_INDEX_MAIN,StreamIndex.STREAM_INDEX_SCREEN]),r=t===StreamIndex.STREAM_INDEX_MAIN?this.localVideoTrack:this.localScreenVideoTrack){e.next=4;break}throw new SDKError(ErrorCode.INVOKED_BEFORE_CAPTURE,"capture first");case 4:return n=t===StreamIndex.STREAM_INDEX_MAIN?this._videoPlayer:this._screenPlayer,e.abrupt("return",takeSnapshot(r.preprocessingTrack,(null==n?void 0:n.mirrorType)===MirrorType.MIRROR_TYPE_RENDER,n));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"takeRemoteSnapshot",value:(l=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("takeRemoteSnapshot()","id: %o, streamIndex: %o",t,r),checkString(t,"id"),checkEnum(r,"streamIndex",[StreamIndex.STREAM_INDEX_MAIN,StreamIndex.STREAM_INDEX_SCREEN]),c=(null==(o=null==(i=null==(n=this._room)?void 0:n.remoteStreams.get(t))?void 0:i.find((function(e){return e.isScreen===(r===StreamIndex.STREAM_INDEX_SCREEN)})))?void 0:o.videoTrack)||(null==(s=null==(a=this._publicStreamManager)?void 0:a.remoteStreams.get(t))?void 0:s.videoTrack)){e.next=4;break}throw new SDKError(ErrorCode.STREAM_NOT_EXIST,"stream not exist");case 4:return e.abrupt("return",takeSnapshot(c.preprocessingTrack,!1,r===StreamIndex.STREAM_INDEX_MAIN?this._remoteVideoPlayer.get(t):this._remoteScreenPlayer.get(t)));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"setSubscribeFallbackOption",value:function(e){this.logger.info("setSubscribeFallbackOption()","option: %o",e);try{checkEnum(e,"option",[SubscribeFallbackOption.DISABLE,SubscribeFallbackOption.VIDEO_STREAM_LOW,SubscribeFallbackOption.AUDIO_ONLY])}catch(t){return console.warn(t),!1}return!this._room&&(this._ctx.subscribeFallbackOption=e,!0)}},{key:"getLocalStreamTrack",value:function(e,t){var r,n,i=this;if(e===StreamIndex.STREAM_INDEX_MAIN?(r="video"===t?this.localVideoTrack:this.localAudioTrack,n=function(){var e;return null==(e=i._room)?void 0:e.localStream}):(r="video"===t?this.localScreenVideoTrack:this.localScreenAudioTrack,n=function(){var e;return null==(e=i._room)?void 0:e.localScreenStream}),r){var o=r instanceof runtimeTrackCls.LocalAudioTrack&&r.mixedAudioTrack?r.mixedAudioTrack:r.preprocessingTrack;if(o){var a=n();return this._reportMsTrackEvent(o,(null==a?void 0:a.stream.id)||"local"),o}}}},{key:"getRemoteStreamTrack",value:function(e,t,r){var n,i,o,a=(null==(n=this._room)?void 0:n.remoteStreams.get(e))||[];if(a&&a.length&&(t===StreamIndex.STREAM_INDEX_MAIN?(o=a.find((function(e){return!e.isScreen})),i="video"===r?null==o?void 0:o.videoTrack:null==o?void 0:o.audioTrack):(o=a.find((function(e){return e.isScreen})),i="video"===r?null==o?void 0:o.videoTrack:null==o?void 0:o.audioTrack),i)){var s=i.preprocessingTrack;if(s&&o){var c=o.streamId;return this._reportMsTrackEvent(s,c),s}}}},{key:"getPublicStreamTrack",value:function(e,t){if(this._publicStreamManager&&this._publicStreamManager.remoteStreams){var r=this._publicStreamManager.remoteStreams.get(e);if(r){var n="video"===t?r.videoTrack:r.audioTrack;if(n){var i=n.preprocessingTrack;if(i){var o=r.streamId;return this._reportMsTrackEvent(i,o),i}}}}}},{key:"setRemoteStreamRenderSync",value:function(e){return!this._room&&(this._ctx.avSync=!!e,!0)}},{key:"setJoinRoomParams",value:function(e){e&&(this._ctx.joinRoomParams=e)}},{key:"setCaptureVolume",value:function(e,t){var r,n,i,o,a,s=this;checkEnum(e,"streamIndex",[StreamIndex.STREAM_INDEX_MAIN,StreamIndex.STREAM_INDEX_SCREEN]),t=numberRangeGuide(t,"volume",0,400),e===StreamIndex.STREAM_INDEX_SCREEN?(null==(r=this._localScreenAudioTrack)||r.once("needReplaceTrack",(function(){var e;null==(e=s._room)||e.updatePubScreenTrack()})),null==(n=this._localScreenAudioTrack)||n.setVolume(t),this._localScreenAudioVolume=t):(null==(i=this._localAudioTrack)||i.once("needReplaceTrack",(function(){var e;null==(e=s._room)||e.updatePubTrack()})),null==(o=this._localAudioTrack)||o.setVolume(t),null==(a=this._audioDeviceManager.audioTrack)||a.setVolume(t),this._localAudioVolume=t)}},{key:"setPlaybackVolume",value:function(e,t,r){var n,i,o,a;if(checkUserId(e),checkEnum(t,"streamIndex",[StreamIndex.STREAM_INDEX_MAIN,StreamIndex.STREAM_INDEX_SCREEN]),r=numberRangeGuide(r,"volume",0,400),null==(n=this._room)?void 0:n.multiChatMode)warnDevelopers("setPlaybackVolume is not supported in Conference mode");else{var s=t===StreamIndex.STREAM_INDEX_SCREEN;s?this._remoteScreenAudioVolume.set(e,r):this._remoteAudioVolume.set(e,r);var c=null==(o=null==(i=this._room)?void 0:i.remoteStreams.get(e))?void 0:o.find((function(e){return e.isScreen===s}));null==(a=null==c?void 0:c.audioTrack)||a.setVolume(r)}}},{key:"setPublicStreamVolume",value:function(e,t){var r,n,i;checkString(e,"publicStreamId"),t=numberRangeGuide(t,"volume",0,400),this._publicAudioVolume.set(e,t),null==(i=null==(n=null==(r=this._publicStreamManager)?void 0:r.remoteStreams.get(e))?void 0:n.audioTrack)||i.setVolume(t)}},{key:"startForwardStreamToRooms",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.forEach((function(e){checkRoomId(e.roomId)})),this._assertNotInRoom(),e.next=3,this._room.startForwardStream2Rooms(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"updateForwardStreamToRooms",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.forEach((function(e){checkRoomId(e.roomId)})),this._assertNotInRoom(),e.next=3,this._room.updateForwardStream2Rooms(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"stopForwardStreamToRooms",value:(s=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertNotInRoom(),e.next=3,this._room.stopForwardStream2Rooms();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"pauseForwardStreamToAllRooms",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertNotInRoom(),e.next=3,this._room.pauseForwardStream2AllRooms();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"resumeForwardStreamToAllRooms",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertNotInRoom(),e.next=3,this._room.resumeForwardStream2AllRooms();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"ambulance",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_ambulance2(this);case 2:return t=e.sent,r=JSON.stringify(t),e.abrupt("return",(this.monitor.reportLongString("ambulance",r),t));case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_reportMsTrackEvent",value:function(e,t){var r=this;if(!e.hookStop){e.hookStop=!0;var n=e.stop;e.stop=function(){reportRtcInvokeStatus(r.id,"stop",t,0,t),n.call(e)}}}},{key:"_updateScreenPublish",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},this.logger.info("_updateScreenPublish()"),t=_objectSpread2(_objectSpread2({},{mediaType:void 0,pubState:PubState.PUB}),t),e.next=5,this._pubLock.lock();case 5:if(r=e.sent,!this._room||this._room.connectionState!==MediaConnectionState.CONNECTED){e.next=20;break}return e.prev=7,e.next=10,this._room.publishScreen(this._screenStreamEncodeConfig,this._localScreenVideoTrack,this._localScreenAudioTrack,t.mediaType,t.pubState);case 10:e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(7),e.t0 instanceof SDKError?e.t0:new SDKError(ErrorCode.UNEXPECTED_ERROR,"unexpected error",e.t0);case 15:return e.prev=15,r(),e.finish(15);case 18:e.next=21;break;case 20:r();case 21:case"end":return e.stop()}}),e,this,[[7,12,15,18]])}))),function(){return n.apply(this,arguments)})},{key:"_updateAudioPlayerState",value:function(e){var t,r;this.logger.info("_updateAudioPlayerState()");var n,i=e.userId,o=e.isScreen,a=o?this._remoteScreenAudioPlayer:this._remoteAudioPlayer,s=a.get(i);if(e.audioTrack&&e.attributes.audiostream&&e.subAudio){var c,u;if(!s){s=new AudioPlayer(this.id,i,{muted:(null==(t=this._config)?void 0:t.autoPlayPolicy)===RTCAutoPlayPolicy.VIDEO_ONLY,isScreen:o}),this._initPlayerEvents(s,!1,o?StreamIndex.STREAM_INDEX_SCREEN:StreamIndex.STREAM_INDEX_MAIN),a.set(i,s);var l=this._audioDeviceManager.getSinkId();l&&s.setPlaybackDevice(l)}(null==(r=this._config)?void 0:r.autoPlayPolicy)!==RTCAutoPlayPolicy.PLAY_MANUALLY&&s.playAudio(e.audioTrack),e.audioTrack.setPlayer(s);var d=o?null!==(c=this._remoteScreenAudioVolume.get(i))&&void 0!==c?c:100:null!==(u=this._remoteAudioVolume.get(i))&&void 0!==u?u:100;e.audioTrack.setVolume(d),isSafari&&isIPad&&(n=this._remoteAudioPlayer,remoteAudioReplayTimer&&clearTimeout(remoteAudioReplayTimer),remoteAudioReplayTimer=setTimeout((function(){var e,t=_createForOfIteratorHelper(n);try{for(t.s();!(e=t.n()).done;){var r=_slicedToArray(e.value,2),i=r[0],o=r[1];(null==i?void 0:i.startsWith("mux"))&&o.pause()}}catch(err2){t.e(err2)}finally{t.f()}var a,s=_createForOfIteratorHelper(n);try{for(s.s();!(a=s.n()).done;){var c=_slicedToArray(a.value,2),u=c[0],l=c[1];(null==u?void 0:u.startsWith("mux"))&&l.manuallyPlay()}}catch(err2){s.e(err2)}finally{s.f()}}),2e3))}else null==s||s.stop()}},{key:"_updateVideoPlayerState",value:function(e){var t;this.logger.info("_updateVideoPlayerState()");var r,n=e.userId;r=e.isScreen?this._remoteScreenPlayer.get(n):this._remoteVideoPlayer.get(n),e.videoTrack?r&&(null==(t=this._config)?void 0:t.autoPlayPolicy)!==RTCAutoPlayPolicy.PLAY_MANUALLY&&r.playVideo(e.videoTrack,e):(null==r?void 0:r.played)&&(null==r||r.stop())}},{key:"_onAddStream",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.stream,n=r.attributes,i=n.localaudio,o=n.audiostream,a=n.localvideo,s=n.videostream,c=ExtendMediaType.NONE,o&&(c|=MediaType.AUDIO),s&&(c|=MediaType.VIDEO),e.t0=c,!e.t0){e.next=11;break}return e.next=8,new Promise((function(e){return setTimeout(e)}));case 8:r.isScreen?this.safeEmit(EngineEventsTypes.onUserPublishScreen,{userId:r.userId,mediaType:c}):(this.safeEmit(EngineEventsTypes.onUserPublishStream,{userId:r.userId,mediaType:c,videoStreamDescriptions:r.attributes.videoDescriptions}),this._handleAutoSubscribe(r,!0)),this.safeEmit("onAddStream",{userId:r.userId,mediaType:c,isScreen:!!r.isScreen}),r.isScreen||(i&&this.safeEmit(EngineEventsTypes.onUserStartAudioCapture,{userId:r.userId}),a&&this.safeEmit(EngineEventsTypes.onUserStartVideoCapture,{userId:r.userId}));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_handleAutoSubscribe",value:function(e,t){var r,n,i,o,a=ExtendMediaType.NONE;(null==(r=this._roomConfig)?void 0:r.isAutoSubscribeAudio)&&(a|=MediaType.AUDIO),(null==(n=this._roomConfig)?void 0:n.isAutoSubscribeVideo)&&(a|=MediaType.VIDEO),a&&(t&&audioInMediaType(a)&&(null==(i=e.observer)||i.setAutoSubscribeAudio(!0)),t&&videoInMediaType(a)&&(null==(o=e.observer)||o.setAutoSubscribeVideo(!0)),this._subscribe(!1,e.userId,a))}},{key:"_onRemoveStream",value:function(e){var t,r=this,n=e.stream,i=null!==(t=StreamRemoveReasonMap[e.reason])&&void 0!==t?t:StreamRemoveReason.STREAM_REMOVE_REASON_OTHER,o=n.isScreen?EngineEventsTypes.onUserUnpublishScreen:EngineEventsTypes.onUserUnpublishStream,a=ExtendMediaType.NONE;n.attributes.audiostream&&(a|=MediaType.AUDIO),n.attributes.videostream&&(a|=MediaType.VIDEO),a!==ExtendMediaType.NONE&&(this.safeEmit(o,{userId:n.userId,mediaType:a,reason:i}),this.safeEmit("onRemoveStream",{userId:n.userId,isScreen:n.isScreen})),"function"==typeof e.callback&&e.callback(),this._getRemotePlayer(n.userId,n.isScreen).forEach((function(e){n.isScreen?(r._remoteScreenPlayer.delete(n.userId),r._remoteScreenAudioPlayer.delete(n.userId)):(r._remoteAudioPlayer.delete(n.userId),r._remoteVideoPlayer.delete(n.userId)),null==e||e.destroy()}))}},{key:"_onUserConnection",value:function(e){var t=this;setTimeout((function(){return t.safeEmit(EngineEventsTypes.onUserJoined,e)}))}},{key:"_onUserLeave",value:function(e){var t=this,r=e.userInfo;this._getRemotePlayer(r.userId,!0).forEach((function(e){t._remoteScreenAudioPlayer.delete(r.userId),t._remoteScreenPlayer.delete(r.userId),null==e||e.destroy()})),this._getRemotePlayer(r.userId,!1).forEach((function(e){t._remoteAudioPlayer.delete(r.userId),t._remoteVideoPlayer.delete(r.userId),null==e||e.destroy()})),this.safeEmit(EngineEventsTypes.onUserLeave,e)}},{key:"_onRoomError",value:function(e){var t;this.safeEmit(EngineEventsTypes.onError,e),null==(t=this._room)||t.destroy(),this._room=void 0}},{key:"_onNetworkQuality",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.safeEmit.apply(this,[EngineEventsTypes.onNetworkQuality].concat(t))}},{key:"_onConnectionStateChange",value:function(e){if(void 0!==this._startCloudProxyTimestamp&&this._ctx.useCloudProxy&&e.state===ConnectionState.CONNECTION_STATE_CONNECTED&&this.safeEmit(EngineEventsTypes.onCloudProxyConnected,{interval:Date.now()-this._startCloudProxyTimestamp}),this.safeEmit(EngineEventsTypes.onConnectionStateChanged,e),e.state===ConnectionState.CONNECTION_STATE_RECONNECTING){var t,r=_createForOfIteratorHelper(this._remoteAudioPlayer);try{for(r.s();!(t=r.n()).done;){var n=_slicedToArray(t.value,2),i=n[0],o=n[1];i.startsWith("mux")&&o.stop()}}catch(err2){r.e(err2)}finally{r.f()}}}},{key:"_getRemotePlayer",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:MediaType.AUDIO_AND_VIDEO,n=(t?this._remoteScreenAudioPlayer:this._remoteAudioPlayer).get(e),i=(t?this._remoteScreenPlayer:this._remoteVideoPlayer).get(e),o=[];return r&MediaType.AUDIO&&o.push(n),r&MediaType.VIDEO&&o.push(i),o}},{key:"_stopAudioPropertiesReport",value:function(){null!==this._audioPropertiesReportTimer&&(clearInterval(this._audioPropertiesReportTimer),this._audioPropertiesReportTimer=null)}},{key:"_onResubscribe",value:function(e){e.stream&&(this._getRemotePlayer(e.stream.userId,e.stream.isScreen).forEach((function(e){return null==e?void 0:e.stop()})),this._updateAudioPlayerState(e.stream),this._updateVideoPlayerState(e.stream))}},{key:"_onSubscribePushTrack",value:function(e){e.stream&&this._updateAudioPlayerState(e.stream)}},{key:"_onRemovePushTrack",value:function(e){var t=this;if(e.stream){this._updateAudioPlayerState(e.stream);var r=e.stream;this._getRemotePlayer(r.userId,r.isScreen,e.mediaType).forEach((function(n){e.mediaType&MediaType.AUDIO&&(r.isScreen?t._remoteScreenAudioPlayer.delete(r.userId):t._remoteAudioPlayer.delete(r.userId)),r.isScreen?e.mediaType&MediaType.VIDEO&&t._remoteScreenPlayer.delete(r.userId):e.mediaType&MediaType.VIDEO&&t._remoteVideoPlayer.delete(r.userId),null==n||n.destroy()}))}}},{key:"_onVideoDeviceStateChange",value:function(e){this.safeEmit(EngineEventsTypes.onVideoDeviceStateChanged,e)}},{key:"_onAudioDeviceStateChange",value:function(e){this.safeEmit(EngineEventsTypes.onAudioDeviceStateChanged,e)}},{key:"_onUserPublishStateChange",value:function(e){var t=this,r=e.userId,n=e.isScreen,i=e.mediaType,o=e.pubState,a=e.remoteStream,s={userId:r,mediaType:i};i&MediaType.AUDIO&&setTimeout((function(){t._updateAudioPlayerState(a)})),n?o===PubState.PUB?this.safeEmit(EngineEventsTypes.onUserPublishScreen,s):this.safeEmit(EngineEventsTypes.onUserUnpublishScreen,_objectSpread2(_objectSpread2({},s),{},{reason:StreamRemoveReason.STREAM_REMOVE_REASON_UNPUBLISH})):o===PubState.PUB?(s.videoStreamDescriptions=a.attributes.videoDescriptions,this.safeEmit(EngineEventsTypes.onUserPublishStream,s),this._handleAutoSubscribe(a,!0)):this.safeEmit(EngineEventsTypes.onUserUnpublishStream,_objectSpread2(_objectSpread2({},s),{},{reason:StreamRemoveReason.STREAM_REMOVE_REASON_UNPUBLISH}))}},{key:"_onCustomMessage",value:function(e){var t=e.message;e.binary?this.safeEmit(EngineEventsTypes.onRoomBinaryMessageReceived,{userId:e.clientId,message:t}):this.safeEmit(EngineEventsTypes.onRoomMessageReceived,{userId:e.clientId,message:t})}},{key:"_onUserMessageReceived",value:function(e){this._messageStatisticsObserver.recvP2PMessage(e.userId),this.safeEmit(EngineEventsTypes.onUserMessageReceived,e)}},{key:"_onUserBinaryMessageReceived",value:function(e){this._messageStatisticsObserver.recvP2PMessage(e.userId),this.safeEmit(EngineEventsTypes.onUserBinaryMessageReceived,e)}},{key:"_onLiveTranscodingResult",value:function(e){this.safeEmit(EngineEventsTypes.onLiveTranscodingResult,e)}},{key:"_onStreamMixingEvent",value:function(e){this.safeEmit(EngineEventsTypes.onStreamMixingEvent,e)}},{key:"_onUserTokenWillExpire",value:function(){this.safeEmit(EngineEventsTypes.onTokenWillExpire)}},{key:"_onPushPublicStreamResult",value:function(e){this.safeEmit(EngineEventsTypes.onPushPublicStreamResult,e)}},{key:"_handleRTMClient",value:function(e){var t=this;e.on("onUserMessageReceivedOutsideRoom",(function(e){t._messageStatisticsObserver.recvP2POutRoomMessage(e.userId),t.safeEmit(EngineEventsTypes.onUserMessageReceivedOutsideRoom,e)})),e.on("onUserBinaryMessageReceivedOutsideRoom",(function(e){t._messageStatisticsObserver.recvP2POutRoomMessage(e.userId),t.safeEmit(EngineEventsTypes.onUserBinaryMessageReceivedOutsideRoom,e)})),e.on("onUserDisconnection",(function(){t.safeEmit(EngineEventsTypes.onError,{errorCode:ErrorCode.RTM_DUPLICATE_LOGIN})})),e.on("onRTMTokenError",(function(){t.safeEmit(EngineEventsTypes.onError,{errorCode:ErrorCode.RTM_TOKEN_ERROR})})),e.on("onServerParamsSetResult",(function(e){t.safeEmit(EngineEventsTypes.onServerParamsSetResult,null==e?void 0:e.code)}))}},{key:"waitForNewToken",get:function(){return!!this._tempRoomInfo}},{key:"getSubLock",value:function(e,t){var r=e?this._subScreenLocks:this._subLocks,n=r.get(t);return n||(n=new PromiseLock2("sub_".concat(e?1:0,"_").concat(t)),r.set(t,n)),n}},{key:"localAudioTrack",get:function(){return this._localAudioTrack}},{key:"localVideoTrack",get:function(){return this._localVideoTrack}},{key:"localScreenAudioTrack",get:function(){return this._localScreenAudioTrack}},{key:"localScreenVideoTrack",get:function(){return this._localScreenVideoTrack}},{key:"remoteStreams",get:function(){var e,t=[];return(null==(e=this._room)?void 0:e.remoteStreams)&&this._room.remoteStreams.forEach((function(e){Array.isArray(e)&&e.forEach((function(e){t.push({userId:e.userId,isScreen:e.isScreen,hasVideo:e.hasVideo,hasAudio:e.hasAudio,videoStreamDescriptions:e.attributes.videoDescriptions})}))})),t}},{key:"iceState",get:function(){var e,t,r;return null==(r=null==(t=null==(e=this._room)?void 0:e._mediaServerClient.handler)?void 0:t._peerConnection)?void 0:r.iceConnectionState}},{key:"remoteUsers",get:function(){var e,t=[];return(null==(e=this._room)?void 0:e.remoteUsers)&&this._room.remoteUsers.forEach((function(e){t.push({userId:e.userId})})),t}},{key:"multiChatMode",get:function(){var e;return!!(null==(e=this._room)?void 0:e._mediaServerClient.roomAttributes.multiChatMode)}},{key:"checkMediaType",get:function(){return this._checkMediaType}},{key:"assertNotInRoom",get:function(){return this._assertNotInRoom}},{key:"_handleAudioDeviceManager",value:function(){var e=this;this._audioDeviceManager.on("onAudioPlaybackDeviceTestVolume",(function(t){e.safeEmit(EngineEventsTypes.onAudioPlaybackDeviceTestVolume,t)}))}},{key:"_assertNotInRoom",value:function(){if(!this._room||this._room.connectionState!==MediaConnectionState.CONNECTED)throw new SDKError(ErrorCode.NOT_CONNECTED_YET,"server not connected")}},{key:"_checkMediaType",value:function(e){checkEnum(e,"mediaType",[MediaType.AUDIO,MediaType.VIDEO,MediaType.AUDIO_AND_VIDEO])}},{key:"_getUserId",value:function(){var e,t;return(null==(t=null==(e=this._room)?void 0:e.roomInfo)?void 0:t.userInfo.userId)||"local_user"}},{key:"_switchTrack",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._initLocalTrackEvents(t),this._localVideoTrack=t,(null==(r=this._videoPlayer)?void 0:r.played)&&(this._videoPlayer.stop(),this._videoPlayer.playVideo(t),this._videoPlayer.mirror(!!this._mirrorType)),e.t0=null==(i=null==(n=this._room)?void 0:n.localStream)?void 0:i.pubVideo,!e.t0){e.next=7;break}return e.next=7,this._updatePublish();case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_shouldUpdateAudioConf",value:function(e){var t,r,n,i=(null==(t=this._room)?void 0:t.hasPublished)||(null==(n=null==(r=this._room)?void 0:r.localStream)?void 0:n.pubAudio)||this._localAudioTrack&&this._localAudioTrack.sourceType===SourceType.INTERNAL;if(i){var o="engine.".concat(e," should be called before publishing or capturing.");console.warn("[RTC WebSDK]: ".concat(o)),reportRtcInvokeStatus(this.id,e,o)}return!i}},{key:"_getServerConfig",value:function(){var e=this,t=sdkCache.getServerConfig(this.appId);t.rts_report&&RTSMsgReportor.setConfig(t.rts_report),this._ctx.joinRoomConfig.setServerConfig(t.web_join_room),this._getServerConfigExecutor(t),getServerConfig({engineId:this.id,appId:this.appId,sdkVersion:getParameter("VERSION"),requestDomains:getParameter("CONFIG_REQUEST_DOMAINS"),keys:["rts_report","web_join_room","web_rtc_config"],deviceId:getParameter("DEVICE_ID")}).then((function(t){sdkCache.setServerConfig(e.appId,t)}))}},{key:"_getServerConfigExecutor",value:function(e){var t,r,n,i;CoreConfig.setParameter("UPLOAD_CONSOLE_ON",!!(null==(t=null==e?void 0:e.web_rtc_config)?void 0:t.upload_console_on)),CoreConfig.setParameter("UPLOAD_CONSOLE_LENGTH_CUT",null==(r=null==e?void 0:e.web_rtc_config)?void 0:r.upload_console_length_cut),CoreConfig.setParameter("UPLOAD_REPORT_LIMIT",null==(n=null==e?void 0:e.web_rtc_config)?void 0:n.upload_report_limit),CoreConfig.setParameter("ENABLE_REPORT_IDB_BUFFER",!!(null==(i=null==e?void 0:e.web_rtc_config)?void 0:i.enable_report_idb_buffer))}}]),ke}(EnhancedEventEmitter);__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"updateToken",1),__decorateClass$1([reportRtcSdkApiCall(),captureLock("video")],RTCEngine$1.prototype,"setVideoCaptureDevice",1),__decorateClass$1([reportRtcSdkApiCall(),captureLock("audio")],RTCEngine$1.prototype,"setAudioCaptureDevice",1),__decorateClass$1([setJoinRoomInfo,reportRtcSdkApiCall()],RTCEngine$1.prototype,"connect",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"joinRoom",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"leaveRoom",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"destroy",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"publishStream",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"unpublishStream",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"publishScreen",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"unpublishScreen",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"subscribeStream",1),__decorateClass$1([subLock],RTCEngine$1.prototype,"_subscribe",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"unsubscribeStream",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"subscribeScreen",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"unsubscribeScreen",1),__decorateClass$1([subLock],RTCEngine$1.prototype,"_unsubscribe",1),__decorateClass$1([reportRtcSdkApiCall(),subLock2],RTCEngine$1.prototype,"setRemoteVideoConfig",1),__decorateClass$1([reportRtcSdkApiCall(),captureLock("video")],RTCEngine$1.prototype,"startVideoCapture",1),__decorateClass$1([reportRtcSdkApiCall(),captureLock("video")],RTCEngine$1.prototype,"stopVideoCapture",1),__decorateClass$1([reportRtcSdkApiCall(),captureLock("audio")],RTCEngine$1.prototype,"startAudioCapture",1),__decorateClass$1([reportRtcSdkApiCall(),captureLock("audio")],RTCEngine$1.prototype,"stopAudioCapture",1),__decorateClass$1([reportRtcSdkApiCall(),captureLock("all")],RTCEngine$1.prototype,"startAudioAndVideoCapture",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"startVideoAndAudioCapture",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"getAudioMixingManager",1),__decorateClass$1([reportRtcSdkApiCall(),screenCaptureLock],RTCEngine$1.prototype,"startScreenCapture",1),__decorateClass$1([reportRtcSdkApiCall(),screenCaptureLock],RTCEngine$1.prototype,"stopScreenCapture",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setLocalVideoPlayer",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"startLiveTranscoding",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"updateLiveTranscoding",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"stopLiveTranscoding",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"startSubtitle",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"stopSubtitle",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setBusinessId",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setUserVisibility",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setRemoteVideoPlayer",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setLocalVideoMirrorType",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setAudioPlaybackDevice",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"play",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"pauseAllSubscribedStream",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"resumeAllSubscribedStream",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"sendUserMessage",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"sendUserBinaryMessage",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"sendRoomMessage",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"sendRoomBinaryMessage",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setAudioCaptureConfig",1),__decorateClass$1([warnDeprecatedApi("4.51"),reportRtcSdkApiCall()],RTCEngine$1.prototype,"setVideoCaptureConfig",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"enableSimulcastMode",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setVideoEncoderConfig",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setScreenEncoderConfig",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"sendSEIMessage",1),__decorateClass$1([warnDeprecatedApi("4.42"),reportRtcSdkApiCall()],RTCEngine$1.prototype,"setAudioVolumeIndicationInterval",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"enableAudioPropertiesReport",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setVideoSourceType",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setExternalVideoTrack",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setAudioSourceType",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setExternalAudioTrack",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"login",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"logout",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"updateLoginToken",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"getPeerOnlineStatus",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"sendUserMessageOutsideRoom",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"sendUserBinaryMessageOutsideRoom",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setServerParams",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"sendServerMessage",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"sendServerBinaryMessage",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"startCloudProxy",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"stopCloudProxy",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"startPushPublicStream",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"updatePublicStreamParam",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"stopPushPublicStream",1),__decorateClass$1([reportRtcSdkApiCall("streamId")],RTCEngine$1.prototype,"startPlayPublicStream",1),__decorateClass$1([reportRtcSdkApiCall("streamId")],RTCEngine$1.prototype,"stopPlayPublicStream",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setAudioProfile",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setAudioEncodeMaxBitrate",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setPublicStreamVideoPlayer",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setDummyCaptureImagePath",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"registerExtension",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"startAudioPlaybackDeviceTest",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"stopAudioPlaybackDeviceTest",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"startAudioDeviceRecordTest",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"stopAudioDeviceRecordAndPlayTest",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"stopAudioDevicePlayTest",1),__decorateClass$1([reportRtcSdkApiCall(),subLock2],RTCEngine$1.prototype,"setRemoteUserPriority",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"takeLocalSnapshot",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"takeRemoteSnapshot",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setSubscribeFallbackOption",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"getLocalStreamTrack",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"getRemoteStreamTrack",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"getPublicStreamTrack",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setRemoteStreamRenderSync",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"setJoinRoomParams",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"startForwardStreamToRooms",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"updateForwardStreamToRooms",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"stopForwardStreamToRooms",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"pauseForwardStreamToAllRooms",1),__decorateClass$1([reportRtcSdkApiCall()],RTCEngine$1.prototype,"resumeForwardStreamToAllRooms",1);var StreamRemoveReasonMap={"client unpublished":StreamRemoveReason.STREAM_REMOVE_REASON_UNPUBLISH,"publish failed":StreamRemoveReason.STREAM_REMOVE_REASON_PUBLISH_FAILED,"stream removed":StreamRemoveReason.STREAM_REMOVE_REASON_KEEP_LIVE_FAILED,"client disconnected":StreamRemoveReason.STREAM_REMOVE_REASON_CLIENT_DISCONNECTED,"client republish":StreamRemoveReason.STREAM_REMOVE_REASON_REPUBLISH};function subLock(e,t,r){var n=r.value;return r.value=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,i,o,a,s,c,u=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=u.length,r=new Array(t),i=0;i<t;i++)r[i]=u[i];return o=r[0],a=r[1],s=r[2],this.checkMediaType(s),this.assertNotInRoom(),e.next=5,this.getSubLock(o,a).lock();case 5:return c=e.sent,e.prev=6,e.next=9,n.apply(this,r);case 9:return e.abrupt("return",e.sent);case 10:return e.prev=10,c(),e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[6,,10,13]])}))),r}function subLock2(e,t,r){var n=r.value;return r.value=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,i,o,a,s=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=s.length,r=new Array(t),i=0;i<t;i++)r[i]=s[i];return o=r[0],e.next=4,this.getSubLock(!1,o).lock();case 4:return a=e.sent,e.prev=5,e.next=8,n.apply(this,r);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,a(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[5,,9,12]])}))),r}function captureLock(e){return function(t,r,n){var i=n.value;return n.value=_asyncToGenerator(_regeneratorRuntime().mark((function t(){var r,n,o,a,s,c=arguments;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=[],"video"!==e&&r.push(this._audioCaptureLock.lock()),"audio"!==e&&r.push(this._videoCaptureLock.lock()),t.next=4,Promise.all(r);case 4:for(n=t.sent,t.prev=5,o=c.length,a=new Array(o),s=0;s<o;s++)a[s]=c[s];return t.next=9,i.apply(this,a);case 9:return t.abrupt("return",t.sent);case 10:return t.prev=10,n.forEach((function(e){return e()})),t.finish(10);case 13:case"end":return t.stop()}}),t,this,[[5,,10,13]])}))),n}}function screenCaptureLock(e,t,r){var n=r.value;return r.value=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,i,o,a=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._screenCaptureLock.lock();case 2:for(t=e.sent,e.prev=3,r=a.length,i=new Array(r),o=0;o<r;o++)i[o]=a[o];return e.next=7,n.apply(this,i);case 7:return e.abrupt("return",e.sent);case 8:return e.prev=8,t(),e.finish(8);case 11:case"end":return e.stop()}}),e,this,[[3,,8,11]])}))),r}var __defProp2=Object.defineProperty,__getOwnPropDesc$5=Object.getOwnPropertyDescriptor,__decorateClass$5=function(e,t,r,n){for(var i,o=n>1?void 0:n?__getOwnPropDesc$5(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&__defProp2(t,r,o),o},BLWRTCEngine=function(e){_inherits(i,e);var t,r,n=_createSuper(i);function i(e,t,r){var o;return _classCallCheck(this,i),o=n.call(this,e,t,r),__publicField(_assertThisInitialized(o),"singleStreamRenderMode",!1),o.id=t,o.logger=new Logger$1$1("BLWEngine",0,t),_setVideoEncoderAutoConfigList([{width:192,height:108,frameRate:15,maxKbps:100},{width:320,height:180,frameRate:15,maxKbps:140},{width:640,height:360,frameRate:15,maxKbps:400},{width:1280,height:720,frameRate:15,maxKbps:1e3},{width:1920,height:1080,frameRate:15,maxKbps:2e3}]),o._handleEngineEvents(),o}return _createClass(i,[{key:"subscribeStream",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.logger.print("subscribeStream()","userId: %o, mediaType: %o",t,r),this.singleStreamRenderMode&&videoInMediaType(r)&&_get(_getPrototypeOf(i.prototype),"subscribeScreen",this).call(this,t,MediaType.VIDEO).catch((function(e){n.logger.error("singleStreamRenderMode subscribeScreen()",e)})),_get(_getPrototypeOf(i.prototype),"subscribeStream",this).call(this,t,r)));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"unsubscribeStream",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.logger.print("unsubscribeStream()","userId: %o, mediaType: %o",t,r),this.singleStreamRenderMode&&videoInMediaType(r)&&_get(_getPrototypeOf(i.prototype),"unsubscribeScreen",this).call(this,t,MediaType.VIDEO).catch((function(e){n.logger.error("singleStreamRenderMode unsubscribeScreen()",e)})),_get(_getPrototypeOf(i.prototype),"unsubscribeStream",this).call(this,t,r)));case 1:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"setRemoteScreenVideoStreamIndex",value:function(e){var t;return this.logger.print("setRemoteScreenVideoStreamIndex()","streamIndex: %o",e),(null==(t=this._room)?void 0:t.connectionState)!==MediaConnectionState.CONNECTED&&(this.singleStreamRenderMode=e===StreamIndex.STREAM_INDEX_MAIN,!0)}},{key:"setRemoteVideoPlayer",value:function(e,t){if(this.logger.print("setRemoteVideoPlayer()","streamIndex: %o, videoPlayerOption: %o",e,t),!this.singleStreamRenderMode||e!==StreamIndex.STREAM_INDEX_SCREEN)return _get(_getPrototypeOf(i.prototype),"setRemoteVideoPlayer",this).call(this,e,t)}},{key:"destroy",value:function(){this.singleStreamRenderMode=!1,_get(_getPrototypeOf(i.prototype),"destroy",this).call(this)}},{key:"_updateVideoPlayerState",value:function(e){var t,r;if(!this.singleStreamRenderMode)return _get(_getPrototypeOf(i.prototype),"_updateVideoPlayerState",this).call(this,e);var n,o=e.userId,a=null==(t=this._room)?void 0:t.remoteStreams.get(o);Array.isArray(a)&&a.forEach((function(e){e.isScreen&&(n=e)}));var s=this._remoteVideoPlayer.get(o);return s?!e.isScreen&&(null==n?void 0:n.videoTrack)?(this.logger.print("_updateVideoPlayerState","prevent play main stream"),void s.playVideo(n.videoTrack,n)):void(e.videoTrack?(null==(r=this._config)?void 0:r.autoPlayPolicy)!==RTCAutoPlayPolicy.PLAY_MANUALLY&&s.playVideo(e.videoTrack,e):s.played&&s.stop()):void 0}},{key:"_handleEngineEvents",value:function(){var e=this;this.on(EngineEventsTypes.onUserPublishScreen,(function(t){var r,n;if(e.singleStreamRenderMode&&videoInMediaType(t.mediaType)){var i=null==(r=e._room)?void 0:r.remoteStreams.get(t.userId),o=null==i?void 0:i.find((function(e){return!e.isScreen})),a=null==i?void 0:i.find((function(e){return e.isScreen}));(null==a?void 0:a.hasSubscribed)?(e.logger.info("onUserPublishScreen","singleStreamRenderMode screen hasSubscribed"),e._updateVideoPlayerState(a)):((null==(n=e._roomConfig)?void 0:n.isAutoSubscribeVideo)||(null==o?void 0:o.hasSubscribed)&&videoInMediaType(o.subMediaType))&&(e.logger.info("onUserPublishScreen","singleStreamRenderMode subscribeScreen"),e.subscribeScreen(t.userId,MediaType.VIDEO))}})),this.on(EngineEventsTypes.onUserUnpublishScreen,(function(t){var r;if(e.singleStreamRenderMode&&videoInMediaType(t.mediaType)){var n=e._remoteVideoPlayer.get(t.userId),i=null==(r=e._room)?void 0:r.remoteStreams.get(t.userId),o=null==i?void 0:i.find((function(e){return!e.isScreen}));if(!(null==o?void 0:o.videoTrack)||!n)return;n.playVideo(o.videoTrack)}}))}}]),i}(RTCEngine$1);__decorateClass$5([reportRtcSdkApiCall()],BLWRTCEngine.prototype,"subscribeStream",1),__decorateClass$5([reportRtcSdkApiCall()],BLWRTCEngine.prototype,"unsubscribeStream",1),__decorateClass$5([reportRtcSdkApiCall()],BLWRTCEngine.prototype,"setRemoteScreenVideoStreamIndex",1),__decorateClass$5([reportRtcSdkApiCall()],BLWRTCEngine.prototype,"setRemoteVideoPlayer",1),__decorateClass$5([reportRtcSdkApiCall()],BLWRTCEngine.prototype,"destroy",1);var logger$d=new Logger$1$1("VERTC",0);iDB.storeKey="".concat(Date.now(),"-").concat(sdkCache.getDeviceId()),setGlobalStats({rtc_sdk_version:Config2.VERSION,device_id:sdkCache.getDeviceId(),log_cache_key:iDB.storeKey}),setReportUrl(Config2.LOG_SERVER_URL);var ENGINE_GUID=1,createEngine=function(e,t){logger$d.info("createEngine","Invoke VERTC.createEngine"),checkString(e,"appId");var r=(ENGINE_GUID++).toString();return createMonitor(r,{rtc_app_id:e,auto_play_policy:null==t?void 0:t.autoPlayPolicy}),new RTCEngine$1(e,r,t)},createBLWEngine=function(e,t){logger$d.print("createBLWEngine","Invoke VERTC.createBLWEngine"),checkString(e,"appId");var r=(ENGINE_GUID++).toString();return createMonitor(r,{rtc_app_id:e,auto_play_policy:null==t?void 0:t.autoPlayPolicy}),new BLWRTCEngine(e,r,t)},destroyEngine=function(e){if(logger$d.info("destroyEngine","Invoke VERTC.destroyEngine"),!(e instanceof RTCEngine$1))throw new SDKError(ErrorCode.INVALID_ENGINE,"Invalid engine object");var t;e.destroy(),(t=e.monitor).report("sdk_init_engine",{start:Date.now(),type:"end"}),monitorMap.delete(t.id)},enumerateDevices=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",dd$1.enumerateDevices());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),enableDevices=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o,a,s=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:{video:!0,audio:!0},r=t.video,n=t.audio,i={video:!1,audio:!1},!r){e.next=12;break}return e.prev=3,e.next=6,dd$1.getPermissions({video:!0,force:!0});case 6:o=e.sent,i.video=o.video,e.next=12;break;case 10:e.prev=10,e.t0=e.catch(3);case 12:if(!n){e.next=22;break}return e.prev=13,e.next=16,dd$1.getPermissions({audio:!0,force:!0});case 16:a=e.sent,i.audio=a.audio,e.next=22;break;case 20:e.prev=20,e.t1=e.catch(13);case 22:return e.abrupt("return",i);case 23:case"end":return e.stop()}}),e,null,[[3,10],[13,20]])})));return function(){return e.apply(this,arguments)}}(),enumerateAudioCaptureDevices=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",dd$1.enumerateAudioCaptureDevices());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),enumerateVideoCaptureDevices=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",dd$1.enumerateVideoCaptureDevices());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),enumerateAudioPlaybackDevices=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",dd$1.enumerateAudioPlaybackDevices());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getSdkVersion=function(){return Config2.VERSION},isSupported2=function(){return isSupported$1()},getSupportedCodecs2=function(){return getSupportedCodecs()},setLogConfig=function(e){var t=e.logLevel,r=e.LogfileSize;t&&(iDB.logLevel=t),r&&(iDB.LogfileSize=r)},downloadLog=function(e){iDB.download(e)};function stringifyParams(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return JSON.stringify(t.map((function(e){return e instanceof RTCEngine$1?"[ENGINE]":e})))}function reportVERTCApiCall(e,t){return function(){reportGlobalApiCall(t,0,stringifyParams.apply(void 0,arguments));var r=e.apply(void 0,arguments);return"function"==typeof(null==r?void 0:r.then)?r.then((function(e){return reportGlobalCallback(t,0,stringifyParams(e)),e})).catch((function(e){throw reportGlobalCallback(t,e.code,e.message),e})):(reportGlobalCallback(t,0,stringifyParams(r)),r)}}var VERTC=_createClass((function e(){_classCallCheck(this,e),__publicField(this,"getSdkVersion",reportVERTCApiCall(getSdkVersion,"getSdkVersion")),__publicField(this,"createEngine",reportVERTCApiCall(createEngine,"createEngine")),__publicField(this,"createBLWEngine",reportVERTCApiCall(createBLWEngine,"createBLWEngine")),__publicField(this,"destroyEngine",reportVERTCApiCall(destroyEngine,"destroyEngine")),__publicField(this,"enumerateDevices",reportVERTCApiCall(enumerateDevices,"enumerateDevices")),__publicField(this,"enableDevices",reportVERTCApiCall(enableDevices,"enableDevices")),__publicField(this,"enumerateAudioCaptureDevices",reportVERTCApiCall(enumerateAudioCaptureDevices,"enumerateAudioCaptureDevices")),__publicField(this,"enumerateVideoCaptureDevices",reportVERTCApiCall(enumerateVideoCaptureDevices,"enumerateVideoCaptureDevices")),__publicField(this,"enumerateAudioPlaybackDevices",reportVERTCApiCall(enumerateAudioPlaybackDevices,"enumerateAudioPlaybackDevices")),__publicField(this,"getParameter",getParameter),__publicField(this,"setParameter",setParameter),__publicField(this,"isSupported",reportVERTCApiCall(isSupported2,"isSupported")),__publicField(this,"getSupportedCodecs",reportVERTCApiCall(getSupportedCodecs2,"getSupportedCodecs")),__publicField(this,"events",EngineEventsTypes),__publicField(this,"ErrorCode",ErrorCode),__publicField(this,"platform","VolcEngine"),__publicField(this,"commitInfo","release_458<a6110228*>"),__publicField(this,"downloadLog",reportVERTCApiCall(downloadLog,"downloadLog")),__publicField(this,"setLogConfig",reportVERTCApiCall(setLogConfig,"setLogConfig"))})),index=new VERTC,LocationServiceHandler=function(){function e(t,r){var n=r.enable,i=void 0!==n&&n;_classCallCheck(this,e),this._player=t,this.logger=this._player.logger,this._locationPollFlag=!1,this._enable=i,this._mode=LOCATION_SERVICE_MODE.MODE_AUTO}return _createClass(e,[{key:"enableLocationService",value:function(e){this._enable=!!e}},{key:"isLocationServiceEnabled",value:function(){return this._enable}},{key:"setLocationServiceMode",value:function(e){this._mode=e}},{key:"getLocationServiceMode",value:function(){return this._mode}},{key:"setRemoteLocationMock",value:function(e){var t=this,r=e.latitude,n=e.longitude,i=MessageFactory$1.eventTypeFixLocation({latitude:r,longitude:n});this.logger.send("setRemoteLocationMock");var o=!1;return new Promise((function(e,r){var n=START_ERROR.ERROR_SDK_GENERAL.CODE,a=START_ERROR.ERROR_SDK_GENERAL.MESSAGE;t._player._sendCustomMessage(i).then((function(){var i;t._player.client.isReady?(t._player.client._client.on(index.events.onUserMessageReceived,i=function(r){var n=r.message&&JSON.parse(r.message);n&&n.command===SERVER_COMMAND.CMD_LOCATION_UPDATE&&(o=!0,e(n.data),t._player.client._client.off(index.events.onUserMessageReceived,i))}),setTimeout((function(){!1===o&&r({errorCode:n,message:a})}),3e4)):r({errorCode:n,message:a})})).catch((function(){r({errorCode:n,message:a})}))}))}},{key:"handleInputMethodEvent",value:function(e){if(navigator.geolocation&&this._enable&&this._mode===LOCATION_SERVICE_MODE.MODE_AUTO){if(!this._locationPollFlag&&e.command===SERVER_COMMAND.CMD_START_LOCATION_REQUEST&&"gps"===e.provider){var t=e.interval>5e3?e.interval:5e3;this._locationPollFlag=!0,this._getLocation(t)}e.command===SERVER_COMMAND.CMD_STOP_LOCATION_REQUEST&&(this._locationPollFlag=!1)}if(this._enable&&this._mode===LOCATION_SERVICE_MODE.MODE_MANUAL&&"gps"===e.provider){if(e.command===SERVER_COMMAND.CMD_START_LOCATION_REQUEST){var r=e.fastestInterval,n=e.numUpdates,i=e.provider,o=e.smallestDisplacement;this._player.emit("remote-location-request-received",{provider:i,fastestInterval:r,smallestDisplacement:o,numUpdates:n})}e.command===SERVER_COMMAND.CMD_STOP_LOCATION_REQUEST&&this._player.emit("remote-location-request-ended-received")}}},{key:"_getLocation",value:function(e){var t=this;navigator.geolocation.getCurrentPosition((function(r){var n=r.coords,i=n.longitude,o=n.latitude;t.logger.localInfoLog("PodTrigger","_getLocation","longitude: ".concat(i,",latitude: ").concat(o));var a=MessageFactory$1.eventTypeFixLocation({latitude:o,longitude:i});t._player._sendCustomMessage(a),t._locationPollFlag&&t._player.client.renderEle&&setTimeout((function(){t._getLocation(e)}),e)}),(function(e){var r=START_ERROR.ERROR_SDK_LACK_OF_LOCATION_PERMISSION;t.logger.localWarnLog("PodTrigger","_getLocation","获取经纬度失败：",e),t._player.emit("location-permission-error",{errorCode:r.CODE,errorMessage:r.MESSAGE})}))}},{key:"destroy",value:function(){this._locationPollFlag=!1}}]),e}(),ClipboardHandler=function(){function e(t){_classCallCheck(this,e),this._player=t}return _createClass(e,[{key:"sendClipBoardMessage",value:function(e){var t=MessageFactory$1.eventTypeClipboard(encodeURIComponent(e));return this._player._sendCustomMessage(t)}},{key:"handleClipboardEvent",value:function(e){var t,r=((null===(t=e.data)||void 0===t?void 0:t.clipData)||[]).map((function(e){return decodeURIComponent(e)}));this._player.emit("clipboard-message-received",r)}}]),e}(),ClipboardAutoSyncHandler=function(){function e(t,r){var n=r.containerDomId;_classCallCheck(this,e),this._player=t,this.logger=this._player.logger,this._containerDomId=n,this._clipboardText="",this._init()}return _createClass(e,[{key:"_init",value:function(){var e=this;if(navigator.clipboard){var t=document.getElementById(this._containerDomId);this._player.isPC||t.addEventListener("touchstart",(function(){navigator.clipboard.readText().then((function(t){if(t!==e._clipboardText){e._clipboardText=t;var r=MessageFactory$1.eventTypeClipboard(t);e._player._sendCustomMessage(r)}})).catch((function(t){e.logger.localWarnLog("PodTrigger","ClipboardAutoSyncHandler._init","clip error: ",t)}))}))}}},{key:"handleClipboardEvent",value:function(e){var t,r=this,n=null===(t=e.data)||void 0===t?void 0:t.clipData[0];navigator.clipboard&&navigator.clipboard.writeText(n).then((function(){r.logger.localInfoLog("PodTrigger","ClipboardAutoSyncHandler.handleClipboardEvent","clip write success")})).catch((function(e){r.logger.localWarnLog("PodTrigger","ClipboardAutoSyncHandler.handleClipboardEvent","clip write error: ",e)}))}}]),e}(),CommonHandler=function(){function e(t){_classCallCheck(this,e),this._player=t,this.logger=this._player.logger,this.podError=this._player.mode!==MODE.CLOUD_PHONE?POD_ERROR$1:_objectSpread2(_objectSpread2({},POD_ERROR$1),POD_ERROR_PHONE_EXTEND)}return _createClass(e,[{key:"handleErrorEvent",value:function(e){var t,r,n;console.log("🚀 ~ file: commonHandler.ts:26 ~handleErrorEvent msg:",e);var i=null,o=null===(t=e.data)||void 0===t?void 0:t.reason,a=this.podError,s=function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"errorCode";return _defineProperty$1(t={},r,e.CODE),_defineProperty$1(t,"message",e.MESSAGE),t};switch(o){case 0:i=s(a.ERROR_GAME_CRASH);break;case 1:i=s(a.ERROR_GAME_OFFLINE);break;case 2:i=s(a.ERROR_GAME_EXIT_TIMEOUT);break;case 3:i=s(a.ERROR_GAME_STOPPED_IDLE);break;case 4:i=s(a.ERROR_GAME_STOPPED_RESET);break;case 5:i=s(a.ERROR_GAME_STOPPED_API);break;case 6:i=s(a.ERROR_POD_STOPPED_BACKGROUND_TIMEOUT);break;case 7:i=s(a.WARNING_GAME_STOPPED_INGAME_EXIT,"warningCode");break;case 9:i=s(a.ERROR_REMOTE_POWER_OFF);break;default:i=s(a.ERROR_POD_EXIT_GENERAL)}this.logger.localWarnLog("PodTrigger","handleErrorEvent","pod error",i),this._player.logger.send("podError",{errc:null===(r=i)||void 0===r?void 0:r.errorCode,msg:null===(n=i)||void 0===n?void 0:n.message,reason:o}),i&&(this._player.emit(i.warningCode?"warning":"error",i),this._player._stop())}},{key:"handleAudioEvent",value:function(e){var t=e.subcmd;1===t&&this._player._enableLocalAudio(),2===t&&this._player._disableLocalAudio()}}]),e}(),VideoStreamProfileHandler=function(){function e(t){var r=this;_classCallCheck(this,e),this._player=t,this._player.on("messageShield",(function(e){var t=e.subType;if(e.type===PB_MESSAGE.TYPES.MsgAVOutput&&t===PB_MESSAGE.SUBTYPES.MsgAVOutputVideoFormatLevel){var n=POD_WARNING.WARNING_VIEWER_METHOD_CALLED,i=n.CODE,o=n.MESSAGE;r._player.emit("warning",{warningCode:i,message:o})}}))}return _createClass(e,[{key:"switchVideoStreamProfile",value:function(e){var t=this;return this._player.logger.send("switchVideoStreamProfile",{switchVideoStreamProfile:e}),new Promise((function(r,n){var i=START_ERROR.ERROR_SDK_GENERAL.CODE,o=START_ERROR.ERROR_SDK_GENERAL.MESSAGE,a=START_ERROR.ERROR_STREAM_CHANGE_CLARITY_ID_NOT_IN_START_STATE,s=MessageFactory$1.eventTypeClarityIndex({id:e});t._player._sendCustomMessageWithReturn({message:s,jsonCmd:SERVER_COMMAND.CMD_CLARITY_INDEX,pbType:PB_MESSAGE.TYPES.MsgAVOutput,pbSubType:PB_MESSAGE.SUBTYPES.MsgAVOutputVideoFormatLevel,transformPBMes:function(e){return{data:{result:e.result,from:e.levelFrom,current:e.levelTo,fps:e.format.fpsNom/e.format.fpsDen}}}}).then((function(e){var s=e.success,c=e.data,u=e.fromCatch;if(s){var l=t._handleVideoStreamProfileEvent(c);r(l)}else n({errorCode:u?i:a.CODE,message:u?o:a.MESSAGE})}))}))}},{key:"_handleVideoStreamProfileEvent",value:function(e){var t=e.data,r={before:t.from,after:t.current,fps:t.fps,result:null,reason:"",code:null};if(0===t.result)r.result=0,this._player.client.isReady&&t.fps&&(this._player.client.fps=t.fps);else if(2===t.result){r.result=2;var n=POD_ERROR$1.WARNING_VIDEO_PROFILE_NOT_SUPPORT_CURRENT_PLAN;r.reason=n.MESSAGE,r.code=n.CODE}else{var i=START_ERROR.ERROR_GAME_VIDEO_STREAM_PROFILE_NOT_IN_RANGE.MESSAGE;r.result=1,r.reason=i}return this._player.logger.send("switchVideoStreamProfileResult",r),{result:r.result,reason:r.reason,before:r.before,after:r.after,fps:r.fps,code:r.code}}}]),e}(),BackgroundHandler=function(){function e(t){_classCallCheck(this,e),this._player=t}return _createClass(e,[{key:"switchBackground",value:function(e){var t=this,r=MessageFactory$1.eventTypeUserStatus(e);return this._player.logger.send("switchBackground",{switchBackground:e}),new Promise((function(e,n){var i=START_ERROR.ERROR_SDK_GENERAL.CODE,o=START_ERROR.ERROR_SDK_GENERAL.MESSAGE;t._player._sendCustomMessageWithReturn({message:r,jsonCmd:SERVER_COMMAND.CMD_USERSTATUS,pbType:PB_MESSAGE.TYPES.MsgBusiness,pbSubType:PB_BUSINESS.SUBTYPES.UserStatus,transformPBMes:function(e){return e.action,{data:{result:e.result}}}}).then((function(r){var a=r.success,s=r.data;a?(console.log(s),function(t){0===t?e(t):2===t?n({errorCode:POD_ERROR$1.WARNING_LOCAL_ALREADY_SET_BACKGROUND.CODE,message:POD_ERROR$1.WARNING_LOCAL_ALREADY_SET_BACKGROUND.MESSAGE}):3===t&&n({errorCode:POD_ERROR$1.WARNING_LOCAL_ALREADY_SET_FOREGROUND.CODE,message:POD_ERROR$1.WARNING_LOCAL_ALREADY_SET_FOREGROUND.MESSAGE})}(t.handleBackgroundEvent(s,!0).result)):n({errorCode:i,message:o})}))}))}},{key:"handleBackgroundEvent",value:function(e,t){var r=e.data,n=r.result,i=r.current;if(1!==n||t)return{result:n,current:i};this._player.emit("background-switched",{current:i})}}]),e}(),AutoRecycleTimeHandler=function(){function e(t){_classCallCheck(this,e),this._player=t}var t;return _createClass(e,[{key:"_autoRecycleTime",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u,l,d,p,_,h,f,m,g=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t?"set":"get",i=MessageFactory$1.eventTypeAutoRecycleTime(t,r),this._player.logger.send("".concat(n,"AutoRecycleTime"),{time:r}),o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.result,r=void 0===t?1:t,i=e.error,o=void 0===i?POD_ERROR$1.ERROR_SET_INVALID_AUTO_RECYCLE_TIME:i,a=o.CODE,s=o.MESSAGE;if(g._player.logger.send("".concat(n,"AutoRecycleTimeResult"),_objectSpread2({result:r},0!==r&&{errc:a,msg:s})),1===r)throw{errorCode:a,message:s}},t&&r<=0&&o({error:POD_ERROR$1.ERROR_SET_INVALID_AUTO_RECYCLE_TIME}),e.next=7,this._player._sendCustomMessageWithReturn({message:i,jsonCmd:SERVER_COMMAND.CMD_AUTO_RECYCLE_TIME,pbType:PB_MESSAGE.TYPES.MsgBusiness,pbSubType:PB_BUSINESS.SUBTYPES.MsgBusinessAutoRecycleTime,transformPBMes:function(e){return{data:{action:e.action,result:e.result,current:e.current}}},onTimeout:o});case 7:if(a=e.sent,s=a.success,c=a.data,!s){e.next=21;break}if(u=c.data,l=u.result,d=void 0===l?0:l,p=u.action,_=void 0===p?0:p,h=u.current,f=void 0===h?0:h,m=t?0:1,0!==d||_!==m){e.next=18;break}return o({result:0}),e.abrupt("return",t?void 0:{duration:f});case 18:o({error:t?POD_ERROR$1.ERROR_SET_INVALID_AUTO_RECYCLE_TIME:void 0});case 19:e.next=22;break;case 21:o();case 22:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"setAutoRecycleTime",value:function(e){return this._autoRecycleTime(!0,e)}},{key:"getAutoRecycleTime",value:function(){return this._autoRecycleTime(!1)}}]),e}(),UserProfilePathHandler=function(){function e(t){_classCallCheck(this,e),this._player=t}var t;return _createClass(e,[{key:"setUserProfilePath",value:function(e){return this._userProfilePath(!0,e)}},{key:"getUserProfilePath",value:function(){return this._userProfilePath(!1)}},{key:"_userProfilePath",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c,u;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=MessageFactory$1.eventTypeProfilePath(t,r),this._player.logger.send("getUserProfilePath"),e.next=4,this._player._sendCustomMessageWithReturn({message:n,jsonCmd:[SERVER_COMMAND.CMD_PROFILE_PATH,SERVER_COMMAND.CMD_PROFILE_STATUS],pbType:PB_MESSAGE.TYPES.MsgBusiness,pbSubType:PB_BUSINESS.SUBTYPES.MsgBusinessUserProfile,throwGeneral:!0,transformPBMes:function(e){var t=e.action,r=e.path;return{data:{action:t,result:e.result,type:e.type,user_profile_path:r}}}});case 4:if(i=e.sent,o=i.data,a=o.data,s=a.result,c=a.type,u=a.user_profile_path,!t){e.next=14;break}if(1!==s||0!==c){e.next=12;break}return e.abrupt("return",!0);case 12:if(0!==s||0!==c){e.next=14;break}throw new Error("setUserProfile: result === 0 && type === 0");case 14:return e.abrupt("return",u);case 15:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),e}(),RemoteAppBackgroundHandler=function(){function e(t){_classCallCheck(this,e),this._player=t}var t;return _createClass(e,[{key:"_backgroundAppClient",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i,o,a,s,c,u,l,d,p=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.handleMessage,o=n.logName,a=n.errorLogName,s=MessageFactory$1.eventTypeBackgroundAppClient(t,r),this._player.logger.send(o),c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.result,r=void 0===t?1:t,n=e.error;if(!n)return!0;var i=n.CODE,o=n.MESSAGE;if(p._player.logger.send(a,{result:r,errc:i,msg:o}),1===r)throw{errorCode:i,message:o};return!1},e.next=6,this._player._sendCustomMessageWithReturn({message:s,jsonCmd:[SERVER_COMMAND.CMD_FOREGROUND_CHANGE_STATUS,SERVER_COMMAND.CMD_BACKGROUND_APP_LIST],pbType:PB_MESSAGE.TYPES.MsgBusiness,pbSubType:PB_BUSINESS.SUBTYPES.MsgBusinessBackgroundApp,transformPBMes:function(e){return{data:e}},onTimeout:c});case 6:if(u=e.sent,l=u.success,d=u.data,!l){e.next=11;break}return e.abrupt("return",i(d,c));case 11:return e.abrupt("return",c());case 12:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})},{key:"setRemoteGameForeground",value:function(e){return this._backgroundAppClient(!0,e,{logName:"setRemoteGameForeground",errorLogName:"setRemoteGameForegroundResult",handleMessage:function(e,t){var r=e.result,n=e.foreground;return 0===r&&1===n?t({result:0}):2===r?t({error:ERROR_BUILDER.WARNING_REMOTE_$_ALREADY_FOREGROUND("")}):void 0}})}},{key:"getRemoteBackgroundAppList",value:function(){return this._backgroundAppClient(!1,void 0,{logName:"setRemoteAppForeground",errorLogName:"setRemoteAppForegroundResult",handleMessage:function(e,t){var r=((null==e?void 0:e.data)||{}).app_list;return t({result:0,appList:r}),r}})}},{key:"setRemoteAppForeground",value:function(e){return this._backgroundAppClient(!0,e,{logName:"setRemoteAppForeground",errorLogName:"setRemoteAppForegroundResult",handleMessage:function(t,r){var n=t.result,i=t.foreground;if(0===n&&1===i)return r({result:0});if([-1,-2,-3,2].includes(n)){var o=ERROR_BUILDER.WARNING_REMOTE_$_FOREGROUND_FAILURE_NO_SUCH_PACKAGE_NAME(e);return r({"-1":o,"-2":o,2:ERROR_BUILDER.WARNING_REMOTE_$_ALREADY_FOREGROUND(e),"-3":ERROR_BUILDER.WARNING_REMOTE_$_FOREGROUND_FAILURE_NO_PACKAGE_NAME_BACKGROUND(e)}[n])}}})}},{key:"handleGameForegroundChangeStatus",value:function(e){var t=e.data,r=t.result,n=t.foreground;1===r&&1===n&&(this._player.emit("remote-game-switched-foreground"),this._player.logger.send("remoteGameSwitchedForeground")),1===r&&0===n&&(this._player.emit("remote-game-switched-background"),this._player.logger.send("remoteGameSwitchedBackground"))}},{key:"handleAppsForegroundChangeStatus",value:function(e){var t=e.data,r=t.result,n=t.foreground,i=t.packageName;1===r&&1===n&&(this._player.emit("remote-app-switched-foreground",i),this._player.logger.send("remoteAppSwitchedForeground",{packageName:i})),1===r&&0===n&&(this._player.emit("remote-app-switched-background",i),this._player.logger.send("remoteAppSwitchedBackground",{packageName:i}))}}]),e}(),VEMessageHandler=function(){function e(t){_classCallCheck(this,e),this._player=t,this._isMessageChannelOnline=!1,this._time=6e3,this.initMap()}return _createClass(e,[{key:"initMap",value:function(){this._isMessageChannelOnlineMap=new Map,this._msgSetTimeout=new Map}},{key:"sendVEMessage",value:function(e){var t=this,r=e.message,n=e.needAck,i=e.timeout,o=void 0===i?3e4:i,a=e.destUserId,s=void 0===a?"":a;return new Promise((function(e,i){var a={errorCode:START_ERROR.ERROR_SDK_GENERAL.CODE,message:START_ERROR.ERROR_SDK_GENERAL.MESSAGE},c=!("string"==typeof r),u=[0,61440],l=r?c?r.byteLength:(new TextEncoder).encode(r).byteLength:0;if(l>u[1]||l<=u[0])return a.errorCode=MESSAGE_CHANNEL_ERROR.ERROR_MESSAGE_OVER_SIZED.CODE,a.message=MESSAGE_CHANNEL_ERROR.ERROR_MESSAGE_OVER_SIZED.MESSAGE,void i(a);if(!Number.isInteger(o)||o<=0){var d=MESSAGE_CHANNEL_ERROR.ERROR_MESSAGE_TIMEOUT_ILLEGAL,p=d.CODE,_=d.MESSAGE;return Object.assign(a,{errorCode:p,message:_}),void i(a)}var h=!1;if(""===s){if(!(t._isMessageChannelOnlineMap.size<=1))return a.errorCode=MESSAGE_CHANNEL_ERROR.ERROR_MESSAGE_CHANNEL_UID_ILLEGAL.CODE,a.message=MESSAGE_CHANNEL_ERROR.ERROR_MESSAGE_CHANNEL_UID_ILLEGAL.MESSAGE,void i(a);h=t._isMessageChannelOnline}else h=t._isMessageChannelOnlineMap.get(s);if(!h)return Object.assign(a,{errorCode:MESSAGE_CHANNEL_ERROR.ERROR_MESSAGE_NOT_CONNECTED.CODE,message:MESSAGE_CHANNEL_ERROR.ERROR_MESSAGE_NOT_CONNECTED.MESSAGE}),void i(a);var f=t._player.userId,m=(new Date).getTime().toString()+randomNumString$1(4),g=Date.now(),v=MessageFactory$1["".concat(c?"veMessageBinary":"veMessage")]({payload:r,userId:f,mid:m,needAck:n,destUserId:s,time:g});n?t._player._sendCustomMessageWithReturn({message:v,jsonCmd:SERVER_COMMAND.CMD_MSG_CHANNEL,pbType:PB_MESSAGE.TYPES.MsgBusiness,pbSubType:c?PB_BUSINESS.SUBTYPES.MsgBusinessBinaryMsgChannel:PB_BUSINESS.SUBTYPES.MsgBusinessMsgChannel,timeout:o||3e4,transformPBMes:c?function(e){return e}:function(e){return{data:JSON.stringify(_objectSpread2(_objectSpread2({},e),{},{message:e.payload}))}}}).then((function(n){var i=n.data;(c?t.receiveVEBinaryMessage(i):t.receiveVEMessage(i)).ackId===m&&(t._player.logger.send("send".concat(c?"Binary":"Text","Message"),{mid:m,dest_user_id:s}),e({mid:m,text:r,time:g,userId:f,message:r}))})).catch((function(e){t._player.logger.localErrorLog("PodTrigger","sendVEMessage error",e),t._player.logger.send("send".concat(c?"Binary":"Text","MessageFailure"),{err:e,mid:m,dest_user_id:s}),i(a)})):t._player._sendCustomMessage(v).then((function(){t._player.logger.send("send".concat(c?"Binary":"Text","Message"),{mid:m,dest_user_id:s}),e({mid:m,text:r,time:g,userId:f,message:r})})).catch((function(e){t._player.logger.localErrorLog("PodTrigger","sendVEMessage error",e),t._player.logger.send("send".concat(c?"Binary":"Text","MessageFailure"),{err:e,mid:m,dest_user_id:s}),i(a)}))}))}},{key:"receiveVEMessage",value:function(e){var t=this,r=MESSAGE_CHANNEL_ERROR.ERROR_MESSAGE_FAILED_TO_PARSE_MSG,n={};try{n=JSON.parse(e.data)}catch(e2){this._player.logger.localErrorLog("PodTrigger","receiveVEMessage",e),this._player.logger.send("error",{errorCode:r.CODE,message:r.MESSAGE})}if(6===n.type){var i,o=(new Date).getTime().toString()+randomNumString$1(4),a=this._player.userId,s=n.user_id,c=(null===(i=n.payload)||void 0===i?void 0:i.mid)||n.message.mid;this._isMessageChannelOnline=true,this.updateMessageChannelState({destUserId:s,online:true});var u=MessageFactory$1.veMessageHearBeatResponse({userId:a,mid:o,ackId:c,destUserId:s});this._player._sendCustomMessage(u);var l=this._msgSetTimeout.get(s);return l&&clearTimeout(l),l=setTimeout((function(){t.updateMessageChannelState({destUserId:s,online:!1}),t._isMessageChannelOnline=!1}),this._time),void this._msgSetTimeout.set(s,l)}if(5!==n.type){if(4===n.type){var d=this._player.userId,p=n.user_id,_=MessageFactory$1.veMessageReadyResponse({userId:d,destUserId:p});this._player._sendCustomMessage(_).then((function(){t._hasEmitChannelReadyEvent||(t._hasEmitChannelReadyEvent=!0,t._player.emit("message-channel-connected"))}))}if(3!==n.type){if(1===n.type)return{ackId:n.ack_id};if(0===n.type||void 0===n.type){var h=this._player.userId,f=n.message.mid,m=n.user_id,g=MessageFactory$1.veMessageResponse({userId:h,ackId:f,destUserId:m});this._player._sendCustomMessage(g);var v=_objectSpread2(_objectSpread2({},n&&n.message),{},{userId:m});this._player.emit("message",v)}}else{var y=n.user_id,S=_objectSpread2(_objectSpread2({},n&&n.message),{},{userId:y});this._player.emit("message",S)}}else{var E,T,b=this._player.userId,R=(null===(E=n.payload)||void 0===E?void 0:E.mid)||n.message.mid,C=n.user_id,k=1===JSON.parse((null===(T=n.payload)||void 0===T?void 0:T.text)||n.message.text).state;this._isMessageChannelOnline=k,this._isMessageChannelOnlineMap.set(C,k);var I=MessageFactory$1.veMessageStatusChangeResponse({userId:b,ackId:R,destUserId:C});this._player._sendCustomMessage(I).then((function(){t.updateMessageChannelState({destUserId:C,online:k})}))}}},{key:"receiveVEBinaryMessage",value:function(e){var t=e.payload,r=e.type;if(108===r)return _objectSpread2({ackId:e.ack_id},e);if(9!==r){if(8===r){var n={mid:t.mid,data:t.data,time:t.time_ms,binary:t.data,userId:e.dest_user_id};this._player.emit("message",n);var i=MessageFactory$1.veMessageBinaryResponse({userId:e.dest_user_id,ackId:t.mid,destUserId:e.dest_user_id});this._player._sendCustomMessage(i)}}else{var o={mid:t.mid,data:t.data,binary:t.data,time:t.time_ms,userId:e.dest_user_id};this._player.emit("message",o)}}},{key:"updateMessageChannelState",value:function(e){var t=e.destUserId,r=e.online;r!==this._isMessageChannelOnlineMap.get(t)&&(r?(this._isMessageChannelOnlineMap.set(t,r),this._player.logger.send("onRemoteOnline",{dest_user_Id:t}),this._player.emit("message-channel-online",t)):(this._isMessageChannelOnlineMap.delete(t),this._player.logger.send("onRemoteOffline",{dest_user_Id:t}),this._player.emit("message-channel-offline",t)))}}]),e}();function isSizeLandscape(){return window.innerWidth>window.innerHeight}function getSizeOrientation(){return isSizeLandscape()?90:0}function isOrientationSupport(){return"orientation"in window&&"onorientationchange"in window}function getOrientationValue(){return isOrientationSupport()?window.orientation:getSizeOrientation()}function isMobile(){return/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Windows Phone|MQQBrowser)/i.test(navigator.userAgent)}function isLandscape(){return isMobile()?0!==window.orientation:isSizeLandscape()}function orientationChange(e){var t=isOrientationSupport(),r=getOrientationValue(),n=[],i=function(e,t){window.addEventListener(e,t,!0),n.push((function(){window.removeEventListener(e,t,!0)}))};if(t&&i("orientationchange",(function(){setTimeout((function(){var t=window.orientation;if(t!==r){var n=isSizeLandscape();if(0===t){if(n)return}else if(90===t&&!n)return;e(r=t,"orientationchange")}}),100)})),isMobile()||!t){var o=!0;i("resize",(function(){o&&(o=!1,setTimeout((function(){o=!0}),400),setTimeout((function(){var t=getSizeOrientation();t!==r&&e(r=t,"resize")}),200))}))}return function(){n.forEach((function(e){e()}))}}function delay(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200;return new Promise((function(t){setTimeout((function(){t(!0)}),e)}))}function onResize(e){var t=function(){return{w:window.innerWidth,h:window.innerHeight}},r=t(),n=r.w,i=r.h,o=null,a=function(){clearTimeout(o),o=setTimeout(_asyncToGenerator(_regeneratorRuntime().mark((function r(){var o;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:o=0;case 1:if(a=void 0,s=void 0,c=void 0,a=t(),s=a.w,c=a.h,!((s===n&&c===i||(i=c,n=s,e({width:s,height:c}),0))&&o<8)){r.next=7;break}return o++,r.next=5,delay();case 5:r.next=1;break;case 7:o>=8&&console.warn("未检测到sizechange");case 8:case"end":return r.stop()}var a,s,c}),r)}))),100)};return window.addEventListener("resize",a,!0),function(){window.removeEventListener("resize",a,!0)}}var ScreenLockHandler=function(){function e(t,r){var n=r.domId;_classCallCheck(this,e),this._player=t,this.logger=this._player.logger,this._domId=n,this.containerDomId=this._player.containerDomId,this._init()}return _createClass(e,[{key:"_init",value:function(){var e=this;this._isOrientation="orientation"in window&&"onorientationchange"in window,window.orientation>0?this.handleScreenLock(!0,270):this.handleScreenLock(!1,0),this._rotation=0===getOrientationValue()?0:270,this._isRotation=0!==this._rotation,this._isOrientation?this._clear=orientationChange((function(t,r){switch(e._player.emit("orientationchange",t,r),t){case 90:case-90:e._isRotation=!0,e._rotation=270;break;default:e._isRotation=!1,e._rotation=0}e._player.logger.send("orientationChange",{rotation:e._rotation,isRotation:e._isRotation}),e.handleScreenLock(e._isRotation,e._rotation)})):window.addEventListener("resize",this._orientationchangeListener=this.debounce((function(t){window.innerWidth>window.innerHeight?e.handleScreenLock(!0,270):e.handleScreenLock(!1,0),e._player.emit("resize",t)}),100))}},{key:"handleScreenLock",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isRotation,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._rotation,r=document.getElementById(this._domId),n=document.getElementById(this.containerDomId);if(this.logger.localInfoLog("Start","handleScreenLock","isRotation: ".concat(e,",rotation: ").concat(t)),r){var i,o;if((i=r.clientWidth)>(o=r.clientHeight)){var a=o;o=i,i=a}n.style.width="".concat(i,"px"),n.style.height="".concat(o,"px"),e?(n.style.transform="translate(".concat(Math.abs(i-o)/2,"px, ").concat(-Math.abs(i-o)/2,"px) rotate(").concat(t,"deg)"),this._player.rotateCoordinate(t)):(this._player.rotateCoordinate(0),n.style.transform=""),this._player.logger.send("orientationChangeSuccess",{width:i,height:o,isRotation:e,rotation:t}),this._player.client&&this._player.client.renderEle&&this._player.touchHandler&&this._player.touchHandler.updateVideoScale(this._player.client.renderEle)}}},{key:"debounce",value:function(e,t){var r=null;return function(){var n=this,i=arguments;clearTimeout(r),r=setTimeout((function(){e.apply(n,i)}),t)}}},{key:"destroy",value:function(){var e;this._isOrientation?(null===(e=this._clear)||void 0===e||e.call(this),this.logger.localInfoLog("Start","ScreenLockHandler","screenLockHandler destroy orientationchang")):(window.removeEventListener("resize",this._orientationchangeListener),this.logger.localInfoLog("Start","ScreenLockHandler","screenLockHandler destroy resize"))}}]),e}(),ScreenShotHandler=function(){function e(t){_classCallCheck(this,e),this._player=t,this._sequence=0}var t;return _createClass(e,[{key:"_loggerSend",value:function(e){var t=e.result,r=e.savePath,n=e.message,i=e.errorCode,o=e.downloadUrl;this._player.logger.send("onScreenShot",{result:t,savePath:r,message:n,downloadUrl:o,errorCode:i})}},{key:"screenShot",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o,a,s,c,u,l,d,p,_,h=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=h.length>0&&void 0!==h[0]&&h[0],r=MessageFactory$1.eventTypeScreenShot(this._sequence.toString(),t),this._player.logger.send("screenShot"),this._sequence++,e.next=6,this._player._sendCustomMessageWithReturn({message:r,jsonCmd:SERVER_COMMAND.CMD_SCREENSHOT_RESPONSE,pbType:PB_MESSAGE.TYPES.MsgBusiness,pbSubType:PB_BUSINESS.SUBTYPES.MsgBusinessScreenshot,transformPBMes:function(e){return{data:e}}});case 6:if(n=e.sent,i=n.success,o=n.data,!i){e.next=19;break}if(a=o.data,s=a.result,c=a.save_path,u=a.download_url,0!==s){e.next=16;break}return l={result:s,savePath:c,message:"",downloadUrl:decodeURIComponent(u)},this._loggerSend(l),e.abrupt("return",l);case 16:throw d=-1===s?POD_ERROR$1.ERROR_STORAGE_NOT_ENOUGH:POD_ERROR$1.ERROR_POD_UNKNOWN_FAILURE,p=d.CODE,_=d.MESSAGE,this._loggerSend({errorCode:p,message:_}),{errorCode:p,message:_};case 19:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),_PodStatusMapClient,PodStatusMapClient=(_PodStatusMapClient={},_defineProperty$1(_PodStatusMapClient,256,"ERROR_POD_STOPPED_BACKGROUND_TIMEOUT"),_defineProperty$1(_PodStatusMapClient,771,"ERROR_POD_STOPPED_BACKGROUND_TIMEOUT"),_defineProperty$1(_PodStatusMapClient,784,"ERROR_POD_STOPPED_BACKGROUND_TIMEOUT"),_defineProperty$1(_PodStatusMapClient,785,"ERROR_POD_STOPPED_BACKGROUND_TIMEOUT"),_defineProperty$1(_PodStatusMapClient,786,"ERROR_STREAM_STOPPED_AUTO_RECYCLE"),_defineProperty$1(_PodStatusMapClient,789,"ERROR_REMOTE_ABNORMAL_EXIT"),_defineProperty$1(_PodStatusMapClient,1024,"ERROR_REMOTE_ABNORMAL_EXIT"),_defineProperty$1(_PodStatusMapClient,1028,"ERROR_REMOTE_ABNORMAL_EXIT"),_defineProperty$1(_PodStatusMapClient,1031,"ERROR_REMOTE_ABNORMAL_EXIT"),_defineProperty$1(_PodStatusMapClient,1280,"ERROR_GAME_CRASH"),_defineProperty$1(_PodStatusMapClient,1281,"ERROR_GAME_CRASH"),_defineProperty$1(_PodStatusMapClient,1282,"ERROR_GAME_CRASH"),_PodStatusMapClient),RTCEngine=function(){function e(t,r){_classCallCheck(this,e),this._userJoined=!1,EventEmitter$2(this),this._player=t,this._logger=r.logger,this._userId=r.userId,this._containerDomId=r.containerDomId,index.setParameter("PUB_SUB_MODE","recv_only"),index.setParameter("VIDEO_STALL_100MS",!0),console.log("recv_only"),this._logger.localInfoLog("Init","_initEngine","rtc version is ",index.getSdkVersion()),this.audioEle=null,this._podUserId=null,this._remoteStream=null,this._rtcVideoEleId=null,this.renderEle=null,this._mute=null,this._startMute=null,this._reconnectTime=6e4,this._sdkType=r.sdkType,this._muteState={audio:!1,video:!1},this._isAudioPublishStream=!1,this._isVideoPublishStream=!1}return _createClass(e,[{key:"start",value:function(e){var t=this,r=e.roomId,n=e.token,i=e.podUserId,o=e.rtcAppId,a=e.width,s=e.height,c=e.mute,u=e.videoRenderMode,l=e.startTime;e.retry;var d=e.gameType,p=void 0===d?"android":d,_=e.disableAudioInjection;return this._podUserId=i,this._mute=c,this._startMute=c,this._hasEmitAudioAutoWarning=!1,this._canEmitReconnectedEvent=!1,this._hasAddVisibilityChangeListener=!1,this._hasInvisible=!1,window.___vegame_test_env&&(r="wuhao_".concat(r),n=null,o="62e1007b60bad301902561d9",index.setParameter("ICE_CONFIG_REQUEST_URLS",["rtc-test.bytedance.com","rtc-access-test-hl.bytedance.com"]),index.setParameter("EXPECTED_ADDR","10.122.132.255"),console.warn("启用rtc测试环境",{roomId:r,token:n,rtcAppId:o,serverIp:"10.122.132.255"})),new Promise((function(e,c){var d,h;(t.status="start",t._client=index.createEngine(o),window.___vegame_sync_av)?console.warn("已启用rtc音视频同步"):null===(d=t._client)||void 0===d||null===(h=d.setRemoteStreamRenderSync)||void 0===h||h.call(d,!1);var f,m,g=t._client;t._player._rtc_business_id&&g.setBusinessId(t._player._rtc_business_id),t._remoteUsers=[];var v=function(){!function(){t._logger.localWarnLog("Start","rtc.start","sendStartUp");var e=MessageFactory$1.eventTypeStartUp(_),r=void 0!==(null==e?void 0:e.op_type);t.sendMessage(r?JSON.stringify(e):e,!r)}(),t.status="playing",t._hasAddVisibilityChangeListener||isPC()||(t._hasAddVisibilityChangeListener=!0,document.addEventListener("visibilitychange",t._visibilityCallback=function(){var e,i,o,a,s,c;if(t._invisible=!1,"visible"===document.visibilityState)if(t._logger.localInfoLog("Reconnect","rtc.start","document.visibilityState = 'visible' && status = ".concat(t.status," && connectionState = ").concat(null==g||null===(e=g._room)||void 0===e||null===(i=e._mediaServerClient)||void 0===i?void 0:i.connectionState)),"playing"===t.status&&"connected"!==(null==g||null===(o=g._room)||void 0===o||null===(a=o._mediaServerClient)||void 0===a?void 0:a.connectionState)){t._player.emit("stream-reconnecting"),t._logger.send("streamReconnecting",{reason:1}),g._room.destroy();var u={roomId:r,token:n,startTime:new Date,retry:!0},l=function(){setTimeout((function(){var e,r;t._cancelReconnect(),t._logger.localInfoLog("Reconnect","rtc.start","check remote user id: ",null==g||null===(e=g._room)||void 0===e?void 0:e._remoteUsers.get(t._podUserId)),null!=g&&null!==(r=g._room)&&void 0!==r&&r._remoteUsers.get(t._podUserId)?(t._player.emit("stream-reconnected"),t._logger.send("streamReconnected",{reason:1})):t._peerLeave({errorCode:POD_ERROR$1.ERROR_GAME_ABNORMAL_EXIT.CODE,message:POD_ERROR$1.ERROR_GAME_ABNORMAL_EXIT.MESSAGE})}),1e3)};t._joinRoom(u).then((function(){l()})).catch((function(e){t._logger.localInfoLog("Reconnect","rtc.start","joinRoom failed and resume retry, failed reason: ".concat(e)),setTimeout((function(){return t._joinRoom(u).then((function(){l()}))}),1e3)})),t._logger.localInfoLog("Reconnect","rtc.start","visible start")}else t.restoreVisibleToHiddenStats();else t._logger.localInfoLog("Reconnect","rtc.start","document.visibilityState = 'hidden' && status = ".concat(t.status," && connectionState = ").concat(null==g||null===(s=g._room)||void 0===s||null===(c=s._mediaServerClient)||void 0===c?void 0:c.connectionState)),t._invisible=!0,t.saveVisibleToHiddenStats()})),e({width:a,height:s,streamWidth:f,streamHeight:m})};g.on(index.events.onTokenWillExpire,_asyncToGenerator(_regeneratorRuntime().mark((function e(){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t._player.updateMediaToken();case 3:r=e.sent,n=r.token,g.updateToken(n),t._logger.send("updateSessionToken",{err:"",token:n}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),t._logger.send("updateSessionToken",{err:e.t0,token:""});case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))),g.on(index.events.onUserJoined,(function(e){var r,n;t._logger.localInfoLog("PodTrigger","onUserJoined",e);var i=(null==e||null===(r=e.userInfo)||void 0===r?void 0:r.userId)===t._podUserId;t._player.emit("on-user-joined",{userId:null==e||null===(n=e.userInfo)||void 0===n?void 0:n.userId,isPodJoin:i}),t._remoteUsers.push(e),i&&(t._userJoined=!0,t._player.emit("on-start-process-status-changed",{status:START_CONNECTION_STATUS.POD_JOIN_ROOM_SUCCESS}))})),g.on(index.events.onUserPublishStream,(function(e){var r=e.mediaType;e.userId;var n=e.videoStreamDescriptions;if(r!==MediaType.AUDIO){if(t._logger.localInfoLog("PodTrigger","onUserPublishStream","stream-added success",e),t._player.emit("stream-added",{podUserId:i}),(null==e?void 0:e.userId)!==t._podUserId)return!1;f=n[0].width,m=n[0].height,t._logger.send("remoteJoin",{cost:(new Date).getTime()-l,streamWidth:f,streamHeight:m}),t._remoteStream=!0;var o=MediaType.AUDIO_AND_VIDEO;t.initStats(),t._player.emit("on-start-process-status-changed",{status:START_CONNECTION_STATUS.POD_HAS_PUBLISH_STREAM}),g.subscribeStream(t._podUserId,o).then((function(e){var r;if(t._player.emit("on-start-process-status-changed",{status:START_CONNECTION_STATUS.CLIENT_SUBSCRIBE_STREAM}),t._muteState={video:!1,audio:!1},t._logger.localInfoLog("PodTrigger","onUserPublishStream.subscribeStream","subscribed stream success"),t._player.emit("stream-subscribed",{podUserId:i}),t._logger.send("remoteSubscribe",{cost:(new Date).getTime()-l}),t._player.touchHandler.setStreamSize({streamWidth:f,streamHeight:m}),t.renderEle=g.setRemoteVideoPlayer(StreamIndex.STREAM_INDEX_MAIN,{renderDom:t._containerDomId,userId:t._podUserId}),t.initPauseDetect(t.renderEle),t.updateVideoRenderMode(u),"pc"===p){var n=function(e,r){t._player.touchHandler.setContentSize({width:e,height:r});var n=t._player.touchHandler.updateVideoScale(t.renderEle);t._logger.send("onRemoteVideoSizeChanged",_objectSpread2({videoWidth:e,videoHeight:r},n))};n(f,m),t.renderEle.addEventListener("resize",(function(){n(this.videoWidth,this.videoHeight)}))}null===(r=t._player._pcImeHandler)||void 0===r||r.init(t.renderEle),t._scaleParams=t._player.touchHandler.updateVideoScale(t.renderEle),t._remotePlayerDom=g._remoteAudioPlayer.get(t._podUserId),t._remotePlayerDom&&(t.audioEle=t._remotePlayerDom._audioDom),t._logger.localInfoLog("PodTrigger","onUserPublishStream.subscribeStream","audioEle",t.audioEle),t._initMediaDomProps(t.renderEle,t.audioEle)}))}})),g.on(index.events.onUserMessageReceived,(function(e){t._player.messageReceivedHandler(e,t._podUserId)})),g.on(index.events.onUserBinaryMessageReceived,(function(e){try{t._player.binaryMessageReceviedHandler(e,t._podUserId)}catch(e2){t._logger.localErrorLog("PodTrigger","onUserBinaryMessageReceived","decode binaryMessage error",e2)}})),g.on(index.events.onSEIMessageReceived,(function(e){t._player.seiMessageReceviedHandler(e,t._podUserId)})),g.on(index.events.onVideoFirstFrameRendered,(function(e){t._logger.localInfoLog("PodTrigger","onVideoFirstFrameRendered","first video frame time: ".concat((new Date).getTime()-l,"ms")),t.renderEle.setAttribute("poster",""),t._player.emit("first-remote-video-render"),t._player.emit("_onVideoFirstFrameRendered",e),t._player.emit("on-start-process-status-changed",{status:START_CONNECTION_STATUS.CLIENT_FRAME_RENDER_SUCCESS}),e.userId===t._podUserId&&v()})),g.on(index.events.onAudioFirstFrameDecoded,(function(e){t._logger.localInfoLog("PodTrigger","onAudioFirstFrameDecoded","first audio frame time: ".concat((new Date).getTime()-l,"ms")),t._logger.send("onFirstRemoteAudioFrame",{cost:(new Date).getTime()-l})})),g.on(index.events.onUserUnpublishStream,(function(e){var r=e.userId,n=e.mediaType,o=e.reason;t._logger.localInfoLog("PodTrigger","onUserUnpublishStream","stream-remove succes"),t._logger.send("streamRemove",{userId:r,mediaType:n,reason:o}),r===i&&t._player.emit("stream-removed",{podUserId:r})})),g.on(index.events.onConnectionStateChanged,(function(e){t._logger.localInfoLog("PodTrigger","onConnectionStateChanged","connect state change: ".concat(JSON.stringify(e))),t._player.emit("_onConnectionStateChanged",e),t.connectionStateMap(e)})),g.on(index.events.onPlayerEvent,(function(e){e&&"video"===e.type&&"play"===e.eventName&&(t._logger.localInfoLog("PodTrigger","onPlayerEvent","video play success"),t._rtcVideoEleId=t.renderEle.id,t._player.emit("on-start-process-status-changed",{status:START_CONNECTION_STATUS.CLIENT_PLAY_SUCCESS}),t._logger.send("videoPlay",_objectSpread2({cost:(new Date).getTime()-l},t._scaleParams)))})),g.on(index.events.onAutoplayFailed,(function(e){t._logger.localInfoLog("PodTrigger","onAutoplayFailed","".concat(e.kind," auto play error"),e);var r,n,i="".concat(e.kind," auto play error"),o=e.kind;"audio"===e.kind?(r=POD_WARNING.WARNING_START_AUDIO_AUTO_PLAY_FAILED.CODE,n=POD_WARNING.WARNING_START_AUDIO_AUTO_PLAY_FAILED.MESSAGE,t._startMute||t._hasEmitAudioAutoWarning?t._logger.send("videoPlayInnerWarning",_objectSpread2(_objectSpread2({cost:(new Date).getTime()-l},t._scaleParams),{},{errc:r,msg:n,oMsg:i,oErrType:o})):(t._logger.localWarnLog("PodTrigger","_initEngine","".concat(e.kind," auto play error"),e),t._logger.send("videoPlay",_objectSpread2(_objectSpread2({cost:(new Date).getTime()-l},t._scaleParams),{},{errc:r,msg:n,oMsg:i,oErrType:o})),t._hasEmitAudioAutoWarning=!0,t._player.emit("warning",{warningCode:r,message:n}))):(r=START_ERROR.ERROR_START_STREAM_AUTO_PLAY_FAILED.CODE,n=START_ERROR.ERROR_START_STREAM_AUTO_PLAY_FAILED.MESSAGE,t._logger.send("videoPlay",_objectSpread2(_objectSpread2({cost:(new Date).getTime()-l},t._scaleParams),{},{errc:r,msg:n,oMsg:i,oErrType:o})),c({errorCode:r,message:n}))})),g.on(index.events.onError,(function(e){var r,n;t._logger.localErrorLog("PodTrigger","onError","rtc event error..",e),e.errorCode===index.ErrorCode.DUPLICATE_LOGIN?(r=POD_ERROR$1.ERROR_GAME_STOPPED_DUPLICATE_START.CODE,n=POD_ERROR$1.ERROR_GAME_STOPPED_DUPLICATE_START.MESSAGE):(r=START_ERROR.ERROR_STREAM_GENERAL.CODE,n=START_ERROR.ERROR_STREAM_GENERAL.MESSAGE),t._player.emit("error",{errorCode:r,message:n}),t._logger.send("onRTCError",{errc:r,msg:n,oErrc:e.errorCode,oMsg:"rtc error"}),t._player._stop()})),g.on(index.events.onUserLeave,(function(e){var r,n;t._logger.localWarnLog("PodTrigger","onUserLeave",e);var i,o=(null==e||null===(r=e.userInfo)||void 0===r?void 0:r.userId)===t._podUserId;if(t._player.emit("on-user-leave",{userId:null==e||null===(n=e.userInfo)||void 0===n?void 0:n.userId,isPodLeave:o}),o)if(t._logger.send("onUserLeave",{reason:null==e||null===(i=e.userInfo)||void 0===i?void 0:i.extraInfo}),"veGame"===t._sdkType){var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=START_ERROR.ERROR_NET_REQUEST_ERROR.CODE;e.errorCode===r&&(e.originalErrorCode=r,e.originalMessage=(e.message||"")+" getResourceStatus network error",e.errorCode=POD_ERROR$1.ERROR_GAME_ABNORMAL_EXIT.CODE),t._peerLeave(e),e.errorCode===POD_ERROR$1.ERROR_POD_REMOTE_OFFLINE&&t._logger.send("onPodExit",{errCode:e.errorCode,errMsg:e.message})};t._player.getResourceStatus().then(a).catch(a)}else{var s=_objectSpread2(_objectSpread2({},POD_ERROR$1),POD_ERROR_PHONE_EXTEND),c={errorCode:s.ERROR_GAME_ABNORMAL_EXIT.CODE,message:s.ERROR_GAME_ABNORMAL_EXIT.MESSAGE};t._player.getVePhonePodStatus().then((function(e){var r=e.podStatus,n=(null==PodStatusMapClient?void 0:PodStatusMapClient[r])||"ERROR_GAME_ABNORMAL_EXIT";c={errorCode:null==s?void 0:s[n].CODE,message:null==s?void 0:s[n].MESSAGE,originalErrorCode:r},t._peerLeave(c)})).catch((function(e){c={errorCode:POD_ERROR$1.ERROR_GAME_ABNORMAL_EXIT.CODE,message:POD_ERROR$1.ERROR_GAME_ABNORMAL_EXIT.MESSAGE,originalErrorCode:START_ERROR.ERROR_NET_REQUEST_ERROR.CODE,originalMessage:"getVePhonePodStatus error: ".concat(e.message)},t._peerLeave(c)}))}}));var y={roomId:r,token:n,startTime:l,width:a,height:s,podUserId:i},S=t._logger.getCommonParams().sessionId;t._joinRoom(y).then((function(e){var r;t._player.emit("on-start-process-status-changed",{status:START_CONNECTION_STATUS.CLIENT_JOIN_ROOM_SUCCESS}),null===(r=t._player._fileChannelHandler)||void 0===r||r.socket.connect(),t._logger.localInfoLog("Start","_joinRoomSuccess","clientUser join room success, podUser is ".concat(t._podUserId)),t.isPlaying=!0,t._logger.send("onJoinRoomResult",{cost:(new Date).getTime()-l,result:0})})).catch((function(e){var n;t._player.emit("on-start-process-status-changed",{status:START_CONNECTION_STATUS.CLIENT_JOIN_ROOM_FAILED});var i=e.code,o=e.message,a=(null==e||null===(n=e.error)||void 0===n?void 0:n.stack)||"",s=START_ERROR.ERROR_SDK_GENERAL.CODE,u=START_ERROR.ERROR_SDK_GENERAL.MESSAGE;a&&a.toString().includes("Cannot create so many PeerConnections")?(s=START_ERROR.ERROR_SDK_MANY_CONNECTION.CODE,u=START_ERROR.ERROR_SDK_MANY_CONNECTION.MESSAGE):e&&e.toString().includes("Error: leave_room")?(s=START_ERROR.ERROR_SDK_USER_HAS_LEAVE_ROOM.CODE,u=START_ERROR.ERROR_SDK_USER_HAS_LEAVE_ROOM.MESSAGE):(null==e?void 0:e.code)===index.ErrorCode.JOIN_ROOM_FAILED?(s=START_ERROR.ERROR_SDK_JOIN_ROOM_FAILED.CODE,u=START_ERROR.ERROR_SDK_JOIN_ROOM_FAILED.MESSAGE):(null==e?void 0:e.code)===index.ErrorCode.USER_FORBIDDEN?(s=START_ERROR.ERROR_SDK_USER_FORBIDDEN.CODE,u=START_ERROR.ERROR_SDK_USER_FORBIDDEN.MESSAGE):"Get offer Error"===o&&(s=START_ERROR.ERROR_SDK_MANY_CONNECTION.CODE,u=START_ERROR.ERROR_SDK_MANY_CONNECTION.MESSAGE),t._logger.localErrorLog("Start","_joinRoomError","clientUser join room failed",r,e),t._logger.send("joinRoomResult",{roomId:r,cost:(new Date).getTime()-l,result:1,msg:u,errc:s,oMsg:o,oErrc:i,stackMsg:a},{sessionId:S}),c({errorCode:s,message:u})}))}))}},{key:"_initMediaDomProps",value:function(e,t){e&&(e.poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",e.id=(65535&(new Date).getTime())+""+parseInt(1e3*Math.random()),this._mute&&(e.setAttribute("muted","true"),e.muted=!0)),t&&this._mute&&(t.setAttribute("muted","true"),t.muted=!0)}},{key:"_joinRoom",value:function(e){var t=this,r=e.roomId,n=e.token,i=e.width,o=e.height,a=e.podUserId;return this._logger.send("joinRoom",{podUserId:a,token:n,podWith:i,podHeight:o}),new Promise((function(e,i){t._client.joinRoom(n,r,{userId:t._userId||" "},{isAutoPublish:!1,isAutoSubscribeAudio:!1,isAutoSubscribeVideo:!1}).then((function(t){e(t)})).catch((function(e){i(e)}))}))}},{key:"_peerLeave",value:function(e){var t=e.errorCode,r=e.message,n=e.originalErrorCode,i=void 0===n?"":n,o=e.originalMessage,a=void 0===o?"":o;this._player.emit("error",{errorCode:t,message:r}),this._logger.send("error",{errc:t,msg:r,oErrc:i,oMsg:a}),this._player._stop()}},{key:"stop",value:function(){var e=this;return document.removeEventListener("visibilitychange",this._visibilityCallback),new Promise((function(t,r){var n=START_ERROR.ERROR_SDK_GENERAL.CODE,i=START_ERROR.ERROR_SDK_GENERAL.MESSAGE;e._client?(e._logger.send("leaveRoom"),e._connectState="DISCONNECTED",e._logger.localInfoLog("Stop","stop","stop..."),e._isAudioPublishStream=!1,e._isVideoPublishStream=!1,e._client.leaveRoom().then((function(){e._logger.localInfoLog("Stop","stop","stop sccuess"),index.destroyEngine(e._client),e._logger.send("stopSuccess"),t(!0)})).catch((function(t){e._logger.localErrorLog("Stop","stop","stop fail",t),e._logger.send("stopFail",{error:t}),r({errorCode:n,message:i})}))):(e._logger.send("stopFail",{error:"client not exist"}),r({errorCode:n,message:i})),e.status="stop"}))}},{key:"sendMessage",value:function(e,t){var r=this,n=this._podUserId;if(!t){var i=JSON.parse(e);i.op_type!==CLIENT_EVENT_TYPE.EVENT_TYPE_TOUCH&&i.op_type!==CLIENT_EVENT_TYPE.EVENT_TEST_DELAY&&this._logger.localInfoLog("ClientTrigger","sendMessage","sendMessage to:"+n+" message:"+e)}return new Promise((function(i,o){var a=MESSAGE_CHANNEL_ERROR.ERROR_MESSAGE_NOT_READY,s=a.CODE,c=a.MESSAGE;r._userJoined?t?r._client.sendUserBinaryMessage(n,e).then((function(e){i(e)})).catch((function(e){r._logger.localWarnLog("ClientTrigger","sendMessage.sendUserBinaryMessage","rtc-data-channel-error",e),o({errorCode:s,message:c})})):r._client.sendUserMessage(n,e).then((function(t){JSON.parse(e).op_type!==CLIENT_EVENT_TYPE.EVENT_TEST_DELAY&&r._logger.localInfoLog("ClientTrigger","sendMessage.sendUserBinaryMessage","sendMessage success",e),i(t)})).catch((function(e){r._logger.localWarnLog("ClientTrigger","sendMessage.sendUserBinaryMessage","rtc-data-channel-error",e),o({errorCode:s,message:c})})):(r._logger.localWarnLog("ClientTrigger","sendMessage","remoteStream-error, podUser has not joined"),o({errorCode:s,message:c}))}))}},{key:"initStats",value:function(){var e=this;this._client.on(index.events.onRemoteStreamStats,(function(t){var r,n,i,o;e._stats={accessDelay:t.videoStats.rtt<0?0:t.videoStats.rtt,videoReceivedPacketsLostRate:t.videoStats.videoLossRate,videoReceivedBitrate:t.videoStats.receivedKBitrate,videoReceivedFrameRate:t.videoStats.decoderOutputFrameRate,videoReceivedResolutionHeight:t.videoStats.width,videoReceivedResolutionWidth:t.videoStats.height,videoStallCount:null===(r=t.videoStats)||void 0===r?void 0:r.stallCount,videoStallDuration:null===(n=t.videoStats)||void 0===n?void 0:n.stallDuration,videoStallCount100MS:null===(i=t.videoStats)||void 0===i?void 0:i.stallCount100MS,videoStallDuration100MS:null===(o=t.videoStats)||void 0===o?void 0:o.stallDuration100MS},e._logger.send("receivedStreamStats",{stats:JSON.stringify(t.videoStats)}),e._player.emit("received-stream-stats",{stats:t.videoStats})})),this._client.on(index.events.onLocalStreamStats,(function(t){e._player.emit("send-stream-stats",{stats:t.audioStats}),e._logger.send("localStreamStats",{stats:JSON.stringify(t.audioStats)}),e._logger.send("sendStreamStats",{stats:JSON.stringify(t.videoStats)})})),this._client.on(index.events.onAudioDeviceStateChanged,(function(t){e._logger.localInfoLog("ClientTrigger","onAudioDeviceStateChanged","audio device state changed",t),e._logger.send("localAudioStreamState",{state:t.deviceState,deviceId:t.mediaDeviceInfo.deviceId}),e._player.emit("local-audio-stream-state",t)})),this._client.on(index.events.onVideoDeviceStateChanged,(function(t){e._logger.localInfoLog("ClientTrigger","onVideoDeviceStateChanged","video device state changed",t),e._logger.send("localVideoStateChanged",{state:t.deviceState,deviceId:t.mediaDeviceInfo.deviceId}),e._player.emit("local-video-stream-state",t)}))}},{key:"getStats",value:function(){var e=this;return new Promise((function(t,r){e._remoteStream?e._stats?t(e._stats):e._client.on(index.events.onRemoteStreamStats,(function(r){var n,i,o,a;e._stats={accessDelay:r.videoStats.rtt<0?0:r.videoStats.rtt,videoReceivedPacketsLostRate:r.videoStats.videoLossRate,videoReceivedBitrate:r.videoStats.receivedKBitrate,videoReceivedFrameRate:r.videoStats.decoderOutputFrameRate,videoReceivedResolutionHeight:r.videoStats.width,videoReceivedResolutionWidth:r.videoStats.height,videoStallCount:null===(n=r.videoStats)||void 0===n?void 0:n.stallCount,videoStallDuration:null===(i=r.videoStats)||void 0===i?void 0:i.stallDuration,videoStallCount100MS:null===(o=r.videoStats)||void 0===o?void 0:o.stallCount100MS,videoStallDuration100MS:null===(a=r.videoStats)||void 0===a?void 0:a.stallDuration100MS},t(e._stats)})):r()}))}},{key:"connectionStateMap",value:function(e){var t=e&&e.state,r=e&&e.message;switch(t){case ConnectionState.CONNECTION_START:this._connectState="START";break;case ConnectionState.CONNECTION_STATE_DISCONNECTED:this._connectState="DISCONNECTED",this._logger.send("streamReconnecting",{reason:0}),!this._invisible&&this._canEmitReconnectedEvent&&this._player.emit("stream-reconnecting");break;case ConnectionState.CONNECTION_STATE_CONNECTING:this._connectState="CONNECTING";break;case ConnectionState.CONNECTION_STATE_CONNECTED:this._canEmitReconnectedEvent=!0,this._connectState="CONNECTED";break;case ConnectionState.CONNECTION_STATE_RECONNECTING:this._connectState="RECONNECTING",this._reconnect(this._reconnectTime),this._invisible&&(this._hasInvisible=!0);break;case ConnectionState.CONNECTION_STATE_RECONNECTED:this._connectState="RECONNECTED",this._player.emit("stream-reconnected"),this._logger.send("streamReconnected",{reason:0}),this._hasInvisible=!1,this._cancelReconnect();break;default:this._connectState="OTHER"}t!==ConnectionState.CONNECTION_STATE_RECONNECTED&&t!==ConnectionState.CONNECTION_STATE_DISCONNECTED||this._player.emit("status-change",{code:t,message:r})}},{key:"saveVisibleToHiddenStats",value:function(){var e;null===(e=this._remotePlayerDom)||void 0===e||e.pause()}},{key:"restoreVisibleToHiddenStats",value:function(){var e,t;null===(e=this.renderEle)||void 0===e||e.play(),null===(t=this._remotePlayerDom)||void 0===t||t.manuallyPlay()}},{key:"getConnectionState",value:function(){return this._connectState}},{key:"play",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(t||isIOSUniApp()||isiOS()&&getIOSVersion()<13)&&(null===(e=this.renderEle)||void 0===e||e.load());return this._client.play(this._podUserId)}},{key:"setAudioMute",value:function(e){var t;(this._mute=!!e,!e&&this.audioEle)&&(null===(t=this._remotePlayerDom)||void 0===t||t.manuallyPlay());this.audioEle&&(this.audioEle.muted=e)}},{key:"isAudioMuted",value:function(){return this._muteState.audio}},{key:"muteStream",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;if(this._logger.localInfoLog("ClientTrigger","muteStream","subscribeType start",t),this._client){var n,i=Object.assign({audio:this._muteState.audio,video:this._muteState.video},t),o=null;r===SUBSCRIBE_TYPE.PAUSE&&(o="unsubscribe",n=MediaType.AUDIO_AND_VIDEO),r===SUBSCRIBE_TYPE.RESUME&&(o="subscribe",n=MediaType.AUDIO_AND_VIDEO),r===SUBSCRIBE_TYPE.AUDIO&&(o=t.audio?"unsubscribe":"subscribe",n=MediaType.AUDIO),r===SUBSCRIBE_TYPE.VIDEO&&(o=t.video?"unsubscribe":"subscribe",n=MediaType.VIDEO),this._logger.send("mute"+r,{mute:i}),"unsubscribe"===o&&(this._logger.localInfoLog("ClientTrigger","muteStream","unsubscribeType",n),this.unsubscribeStream(n,(function(){e._muteState=i,r&&(e._logger.send("mute".concat(r,"Updated"),{mute:e._muteState}),e._logger.localInfoLog("ClientTrigger","muteStream","mute success",i),e._player.emit("_onVideoPlaying",i))}))),"subscribe"===o&&(this._logger.localInfoLog("ClientTrigger","muteStream","subscribeType",n),this.subscribeStream(n,(function(){e._muteState=i,r&&(e._logger.send("mute".concat(r,"Updated"),{mute:e._muteState}),e._logger.localInfoLog("ClientTrigger","muteStream","mute success",i),e._player.emit("_onVideoPlaying",i))})))}}},{key:"isVideoMuted",value:function(){return this._muteState.video}},{key:"setVideoMute",value:function(e){var t;(this._mute=!!e,!e&&this.audioEle)&&(null===(t=this._remotePlayerDom)||void 0===t||t.manuallyPlay());this.audioEle&&(this.audioEle.muted=e)}},{key:"unsubscribeStream",value:function(e,t){return this._client.unsubscribeStream(this._podUserId,e).then((function(){t()}))}},{key:"subscribeStream",value:function(e,t){return this._client.subscribeStream(this._podUserId,e).then((function(){t()}))}},{key:"pauseOrResume",value:function(e){var t;if(this._remoteStream)return this._mute=e,t=e?SUBSCRIBE_TYPE.PAUSE:SUBSCRIBE_TYPE.RESUME,this.muteStream({audio:e,video:e},t)}},{key:"_retryIsTimeOut",value:function(e){var t={errorCode:POD_ERROR$1.ERROR_GAME_ALREADY_STOPPED.CODE,message:POD_ERROR$1.ERROR_GAME_ALREADY_STOPPED.MESSAGE},r=this._remoteUsers,n=!1;if(this._logger.localInfoLog("Reconnect","_retryIsTimeOut","remote users",r),e){if(r)for(var i=0;i<r.length;i++)r[i].userInfo&&r[i].userInfo.userId===this._podUserId&&(n=!0);n||(this._player.emit("error",t),this._logger.send("error",{errc:t.errorCode,msg:t.message}))}}},{key:"_streamStop",value:function(){var e=this;this._client&&this._remoteStream&&this._client.unsubscribe(this._podUserId,!1).then((function(){e._logger.localInfoLog("Stop","stop","unsubscribe success")})),this._removeClientListener()}},{key:"_removeClientListener",value:function(){this._client&&this._client.removeAllListeners(),this._remoteStream&&this._remoteStream.removeAllListeners()}},{key:"_reconnect",value:function(e){var t=this,r=POD_ERROR$1.ERROR_GAME_ALREADY_STOPPED.CODE,n=POD_ERROR$1.ERROR_GAME_ALREADY_STOPPED.MESSAGE;this._reconnectInterId||(this._reconnectInterId=window.setTimeout((function(){if("CONNECTED"!==t._connectState&&"RECONNECTED"!==t._connectState){if(t._cancelReconnect(),t._hasInvisible)return t._hasInvisible=!1,t._reconnect(e),!1;t._logger.localInfoLog("Reconnect","_reconnect","reconnect failed"),t._player.emit("error",{errorCode:r,message:n}),t._logger.send("error",{errc:r,msg:n}),t._player._stop()}else t._hasInvisible=!1}),e))}},{key:"_cancelReconnect",value:function(){clearTimeout(this._reconnectInterId),this._reconnectInterId=null}},{key:"_publishStream",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:MediaType.AUDIO_AND_VIDEO;return new Promise((function(r,n){var i;!e._isAudioPublishStream&&t===MediaType.AUDIO||!e._isVideoPublishStream&&t===MediaType.VIDEO||!e._isVideoPublishStream&&!e._isAudioPublishStream&&t===MediaType.AUDIO_AND_VIDEO?(i=t,e._client?e._client.publishStream(i).then((function(){e._logger.send("publishStreamSuccess"),i===MediaType.AUDIO?e._isAudioPublishStream=!0:(i===MediaType.VIDEO||(e._isAudioPublishStream=!0),e._isVideoPublishStream=!0),r(!0)})).catch((function(t){e._logger.send("publishStreamFail",{eventType:"sdkError",errCode:SDK_CUSTOM_ERROR.PUBLISH_STREAM_RTC_FAIL.CODE,errMsg:SDK_CUSTOM_ERROR.PUBLISH_STREAM_RTC_FAIL.MESSAGE,oErr:t}),n()})):(e._logger.send("publishStreamFail",{eventType:"sdkError",errCode:SDK_CUSTOM_ERROR.RTC_CLIENT_NOT_CREATE.CODE,errMsg:SDK_CUSTOM_ERROR.RTC_CLIENT_NOT_CREATE.MESSAGE,oErr:""}),n())):r(!0)}))}},{key:"_unPublishStream",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:MediaType.AUDIO_AND_VIDEO;return new Promise((function(r,n){var i;e._isAudioPublishStream&&t===MediaType.AUDIO||e._isVideoPublishStream&&t===MediaType.VIDEO||e._isVideoPublishStream&&e._isAudioPublishStream&&t===MediaType.AUDIO_AND_VIDEO?(i=t,e._client?e._client.unpublishStream(i).then((function(){e._logger.send("unpublishStreamSuccess"),i===MediaType.AUDIO?e._isAudioPublishStream=!1:(i===MediaType.VIDEO||(e._isAudioPublishStream=!1),e._isVideoPublishStream=!1),r(!0)})).catch((function(t){e._logger.send("unpublishStreamFail",{eventType:"sdkError",errCode:SDK_CUSTOM_ERROR.UNPUBLISH_STREAM_RTC_FAIL.CODE,errMsg:SDK_CUSTOM_ERROR.UNPUBLISH_STREAM_RTC_FAIL.MESSAGE,oErr:t}),n()})):e._logger.send("disableLocalAudioFail",{eventType:"sdkError",errCode:SDK_CUSTOM_ERROR.RTC_CLIENT_NOT_CREATE.CODE,errMsg:SDK_CUSTOM_ERROR.RTC_CLIENT_NOT_CREATE.MESSAGE,oErr:""})):r(!0)}))}},{key:"updateVideoRenderMode",value:function(e){switch(this._logger.send("updateVideoRenderMode",{videoRenderMode:e}),e){case VIDEO_RENDER_MODE.CONTAIN:this.renderEle&&(this.renderEle.style.objectFit="contain");break;case VIDEO_RENDER_MODE.COVER:this.renderEle&&(this.renderEle.style.objectFit="cover");break;case VIDEO_RENDER_MODE.FILL:this.renderEle&&(this.renderEle.style.objectFit="fill");break;default:this.renderEle&&(this.renderEle.style.objectFit="contain")}}},{key:"reconnectTime",get:function(){return this._reconnectTime},set:function(e){this._reconnectTime=e}},{key:"remoteStream",get:function(){return this._remoteStream}},{key:"isReady",get:function(){return!!this._remoteStream}},{key:"destroy",value:function(){this._remoteStream=null}},{key:"initPauseDetect",value:function(e){var t=this;e?e.addEventListener("pause",(function(){console.warn("Video is PAUSED"),(t._player.getConfig("shouldPlayWhenPause")||isIOSUniApp()&&getIOSVersion()>17)&&(console.warn("Video is Force played"),t._client.play(t._podUserId))})):console.warn("Video is undefined")}}]),e}(),AlwaysLog=(key2="_VEGAME_LOG_",location.search.includes(key2)||location.hash.includes(key2)),key2;function _buildGeneralError(){return{timeout:!0,errorCode:START_ERROR.ERROR_SDK_GENERAL.CODE,message:START_ERROR.ERROR_SDK_GENERAL.MESSAGE}}var BaseHandler$1=function(){function e(t,r){_classCallCheck(this,e),this._localLog=AlwaysLog,this.player=t,this.manager=r}var t;return _createClass(e,[{key:"isPhone",get:function(){return this.player.mode===MODE.CLOUD_PHONE}},{key:"init",value:function(){}},{key:"destroy",value:function(){}},{key:"handleMessage",value:function(e){return!(!this.pbType||!this.pbSubTypes)&&(!(e.type!==this.pbType||!this.pbSubTypes.includes(e.subtype))&&(this.onMessage(e),!0))}},{key:"fetchBase",value:function(e){return fetchBase(e,this.player.logger)}},{key:"fetchInnerApi",value:function(e){return fetchInnerApi(e,this.player.logger)}},{key:"onMessage",value:function(e){}},{key:"on",value:function(e,t){this.player.on(e,t)}},{key:"off",value:function(e,t){this.player.off(e,t)}},{key:"emit",value:function(e,t){this.player.emit(e,t)}},{key:"log",value:function(e,t){this.player.logger.send(e,t)}},{key:"beaconLog",value:function(e,t){this.player.logger.beaconSend(e,t)}},{key:"getLogParams",value:function(){return{commonParams:this.player.logger.getCommonParams(),initConfig:{userId:this.player.userId,channelDomain:LOG_CHANNEL_DOMAIN,SDKVersion:this.player.getVersion()}}}},{key:"print",value:function(){for(var e,t,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];this._localLog?(e=console).log.apply(e,["【SDK print】"].concat(n)):(t=this.player.logger).localWarnLog.apply(t,["handler","print","【SDK print】:"].concat(n))}},{key:"printTraceLog",value:function(){for(var e,t,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];this._localLog?(e=console).log.apply(e,["【SDK print】"].concat(n)):(t=this.player.logger).localTraceLog.apply(t,["handler","print","【SDK print】:"].concat(n))}},{key:"sendMessage",value:function(e){return void 0!==e.op_type?this.sendJsonMessage(e):this.sendPBMessage(e)}},{key:"sendPBMessage",value:function(e){return this.sendMessageBase(e,!0)}},{key:"sendJsonMessage",value:function(e){return this.sendMessageBase(JSON.stringify(e))}},{key:"sendMessageBase",value:function(e,t){try{return this.player.client.sendMessage(e,t)}catch(e2){return this.player.logger.localErrorLog("ClientTrigger","_sendMessage","发送消息失败: ",e2,e,t),Promise.resolve({error:e2,message:e,isBinary:t})}}},{key:"sendMessageWithReturn",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u,l,d,p;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.message,n=t.jsonCmd,i=t.pbType,o=t.pbSubType,a=t.transformPBMes,s=t.timeout,c=t.onTimeout,u=t.onExec,l=t.throwGeneral,d=void 0!==l&&l,p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(d)throw _buildGeneralError();return{success:!1,data:null,fromCatch:e,err:t}},e.prev=2,e.next=5,this.sendMessage(r);case 5:if(!this.player.client.isReady){e.next=12;break}return e.next=8,this._onHandleMessage({jsonCmd:n,pbType:i,pbSubType:o,transformPBMes:a,timeout:s,onTimeout:c,onExec:u,message:r});case 8:return e.t0=e.sent,e.abrupt("return",{success:!0,data:e.t0});case 12:return e.abrupt("return",p(!1));case 13:e.next=18;break;case 15:return e.prev=15,e.t1=e.catch(2),e.abrupt("return",p(!0,e.t1));case 18:case"end":return e.stop()}}),e,this,[[2,15]])}))),function(e){return t.apply(this,arguments)})},{key:"_onHandleMessage",value:function(e){var t=this,r=e.message,n=e.jsonCmd,i=e.pbType,o=e.pbSubType,a=e.transformPBMes,s=void 0===a?function(e){return e}:a,c=e.timeout,u=void 0===c?3e4:c,l=e.onTimeout,d=void 0===l?null:l,p=e.onExec,_=void 0===p?void 0:p;return new Promise((function(e){var a=t.player,c=a.client,l=a.logger,p=null,h=null,f=function(){var e=MessageFactory$1.usePB?index.events.onUserBinaryMessageReceived:index.events.onUserMessageReceived;c._client.off(e,h)},m=function(){clearTimeout(p),f()},g=function(t){t&&(t.command===n||Array.isArray(n)&&n.includes(t.command))&&(m(),e(t))},v=function(t){l.localInfoLog("PodTrigger","_onHandleMessage","onPBMessage origin",t);var r=ProtoBufMessage.decodePBMessage(t);if(l.localInfoLog("PodTrigger","_onHandleMessage","onPBMessage decoded",r),r){var n=r.type,a=r.subtype,c=r.msg;n===i&&a===o&&(m(),e(s(c)))}};c._client.on?MessageFactory$1.usePB?c._client.on(index.events.onUserBinaryMessageReceived,h=function(e){v(e.message)}):c._client.on(index.events.onUserMessageReceived,h=function(e){var t=e.message&&JSON.parse(e.message);g(t)}):c.on("message-received",h=function(e){var t,r=(null==e||null===(t=e.message)||void 0===t?void 0:t.message)&&JSON.parse(e.message.message);MessageFactory$1.usePB?v(r):g(r)}),_&&_(),u&&(p=setTimeout((function(){f(),d?d():e(_buildGeneralError()),console.warn("操作超时: ",r)}),u))}))}},{key:"setLogInfo",value:function(e,t){"string"==typeof e?this.player.logger.setSingleParam(e,t):this.player.logger.setCommonParams(e)}},{key:"encodePBMessage",value:function(e){return ProtoBufMessage.encodeMsgCommon(e)}},{key:"config",get:function(){return this.player.config}},{key:"store",get:function(){return this.player.store}},{key:"getConfig",value:function(e){return this.player.getConfig(e)}},{key:"setConfig",value:function(e,t){return this.player.setConfig(e,t)}},{key:"getStore",value:function(e){return this.player.getStore(e)}},{key:"setStore",value:function(e,t){return this.player.setStore(e,t)}},{key:"assignConfig",value:function(e){return this.player.assignConfig(e)}},{key:"assignStore",value:function(e){return this.player.assignStore(e)}}]),e}(),Plugins={},plugins=[];function getPluginNames(){return plugins}var Bridges={socketEngine:{MessageFactory:MessageFactory$1,LOG_TAG:LOG_TAG,PACKET_TYPE:PACKET_TYPE,START_ERROR:START_ERROR,POD_ERROR:POD_ERROR$1,CLIENT_EVENT_TYPE:CLIENT_EVENT_TYPE,isPwa:isPwa,MESSAGE_CHANNEL_ERROR:MESSAGE_CHANNEL_ERROR},handlers:{MessageFactory:MessageFactory$1,CLIENT_EVENT_TYPE:CLIENT_EVENT_TYPE,BaseHandler:BaseHandler$1,randomNumString:randomNumString$1,POD_ERROR:POD_ERROR$1,fetchBase:fetchBase}};function usePlugin(e){if(!e.pluginName)throw console.error("Invalid Plugin:",e),new Error("Invalid Plugin");var t=e.pluginName,r=e.injectBridge;Plugins[t]||(r(Bridges[t]),Plugins[t]=e,plugins.push(t))}function getPlugin(e){return Plugins[e]||null}var SocketEngine=function(){function e(t,r){_classCallCheck(this,e);var n=getPlugin("socketEngine");return n?new n(t,r):(console.warn("如果需要使用SocketEngine，请先引入相关插件"),null)}return _createClass(e,null,[{key:"isSupported",value:function(){var e=getPlugin("socketEngine");return e?e.isSupported():(console.warn("如果需要使用SocketEngine，请先引入相关插件"),{result:!1,msg:"wasm: need install @byted/ve-socket"})}}]),e}(),LocalAudioHandler=function(){function e(t){_classCallCheck(this,e),this._player=t,this._client=t.client,this._logger=this._player.logger,this._captureState="wait",this.localAudioStreamState(),this._isSelfCollect=!1}var t,r,n;return _createClass(e,[{key:"setAudioSourceType",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._isSelfCollect=!(r!==AudioSourceType.AUDIO_SOURCE_TYPE_EXTERNAL),this._logger.send("setAudioSourceType",{streamType:t,audioSourceType:r}),e.next=4,this._player.client._client.setAudioSourceType(t,r);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"startExternalAudioTrack",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._player.client._client,this._logger.send("pushExternalAudioFrame",{streamType:t}),e.next=4,n.setExternalAudioTrack(t,r);case 4:return e.next=6,n.publishStream(MediaType.AUDIO);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"stopExternalAudioTrack",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._logger.send("stopExternalAudioTrack"),e.next=3,this._player.client._client.unpublishStream(MediaType.AUDIO);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"startSendAudioStream",value:function(){var e=this;return this._logger.send("startAudioStream"),this._logger.localInfoLog("PodTrigger","startSendAudioStream","start Send Audio Stream"),new Promise((function(t,r){e._player.client._client.publishStream(MediaType.AUDIO).then((function(){e._logger.send("publishStreamSuccess"),e._player.client._client.startAudioCapture(e._audioinput).then((function(){e._captureState="capturing",e._logger.localInfoLog("PodTrigger","startSendAudioStream.publishStream","start Send Audio Stream success"),e._logger.send("startAudioCapture"),e._player.emit("start-audio-capture"),t({success:!0})})).catch((function(r){e._logger.localWarnLog("PodTrigger","startSendAudioStream.publishStream","start Send Audio Stream error",r),t(_objectSpread2({success:!1},r))}))})).catch((function(r){e._logger.send("publishStreamFail",{eventType:"sdkError",errCode:SDK_CUSTOM_ERROR.PUBLISH_STREAM_RTC_FAIL.CODE,errMsg:SDK_CUSTOM_ERROR.PUBLISH_STREAM_RTC_FAIL.MESSAGE,oErr:r}),t(_objectSpread2({success:!1,code:"PUBLISH_FAIL"},r))}))}))}},{key:"stopSendAudioStream",value:function(){var e=this;this._logger.send("stopAudioStream"),this._logger.localInfoLog("PodTrigger","stopSendAudioStream","stop Send Audio Stream"),this._player.client._unPublishStream(MediaType.AUDIO).then((function(){e._player.client._client.stopAudioCapture().then((function(){e._captureState="wait",e._logger.send("stopAudioCapture"),e._player.emit("stop-audio-capture")})).catch((function(t){e._logger.localWarnLog("PodTrigger","stopSendAudioStream","stop Audio Stream error",t)}))})).catch((function(e){console.log(e)}))}},{key:"setAudioCaptureDevice",value:function(e){var t=this;return this._audioinput=e,this._logger.localInfoLog("PodTrigger","setAudioCaptureDevice","set Audio Capture Device"),new Promise((function(r){"capturing"!==t._captureState?r(!0):t._player.client._client.setAudioCaptureDevice(e).then((function(){r(!0),t._player.emit("audio-capture-route-updated",{deviceId:e})}))}))}},{key:"setAudioPlaybackDevice",value:function(e){var t=this;this._logger.send("setAudioPlaybackDevice",{deviceId:e}),this._logger.localInfoLog("PodTrigger","setAudioPlaybackDevice","set Audio Playback Route"),this._audiooutput=e,this._player.client._client.setAudioPlaybackDevice("null"===e?null:e).then((function(){t._player.emit("audio-playback-route-updated",{deviceId:e}),t._logger.send("audioPlaybackDeviceChanged",{deviceId:e})}))}},{key:"getAudioPlaybackDeviceList",value:function(){var e=this;return new Promise((function(t,r){index.enumerateAudioPlaybackDevices().then((function(r){e._logger.localInfoLog("PodTrigger","getAudioPlaybackDeviceList","get Audio Playback Device List",r),e._logger.send("getAudioPlaybackDevice",{devices:r}),t(r)}))}))}},{key:"getAudioCaptureDeviceList",value:function(){var e=this;return new Promise((function(t,r){index.enumerateDevices().then((function(r){e._mediaDevices=r;var n=[];e._mediaDevices.forEach((function(e){"audioinput"===e.kind&&n.push(e)})),e._player.emit("audio-capture-list-update",n),e._logger.localInfoLog("PodTrigger","getAudioCaptureDeviceList","get Audio Capture Device List",e._mediaDevices,n),t(n)}))}))}},{key:"getAudioCaptureDevice",value:function(){return this._audioinput}},{key:"getAudioPlaybackDevice",value:function(){return this._audiooutput}},{key:"localAudioStreamState",value:function(){var e=this;this._player.on("local-audio-stream-state",(function(t){var r=t.kind;"audioinput"===r?index.enumerateAudioCaptureDevices().then((function(t){var r=[];t.forEach((function(e){"audioinput"===e.kind&&r.push(e)})),e._player.emit("audio-capture-list-update",r),e.setAudioCaptureDevice(r[0].deviceId)})):"audiooutput"===r&&index.enumerateAudioPlaybackDevices().then((function(t){var r=[];t.forEach((function(e){"audiooutput"===e.kind&&r.push(e)})),e._player.emit("audio-playback-list-update",r),e.setAudioPlaybackDevice(r[0].deviceId)}))}))}},{key:"handleAudioEvent",value:function(e){e&&1===e.subcmd?(this._logger.localInfoLog("PodTrigger","handleAudioEvent","Remote Stream Start Request "),this._logger.send("startAudioStreamCaptureRequest"),this._player.emit("remote-stream-start-request",{isAudio:!0,isVideo:!1})):(this._logger.localInfoLog("PodTrigger","handleAudioEvent","remote Stream Stop Request "),this._logger.send("stopAudioStreamCaptureRequest"),this._player.emit("remote-stream-stop-request",{isAudio:!0,isVideo:!1}))}},{key:"handleAudioPBEvent",value:function(e){var t;null!=e&&null!==(t=e.msg)&&void 0!==t&&t.enable?(this._logger.localInfoLog("PodTrigger","handleAudioPBEvent","Remote Stream Start Request "),this._logger.send("startAudioStreamCaptureRequest"),this._player.emit("remote-stream-start-request",{isAudio:!0,isVideo:!1})):(this._logger.localInfoLog("PodTrigger","handleAudioPBEvent","remote Stream Stop Request "),this._logger.send("stopAudioStreamCaptureRequest"),this._player.emit("remote-stream-stop-request",{isAudio:!0,isVideo:!1}))}},{key:"stop",value:function(){this._isSelfCollect?this.stopExternalAudioTrack():this.stopSendAudioStream()}}]),e}(),PromiseQueue=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;_classCallCheck(this,e),this.queueList=[],this.maxLimit=t,this.index=0}var t,r;return _createClass(e,[{key:"push",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queueTask();case 2:return e.prev=2,e.next=5,t();case 5:return r=e.sent,e.abrupt("return",r);case 7:return e.prev=7,this.index--,this.scheduleNextTask(),e.finish(7);case 11:case"end":return e.stop()}}),e,this,[[2,,7,11]])}))),function(e){return r.apply(this,arguments)})},{key:"queueTask",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.index++,!(this.index>this.maxLimit)){e.next=4;break}return e.next=4,new Promise((function(e){return t.queueList.push(e)}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"scheduleNextTask",value:function(){this.queueList.length>0&&this.queueList.shift()()}}]),e}(),LocalCameraHandler=function(){function e(t){_classCallCheck(this,e),this._deviceId="",this._player=t,this._client=t.client,this._logger=this._player.logger,this._config={},this._streamIndex=0,this.virtualDevicesList=[{deviceId:"user",label:"前置",kind:"videoinput"},{deviceId:"environment",label:"后置",kind:"videoinput"}],this._isSelfCollect=!1,this._queueTask=new PromiseQueue}var t,r,n;return _createClass(e,[{key:"setVideoSourceType",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._streamIndex=t,this._isSelfCollect=!(r!==VideoSourceType.VIDEO_SOURCE_TYPE_EXTERNAL),this._logger.send("setVideoSourceType",{streamType:t,videoSourceType:r}),e.next=5,this._player.client._client.setVideoSourceType(t,r);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"startExternalVideoTrack",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._player.client._client,this._logger.send("pushExternalVideoFrame",{streamType:t}),this._streamIndex=t,e.next=5,n.setExternalVideoTrack(t,r);case 5:return e.next=7,n.publishStream(MediaType.VIDEO);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"stopExternalVideoTrack",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._player.client._client.unpublishStream(MediaType.VIDEO);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"startVideoStream",value:function(){var e=this;return this._queueTask.push((function(){return e.startVideoStreamOrigin()}))}},{key:"startVideoStreamOrigin",value:function(){var e=this;return this._logger.localInfoLog("PodTrigger","startVideoStream","start Send Video Stream"),this._logger.send("startVideoStream"),new Promise((function(t,r){e._player.client._publishStream(MediaType.VIDEO).then((function(){e._logger.send("publishStreamSuccess"),e._player.client._client.startVideoCapture().then((function(r){var n;e.sendVideoSEIMessage(e._streamIndex,null===(n=e._config)||void 0===n?void 0:n.facingMode),e._deviceId=r.deviceId,e._logger.localInfoLog("PodTrigger","startVideoStream","start video stream success"),e._logger.send("startCapture"),e._player.emit("start-video-capture"),t({success:!0})})).catch((function(r){e._logger.localWarnLog("PodTrigger","startVideoStream","start Video Stream error",r),t(_objectSpread2({success:!1},r))}))})).catch((function(r){e._logger.localWarnLog("PodTrigger","startVideoStream","start Video Stream error",r),e._logger.send("publishStreamFail",{eventType:"sdkError",errCode:SDK_CUSTOM_ERROR.PUBLISH_STREAM_RTC_FAIL.CODE,errMsg:SDK_CUSTOM_ERROR.PUBLISH_STREAM_RTC_FAIL.MESSAGE,oErr:r}),t(_objectSpread2({success:!1,code:"PUBLISH_FAIL"},r))}))}))}},{key:"sendVideoSEIMessage",value:function(e,t){var r="user"===t?0:1;this._logger.send("sendVideoSEIMessage",{streamIndex:e,cameraId:r}),this._player.client._client.sendSEIMessage(e,{camera_id:r},3)}},{key:"stopVideoStream",value:function(){var e=this;return this._queueTask.push((function(){return e.stopVideoStreamOrigin()}))}},{key:"stopVideoStreamOrigin",value:function(){var e=this;return this._logger.localInfoLog("PodTrigger","stopVideoStream","stop Video Stream "),this._logger.send("stopVideoStream"),new Promise((function(t,r){e._player.client._unPublishStream(MediaType.VIDEO).then((function(){e._player.client._client.stopVideoCapture().then((function(){e._deviceId="",t(0),e._logger.send("stopCapture"),e._player.emit("stop-video-capture")})).catch((function(r){e._logger.localWarnLog("PodTrigger","stopVideoStream","stop Video Stream error",r),t(-1)}))})).catch((function(r){e._logger.localWarnLog("PodTrigger","stopVideoStream","stop Video Stream error",r),t(-1)}))}))}},{key:"setVideoCaptureDevice",value:function(e){var t=this;return this._logger.send("switchCamera",{deviceId:e}),new Promise((function(r,n){t._logger.localInfoLog("PodTrigger","setVideoCaptureDevice","set video Capture Device"),t._player.client._client.setVideoCaptureDevice(e).then((function(){t._logger.localInfoLog("PodTrigger","setVideoCaptureDevice","set video Capture Device success"),t._deviceId=e,t._player.emit("video-capture-route-updated",{deviceId:e}),t._logger.send("switchCameraResult",{success:!0}),r(e)})).catch((function(e){t._logger.localWarnLog("PodTrigger","setVideoCaptureDevice","set video Capture Device error",e),t._logger.send("switchCameraResult",{success:!1,err:e}),n(e)}))}))}},{key:"getVideoPlaybackDeviceList",value:function(){var e=this,t=this.virtualDevicesList;return new Promise((function(r,n){e._logger.localInfoLog("PodTrigger","getVideoPlaybackDeviceList","isPc: ".concat(isPC())),isPC()?index.enumerateVideoCaptureDevices().then((function(t){e._mediaDevices=t;var n=[];e._mediaDevices.forEach((function(e){"videoinput"===e.kind&&n.push(e)})),e._logger.localInfoLog("PodTrigger","getVideoPlaybackDeviceList","get Video Capture Device List",n),r(n)})):(e._logger.localInfoLog("PodTrigger","getVideoPlaybackDeviceList","get Video Capture Device List",t),r(t))}))}},{key:"getVideoCaptureDevice",value:function(){return this._deviceId}},{key:"setLocalVideoView",value:function(e){var t=e.streamIndex,r=e.videoPlayerOption;return this._logger.send("setLocalVideoView"),"contain"===r.renderMode?r.renderMode=VideoRenderMode.RENDER_MODE_FIT:r.renderMode=VideoRenderMode.RENDER_MODE_HIDDEN,this._player.client._client.setLocalVideoPlayer(t,r)}},{key:"setLocalVideoMirrorMode",value:function(e){this._logger.send("setLocalVideoMirrorMode",{mirrorType:e}),this._player.client._client.setLocalVideoMirrorType(e),this._mirrorType=e}},{key:"getLocalVideoMirrorMode",value:function(){return this._logger.send("getLocalVideoMirrorMode"),this._mirrorType||0}},{key:"setVideoCaptureConfig",value:function(e){var t=this,r=Object.assign(this._config,e),n=r.width,i=r.height,o=r.facingMode;this._logger.send("setVideoCaptureConfig",{width:n,height:i,facingMode:o}),isPC()?index.enumerateVideoCaptureDevices().then((function(e){t._mediaDevices=e,t._logger.localInfoLog("PodTrigger","setVideoCaptureConfig","get Video Capture Device List",e),t._player.client._client.setVideoCaptureDevice(e[0].deviceId).then((function(){t._deviceId=e[0].deviceId,t._logger.localInfoLog("PodTrigger","setVideoCaptureConfig","set Video Capture Device success",e[0].deviceId)})).catch((function(e){t._logger.localWarnLog("PodTrigger","setVideoCaptureConfig","set Video Capture Device  fail",e)}))})):this._player.client._client.setVideoCaptureDevice(o).then((function(){var e;t.sendVideoSEIMessage(t._streamIndex,null===(e=t._config)||void 0===e?void 0:e.facingMode),t._logger.localInfoLog("PodTrigger","setVideoCaptureConfig","set h5 Video Capture Device success",o)})).catch((function(e){t._logger.localWarnLog("PodTrigger","setVideoCaptureConfig","set h5 Video Capture Device  fail",e)}))}},{key:"setVideoEncoderConfig",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._logger.send("setVideoEncoderConfig",_objectSpread2({},t)),new Promise((function(r,n){e._logger.localInfoLog("PodTrigger","setVideoEncoderConfig","set video encoder config",t),e._player.client._client.setVideoEncoderConfig(t).then((function(){e._logger.localInfoLog("PodTrigger","setVideoEncoderConfig","set video encoder config success"),r(!0)})).catch((function(t){e._logger.localWarnLog("PodTrigger","setVideoEncoderConfig","set video encoder config fail",t),n()}))}))}},{key:"handleCameraEvent",value:function(e){if(e&&1===e.data.subcmd){var t,r;if(null!==(t=e.data)&&void 0!==t&&t.args)this._cameraId=e.data.args.id,this._cameraW=e.data.args.width,this._cameraH=e.data.args.height,r=0===this._cameraId?"user":"environment",this._config={facingMode:r,width:this._cameraW,height:this._cameraH},this._isSelfCollect||this.setVideoCaptureConfig({facingMode:r,width:this._cameraW,height:this._cameraH});this._logger.localInfoLog("PodTrigger","handleCameraEvent","Remote Stream Camera start Request"),this._logger.send("remoteStreamStartRequest",{isAudio:!1,isVideo:!0}),this._player.emit("remote-stream-start-request",{isAudio:!1,isVideo:!0,videoWidth:this._cameraW,videoHeight:this._cameraH})}else this._logger.localInfoLog("PodTrigger","handleCameraEvent","remote Stream Camera Stop Request "),this._logger.send("remoteStreamStopRequest",{isAudio:!1,isVideo:!0}),this._player.emit("remote-stream-stop-request",{isAudio:!1,isVideo:!0})}},{key:"handleCameraPBEvent",value:function(e){var t;if(null!=e&&null!==(t=e.msg)&&void 0!==t&&t.enable){var r,n,i,o;this._logger.localInfoLog("PodTrigger","handleCameraPBEvent","Remote Stream Camera start Request",null==e?void 0:e.msg);var a=(null==e||null===(r=e.msg)||void 0===r||null===(n=r.params)||void 0===n?void 0:n.width)||0,s=(null==e||null===(i=e.msg)||void 0===i||null===(o=i.params)||void 0===o?void 0:o.height)||0;this._logger.send("remoteStreamStartRequest",{isAudio:!1,isVideo:!0}),this._player.emit("remote-stream-start-request",{isAudio:!1,isVideo:!0,videoWidth:a,videoHeight:s})}else this._logger.localInfoLog("PodTrigger","handleCameraPBEvent","remote Stream Camera Stop Request "),this._logger.send("remoteStreamStopRequest",{isAudio:!1,isVideo:!0}),this._player.emit("remote-stream-stop-request",{isAudio:!1,isVideo:!0})}},{key:"stop",value:function(){this._isSelfCollect?this.stopExternalVideoTrack():this.stopVideoStream()}}]),e}(),FullscreenHandler=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fsFitMode:"contain"};_classCallCheck(this,e),this._player=t,this.fsFitMode=n.fsFitMode||"contain";var i=t.containerDomId,o=document.getElementById(i);this.unbindScreenChangeEventFn=fullscreenHelper.bindFullscreenchange(document,(function(e){var t=o.querySelector("video");t&&(fullscreenHelper.fullscreenElement?(t.style["object-fit"]=r.fsFitMode,r._player.emit("full-screen-change",{originalEvent:e,state:!0})):(t.style["object-fit"]="contain",r._player.emit("full-screen-change",{originalEvent:e,state:!1})))})),this.unbindScreenErrorEventFn=fullscreenHelper.bindFullscreenerror((function(e){r._player.emit("full-screen-error",{originalEvent:e})}))}return _createClass(e,[{key:"setFullScreenState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.fitMode,n=void 0===r?"":r;n&&(this.fsFitMode=n);var i=this._player.containerDomId,o=document.getElementById(i);o&&e&&!fullscreenHelper.fullscreenElement?fullscreenHelper.requestFullscreen(o):fullscreenHelper.exitFullscreen(),this._player.logger.send("setFullScreenState",{state:e});var a=o.querySelector("video");a&&(fullscreenHelper.fullscreenElement?a.style["object-fit"]=this.fsFitMode:a.style["object-fit"]="contain")}},{key:"destroy",value:function(){this.unbindScreenChangeEventFn(),this.unbindScreenErrorEventFn()}}]),e}(),StartWithFrameworkHandler=function(){function e(t){_classCallCheck(this,e),this._player=t,this.logger=this._player.logger}return _createClass(e,[{key:"handleWarningEvent",value:function(e){var t={};switch(e.data&&e.data.result){case 0:t=POD_WARNING.WARNING_START_WITH_FRAMEWORK_NOT_FOUND;break;case 1:t=POD_WARNING.WARNING_START_WITH_FRAMEWORK_PART_MATCH;break;case 2:t=POD_WARNING.WARNING_START_WITH_FRAMEWORK_WRONG_INPUT_FORMAT}var r=t,n=r.CODE,i=r.MESSAGE;this._player.logger.localWarnLog("PodTrigger","handleWarningEvent",e),this._player.logger.send("warning",{warningCode:n,message:i,extra:e.data}),this._player.emit("warning",{warningCode:n,message:i})}}]),e}(),SystemCursorShowStatHandler=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.systemCursorShowStatManual,o=void 0!==i&&i;_classCallCheck(this,e),this.onPointerLockChange=function(){r._localCursorShowStats=!(document.pointerLockElement===r._player.client.renderEle);var e=r._localCursorShowStats?"show":"hidden";r._player.emit("local-system-cursor-stat-changed",e),r._player.logger.send("localSystemCursorStatChanged",{status:e})},this._player=t,this._localCursorShowStats=!0,this._remoteCursorShowStats=!0,this._hasFirstTriggerFlag=!1,this._systemCursorShowStatManual=o,this._systemCursorShowStatControlKey=null,this._systemCursorShowStatControlKeyListener=null,this._cursorSensitivity=1,this._init()}return _createClass(e,[{key:"localCursorShowStats",get:function(){return this._localCursorShowStats}},{key:"cursorSensitivity",get:function(){return this._cursorSensitivity}},{key:"_init",value:function(){document.addEventListener("pointerlockchange",this.onPointerLockChange,!1)}},{key:"handleMessage",value:function(e){var t,r,n=!0;e.type===ProtoBufMessage.protoRoot.MsgType.MsgOutput&&e.subtype===ProtoBufMessage.protoRoot.MsgOutputType.MsgOutputCursorImage&&(n=!(0===(null==e||null===(t=e.msg)||void 0===t?void 0:t.id)));e.type===ProtoBufMessage.protoRoot.MsgType.MsgOutput&&e.subtype===ProtoBufMessage.protoRoot.MsgOutputType.MsgOutputCursorVisibility&&(n=!(null==e||null===(r=e.msg)||void 0===r||!r.visible));this._remoteCursorShowStats=n;var i=n?"show":"hidden";this._player.emit("system-cursor-stat-changed",i),this._player.logger.send("systemCursorStatChanged",{status:i}),this._systemCursorShowStatManual||(n&&this._player.client.renderEle===document.pointerLockElement?this.setSystemCursorShowStat(!0):this._hasFirstTriggerFlag=!1)}},{key:"setSystemCursorShowAuto",value:function(e){var t=this;if(!this._systemCursorShowStatManual){var r;if(!this._hasFirstTriggerFlag&&!this._remoteCursorShowStats&&this._localCursorShowStats&&!document.pointerLockElement)this.setSystemCursorShowStat(!1),null===(r=this._player.client.renderEle)||void 0===r||r.requestPointerLock().then((function(){t._hasFirstTriggerFlag=!0})).catch((function(e){console.log(e)}));this._hasFirstTriggerFlag&&"mousedown"===e&&!this._remoteCursorShowStats&&this._localCursorShowStats&&!document.pointerLockElement&&this.setSystemCursorShowStat(!1)}}},{key:"setSystemCursorShowStat",value:function(e){var t;(this._player.logger.send("setSystemCursorShowStat",{show:e}),e)?document.exitPointerLock():null===(t=this._player.client.renderEle)||void 0===t||t.requestPointerLock()}},{key:"setSystemCursorShowStatControlKey",value:function(e){var t=this;this._player.logger.send("setSystemCursorShowStatControlKey",{keyCode:e}),this._systemCursorShowStatControlKey=e,this._systemCursorShowStatControlKeyListener||(this._systemCursorShowStatControlKeyListener=function(e){e.code===t._systemCursorShowStatControlKey&&t.setSystemCursorShowStat(!0)},document.addEventListener("keyup",this._systemCursorShowStatControlKeyListener))}},{key:"setSystemCursorSensitivity",value:function(e){this._player.logger.send("setSystemCursorSensitivity",{sensitivity:e}),this._cursorSensitivity=e}},{key:"setSystemCursorShowStatManual",value:function(e){this._systemCursorShowStatManual=e}},{key:"destroy",value:function(){this._systemCursorShowStatControlKeyListener&&document.removeEventListener("keyup",this._systemCursorShowStatControlKeyListener),this._systemCursorShowStatControlKeyListener=null,this._systemCursorShowStatControlKey=null,document.removeEventListener("pointerlockchange",this.onPointerLockChange,!1)}}]),e}(),TouchDelayDetector=function(){function e(){_classCallCheck(this,e),this.checkIdList=[],this.firstMin=0,this.firstMax=0,this.lastMin=0,this.lastMax=0,this.firstSum=0,this.lastSum=0,this.frameCount=0,this.touchCount=0,this.lostTouchCount=0,this.lastTimeStamp=0,this.MAX_SIZE=1e3}return _createClass(e,[{key:"reset",value:function(){this.firstMin=this.firstMax=this.lastMin=this.lastMax=this.firstSum=this.lastSum=this.frameCount=this.touchCount=this.lostTouchCount=0}},{key:"geneCheckId",value:function(){var e=0|Date.now();return this.checkIdList.push(e),this.checkIdList.length>this.MAX_SIZE&&this.checkIdList.shift(),e}},{key:"receiveTouchDelayMessage",value:function(e){var t=e.check_id,r=e.has_touch_delay,n=e.min_check_id,i=e.max_check_id;if(r&&t){var o=0|Date.now(),a=o-n,s=o-i;(a<this.firstMin||!this.firstMin)&&(this.firstMin=a),a>this.firstMax&&(this.firstMax=a),(s<this.lastMin||!this.lastMin)&&(this.lastMin=s),s>this.lastMax&&(this.lastMax=s),this.firstSum+=a,this.lastSum+=s,this.frameCount++;var c=this.checkIdList.indexOf(n);c<0&&(c=this.checkIdList.length),this.lostTouchCount+=c;var u=this.checkIdList.indexOf(i);if(u>=0){var l=this.checkIdList.splice(0,u+1);this.touchCount+=l.length}}}},{key:"countTouchDelayData",value:function(){var e=Date.now();if(0===this.frameCount)return this.lastTimeStamp=e,this.reset(),null;var t=this.lastTimeStamp?e-this.lastTimeStamp:2e3,r={min_delay:[this.firstMin,Math.round(this.firstSum/this.frameCount),this.firstMax],max_delay:[this.lastMin,Math.round(this.lastSum/this.frameCount),this.lastMax],event_count:this.touchCount,loss_count:this.lostTouchCount,frame_count:this.frameCount,interval:t};return this.lastTimeStamp=e,this.reset(),r}},{key:"clearCheckIds",value:function(){this.checkIdList.length=0}}]),e}(),DetectDelayHandler=function(){function e(t,r){var n=this;r.mode,_classCallCheck(this,e),this.paused=!1,this._detectDelayCache=[],this.rvfcHandler=null,this.visibleHandler=null,this._player=t,this._detectDelayInterval=null,this._detectDelayInfo={},this.logger=this._player.logger,this.touchDelayDetector=new TouchDelayDetector,document.addEventListener("visibilitychange",this.visibleHandler=function(){"visible"===document.visibilityState&&(n._detectDelayInfo={},n._player.client.renderEle.cancelVideoFrameCallback(n.rvfcHandler),n.touchDelayDetector.clearCheckIds())})}return _createClass(e,[{key:"injectCheckId",value:function(e,t){this._detectDelayInfo[e]={sendTime:t||e}}},{key:"pause",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.paused=e,e&&(this._detectDelayInfo={})}},{key:"start",value:function(){var e=this;this._detectDelayInterval||(this._detectDelayInterval=setInterval((function(){if(!e.paused&&e._player.canOperate){e._report();var t=Date.now().toString(),r=MessageFactory$1.eventTestDelay(t);e._player._sendCustomMessage(r).then((function(){e.injectCheckId(t)}))}else e._detectDelayInfo={}}),2e3))}},{key:"_report",value:function(){var e=this.touchDelayDetector.countTouchDelayData(),t=this._detectDelayCache.shift()||{elapse:-1,elapse_decoded:-1,sei_to_decoded:-1};!e&&t.elapse<0||(e&&(t.touch_delay=e),this.logger.localTraceLog("Running","handleDetectDelayMessage",t.elapse),t.elapse>=0&&this._player.emit("delay-detected",t),this._player.logger.send("onDetectDelay",t))}},{key:"_receiveDelayTestMessage",value:function(e,t){var r=Date.now(),n=this._detectDelayInfo[t];delete this._detectDelayInfo[t];var i=n.sendTime,o={elapse:e-i,elapse_decoded:r-i,sei_to_decoded:r-e};this._detectDelayCache.push(o)}},{key:"_calcElapse",value:function(e){var t=this,r=e.check_id,n=e.has_touch_delay;if(r||n){var i=Date.now();this.rvfcHandler=this._player.client.renderEle.requestVideoFrameCallback((function(){n&&t.touchDelayDetector.receiveTouchDelayMessage(e),r&&t._detectDelayInfo[r]&&t._receiveDelayTestMessage(i,r)}))}}},{key:"handleDetectDelayMessage",value:function(e){var t=this,r=e.sei;if(MessageFactory$1.usePB){var n,i=ProtoBufMessage.decodePBMessage(r.buffer),o=null==i||null===(n=i.msg)||void 0===n?void 0:n.sei_node;if(!(o&&o instanceof Array))return;var a=null;return o.forEach((function(e){var r=ProtoBufMessage.decodeDelayTestMessagePodData(e.sei_data);t._calcElapse(r),a||(a=r)})),a}if("string"==typeof r){var s=JSON.parse(r);return this._calcElapse(s),s}var c=JSON.parse((new TextDecoder).decode(r));return c.op_type===CLIENT_EVENT_TYPE.EVENT_TEST_DELAY&&this._calcElapse(c),c}},{key:"stop",value:function(){this._detectDelayInterval&&(clearInterval(this._detectDelayInterval),this._detectDelayInterval=null),document.removeEventListener("visibilitychange",this.visibleHandler),this.touchDelayDetector.clearCheckIds()}}]),e}(),ControlRightHandler=function(){function e(t){_classCallCheck(this,e),this.role=CONTROL_ROLE_TYPE.Player,this.canOperate=!0,this._player=t;var r=t.options.podSettings;r&&this._setRole("number"==typeof r.role?r.role:0===r.type||void 0===r.type?CONTROL_ROLE_TYPE.Player:CONTROL_ROLE_TYPE.Viewer)}return _createClass(e,[{key:"isPlayer",get:function(){return this.role===CONTROL_ROLE_TYPE.Player}},{key:"userId",get:function(){return this._player.userId}},{key:"changeRole",value:function(e){var t=e.userId,r=e.role;this._player.logger.send("callChangeRole",{targetUid:t,role:r});var n=ProtoBufMessage.encodeControlChangeMsg({role:r,userId:t});return this._player._sendMessage(n,!0)}},{key:"handleMessage",value:function(e){if(e.type!==PB_MESSAGE.TYPES.MsgBusiness||!Object.values(PB_BUSINESS_CONTROL.SUBTYPES).includes(e.subtype))return!1;var t=e.subtype,r=e.msg,n=["control-start","control-change-response","control-player-update","control-notify"][t]||"control-change-default-result";return this._player.logger.send("receiveControlMsg",{name:n,subtype:t,msg:r}),t===CONTROL_SUBTYPES.ControlStart?this._onReceivePlayers(null==r?void 0:r.players,!1):t===CONTROL_SUBTYPES.ControlPlayerUpdate?this._onReceivePlayers(null==r?void 0:r.players,!0):t===CONTROL_SUBTYPES.ControlChange&&(r.result&&0!==r.result?this._player.options.isDebug&&console.warn("切换失败 result=".concat(r.result)):r.user_id===this.userId?this._setRole(null==r?void 0:r.role):(null==r?void 0:r.role)===CONTROL_ROLE_TYPE.Player&&this._setRole(CONTROL_ROLE_TYPE.Viewer)),this._player.options.isDebug&&console.warn("controlright",t,r,this.role),this._player.emit(n,e),!0}},{key:"_onReceivePlayers",value:function(e,t){if(e){var r=e.includes(this.userId);if(r&&t){var n=ProtoBufMessage.encodeControlNotifyMsg();this._player._sendMessage(n,!0)}this._setRole(r?CONTROL_ROLE_TYPE.Player:CONTROL_ROLE_TYPE.Viewer)}}},{key:"_setRole",value:function(e){void 0!==e&&e!==this.role&&(this._player.logger.send("changeUserControlRole",{role:e,userId:this.userId}),this.role=e,this.canOperate=this.role!==CONTROL_ROLE_TYPE.Viewer)}}]),e}(),ControlKeys={ArrowLeft:1,ArrowUp:1,ArrowRight:1,ArrowDown:1,Escape:1,Tab:1,ShiftLeft:1,ShiftRight:1,MetaRight:1,AltLeft:1,ControlLeft:1,AltRight:1,Backspace:1,Enter:1},PCImeHandler=function(){function e(t){_classCallCheck(this,e),this._player=null,this._lastClickPosition={x:0,y:0},this.inCompositionEvent=!1,this.isPC=isPC(),this.inInputMode=!1,this.showInput=!1,this.renderEle=null,this._player=t}return _createClass(e,[{key:"isInComposition",get:function(){return this.inInputMode&&this.inCompositionEvent}},{key:"needSendKey",value:function(e){var t=e.code||e.key;return"Tab"===t&&e.preventDefault(),this.inInputMode&&!this.isPC?!(!ControlKeys[t]||""!==this.input.value):!this.inCompositionEvent&&(!!ControlKeys[t]||!this.inInputMode)}},{key:"_setInputVisible",value:function(e){e?(this.showInput&&(this.isPC?(this.input.style.opacity="100",this.input.style.zIndex="100"):this.input.style.display="block"),this.enterInputMode()):this.isPC?(this.input.style.opacity="0",this.input.style.zIndex="-1"):this.input.style.display="none"}},{key:"_createInput",value:function(){var e=document.createElement("input"),t="vegame-input";e.className=t;var r="position:fixed; ";this.isPC?r+="z-index: -1;opacity: 0":(r+="transform: translatex(-50%);\n            width: 80%;\n            height: 40px;\n            max-width: 350px;\n            border-radius: 4px;\n            outline: none;\n            border: 1px solid #ddd;\n            box-shadow: 0 0 10px 0px rgb(0 0 0 / 20%);\n            padding-left: 10px;\n            top:8%;left:50%;\n            z-index: 10000;opacity: 1;\n            -webkit-appearance: none;\n            display: none;",e.setAttribute("placeholder",isiOS()?"点击输入框以进行输入":"请输入内容"));var n=document.createElement("style");return n.innerText=".".concat(t,"{").concat(r,"}"),document.head.insertBefore(n,document.head.children[0]),document.body.appendChild(e),e}},{key:"init",value:function(e){this.renderEle=e;var t=this._createInput();this.input=t,this._player.on("on-keyboard-enable-change",(function(e){t.__disabled=!e,t.disabled=!e})),this.isPC?this._initPCEvent(t,e):this._initH5Event(t,e)}},{key:"_initPCEvent",value:function(e,t){var r=this;t.addEventListener("click",(function(e){r._lastClickPosition={x:e.clientX,y:e.clientY},setTimeout((function(){r.inInputMode&&r.enterInputMode()}),300)})),e.addEventListener("input",(function(){r.inCompositionEvent||(r.sendText(e.value),e.value="")})),e.addEventListener("compositionstart",(function(t){e.value="",r.inCompositionEvent=!0,r._setInputVisible(r.inCompositionEvent),r.sendImeMessage(IME_COMPOSITION_TYPE.ImeCompositionBegin)})),e.addEventListener("compositionupdate",(function(e){r.sendImeMessage(IME_COMPOSITION_TYPE.ImeComposition,e.data)})),e.addEventListener("compositionend",(function(t){r.inCompositionEvent=!1,r._setInputVisible(r.inCompositionEvent),r.sendImeMessage(IME_COMPOSITION_TYPE.ImeCompositionEnd),e.value=""}))}},{key:"_initH5Event",value:function(e,t){var r=this;e.addEventListener("change",(function(){e.value&&(r.sendText(e.value),e.value="",e.style.display="none",e.blur())}),!0),e.addEventListener("blur",(function(){e.value&&(e.value=""),e.style.display="none"}),!0),t.addEventListener("touchstart",(function(t){setTimeout((function(){r.inInputMode&&(e.style.display="block",e.focus())}),300)}))}},{key:"sendText",value:function(e){this.sendImeMessage(IME_COMPOSITION_TYPE.ImeCompositionBegin),this.sendImeMessage(IME_COMPOSITION_TYPE.ImeComposition,e),this.sendImeMessage(IME_COMPOSITION_TYPE.ImeCompositionEnd)}},{key:"enterInputMode",value:function(){if(this.inInputMode){if(this.isPC){var e=this._lastClickPosition,t=e.x,r=e.y;this.input.style.left=t+"px",this.input.style.top=r+"px"}else this.input.style.display="block";this.input.focus()}}},{key:"sendImeMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=ProtoBufMessage.encodeImeMsg({str:t,type:e});this._player._sendMessage(r,!0)}},{key:"handleMessage",value:function(e){if(e.type!==PB_MESSAGE.TYPES.MsgOutput||!Object.values(PB_OUTPUT_IME.SUBTYPES).includes(e.subtype))return!1;var t=e.subtype,r=e.msg;return t===PB_OUTPUT_IME.SUBTYPES.MsgOutputImeState&&(this.inInputMode=!!r.state,this.enterInputMode(),this._player._debug&&console.log("IME handleMessage",this.inInputMode),this.inInputMode||(this.input.blur(),this._setInputVisible(!1),this.inCompositionEvent&&(this.inCompositionEvent=!1,this.sendImeMessage(IME_COMPOSITION_TYPE.ImeComposition,""),this.sendImeMessage(IME_COMPOSITION_TYPE.ImeCompositionEnd),this.input.value=""))),!0}},{key:"setInputVisible",value:function(e,t){!0!==this.input.__disabled&&(this.showInput=e,e?(this.input.disabled=!1,this.input.setAttribute("style",this.input.getAttribute("style")+t)):this.input.disabled=!0)}}]),e}(),_excluded$1=["download_url"],ScreenRecordHandler=function(){function e(t){_classCallCheck(this,e),this.player=t}return _createClass(e,[{key:"handleResponse",value:function(e){var t=e.data||e.result||{};this.player.logger.send("screenRecordResponse",t);var r=t.download_url,n=_objectWithoutProperties(t,_excluded$1);this.player.emit("on-screen-record-response",_objectSpread2(_objectSpread2(_objectSpread2({},n),r&&{downloadUrl:r}),(null==t?void 0:t.save_path)&&{savePath:(null==t?void 0:t.savePath)||(null==t?void 0:t.save_path)}))}},{key:"startRecording",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e)return this.player.logger.send("startScreenRecord",{duration:e,isSavedOnPod:r}),new Promise((function(n,i){var o=MessageFactory$1.eventScreenRecordStart(e,r);t.player._sendCustomMessage(o).then((function(){n(!0)})).catch((function(){i()}))}));console.error("[startRecording] 请传入 duration ")}},{key:"stopRecording",value:function(){var e=this;return this.player.logger.send("stopScreenRecord",{}),new Promise((function(t,r){var n=MessageFactory$1.eventScreenRecordStop();e.player._sendCustomMessage(n).then((function(){t(!0)})).catch((function(){r()}))}))}}]),e}(),KeyboardDisableHandler=function(){function e(t){_classCallCheck(this,e),this.player=null,this._enabled=!0,this.player=t}return _createClass(e,[{key:"setEnabled",value:function(e){e!==this._enabled&&(this._enabled=e,this.player.emit("on-keyboard-enable-change",e))}},{key:"handleResponse",value:function(e){this.player._debug&&console.log(LOG_TAG,"server keyboard disabled response: "+JSON.stringify(e));var t=e.data||e.result||{};"boolean"==typeof t.enable&&this.setEnabled(t.enable),this.player.logger.send("onKeyboardResult",t),this.player.emit("on-keyboard-enable-result",t)}},{key:"setKeyboardEnable",value:function(e){var t=this;if(void 0!==e)return this.player.logger.send("keyboardEnable",{enable:e}),new Promise((function(r,n){var i=MessageFactory$1.eventKeyboardEnable(e);t.player._sendCustomMessage(i).then((function(){r(!0)})).catch((function(){n()}))}));console.error("[setKeyboardEnable] 请传入 enable ")}},{key:"getKeyboardEnable",value:function(){return this._enabled}}]),e}(),BAD_RTT_THRESHOLD=400,BAD_LOSS_THRESHOLD=.2,MIN_BANDWIDTH_THRESHOLD=150,BAD_STATUS_QUEUE_SIZE=3,NetworkQuality={VERY_BAD:5,BAD:4,GOOD:2,DOWN:6,UNKNOWN:0,EXCELLENT:1,POOR:3},NetworkHandler=function(){function e(t){var r=this;_classCallCheck(this,e),this.queue=[],this.player=t,this.mIsVideoPlaying=!0,this.mIsAudioPlaying=!0,this.mHasFirstVideoFrame=!1,this.mNetworkDown=!1,this.visibilityState=!0,this.player.on("_onConnectionStateChanged",(function(e){r.networkStatus=null==e?void 0:e.state,r.mNetworkDown=1===r.networkStatus||4===r.networkStatus||6===r.networkStatus})),this.player.on("_onVideoFirstFrameRendered",(function(e){r.mHasFirstVideoFrame=!0})),this.player.on("on-visible-change",(function(e){r.visibilityState=e})),this.player.on("_onVideoPlaying",(function(e){null!=e&&e.video?r.mIsVideoPlaying=!1:r.mIsVideoPlaying=!0,null!=e&&e.audio?r.mIsAudioPlaying=!1:r.mIsAudioPlaying=!0})),this.player.on("received-stream-stats",(function(e){(r.visibilityState||!r.visibilityState&&r.mIsAudioPlaying)&&r.player.emit("network-quality",r._receiveStat(e.stats))}))}return _createClass(e,[{key:"_receiveStat",value:function(e){if(this.mNetworkDown&&(this.queue=[]),!this.mHasFirstVideoFrame)return NetworkQuality.VERY_BAD;if(this.mHasFirstVideoFrame&&0===e.stallDuration||!this.mIsVideoPlaying)return this.queue=[],e.rtt>BAD_RTT_THRESHOLD?NetworkQuality.BAD:NetworkQuality.GOOD;this.queue.push(e),this.queue.length>3&&this.queue.shift();for(var t=0,r=0,n=0;n<this.queue.length;n++){var i=this.queue[n];i.receivedKBitrate<=MIN_BANDWIDTH_THRESHOLD?r+=1:(i.rtt>BAD_RTT_THRESHOLD||i.videoLossRate>BAD_LOSS_THRESHOLD)&&(t+=1)}return r===BAD_STATUS_QUEUE_SIZE?NetworkQuality.DOWN:t+r>0?t+r<BAD_STATUS_QUEUE_SIZE?NetworkQuality.BAD:NetworkQuality.VERY_BAD:NetworkQuality.GOOD}}]),e}();NetworkHandler.NetworkQuality=NetworkQuality;var logger=new Logger$2({});function _isSocketSupported(){if(!getPluginNames().includes("socketEngine"))return{result:!1,info:"请先安装 socket 插件"};var e="WebAssembly"in window,t=!1;return"customElements"in window&&window.customElements.define&&(t=!0),{result:e&&t,info:" wasm:".concat(e," webCustomElements:").concat(t)}}function isSocketSupported(){var e=_isSocketSupported(),t=e.result,r=e.info;return t||logger.localWarnLog("Init","isSupported","Websocket is not supported, because ",r),t}function isRtcSupported(){return _isRtcSupported2.apply(this,arguments)}function _isRtcSupported2(){return _isRtcSupported2=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_isRtcSupported();case 2:return t=e.sent,r=t.result,n=t.info,r||logger.localWarnLog("Init","isSupported","RTC is not supported, because ",n),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)}))),_isRtcSupported2.apply(this,arguments)}function isSupportedStatic(){return _isSupportedStatic.apply(this,arguments)}function _isSupportedStatic(){return(_isSupportedStatic=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,isRtcSupported();case 2:return e.t0=e.sent,e.t1=isSocketSupported(),e.abrupt("return",{rtcSupport:e.t0,socketSupport:e.t1});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function isSupported(){return _isSupported.apply(this,arguments)}function _isSupported(){return _isSupported=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=_isSocketSupported(),void 0!==this._isSocketSupport&&(t.result=this._isSocketSupport),logger.localInfoLog("Init","isSupported","Websocket supported is",t),this.logger.send("socketSupport",{result:t.result,msg:t.info}),e.next=6,_isRtcSupported(this.mode===MODE.CLOUD_PC);case 6:return r=e.sent,n=r.result,i=r.info,logger[n?"localInfoLog":"localWarnLog"]("Init","isSupported","rtc supported is ".concat(n,": ").concat(i)),n||this.logger.send("rtcNotSupported",{info:i}),e.abrupt("return",{rtcSupport:n,socketSupport:t.result});case 12:case"end":return e.stop()}}),e,this)}))),_isSupported.apply(this,arguments)}function _isRtcSupported(){return _isRtcSupported3.apply(this,arguments)}function _isRtcSupported3(){return _isRtcSupported3=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],r=function(e){return console.warn("NOT SUPPORTED: ".concat(e)),{result:!1,info:e}},e.prev=2,e.next=5,decodeSupported();case 5:if(n=e.sent,console.log("decodeSupported",n),n.h264||n.vp8){e.next=9;break}return e.abrupt("return",r("h264 and vp8 not supported"));case 9:if(n.h264||!t){e.next=11;break}return e.abrupt("return",r("h264 not Supported"));case 11:return e.abrupt("return",{result:!0,info:""});case 14:return e.prev=14,e.t0=e.catch(2),console.warn(e.t0),e.abrupt("return",r(e.t0.message));case 18:case"end":return e.stop()}}),e,null,[[2,14]])}))),_isRtcSupported3.apply(this,arguments)}function decodeSupported(){return _decodeSupported.apply(this,arguments)}function _decodeSupported(){return _decodeSupported=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new RTCPeerConnection).addTransceiver("video",{direction:t}),e.next=4,n.createOffer();case 4:return i=e.sent,n.close(),e.abrupt("return",(null===(r=i.sdp)||void 0===r?void 0:r.toLowerCase())||"");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("sendonly");case 2:return r=e.sent,n=["profile-level-id=42e01f","H264"].find((function(e){return null==r?void 0:r.includes(e)})),e.abrupt("return",{h264:!!n,vp8:r.indexOf("vp8")>-1});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=4,r();case 4:if(!(n=e.sent).h264||!n.vp8){e.next=7;break}return e.abrupt("return",n);case 7:return e.next=9,r();case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)}))),_decodeSupported.apply(this,arguments)}var BaseHandler=null,MessageFactory=null,randomNumString=null,POD_ERROR=null;function injectBridge(e){BaseHandler=e.BaseHandler,e.CLIENT_EVENT_TYPE,MessageFactory=e.MessageFactory,randomNumString=e.randomNumString,POD_ERROR=e.POD_ERROR,e.fetchBase}var HandlerPlugin={pluginName:"handlers",injectBridge:injectBridge},BaseHandlerProxy=function(){function e(t,r){var n=this;_classCallCheck(this,e),this.player=t,this.manager=r,this.base=new BaseHandler(t,r),this.base.onMessage=function(e){n.onMessage(e)}}return _createClass(e,[{key:"init",value:function(){}},{key:"destroy",value:function(){}},{key:"handleMessage",value:function(e){return void 0===this.base.pbType&&(this.base.pbType=this.pbType),this.base.pbSubTypes||(this.base.pbSubTypes=this.pbSubTypes),this.base.handleMessage(e)}},{key:"onMessage",value:function(e){}},{key:"on",value:function(e,t){this.base.on(e,t)}},{key:"off",value:function(e,t){this.base.off(e,t)}},{key:"emit",value:function(e,t){this.base.emit(e,t)}},{key:"log",value:function(e,t){this.base.log(e,t)}},{key:"print",value:function(e){this.base.print(e)}},{key:"sendPBMessage",value:function(e){return this.base.sendPBMessage(e)}},{key:"sendJsonMessage",value:function(e){return this.base.sendJsonMessage(e)}},{key:"setLogInfo",value:function(e,t){this.base.setLogInfo(e,t)}}]),e}();function commonjsRequire(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}BaseHandlerProxy.HandlerPlugin=HandlerPlugin;var localforage={exports:{}};!function(e,t){e.exports=function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var c="function"==typeof commonjsRequire&&commonjsRequire;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[a]={exports:{}};t[a][0].call(l.exports,(function(e){var r=t[a][1][e];return i(r||e)}),l,l.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof commonjsRequire&&commonjsRequire,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){(function(e){var r,n,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,a=new i(l),s=e.document.createTextNode("");a.observe(s,{characterData:!0}),r=function(){s.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)};else{var c=new e.MessageChannel;c.port1.onmessage=l,r=function(){c.port2.postMessage(0)}}var u=[];function l(){var e,t;n=!0;for(var r=u.length;r;){for(t=u,u=[],e=-1;++e<r;)t[e]();r=u.length}n=!1}function d(e){1!==u.push(e)||n||r()}t.exports=d}).call(this,void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,r){var n=e(1);function i(){}var o={},a=["REJECTED"],s=["FULFILLED"],c=["PENDING"];function u(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&_(this,e)}function l(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function d(e,t,r){n((function(){var n;try{n=t(r)}catch(e2){return o.reject(e,e2)}n===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,n)}))}function p(e){var t=e&&e.then;if(e&&("object"===_typeof(e)||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function _(e,t){var r=!1;function n(t){r||(r=!0,o.reject(e,t))}function i(t){r||(r=!0,o.resolve(e,t))}function a(){t(i,n)}var s=h(a);"error"===s.status&&n(s.value)}function h(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e2){r.status="error",r.value=e2}return r}function f(e){return e instanceof this?e:o.resolve(new this(i),e)}function m(e){var t=new this(i);return o.reject(t,e)}function g(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var a=new Array(r),s=0,c=-1,u=new this(i);++c<r;)l(e[c],c);return u;function l(e,i){function c(e){a[i]=e,++s!==r||n||(n=!0,o.resolve(u,a))}t.resolve(e).then(c,(function(e){n||(n=!0,o.reject(u,e))}))}}function v(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var a=-1,s=new this(i);++a<r;)c(e[a]);return s;function c(e){t.resolve(e).then((function(e){n||(n=!0,o.resolve(s,e))}),(function(e){n||(n=!0,o.reject(s,e))}))}}t.exports=u,u.prototype.catch=function(e){return this.then(null,e)},u.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===a)return this;var r=new this.constructor(i);return this.state!==c?d(r,this.state===s?e:t,this.outcome):this.queue.push(new l(r,e,t)),r},l.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},l.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},l.prototype.callRejected=function(e){o.reject(this.promise,e)},l.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},o.resolve=function(e,t){var r=h(p,t);if("error"===r.status)return o.reject(e,r.value);var n=r.value;if(n)_(e,n);else{e.state=s,e.outcome=t;for(var i=-1,a=e.queue.length;++i<a;)e.queue[i].callFulfilled(t)}return e},o.reject=function(e,t){e.state=a,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},u.resolve=f,u.reject=m,u.all=g,u.race=v},{1:1}],3:[function(e,t,r){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,r){var n="function"==typeof Symbol&&"symbol"===_typeof(Symbol.iterator)?function(e){return _typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof(e)};function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e2){return}}var a=o();function s(){try{if(!a||!a.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e2){return!1}}function c(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(e2){if("TypeError"!==e2.name)throw e2;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)r.append(e[n]);return r.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var u=Promise;function l(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function d(e,t,r){"function"==typeof t&&e.then(t),"function"==typeof r&&e.catch(r)}function p(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function _(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var h="local-forage-detect-blob-support",f=void 0,m={},g=Object.prototype.toString,v="readonly",y="readwrite";function S(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;i<t;i++)n[i]=e.charCodeAt(i);return r}function E(e){return new u((function(t){var r=e.transaction(h,y),n=c([""]);r.objectStore(h).put(n,"key"),r.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},r.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);t(r||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}function T(e){return"boolean"==typeof f?u.resolve(f):E(e).then((function(e){return f=e}))}function b(e){var t=m[e.name],r={};r.promise=new u((function(e,t){r.resolve=e,r.reject=t})),t.deferredOperations.push(r),t.dbReady?t.dbReady=t.dbReady.then((function(){return r.promise})):t.dbReady=r.promise}function R(e){var t=m[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function C(e,t){var r=m[e.name].deferredOperations.pop();if(r)return r.reject(t),r.promise}function k(e,t){return new u((function(r,n){if(m[e.name]=m[e.name]||L(),e.db){if(!t)return r(e.db);b(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var o=a.open.apply(a,i);t&&(o.onupgradeneeded=function(t){var r=o.result;try{r.createObjectStore(e.storeName),t.oldVersion<=1&&r.createObjectStore(h)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),o.onerror=function(e){e.preventDefault(),n(o.error)},o.onsuccess=function(){var t=o.result;t.onversionchange=function(e){e.target.close()},r(t),R(e)}}))}function I(e){return k(e,!1)}function A(e){return k(e,!0)}function O(e,t){if(!e.db)return!0;var r=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,i=e.version>e.db.version;if(n&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||r){if(r){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function M(e){return new u((function(t,r){var n=new FileReader;n.onerror=r,n.onloadend=function(r){var n=btoa(r.target.result||"");t({__local_forage_encoded_blob:!0,data:n,type:e.type})},n.readAsBinaryString(e)}))}function P(e){return c([S(atob(e.data))],{type:e.type})}function w(e){return e&&e.__local_forage_encoded_blob}function D(e){var t=this,r=t._initReady().then((function(){var e=m[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return d(r,e,e),r}function N(e){b(e);for(var t=m[e.name],r=t.forages,n=0;n<r.length;n++){var i=r[n];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,I(e).then((function(t){return e.db=t,O(e)?A(e):t})).then((function(n){e.db=t.db=n;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=n})).catch((function(t){throw C(e,t),t}))}function x(e,t,r,n){void 0===n&&(n=1);try{var i=e.db.transaction(e.storeName,t);r(null,i)}catch(err2){if(n>0&&(!e.db||"InvalidStateError"===err2.name||"NotFoundError"===err2.name))return u.resolve().then((function(){if(!e.db||"NotFoundError"===err2.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),A(e)})).then((function(){return N(e).then((function(){x(e,t,r,n-1)}))})).catch(r);r(err2)}}function L(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function $(e){var t=this,r={db:null};if(e)for(var n in e)r[n]=e[n];var i=m[r.name];i||(i=L(),m[r.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=D);var o=[];function a(){return u.resolve()}for(var s=0;s<i.forages.length;s++){var c=i.forages[s];c!==t&&o.push(c._initReady().catch(a))}var l=i.forages.slice(0);return u.all(o).then((function(){return r.db=i.db,I(r)})).then((function(e){return r.db=e,O(r,t._defaultConfig.version)?A(r):e})).then((function(e){r.db=i.db=e,t._dbInfo=r;for(var n=0;n<l.length;n++){var o=l[n];o!==t&&(o._dbInfo.db=r.db,o._dbInfo.version=r.version)}}))}function B(e,t){var r=this;e=p(e);var n=new u((function(t,n){r.ready().then((function(){x(r._dbInfo,v,(function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName).get(e);a.onsuccess=function(){var e=a.result;void 0===e&&(e=null),w(e)&&(e=P(e)),t(e)},a.onerror=function(){n(a.error)}}catch(e2){n(e2)}}))})).catch(n)}));return l(n,t),n}function U(e,t){var r=this,n=new u((function(t,n){r.ready().then((function(){x(r._dbInfo,v,(function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName).openCursor(),s=1;a.onsuccess=function(){var r=a.result;if(r){var n=r.value;w(n)&&(n=P(n));var i=e(n,r.key,s++);void 0!==i?t(i):r.continue()}else t()},a.onerror=function(){n(a.error)}}catch(e2){n(e2)}}))})).catch(n)}));return l(n,t),n}function F(e,t,r){var n=this;e=p(e);var i=new u((function(r,i){var o;n.ready().then((function(){return o=n._dbInfo,"[object Blob]"===g.call(t)?T(o.db).then((function(e){return e?t:M(t)})):t})).then((function(t){x(n._dbInfo,y,(function(o,a){if(o)return i(o);try{var s=a.objectStore(n._dbInfo.storeName);null===t&&(t=void 0);var c=s.put(t,e);a.oncomplete=function(){void 0===t&&(t=null),r(t)},a.onabort=a.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e2){i(e2)}}))})).catch(i)}));return l(i,r),i}function V(e,t){var r=this;e=p(e);var n=new u((function(t,n){r.ready().then((function(){x(r._dbInfo,y,(function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName).delete(e);o.oncomplete=function(){t()},o.onerror=function(){n(a.error)},o.onabort=function(){var e=a.error?a.error:a.transaction.error;n(e)}}catch(e2){n(e2)}}))})).catch(n)}));return l(n,t),n}function G(e){var t=this,r=new u((function(e,r){t.ready().then((function(){x(t._dbInfo,y,(function(n,i){if(n)return r(n);try{var o=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(e2){r(e2)}}))})).catch(r)}));return l(r,e),r}function j(e){var t=this,r=new u((function(e,r){t.ready().then((function(){x(t._dbInfo,v,(function(n,i){if(n)return r(n);try{var o=i.objectStore(t._dbInfo.storeName).count();o.onsuccess=function(){e(o.result)},o.onerror=function(){r(o.error)}}catch(e2){r(e2)}}))})).catch(r)}));return l(r,e),r}function K(e,t){var r=this,n=new u((function(t,n){e<0?t(null):r.ready().then((function(){x(r._dbInfo,v,(function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName),s=!1,c=a.openKeyCursor();c.onsuccess=function(){var r=c.result;r?0===e||s?t(r.key):(s=!0,r.advance(e)):t(null)},c.onerror=function(){n(c.error)}}catch(e2){n(e2)}}))})).catch(n)}));return l(n,t),n}function H(e){var t=this,r=new u((function(e,r){t.ready().then((function(){x(t._dbInfo,v,(function(n,i){if(n)return r(n);try{var o=i.objectStore(t._dbInfo.storeName).openKeyCursor(),a=[];o.onsuccess=function(){var t=o.result;t?(a.push(t.key),t.continue()):e(a)},o.onerror=function(){r(o.error)}}catch(e2){r(e2)}}))})).catch(r)}));return l(r,e),r}function z(e,t){t=_.apply(this,arguments);var r=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var n,i=this;if(e.name){var o=e.name===r.name&&i._dbInfo.db?u.resolve(i._dbInfo.db):I(e).then((function(t){var r=m[e.name],n=r.forages;r.db=t;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=t;return t}));n=e.storeName?o.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var r=t.version+1;b(e);var n=m[e.name],i=n.forages;t.close();for(var o=0;o<i.length;o++){var s=i[o];s._dbInfo.db=null,s._dbInfo.version=r}return new u((function(t,n){var i=a.open(e.name,r);i.onerror=function(e){i.result.close(),n(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<i.length;t++){var r=i[t];r._dbInfo.db=e,R(r._dbInfo)}})).catch((function(t){throw(C(e,t)||u.resolve()).catch((function(){})),t}))}})):o.then((function(t){b(e);var r=m[e.name],n=r.forages;t.close();for(var i=0;i<n.length;i++)n[i]._dbInfo.db=null;return new u((function(t,r){var n=a.deleteDatabase(e.name);n.onerror=function(){var e=n.result;e&&e.close(),r(n.error)},n.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},n.onsuccess=function(){var e=n.result;e&&e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<n.length;t++)R(n[t]._dbInfo)})).catch((function(t){throw(C(e,t)||u.resolve()).catch((function(){})),t}))}))}else n=u.reject("Invalid arguments");return l(n,t),n}var Y={_driver:"asyncStorage",_initStorage:$,_support:s(),iterate:U,getItem:B,setItem:F,removeItem:V,clear:G,length:j,key:K,keys:H,dropInstance:z};function W(){return"function"==typeof openDatabase}var q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",X="~~local_forage_type~",J=/^~~local_forage_type~([^~]+)~/,Z="__lfsc__:",Q=Z.length,ee="arbf",te="blob",re="si08",ne="ui08",ie="uic8",oe="si16",ae="si32",se="ur16",ce="ui32",ue="fl32",le="fl64",de=Q+ee.length,pe=Object.prototype.toString;function _e(e){var t,r,n,i,o,a=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var u=new ArrayBuffer(a),l=new Uint8Array(u);for(t=0;t<s;t+=4)r=q.indexOf(e[t]),n=q.indexOf(e[t+1]),i=q.indexOf(e[t+2]),o=q.indexOf(e[t+3]),l[c++]=r<<2|n>>4,l[c++]=(15&n)<<4|i>>2,l[c++]=(3&i)<<6|63&o;return u}function he(e){var t,r=new Uint8Array(e),n="";for(t=0;t<r.length;t+=3)n+=q[r[t]>>2],n+=q[(3&r[t])<<4|r[t+1]>>4],n+=q[(15&r[t+1])<<2|r[t+2]>>6],n+=q[63&r[t+2]];return r.length%3==2?n=n.substring(0,n.length-1)+"=":r.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}function fe(e,t){var r="";if(e&&(r=pe.call(e)),e&&("[object ArrayBuffer]"===r||e.buffer&&"[object ArrayBuffer]"===pe.call(e.buffer))){var n,i=Z;e instanceof ArrayBuffer?(n=e,i+=ee):(n=e.buffer,"[object Int8Array]"===r?i+=re:"[object Uint8Array]"===r?i+=ne:"[object Uint8ClampedArray]"===r?i+=ie:"[object Int16Array]"===r?i+=oe:"[object Uint16Array]"===r?i+=se:"[object Int32Array]"===r?i+=ae:"[object Uint32Array]"===r?i+=ce:"[object Float32Array]"===r?i+=ue:"[object Float64Array]"===r?i+=le:t(new Error("Failed to get type for BinaryArray"))),t(i+he(n))}else if("[object Blob]"===r){var o=new FileReader;o.onload=function(){var r=X+e.type+"~"+he(this.result);t(Z+te+r)},o.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(e2){console.error("Couldn't convert value into a JSON string: ",e),t(null,e2)}}function me(e){if(e.substring(0,Q)!==Z)return JSON.parse(e);var t,r=e.substring(de),n=e.substring(Q,de);if(n===te&&J.test(r)){var i=r.match(J);t=i[1],r=r.substring(i[0].length)}var o=_e(r);switch(n){case ee:return o;case te:return c([o],{type:t});case re:return new Int8Array(o);case ne:return new Uint8Array(o);case ie:return new Uint8ClampedArray(o);case oe:return new Int16Array(o);case se:return new Uint16Array(o);case ae:return new Int32Array(o);case ce:return new Uint32Array(o);case ue:return new Float32Array(o);case le:return new Float64Array(o);default:throw new Error("Unkown type: "+n)}}var ge={serialize:fe,deserialize:me,stringToBuffer:_e,bufferToString:he};function ve(e,t,r,n){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],r,n)}function ye(e){var t=this,r={db:null};if(e)for(var n in e)r[n]="string"!=typeof e[n]?e[n].toString():e[n];var i=new u((function(e,n){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(e2){return n(e2)}r.db.transaction((function(i){ve(i,r,(function(){t._dbInfo=r,e()}),(function(e,t){n(t)}))}),n)}));return r.serializer=ge,i}function Se(e,t,r,n,i,o){e.executeSql(r,n,i,(function(e,a){a.code===a.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,s){s.rows.length?o(e,a):ve(e,t,(function(){e.executeSql(r,n,i,o)}),o)}),o):o(e,a)}),o)}function Ee(e,t){var r=this;e=p(e);var n=new u((function(t,n){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){Se(r,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,r){var n=r.rows.length?r.rows.item(0).value:null;n&&(n=i.serializer.deserialize(n)),t(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return l(n,t),n}function Te(e,t){var r=this,n=new u((function(t,n){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){Se(r,i,"SELECT * FROM "+i.storeName,[],(function(r,n){for(var o=n.rows,a=o.length,s=0;s<a;s++){var c=o.item(s),u=c.value;if(u&&(u=i.serializer.deserialize(u)),void 0!==(u=e(u,c.key,s+1)))return void t(u)}t()}),(function(e,t){n(t)}))}))})).catch(n)}));return l(n,t),n}function be(e,t,r,n){var i=this;e=p(e);var o=new u((function(o,a){i.ready().then((function(){void 0===t&&(t=null);var s=t,c=i._dbInfo;c.serializer.serialize(t,(function(t,u){u?a(u):c.db.transaction((function(r){Se(r,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){o(s)}),(function(e,t){a(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(n>0)return void o(be.apply(i,[e,s,r,n-1]));a(t)}}))}))})).catch(a)}));return l(o,r),o}function Re(e,t,r){return be.apply(this,[e,t,r,1])}function Ce(e,t){var r=this;e=p(e);var n=new u((function(t,n){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){Se(r,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){n(t)}))}))})).catch(n)}));return l(n,t),n}function ke(e){var t=this,r=new u((function(e,r){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){Se(t,n,"DELETE FROM "+n.storeName,[],(function(){e()}),(function(e,t){r(t)}))}))})).catch(r)}));return l(r,e),r}function Ie(e){var t=this,r=new u((function(e,r){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){Se(t,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],(function(t,r){var n=r.rows.item(0).c;e(n)}),(function(e,t){r(t)}))}))})).catch(r)}));return l(r,e),r}function Ae(e,t){var r=this,n=new u((function(t,n){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){Se(r,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,r){var n=r.rows.length?r.rows.item(0).key:null;t(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return l(n,t),n}function Oe(e){var t=this,r=new u((function(e,r){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){Se(t,n,"SELECT key FROM "+n.storeName,[],(function(t,r){for(var n=[],i=0;i<r.rows.length;i++)n.push(r.rows.item(i).key);e(n)}),(function(e,t){r(t)}))}))})).catch(r)}));return l(r,e),r}function Me(e){return new u((function(t,r){e.transaction((function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(r,n){for(var i=[],o=0;o<n.rows.length;o++)i.push(n.rows.item(o).name);t({db:e,storeNames:i})}),(function(e,t){r(t)}))}),(function(e){r(e)}))}))}function Pe(e,t){t=_.apply(this,arguments);var r=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var n,i=this;return n=e.name?new u((function(t){var n;n=e.name===r.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:n,storeNames:[e.storeName]}):t(Me(n))})).then((function(e){return new u((function(t,r){e.db.transaction((function(n){function i(e){return new u((function(t,r){n.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){r(t)}))}))}for(var o=[],a=0,s=e.storeNames.length;a<s;a++)o.push(i(e.storeNames[a]));u.all(o).then((function(){t()})).catch((function(e){r(e)}))}),(function(e){r(e)}))}))})):u.reject("Invalid arguments"),l(n,t),n}var we={_driver:"webSQLStorage",_initStorage:ye,_support:W(),iterate:Te,getItem:Ee,setItem:Re,removeItem:Ce,clear:ke,length:Ie,key:Ae,keys:Oe,dropInstance:Pe};function De(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e2){return!1}}function Ne(e,t){var r=e.name+"/";return e.storeName!==t.storeName&&(r+=e.storeName+"/"),r}function xe(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e2){return!0}}function Le(){return!xe()||localStorage.length>0}function $e(e){var t=this,r={};if(e)for(var n in e)r[n]=e[n];return r.keyPrefix=Ne(e,t._defaultConfig),Le()?(t._dbInfo=r,r.serializer=ge,u.resolve()):u.reject()}function Be(e){var t=this,r=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,r=localStorage.length-1;r>=0;r--){var n=localStorage.key(r);0===n.indexOf(e)&&localStorage.removeItem(n)}}));return l(r,e),r}function Ue(e,t){var r=this;e=p(e);var n=r.ready().then((function(){var t=r._dbInfo,n=localStorage.getItem(t.keyPrefix+e);return n&&(n=t.serializer.deserialize(n)),n}));return l(n,t),n}function Fe(e,t){var r=this,n=r.ready().then((function(){for(var t=r._dbInfo,n=t.keyPrefix,i=n.length,o=localStorage.length,a=1,s=0;s<o;s++){var c=localStorage.key(s);if(0===c.indexOf(n)){var u=localStorage.getItem(c);if(u&&(u=t.serializer.deserialize(u)),void 0!==(u=e(u,c.substring(i),a++)))return u}}}));return l(n,t),n}function Ve(e,t){var r=this,n=r.ready().then((function(){var t,n=r._dbInfo;try{t=localStorage.key(e)}catch(i){t=null}return t&&(t=t.substring(n.keyPrefix.length)),t}));return l(n,t),n}function Ge(e){var t=this,r=t.ready().then((function(){for(var e=t._dbInfo,r=localStorage.length,n=[],i=0;i<r;i++){var o=localStorage.key(i);0===o.indexOf(e.keyPrefix)&&n.push(o.substring(e.keyPrefix.length))}return n}));return l(r,e),r}function je(e){var t=this.keys().then((function(e){return e.length}));return l(t,e),t}function Ke(e,t){var r=this;e=p(e);var n=r.ready().then((function(){var t=r._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return l(n,t),n}function He(e,t,r){var n=this;e=p(e);var i=n.ready().then((function(){void 0===t&&(t=null);var r=t;return new u((function(i,o){var a=n._dbInfo;a.serializer.serialize(t,(function(t,n){if(n)o(n);else try{localStorage.setItem(a.keyPrefix+e,t),i(r)}catch(e2){"QuotaExceededError"!==e2.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e2.name||o(e2),o(e2)}}))}))}));return l(i,r),i}function ze(e,t){if(t=_.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var r=this.config();e.name=e.name||r.name,e.storeName=e.storeName||r.storeName}var n,i=this;return n=e.name?new u((function(t){e.storeName?t(Ne(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var r=localStorage.key(t);0===r.indexOf(e)&&localStorage.removeItem(r)}})):u.reject("Invalid arguments"),l(n,t),n}var Ye={_driver:"localStorageWrapper",_initStorage:$e,_support:De(),iterate:Fe,getItem:Ue,setItem:He,removeItem:Ke,clear:Be,length:je,key:Ve,keys:Ge,dropInstance:ze},We=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},qe=function(e,t){for(var r=e.length,n=0;n<r;){if(We(e[n],t))return!0;n++}return!1},Xe=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Je={},Ze={},Qe={INDEXEDDB:Y,WEBSQL:we,LOCALSTORAGE:Ye},et=[Qe.INDEXEDDB._driver,Qe.WEBSQL._driver,Qe.LOCALSTORAGE._driver],tt=["dropInstance"],rt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(tt),nt={description:"",driver:et.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function it(e,t){e[t]=function(){var r=arguments;return e.ready().then((function(){return e[t].apply(e,r)}))}}function ot(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var r in t)t.hasOwnProperty(r)&&(Xe(t[r])?arguments[0][r]=t[r].slice():arguments[0][r]=t[r])}return arguments[0]}var at=function(){function e(t){for(var r in i(this,e),Qe)if(Qe.hasOwnProperty(r)){var n=Qe[r],o=n._driver;this[r]=o,Je[o]||this.defineDriver(n)}this._defaultConfig=ot({},nt),this._config=ot({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":n(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,r){var n=new u((function(t,r){try{var n=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void r(i);for(var o=rt.concat("_initStorage"),a=0,s=o.length;a<s;a++){var c=o[a];if((!qe(tt,c)||e[c])&&"function"!=typeof e[c])return void r(i)}var d=function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),r=u.reject(t);return l(r,arguments[arguments.length-1]),r}},r=0,n=tt.length;r<n;r++){var i=tt[r];e[i]||(e[i]=t(i))}};d();var p=function(r){Je[n]&&console.info("Redefining LocalForage driver: "+n),Je[n]=e,Ze[n]=r,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(p,r):p(!!e._support):p(!0)}catch(e2){r(e2)}}));return d(n,t,r),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,r){var n=Je[e]?u.resolve(Je[e]):u.reject(new Error("Driver not found."));return d(n,t,r),n},e.prototype.getSerializer=function(e){var t=u.resolve(ge);return d(t,e),t},e.prototype.ready=function(e){var t=this,r=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return d(r,e,e),r},e.prototype.setDriver=function(e,t,r){var n=this;Xe(e)||(e=[e]);var i=this._getSupportedDrivers(e);function o(){n._config.driver=n.driver()}function a(e){return n._extend(e),o(),n._ready=n._initStorage(n._config),n._ready}function s(e){return function(){var t=0;function r(){for(;t<e.length;){var i=e[t];return t++,n._dbInfo=null,n._ready=null,n.getDriver(i).then(a).catch(r)}o();var s=new Error("No available storage method found.");return n._driverSet=u.reject(s),n._driverSet}return r()}}var c=null!==this._driverSet?this._driverSet.catch((function(){return u.resolve()})):u.resolve();return this._driverSet=c.then((function(){var e=i[0];return n._dbInfo=null,n._ready=null,n.getDriver(e).then((function(e){n._driver=e._driver,o(),n._wrapLibraryMethodsWithReady(),n._initDriver=s(i)}))})).catch((function(){o();var e=new Error("No available storage method found.");return n._driverSet=u.reject(e),n._driverSet})),d(this._driverSet,t,r),this._driverSet},e.prototype.supports=function(e){return!!Ze[e]},e.prototype._extend=function(e){ot(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=rt.length;e<t;e++)it(this,rt[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),st=new at;t.exports=st},{3:3}]},{},[4])(4)}(localforage);var localforageExports=localforage.exports,localForage=getDefaultExportFromCjs$1(localforageExports),supported=!0;"indexedDB"in window||("webkitIndexedDB"in window?(window.indexedDB=window.webkitIndexedDB,window.IDBKeyRange=window.webkitIDBKeyRange,window.IDBTransaction=window.webkitIDBTransaction):"mozIndexedDB"in window?window.indexedDB=window.mozIndexedDB:supported=!1);var CacheManager=function(){function e(){_classCallCheck(this,e),_defineProperty$1(this,"md5","DEF"),_defineProperty$1(this,"loadedData",null),_defineProperty$1(this,"needReset",!1),_defineProperty$1(this,"supported",supported)}var t,r;return _createClass(e,[{key:"lenKey",get:function(){return"_FC_PART_".concat(this.md5,"_length")}},{key:"dataKey",get:function(){return"_FC_PART_".concat(this.md5)}},{key:"urlKey",get:function(){return"_FC_PART_".concat(this.md5,"_url")}},{key:"saveLength",value:function(e){localForage.setItem(this.lenKey,e)}},{key:"clearCache",value:function(){localForage.removeItem(this.lenKey),this._clearDataCache()}},{key:"_clearDataCache",value:function(){localForage.removeItem(this.dataKey),localForage.removeItem(this.urlKey),this.loadedData=null}},{key:"_checkNeedReset",value:function(){return!!this.needReset&&(this.needReset=!1,this._clearDataCache(),!0)}},{key:"checkPoint",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._checkNeedReset()){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,localForage.getItem(this.dataKey);case 4:return e.abrupt("return",!!e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"initLoadedData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._checkNeedReset()){e.next=2;break}return e.abrupt("return",0);case 2:if(this.loadedData){e.next=9;break}return e.next=5,localForage.getItem(this.dataKey);case 5:if(this.loadedData=e.sent,this.loadedData){e.next=9;break}return this.loadedData=[],e.abrupt("return",0);case 9:for(t=0,r=0;r<this.loadedData.length;r++)t+=this.loadedData[r].size;return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getFileLength",value:function(){return localForage.getItem(this.lenKey)}},{key:"saveBlob",value:function(e){this.loadedData.push(e),localForage.setItem(this.dataKey,this.loadedData)}},{key:"saveUrlInfo",value:function(e){localForage.setItem(this.urlKey,e)}},{key:"getUrlInfo",value:function(e){return localForage.getItem(this.urlKey,e)}},{key:"buildFile",value:function(){var e=new Blob(this.loadedData);return this.clearCache(),e}}]),e}(),DownloadProgress=function(){function e(){_classCallCheck(this,e),_defineProperty$1(this,"gap",5242880)}var t;return _createClass(e,[{key:"run",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.start,n=t.length,i=t.handler,o=t.onprogress,a=t.ondata,s=!1;case 2:if(s){e.next=16;break}return(c=r+this.gap-1)>=n&&(s=!0,c=""),e.next=7,i({start:r,end:c},(function(e){var t=r+e.loaded;o(100*t/n)}));case 7:if(u=e.sent,r=s?n:r+this.gap,u){e.next=13;break}return e.abrupt("return",!1);case 13:a(u,c);case 14:e.next=2;break;case 16:return e.abrupt("return",!0);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),Downloader=function(){function e(){_classCallCheck(this,e),_defineProperty$1(this,"start",0),_defineProperty$1(this,"url",""),_defineProperty$1(this,"cache",null),_defineProperty$1(this,"progress",null),_defineProperty$1(this,"request",null),_defineProperty$1(this,"fileSize",0),this.cache=new CacheManager,this.progress=new DownloadProgress}var t,r,n;return _createClass(e,[{key:"setUrl",value:function(e,t){this.cache.md5=t,this.url=e,this.cache.saveUrlInfo({url:e,md5:t})}},{key:"md5",get:function(){return this.cache.md5}},{key:"checkPoint",value:function(){return this.cache.checkPoint()}},{key:"download",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cache.supported){e.next=2;break}return e.abrupt("return",this.downloadAll(t));case 2:return e.next=4,this.cache.initLoadedData();case 4:return r=e.sent,e.next=7,this.getContentLength();case 7:return n=e.sent,this.fileSize=n,e.next=11,this.progress.run({length:n,start:r,handler:this._send.bind(this),onprogress:function(e){t(e)},ondata:function(e,t){console.log("ondata",e,t),i.cache.saveBlob(e)}});case 11:if(!e.sent){e.next=16;break}return e.abrupt("return",this.cache.buildFile());case 16:return e.abrupt("return",null);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"downloadAll",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._sendBase((function(e){e.onprogress=function(e){t(e)}})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_send",value:function(e,t){var r=this;return this._sendBase((function(n){n.setRequestHeader("Range","bytes=".concat(e.start,"-").concat(e.end)),n.onprogress=function(e){t(e)},r.request=n}))}},{key:"pause",value:function(){this.request&&this.request.abort()}},{key:"cancel",value:function(){this.pause(),this.cache.clearCache()}},{key:"getContentLength",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cache.getFileLength();case 2:if(!(t=e.sent)){e.next=5;break}return e.abrupt("return",t);case 5:return e.abrupt("return",new Promise((function(e){r._sendBase((function(t){t.onreadystatechange=function(n){2===n.readyState&&t.abort();var i=parseInt(t.getResponseHeader("Content-Length"));r.cache.saveLength(i),e(i)}}))})));case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_sendBase",value:function(e){var t=this;return new Promise((function(r){var n=new XMLHttpRequest;n.open("GET",t.url,!0),n.responseType="blob",e&&e(n),n.onload=function(){r(n.response)},n.onerror=function(){r(null)},n.send()}))}}]),e}(),ErrorMap={"-1":"ERROR_FILE_CHANNEL_FILE_NOT_FOUND","-2":"ERROR_FILE_CHANNEL_TIMEOUT","-3":"ERROR_FILE_CHANNEL_NETWORK_ABORT","-4":"ERROR_FILE_CHANNEL_NETWORK_ABORT","-5":"ERROR_FILE_CHANNEL_STORAGE_NOT_ENOUGH","-6":"ERROR_FILE_CHANNEL_FILE_NO_ACCESS","-7":"ERROR_FILE_CHANNEL_INTERNAL_ERROR"};function getFileChannelError(e){return POD_ERROR[ErrorMap[e]||ErrorMap[-3]]}var FileChannelMessenger=function(){function e(t){_classCallCheck(this,e),_defineProperty$1(this,"player",null),_defineProperty$1(this,"_logProgress",0),_defineProperty$1(this,"options",{}),this.player=t}return _createClass(e,[{key:"log",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,r=e.error,n=void 0===r?null:r,i=e.oErrc,o=e.oMsg,a=e.elapse,s=e.progress,c=e.fileSize,u={file_size:c,file_md5:this.options.md5};"start"===a?this._elapseStart=Date.now():"end"===a&&this._elapseStart&&(u.elapse=Date.now()-this._elapseStart),s&&(u.progress=this._logProgress),n&&(u.errc=n.CODE,u.msg=n.MESSAGE),i&&(u.oErrc=i),o&&(u.oMsg=o),this.options.options&&(u.options=Object.keys(this.options.options).join(",")),this.player.logger.send(t,u)}},{key:"_send",value:function(e){var t=MessageFactory.eventFileChannelSend(e,this.options);return this.player._sendCustomMessage(t)}},{key:"_sendDone",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.options,n=r.folder,i=r.name,o=r.md5,a=r.options,s={filePath:e?"/browser_download_dir/def":"".concat(n,"/").concat(i),md5:o,sendResult:t,subType:e?5:6};return a&&(s.options=a),this.player._sendCustomMessage(MessageFactory.veMessage({payload:s,type:7,userId:this.player.userId,mid:Date.now().toString()+randomNumString(4)}))}}]),e}(),DOWNLOAD_ACTION={RECEIVE_START:16,SEND_START:16,RECEIVE_UPLOAD_PROGRESS:17,RECEIVE_DOWNLOAD_URL:18,SEND_DOWNLOAD:19,SEND_CANCEL:8,RECEIVE_CANCEL:24},ACTIONS$1=Object.values(DOWNLOAD_ACTION),DownloadMessenger=function(e){_inherits(n,e);var t,r=_createSuper(n);function n(e){var t;return _classCallCheck(this,n),_defineProperty$1(_assertThisInitialized(t=r.call(this,e)),"player",null),_defineProperty$1(_assertThisInitialized(t),"downloader",null),_defineProperty$1(_assertThisInitialized(t),"fileName",""),_defineProperty$1(_assertThisInitialized(t),"returnUrl",!1),t.player=e,t.downloader=new Downloader,t}return _createClass(n,[{key:"handleResponse",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.player._debug&&console.log("server DownloadMessenger response: "+JSON.stringify(t)),r=t.data||t.result||{},n=r.action,i=r.carries,ACTIONS$1.includes(n)){e.next=4;break}return e.abrupt("return",!1);case 4:if(0===(o=i.result)){e.next=10;break}return this.player.emit("on-download-file-message-error",{action:n,carries:i}),this.logError(o),this._sendDone(!0,1),e.abrupt("return",!0);case 10:if(n!==DOWNLOAD_ACTION.RECEIVE_START){e.next=25;break}return this.options=i,this.log({name:"fileChannelReceiveOnStart",elapse:"start"}),e.next=15,this.downloader.cache.checkPoint();case 15:if(!e.sent){e.next=22;break}return e.next=18,this.downloader.cache.getUrlInfo();case 18:(a=e.sent)?(this.player._debug&&console.log("触发断点下载: ",a),this._download(a)):this._send(DOWNLOAD_ACTION.SEND_START),e.next=23;break;case 22:this._send(DOWNLOAD_ACTION.SEND_START);case 23:e.next=26;break;case 25:n===DOWNLOAD_ACTION.RECEIVE_UPLOAD_PROGRESS?this.onProgress(.5*i.progress):n===DOWNLOAD_ACTION.RECEIVE_DOWNLOAD_URL?(this.fileName=i.name,this._download(i)):n===DOWNLOAD_ACTION.RECEIVE_CANCEL&&(this.downloader.cancel(),this.player.emit("on-download-file-cancel",{reason:"from-server",carries:i}),this.log({name:"fileChannelReceiveOnCancel",elapse:"end",progress:!0}),this._sendDone(!0,2));case 26:return e.abrupt("return",!0);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_download",value:function(e){var t=this,r=e.url,n=e.md5;if(this.returnUrl)return this.onProgress(100),void this._onDownloadDone(decodeURIComponent(r));this.downloader.setUrl(r,n),this.downloader.download((function(e){t.onProgress(50+.5*e)})).then((function(e){t._onDownloadDone(e)})).catch((function(e){t.player.emit("on-download-file-request-error",{e:e,options:t.options}),t.logError("-3","from_client:客户端下载失败"),t._sendDone(!0,1)}))}},{key:"_onDownloadDone",value:function(e){this.player.emit("on-download-file-done",e,this.options),this.log({name:"fileChannelReceiveOnComplete",elapse:"end"}),this._sendDone(!0)}},{key:"onProgress",value:function(e){this._logProgress=e,this.player.emit("on-download-file-progress",e,this.options)}},{key:"stopReceiveFile",value:function(){this.log({name:"fileChannelStopReceiveFile"}),this._send(DOWNLOAD_ACTION.SEND_CANCEL),this.downloader.cancel(),this.player.emit("on-download-file-cancel",{reason:"user-call",options:this.options}),this._sendDone(!0,2)}},{key:"logError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"from_pod";this.log({name:"fileChannelReceiveOnError",elapse:"end",progress:!0,error:getFileChannelError(e),oErrc:e,oMsg:t})}},{key:"log",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,r=e.error,i=e.oErrc,o=e.oMsg,a=e.elapse,s=e.progress;_get(_getPrototypeOf(n.prototype),"log",this).call(this,{name:t,error:r,elapse:a,progress:s,fileSize:this.downloader.fileSize,oErrc:i,oMsg:o})}},{key:"sendDownload",value:function(e){var t=e.folder,r=e.name,n=e.returnUrl,i=void 0!==n&&n;if(!r)return console.warn("请传入需要下载的文件名"),this.logError("-7","from_client:empty_file_name"),!1;this.returnUrl=i,this.options.name=r,t?this.options.folder=t:delete this.options.folder,this._send(DOWNLOAD_ACTION.SEND_DOWNLOAD)}}]),n}(FileChannelMessenger),CacheRoom=function(){function e(){_classCallCheck(this,e),_defineProperty$1(this,"roomId",""),_defineProperty$1(this,"key","file-channel-room-id"),_defineProperty$1(this,"roomChanged",!1),this.roomId=localStorage.getItem("file-channel-room-id")||""}return _createClass(e,[{key:"setId",value:function(e){var t=e.substr(e.lastIndexOf("_")+1);return this.roomId&&t!==this.roomId&&(this.roomChanged=!0),this.roomId=t,localStorage.setItem("file-channel-room-id",t),this.roomChanged}}]),e}(),hmacSha256$2={exports:{}},core={exports:{}},__viteBrowserExternal=new Proxy({},{get(e,t){throw new Error(`Module "" has been externalized for browser compatibility. Cannot access ".${t}" in client code.  See http://vitejs.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)}}),__viteBrowserExternal$1=Object.freeze({__proto__:null,default:__viteBrowserExternal}),require$$0$1=getAugmentedNamespace(__viteBrowserExternal$1),hasRequiredCore;function requireCore(){return hasRequiredCore||(hasRequiredCore=1,function(e,t){var r;e.exports=(r=r||function(e,t){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),"undefined"!=typeof self&&self.crypto&&(r=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==commonjsGlobal&&commonjsGlobal.crypto&&(r=commonjsGlobal.crypto),!r&&"function"==typeof commonjsRequire)try{r=require$$0$1}catch(err2){}var n=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(err2){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(err2){}}throw new Error("Native crypto module could not be used to get secure random number.")},i=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),o={},a=o.lib={},s=a.Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=s.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r!=t?r:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var a=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=a<<24-(n+o)%4*8}else for(var s=0;s<i;s+=4)t[n+s>>>2]=r[s>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(n());return new c.init(t,e)}}),u=o.enc={},l=u.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new c.init(r,t/2)}},d=u.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new c.init(r,t)}},p=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e2){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},_=a.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,i=n.words,o=n.sigBytes,a=this.blockSize,s=o/(4*a),u=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,l=e.min(4*u,o);if(u){for(var d=0;d<u;d+=a)this._doProcessBlock(i,d);r=i.splice(0,u),n.sigBytes-=l}return new c.init(r,l)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});a.Hasher=_.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){_.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new h.HMAC.init(e,r).finalize(t)}}});var h=o.algo={};return o}(Math),r)}(core)),core.exports}var sha256={exports:{}},hasRequiredSha256;function requireSha256(){return hasRequiredSha256||(hasRequiredSha256=1,function(e,t){var r;e.exports=(r=requireCore(),function(e){var t=r,n=t.lib,i=n.WordArray,o=n.Hasher,a=t.algo,s=[],c=[];!function(){function t(t){for(var r=e.sqrt(t),n=2;n<=r;n++)if(!(t%n))return!1;return!0}function r(e){return 4294967296*(e-(0|e))|0}for(var n=2,i=0;i<64;)t(n)&&(i<8&&(s[i]=r(e.pow(n,.5))),c[i]=r(e.pow(n,1/3)),i++),n++}();var u=[],l=a.SHA256=o.extend({_doReset:function(){this._hash=new i.init(s.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],d=r[6],p=r[7],_=0;_<64;_++){if(_<16)u[_]=0|e[t+_];else{var h=u[_-15],f=(h<<25|h>>>7)^(h<<14|h>>>18)^h>>>3,m=u[_-2],g=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;u[_]=f+u[_-7]+g+u[_-16]}var v=n&i^n&o^i&o,y=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),S=p+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&l^~s&d)+c[_]+u[_];p=d,d=l,l=s,s=a+S|0,a=o,o=i,i=n,n=S+(y+v)|0}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+a|0,r[4]=r[4]+s|0,r[5]=r[5]+l|0,r[6]=r[6]+d|0,r[7]=r[7]+p|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;return r[i>>>5]|=128<<24-i%32,r[14+(i+64>>>9<<4)]=e.floor(n/4294967296),r[15+(i+64>>>9<<4)]=n,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(l),t.HmacSHA256=o._createHmacHelper(l)}(Math),r.SHA256)}(sha256)),sha256.exports}var hmac={exports:{}},hasRequiredHmac;function requireHmac(){return hasRequiredHmac||(hasRequiredHmac=1,function(e,t){var r,n,i,o;e.exports=(r=requireCore(),i=(n=r).lib.Base,o=n.enc.Utf8,void(n.algo.HMAC=i.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=o.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),a=this._iKey=t.clone(),s=i.words,c=a.words,u=0;u<r;u++)s[u]^=1549556828,c[u]^=909522486;i.sigBytes=a.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})))}(hmac)),hmac.exports}!function(e,t){var r;e.exports=(r=requireCore(),requireSha256(),requireHmac(),r.HmacSHA256)}(hmacSha256$2);var hmacSha256Exports=hmacSha256$2.exports,cryptoHmacSha256=getDefaultExportFromCjs$1(hmacSha256Exports),sha256Exports=requireSha256(),cryptoHashSha256=getDefaultExportFromCjs$1(sha256Exports),md5={exports:{}};!function(e,t){var r;e.exports=(r=requireCore(),function(e){var t=r,n=t.lib,i=n.WordArray,o=n.Hasher,a=t.algo,s=[];!function(){for(var t=0;t<64;t++)s[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=a.MD5=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,i=e[n];e[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,a=e[t+0],c=e[t+1],_=e[t+2],h=e[t+3],f=e[t+4],m=e[t+5],g=e[t+6],v=e[t+7],y=e[t+8],S=e[t+9],E=e[t+10],T=e[t+11],b=e[t+12],R=e[t+13],C=e[t+14],k=e[t+15],I=o[0],A=o[1],O=o[2],M=o[3];I=u(I,A,O,M,a,7,s[0]),M=u(M,I,A,O,c,12,s[1]),O=u(O,M,I,A,_,17,s[2]),A=u(A,O,M,I,h,22,s[3]),I=u(I,A,O,M,f,7,s[4]),M=u(M,I,A,O,m,12,s[5]),O=u(O,M,I,A,g,17,s[6]),A=u(A,O,M,I,v,22,s[7]),I=u(I,A,O,M,y,7,s[8]),M=u(M,I,A,O,S,12,s[9]),O=u(O,M,I,A,E,17,s[10]),A=u(A,O,M,I,T,22,s[11]),I=u(I,A,O,M,b,7,s[12]),M=u(M,I,A,O,R,12,s[13]),O=u(O,M,I,A,C,17,s[14]),I=l(I,A=u(A,O,M,I,k,22,s[15]),O,M,c,5,s[16]),M=l(M,I,A,O,g,9,s[17]),O=l(O,M,I,A,T,14,s[18]),A=l(A,O,M,I,a,20,s[19]),I=l(I,A,O,M,m,5,s[20]),M=l(M,I,A,O,E,9,s[21]),O=l(O,M,I,A,k,14,s[22]),A=l(A,O,M,I,f,20,s[23]),I=l(I,A,O,M,S,5,s[24]),M=l(M,I,A,O,C,9,s[25]),O=l(O,M,I,A,h,14,s[26]),A=l(A,O,M,I,y,20,s[27]),I=l(I,A,O,M,R,5,s[28]),M=l(M,I,A,O,_,9,s[29]),O=l(O,M,I,A,v,14,s[30]),I=d(I,A=l(A,O,M,I,b,20,s[31]),O,M,m,4,s[32]),M=d(M,I,A,O,y,11,s[33]),O=d(O,M,I,A,T,16,s[34]),A=d(A,O,M,I,C,23,s[35]),I=d(I,A,O,M,c,4,s[36]),M=d(M,I,A,O,f,11,s[37]),O=d(O,M,I,A,v,16,s[38]),A=d(A,O,M,I,E,23,s[39]),I=d(I,A,O,M,R,4,s[40]),M=d(M,I,A,O,a,11,s[41]),O=d(O,M,I,A,h,16,s[42]),A=d(A,O,M,I,g,23,s[43]),I=d(I,A,O,M,S,4,s[44]),M=d(M,I,A,O,b,11,s[45]),O=d(O,M,I,A,k,16,s[46]),I=p(I,A=d(A,O,M,I,_,23,s[47]),O,M,a,6,s[48]),M=p(M,I,A,O,v,10,s[49]),O=p(O,M,I,A,C,15,s[50]),A=p(A,O,M,I,m,21,s[51]),I=p(I,A,O,M,b,6,s[52]),M=p(M,I,A,O,h,10,s[53]),O=p(O,M,I,A,E,15,s[54]),A=p(A,O,M,I,c,21,s[55]),I=p(I,A,O,M,y,6,s[56]),M=p(M,I,A,O,k,10,s[57]),O=p(O,M,I,A,g,15,s[58]),A=p(A,O,M,I,R,21,s[59]),I=p(I,A,O,M,f,6,s[60]),M=p(M,I,A,O,T,10,s[61]),O=p(O,M,I,A,_,15,s[62]),A=p(A,O,M,I,S,21,s[63]),o[0]=o[0]+I|0,o[1]=o[1]+A|0,o[2]=o[2]+O|0,o[3]=o[3]+M|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;r[i>>>5]|=128<<24-i%32;var o=e.floor(n/4294967296),a=n;r[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),r[14+(i+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(r.length+1),this._process();for(var s=this._hash,c=s.words,u=0;u<4;u++){var l=c[u];c[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return s},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,r,n,i,o,a){var s=e+(t&r|~t&n)+i+a;return(s<<o|s>>>32-o)+t}function l(e,t,r,n,i,o,a){var s=e+(t&n|r&~n)+i+a;return(s<<o|s>>>32-o)+t}function d(e,t,r,n,i,o,a){var s=e+(t^r^n)+i+a;return(s<<o|s>>>32-o)+t}function p(e,t,r,n,i,o,a){var s=e+(r^(t|~n))+i+a;return(s<<o|s>>>32-o)+t}t.MD5=o._createHelper(c),t.HmacMD5=o._createHmacHelper(c)}(Math),r.MD5)}(md5);var md5Exports=md5.exports,cryptoHashMd5=getDefaultExportFromCjs$1(md5Exports),encBase64={exports:{}};!function(e,t){var r;e.exports=(r=requireCore(),function(){var e=r,t=e.lib.WordArray;function n(e,r,n){for(var i=[],o=0,a=0;a<r;a++)if(a%4){var s=n[e.charCodeAt(a-1)]<<a%4*2|n[e.charCodeAt(a)]>>>6-a%4*2;i[o>>>2]|=s<<24-o%4*8,o++}return t.create(i,o)}e.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var i=[],o=0;o<r;o+=3)for(var a=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,s=0;s<4&&o+.75*s<r;s++)i.push(n.charAt(a>>>6*(3-s)&63));var c=n.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,r=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var o=0;o<r.length;o++)i[r.charCodeAt(o)]=o}var a=r.charAt(64);if(a){var s=e.indexOf(a);-1!==s&&(t=s)}return n(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),r.enc.Base64)}(encBase64);var encBase64Exports=encBase64.exports,cryptoEncBase64=getDefaultExportFromCjs$1(encBase64Exports),encHex={exports:{}};!function(e,t){e.exports=requireCore().enc.Hex}(encHex);var encHexExports=encHex.exports,cryptoEncHex=getDefaultExportFromCjs$1(encHexExports),encUtf8={exports:{}};!function(e,t){e.exports=requireCore().enc.Utf8}(encUtf8);var encUtf8Exports=encUtf8.exports,cryptoEncUtf8=getDefaultExportFromCjs$1(encUtf8Exports),shams=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"===_typeof(Symbol.iterator))return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var n=Object.getOwnPropertySymbols(e);if(1!==n.length||n[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(e,t);if(42!==i.value||!0!==i.enumerable)return!1}return!0},origSymbol="undefined"!=typeof Symbol&&Symbol,hasSymbolSham=shams,hasSymbols$1=function(){return"function"==typeof origSymbol&&("function"==typeof Symbol&&("symbol"===_typeof(origSymbol("foo"))&&("symbol"===_typeof(Symbol("bar"))&&hasSymbolSham())))},ERROR_MESSAGE="Function.prototype.bind called on incompatible ",slice=Array.prototype.slice,toStr$1=Object.prototype.toString,funcType="[object Function]",implementation$1=function(e){var t=this;if("function"!=typeof t||toStr$1.call(t)!==funcType)throw new TypeError(ERROR_MESSAGE+t);for(var r,n=slice.call(arguments,1),i=function(){if(this instanceof r){var i=t.apply(this,n.concat(slice.call(arguments)));return Object(i)===i?i:this}return t.apply(e,n.concat(slice.call(arguments)))},o=Math.max(0,t.length-n.length),a=[],s=0;s<o;s++)a.push("$"+s);if(r=Function("binder","return function ("+a.join(",")+"){ return binder.apply(this,arguments); }")(i),t.prototype){var c=function(){};c.prototype=t.prototype,r.prototype=new c,c.prototype=null}return r},implementation=implementation$1,functionBind=Function.prototype.bind||implementation,bind$6=functionBind,src=bind$6.call(Function.call,Object.prototype.hasOwnProperty),undefined$1,$SyntaxError=SyntaxError,$Function=Function,$TypeError$1=TypeError,getEvalledConstructor=function(e){try{return $Function('"use strict"; return ('+e+").constructor;")()}catch(e2){}},$gOPD=Object.getOwnPropertyDescriptor;if($gOPD)try{$gOPD({},"")}catch(e2){$gOPD=null}var throwTypeError=function(){throw new $TypeError$1},ThrowTypeError=$gOPD?function(){try{return throwTypeError}catch(e){try{return $gOPD(arguments,"callee").get}catch(t){return throwTypeError}}}():throwTypeError,hasSymbols=hasSymbols$1(),getProto=Object.getPrototypeOf||function(e){return e.__proto__},needsEval={},TypedArray="undefined"==typeof Uint8Array?undefined$1:getProto(Uint8Array),INTRINSICS={"%AggregateError%":"undefined"==typeof AggregateError?undefined$1:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?undefined$1:ArrayBuffer,"%ArrayIteratorPrototype%":hasSymbols?getProto([][Symbol.iterator]()):undefined$1,"%AsyncFromSyncIteratorPrototype%":undefined$1,"%AsyncFunction%":needsEval,"%AsyncGenerator%":needsEval,"%AsyncGeneratorFunction%":needsEval,"%AsyncIteratorPrototype%":needsEval,"%Atomics%":"undefined"==typeof Atomics?undefined$1:Atomics,"%BigInt%":"undefined"==typeof BigInt?undefined$1:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?undefined$1:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?undefined$1:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?undefined$1:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?undefined$1:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?undefined$1:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?undefined$1:FinalizationRegistry,"%Function%":$Function,"%GeneratorFunction%":needsEval,"%Int8Array%":"undefined"==typeof Int8Array?undefined$1:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?undefined$1:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?undefined$1:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":hasSymbols?getProto(getProto([][Symbol.iterator]())):undefined$1,"%JSON%":"object"===("undefined"==typeof JSON?"undefined":_typeof(JSON))?JSON:undefined$1,"%Map%":"undefined"==typeof Map?undefined$1:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&hasSymbols?getProto((new Map)[Symbol.iterator]()):undefined$1,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?undefined$1:Promise,"%Proxy%":"undefined"==typeof Proxy?undefined$1:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?undefined$1:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?undefined$1:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&hasSymbols?getProto((new Set)[Symbol.iterator]()):undefined$1,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?undefined$1:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":hasSymbols?getProto(""[Symbol.iterator]()):undefined$1,"%Symbol%":hasSymbols?Symbol:undefined$1,"%SyntaxError%":$SyntaxError,"%ThrowTypeError%":ThrowTypeError,"%TypedArray%":TypedArray,"%TypeError%":$TypeError$1,"%Uint8Array%":"undefined"==typeof Uint8Array?undefined$1:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?undefined$1:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?undefined$1:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?undefined$1:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?undefined$1:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?undefined$1:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?undefined$1:WeakSet};try{null.error}catch(e2){var errorProto=getProto(getProto(e2));INTRINSICS["%Error.prototype%"]=errorProto}var doEval=function e(t){var r;if("%AsyncFunction%"===t)r=getEvalledConstructor("async function () {}");else if("%GeneratorFunction%"===t)r=getEvalledConstructor("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=getEvalledConstructor("async function* () {}");else if("%AsyncGenerator%"===t){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&(r=getProto(i.prototype))}return INTRINSICS[t]=r,r},LEGACY_ALIASES={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},bind$5=functionBind,hasOwn$1=src,$concat$1=bind$5.call(Function.call,Array.prototype.concat),$spliceApply=bind$5.call(Function.apply,Array.prototype.splice),$replace$1=bind$5.call(Function.call,String.prototype.replace),$strSlice=bind$5.call(Function.call,String.prototype.slice),$exec=bind$5.call(Function.call,RegExp.prototype.exec),rePropName=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=function(e){var t=$strSlice(e,0,1),r=$strSlice(e,-1);if("%"===t&&"%"!==r)throw new $SyntaxError("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new $SyntaxError("invalid intrinsic syntax, expected opening `%`");var n=[];return $replace$1(e,rePropName,(function(e,t,r,i){n[n.length]=r?$replace$1(i,reEscapeChar,"$1"):t||e})),n},getBaseIntrinsic=function(e,t){var r,n=e;if(hasOwn$1(LEGACY_ALIASES,n)&&(n="%"+(r=LEGACY_ALIASES[n])[0]+"%"),hasOwn$1(INTRINSICS,n)){var i=INTRINSICS[n];if(i===needsEval&&(i=doEval(n)),void 0===i&&!t)throw new $TypeError$1("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:i}}throw new $SyntaxError("intrinsic "+e+" does not exist!")},getIntrinsic=function(e,t){if("string"!=typeof e||0===e.length)throw new $TypeError$1("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new $TypeError$1('"allowMissing" argument must be a boolean');if(null===$exec(/^%?[^%]*%?$/,e))throw new $SyntaxError("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=stringToPath(e),n=r.length>0?r[0]:"",i=getBaseIntrinsic("%"+n+"%",t),o=i.name,a=i.value,s=!1,c=i.alias;c&&(n=c[0],$spliceApply(r,$concat$1([0,1],c)));for(var u=1,l=!0;u<r.length;u+=1){var d=r[u],p=$strSlice(d,0,1),_=$strSlice(d,-1);if(('"'===p||"'"===p||"`"===p||'"'===_||"'"===_||"`"===_)&&p!==_)throw new $SyntaxError("property names with quotes must have matching quotes");if("constructor"!==d&&l||(s=!0),hasOwn$1(INTRINSICS,o="%"+(n+="."+d)+"%"))a=INTRINSICS[o];else if(null!=a){if(!(d in a)){if(!t)throw new $TypeError$1("base intrinsic for "+e+" exists, but the property is not available.");return}if($gOPD&&u+1>=r.length){var h=$gOPD(a,d);a=(l=!!h)&&"get"in h&&!("originalValue"in h.get)?h.get:a[d]}else l=hasOwn$1(a,d),a=a[d];l&&!s&&(INTRINSICS[o]=a)}}return a},callBind$1={exports:{}};!function(e){var t=functionBind,r=getIntrinsic,n=r("%Function.prototype.apply%"),i=r("%Function.prototype.call%"),o=r("%Reflect.apply%",!0)||t.call(i,n),a=r("%Object.getOwnPropertyDescriptor%",!0),s=r("%Object.defineProperty%",!0),c=r("%Math.max%");if(s)try{s({},"a",{value:1})}catch(e2){s=null}e.exports=function(e){var r=o(t,i,arguments);if(a&&s){var n=a(r,"length");n.configurable&&s(r,"length",{value:1+c(0,e.length-(arguments.length-1))})}return r};var u=function(){return o(t,n,arguments)};s?s(e.exports,"apply",{value:u}):e.exports.apply=u}(callBind$1);var callBindExports=callBind$1.exports,GetIntrinsic$1=getIntrinsic,callBind=callBindExports,$indexOf=callBind(GetIntrinsic$1("String.prototype.indexOf")),callBound$1=function(e,t){var r=GetIntrinsic$1(e,!!t);return"function"==typeof r&&$indexOf(e,".prototype.")>-1?callBind(r):r},hasMap="function"==typeof Map&&Map.prototype,mapSizeDescriptor=Object.getOwnPropertyDescriptor&&hasMap?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,mapSize=hasMap&&mapSizeDescriptor&&"function"==typeof mapSizeDescriptor.get?mapSizeDescriptor.get:null,mapForEach=hasMap&&Map.prototype.forEach,hasSet="function"==typeof Set&&Set.prototype,setSizeDescriptor=Object.getOwnPropertyDescriptor&&hasSet?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,setSize=hasSet&&setSizeDescriptor&&"function"==typeof setSizeDescriptor.get?setSizeDescriptor.get:null,setForEach=hasSet&&Set.prototype.forEach,hasWeakMap="function"==typeof WeakMap&&WeakMap.prototype,weakMapHas=hasWeakMap?WeakMap.prototype.has:null,hasWeakSet="function"==typeof WeakSet&&WeakSet.prototype,weakSetHas=hasWeakSet?WeakSet.prototype.has:null,hasWeakRef="function"==typeof WeakRef&&WeakRef.prototype,weakRefDeref=hasWeakRef?WeakRef.prototype.deref:null,booleanValueOf=Boolean.prototype.valueOf,objectToString$2=Object.prototype.toString,functionToString=Function.prototype.toString,$match=String.prototype.match,$slice=String.prototype.slice,$replace=String.prototype.replace,$toUpperCase=String.prototype.toUpperCase,$toLowerCase=String.prototype.toLowerCase,$test=RegExp.prototype.test,$concat=Array.prototype.concat,$join=Array.prototype.join,$arrSlice=Array.prototype.slice,$floor=Math.floor,bigIntValueOf="function"==typeof BigInt?BigInt.prototype.valueOf:null,gOPS=Object.getOwnPropertySymbols,symToString="function"==typeof Symbol&&"symbol"===_typeof(Symbol.iterator)?Symbol.prototype.toString:null,hasShammedSymbols="function"==typeof Symbol&&"object"===_typeof(Symbol.iterator),toStringTag="function"==typeof Symbol&&Symbol.toStringTag&&(_typeof(Symbol.toStringTag)===hasShammedSymbols||"symbol")?Symbol.toStringTag:null,isEnumerable=Object.prototype.propertyIsEnumerable,gPO=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function addNumericSeparator(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||$test.call(/e/,t))return t;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var n=e<0?-$floor(-e):$floor(e);if(n!==e){var i=String(n),o=$slice.call(t,i.length+1);return $replace.call(i,r,"$&_")+"."+$replace.call($replace.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return $replace.call(t,r,"$&_")}var utilInspect=require$$0$1,inspectCustom=utilInspect.custom,inspectSymbol=isSymbol(inspectCustom)?inspectCustom:null,objectInspect=function e(t,r,n,i){var o=r||{};if(has$3(o,"quoteStyle")&&"single"!==o.quoteStyle&&"double"!==o.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(has$3(o,"maxStringLength")&&("number"==typeof o.maxStringLength?o.maxStringLength<0&&o.maxStringLength!==1/0:null!==o.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var a=!has$3(o,"customInspect")||o.customInspect;if("boolean"!=typeof a&&"symbol"!==a)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(has$3(o,"indent")&&null!==o.indent&&"\t"!==o.indent&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(has$3(o,"numericSeparator")&&"boolean"!=typeof o.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var s=o.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return inspectString(t,o);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var c=String(t);return s?addNumericSeparator(t,c):c}if("bigint"==typeof t){var u=String(t)+"n";return s?addNumericSeparator(t,u):u}var l=void 0===o.depth?5:o.depth;if(void 0===n&&(n=0),n>=l&&l>0&&"object"===_typeof(t))return isArray$9(t)?"[Array]":"[Object]";var d=getIndent(o,n);if(void 0===i)i=[];else if(indexOf(i,t)>=0)return"[Circular]";function p(t,r,a){if(r&&(i=$arrSlice.call(i)).push(r),a){var s={depth:o.depth};return has$3(o,"quoteStyle")&&(s.quoteStyle=o.quoteStyle),e(t,s,n+1,i)}return e(t,o,n+1,i)}if("function"==typeof t&&!isRegExp$1(t)){var _=nameOf(t),h=arrObjKeys(t,p);return"[Function"+(_?": "+_:" (anonymous)")+"]"+(h.length>0?" { "+$join.call(h,", ")+" }":"")}if(isSymbol(t)){var f=hasShammedSymbols?$replace.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):symToString.call(t);return"object"!==_typeof(t)||hasShammedSymbols?f:markBoxed(f)}if(isElement(t)){for(var m="<"+$toLowerCase.call(String(t.nodeName)),g=t.attributes||[],v=0;v<g.length;v++)m+=" "+g[v].name+"="+wrapQuotes(quote(g[v].value),"double",o);return m+=">",t.childNodes&&t.childNodes.length&&(m+="..."),m+="</"+$toLowerCase.call(String(t.nodeName))+">"}if(isArray$9(t)){if(0===t.length)return"[]";var y=arrObjKeys(t,p);return d&&!singleLineValues(y)?"["+indentedJoin(y,d)+"]":"[ "+$join.call(y,", ")+" ]"}if(isError(t)){var S=arrObjKeys(t,p);return"cause"in Error.prototype||!("cause"in t)||isEnumerable.call(t,"cause")?0===S.length?"["+String(t)+"]":"{ ["+String(t)+"] "+$join.call(S,", ")+" }":"{ ["+String(t)+"] "+$join.call($concat.call("[cause]: "+p(t.cause),S),", ")+" }"}if("object"===_typeof(t)&&a){if(inspectSymbol&&"function"==typeof t[inspectSymbol]&&utilInspect)return utilInspect(t,{depth:l-n});if("symbol"!==a&&"function"==typeof t.inspect)return t.inspect()}if(isMap$2(t)){var E=[];return mapForEach.call(t,(function(e,r){E.push(p(r,t,!0)+" => "+p(e,t))})),collectionOf("Map",mapSize.call(t),E,d)}if(isSet$2(t)){var T=[];return setForEach.call(t,(function(e){T.push(p(e,t))})),collectionOf("Set",setSize.call(t),T,d)}if(isWeakMap(t))return weakCollectionOf("WeakMap");if(isWeakSet(t))return weakCollectionOf("WeakSet");if(isWeakRef(t))return weakCollectionOf("WeakRef");if(isNumber$2(t))return markBoxed(p(Number(t)));if(isBigInt(t))return markBoxed(p(bigIntValueOf.call(t)));if(isBoolean(t))return markBoxed(booleanValueOf.call(t));if(isString$2(t))return markBoxed(p(String(t)));if(!isDate$2(t)&&!isRegExp$1(t)){var b=arrObjKeys(t,p),R=gPO?gPO(t)===Object.prototype:t instanceof Object||t.constructor===Object,C=t instanceof Object?"":"null prototype",k=!R&&toStringTag&&Object(t)===t&&toStringTag in t?$slice.call(toStr(t),8,-1):C?"Object":"",I=(R||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(k||C?"["+$join.call($concat.call([],k||[],C||[]),": ")+"] ":"");return 0===b.length?I+"{}":d?I+"{"+indentedJoin(b,d)+"}":I+"{ "+$join.call(b,", ")+" }"}return String(t)};function wrapQuotes(e,t,r){var n="double"===(r.quoteStyle||t)?'"':"'";return n+e+n}function quote(e){return $replace.call(String(e),/"/g,"&quot;")}function isArray$9(e){return!("[object Array]"!==toStr(e)||toStringTag&&"object"===_typeof(e)&&toStringTag in e)}function isDate$2(e){return!("[object Date]"!==toStr(e)||toStringTag&&"object"===_typeof(e)&&toStringTag in e)}function isRegExp$1(e){return!("[object RegExp]"!==toStr(e)||toStringTag&&"object"===_typeof(e)&&toStringTag in e)}function isError(e){return!("[object Error]"!==toStr(e)||toStringTag&&"object"===_typeof(e)&&toStringTag in e)}function isString$2(e){return!("[object String]"!==toStr(e)||toStringTag&&"object"===_typeof(e)&&toStringTag in e)}function isNumber$2(e){return!("[object Number]"!==toStr(e)||toStringTag&&"object"===_typeof(e)&&toStringTag in e)}function isBoolean(e){return!("[object Boolean]"!==toStr(e)||toStringTag&&"object"===_typeof(e)&&toStringTag in e)}function isSymbol(e){if(hasShammedSymbols)return e&&"object"===_typeof(e)&&e instanceof Symbol;if("symbol"===_typeof(e))return!0;if(!e||"object"!==_typeof(e)||!symToString)return!1;try{return symToString.call(e),!0}catch(e2){}return!1}function isBigInt(e){if(!e||"object"!==_typeof(e)||!bigIntValueOf)return!1;try{return bigIntValueOf.call(e),!0}catch(e2){}return!1}var hasOwn=Object.prototype.hasOwnProperty||function(e){return e in this};function has$3(e,t){return hasOwn.call(e,t)}function toStr(e){return objectToString$2.call(e)}function nameOf(e){if(e.name)return e.name;var t=$match.call(functionToString.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}function indexOf(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}function isMap$2(e){if(!mapSize||!e||"object"!==_typeof(e))return!1;try{mapSize.call(e);try{setSize.call(e)}catch(t){return!0}return e instanceof Map}catch(e2){}return!1}function isWeakMap(e){if(!weakMapHas||!e||"object"!==_typeof(e))return!1;try{weakMapHas.call(e,weakMapHas);try{weakSetHas.call(e,weakSetHas)}catch(t){return!0}return e instanceof WeakMap}catch(e2){}return!1}function isWeakRef(e){if(!weakRefDeref||!e||"object"!==_typeof(e))return!1;try{return weakRefDeref.call(e),!0}catch(e2){}return!1}function isSet$2(e){if(!setSize||!e||"object"!==_typeof(e))return!1;try{setSize.call(e);try{mapSize.call(e)}catch(t){return!0}return e instanceof Set}catch(e2){}return!1}function isWeakSet(e){if(!weakSetHas||!e||"object"!==_typeof(e))return!1;try{weakSetHas.call(e,weakSetHas);try{weakMapHas.call(e,weakMapHas)}catch(t){return!0}return e instanceof WeakSet}catch(e2){}return!1}function isElement(e){return!(!e||"object"!==_typeof(e))&&("undefined"!=typeof HTMLElement&&e instanceof HTMLElement||"string"==typeof e.nodeName&&"function"==typeof e.getAttribute)}function inspectString(e,t){if(e.length>t.maxStringLength){var r=e.length-t.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return inspectString($slice.call(e,0,t.maxStringLength),t)+n}return wrapQuotes($replace.call($replace.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,lowbyte),"single",t)}function lowbyte(e){var t=e.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return r?"\\"+r:"\\x"+(t<16?"0":"")+$toUpperCase.call(t.toString(16))}function markBoxed(e){return"Object("+e+")"}function weakCollectionOf(e){return e+" { ? }"}function collectionOf(e,t,r,n){return e+" ("+t+") {"+(n?indentedJoin(r,n):$join.call(r,", "))+"}"}function singleLineValues(e){for(var t=0;t<e.length;t++)if(indexOf(e[t],"\n")>=0)return!1;return!0}function getIndent(e,t){var r;if("\t"===e.indent)r="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;r=$join.call(Array(e.indent+1)," ")}return{base:r,prev:$join.call(Array(t+1),r)}}function indentedJoin(e,t){if(0===e.length)return"";var r="\n"+t.prev+t.base;return r+$join.call(e,","+r)+"\n"+t.prev}function arrObjKeys(e,t){var r=isArray$9(e),n=[];if(r){n.length=e.length;for(var i=0;i<e.length;i++)n[i]=has$3(e,i)?t(e[i],e):""}var o,a="function"==typeof gOPS?gOPS(e):[];if(hasShammedSymbols){o={};for(var s=0;s<a.length;s++)o["$"+a[s]]=a[s]}for(var c in e)has$3(e,c)&&(r&&String(Number(c))===c&&c<e.length||hasShammedSymbols&&o["$"+c]instanceof Symbol||($test.call(/[^\w$]/,c)?n.push(t(c,e)+": "+t(e[c],e)):n.push(c+": "+t(e[c],e))));if("function"==typeof gOPS)for(var u=0;u<a.length;u++)isEnumerable.call(e,a[u])&&n.push("["+t(a[u])+"]: "+t(e[a[u]],e));return n}var GetIntrinsic=getIntrinsic,callBound=callBound$1,inspect=objectInspect,$TypeError=GetIntrinsic("%TypeError%"),$WeakMap=GetIntrinsic("%WeakMap%",!0),$Map=GetIntrinsic("%Map%",!0),$weakMapGet=callBound("WeakMap.prototype.get",!0),$weakMapSet=callBound("WeakMap.prototype.set",!0),$weakMapHas=callBound("WeakMap.prototype.has",!0),$mapGet=callBound("Map.prototype.get",!0),$mapSet=callBound("Map.prototype.set",!0),$mapHas=callBound("Map.prototype.has",!0),listGetNode=function(e,t){for(var r,n=e;null!==(r=n.next);n=r)if(r.key===t)return n.next=r.next,r.next=e.next,e.next=r,r},listGet=function(e,t){var r=listGetNode(e,t);return r&&r.value},listSet=function(e,t,r){var n=listGetNode(e,t);n?n.value=r:e.next={key:t,next:e.next,value:r}},listHas=function(e,t){return!!listGetNode(e,t)},sideChannel=function(){var e,t,r,n={assert:function(e){if(!n.has(e))throw new $TypeError("Side channel does not contain "+inspect(e))},get:function(n){if($WeakMap&&n&&("object"===_typeof(n)||"function"==typeof n)){if(e)return $weakMapGet(e,n)}else if($Map){if(t)return $mapGet(t,n)}else if(r)return listGet(r,n)},has:function(n){if($WeakMap&&n&&("object"===_typeof(n)||"function"==typeof n)){if(e)return $weakMapHas(e,n)}else if($Map){if(t)return $mapHas(t,n)}else if(r)return listHas(r,n);return!1},set:function(n,i){$WeakMap&&n&&("object"===_typeof(n)||"function"==typeof n)?(e||(e=new $WeakMap),$weakMapSet(e,n,i)):$Map?(t||(t=new $Map),$mapSet(t,n,i)):(r||(r={key:{},next:null}),listSet(r,n,i))}};return n},replace=String.prototype.replace,percentTwenties=/%20/g,Format={RFC1738:"RFC1738",RFC3986:"RFC3986"},formats$3={default:Format.RFC3986,formatters:{RFC1738:function(e){return replace.call(e,percentTwenties,"+")},RFC3986:function(e){return String(e)}},RFC1738:Format.RFC1738,RFC3986:Format.RFC3986},formats$2=formats$3,has$2=Object.prototype.hasOwnProperty,isArray$8=Array.isArray,hexTable=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),compactQueue=function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(isArray$8(r)){for(var n=[],i=0;i<r.length;++i)void 0!==r[i]&&n.push(r[i]);t.obj[t.prop]=n}}},arrayToObject=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r},merge$2=function e(t,r,n){if(!r)return t;if("object"!==_typeof(r)){if(isArray$8(t))t.push(r);else{if(!t||"object"!==_typeof(t))return[t,r];(n&&(n.plainObjects||n.allowPrototypes)||!has$2.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!==_typeof(t))return[t].concat(r);var i=t;return isArray$8(t)&&!isArray$8(r)&&(i=arrayToObject(t,n)),isArray$8(t)&&isArray$8(r)?(r.forEach((function(r,i){if(has$2.call(t,i)){var o=t[i];o&&"object"===_typeof(o)&&r&&"object"===_typeof(r)?t[i]=e(o,r,n):t.push(r)}else t[i]=r})),t):Object.keys(r).reduce((function(t,i){var o=r[i];return has$2.call(t,i)?t[i]=e(t[i],o,n):t[i]=o,t}),i)},assign=function(e,t){return Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)},decode$1=function(e,t,r){var n=e.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e2){return n}},encode$2=function(e,t,r,n,i){if(0===e.length)return e;var o=e;if("symbol"===_typeof(e)?o=Symbol.prototype.toString.call(e):"string"!=typeof e&&(o=String(e)),"iso-8859-1"===r)return escape(o).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var a="",s=0;s<o.length;++s){var c=o.charCodeAt(s);45===c||46===c||95===c||126===c||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||i===formats$2.RFC1738&&(40===c||41===c)?a+=o.charAt(s):c<128?a+=hexTable[c]:c<2048?a+=hexTable[192|c>>6]+hexTable[128|63&c]:c<55296||c>=57344?a+=hexTable[224|c>>12]+hexTable[128|c>>6&63]+hexTable[128|63&c]:(s+=1,c=65536+((1023&c)<<10|1023&o.charCodeAt(s)),a+=hexTable[240|c>>18]+hexTable[128|c>>12&63]+hexTable[128|c>>6&63]+hexTable[128|63&c])}return a},compact=function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],n=0;n<t.length;++n)for(var i=t[n],o=i.obj[i.prop],a=Object.keys(o),s=0;s<a.length;++s){var c=a[s],u=o[c];"object"===_typeof(u)&&null!==u&&-1===r.indexOf(u)&&(t.push({obj:o,prop:c}),r.push(u))}return compactQueue(t),e},isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},isBuffer$6=function(e){return!(!e||"object"!==_typeof(e))&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},combine=function(e,t){return[].concat(e,t)},maybeMap=function(e,t){if(isArray$8(e)){for(var r=[],n=0;n<e.length;n+=1)r.push(t(e[n]));return r}return t(e)},utils$g={arrayToObject:arrayToObject,assign:assign,combine:combine,compact:compact,decode:decode$1,encode:encode$2,isBuffer:isBuffer$6,isRegExp:isRegExp,maybeMap:maybeMap,merge:merge$2},getSideChannel=sideChannel,utils$f=utils$g,formats$1=formats$3,has$1=Object.prototype.hasOwnProperty,arrayPrefixGenerators={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},isArray$7=Array.isArray,push=Array.prototype.push,pushToArray=function(e,t){push.apply(e,isArray$7(t)?t:[t])},toISO=Date.prototype.toISOString,defaultFormat=formats$1.default,defaults$5={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:utils$f.encode,encodeValuesOnly:!1,format:defaultFormat,formatter:formats$1.formatters[defaultFormat],indices:!1,serializeDate:function(e){return toISO.call(e)},skipNulls:!1,strictNullHandling:!1},isNonNullishPrimitive=function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||"symbol"===_typeof(e)||"bigint"==typeof e},sentinel={},stringify$3=function e(t,r,n,i,o,a,s,c,u,l,d,p,_,h,f,m){for(var g=t,v=m,y=0,S=!1;void 0!==(v=v.get(sentinel))&&!S;){var E=v.get(t);if(y+=1,void 0!==E){if(E===y)throw new RangeError("Cyclic object value");S=!0}void 0===v.get(sentinel)&&(y=0)}if("function"==typeof c?g=c(r,g):g instanceof Date?g=d(g):"comma"===n&&isArray$7(g)&&(g=utils$f.maybeMap(g,(function(e){return e instanceof Date?d(e):e}))),null===g){if(o)return s&&!h?s(r,defaults$5.encoder,f,"key",p):r;g=""}if(isNonNullishPrimitive(g)||utils$f.isBuffer(g))return s?[_(h?r:s(r,defaults$5.encoder,f,"key",p))+"="+_(s(g,defaults$5.encoder,f,"value",p))]:[_(r)+"="+_(String(g))];var T,b=[];if(void 0===g)return b;if("comma"===n&&isArray$7(g))h&&s&&(g=utils$f.maybeMap(g,s)),T=[{value:g.length>0?g.join(",")||null:void 0}];else if(isArray$7(c))T=c;else{var R=Object.keys(g);T=u?R.sort(u):R}for(var C=i&&isArray$7(g)&&1===g.length?r+"[]":r,k=0;k<T.length;++k){var I=T[k],A="object"===_typeof(I)&&void 0!==I.value?I.value:g[I];if(!a||null!==A){var O=isArray$7(g)?"function"==typeof n?n(C,I):C:C+(l?"."+I:"["+I+"]");m.set(t,y);var M=getSideChannel();M.set(sentinel,m),pushToArray(b,e(A,O,n,i,o,a,"comma"===n&&h&&isArray$7(g)?null:s,c,u,l,d,p,_,h,f,M))}}return b},normalizeStringifyOptions=function(e){if(!e)return defaults$5;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||defaults$5.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=formats$1.default;if(void 0!==e.format){if(!has$1.call(formats$1.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var n=formats$1.formatters[r],i=defaults$5.filter;return("function"==typeof e.filter||isArray$7(e.filter))&&(i=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:defaults$5.addQueryPrefix,allowDots:void 0===e.allowDots?defaults$5.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:defaults$5.charsetSentinel,delimiter:void 0===e.delimiter?defaults$5.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:defaults$5.encode,encoder:"function"==typeof e.encoder?e.encoder:defaults$5.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:defaults$5.encodeValuesOnly,filter:i,format:r,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:defaults$5.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:defaults$5.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:defaults$5.strictNullHandling}},stringify_1=function(e,t){var r,n=e,i=normalizeStringifyOptions(t);"function"==typeof i.filter?n=(0,i.filter)("",n):isArray$7(i.filter)&&(r=i.filter);var o,a=[];if("object"!==_typeof(n)||null===n)return"";o=t&&t.arrayFormat in arrayPrefixGenerators?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var s=arrayPrefixGenerators[o];if(t&&"commaRoundTrip"in t&&"boolean"!=typeof t.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var c="comma"===s&&t&&t.commaRoundTrip;r||(r=Object.keys(n)),i.sort&&r.sort(i.sort);for(var u=getSideChannel(),l=0;l<r.length;++l){var d=r[l];i.skipNulls&&null===n[d]||pushToArray(a,stringify$3(n[d],d,s,c,i.strictNullHandling,i.skipNulls,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,u))}var p=a.join(i.delimiter),_=!0===i.addQueryPrefix?"?":"";return i.charsetSentinel&&("iso-8859-1"===i.charset?_+="utf8=%26%2310003%3B&":_+="utf8=%E2%9C%93&"),p.length>0?_+p:""},utils$e=utils$g,has=Object.prototype.hasOwnProperty,isArray$6=Array.isArray,defaults$4={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:utils$e.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},interpretNumericEntities=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},parseArrayValue=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},isoSentinel="utf8=%26%2310003%3B",charsetSentinel="utf8=%E2%9C%93",parseValues=function(e,t){var r,n={__proto__:null},i=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,o=t.parameterLimit===1/0?void 0:t.parameterLimit,a=i.split(t.delimiter,o),s=-1,c=t.charset;if(t.charsetSentinel)for(r=0;r<a.length;++r)0===a[r].indexOf("utf8=")&&(a[r]===charsetSentinel?c="utf-8":a[r]===isoSentinel&&(c="iso-8859-1"),s=r,r=a.length);for(r=0;r<a.length;++r)if(r!==s){var u,l,d=a[r],p=d.indexOf("]="),_=-1===p?d.indexOf("="):p+1;-1===_?(u=t.decoder(d,defaults$4.decoder,c,"key"),l=t.strictNullHandling?null:""):(u=t.decoder(d.slice(0,_),defaults$4.decoder,c,"key"),l=utils$e.maybeMap(parseArrayValue(d.slice(_+1),t),(function(e){return t.decoder(e,defaults$4.decoder,c,"value")}))),l&&t.interpretNumericEntities&&"iso-8859-1"===c&&(l=interpretNumericEntities(l)),d.indexOf("[]=")>-1&&(l=isArray$6(l)?[l]:l),has.call(n,u)?n[u]=utils$e.combine(n[u],l):n[u]=l}return n},parseObject=function(e,t,r,n){for(var i=n?t:parseArrayValue(t,r),o=e.length-1;o>=0;--o){var a,s=e[o];if("[]"===s&&r.parseArrays)a=[].concat(i);else{a=r.plainObjects?Object.create(null):{};var c="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,u=parseInt(c,10);r.parseArrays||""!==c?!isNaN(u)&&s!==c&&String(u)===c&&u>=0&&r.parseArrays&&u<=r.arrayLimit?(a=[])[u]=i:"__proto__"!==c&&(a[c]=i):a={0:i}}i=a}return i},parseKeys=function(e,t,r,n){if(e){var i=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,a=r.depth>0&&/(\[[^[\]]*])/.exec(i),s=a?i.slice(0,a.index):i,c=[];if(s){if(!r.plainObjects&&has.call(Object.prototype,s)&&!r.allowPrototypes)return;c.push(s)}for(var u=0;r.depth>0&&null!==(a=o.exec(i))&&u<r.depth;){if(u+=1,!r.plainObjects&&has.call(Object.prototype,a[1].slice(1,-1))&&!r.allowPrototypes)return;c.push(a[1])}return a&&c.push("["+i.slice(a.index)+"]"),parseObject(c,t,r,n)}},normalizeParseOptions=function(e){if(!e)return defaults$4;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?defaults$4.charset:e.charset;return{allowDots:void 0===e.allowDots?defaults$4.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:defaults$4.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:defaults$4.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:defaults$4.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:defaults$4.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:defaults$4.comma,decoder:"function"==typeof e.decoder?e.decoder:defaults$4.decoder,delimiter:"string"==typeof e.delimiter||utils$e.isRegExp(e.delimiter)?e.delimiter:defaults$4.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:defaults$4.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:defaults$4.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:defaults$4.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:defaults$4.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:defaults$4.strictNullHandling}},parse$3=function(e,t){var r=normalizeParseOptions(t);if(""===e||null==e)return r.plainObjects?Object.create(null):{};for(var n="string"==typeof e?parseValues(e,r):e,i=r.plainObjects?Object.create(null):{},o=Object.keys(n),a=0;a<o.length;++a){var s=o[a],c=parseKeys(s,n[s],r,"string"==typeof e);i=utils$e.merge(i,c,r)}return!0===r.allowSparse?i:utils$e.compact(i)},stringify$2=stringify_1,parse$2=parse$3,formats=formats$3,lib={formats:formats,parse:parse$2,stringify:stringify$2},qs=getDefaultExportFromCjs$1(lib),axios$3={exports:{}},bind$4=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}},bind$3=bind$4,toString$1=Object.prototype.toString;function isArray$5(e){return"[object Array]"===toString$1.call(e)}function isUndefined$1(e){return void 0===e}function isBuffer$5(e){return null!==e&&!isUndefined$1(e)&&null!==e.constructor&&!isUndefined$1(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function isArrayBuffer$1(e){return"[object ArrayBuffer]"===toString$1.call(e)}function isFormData$1(e){return"undefined"!=typeof FormData&&e instanceof FormData}function isArrayBufferView$1(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer}function isString$1(e){return"string"==typeof e}function isNumber$1(e){return"number"==typeof e}function isObject$7(e){return null!==e&&"object"===_typeof(e)}function isPlainObject$1(e){if("[object Object]"!==toString$1.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function isDate$1(e){return"[object Date]"===toString$1.call(e)}function isFile$1(e){return"[object File]"===toString$1.call(e)}function isBlob$2(e){return"[object Blob]"===toString$1.call(e)}function isFunction$4(e){return"[object Function]"===toString$1.call(e)}function isStream$1(e){return isObject$7(e)&&isFunction$4(e.pipe)}function isURLSearchParams$1(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams}function trim$1(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function isStandardBrowserEnv$1(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)}function forEach$1(e,t){if(null!=e)if("object"!==_typeof(e)&&(e=[e]),isArray$5(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}function merge$1(){var e={};function t(t,r){isPlainObject$1(e[r])&&isPlainObject$1(t)?e[r]=merge$1(e[r],t):isPlainObject$1(t)?e[r]=merge$1({},t):isArray$5(t)?e[r]=t.slice():e[r]=t}for(var r=0,n=arguments.length;r<n;r++)forEach$1(arguments[r],t);return e}function extend$1(e,t,r){return forEach$1(t,(function(t,n){e[n]=r&&"function"==typeof t?bind$3(t,r):t})),e}function stripBOM$1(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}var utils$c={isArray:isArray$5,isArrayBuffer:isArrayBuffer$1,isBuffer:isBuffer$5,isFormData:isFormData$1,isArrayBufferView:isArrayBufferView$1,isString:isString$1,isNumber:isNumber$1,isObject:isObject$7,isPlainObject:isPlainObject$1,isUndefined:isUndefined$1,isDate:isDate$1,isFile:isFile$1,isBlob:isBlob$2,isFunction:isFunction$4,isStream:isStream$1,isURLSearchParams:isURLSearchParams$1,isStandardBrowserEnv:isStandardBrowserEnv$1,forEach:forEach$1,merge:merge$1,extend:extend$1,trim:trim$1,stripBOM:stripBOM$1},utils$d=getDefaultExportFromCjs$1(utils$c),utils$b=utils$c;function encode$1(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var buildURL$3=function(e,t,r){if(!t)return e;var n;if(r)n=r(t);else if(utils$b.isURLSearchParams(t))n=t.toString();else{var i=[];utils$b.forEach(t,(function(e,t){null!=e&&(utils$b.isArray(e)?t+="[]":e=[e],utils$b.forEach(e,(function(e){utils$b.isDate(e)?e=e.toISOString():utils$b.isObject(e)&&(e=JSON.stringify(e)),i.push(encode$1(t)+"="+encode$1(e))})))})),n=i.join("&")}if(n){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e},buildURL$4=getDefaultExportFromCjs$1(buildURL$3),utils$a=utils$c;function InterceptorManager$1(){this.handlers=[]}InterceptorManager$1.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},InterceptorManager$1.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},InterceptorManager$1.prototype.forEach=function(e){utils$a.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var InterceptorManager_1=InterceptorManager$1,utils$9=utils$c,normalizeHeaderName$1=function(e,t){utils$9.forEach(e,(function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])}))},enhanceError$2=function(e,t,r,n,i){return e.config=t,r&&(e.code=r),e.request=n,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e},enhanceError$1=enhanceError$2,createError$1=function(e,t,r,n,i){var o=new Error(e);return enhanceError$1(o,t,r,n,i)},createError$2=getDefaultExportFromCjs$1(createError$1),createError=createError$1,settle$2=function(e,t,r){var n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(createError("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)},settle$3=getDefaultExportFromCjs$1(settle$2),cookies,hasRequiredCookies;function requireCookies(){if(hasRequiredCookies)return cookies;hasRequiredCookies=1;var e=utils$c;return cookies=e.isStandardBrowserEnv()?{write:function(t,r,n,i,o,a){var s=[];s.push(t+"="+encodeURIComponent(r)),e.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),e.isString(i)&&s.push("path="+i),e.isString(o)&&s.push("domain="+o),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},cookies}var isAbsoluteURL$3=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)},combineURLs$3=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},isAbsoluteURL$2=isAbsoluteURL$3,combineURLs$2=combineURLs$3,buildFullPath$2=function(e,t){return e&&!isAbsoluteURL$2(t)?combineURLs$2(e,t):t},buildFullPath$3=getDefaultExportFromCjs$1(buildFullPath$2),parseHeaders,hasRequiredParseHeaders,isURLSameOrigin,hasRequiredIsURLSameOrigin,xhr,hasRequiredXhr;function requireParseHeaders(){if(hasRequiredParseHeaders)return parseHeaders;hasRequiredParseHeaders=1;var e=utils$c,t=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return parseHeaders=function(r){var n,i,o,a={};return r?(e.forEach(r.split("\n"),(function(r){if(o=r.indexOf(":"),n=e.trim(r.substr(0,o)).toLowerCase(),i=e.trim(r.substr(o+1)),n){if(a[n]&&t.indexOf(n)>=0)return;a[n]="set-cookie"===n?(a[n]?a[n]:[]).concat([i]):a[n]?a[n]+", "+i:i}})),a):a},parseHeaders}function requireIsURLSameOrigin(){if(hasRequiredIsURLSameOrigin)return isURLSameOrigin;hasRequiredIsURLSameOrigin=1;var e=utils$c;return isURLSameOrigin=e.isStandardBrowserEnv()?function(){var t,r=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(e){var t=e;return r&&(n.setAttribute("href",t),t=n.href),n.setAttribute("href",t),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return t=i(window.location.href),function(r){var n=e.isString(r)?i(r):r;return n.protocol===t.protocol&&n.host===t.host}}():function(){return!0}}function requireXhr(){if(hasRequiredXhr)return xhr;hasRequiredXhr=1;var e=utils$c,t=settle$2,r=requireCookies(),n=buildURL$3,i=buildFullPath$2,o=requireParseHeaders(),a=requireIsURLSameOrigin(),s=createError$1;return xhr=function(c){return new Promise((function(u,l){var d=c.data,p=c.headers,_=c.responseType;e.isFormData(d)&&delete p["Content-Type"];var h=new XMLHttpRequest;if(c.auth){var f=c.auth.username||"",m=c.auth.password?unescape(encodeURIComponent(c.auth.password)):"";p.Authorization="Basic "+btoa(f+":"+m)}var g=i(c.baseURL,c.url);function v(){if(h){var e="getAllResponseHeaders"in h?o(h.getAllResponseHeaders()):null,r={data:_&&"text"!==_&&"json"!==_?h.response:h.responseText,status:h.status,statusText:h.statusText,headers:e,config:c,request:h};t(u,l,r),h=null}}if(h.open(c.method.toUpperCase(),n(g,c.params,c.paramsSerializer),!0),h.timeout=c.timeout,"onloadend"in h?h.onloadend=v:h.onreadystatechange=function(){h&&4===h.readyState&&(0!==h.status||h.responseURL&&0===h.responseURL.indexOf("file:"))&&setTimeout(v)},h.onabort=function(){h&&(l(s("Request aborted",c,"ECONNABORTED",h)),h=null)},h.onerror=function(){l(s("Network Error",c,null,h)),h=null},h.ontimeout=function(){var e="timeout of "+c.timeout+"ms exceeded";c.timeoutErrorMessage&&(e=c.timeoutErrorMessage),l(s(e,c,c.transitional&&c.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",h)),h=null},e.isStandardBrowserEnv()){var y=(c.withCredentials||a(g))&&c.xsrfCookieName?r.read(c.xsrfCookieName):void 0;y&&(p[c.xsrfHeaderName]=y)}"setRequestHeader"in h&&e.forEach(p,(function(e,t){void 0===d&&"content-type"===t.toLowerCase()?delete p[t]:h.setRequestHeader(t,e)})),e.isUndefined(c.withCredentials)||(h.withCredentials=!!c.withCredentials),_&&"json"!==_&&(h.responseType=c.responseType),"function"==typeof c.onDownloadProgress&&h.addEventListener("progress",c.onDownloadProgress),"function"==typeof c.onUploadProgress&&h.upload&&h.upload.addEventListener("progress",c.onUploadProgress),c.cancelToken&&c.cancelToken.promise.then((function(e){h&&(h.abort(),l(e),h=null)})),d||(d=null),h.send(d)}))},xhr}var utils$8=utils$c,normalizeHeaderName=normalizeHeaderName$1,enhanceError=enhanceError$2,DEFAULT_CONTENT_TYPE$1={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(e,t){!utils$8.isUndefined(e)&&utils$8.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}function getDefaultAdapter(){var e;return("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(e=requireXhr()),e}function stringifySafely(e,t,r){if(utils$8.isString(e))try{return(t||JSON.parse)(e),utils$8.trim(e)}catch(e2){if("SyntaxError"!==e2.name)throw e2}return(r||JSON.stringify)(e)}var defaults$3={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:getDefaultAdapter(),transformRequest:[function(e,t){return normalizeHeaderName(t,"Accept"),normalizeHeaderName(t,"Content-Type"),utils$8.isFormData(e)||utils$8.isArrayBuffer(e)||utils$8.isBuffer(e)||utils$8.isStream(e)||utils$8.isFile(e)||utils$8.isBlob(e)?e:utils$8.isArrayBufferView(e)?e.buffer:utils$8.isURLSearchParams(e)?(setContentTypeIfUnset(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):utils$8.isObject(e)||t&&"application/json"===t["Content-Type"]?(setContentTypeIfUnset(t,"application/json"),stringifySafely(e)):e}],transformResponse:[function(e){var t=this.transitional,r=t&&t.silentJSONParsing,n=t&&t.forcedJSONParsing,i=!r&&"json"===this.responseType;if(i||n&&utils$8.isString(e)&&e.length)try{return JSON.parse(e)}catch(e2){if(i){if("SyntaxError"===e2.name)throw enhanceError(e2,this,"E_JSON_PARSE");throw e2}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};utils$8.forEach(["delete","get","head"],(function(e){defaults$3.headers[e]={}})),utils$8.forEach(["post","put","patch"],(function(e){defaults$3.headers[e]=utils$8.merge(DEFAULT_CONTENT_TYPE$1)}));var defaults_1=defaults$3,utils$7=utils$c,defaults$2=defaults_1,transformData$1=function(e,t,r){var n=this||defaults$2;return utils$7.forEach(r,(function(r){e=r.call(n,e,t)})),e},isCancel$1,hasRequiredIsCancel;function requireIsCancel(){return hasRequiredIsCancel||(hasRequiredIsCancel=1,isCancel$1=function(e){return!(!e||!e.__CANCEL__)}),isCancel$1}var utils$6=utils$c,transformData=transformData$1,isCancel=requireIsCancel(),defaults$1=defaults_1;function throwIfCancellationRequested(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var dispatchRequest$1=function(e){return throwIfCancellationRequested(e),e.headers=e.headers||{},e.data=transformData.call(e,e.data,e.headers,e.transformRequest),e.headers=utils$6.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),utils$6.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||defaults$1.adapter)(e).then((function(t){return throwIfCancellationRequested(e),t.data=transformData.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return isCancel(t)||(throwIfCancellationRequested(e),t&&t.response&&(t.response.data=transformData.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},utils$5=utils$c,mergeConfig$2=function(e,t){t=t||{};var r={},n=["url","method","data"],i=["headers","auth","proxy","params"],o=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],a=["validateStatus"];function s(e,t){return utils$5.isPlainObject(e)&&utils$5.isPlainObject(t)?utils$5.merge(e,t):utils$5.isPlainObject(t)?utils$5.merge({},t):utils$5.isArray(t)?t.slice():t}function c(n){utils$5.isUndefined(t[n])?utils$5.isUndefined(e[n])||(r[n]=s(void 0,e[n])):r[n]=s(e[n],t[n])}utils$5.forEach(n,(function(e){utils$5.isUndefined(t[e])||(r[e]=s(void 0,t[e]))})),utils$5.forEach(i,c),utils$5.forEach(o,(function(n){utils$5.isUndefined(t[n])?utils$5.isUndefined(e[n])||(r[n]=s(void 0,e[n])):r[n]=s(void 0,t[n])})),utils$5.forEach(a,(function(n){n in t?r[n]=s(e[n],t[n]):n in e&&(r[n]=s(void 0,e[n]))}));var u=n.concat(i).concat(o).concat(a),l=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===u.indexOf(e)}));return utils$5.forEach(l,c),r};const name="axios",version$1="0.21.4",description="Promise based HTTP client for the browser and node.js",main="index.js",scripts={test:"grunt test",start:"node ./sandbox/server.js",build:"NODE_ENV=production grunt build",preversion:"npm test",version:"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json",postversion:"git push && git push --tags",examples:"node ./examples/server.js",coveralls:"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js",fix:"eslint --fix lib/**/*.js"},repository={type:"git",url:"https://github.com/axios/axios.git"},keywords=["xhr","http","ajax","promise","node"],author="Matt Zabriskie",license="MIT",bugs={url:"https://github.com/axios/axios/issues"},homepage="https://axios-http.com",devDependencies={coveralls:"^3.0.0","es6-promise":"^4.2.4",grunt:"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1",karma:"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2",minimist:"^1.2.0",mocha:"^8.2.1",sinon:"^4.5.0","terser-webpack-plugin":"^4.2.3",typescript:"^4.0.5","url-search-params":"^0.10.0",webpack:"^4.44.2","webpack-dev-server":"^3.11.0"},browser$1={"./lib/adapters/http.js":"./lib/adapters/xhr.js"},jsdelivr="dist/axios.min.js",unpkg="dist/axios.min.js",typings="./index.d.ts",dependencies={"follow-redirects":"^1.14.0"},bundlesize=[{path:"./dist/axios.min.js",threshold:"5kB"}];var require$$0={name:name,version:version$1,description:description,main:main,scripts:scripts,repository:repository,keywords:keywords,author:author,license:license,bugs:bugs,homepage:homepage,devDependencies:devDependencies,browser:browser$1,jsdelivr:jsdelivr,unpkg:unpkg,typings:typings,dependencies:dependencies,bundlesize:bundlesize},pkg=require$$0,validators$1={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){validators$1[e]=function(r){return _typeof(r)===e||"a"+(t<1?"n ":" ")+e}}));var deprecatedWarnings={},currentVerArr=pkg.version.split(".");function isOlderVersion(e,t){for(var r=t?t.split("."):currentVerArr,n=e.split("."),i=0;i<3;i++){if(r[i]>n[i])return!0;if(r[i]<n[i])return!1}return!1}function assertOptions(e,t,r){if("object"!==_typeof(e))throw new TypeError("options must be an object");for(var n=Object.keys(e),i=n.length;i-- >0;){var o=n[i],a=t[o];if(a){var s=e[o],c=void 0===s||a(s,o,e);if(!0!==c)throw new TypeError("option "+o+" must be "+c)}else if(!0!==r)throw Error("Unknown option "+o)}}validators$1.transitional=function(e,t,r){var n=t&&isOlderVersion(t);function i(e,t){return"[Axios v"+pkg.version+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(r,o,a){if(!1===e)throw new Error(i(o," has been removed in "+t));return n&&!deprecatedWarnings[o]&&(deprecatedWarnings[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,o,a)}};var validator$1={isOlderVersion:isOlderVersion,assertOptions:assertOptions,validators:validators$1},utils$4=utils$c,buildURL$2=buildURL$3,InterceptorManager=InterceptorManager_1,dispatchRequest=dispatchRequest$1,mergeConfig$1=mergeConfig$2,validator=validator$1,validators=validator.validators;function Axios$1(e){this.defaults=e,this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}Axios$1.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=mergeConfig$1(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=e.transitional;void 0!==t&&validator.assertOptions(t,{silentJSONParsing:validators.transitional(validators.boolean,"1.0.0"),forcedJSONParsing:validators.transitional(validators.boolean,"1.0.0"),clarifyTimeoutError:validators.transitional(validators.boolean,"1.0.0")},!1);var r=[],n=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(n=n&&t.synchronous,r.unshift(t.fulfilled,t.rejected))}));var i,o=[];if(this.interceptors.response.forEach((function(e){o.push(e.fulfilled,e.rejected)})),!n){var a=[dispatchRequest,void 0];for(Array.prototype.unshift.apply(a,r),a=a.concat(o),i=Promise.resolve(e);a.length;)i=i.then(a.shift(),a.shift());return i}for(var s=e;r.length;){var c=r.shift(),u=r.shift();try{s=c(s)}catch(l){u(l);break}}try{i=dispatchRequest(s)}catch(l){return Promise.reject(l)}for(;o.length;)i=i.then(o.shift(),o.shift());return i},Axios$1.prototype.getUri=function(e){return e=mergeConfig$1(this.defaults,e),buildURL$2(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},utils$4.forEach(["delete","get","head","options"],(function(e){Axios$1.prototype[e]=function(t,r){return this.request(mergeConfig$1(r||{},{method:e,url:t,data:(r||{}).data}))}})),utils$4.forEach(["post","put","patch"],(function(e){Axios$1.prototype[e]=function(t,r,n){return this.request(mergeConfig$1(n||{},{method:e,url:t,data:r}))}}));var Axios_1=Axios$1,Cancel_1,hasRequiredCancel,CancelToken_1,hasRequiredCancelToken,spread,hasRequiredSpread,isAxiosError,hasRequiredIsAxiosError;function requireCancel(){if(hasRequiredCancel)return Cancel_1;function e(e){this.message=e}return hasRequiredCancel=1,e.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},e.prototype.__CANCEL__=!0,Cancel_1=e}function requireCancelToken(){if(hasRequiredCancelToken)return CancelToken_1;hasRequiredCancelToken=1;var e=requireCancel();function t(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var r;this.promise=new Promise((function(e){r=e}));var n=this;t((function(t){n.reason||(n.reason=new e(t),r(n.reason))}))}return t.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},t.source=function(){var e;return{token:new t((function(t){e=t})),cancel:e}},CancelToken_1=t}function requireSpread(){return hasRequiredSpread?spread:(hasRequiredSpread=1,spread=function(e){return function(t){return e.apply(null,t)}})}function requireIsAxiosError(){return hasRequiredIsAxiosError?isAxiosError:(hasRequiredIsAxiosError=1,isAxiosError=function(e){return"object"===_typeof(e)&&!0===e.isAxiosError})}var utils$3=utils$c,bind$2=bind$4,Axios=Axios_1,mergeConfig=mergeConfig$2,defaults=defaults_1;function createInstance(e){var t=new Axios(e),r=bind$2(Axios.prototype.request,t);return utils$3.extend(r,Axios.prototype,t),utils$3.extend(r,t),r}var axios$2=createInstance(defaults);axios$2.Axios=Axios,axios$2.create=function(e){return createInstance(mergeConfig(axios$2.defaults,e))},axios$2.Cancel=requireCancel(),axios$2.CancelToken=requireCancelToken(),axios$2.isCancel=requireIsCancel(),axios$2.all=function(e){return Promise.all(e)},axios$2.spread=requireSpread(),axios$2.isAxiosError=requireIsAxiosError(),axios$3.exports=axios$2,axios$3.exports.default=axios$2;var axiosExports=axios$3.exports,axios=axiosExports,axios$1=getDefaultExportFromCjs$1(axios),browser={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var e=1e3,t=6e4,r=60*t,n=24*r,i=7*n,o=365.25*n;function a(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}return ms=function(s,c){c=c||{};var u=_typeof(s);if("string"===u&&s.length>0)return function(a){if((a=String(a)).length>100)return;var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(a);if(!s)return;var c=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*i;case"days":case"day":case"d":return c*n;case"hours":case"hour":case"hrs":case"hr":case"h":return c*r;case"minutes":case"minute":case"mins":case"min":case"m":return c*t;case"seconds":case"second":case"secs":case"sec":case"s":return c*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(s);if("number"===u&&isFinite(s))return c.long?function(i){var o=Math.abs(i);if(o>=n)return a(i,o,n,"day");if(o>=r)return a(i,o,r,"hour");if(o>=t)return a(i,o,t,"minute");if(o>=e)return a(i,o,e,"second");return i+" ms"}(s):function(i){var o=Math.abs(i);if(o>=n)return Math.round(i/n)+"d";if(o>=r)return Math.round(i/r)+"h";if(o>=t)return Math.round(i/t)+"m";if(o>=e)return Math.round(i/e)+"s";return i+"ms"}(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))}}function setup(e){function t(e){var n,i,o,a=null;function s(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(s.enabled){var o=s,a=Number(new Date),c=a-(n||a);o.diff=c,o.prev=n,o.curr=a,n=a,r[0]=t.coerce(r[0]),"string"!=typeof r[0]&&r.unshift("%O");var u=0;r[0]=r[0].replace(/%([a-zA-Z%])/g,(function(e,n){if("%%"===e)return"%";u++;var i=t.formatters[n];if("function"==typeof i){var a=r[u];e=i.call(o,a),r.splice(u,1),u--}return e})),t.formatArgs.call(o,r);var l=o.log||t.log;l.apply(o,r)}}return s.namespace=e,s.useColors=t.useColors(),s.color=t.selectColor(e),s.extend=r,s.destroy=t.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==a?a:(i!==t.namespaces&&(i=t.namespaces,o=t.enabled(e)),o)},set:function(e){a=e}}),"function"==typeof t.init&&t.init(s),s}function r(e,r){var n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){var e=[].concat(_toConsumableArray(t.names.map(n)),_toConsumableArray(t.skips.map(n).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){var r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=requireMs(),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(r){t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var r=0,n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}var common=setup;!function(e,t){var r;t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(r){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(r){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(r=!1,function(){r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||function(){},e.exports=common(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}(browser,browser.exports);var browserExports=browser.exports,createDebug=getDefaultExportFromCjs$1(browserExports),axiosAdapterUniapp={exports:{}},isMultiUpload$1=function(e){return Array.isArray(e.files)&&e.files.length>0},isMultiUpload=isMultiUpload$1,isUploadFile$2=function(e){if("post"===e.method){if(e.filePath&&e.name)return!0;if(isMultiUpload(e))return!0}return!1},bind$1=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}},bind=bind$1,toString=Object.prototype.toString,kindOf=(cache=Object.create(null),function(e){var t=toString.call(e);return cache[t]||(cache[t]=t.slice(8,-1).toLowerCase())}),cache;function kindOfTest(e){return e=e.toLowerCase(),function(t){return kindOf(t)===e}}function isArray$4(e){return Array.isArray(e)}function isUndefined(e){return void 0===e}function isBuffer$4(e){return null!==e&&!isUndefined(e)&&null!==e.constructor&&!isUndefined(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&isArrayBuffer(e.buffer)}function isString(e){return"string"==typeof e}function isNumber(e){return"number"==typeof e}function isObject$6(e){return null!==e&&"object"===_typeof(e)}function isPlainObject(e){if("object"!==kindOf(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}var isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob$1=kindOfTest("Blob"),isFileList=kindOfTest("FileList");function isFunction$3(e){return"[object Function]"===toString.call(e)}function isStream(e){return isObject$6(e)&&isFunction$3(e.pipe)}function isFormData(e){var t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||toString.call(e)===t||isFunction$3(e.toString)&&e.toString()===t)}var isURLSearchParams=kindOfTest("URLSearchParams");function trim(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function isStandardBrowserEnv(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)}function forEach(e,t){if(null!=e)if("object"!==_typeof(e)&&(e=[e]),isArray$4(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}function merge(){var e={};function t(t,r){isPlainObject(e[r])&&isPlainObject(t)?e[r]=merge(e[r],t):isPlainObject(t)?e[r]=merge({},t):isArray$4(t)?e[r]=t.slice():e[r]=t}for(var r=0,n=arguments.length;r<n;r++)forEach(arguments[r],t);return e}function extend(e,t,r){return forEach(t,(function(t,n){e[n]=r&&"function"==typeof t?bind(t,r):t})),e}function stripBOM(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}function inherits(e,t,r,n){e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,r&&Object.assign(e.prototype,r)}function toFlatObject(e,t,r){var n,i,o,a={};t=t||{};do{for(i=(n=Object.getOwnPropertyNames(e)).length;i-- >0;)a[o=n[i]]||(t[o]=e[o],a[o]=!0);e=Object.getPrototypeOf(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t}function endsWith(e,t,r){e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;var n=e.indexOf(t,r);return-1!==n&&n===r}function toArray(e){if(!e)return null;var t=e.length;if(isUndefined(t))return null;for(var r=new Array(t);t-- >0;)r[t]=e[t];return r}var isTypedArray$2=(TypedArray2="undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(e){return TypedArray2&&e instanceof TypedArray2}),TypedArray2,utils$2={isArray:isArray$4,isArrayBuffer:isArrayBuffer,isBuffer:isBuffer$4,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString,isNumber:isNumber,isObject:isObject$6,isPlainObject:isPlainObject,isUndefined:isUndefined,isDate:isDate,isFile:isFile,isBlob:isBlob$1,isFunction:isFunction$3,isStream:isStream,isURLSearchParams:isURLSearchParams,isStandardBrowserEnv:isStandardBrowserEnv,forEach:forEach,merge:merge,extend:extend,trim:trim,stripBOM:stripBOM,inherits:inherits,toFlatObject:toFlatObject,kindOf:kindOf,kindOfTest:kindOfTest,endsWith:endsWith,toArray:toArray,isTypedArray:isTypedArray$2,isFileList:isFileList},utils$1=utils$2;function AxiosError$1(e,t,r,n,i){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i)}utils$1.inherits(AxiosError$1,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var prototype=AxiosError$1.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(e){descriptors[e]={value:e}})),Object.defineProperties(AxiosError$1,descriptors),Object.defineProperty(prototype,"isAxiosError",{value:!0}),AxiosError$1.from=function(e,t,r,n,i,o){var a=Object.create(prototype);return utils$1.toFlatObject(e,a,(function(e){return e!==Error.prototype})),AxiosError$1.call(a,e.message,t,r,n,i),a.name=e.name,o&&Object.assign(a,o),a};var AxiosError_1=AxiosError$1,AxiosError=AxiosError_1,settle$1=function(e,t,r){var n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(new AxiosError("Request failed with status code "+r.status,[AxiosError.ERR_BAD_REQUEST,AxiosError.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)},utils=utils$2;function encode(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var buildURL$1=function(e,t,r){if(!t)return e;var n;if(r)n=r(t);else if(utils.isURLSearchParams(t))n=t.toString();else{var i=[];utils.forEach(t,(function(e,t){null!=e&&(utils.isArray(e)?t+="[]":e=[e],utils.forEach(e,(function(e){utils.isDate(e)?e=e.toISOString():utils.isObject(e)&&(e=JSON.stringify(e)),i.push(encode(t)+"="+encode(e))})))})),n=i.join("&")}if(n){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e},isAbsoluteURL$1=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},combineURLs$1=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},isAbsoluteURL=isAbsoluteURL$1,combineURLs=combineURLs$1,buildFullPath$1=function(e,t){return e&&!isAbsoluteURL(t)?combineURLs(e,t):t},settle=settle$1,buildURL=buildURL$1,buildFullPath=buildFullPath$1,isUploadFile$1=isUploadFile$2,format$1=function(e,t,r){var n=buildFullPath(e.baseURL,e.url),i=e.headers,o=_objectSpread2(_objectSpread2({},e),{},{url:buildURL(n,e.params,e.paramsSerializer),header:i});if(isUploadFile$1(e)?(delete i["Content-Type"],e.formData?o.formData=e.formData:"string"==typeof e.data?o.formData=JSON.parse(e.data):o.formData=e.data):"get"===e.method?o.data=e.data?e.data:e.params:o.data=e.data,e.auth){var a=e.auth.username||"",s=unescape(encodeURIComponent(e.auth.password))||"";i.Authorization="Basic "+btoa(a+":"+s)}return o.complete=function(n){var i={data:n.data,status:n.statusCode,statusText:n.errMsg,header:n.header,config:e};settle(t,r,i)},o},isUploadFile=isUploadFile$2,format=format$1;function uniappAdapter(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise((function(t,r){var n=format(e,t,r),i=null;e.cancelToken&&e.cancelToken.promise.then((function(e){i&&(i.abort(),r(e),i=null)})),i=isUploadFile(e)?uni.uploadFile(n):uni.request(n)}))}axiosAdapterUniapp.exports=uniappAdapter,axiosAdapterUniapp.exports.default=uniappAdapter;var axiosAdapterUniappExports=axiosAdapterUniapp.exports,uniappAdapter$1=getDefaultExportFromCjs$1(axiosAdapterUniappExports);function listCacheClear$1(){this.__data__=[],this.size=0}var _listCacheClear=listCacheClear$1;function eq$2(e,t){return e===t||e!=e&&t!=t}var eq_1=eq$2,eq$1=eq_1;function assocIndexOf$4(e,t){for(var r=e.length;r--;)if(eq$1(e[r][0],t))return r;return-1}var _assocIndexOf=assocIndexOf$4,assocIndexOf$3=_assocIndexOf,arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete$1(e){var t=this.__data__,r=assocIndexOf$3(t,e);return!(r<0)&&(r==t.length-1?t.pop():splice.call(t,r,1),--this.size,!0)}var _listCacheDelete=listCacheDelete$1,assocIndexOf$2=_assocIndexOf;function listCacheGet$1(e){var t=this.__data__,r=assocIndexOf$2(t,e);return r<0?void 0:t[r][1]}var _listCacheGet=listCacheGet$1,assocIndexOf$1=_assocIndexOf;function listCacheHas$1(e){return assocIndexOf$1(this.__data__,e)>-1}var _listCacheHas=listCacheHas$1,assocIndexOf=_assocIndexOf;function listCacheSet$1(e,t){var r=this.__data__,n=assocIndexOf(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var _listCacheSet=listCacheSet$1,listCacheClear=_listCacheClear,listCacheDelete=_listCacheDelete,listCacheGet=_listCacheGet,listCacheHas=_listCacheHas,listCacheSet=_listCacheSet;function ListCache$4(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ListCache$4.prototype.clear=listCacheClear,ListCache$4.prototype.delete=listCacheDelete,ListCache$4.prototype.get=listCacheGet,ListCache$4.prototype.has=listCacheHas,ListCache$4.prototype.set=listCacheSet;var _ListCache=ListCache$4,ListCache$3=_ListCache;function stackClear$1(){this.__data__=new ListCache$3,this.size=0}var _stackClear=stackClear$1;function stackDelete$1(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var _stackDelete=stackDelete$1;function stackGet$1(e){return this.__data__.get(e)}var _stackGet=stackGet$1;function stackHas$1(e){return this.__data__.has(e)}var _stackHas=stackHas$1,freeGlobal$1="object"==_typeof(commonjsGlobal)&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,_freeGlobal=freeGlobal$1,freeGlobal=_freeGlobal,freeSelf="object"==("undefined"==typeof self?"undefined":_typeof(self))&&self&&self.Object===Object&&self,root$8=freeGlobal||freeSelf||Function("return this")(),_root=root$8,root$7=_root,_Symbol2=root$7.Symbol,_Symbol$3=_Symbol2,_Symbol$2=_Symbol$3,objectProto$c=Object.prototype,hasOwnProperty$a=objectProto$c.hasOwnProperty,nativeObjectToString$1=objectProto$c.toString,symToStringTag$1=_Symbol$2?_Symbol$2.toStringTag:void 0;function getRawTag$1(e){var t=hasOwnProperty$a.call(e,symToStringTag$1),r=e[symToStringTag$1];try{e[symToStringTag$1]=void 0;var n=!0}catch(e2){}var i=nativeObjectToString$1.call(e);return n&&(t?e[symToStringTag$1]=r:delete e[symToStringTag$1]),i}var _getRawTag=getRawTag$1,objectProto$b=Object.prototype,nativeObjectToString=objectProto$b.toString;function objectToString$1(e){return nativeObjectToString.call(e)}var _objectToString=objectToString$1,_Symbol$1=_Symbol$3,getRawTag=_getRawTag,objectToString=_objectToString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=_Symbol$1?_Symbol$1.toStringTag:void 0;function baseGetTag$4(e){return null==e?void 0===e?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(e)?getRawTag(e):objectToString(e)}var _baseGetTag=baseGetTag$4;function isObject$5(e){var t=_typeof(e);return null!=e&&("object"==t||"function"==t)}var isObject_1=isObject$5,baseGetTag$3=_baseGetTag,isObject$4=isObject_1,asyncTag="[object AsyncFunction]",funcTag$2="[object Function]",genTag$1="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction$2(e){if(!isObject$4(e))return!1;var t=baseGetTag$3(e);return t==funcTag$2||t==genTag$1||t==asyncTag||t==proxyTag}var isFunction_1=isFunction$2,root$6=_root,coreJsData$1=root$6["__core-js_shared__"],_coreJsData=coreJsData$1,coreJsData=_coreJsData,maskSrcKey=(uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||""),uid?"Symbol(src)_1."+uid:""),uid;function isMasked$1(e){return!!maskSrcKey&&maskSrcKey in e}var _isMasked=isMasked$1,funcProto$1=Function.prototype,funcToString$1=funcProto$1.toString;function toSource$2(e){if(null!=e){try{return funcToString$1.call(e)}catch(e2){}try{return e+""}catch(e2){}}return""}var _toSource=toSource$2,isFunction$1=isFunction_1,isMasked=_isMasked,isObject$3=isObject_1,toSource$1=_toSource,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto=Function.prototype,objectProto$a=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$9=objectProto$a.hasOwnProperty,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty$9).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative$1(e){return!(!isObject$3(e)||isMasked(e))&&(isFunction$1(e)?reIsNative:reIsHostCtor).test(toSource$1(e))}var _baseIsNative=baseIsNative$1;function getValue$1(e,t){return null==e?void 0:e[t]}var _getValue=getValue$1,baseIsNative=_baseIsNative,getValue=_getValue;function getNative$7(e,t){var r=getValue(e,t);return baseIsNative(r)?r:void 0}var _getNative=getNative$7,getNative$6=_getNative,root$5=_root,Map$4=getNative$6(root$5,"Map"),_Map=Map$4,getNative$5=_getNative,nativeCreate$4=getNative$5(Object,"create"),_nativeCreate=nativeCreate$4,nativeCreate$3=_nativeCreate;function hashClear$1(){this.__data__=nativeCreate$3?nativeCreate$3(null):{},this.size=0}var _hashClear=hashClear$1;function hashDelete$1(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var _hashDelete=hashDelete$1,nativeCreate$2=_nativeCreate,HASH_UNDEFINED$1="__lodash_hash_undefined__",objectProto$9=Object.prototype,hasOwnProperty$8=objectProto$9.hasOwnProperty;function hashGet$1(e){var t=this.__data__;if(nativeCreate$2){var r=t[e];return r===HASH_UNDEFINED$1?void 0:r}return hasOwnProperty$8.call(t,e)?t[e]:void 0}var _hashGet=hashGet$1,nativeCreate$1=_nativeCreate,objectProto$8=Object.prototype,hasOwnProperty$7=objectProto$8.hasOwnProperty;function hashHas$1(e){var t=this.__data__;return nativeCreate$1?void 0!==t[e]:hasOwnProperty$7.call(t,e)}var _hashHas=hashHas$1,nativeCreate=_nativeCreate,HASH_UNDEFINED="__lodash_hash_undefined__";function hashSet$1(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=nativeCreate&&void 0===t?HASH_UNDEFINED:t,this}var _hashSet=hashSet$1,hashClear=_hashClear,hashDelete=_hashDelete,hashGet=_hashGet,hashHas=_hashHas,hashSet=_hashSet;function Hash$1(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Hash$1.prototype.clear=hashClear,Hash$1.prototype.delete=hashDelete,Hash$1.prototype.get=hashGet,Hash$1.prototype.has=hashHas,Hash$1.prototype.set=hashSet;var _Hash=Hash$1,Hash=_Hash,ListCache$2=_ListCache,Map$3=_Map;function mapCacheClear$1(){this.size=0,this.__data__={hash:new Hash,map:new(Map$3||ListCache$2),string:new Hash}}var _mapCacheClear=mapCacheClear$1;function isKeyable$1(e){var t=_typeof(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}var _isKeyable=isKeyable$1,isKeyable=_isKeyable;function getMapData$4(e,t){var r=e.__data__;return isKeyable(t)?r["string"==typeof t?"string":"hash"]:r.map}var _getMapData=getMapData$4,getMapData$3=_getMapData;function mapCacheDelete$1(e){var t=getMapData$3(this,e).delete(e);return this.size-=t?1:0,t}var _mapCacheDelete=mapCacheDelete$1,getMapData$2=_getMapData;function mapCacheGet$1(e){return getMapData$2(this,e).get(e)}var _mapCacheGet=mapCacheGet$1,getMapData$1=_getMapData;function mapCacheHas$1(e){return getMapData$1(this,e).has(e)}var _mapCacheHas=mapCacheHas$1,getMapData=_getMapData;function mapCacheSet$1(e,t){var r=getMapData(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var _mapCacheSet=mapCacheSet$1,mapCacheClear=_mapCacheClear,mapCacheDelete=_mapCacheDelete,mapCacheGet=_mapCacheGet,mapCacheHas=_mapCacheHas,mapCacheSet=_mapCacheSet;function MapCache$1(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}MapCache$1.prototype.clear=mapCacheClear,MapCache$1.prototype.delete=mapCacheDelete,MapCache$1.prototype.get=mapCacheGet,MapCache$1.prototype.has=mapCacheHas,MapCache$1.prototype.set=mapCacheSet;var _MapCache=MapCache$1,ListCache$1=_ListCache,Map$2=_Map,MapCache=_MapCache,LARGE_ARRAY_SIZE=200;function stackSet$1(e,t){var r=this.__data__;if(r instanceof ListCache$1){var n=r.__data__;if(!Map$2||n.length<LARGE_ARRAY_SIZE-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new MapCache(n)}return r.set(e,t),this.size=r.size,this}var _stackSet=stackSet$1,ListCache=_ListCache,stackClear=_stackClear,stackDelete=_stackDelete,stackGet=_stackGet,stackHas=_stackHas,stackSet=_stackSet;function Stack$1(e){var t=this.__data__=new ListCache(e);this.size=t.size}Stack$1.prototype.clear=stackClear,Stack$1.prototype.delete=stackDelete,Stack$1.prototype.get=stackGet,Stack$1.prototype.has=stackHas,Stack$1.prototype.set=stackSet;var _Stack=Stack$1;function arrayEach$1(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}var _arrayEach=arrayEach$1,getNative$4=_getNative,defineProperty$1=function(){try{var e=getNative$4(Object,"defineProperty");return e({},"",{}),e}catch(e2){}}(),_defineProperty=defineProperty$1,defineProperty=_defineProperty;function baseAssignValue$2(e,t,r){"__proto__"==t&&defineProperty?defineProperty(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var _baseAssignValue=baseAssignValue$2,baseAssignValue$1=_baseAssignValue,eq=eq_1,objectProto$7=Object.prototype,hasOwnProperty$6=objectProto$7.hasOwnProperty;function assignValue$2(e,t,r){var n=e[t];hasOwnProperty$6.call(e,t)&&eq(n,r)&&(void 0!==r||t in e)||baseAssignValue$1(e,t,r)}var _assignValue=assignValue$2,assignValue$1=_assignValue,baseAssignValue=_baseAssignValue;function copyObject$5(e,t,r,n){var i=!r;r||(r={});for(var o=-1,a=t.length;++o<a;){var s=t[o],c=n?n(r[s],e[s],s,r,e):void 0;void 0===c&&(c=e[s]),i?baseAssignValue(r,s,c):assignValue$1(r,s,c)}return r}var _copyObject$1=copyObject$5;function baseTimes$1(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var _baseTimes=baseTimes$1;function isObjectLike$5(e){return null!=e&&"object"==_typeof(e)}var isObjectLike_1=isObjectLike$5,baseGetTag$2=_baseGetTag,isObjectLike$4=isObjectLike_1,argsTag$2="[object Arguments]";function baseIsArguments$1(e){return isObjectLike$4(e)&&baseGetTag$2(e)==argsTag$2}var _baseIsArguments=baseIsArguments$1,baseIsArguments=_baseIsArguments,isObjectLike$3=isObjectLike_1,objectProto$6=Object.prototype,hasOwnProperty$5=objectProto$6.hasOwnProperty,propertyIsEnumerable$1=objectProto$6.propertyIsEnumerable,isArguments$1=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike$3(e)&&hasOwnProperty$5.call(e,"callee")&&!propertyIsEnumerable$1.call(e,"callee")},isArguments_1=isArguments$1,isArray$3=Array.isArray,isArray_1=isArray$3,isBuffer$3={exports:{}};function stubFalse(){return!1}var stubFalse_1=stubFalse;isBuffer$3.exports,function(e,t){var r=_root,n=stubFalse_1,i=t&&!t.nodeType&&t,o=i&&e&&!e.nodeType&&e,a=o&&o.exports===i?r.Buffer:void 0,s=(a?a.isBuffer:void 0)||n;e.exports=s}(isBuffer$3,isBuffer$3.exports);var isBufferExports=isBuffer$3.exports,MAX_SAFE_INTEGER$1=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex$1(e,t){var r=_typeof(e);return!!(t=null==t?MAX_SAFE_INTEGER$1:t)&&("number"==r||"symbol"!=r&&reIsUint.test(e))&&e>-1&&e%1==0&&e<t}var _isIndex=isIndex$1,MAX_SAFE_INTEGER=9007199254740991;function isLength$2(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER}var isLength_1=isLength$2,baseGetTag$1=_baseGetTag,isLength$1=isLength_1,isObjectLike$2=isObjectLike_1,argsTag$1="[object Arguments]",arrayTag$1="[object Array]",boolTag$2="[object Boolean]",dateTag$2="[object Date]",errorTag$1="[object Error]",funcTag$1="[object Function]",mapTag$4="[object Map]",numberTag$2="[object Number]",objectTag$2="[object Object]",regexpTag$2="[object RegExp]",setTag$4="[object Set]",stringTag$2="[object String]",weakMapTag$2="[object WeakMap]",arrayBufferTag$2="[object ArrayBuffer]",dataViewTag$3="[object DataView]",float32Tag$2="[object Float32Array]",float64Tag$2="[object Float64Array]",int8Tag$2="[object Int8Array]",int16Tag$2="[object Int16Array]",int32Tag$2="[object Int32Array]",uint8Tag$2="[object Uint8Array]",uint8ClampedTag$2="[object Uint8ClampedArray]",uint16Tag$2="[object Uint16Array]",uint32Tag$2="[object Uint32Array]",typedArrayTags={};function baseIsTypedArray$1(e){return isObjectLike$2(e)&&isLength$1(e.length)&&!!typedArrayTags[baseGetTag$1(e)]}typedArrayTags[float32Tag$2]=typedArrayTags[float64Tag$2]=typedArrayTags[int8Tag$2]=typedArrayTags[int16Tag$2]=typedArrayTags[int32Tag$2]=typedArrayTags[uint8Tag$2]=typedArrayTags[uint8ClampedTag$2]=typedArrayTags[uint16Tag$2]=typedArrayTags[uint32Tag$2]=!0,typedArrayTags[argsTag$1]=typedArrayTags[arrayTag$1]=typedArrayTags[arrayBufferTag$2]=typedArrayTags[boolTag$2]=typedArrayTags[dataViewTag$3]=typedArrayTags[dateTag$2]=typedArrayTags[errorTag$1]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag$4]=typedArrayTags[numberTag$2]=typedArrayTags[objectTag$2]=typedArrayTags[regexpTag$2]=typedArrayTags[setTag$4]=typedArrayTags[stringTag$2]=typedArrayTags[weakMapTag$2]=!1;var _baseIsTypedArray=baseIsTypedArray$1;function baseUnary$3(e){return function(t){return e(t)}}var _baseUnary=baseUnary$3,_nodeUtil={exports:{}};_nodeUtil.exports,function(e,t){var r=_freeGlobal,n=t&&!t.nodeType&&t,i=n&&e&&!e.nodeType&&e,o=i&&i.exports===n&&r.process,a=function(){try{var e=i&&i.require&&i.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(e2){}}();e.exports=a}(_nodeUtil,_nodeUtil.exports);var _nodeUtilExports=_nodeUtil.exports,baseIsTypedArray=_baseIsTypedArray,baseUnary$2=_baseUnary,nodeUtil$2=_nodeUtilExports,nodeIsTypedArray=nodeUtil$2&&nodeUtil$2.isTypedArray,isTypedArray$1=nodeIsTypedArray?baseUnary$2(nodeIsTypedArray):baseIsTypedArray,isTypedArray_1=isTypedArray$1,baseTimes=_baseTimes,isArguments=isArguments_1,isArray$2=isArray_1,isBuffer$2=isBufferExports,isIndex=_isIndex,isTypedArray=isTypedArray_1,objectProto$5=Object.prototype,hasOwnProperty$4=objectProto$5.hasOwnProperty;function arrayLikeKeys$2(e,t){var r=isArray$2(e),n=!r&&isArguments(e),i=!r&&!n&&isBuffer$2(e),o=!r&&!n&&!i&&isTypedArray(e),a=r||n||i||o,s=a?baseTimes(e.length,String):[],c=s.length;for(var u in e)!t&&!hasOwnProperty$4.call(e,u)||a&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||isIndex(u,c))||s.push(u);return s}var _arrayLikeKeys=arrayLikeKeys$2,objectProto$4=Object.prototype;function isPrototype$3(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||objectProto$4)}var _isPrototype=isPrototype$3;function overArg$2(e,t){return function(r){return e(t(r))}}var _overArg=overArg$2,overArg$1=_overArg,nativeKeys$1=overArg$1(Object.keys,Object),_nativeKeys=nativeKeys$1,isPrototype$2=_isPrototype,nativeKeys=_nativeKeys,objectProto$3=Object.prototype,hasOwnProperty$3=objectProto$3.hasOwnProperty;function baseKeys$1(e){if(!isPrototype$2(e))return nativeKeys(e);var t=[];for(var r in Object(e))hasOwnProperty$3.call(e,r)&&"constructor"!=r&&t.push(r);return t}var _baseKeys=baseKeys$1,isFunction=isFunction_1,isLength=isLength_1;function isArrayLike$2(e){return null!=e&&isLength(e.length)&&!isFunction(e)}var isArrayLike_1=isArrayLike$2,arrayLikeKeys$1=_arrayLikeKeys,baseKeys=_baseKeys,isArrayLike$1=isArrayLike_1;function keys$3(e){return isArrayLike$1(e)?arrayLikeKeys$1(e):baseKeys(e)}var keys_1=keys$3,copyObject$4=_copyObject$1,keys$2=keys_1;function baseAssign$1(e,t){return e&&copyObject$4(t,keys$2(t),e)}var _baseAssign=baseAssign$1;function nativeKeysIn$1(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}var _nativeKeysIn=nativeKeysIn$1,isObject$2=isObject_1,isPrototype$1=_isPrototype,nativeKeysIn=_nativeKeysIn,objectProto$2=Object.prototype,hasOwnProperty$2=objectProto$2.hasOwnProperty;function baseKeysIn$1(e){if(!isObject$2(e))return nativeKeysIn(e);var t=isPrototype$1(e),r=[];for(var n in e)("constructor"!=n||!t&&hasOwnProperty$2.call(e,n))&&r.push(n);return r}var _baseKeysIn=baseKeysIn$1,arrayLikeKeys=_arrayLikeKeys,baseKeysIn=_baseKeysIn,isArrayLike=isArrayLike_1;function keysIn$3(e){return isArrayLike(e)?arrayLikeKeys(e,!0):baseKeysIn(e)}var keysIn_1=keysIn$3,copyObject$3=_copyObject$1,keysIn$2=keysIn_1;function baseAssignIn$1(e,t){return e&&copyObject$3(t,keysIn$2(t),e)}var _baseAssignIn=baseAssignIn$1,_cloneBuffer={exports:{}};_cloneBuffer.exports,function(e,t){var r=_root,n=t&&!t.nodeType&&t,i=n&&e&&!e.nodeType&&e,o=i&&i.exports===n?r.Buffer:void 0,a=o?o.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,n=a?a(r):new e.constructor(r);return e.copy(n),n}}(_cloneBuffer,_cloneBuffer.exports);var _cloneBufferExports=_cloneBuffer.exports;function copyArray$1(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}var _copyArray=copyArray$1;function arrayFilter$1(e,t){for(var r=-1,n=null==e?0:e.length,i=0,o=[];++r<n;){var a=e[r];t(a,r,e)&&(o[i++]=a)}return o}var _arrayFilter=arrayFilter$1;function stubArray$2(){return[]}var stubArray_1=stubArray$2,arrayFilter=_arrayFilter,stubArray$1=stubArray_1,objectProto$1=Object.prototype,propertyIsEnumerable=objectProto$1.propertyIsEnumerable,nativeGetSymbols$1=Object.getOwnPropertySymbols,getSymbols$3=nativeGetSymbols$1?function(e){return null==e?[]:(e=Object(e),arrayFilter(nativeGetSymbols$1(e),(function(t){return propertyIsEnumerable.call(e,t)})))}:stubArray$1,_getSymbols=getSymbols$3,copyObject$2=_copyObject$1,getSymbols$2=_getSymbols;function copySymbols$1(e,t){return copyObject$2(e,getSymbols$2(e),t)}var _copySymbols=copySymbols$1;function arrayPush$2(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}var _arrayPush=arrayPush$2,overArg=_overArg,getPrototype$2=overArg(Object.getPrototypeOf,Object),_getPrototype=getPrototype$2,arrayPush$1=_arrayPush,getPrototype$1=_getPrototype,getSymbols$1=_getSymbols,stubArray=stubArray_1,nativeGetSymbols=Object.getOwnPropertySymbols,getSymbolsIn$2=nativeGetSymbols?function(e){for(var t=[];e;)arrayPush$1(t,getSymbols$1(e)),e=getPrototype$1(e);return t}:stubArray,_getSymbolsIn=getSymbolsIn$2,copyObject$1=_copyObject$1,getSymbolsIn$1=_getSymbolsIn;function copySymbolsIn$1(e,t){return copyObject$1(e,getSymbolsIn$1(e),t)}var _copySymbolsIn=copySymbolsIn$1,arrayPush=_arrayPush,isArray$1=isArray_1;function baseGetAllKeys$2(e,t,r){var n=t(e);return isArray$1(e)?n:arrayPush(n,r(e))}var _baseGetAllKeys=baseGetAllKeys$2,baseGetAllKeys$1=_baseGetAllKeys,getSymbols=_getSymbols,keys$1=keys_1;function getAllKeys$1(e){return baseGetAllKeys$1(e,keys$1,getSymbols)}var _getAllKeys=getAllKeys$1,baseGetAllKeys=_baseGetAllKeys,getSymbolsIn=_getSymbolsIn,keysIn$1=keysIn_1;function getAllKeysIn$1(e){return baseGetAllKeys(e,keysIn$1,getSymbolsIn)}var _getAllKeysIn=getAllKeysIn$1,getNative$3=_getNative,root$4=_root,DataView$2=getNative$3(root$4,"DataView"),_DataView=DataView$2,getNative$2=_getNative,root$3=_root,Promise$2=getNative$2(root$3,"Promise"),_Promise=Promise$2,getNative$1=_getNative,root$2=_root,Set$2=getNative$1(root$2,"Set"),_Set=Set$2,getNative=_getNative,root$1=_root,WeakMap$2=getNative(root$1,"WeakMap"),_WeakMap=WeakMap$2,DataView$1=_DataView,Map$1=_Map,Promise$1=_Promise,Set$1=_Set,WeakMap$1=_WeakMap,baseGetTag=_baseGetTag,toSource=_toSource,mapTag$3="[object Map]",objectTag$1="[object Object]",promiseTag="[object Promise]",setTag$3="[object Set]",weakMapTag$1="[object WeakMap]",dataViewTag$2="[object DataView]",dataViewCtorString=toSource(DataView$1),mapCtorString=toSource(Map$1),promiseCtorString=toSource(Promise$1),setCtorString=toSource(Set$1),weakMapCtorString=toSource(WeakMap$1),getTag$3=baseGetTag;(DataView$1&&getTag$3(new DataView$1(new ArrayBuffer(1)))!=dataViewTag$2||Map$1&&getTag$3(new Map$1)!=mapTag$3||Promise$1&&getTag$3(Promise$1.resolve())!=promiseTag||Set$1&&getTag$3(new Set$1)!=setTag$3||WeakMap$1&&getTag$3(new WeakMap$1)!=weakMapTag$1)&&(getTag$3=function(e){var t=baseGetTag(e),r=t==objectTag$1?e.constructor:void 0,n=r?toSource(r):"";if(n)switch(n){case dataViewCtorString:return dataViewTag$2;case mapCtorString:return mapTag$3;case promiseCtorString:return promiseTag;case setCtorString:return setTag$3;case weakMapCtorString:return weakMapTag$1}return t});var _getTag=getTag$3,objectProto=Object.prototype,hasOwnProperty$1=objectProto.hasOwnProperty;function initCloneArray$1(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&hasOwnProperty$1.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var _initCloneArray=initCloneArray$1,root=_root,Uint8Array$2=root.Uint8Array,_Uint8Array=Uint8Array$2,Uint8Array$1=_Uint8Array;function cloneArrayBuffer$3(e){var t=new e.constructor(e.byteLength);return new Uint8Array$1(t).set(new Uint8Array$1(e)),t}var _cloneArrayBuffer=cloneArrayBuffer$3,cloneArrayBuffer$2=_cloneArrayBuffer;function cloneDataView$1(e,t){var r=t?cloneArrayBuffer$2(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var _cloneDataView=cloneDataView$1,reFlags=/\w*$/;function cloneRegExp$1(e){var t=new e.constructor(e.source,reFlags.exec(e));return t.lastIndex=e.lastIndex,t}var _cloneRegExp=cloneRegExp$1,_Symbol=_Symbol$3,symbolProto=_Symbol?_Symbol.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;function cloneSymbol$1(e){return symbolValueOf?Object(symbolValueOf.call(e)):{}}var _cloneSymbol=cloneSymbol$1,cloneArrayBuffer$1=_cloneArrayBuffer;function cloneTypedArray$1(e,t){var r=t?cloneArrayBuffer$1(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var _cloneTypedArray=cloneTypedArray$1,cloneArrayBuffer=_cloneArrayBuffer,cloneDataView=_cloneDataView,cloneRegExp=_cloneRegExp,cloneSymbol=_cloneSymbol,cloneTypedArray=_cloneTypedArray,boolTag$1="[object Boolean]",dateTag$1="[object Date]",mapTag$2="[object Map]",numberTag$1="[object Number]",regexpTag$1="[object RegExp]",setTag$2="[object Set]",stringTag$1="[object String]",symbolTag$1="[object Symbol]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$1="[object DataView]",float32Tag$1="[object Float32Array]",float64Tag$1="[object Float64Array]",int8Tag$1="[object Int8Array]",int16Tag$1="[object Int16Array]",int32Tag$1="[object Int32Array]",uint8Tag$1="[object Uint8Array]",uint8ClampedTag$1="[object Uint8ClampedArray]",uint16Tag$1="[object Uint16Array]",uint32Tag$1="[object Uint32Array]";function initCloneByTag$1(e,t,r){var n=e.constructor;switch(t){case arrayBufferTag$1:return cloneArrayBuffer(e);case boolTag$1:case dateTag$1:return new n(+e);case dataViewTag$1:return cloneDataView(e,r);case float32Tag$1:case float64Tag$1:case int8Tag$1:case int16Tag$1:case int32Tag$1:case uint8Tag$1:case uint8ClampedTag$1:case uint16Tag$1:case uint32Tag$1:return cloneTypedArray(e,r);case mapTag$2:return new n;case numberTag$1:case stringTag$1:return new n(e);case regexpTag$1:return cloneRegExp(e);case setTag$2:return new n;case symbolTag$1:return cloneSymbol(e)}}var _initCloneByTag=initCloneByTag$1,isObject$1=isObject_1,objectCreate=Object.create,baseCreate$1=function(){function e(){}return function(t){if(!isObject$1(t))return{};if(objectCreate)return objectCreate(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),_baseCreate=baseCreate$1,baseCreate=_baseCreate,getPrototype=_getPrototype,isPrototype=_isPrototype;function initCloneObject$1(e){return"function"!=typeof e.constructor||isPrototype(e)?{}:baseCreate(getPrototype(e))}var _initCloneObject=initCloneObject$1,getTag$2=_getTag,isObjectLike$1=isObjectLike_1,mapTag$1="[object Map]";function baseIsMap$1(e){return isObjectLike$1(e)&&getTag$2(e)==mapTag$1}var _baseIsMap=baseIsMap$1,baseIsMap=_baseIsMap,baseUnary$1=_baseUnary,nodeUtil$1=_nodeUtilExports,nodeIsMap=nodeUtil$1&&nodeUtil$1.isMap,isMap$1=nodeIsMap?baseUnary$1(nodeIsMap):baseIsMap,isMap_1=isMap$1,getTag$1=_getTag,isObjectLike=isObjectLike_1,setTag$1="[object Set]";function baseIsSet$1(e){return isObjectLike(e)&&getTag$1(e)==setTag$1}var _baseIsSet=baseIsSet$1,baseIsSet=_baseIsSet,baseUnary=_baseUnary,nodeUtil=_nodeUtilExports,nodeIsSet=nodeUtil&&nodeUtil.isSet,isSet$1=nodeIsSet?baseUnary(nodeIsSet):baseIsSet,isSet_1=isSet$1,Stack=_Stack,arrayEach=_arrayEach,assignValue=_assignValue,baseAssign=_baseAssign,baseAssignIn=_baseAssignIn,cloneBuffer=_cloneBufferExports,copyArray=_copyArray,copySymbols=_copySymbols,copySymbolsIn=_copySymbolsIn,getAllKeys=_getAllKeys,getAllKeysIn=_getAllKeysIn,getTag=_getTag,initCloneArray=_initCloneArray,initCloneByTag=_initCloneByTag,initCloneObject=_initCloneObject,isArray=isArray_1,isBuffer$1=isBufferExports,isMap=isMap_1,isObject=isObject_1,isSet=isSet_1,keys=keys_1,keysIn=keysIn_1,CLONE_DEEP_FLAG$1=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG$1=4,argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",cloneableTags={};function baseClone$1(e,t,r,n,i,o){var a,s=t&CLONE_DEEP_FLAG$1,c=t&CLONE_FLAT_FLAG,u=t&CLONE_SYMBOLS_FLAG$1;if(r&&(a=i?r(e,n,i,o):r(e)),void 0!==a)return a;if(!isObject(e))return e;var l=isArray(e);if(l){if(a=initCloneArray(e),!s)return copyArray(e,a)}else{var d=getTag(e),p=d==funcTag||d==genTag;if(isBuffer$1(e))return cloneBuffer(e,s);if(d==objectTag||d==argsTag||p&&!i){if(a=c||p?{}:initCloneObject(e),!s)return c?copySymbolsIn(e,baseAssignIn(a,e)):copySymbols(e,baseAssign(a,e))}else{if(!cloneableTags[d])return i?e:{};a=initCloneByTag(e,d,s)}}o||(o=new Stack);var _=o.get(e);if(_)return _;o.set(e,a),isSet(e)?e.forEach((function(n){a.add(baseClone$1(n,t,r,n,e,o))})):isMap(e)&&e.forEach((function(n,i){a.set(i,baseClone$1(n,t,r,i,e,o))}));var h=l?void 0:(u?c?getAllKeysIn:getAllKeys:c?keysIn:keys)(e);return arrayEach(h||e,(function(n,i){h&&(n=e[i=n]),assignValue(a,i,baseClone$1(n,t,r,i,e,o))})),a}cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=!0,cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=!1;var _baseClone=baseClone$1,baseClone=_baseClone,CLONE_DEEP_FLAG=1,CLONE_SYMBOLS_FLAG=4;function cloneDeep(e){return baseClone(e,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG)}var cloneDeep_1=cloneDeep,cloneDeep$1=getDefaultExportFromCjs$1(cloneDeep_1),_excluded=["bucket"],_excluded2=["bucket","key","uploadId"],_excluded3=["bucket"],_excluded4=["bucket"],_excluded5=["bucket"],_excluded6=["bucket"],_excluded7=["bucket"],_excluded8=["bucket"],_excluded9=["accountId"],_excluded10=["bucket"],_excluded11=["bucket","key","versionId"],TosClientError=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),n=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(n),r.prototype),n}return _createClass(r)}(_wrapNativeSuper(Error)),CancelError=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),n=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(n),r.prototype),n}return _createClass(r)}(_wrapNativeSuper(Error)),TosServerError=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;_classCallCheck(this,r);var i=e.data;return(n=t.call(this,i.Message)).code=void 0,n.data=void 0,n.statusCode=void 0,n.headers=void 0,n.requestId=void 0,n.id2=void 0,Object.setPrototypeOf(_assertThisInitialized(n),r.prototype),n.data=i,n.code=i.Code,n.statusCode=e.status,n.headers=e.headers,n.requestId=e.headers["x-tos-request-id"],n.id2=e.headers["x-tos-id-2"],n}return _createClass(r)}(_wrapNativeSuper(Error)),TosServerCode,TosServerCode2;TosServerCode2=TosServerCode||(TosServerCode={}),TosServerCode2.NoSuchBucket="NoSuchBucket",TosServerCode2.NoSuchKey="NoSuchKey",TosServerCode2.AccessDenied="AccessDenied",TosServerCode2.MalformedAcl="MalformedAclError",TosServerCode2.UnexpectedContent="UnexpectedContent",TosServerCode2.InvalidRequest="InvalidRequest",TosServerCode2.MissingSecurityHeader="MissingSecurityHeader",TosServerCode2.InvalidArgument="InvalidArgument",TosServerCode2.EntityTooSmall="EntityTooSmall",TosServerCode2.InvalidBucketName="InvalidBucketName",TosServerCode2.BucketNotEmpty="BucketNotEmpty",TosServerCode2.TooManyBuckets="TooManyBuckets",TosServerCode2.BucketAlreadyExists="BucketAlreadyExists",TosServerCode2.MalformedBody="MalformedBody",TosServerCode2.NoSuchLifecycleConfiguration="NoSuchLifecycleConfiguration",TosServerCode2.ReplicationConfigurationNotFound="ReplicationConfigurationNotFoundError",TosServerCode2.InvalidLocationConstraint="InvalidLocationConstraint",TosServerCode2.AuthorizationQueryParametersError="AuthorizationQueryParametersError",TosServerCode2.RequestTimeTooSkewed="RequestTimeTooSkewed",TosServerCode2.SignatureDoesNotMatch="SignatureDoesNotMatch",TosServerCode2.RequestedRangeNotSatisfiable="Requested Range Not Satisfiable",TosServerCode2.PreconditionFailed="PreconditionFailed",TosServerCode2.BadDigest="BadDigest",TosServerCode2.InvalidDigest="InvalidDigest",TosServerCode2.EntityTooLarge="EntityTooLarge",TosServerCode2.UnImplemented="UnImplemented",TosServerCode2.MethodNotAllowed="MethodNotAllowed",TosServerCode2.InvalidAccessKeyId="InvalidAccessKeyId",TosServerCode2.InvalidSecurityToken="InvalidSecurityToken",TosServerCode2.ContentSHA256Mismatch="ContentSHA256Mismatch",TosServerCode2.ExceedQPSLimit="ExceedQPSLimit",TosServerCode2.ExceedRateLimit="ExceedRateLimit",TosServerCode2.NoSuchCORSConfiguration="NoSuchCORSConfiguration",TosServerCode2.NoSuchMirrorConfiguration="NoSuchMirrorConfiguration",TosServerCode2.NoSuchWebsiteConfiguration="NoSuchWebsiteConfiguration",TosServerCode2.MissingRequestBody="MissingRequestBodyError",TosServerCode2.BucketAlreadyOwnedByYou="BucketAlreadyOwnedByYou",TosServerCode2.NoSuchBucketPolicy="NoSuchBucketPolicy",TosServerCode2.PolicyTooLarge="PolicyTooLarge",TosServerCode2.MalformedPolicy="MalformedPolicy",TosServerCode2.InvalidKey="InvalidKey",TosServerCode2.MirrorFailed="MirrorFailed",TosServerCode2.Timeout="Timeout",TosServerCode2.OffsetNotMatched="OffsetNotMatched",TosServerCode2.NotAppendable="NotAppendable",TosServerCode2.ContextCanceled="ContextCanceled",TosServerCode2.InternalError="InternalError",TosServerCode2.TooManyRequests="TooManyRequests",TosServerCode2.TimeOut="TimeOut",TosServerCode2.ConcurrencyUpdateObjectLimit="ConcurrencyUpdateObjectLimit",TosServerCode2.DuplicateUpload="DuplicateUpload",TosServerCode2.DuplicateObject="DuplicateObject",TosServerCode2.InvalidVersionId="InvalidVersionId",TosServerCode2.StorageClassNotMatch="StorageClassNotMatch",TosServerCode2.UploadStatusNotUploading="UploadStatusNotUploading",TosServerCode2.PartSizeNotMatch="PartSizeNotMatch",TosServerCode2.NoUploadPart="NoUploadPart",TosServerCode2.PartsLenInvalid="PartsLenInvalid",TosServerCode2.PartsIdxSmall="PartsIdxSmall",TosServerCode2.PartSizeSmall="PartSizeSmall",TosServerCode2.PrefixNotNextKeyPrefix="PrefixNotNextKeyPrefix",TosServerCode2.InvalidPart="InvalidPart",TosServerCode2.InvalidPartOffset="InvalidPartOffset",TosServerCode2.MismatchObject="MismatchObject",TosServerCode2.UploadStatusMismatch="UploadStatusMismatch",TosServerCode2.CompletingStatusNoExpiration="CompletingStatusNoExpiration",TosServerCode2.Found="Found",TosServerCode2.InvalidRedirectLocation="InvalidRedirectLocation";var makeArrayProp=function(e){return function(t){if(null!=e&&"object"===_typeof(e)){var r=e,n=r[t];Array.isArray(n)||(r[t]=null==n?[]:[n])}}},makeConvertProp=function(e){return function t(r){if(Array.isArray(r))return r.map((function(e){return t(e)}));if("string"==typeof r)return e(r);if("object"===_typeof(r)&&null!=r){var n=Object.keys(r).reduce((function(e,n){return e[t(n)]=r[n],e}),{});return n}return r}},covertCamelCase2Kebab=makeConvertProp((function(e){return e.replace(/[A-Z]/g,"-$&").toLowerCase()})),convertNormalCamelCase2Upper=makeConvertProp((function(e){return e[0].toUpperCase()+e.slice(1)})),getSortedQueryString=function(e){var t=[];return Object.keys(e).sort().forEach((function(r){t.push("".concat(encodeURIComponent(r),"=").concat(encodeURIComponent(e[r])))})),t.join("&")},normalizeHeadersKey=function(e){var t=e||{},r={};Object.keys(t).forEach((function(e){null!=t[e]&&(r[e]=t[e])}));var n={};return Object.keys(r).forEach((function(e){var t=e.toLowerCase();n[t]=r[e]})),n},encodeHeadersValue=function(e){var t={};return Object.entries(e).forEach((function(e){var r=_slicedToArray(e,2),n=r[0],i=r[1];t[n]="".concat(i).match(/(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g).map((function(e){return e.length>1||e.charCodeAt(0)>=128?encodeURIComponent(e):e})).join("")})),t},getEndpoint=function(e){return"tos-".concat(e,".volces.com")},normalizeProxy=function(e){var t;return"string"==typeof e&&(e={url:e}),e&&null==(null==(t=e)?void 0:t.needProxyParams)&&(e.needProxyParams=!0),e};function safeAwait(e){return _safeAwait.apply(this,arguments)}function _safeAwait(){return(_safeAwait=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t;case 3:return r=e.sent,e.abrupt("return",[null,r]);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",[e.t0,null]);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function safeSync(e){try{return[null,e()]}catch(err2){return[err2,null]}}function isBlob(e){return"undefined"!=typeof Blob&&e instanceof Blob}function isBuffer(e){return"undefined"!=typeof Buffer&&e instanceof Buffer}function isReadable(e){return!1}function obj2QueryStr(e){return e?Object.keys(e).map((function(t){var r="".concat(e[t]);return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(r))})).join("&"):""}function isCancelError(e){return e instanceof CancelError}var DEFAULT_PART_SIZE=20971520,requestHeadersMap={encodingType:"encoding-type",cacheControl:"cache-control",contentDisposition:"content-disposition",contentEncoding:"content-encoding",contentLanguage:"content-language",contentType:"content-type",expires:["expires",function(e){return e.toUTCString()}],range:"content-range",ifMatch:"if-match",ifModifiedSince:"if-modified-since",ifNoneMatch:"if-none-match",ifUnmodifiedSince:"if-unmodified-since",acl:"x-tos-acl",grantFullControl:"x-tos-grant-full-control",grantRead:"x-tos-grant-read",grantReadAcp:"x-tos-grant-read-acp",grantWrite:"x-tos-grant-write",grantWriteAcp:"x-tos-grant-write-acp",serverSideEncryption:"x-tos-server-side-encryption",ssecAlgorithm:"x-tos-server-side-encryption-customer-algorithm",ssecKey:"x-tos-server-side-encryption-customer-key",ssecKeyMD5:"x-tos-server-side-encryption-customer-key-md5",copySourceIfMatch:"x-tos-copy-source-if-match",copySourceIfModifiedSince:"x-tos-copy-source-if-modified-since",copySourceIfNoneMatch:"x-tos-copy-source-if-none-match",copySourceIfUnmodifiedSince:"x-tos-copy-source-if-unmodified-since",copySourceSSECAlgorithm:"x-tos-copy-source-server-side-encryption-customer-algorithm",copySourceSSECKey:"x-tos-copy-source-server-side-encryption-customer-key",copySourceSSECKeyMD5:"x-tos-copy-source-server-side-encryption-customer-key-MD5",metadataDirective:"x-tos-metadata-directive",meta:function(e){return Object.keys(e).reduce((function(t,r){return t["x-tos-meta-".concat(r)]="".concat(e[r]),t}),{})},websiteRedirectLocation:"x-tos-website-redirect-location",storageClass:"x-tos-storage-class",azRedundancy:"x-tos-az-redundancy",process:"x-tos-process"};function fillRequestHeaders(e,t){if(t.length){var r=e.headers||{};e.headers=r,t.forEach((function(t){var r=requestHeadersMap[t];if(!r)throw new TosClientError("`".concat(t,"` isn't in keys of `requestHeadersMap`"));var i=e[t];if(null!=i){var o="".concat(i);if("string"==typeof r)return n(r,o);if(Array.isArray(r))return n(r[0],r[1](i));var a=r(i);Object.entries(a).forEach((function(e){var t=_slicedToArray(e,2);n(t[0],t[1])}))}}))}function n(e,t){null==r[e]&&(r[e]=t)}}var paramsSerializer=function(e){return qs.stringify(e)};function getNormalDataFromError(e,t){return{data:e,statusCode:t.statusCode,headers:t.headers,requestId:t.requestId,id2:t.id2}}function handleEmptyServerError(e,t){if(e instanceof TosServerError&&404===e.statusCode)return getNormalDataFromError(t,e);throw e}function getEnc(e){switch(e){case"utf-8":return cryptoEncUtf8;case"base64":return cryptoEncBase64;case"hex":return cryptoEncHex;default:throw new TosClientError("The coding is not supported")}}function decode(e,t){return t?e.toString(getEnc(t)):e}var hmacSha256=function(e,t,r){return decode(cryptoHmacSha256(t,e),r)},hashSha256=function(e,t){return decode(cryptoHashSha256(e),t)},hashMd5=function(e,t){if(isBuffer(e))throw new TosClientError("not support buffer in browser environment");return decode(cryptoHashMd5(e),t)},parse=function(e,t){return getEnc(t).parse(e)},stringify=function(e,t){return getEnc(t).stringify(e)},cryptoBrowser={__proto__:null,hmacSha256:hmacSha256,hashSha256:hashSha256,hashMd5:hashMd5,parse:parse,stringify:stringify},crypto$1=null;crypto$1=cryptoBrowser;var _crypto=crypto$1,hmacSha256$1=_crypto.hmacSha256,hashSha256$1=_crypto.hashSha256,hashMd5$1=_crypto.hashMd5,parse$1=_crypto.parse,stringify$1=_crypto.stringify,SIG_QUERY={algorithm:"tos-algorithm",expiration:"tos-expiration",signame:"tos-signame",signature:"tos-signature",v4_algorithm:"X-Tos-Algorithm",v4_credential:"X-Tos-Credential",v4_date:"X-Tos-Date",v4_expires:"X-Tos-Expires",v4_signedHeaders:"X-Tos-SignedHeaders",v4_security_token:"X-Tos-Security-Token",v4_signature:"X-Tos-Signature",v4_content_sha:"X-Tos-Content-Sha256",v4_policy:"X-Tos-Policy"};function isDefaultPort(e){return!e||80===e||443===e}var v4Identifier="request",SignersV4=function(){function e(t,r){var n=this;_classCallCheck(this,e),this.options=void 0,this.credentials=void 0,this.signature=function(e,t,r){r||(r=n.credentials);var i=[],o=e.datetime,a=n.credentialString(o);return i.push(n.options.algorithm+" Credential="+r.GetAccessKey()+"/"+a),i.push("SignedHeaders="+n.signedHeaders(e)),i.push("Signature="+n.authorization(e,r,0)),i.join(", ")},this.signatureHeader=function(e,t,r){e.datetime=n.getDateTime();var i=new Map;if(!e.headers){e.headers={}}e.headers.host="".concat(e.host),isDefaultPort(e.port)||(e.headers.host+=":"+e.port),e.endpoints&&(e.headers.host="".concat(n.options.bucket,".").concat(e.endpoints)),i.set("host",e.headers.host),i.set("x-tos-date",e.datetime),i.set("x-tos-content-sha256",n.hexEncodedBodyHash()),n.options.securityToken&&i.set("x-tos-security-token",n.options.securityToken),i.forEach((function(t,r){r.startsWith("x-tos")&&(e.headers[r]=t)})),e.path=n.getEncodePath(e.path);var o=n.signature(e,0,r);return i.set("authorization",o),i},this.gnrCopySig=function(e,t){return{key:"",value:""}},this.getSignature=function(e,t){return{key:"",value:""}},this.getSignatureQuery=function(e,t){var r;if(e.datetime=n.getDateTime(),!e.headers){e.headers={}}e.headers.host="".concat(e.host),isDefaultPort(e.port)||(e.headers.host+=":"+e.port),e.path=n.getEncodePath(e.path),e.endpoints&&(e.headers.host="".concat(n.options.bucket,".").concat(e.endpoints)),e.headers[SIG_QUERY.v4_date]=e.datetime;var i=n.credentialString(e.datetime),o=_objectSpread2(_objectSpread2({},e.query||{}),{},(_defineProperty$1(r={},SIG_QUERY.v4_algorithm,n.options.algorithm),_defineProperty$1(r,SIG_QUERY.v4_content_sha,n.hexEncodedBodyHash()),_defineProperty$1(r,SIG_QUERY.v4_credential,n.credentials.GetAccessKey()+"/"+i),_defineProperty$1(r,SIG_QUERY.v4_date,e.datetime),_defineProperty$1(r,SIG_QUERY.v4_expires,""+t),_defineProperty$1(r,SIG_QUERY.v4_signedHeaders,n.signedHeaders(e)),r));return n.options.securityToken&&(o[SIG_QUERY.v4_security_token]=n.options.securityToken),e.query=getSortedQueryString(o),o[SIG_QUERY.v4_signature]=n.authorization(e,n.credentials,t),o},this.getSignaturePolicyQuery=function(e,t){var r;e.datetime=n.getDateTime();var i=n.credentialString(e.datetime),o=(_defineProperty$1(r={},SIG_QUERY.v4_algorithm,n.options.algorithm),_defineProperty$1(r,SIG_QUERY.v4_credential,n.credentials.GetAccessKey()+"/"+i),_defineProperty$1(r,SIG_QUERY.v4_date,e.datetime),_defineProperty$1(r,SIG_QUERY.v4_expires,""+t),_defineProperty$1(r,SIG_QUERY.v4_policy,stringify$1(parse$1(JSON.stringify(e.policy),"utf-8"),"base64")),r);return n.options.securityToken&&(o[SIG_QUERY.v4_security_token]=n.options.securityToken),e.query=getSortedQueryString(o),o[SIG_QUERY.v4_signature]=n.authorization(e,n.credentials,t),o},this.hexEncodedBodyHash=function(){return"UNSIGNED-PAYLOAD"},this.authorization=function(e,t,r){if(!e.datetime)return"";var i=n.getSigningKey(t,e.datetime.substr(0,8));return hmacSha256$1(i,n.stringToSign(e.datetime,e),"hex")},this.getDateTime=function(){return new Date((new Date).toUTCString()).toISOString().replace(/\..+/,"").replace(/-/g,"").replace(/:/g,"")+"Z"},this.credentialString=function(e){return n.createScope(e.substr(0,8),n.options.region,n.options.serviceName)},this.createScope=function(e,t,r){return[e.substr(0,8),t,r,v4Identifier].join("/")},this.getSigningKey=function(e,t){var r=hmacSha256$1(e.GetSecretKey(),t),i=hmacSha256$1(r,n.options.region),o=hmacSha256$1(i,n.options.serviceName);return hmacSha256$1(o,v4Identifier)},this.stringToSign=function(e,t){if(!n.options.algorithm)return"";var r=[];r.push(n.options.algorithm),r.push(e),r.push(n.credentialString(e));var i="policy"in t?n.canonicalStringPolicy(t):n.canonicalString(t);return r.push(n.hexEncodedHash(i)),r.join("\n")},this.hexEncodedHash=function(e){return hashSha256$1(e,"hex")},this.canonicalString=function(e){var t=[];return t.push(e.method),t.push(e.path),t.push(n.getEncodePath(e.query,!1)),t.push(n.canonicalHeaders(e)+"\n"),t.push(n.signedHeaders(e)),t.push(n.hexEncodedBodyHash()),t.join("\n")},this.canonicalStringPolicy=function(e){var t=[];return t.push(n.getEncodePath(e.query,!1)),t.push(n.hexEncodedBodyHash()),t.join("\n")},this.canonicalHeaders=function(e){var t,r=[],i=_createForOfIteratorHelper(getNeedSignedHeaders(e.headers));try{for(i.s();!(t=i.n()).done;){var o=t.value,a=e.headers[o];o=o.toLowerCase(),r.push(o+":"+n.canonicalHeaderValues(a.toString()))}}catch(err2){i.e(err2)}finally{i.f()}return r.join("\n")},this.canonicalHeaderValues=function(e){return e.replace(/\s+/g," ").replace(/^\s+|\s+$/g,"")},this.signedHeaders=function(e){var t,r=[],n=_createForOfIteratorHelper(getNeedSignedHeaders(e.headers));try{for(n.s();!(t=n.n()).done;){var i=t.value;i=i.toLowerCase(),r.push(i)}}catch(err2){n.e(err2)}finally{n.f()}return r.sort().join(";")},this.options=t,this.credentials=r}return _createClass(e,[{key:"getEncodePath",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e)return"";var r=e;return t&&(r=e.replace(/%2F/g,"/")),r=(r=(r=(r=(r=r.replace(/\(/g,"%28")).replace(/\)/g,"%29")).replace(/!/g,"%21")).replace(/\*/g,"%2A")).replace(/\'/g,"%27")}}]),e}(),ISigV4Credentials=function(){function e(t,r,n){_classCallCheck(this,e),this.securityToken=void 0,this.secretAccessKey=void 0,this.accessKeyId=void 0,this.accessKeyId=n,this.secretAccessKey=r,this.securityToken=t}return _createClass(e,[{key:"GetAccessKey",value:function(){return this.accessKeyId}},{key:"GetSecretKey",value:function(){return this.secretAccessKey}}]),e}();function getNeedSignedHeaders(e){var t=[];return Object.keys(e||{}).forEach((function(r){("host"===r||r.startsWith("x-tos-"))&&null!=e[r]&&t.push(r)})),t.sort()}var version="2.6.0",mimeTypes={"3gp":"video/3gpp","7z":"application/x-7z-compressed",abw:"application/x-abiword",ai:"application/postscript",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",alc:"chemical/x-alchemy",amr:"audio/amr",anx:"application/annodex",apk:"application/vnd.android.package-archive",appcache:"text/cache-manifest",art:"image/x-jg",asc:"text/plain",asf:"video/x-ms-asf",aso:"chemical/x-ncbi-asn1-binary",asx:"video/x-ms-asf",atom:"application/atom+xml",atomcat:"application/atomcat+xml",atomsrv:"application/atomserv+xml",au:"audio/basic",avi:"video/x-msvideo",awb:"audio/amr-wb",axa:"audio/annodex",axv:"video/annodex",b:"chemical/x-molconn-Z",bak:"application/x-trash",bat:"application/x-msdos-program",bcpio:"application/x-bcpio",bib:"text/x-bibtex",bin:"application/octet-stream",bmp:"image/x-ms-bmp",boo:"text/x-boo",book:"application/x-maker",brf:"text/plain",bsd:"chemical/x-crossfire",c:"text/x-csrc","c++":"text/x-c++src",c3d:"chemical/x-chem3d",cab:"application/x-cab",cac:"chemical/x-cache",cache:"chemical/x-cache",cap:"application/vnd.tcpdump.pcap",cascii:"chemical/x-cactvs-binary",cat:"application/vnd.ms-pki.seccat",cbin:"chemical/x-cactvs-binary",cbr:"application/x-cbr",cbz:"application/x-cbz",cc:"text/x-c++src",cda:"application/x-cdf",cdf:"application/x-cdf",cdr:"image/x-coreldraw",cdt:"image/x-coreldrawtemplate",cdx:"chemical/x-cdx",cdy:"application/vnd.cinderella",cef:"chemical/x-cxf",cer:"chemical/x-cerius",chm:"chemical/x-chemdraw",chrt:"application/x-kchart",cif:"chemical/x-cif",class:"application/java-vm",cls:"text/x-tex",cmdf:"chemical/x-cmdf",cml:"chemical/x-cml",cod:"application/vnd.rim.cod",com:"application/x-msdos-program",cpa:"chemical/x-compass",cpio:"application/x-cpio",cpp:"text/x-c++src",cpt:"application/mac-compactpro",cr2:"image/x-canon-cr2",crl:"application/x-pkcs7-crl",crt:"application/x-x509-ca-cert",crw:"image/x-canon-crw",csd:"audio/csound",csf:"chemical/x-cache-csf",csh:"application/x-csh",csm:"chemical/x-csml",csml:"chemical/x-csml",css:"text/css",csv:"text/csv",ctab:"chemical/x-cactvs-binary",ctx:"chemical/x-ctx",cu:"application/cu-seeme",cub:"chemical/x-gaussian-cube",cxf:"chemical/x-cxf",cxx:"text/x-c++src",d:"text/x-dsrc",davmount:"application/davmount+xml",dcm:"application/dicom",dcr:"application/x-director",ddeb:"application/vnd.debian.binary-package",dif:"video/dv",diff:"text/x-diff",dir:"application/x-director",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dl:"video/dl",dll:"application/x-msdos-program",dmg:"application/x-apple-diskimage",dms:"application/x-dms",doc:"application/msword",docm:"application/vnd.ms-word.document.macroEnabled.12",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dot:"application/msword",dotm:"application/vnd.ms-word.template.macroEnabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",dv:"video/dv",dvi:"application/x-dvi",dx:"chemical/x-jcamp-dx",dxr:"application/x-director",emb:"chemical/x-embl-dl-nucleotide",embl:"chemical/x-embl-dl-nucleotide",eml:"message/rfc822",eot:"application/vnd.ms-fontobject",eps:"application/postscript",eps2:"application/postscript",eps3:"application/postscript",epsf:"application/postscript",epsi:"application/postscript",erf:"image/x-epson-erf",es:"application/ecmascript",etx:"text/x-setext",exe:"application/x-msdos-program",ez:"application/andrew-inset",fb:"application/x-maker",fbdoc:"application/x-maker",fch:"chemical/x-gaussian-checkpoint",fchk:"chemical/x-gaussian-checkpoint",fig:"application/x-xfig",flac:"audio/flac",fli:"video/fli",flv:"video/x-flv",fm:"application/x-maker",frame:"application/x-maker",frm:"application/x-maker",gal:"chemical/x-gaussian-log",gam:"chemical/x-gamess-input",gamin:"chemical/x-gamess-input",gan:"application/x-ganttproject",gau:"chemical/x-gaussian-input",gcd:"text/x-pcs-gcd",gcf:"application/x-graphing-calculator",gcg:"chemical/x-gcg8-sequence",gen:"chemical/x-genbank",gf:"application/x-tex-gf",gif:"image/gif",gjc:"chemical/x-gaussian-input",gjf:"chemical/x-gaussian-input",gl:"video/gl",gnumeric:"application/x-gnumeric",gpt:"chemical/x-mopac-graph",gsf:"application/x-font",gsm:"audio/x-gsm",gtar:"application/x-gtar",gz:"application/gzip",h:"text/x-chdr","h++":"text/x-c++hdr",hdf:"application/x-hdf",hh:"text/x-c++hdr",hin:"chemical/x-hin",hpp:"text/x-c++hdr",hqx:"application/mac-binhex40",hs:"text/x-haskell",hta:"application/hta",htc:"text/x-component",htm:"text/html",html:"text/html",hwp:"application/x-hwp",hxx:"text/x-c++hdr",ica:"application/x-ica",ice:"x-conference/x-cooltalk",ico:"image/vnd.microsoft.icon",ics:"text/calendar",icz:"text/calendar",ief:"image/ief",iges:"model/iges",igs:"model/iges",iii:"application/x-iphone",info:"application/x-info",inp:"chemical/x-gamess-input",ins:"application/x-internet-signup",iso:"application/x-iso9660-image",isp:"application/x-internet-signup",ist:"chemical/x-isostar",istr:"chemical/x-isostar",jad:"text/vnd.sun.j2me.app-descriptor",jam:"application/x-jam",jar:"application/java-archive",java:"text/x-java",jdx:"chemical/x-jcamp-dx",jmz:"application/x-jmol",jng:"image/x-jng",jnlp:"application/x-java-jnlp-file",jp2:"image/jp2",jpe:"image/jpeg",jpeg:"image/jpeg",jpf:"image/jpx",jpg:"image/jpeg",jpg2:"image/jp2",jpm:"image/jpm",jpx:"image/jpx",js:"application/javascript",json:"application/json",kar:"audio/midi",key:"application/pgp-keys",kil:"application/x-killustrator",kin:"chemical/x-kinemage",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz",kpr:"application/x-kpresenter",kpt:"application/x-kpresenter",ksp:"application/x-kspread",kwd:"application/x-kword",kwt:"application/x-kword",latex:"application/x-latex",lha:"application/x-lha",lhs:"text/x-literate-haskell",lin:"application/bbolin",lsf:"video/x-la-asf",lsx:"video/x-la-asf",ltx:"text/x-tex",ly:"text/x-lilypond",lyx:"application/x-lyx",lzh:"application/x-lzh",lzx:"application/x-lzx",m3g:"application/m3g",m3u:"audio/x-mpegurl",m3u8:"application/x-mpegURL",m4a:"audio/mpeg",maker:"application/x-maker",man:"application/x-troff-man",mbox:"application/mbox",mcif:"chemical/x-mmcif",mcm:"chemical/x-macmolecule",mdb:"application/msaccess",me:"application/x-troff-me",mesh:"model/mesh",mid:"audio/midi",midi:"audio/midi",mif:"application/x-mif",mkv:"video/x-matroska",mm:"application/x-freemind",mmd:"chemical/x-macromodel-input",mmf:"application/vnd.smaf",mml:"text/mathml",mmod:"chemical/x-macromodel-input",mng:"video/x-mng",moc:"text/x-moc",mol:"chemical/x-mdl-molfile",mol2:"chemical/x-mol2",moo:"chemical/x-mopac-out",mop:"chemical/x-mopac-input",mopcrt:"chemical/x-mopac-input",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpc:"chemical/x-mopac-input",mpe:"video/mpeg",mpeg:"video/mpeg",mpega:"audio/mpeg",mpg:"video/mpeg",mpga:"audio/mpeg",mph:"application/x-comsol",mpv:"video/x-matroska",ms:"application/x-troff-ms",msh:"model/mesh",msi:"application/x-msi",mvb:"chemical/x-mopac-vib",mxf:"application/mxf",mxu:"video/vnd.mpegurl",nb:"application/mathematica",nbp:"application/mathematica",nc:"application/x-netcdf",nef:"image/x-nikon-nef",nwc:"application/x-nwc",o:"application/x-object",oda:"application/oda",odb:"application/vnd.oasis.opendocument.database",odc:"application/vnd.oasis.opendocument.chart",odf:"application/vnd.oasis.opendocument.formula",odg:"application/vnd.oasis.opendocument.graphics",odi:"application/vnd.oasis.opendocument.image",odm:"application/vnd.oasis.opendocument.text-master",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogg:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",old:"application/x-trash",one:"application/onenote",onepkg:"application/onenote",onetmp:"application/onenote",onetoc2:"application/onenote",opf:"application/oebps-package+xml",opus:"audio/ogg",orc:"audio/csound",orf:"image/x-olympus-orf",otf:"application/font-sfnt",otg:"application/vnd.oasis.opendocument.graphics-template",oth:"application/vnd.oasis.opendocument.text-web",otp:"application/vnd.oasis.opendocument.presentation-template",ots:"application/vnd.oasis.opendocument.spreadsheet-template",ott:"application/vnd.oasis.opendocument.text-template",oza:"application/x-oz-application",p:"text/x-pascal",p7r:"application/x-pkcs7-certreqresp",pac:"application/x-ns-proxy-autoconfig",pas:"text/x-pascal",pat:"image/x-coreldrawpattern",patch:"text/x-diff",pbm:"image/x-portable-bitmap",pcap:"application/vnd.tcpdump.pcap",pcf:"application/x-font-pcf","pcf.Z":"application/x-font-pcf",pcx:"image/pcx",pdb:"chemical/x-pdb",pdf:"application/pdf",pfa:"application/x-font",pfb:"application/x-font",pfr:"application/font-tdpfr",pgm:"image/x-portable-graymap",pgn:"application/x-chess-pgn",pgp:"application/pgp-encrypted",php:"#application/x-httpd-php",php3:"#application/x-httpd-php3",php3p:"#application/x-httpd-php3-preprocessed",php4:"#application/x-httpd-php4",php5:"#application/x-httpd-php5",phps:"#application/x-httpd-php-source",pht:"#application/x-httpd-php",phtml:"#application/x-httpd-php",pk:"application/x-tex-pk",pl:"text/x-perl",pls:"audio/x-scpls",pm:"text/x-perl",png:"image/png",pnm:"image/x-portable-anymap",pot:"text/plain",potm:"application/vnd.ms-powerpoint.template.macroEnabled.12",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",ppam:"application/vnd.ms-powerpoint.addin.macroEnabled.12",ppm:"image/x-portable-pixmap",pps:"application/vnd.ms-powerpoint",ppsm:"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppt:"application/vnd.ms-powerpoint",pptm:"application/vnd.ms-powerpoint.presentation.macroEnabled.12",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",prf:"application/pics-rules",prt:"chemical/x-ncbi-asn1-ascii",ps:"application/postscript",psd:"image/x-photoshop",py:"text/x-python",pyc:"application/x-python-code",pyo:"application/x-python-code",qgs:"application/x-qgis",qt:"video/quicktime",qtl:"application/x-quicktimeplayer",ra:"audio/x-pn-realaudio",ram:"audio/x-pn-realaudio",rar:"application/rar",ras:"image/x-cmu-raster",rb:"application/x-ruby",rd:"chemical/x-mdl-rdfile",rdf:"application/rdf+xml",rdp:"application/x-rdp",rgb:"image/x-rgb",rhtml:"#application/x-httpd-eruby",rm:"audio/x-pn-realaudio",roff:"application/x-troff",ros:"chemical/x-rosdal",rpm:"application/x-redhat-package-manager",rss:"application/x-rss+xml",rtf:"application/rtf",rtx:"text/richtext",rxn:"chemical/x-mdl-rxnfile",scala:"text/x-scala",sce:"application/x-scilab",sci:"application/x-scilab",sco:"audio/csound",scr:"application/x-silverlight",sct:"text/scriptlet",sd:"chemical/x-mdl-sdfile",sd2:"audio/x-sd2",sda:"application/vnd.stardivision.draw",sdc:"application/vnd.stardivision.calc",sdd:"application/vnd.stardivision.impress",sds:"application/vnd.stardivision.chart",sdw:"application/vnd.stardivision.writer",ser:"application/java-serialized-object",sfd:"application/vnd.font-fontforge-sfd",sfv:"text/x-sfv",sgf:"application/x-go-sgf",sgl:"application/vnd.stardivision.writer-global",sh:"application/x-sh",shar:"application/x-shar",shp:"application/x-qgis",shtml:"text/html",shx:"application/x-qgis",sid:"audio/prs.sid",sig:"application/pgp-signature",sik:"application/x-trash",silo:"model/mesh",sis:"application/vnd.symbian.install",sisx:"x-epoc/x-sisx-app",sit:"application/x-stuffit",sitx:"application/x-stuffit",skd:"application/x-koan",skm:"application/x-koan",skp:"application/x-koan",skt:"application/x-koan",sldm:"application/vnd.ms-powerpoint.slide.macroEnabled.12",sldx:"application/vnd.openxmlformats-officedocument.presentationml.slide",smi:"application/smil+xml",smil:"application/smil+xml",snd:"audio/basic",spc:"chemical/x-galactic-spc",spl:"application/x-futuresplash",spx:"audio/ogg",sql:"application/x-sql",src:"application/x-wais-source",srt:"text/plain",stc:"application/vnd.sun.xml.calc.template",std:"application/vnd.sun.xml.draw.template",sti:"application/vnd.sun.xml.impress.template",stw:"application/vnd.sun.xml.writer.template",sty:"text/x-tex",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",svgz:"image/svg+xml",sw:"chemical/x-swissprot",swf:"application/x-shockwave-flash",swfl:"application/x-shockwave-flash",sxc:"application/vnd.sun.xml.calc",sxd:"application/vnd.sun.xml.draw",sxg:"application/vnd.sun.xml.writer.global",sxi:"application/vnd.sun.xml.impress",sxm:"application/vnd.sun.xml.math",sxw:"application/vnd.sun.xml.writer",t:"application/x-troff",tar:"application/x-tar",taz:"application/x-gtar-compressed",tcl:"application/x-tcl",tex:"text/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",text:"text/plain",tgf:"chemical/x-mdl-tgf",tgz:"application/x-gtar-compressed",thmx:"application/vnd.ms-officetheme",tif:"image/tiff",tiff:"image/tiff",tk:"text/x-tcl",tm:"text/texmacs",torrent:"application/x-bittorrent",tr:"application/x-troff",ts:"video/MP2T",tsp:"application/dsptype",tsv:"text/tab-separated-values",ttf:"application/font-sfnt",ttl:"text/turtle",txt:"text/plain",uls:"text/iuls",ustar:"application/x-ustar",val:"chemical/x-ncbi-asn1-binary",vcard:"text/vcard",vcd:"application/x-cdlink",vcf:"text/vcard",vcs:"text/x-vcalendar",vmd:"chemical/x-vmd",vms:"chemical/x-vamas-iso14976",vrm:"x-world/x-vrml",vrml:"model/vrml",vsd:"application/vnd.visio",vss:"application/vnd.visio",vst:"application/vnd.visio",vsw:"application/vnd.visio",wad:"application/x-doom",wasm:"application/wasm",wav:"audio/wav",wax:"audio/x-ms-wax",wbmp:"image/vnd.wap.wbmp",wbxml:"application/vnd.wap.wbxml",webm:"video/webm",wk:"application/x-123",wm:"video/x-ms-wm",wma:"audio/x-ms-wma",wmd:"application/x-ms-wmd",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlscript",wmlsc:"application/vnd.wap.wmlscriptc",wmv:"video/x-ms-wmv",wmx:"video/x-ms-wmx",wmz:"application/x-ms-wmz",woff:"application/font-woff",wp5:"application/vnd.wordperfect5.1",wpd:"application/vnd.wordperfect",wrl:"model/vrml",wsc:"text/scriptlet",wvx:"video/x-ms-wvx",wz:"application/x-wingz",x3d:"model/x3d+xml",x3db:"model/x3d+binary",x3dv:"model/x3d+vrml",xbm:"image/x-xbitmap",xcf:"application/x-xcf",xcos:"application/x-scilab-xcos",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xlam:"application/vnd.ms-excel.addin.macroEnabled.12",xlb:"application/vnd.ms-excel",xls:"application/vnd.ms-excel",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.12",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.12",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xlt:"application/vnd.ms-excel",xltm:"application/vnd.ms-excel.template.macroEnabled.12",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xml:"application/xml",xpi:"application/x-xpinstall",xpm:"image/x-xpixmap",xsd:"application/xml",xsl:"application/xslt+xml",xslt:"application/xslt+xml",xspf:"application/xspf+xml",xtel:"chemical/x-xtel",xul:"application/vnd.mozilla.xul+xml",xwd:"image/x-xwindowdump",xyz:"chemical/x-xyz",xz:"application/x-xz",zip:"application/zip"},CRC=function(){function e(){_classCallCheck(this,e)}var t,r;return _createClass(e,[{key:"reset",value:function(){}},{key:"updateBlob",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"finalBlob",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"update",value:function(e){}},{key:"final",value:function(){}},{key:"toString",value:function(){return""}},{key:"equalsTo",value:function(e){return!0}}]),e}(),browserCRC={__proto__:null,CRC:CRC},crcModule=null;crcModule=browserCRC;var _crcModule=crcModule,CRC$1=_crcModule.CRC,getObjectInputKey=function(e){return"string"==typeof e?e:e.key},DEFAULT_CONTENT_TYPE="application/octet-stream";function lookupMimeType(e){var t=e.lastIndexOf(".");if(!(t<=0)){var r=e.slice(t+1).toLowerCase();return mimeTypes[r]}}function validateObjectName(e){if(("string"==typeof e?e:e.key).length<1)throw new TosClientError("invalid object name, the length must greater than 1")}function getSize(e,t){if(isBuffer(e))return e.length;if(isBlob(e))return e.size;if(t&&t["content-length"]){var r=+t["content-length"];if(r>=0)return r}return null}function getEmitReadBodyConfig(e){var t=e.body;e.totalSize,e.dataTransferCallback,e.makeRetryStream;var r=t;return{body:r,makeRetryStream:void 0}}function getCRCBodyConfig(e){return _getCRCBodyConfig.apply(this,arguments)}function _getCRCBodyConfig(){return _getCRCBodyConfig=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.body,n=t.beforeRetry,i=t.makeRetryStream,t.enableCRC,e.abrupt("return",{body:r,beforeRetry:n,makeRetryStream:i});case 3:if(o=new CRC$1,!isReadable()){e.next=9;break}r.on("data",(function(e){o.update(e)})),r.pause(),e.next=15;break;case 9:if(!isBlob(r)){e.next=14;break}return e.next=12,o.updateBlob(r);case 12:e.next=15;break;case 14:o.update(r);case 15:return e.abrupt("return",{body:r,beforeRetry:function(){o.reset(),null==n||n()},makeRetryStream:i,crc:o});case 16:case"end":return e.stop()}}),e)}))),_getCRCBodyConfig.apply(this,arguments)}function getNewBodyConfig(e){return _getNewBodyConfig.apply(this,arguments)}function _getNewBodyConfig(){return(_getNewBodyConfig=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=getEmitReadBodyConfig(t),t=_objectSpread2(_objectSpread2({},t),r),n=getCRCBodyConfig(t),e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function getCopySourceHeaderValue(e,t){return"/".concat(e,"/").concat(encodeURIComponent(t))}var retryNamespace="__retryConfig__";function isNetworkError(e){var t;return!e.response&&Boolean(e.code)||e.response&&!(null!=(t=e.response.headers)&&t["x-tos-request-id"])}function isCanRetryStatusCode(e){if(!e.response)return!1;var t=e.response.status;return 429===t||t>=500}var BROWSER_NEED_DELETE_HEADERS=["content-length","user-agent","host"],makeAxiosInst=function(e){var t=axios$1.create();t.defaults.maxRedirects=0,t.interceptors.request.use((function(e){return e.headers?(Object.keys(e.headers).forEach((function(t){BROWSER_NEED_DELETE_HEADERS.includes(t.toLowerCase())&&delete e.headers[t]})),e):e}));var r=function(e){var t;return e.headers=e.headers||e.header||(null==e||null==(t=e.response)?void 0:t.headers)||{},e};function n(e){Object.entries(e).forEach((function(t){var r=_slicedToArray(t,2),n=r[0],i=r[1],o=_slicedToArray(safeSync((function(){return decodeURI(i)})),2),a=o[0],s=o[1];if(!a&&null!=s&&s!==i){for(var c=[],u="".concat(i).match(/(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g),l=s.match(/(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g),d=0,p=0;d<l.length;){var _=l[d];if(_!==u[p]){var h=encodeURIComponent(_);_.length>1||_.charCodeAt(0)>=128?c.push(_):c.push(h),++d,p+=h.length}else c.push(_),++d,++p}e[n]=c.join("")}}))}return t.interceptors.response.use(r,(function(e){return r(e),Promise.reject(e)})),t.interceptors.response.use((function(e){return e.headers?(n(e.headers),e):e}),function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(axios$1.isAxiosError(t)){e.next=2;break}return e.abrupt("return",Promise.reject(t));case 2:if(i=null==(r=t.response)?void 0:r.headers){e.next=5;break}return e.abrupt("return",Promise.reject(t));case 5:return n(i),e.abrupt("return",Promise.reject(t));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.interceptors.response.use(void 0,function(){var r=_asyncToGenerator(_regeneratorRuntime().mark((function r(n){var i,o,a,s,c,u;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=n.config){r.next=3;break}return r.abrupt("return",Promise.reject(n));case 3:if(o[retryNamespace]||(o[retryNamespace]={}),a=o[retryNamespace],s=null!=(i=a.retryCount)?i:0,c=o.data,!0,(isNetworkError(n)||isCanRetryStatusCode(n))&&s<e&&true){r.next=11;break}return r.abrupt("return",Promise.reject(n));case 11:return u=_objectSpread2(_objectSpread2({},o),{},_defineProperty$1({data:c},retryNamespace,_objectSpread2(_objectSpread2({},a),{},{retryCount:s+1}))),null==a.beforeRetry||a.beforeRetry(),r.abrupt("return",t(u));case 14:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()),t},TOS=createDebug("TOS"),chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function encoder(e){for(var t,r,n=String(e),i=0,o=chars,a="";n.charAt(0|i)||(o="=",i%1);a+=o.charAt(63&t>>8-i%1*8)){if((r=n.charCodeAt(i+=3/4))>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");t=t<<8|r}return a}var platFormName="wechat";function getRequest(){switch(!0){case"object"===("undefined"==typeof wx?"undefined":_typeof(wx)):return platFormName="wechat",wx.request.bind(wx);case"object"===("undefined"==typeof swan?"undefined":_typeof(swan)):return platFormName="baidu",swan.request.bind(swan);case"object"===("undefined"==typeof dd?"undefined":_typeof(dd)):return platFormName="dd",dd.httpRequest.bind(dd);case"object"===("undefined"==typeof my?"undefined":_typeof(my)):return platFormName="alipay",(my.request||my.httpRequest).bind(my);default:return wx.request.bind(wx)}}function transformResponse(e,t,r){var n=e.header||e.headers,i=e.statusCode||e.status,o="";return 200===i?o="OK":400===i&&(o="Bad Request"),{data:e.data,status:i,statusText:o,headers:n,config:t,request:r}}function transformError(e,t,r){switch(platFormName){case"wechat":-1!==e.errMsg.indexOf("request:fail abort")?t(createError$2("Request aborted",r,"ECONNABORTED","")):-1!==e.errMsg.indexOf("timeout")?t(createError$2("timeout of "+r.timeout+"ms exceeded",r,"ECONNABORTED","")):t(createError$2("Network Error",r,null,""));break;case"dd":case"alipay":[14,19].includes(e.error)?t(createError$2("Request aborted",r,"ECONNABORTED","",e)):[13].includes(e.error)?t(createError$2("timeout of "+r.timeout+"ms exceeded",r,"ECONNABORTED","",e)):t(createError$2("Network Error",r,null,"",e));break;case"baidu":t(createError$2("Network Error",r,null,""))}}function transformConfig(e){var t;["alipay","dd"].includes(platFormName)&&(e.headers=e.header,delete e.header,"dd"===platFormName&&"GET"!==e.method&&"application/json"===(null==(t=e.headers)?void 0:t["Content-Type"])&&"[object Object]"===Object.prototype.toString.call(e.data)&&(e.data=JSON.stringify(e.data)));return e}var isJSONstr=function(e){try{return"string"==typeof e&&e.length&&(e=JSON.parse(e))&&"[object Object]"===Object.prototype.toString.call(e)}catch(t){return!1}};function mpAdapter(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.transformRequestOption,n=void 0===r?function(e){return e}:r,i=getRequest();return new Promise((function(t,r){var o,a=e.data,s=e.headers,c={method:e.method&&e.method.toUpperCase()||"GET",url:buildURL$4(buildFullPath$3(e.baseURL,e.url),e.params,e.paramsSerializer),timeout:e.timeout,success:function(n){var i=transformResponse(n,e,c);settle$3(t,r,i)},fail:function(t){transformError(t,r,e)},complete:function(){o=void 0}};if(e.auth){var u=e.auth.username||"",l=e.auth.password||"";s.Authorization="Basic "+encoder(u+":"+l)}utils$d.forEach(s,(function(e,t){var r=t.toLowerCase();(void 0===a&&"content-type"===r||"referer"===r)&&delete s[t]})),c.header=s,e.responseType&&(c.responseType=e.responseType),e.cancelToken&&e.cancelToken.promise.then((function(e){o&&(o.abort(),r(e),o=void 0)})),isJSONstr(a)&&(a=JSON.parse(a)),void 0!==a&&(c.data=a),o=i(n(transformConfig(c)))}))}var TOSBase=function(){function e(t){var r=this;_classCallCheck(this,e),this.opts=void 0,this.axiosInst=void 0,this.userAgent=void 0,this.httpAgent=void 0,this.httpsAgent=void 0,this.getObjectPath=function(e){var t="string"!=typeof e&&e.bucket||r.opts.bucket,n="string"==typeof e?e:e.key;if(!t)throw new TosClientError("Must provide bucket param");return"/".concat(t,"/").concat(encodeURIComponent(n))},this.setObjectContentTypeHeader=function(e,t){if(null==t["content-type"]){var n=DEFAULT_CONTENT_TYPE,i=getObjectInputKey(e);r.opts.autoRecognizeContentType&&(n=lookupMimeType(i)||n),n&&(t["content-type"]=n)}},this.getNormalDataFromError=getNormalDataFromError,this.opts=this.normalizeOpts(t),this.userAgent=this.getUserAgent(),this.axiosInst=makeAxiosInst(this.opts.maxRetryCount)}var t,r,n;return _createClass(e,[{key:"normalizeOpts",value:function(e){var t,r,n=["accessKeyId","accessKeySecret","region"].filter((function(t){return!e[t]})).join(", ");if(n)throw new TosClientError("lack params: ".concat(n,"."));var i=e.endpoint||getEndpoint(e.region);if(!i)throw new TosClientError("the value of param region is invalid, correct values are cn-beijing, cn-nantong etc.");if(i.includes("s3"))throw new TosClientError("do not support s3 endpoint, please use tos endpoint.");var o=null==e.secure||!!e.secure,a=function(e,t){return null==e?t:e};if(null!=(t=e.enableCRC)&&t)throw new TosClientError("not support crc in browser environment");return _objectSpread2(_objectSpread2({},e),{},{endpoint:i,secure:o,enableVerifySSL:a(e.enableVerifySSL,!0),autoRecognizeContentType:a(e.autoRecognizeContentType,!0),requestTimeout:a(e.requestTimeout,12e4),connectionTimeout:a(e.connectionTimeout,1e4),maxConnections:a(e.maxConnections,1024),idleConnectionTime:a(e.idleConnectionTime,6e4),maxRetryCount:a(e.maxRetryCount,3),enableCRC:null!=(r=e.enableCRC)&&r,requestAdapter:getAdapter()})}},{key:"getUserAgent",value:function(){return"tos-".concat("js","-sdk/").concat(version)}},{key:"fetch",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i,o,a){var s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R,C,k,I=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=(null==a?void 0:a.handleResponse)||function(e){return e.data},c=(null==a?void 0:a.needMd5)||!1,o&&c&&(u=hashMd5$1(JSON.stringify(o),"base64"),i["content-md5"]=u),l=null!=a&&a.subdomainBucket?/^(\d|:)/.test(I.opts.endpoint)?[I.opts.endpoint,"/".concat(a.subdomainBucket).concat(r)]:["".concat(null==a?void 0:a.subdomainBucket,".").concat(I.opts.endpoint),r]:[I.opts.endpoint,r],d=_slicedToArray(l,2),p=d[0],_=d[1],r=_,i=encodeHeadersValue(i),h={endpoints:void 0,bucket:"",method:t,headers:_objectSpread2({},i),path:r,query:getSortedQueryString(n),host:p},f=new ISigV4Credentials(this.opts.stsToken,this.opts.accessKeySecret,this.opts.accessKeyId),m=new SignersV4({algorithm:"TOS4-HMAC-SHA256",region:this.opts.region,serviceName:"tos",bucket:"",securityToken:this.opts.stsToken},f),g=m.signatureHeader(h),v=_objectSpread2({},i),y={method:t,baseURL:"http".concat(this.opts.secure?"s":"","://").concat(p),url:r,params:n,headers:v,data:o},g.forEach((function(e,t){y.headers[t]=e})),null==(S=normalizeProxy(this.opts.proxy))||!S.url||this.opts.proxyHost){e.next=19;break}y.baseURL=S.url,null!=S&&S.needProxyParams&&(y.params["x-proxy-tos-host"]=p,delete v.host),e.next=23;break;case 19:if(!this.opts.proxyHost){e.next=23;break}if(this.opts.proxyPort){e.next=22;break}throw new TosClientError("The `proxyPort` is required if `proxyHost` is truly.");case 22:y.proxy={host:this.opts.proxyHost,port:this.opts.proxyPort,protocol:"http"};case 23:return v["user-agent"]=this.userAgent,this.opts.requestTimeout>0&&this.opts.requestTimeout!==1/0&&(y.timeout=this.opts.requestTimeout),e.prev=25,delete(E=_objectSpread2({},y)).httpAgent,delete E.httpsAgent,TOS("reqOpts: ",E),e.next=32,this.axiosInst(_objectSpread2(_objectSpread2(_objectSpread2({},{maxBodyLength:1/0,maxContentLength:1/0,adapter:this.opts.requestAdapter}),y),(null==a?void 0:a.axiosOpts)||{}));case 32:if(T=e.sent,null==a||!a.crc){e.next=37;break}return e.next=36,a.crc.finalBlob();case 36:this.checkCRC64(a.crc,T.headers);case 37:return b=s(T),e.abrupt("return",{data:b,statusCode:T.status,headers:T.headers,requestId:T.headers["x-tos-request-id"],id2:T.headers["x-tos-id-2"]});case 41:if(e.prev=41,e.t0=e.catch(25),!axios$1.isAxiosError(e.t0)||null==(R=e.t0.response)||null==(C=R.data)||!C.RequestId){e.next=48;break}throw k=e.t0.response,TOS("TosServerError response: ",k),new TosServerError(k);case 48:throw TOS("err: ",e.t0),e.t0;case 50:case"end":return e.stop()}}),e,this,[[25,41]])}))),function(e,t,r,i,o,a){return n.apply(this,arguments)})},{key:"fetchBucket",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i,o,a){var s;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t||this.opts.bucket){e.next=3;break}throw new TosClientError("Must provide bucket param");case 3:return e.abrupt("return",this.fetch(r,"/",n,i,o,_objectSpread2(_objectSpread2({},a),{},{subdomainBucket:s})));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i,o,a){return r.apply(this,arguments)})},{key:"fetchObject",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n,i,o,a){var s,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s="string"!=typeof t&&t.bucket||this.opts.bucket,c="string"==typeof t?t:t.key,s){e.next=4;break}throw new TosClientError("Must provide bucket param");case 4:return validateObjectName(c),e.abrupt("return",this.fetch(r,"/".concat(encodeURIComponent(c)),n,i,o,_objectSpread2(_objectSpread2({},a),{},{subdomainBucket:s})));case 6:case"end":return e.stop()}}),e,this)}))),function(e,r,n,i,o,a){return t.apply(this,arguments)})},{key:"getSignatureQuery",value:function(e){var t=new ISigV4Credentials(this.opts.stsToken,this.opts.accessKeySecret,this.opts.accessKeyId),r=new SignersV4({algorithm:"TOS4-HMAC-SHA256",region:this.opts.endpoint,serviceName:"tos",bucket:e.bucket,securityToken:this.opts.stsToken},t);return"policy"in e?r.getSignaturePolicyQuery({policy:e.policy},e.expires):r.getSignatureQuery({method:e.method,path:e.path,endpoints:e.subdomain?e.endpoint:void 0,host:e.endpoint,query:e.query},e.expires)}},{key:"normalizeBucketInput",value:function(e){return"string"==typeof e?{bucket:e}:e}},{key:"normalizeObjectInput",value:function(e){return"string"==typeof e?{key:e}:e}},{key:"checkCRC64",value:function(e,t){if(this.opts.enableCRC){var r=t["x-tos-hash-crc64ecma"];if(null!=r){if(!e.equalsTo(r))throw new TosClientError("expect crc64 ".concat(e.toString(),", actual crc64 ").concat(r))}else console.warn("No x-tos-hash-crc64ecma in response's headers, please see https://www.volcengine.com/docs/6349/127737 to add `x-tos-hash-crc64ecma` to Expose-Headers field.")}}}]),e}();function getAdapter(){if("undefined"==typeof window||void 0===window.location)switch(!0){case"undefined"!=typeof wx:case"undefined"!=typeof swan:case"undefined"!=typeof dd:case"undefined"!=typeof my:return mpAdapter;case"undefined"!=typeof uni:return uniappAdapter$1;default:return}}function listBuckets(){return _listBuckets.apply(this,arguments)}function _listBuckets(){return(_listBuckets=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch("GET","/",{},{});case 2:return t=e.sent,makeArrayProp(t.data)("Buckets"),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function createBucket(e){return _createBucket.apply(this,arguments)}function _createBucket(){return(_createBucket=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=t.bucket||this.opts.bucket)){e.next=8;break}if(!(r.length<3||r.length>63)){e.next=4;break}throw new TosClientError("invalid bucket name, the length must be [3, 63]");case 4:if(/^([a-z]|-|\d)+$/.test(r)){e.next=6;break}throw new TosClientError("invalid bucket name, the character set is illegal");case 6:if(!/^-/.test(r)&&!/-$/.test(r)){e.next=8;break}throw new TosClientError("invalid bucket name, the bucket name can be neither starting with '-' nor ending with '-'");case 8:return n=t.headers=normalizeHeadersKey(t.headers),fillRequestHeaders(t,["acl","grantFullControl","grantRead","grantReadAcp","grantWrite","grantWriteAcp","storageClass","azRedundancy"]),e.next=12,this.fetchBucket(t.bucket,"PUT",{},n);case 12:return i=e.sent,e.abrupt("return",i);case 14:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function deleteBucket(e){return _deleteBucket.apply(this,arguments)}function _deleteBucket(){return(_deleteBucket=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchBucket(t,"DELETE",{},{}));case 1:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function headBucket(e){return _headBucket.apply(this,arguments)}function _headBucket(){return(_headBucket=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchBucket(t,"HEAD",{},{},void 0,{handleResponse:function(e){return e.headers}}));case 1:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function putBucketStorageClass(e){return _putBucketStorageClass.apply(this,arguments)}function _putBucketStorageClass(){return(_putBucketStorageClass=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,n=t.storageClass,e.abrupt("return",this.fetchBucket(r,"PUT",{storageClass:""},{"x-tos-storage-class":n}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function putBucketAcl(e){return _putBucketAcl.apply(this,arguments)}function _putBucketAcl(){return(_putBucketAcl=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},t.acl&&(r["x-tos-acl"]=t.acl),e.next=4,this.fetchBucket(t.bucket,"PUT",{acl:""},r,t.aclBody,{needMd5:!0});case 4:return n=e.sent,e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getBucketAcl(e){return _getBucketAcl.apply(this,arguments)}function _getBucketAcl(){return(_getBucketAcl=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchBucket(t,"GET",{acl:""},{}));case 1:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getObject(e){return _getObject.apply(this,arguments)}function _getObject(){return _getObject=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},(r="string"==typeof t?{key:t}:t).versionId&&(n.versionId=r.versionId),i=normalizeHeadersKey(null==r?void 0:r.headers),o=(null==r?void 0:r.response)||{},Object.keys(o).forEach((function(e){var t=o[e];null!=t&&(n["response-".concat(e)]=t)})),e.abrupt("return",this.fetchObject(t,"GET",n,i,void 0,{axiosOpts:{responseType:"arraybuffer"}}));case 7:case"end":return e.stop()}}),e,this)}))),_getObject.apply(this,arguments)}var BROWSER_DATATYPE=["blob"],DataTransferType,DataTransferType2;function checkSupportDataType(e){var t=[];if("browser",!(t=BROWSER_DATATYPE).includes(e))throw new TosClientError("The value of `dataType` only supports `".concat(t.join(" | "),"` in ").concat("browser"," environment"))}function getObjectV2(e){return _getObjectV.apply(this,arguments)}function _getObjectV(){return _getObjectV=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u,l,d,p,_,h,f;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=normalizeHeadersKey((r="string"==typeof t?{key:t}:t).headers),r.headers=n,i=r.dataType||"stream",r.dataType=i,checkSupportDataType(i),o={},r.versionId&&(o.versionId=r.versionId),fillRequestHeaders(r,["ifMatch","ifModifiedSince","ifNoneMatch","ifUnmodifiedSince","ssecAlgorithm","ssecKey","ssecKeyMD5","range","process"]),null==r.rangeStart&&null==r.rangeEnd||(s=null!=r.rangeStart?"".concat(r.rangeStart):"",c=null!=r.rangeEnd?"".concat(r.rangeEnd):"",u="bytes=".concat(s,"-").concat(c),n["content-range"]=null!=(a=n["content-range"])?a:u),l=(null==r?void 0:r.response)||{},Object.keys(l).forEach((function(e){var t=l[e];null!=t&&(o["response-".concat(e)]=t)})),d="stream"===i?"stream":"arraybuffer",e.next=15,this.fetchObject(t,"GET",o,n,void 0,{axiosOpts:{responseType:d}});case 15:return p=e.sent,_=p.headers,h=p.data,"blob"===i&&(h=new Blob([p.data],{type:_["content-type"]})),f=_objectSpread2(_objectSpread2({},p),{},{data:{content:h,etag:_.etag||"",lastModified:_["last-modified"]||"",hashCrc64ecma:_["x-tos-hash-crc64ecma"]||""}}),e.abrupt("return",f);case 21:case"end":return e.stop()}}),e,this)}))),_getObjectV.apply(this,arguments)}function getObjectToFile(e){return _getObjectToFile.apply(this,arguments)}function _getObjectToFile(){return(_getObjectToFile=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new TosClientError("getObjectToFile doesn't support in browser environment");case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function putObject(e){return _putObject2.apply(this,arguments)}function _putObject2(){return(_putObject2=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",_putObject.call(this,t));case 1:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function _putObject(e){return _putObject3.apply(this,arguments)}function _putObject3(){return _putObject3=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u,l,d,p,_,h,f;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.normalizeObjectInput(t),n=normalizeHeadersKey(t.headers),this.setObjectContentTypeHeader(t,n),i=getSize(t.body,n),(o=null!=i)||!t.dataTransferStatusChange&&!t.progress||console.warn("Don't get totalSize of putObject's body, the `dataTransferStatusChange` and `progress` callback will not trigger. You can use `putObjectFromFile` instead"),a=0,c=(s=t).dataTransferStatusChange,u=s.progress,l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(o&&!(t<0)&&(c||u)){a+=t,null==c||c({type:e,rwOnceBytes:t,consumedBytes:a,totalBytes:i});var r=0===i?e===DataTransferType.Succeed?1:0:a/i;1===r?e===DataTransferType.Succeed&&(null==u||u(r)):null==u||u(r)}},e.next=11,getNewBodyConfig({body:t.body,totalSize:i,dataTransferCallback:function(e){return l(DataTransferType.Rw,e)},makeRetryStream:t.makeRetryStream,enableCRC:this.opts.enableCRC});case 11:return d=e.sent,l(DataTransferType.Started),e.next=15,safeAwait(this.fetchObject(t,"PUT",{},n,d.body||"",{handleResponse:function(e){return e.headers},crc:d.crc,axiosOpts:(r={},_defineProperty$1(r,retryNamespace,{beforeRetry:function(){a=0,null==d.beforeRetry||d.beforeRetry()},makeRetryStream:d.makeRetryStream}),_defineProperty$1(r,"onUploadProgress",(function(e){l(DataTransferType.Rw,e.loaded-a)})),r)}));case 15:if(p=e.sent,_=_slicedToArray(p,2),h=_[0],f=_[1],!h&&f){e.next=22;break}throw l(DataTransferType.Failed),h;case 22:return l(DataTransferType.Succeed),e.abrupt("return",f);case 24:case"end":return e.stop()}}),e,this)}))),_putObject3.apply(this,arguments)}function putObjectFromFile(e){return _putObjectFromFile.apply(this,arguments)}function _putObjectFromFile(){return(_putObjectFromFile=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw normalizeHeadersKey(t.headers),new TosClientError("putObjectFromFile doesn't support in browser environment");case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function listObjects(){return _listObjects.apply(this,arguments)}function _listObjects(){return _listObjects=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=o.length>0&&void 0!==o[0]?o[0]:{}).bucket,r=_objectWithoutProperties(t,_excluded),e.next=4,this.fetchBucket(t.bucket,"GET",covertCamelCase2Kebab(r),{});case 4:return n=e.sent,(i=makeArrayProp(n.data))("CommonPrefixes"),i("Contents"),i("Versions"),i("DeleteMarkers"),e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,this)}))),_listObjects.apply(this,arguments)}function listObjectVersions(){return _listObjectVersions.apply(this,arguments)}function _listObjectVersions(){return _listObjectVersions=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.abrupt("return",this.listObjects(_objectSpread2({versions:""},t)));case 2:case"end":return e.stop()}}),e,this)}))),_listObjectVersions.apply(this,arguments)}function getPreSignedUrl(e){validateObjectName(e);var t="string"==typeof e?{key:e}:e,r=t.alternativeEndpoint||this.opts.endpoint,n=!t.alternativeEndpoint,i=t.bucket||this.opts.bucket||"";if(n&&!i)throw new TosClientError("Must provide bucket param");var o,a,s=_slicedToArray((o=encodeURIComponent(t.key),a=t.key.split("/").map((function(e){return encodeURIComponent(e)})).join("/"),n?["".concat(i,".").concat(r),"/".concat(a),"/".concat(o)]:[r,"/".concat(a),"/".concat(o)]),3),c=s[0],u=s[1],l=s[2],d=t.query||{},p=function(e,t){null==d[e]&&null!=t&&(d[e]=t)},_=t.response||{};Object.keys(_).forEach((function(e){var t=e,r=covertCamelCase2Kebab(t);p("response-".concat(r),_[t])})),t.versionId&&p("versionId",t.versionId);var h=this.getSignatureQuery({bucket:i,method:t.method||"GET",path:l,endpoint:r,subdomain:n,expires:t.expires||1800,query:d}),f=normalizeProxy(this.opts.proxy),m="http".concat(this.opts.secure?"s":"","://").concat(c);null!=f&&f.url&&(m=f.url.replace(/\/+$/g,""),null!=f&&f.needProxyParams&&(h["x-proxy-tos-host"]=c));var g=Object.keys(h).map((function(e){return"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(h[e]))})).join("&");return"".concat(m).concat(u,"?").concat(g)}function headObject(e){return _headObject.apply(this,arguments)}function _headObject(){return(_headObject=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=normalizeHeadersKey((r="string"==typeof t?{key:t}:t).headers),r.headers=n,i={},r.versionId&&(i.versionId=r.versionId),fillRequestHeaders(r,["ifMatch","ifModifiedSince","ifNoneMatch","ifUnmodifiedSince","ssecAlgorithm","ssecKey","ssecKeyMD5"]),e.abrupt("return",this.fetchObject(t,"HEAD",i,(null==r?void 0:r.headers)||{},void 0,{handleResponse:function(e){return e.headers}}));case 7:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function deleteObject(e){return _deleteObject.apply(this,arguments)}function _deleteObject(){return(_deleteObject=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},(r="string"==typeof t?{key:t}:t).versionId&&(n.versionId=r.versionId),e.next=5,this.fetchObject(t,"DELETE",n,{},{},{handleResponse:function(e){return e.headers}});case 5:return i=e.sent,e.abrupt("return",i);case 7:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function deleteMultiObjects(e){return _deleteMultiObjects.apply(this,arguments)}function _deleteMultiObjects(){return(_deleteMultiObjects=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={Quiet:t.quiet,Objects:t.objects.map((function(e){return{Key:e.key,VersionId:e.versionId}}))},e.next=3,this.fetchBucket(t.bucket,"POST",{delete:""},{},r);case 3:return n=e.sent,(i=makeArrayProp(n.data))("Deleted"),i("Error"),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function copyObject(e){return _copyObject.apply(this,arguments)}function _copyObject(){return(_copyObject=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=normalizeHeadersKey(t.headers),t.headers=r,fillRequestHeaders(t,["cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","copySourceIfMatch","copySourceIfModifiedSince","copySourceIfNoneMatch","copySourceIfUnmodifiedSince","copySourceSSECAlgorithm","copySourceSSECKey","copySourceSSECKeyMD5","acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","serverSideEncryption","metadataDirective","meta","websiteRedirectLocation","storageClass"]),t.srcBucket&&t.srcKey&&(i=getCopySourceHeaderValue(t.srcBucket,t.srcKey),t.srcVersionID&&(i+="?versionId=".concat(t.srcVersionID)),r["x-tos-copy-source"]=null!=(n=r["x-tos-copy-source"])?n:i),e.next=6,safeAwait(this.fetchObject(t,"PUT",{},r));case 6:if(o=e.sent,a=_slicedToArray(o,2),s=a[0],c=a[1],!s&&c&&c.data.ETag){e.next=12;break}throw s;case 12:return e.abrupt("return",c);case 13:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getObjectAcl(e){return _getObjectAcl.apply(this,arguments)}function _getObjectAcl(){return(_getObjectAcl=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={acl:""},(r="string"==typeof t?{key:t}:t).versionId&&(n.versionId=r.versionId),e.abrupt("return",this.fetchObject(t,"GET",n,{}));case 4:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function putObjectAcl(e){return _putObjectAcl.apply(this,arguments)}function _putObjectAcl(){return(_putObjectAcl=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={acl:""},t.versionId&&(r.versionId=t.versionId),(n=t.headers||{})["x-tos-acl"]||(n["x-tos-acl"]=t.acl),e.abrupt("return",this.fetchObject(t,"PUT",r,n));case 5:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function abortMultipartUpload(e){return _abortMultipartUpload.apply(this,arguments)}function _abortMultipartUpload(){return(_abortMultipartUpload=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchObject(t,"DELETE",{uploadId:t.uploadId},{}));case 1:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function completeMultipartUpload(e){return _completeMultipartUpload.apply(this,arguments)}function _completeMultipartUpload(){return(_completeMultipartUpload=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.completeAll){e.next=4;break}if(!((null==(r=t.parts)?void 0:r.length)>0)){e.next=3;break}throw new TosClientError("Should not specify both 'completeAll' and 'parts' params.");case 3:return e.abrupt("return",this.fetchObject(t,"POST",{uploadId:t.uploadId},{"x-tos-complete-all":"yes"},void 0,{handleResponse:function(e){return _objectSpread2(_objectSpread2({},e.data),{},{VersionID:e.headers["x-tos-version-id"]})}}));case 4:return e.abrupt("return",this.fetchObject(t,"POST",{uploadId:t.uploadId},{},{Parts:t.parts.map((function(e){return{ETag:e.eTag,PartNumber:e.partNumber}}))},{handleResponse:function(e){return _objectSpread2(_objectSpread2({},e.data),{},{VersionID:e.headers["x-tos-version-id"]})}}));case 5:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function createMultipartUpload(e){return _createMultipartUpload.apply(this,arguments)}function _createMultipartUpload(){return(_createMultipartUpload=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.normalizeObjectInput(t),r=normalizeHeadersKey(t.headers),t.headers=r,fillRequestHeaders(t,["encodingType","cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","serverSideEncryption","meta","websiteRedirectLocation","storageClass"]),this.setObjectContentTypeHeader(t,r),e.abrupt("return",this.fetchObject(t,"POST",{uploads:""},r,""));case 6:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}DataTransferType2=DataTransferType||(DataTransferType={}),DataTransferType2[DataTransferType2.Started=1]="Started",DataTransferType2[DataTransferType2.Rw=2]="Rw",DataTransferType2[DataTransferType2.Succeed=3]="Succeed",DataTransferType2[DataTransferType2.Failed=4]="Failed";var MIN_PART_SIZE_EXCEPT_LAST_ONE=5242880,MAX_PART_NUMBER=1e4,calculateSafePartSize=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t;t<MIN_PART_SIZE_EXCEPT_LAST_ONE&&(n=MIN_PART_SIZE_EXCEPT_LAST_ONE,r&&console.warn("partSize has been set to ".concat(n,", because the partSize you provided is less than the minimal size of multipart")));var i=Math.ceil(e/MAX_PART_NUMBER);return t<i&&(n=i,r&&console.warn("partSize has been set to ".concat(n,", because the partSize you provided causes the number of part excesses 10,000"))),n},UploadEventType,UploadEventType2;function listParts(e){return _listParts.apply(this,arguments)}function _listParts(){return(_listParts=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.bucket,t.key,r=t.uploadId,n=_objectWithoutProperties(t,_excluded2),e.next=3,this.fetchObject(t,"GET",_objectSpread2({uploadId:r},covertCamelCase2Kebab(n)),{});case 3:return i=e.sent,makeArrayProp(i.data)("Parts"),e.abrupt("return",i);case 7:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function _uploadPart(e){return _uploadPart2.apply(this,arguments)}function _uploadPart2(){return _uploadPart2=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.uploadId,i=t.partNumber,o=t.body,a=t.enableContentMD5,s=void 0!==a&&a,c=t.headers||{},(u=getSize(o))&&null==c["content-length"]&&(c["content-length"]=u.toFixed(0)),s&&null==c["content-md5"]&&console.warn("current not support enableMD5Checksum"),l=getSize(t.body,c),(d=null!=l)||!t.dataTransferStatusChange&&!t.progress||console.warn("Don't get totalSize of uploadPart's body, the `dataTransferStatusChange` callback will not trigger. You can use `uploadPartFromFile` instead"),p=0,_=t.dataTransferStatusChange,h=t.progress,f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(d&&!(t<0)&&(_||h)){p+=t,null==_||_({type:e,rwOnceBytes:t,consumedBytes:p,totalBytes:l});var r=0===l?e===DataTransferType.Succeed?1:0:p/l;1===r?e===DataTransferType.Succeed&&(null==h||h(r)):null==h||h(r)}},e.next=13,getNewBodyConfig({body:t.body,totalSize:l,dataTransferCallback:function(e){return f(DataTransferType.Rw,e)},beforeRetry:t.beforeRetry,makeRetryStream:t.makeRetryStream,enableCRC:this.opts.enableCRC});case 13:return m=e.sent,f(DataTransferType.Started),e.next=17,safeAwait(this.fetchObject(t,"PUT",{partNumber:i,uploadId:n},c,m.body,{crc:m.crc,handleResponse:function(e){return{ETag:e.headers.etag}},axiosOpts:(r={},_defineProperty$1(r,retryNamespace,{beforeRetry:function(){p=0,null==m.beforeRetry||m.beforeRetry()},makeRetryStream:m.makeRetryStream}),_defineProperty$1(r,"onUploadProgress",(function(e){f(DataTransferType.Rw,e.loaded-p)})),r)}));case 17:if(g=e.sent,v=_slicedToArray(g,2),y=v[0],!(S=v[1])||S.data.ETag){e.next=23;break}throw new TosClientError("No ETag in uploadPart's response headers, please see https://www.volcengine.com/docs/6349/127737 to fix CORS problem");case 23:if(!y&&S){e.next=26;break}throw f(DataTransferType.Failed),y;case 26:return f(DataTransferType.Succeed),e.abrupt("return",S);case 28:case"end":return e.stop()}}),e,this)}))),_uploadPart2.apply(this,arguments)}function uploadPart(e){return _uploadPart3.apply(this,arguments)}function _uploadPart3(){return(_uploadPart3=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",_uploadPart.call(this,t));case 1:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function uploadPartFromFile(e){return _uploadPartFromFile.apply(this,arguments)}function _uploadPartFromFile(){return(_uploadPartFromFile=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new TosClientError("uploadPartFromFile doesn't support in browser environment");case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function listMultipartUploads(){return _listMultipartUploads.apply(this,arguments)}function _listMultipartUploads(){return _listMultipartUploads=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=o.length>0&&void 0!==o[0]?o[0]:{}).bucket,r=_objectWithoutProperties(t,_excluded3),e.next=4,this.fetchBucket(t.bucket,"GET",_objectSpread2({uploads:""},covertCamelCase2Kebab(r)),{});case 4:return n=e.sent,(i=makeArrayProp(n.data))("Uploads"),i("CommonPrefixes"),e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)}))),_listMultipartUploads.apply(this,arguments)}function appendObject(e){return _appendObject.apply(this,arguments)}function _appendObject(){return(_appendObject=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.normalizeObjectInput(t),r=normalizeHeadersKey(t.headers),this.setObjectContentTypeHeader(t,r),e.next=5,this.fetchObject(t,"PUT",{append:"",offset:t.offset},r,t.body,{handleResponse:function(e){return e.headers}});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function setObjectMeta(e){return _setObjectMeta.apply(this,arguments)}function _setObjectMeta(){return(_setObjectMeta=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={metadata:""},(r="string"==typeof t?{key:t}:t).versionId&&(n.versionId=r.versionId),e.abrupt("return",this.fetchObject(t,"POST",n,r.headers||{}));case 4:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function uploadPartCopy(e){return _uploadPartCopy.apply(this,arguments)}function _uploadPartCopy(){return(_uploadPartCopy=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.uploadId,n=t.partNumber,i=normalizeHeadersKey(t.headers),t.headers=i,fillRequestHeaders(t,["copySourceSSECAlgorithm","copySourceSSECKey","copySourceSSECKeyMD5","ssecAlgorithm","ssecKey","ssecKeyMD5"]),e.next=6,safeAwait(this.fetchObject(t,"PUT",{partNumber:n,uploadId:r},i,void 0,{handleResponse:function(e){return _objectSpread2(_objectSpread2({},e.data),{},{SSECAlgorithm:e.headers[requestHeadersMap.ssecAlgorithm],SSECKeyMD5:e.headers[requestHeadersMap.ssecKeyMD5]})}}));case 6:if(o=e.sent,a=_slicedToArray(o,2),s=a[0],c=a[1],!s&&c&&c.data.ETag){e.next=12;break}throw s;case 12:return e.abrupt("return",c);case 13:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}UploadEventType2=UploadEventType||(UploadEventType={}),UploadEventType2[UploadEventType2.createMultipartUploadSucceed=1]="createMultipartUploadSucceed",UploadEventType2[UploadEventType2.createMultipartUploadFailed=2]="createMultipartUploadFailed",UploadEventType2[UploadEventType2.uploadPartSucceed=3]="uploadPartSucceed",UploadEventType2[UploadEventType2.uploadPartFailed=4]="uploadPartFailed",UploadEventType2[UploadEventType2.uploadPartAborted=5]="uploadPartAborted",UploadEventType2[UploadEventType2.completeMultipartUploadSucceed=6]="completeMultipartUploadSucceed",UploadEventType2[UploadEventType2.completeMultipartUploadFailed=7]="completeMultipartUploadFailed";var CHECKPOINT_FILE_NAME_PLACEHOLDER="@@checkpoint-file-placeholder@@",FILE_PARAM_CHECK_MSG="`file` must be string, Buffer, File or Blob",ABORT_ERROR_STATUS_CODE=[403,404,405],ACLType,ACLType2,StorageClassType,StorageClassType2,MetadataDirectiveType,MetadataDirectiveType2,AzRedundancyType,AzRedundancyType2,PermissionType,PermissionType2,GranteeType,GranteeType2,CannedType,CannedType2,HttpMethodType,HttpMethodType2,StorageClassInheritDirectiveType,StorageClassInheritDirectiveType2,ResumableCopyEventType,ResumableCopyEventType2;function uploadFile(e){return _uploadFile.apply(this,arguments)}function _uploadFile(){return _uploadFile=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R,C,k,I,A,O,M,P,w,D,N,x,L,$,B,U,F,V,G=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.cancelToken,a=t.enableContentMD5,s=void 0!==a&&a,c=function(){return o&&!!o.reason},e.next=4,_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})))();case 4:return u=e.sent,e.next=7,_asyncToGenerator(_regeneratorRuntime().mark((function e(){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.file,!u){e.next=3;break}return e.abrupt("return",u.size);case 3:if(!isBuffer(r)){e.next=5;break}return e.abrupt("return",r.length);case 5:if(!isBlob(r)){e.next=7;break}return e.abrupt("return",r.size);case 7:throw new TosClientError(FILE_PARAM_CHECK_MSG);case 8:case"end":return e.stop()}}),e)})))();case 7:return l=e.sent,e.next=10,_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("object"!==_typeof(t.checkpoint)){e.next=2;break}return e.abrupt("return",{record:t.checkpoint});case 2:return e.abrupt("return",{});case 3:case"end":return e.stop()}}),e)})))();case 10:return d=e.sent,e.next=13,_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u&&null!=(t=d.record)&&t.file_info&&(n=null==(r=d.record)?void 0:r.file_info,i=n.last_modified,o=n.file_size,u.mtimeMs===i&&u.size===o||(console.warn("The file has been modified since ".concat(new Date(i),", so the checkpoint file is invalid, and specified file will be uploaded again.")),delete d.record));case 1:case"end":return e.stop()}}),e)})))();case 13:if(p=calculateSafePartSize(l,t.partSize||(null==(r=d.record)?void 0:r.part_size)||DEFAULT_PART_SIZE,!0),d.record&&d.record.part_size!==p&&(console.warn("The partSize param does not equal the partSize in checkpoint file, so the checkpoint file is invalid, and specified file will be uploaded again."),delete d.record),_=t.bucket||this.opts.bucket||"",h=t.key,f="",m=[],g=getAllTasks(l,p),v=((null==(n=d.record)?void 0:n.parts_info)||[]).filter((function(e){return e.is_completed})).reduce((function(e,t){return e+t.part_size}),0),y=v,S=(null==(i=d.record)?void 0:i.parts_info)||[],E=new Map,S.forEach((function(e){return E.set(e.part_number,e)})),T=function(){var e={bucket:_,key:h,part_size:p,upload_id:f,parts_info:S};return u&&(e.file_info={last_modified:u.mtimeMs,file_size:u.size}),e},b=function(e){if(t.uploadEventChange){var r=_objectSpread2({bucket:_,uploadId:f,key:h},e);d.filePath&&(r.checkpointFile=d.filePath),t.uploadEventChange(r)}},(j=R||(R={}))[j.createMultipartUploadSucceed=1]="createMultipartUploadSucceed",j[j.uploadPartSucceed=2]="uploadPartSucceed",j[j.completeMultipartUploadSucceed=3]="completeMultipartUploadSucceed",C=function(e){if(t.progress){var r=0;r=e===R.createMultipartUploadSucceed?0:e===R.completeMultipartUploadSucceed?1:l?y/l:1,y===l&&e===R.uploadPartSucceed||t.progress(r,T())}},k=v,I=t.dataTransferStatusChange,A=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;I&&(k+=t,null==I||I({type:e,rwOnceBytes:t,consumedBytes:k,totalBytes:l}))},O=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),M=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=E.get(t.partNumber))||(n={part_number:t.partNumber,offset:t.offset,part_size:t.partSize,is_completed:!1,etag:""},S.push(n),E.set(n.part_number,n)),r instanceof Error||(n.is_completed=!0,n.etag=r.ETag),e.next=5,O();case 5:if(i={partNumber:n.part_number,partSize:n.part_size,offset:n.offset},!(r instanceof Error)){e.next=12;break}return o=r,a=UploadEventType.uploadPartFailed,o instanceof TosServerError&&ABORT_ERROR_STATUS_CODE.includes(o.statusCode)&&(a=UploadEventType.uploadPartAborted),b({type:a,err:o,uploadPartInfo:i}),e.abrupt("return");case 12:i.etag=r.ETag,y+=i.partSize,b({type:UploadEventType.uploadPartSucceed,uploadPartInfo:i}),C(R.uploadPartSucceed);case 16:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),!d.record){e.next=42;break}_=d.record.bucket,f=d.record.upload_id,w=new Set((d.record.parts_info||[]).filter((function(e){return e.is_completed})).map((function(e){return e.part_number}))),m=g.filter((function(e){return!w.has(e.partNumber)})),e.next=62;break;case 42:return e.prev=42,e.next=45,createMultipartUpload.call(this,t);case 45:if(D=e.sent,N=D.data,!c()){e.next=49;break}throw new CancelError("cancel uploadFile");case 49:_=N.Bucket,f=N.UploadId,d.filePathIsPlaceholder&&(d.filePath=null==(x=d.filePath)?void 0:x.replace("".concat(CHECKPOINT_FILE_NAME_PLACEHOLDER),getDefaultCheckpointFilePath(_,h))),b({type:UploadEventType.createMultipartUploadSucceed}),C(R.createMultipartUploadSucceed),e.next=61;break;case 56:throw e.prev=56,e.t0=e.catch(42),L=e.t0,b({type:UploadEventType.createMultipartUploadFailed,err:L}),L;case 61:m=g;case 62:return $=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var r,n,i,o,a,u,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,n=0,e.next=4,Promise.all(Array.from({length:t.taskNum||1}).map(_asyncToGenerator(_regeneratorRuntime().mark((function e(){var i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=_regeneratorRuntime().mark((function e(){var i,o,a,u,l,d;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((i=n++)>=m.length)){e.next=3;break}return e.abrupt("return",{v:void 0});case 3:return o=m[i],a=0,e.prev=5,e.next=8,_uploadPart.call(G,{bucket:_,key:h,uploadId:f,body:getBody(t.file,o),enableContentMD5:s,makeRetryStream:getMakeRetryStream(t.file),beforeRetry:function(){k-=a,a=0},partNumber:o.partNumber,headers:_defineProperty$1({},"content-length","".concat(o.partSize)),dataTransferStatusChange:function(e){e.type===DataTransferType.Rw&&(a+=e.rwOnceBytes,A(e.type,e.rwOnceBytes))}});case 8:if(u=e.sent,l=u.data,!c()){e.next=12;break}throw new CancelError("cancel uploadFile");case 12:return e.next=14,P(o,l);case 14:e.next=26;break;case 16:if(e.prev=16,e.t0=e.catch(5),d=e.t0,k-=a,a=0,!isCancelError(d)){e.next=23;break}throw d;case 23:return r||(r=d),e.next=26,P(o,d);case 26:case"end":return e.stop()}}),e,null,[[5,16]])}));case 1:return e.delegateYield(i(),"t0",3);case 3:if("object"!==_typeof(o=e.t0)){e.next=6;break}return e.abrupt("return",o.v);case 6:e.next=1;break;case 8:case"end":return e.stop()}}),e)})))));case 4:if(!r){e.next=6;break}throw r;case 6:return i=(T().parts_info||[]).map((function(e){return{eTag:e.etag,partNumber:e.part_number}})),e.next=9,safeAwait(completeMultipartUpload.call(G,{bucket:_,key:h,uploadId:f,parts:i}));case 9:if(o=e.sent,a=_slicedToArray(o,2),u=a[0],l=a[1],!u&&l){e.next=16;break}throw b({type:UploadEventType.completeMultipartUploadFailed}),u;case 16:return b({type:UploadEventType.completeMultipartUploadSucceed}),C(R.completeMultipartUploadSucceed),e.next=20,M();case 20:return e.abrupt("return",l);case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A(DataTransferType.Started),e.next=66,safeAwait($());case 66:if(B=e.sent,U=_slicedToArray(B,2),F=U[0],V=U[1],!F&&V){e.next=73;break}throw A(DataTransferType.Failed),F;case 73:return A(DataTransferType.Succeed),e.abrupt("return",V);case 75:case"end":return e.stop()}var j}),e,this,[[42,56]])}))),_uploadFile.apply(this,arguments)}function getAllTasks(e,t){for(var r=[],n=0;;++n){var i=n*t,o=Math.min(t,e-i);if(r.push({offset:i,partSize:o,partNumber:n+1}),(n+1)*t>=e)break}return r}function getBody(e,t){var r=t.offset,n=r+t.partSize;if(isBlob(e))return e.slice(r,n);if(isBuffer(e))return e.slice(r,n);throw new TosClientError(FILE_PARAM_CHECK_MSG)}function getMakeRetryStream(e,t){}function getDefaultCheckpointFilePath(e,t){return"".concat(t,".").concat(hashMd5$1("".concat(e,".").concat(t),"hex"),".upload").replace(/[\\/]/g,"")}function calculatePostSignature(e){return _calculatePostSignature.apply(this,arguments)}function _calculatePostSignature(){return _calculatePostSignature=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(validateObjectName(t),t=this.normalizeObjectInput(t),n=(r=t).expiresIn,i=void 0===n?3600:n,o=r.key,a=t.bucket||this.opts.bucket,s=_objectSpread2({},t.fields),c=_toConsumableArray(t.conditions||[]),a){e.next=8;break}throw new TosClientError("Must provide bucket param");case 8:return u=this.opts.accessKeySecret,l=getDateTimeStr({date:new Date((new Date).valueOf()+1e3*i),type:"ISO"}),d=getDateTimeStr(),p=d.substring(0,8),_="tos",h="request",f=hmacSha256$1(u,p),m=hmacSha256$1(f,this.opts.region),g=hmacSha256$1(m,_),v=hmacSha256$1(g,h),y=[this.opts.accessKeyId,p,this.opts.region,_,h].join("/"),S={key:o,"x-tos-algorithm":"TOS4-HMAC-SHA256","x-tos-date":d,"x-tos-credential":y},this.opts.stsToken&&(S["x-tos-security-token"]=this.opts.stsToken),c.push({bucket:a}),Object.entries(S).forEach((function(e){var t=_slicedToArray(e,2),r=t[0],n=t[1];s[r]=n})),Object.entries(s).forEach((function(e){var t=_slicedToArray(e,2),r=t[0],n=t[1];c.push(_defineProperty$1({},r,"".concat(n)))})),E={expiration:l,conditions:c},T=JSON.stringify(E),b=stringify$1(parse$1(T,"utf-8"),"base64"),R=hmacSha256$1(v,b,"hex"),s.policy=b,s["x-tos-signature"]=R,e.abrupt("return",s);case 32:case"end":return e.stop()}}),e,this)}))),_calculatePostSignature.apply(this,arguments)}function getDateTimeStr(e){var t=e||{},r=t.date,n=void 0===r?new Date:r,i=t.type;return"ISO"===(void 0===i?"Z":i)?n.toISOString():n.toISOString().replace(/\..+/,"").replace(/-/g,"").replace(/:/g,"")+"Z"}ACLType2=ACLType||(ACLType={}),ACLType2.ACLPrivate="private",ACLType2.ACLPublicRead="public-read",ACLType2.ACLPublicReadWrite="public-read-write",ACLType2.ACLAuthenticatedRead="authenticated-read",ACLType2.ACLBucketOwnerRead="bucket-owner-read",ACLType2.ACLBucketOwnerFullControl="bucket-owner-full-control",ACLType2.ACLBucketOwnerEntrusted="bucket-owner-entrusted",StorageClassType2=StorageClassType||(StorageClassType={}),StorageClassType2.StorageClassStandard="STANDARD",StorageClassType2.StorageClassIa="IA",StorageClassType2.StorageClassArchiveFr="ARCHIVE_FR",StorageClassType2.StorageClassColdArchive="COLD_ARCHIVE",StorageClassType2.StorageClassIntelligentTiering="INTELLIGENT_TIERING",MetadataDirectiveType2=MetadataDirectiveType||(MetadataDirectiveType={}),MetadataDirectiveType2.MetadataDirectiveCopy="COPY",MetadataDirectiveType2.MetadataDirectiveReplace="REPLACE",AzRedundancyType2=AzRedundancyType||(AzRedundancyType={}),AzRedundancyType2.AzRedundancySingleAz="single-az",AzRedundancyType2.AzRedundancyMultiAz="multi-az",PermissionType2=PermissionType||(PermissionType={}),PermissionType2.PermissionRead="READ",PermissionType2.PermissionWrite="WRITE",PermissionType2.PermissionReadAcp="READ_ACP",PermissionType2.PermissionWriteAcp="WRITE_ACP",PermissionType2.PermissionFullControl="FULL_CONTROL",GranteeType2=GranteeType||(GranteeType={}),GranteeType2.GranteeGroup="Group",GranteeType2.GranteeUser="CanonicalUser",CannedType2=CannedType||(CannedType={}),CannedType2.CannedAllUsers="AllUsers",CannedType2.CannedAuthenticatedUsers="AuthenticatedUsers",HttpMethodType2=HttpMethodType||(HttpMethodType={}),HttpMethodType2.HttpMethodGet="GET",HttpMethodType2.HttpMethodPut="PUT",HttpMethodType2.HttpMethodPost="POST",HttpMethodType2.HttpMethodDelete="DELETE",HttpMethodType2.HttpMethodHead="HEAD",StorageClassInheritDirectiveType2=StorageClassInheritDirectiveType||(StorageClassInheritDirectiveType={}),StorageClassInheritDirectiveType2.StorageClassInheritDirectiveDestinationBucket="DESTINATION_BUCKET",StorageClassInheritDirectiveType2.StorageClassInheritDirectiveSourceObject="SOURCE_OBJECT",ResumableCopyEventType2=ResumableCopyEventType||(ResumableCopyEventType={}),ResumableCopyEventType2[ResumableCopyEventType2.createMultipartUploadSucceed=1]="createMultipartUploadSucceed",ResumableCopyEventType2[ResumableCopyEventType2.createMultipartUploadFailed=2]="createMultipartUploadFailed",ResumableCopyEventType2[ResumableCopyEventType2.uploadPartCopySucceed=3]="uploadPartCopySucceed",ResumableCopyEventType2[ResumableCopyEventType2.uploadPartCopyFailed=4]="uploadPartCopyFailed",ResumableCopyEventType2[ResumableCopyEventType2.uploadPartCopyAborted=5]="uploadPartCopyAborted",ResumableCopyEventType2[ResumableCopyEventType2.completeMultipartUploadSucceed=6]="completeMultipartUploadSucceed",ResumableCopyEventType2[ResumableCopyEventType2.completeMultipartUploadFailed=7]="completeMultipartUploadFailed";var CHECKPOINT_FILE_NAME_PLACEHOLDER$1="@@checkpoint-file-placeholder@@",ABORT_ERROR_STATUS_CODE$1=[403,404,405],DEFAULT_PART_SIZE$1=20971520,BucketVersioningStatus,BucketVersioningStatus2,DownloadEventType,DownloadEventType2;function resumableCopyObject(e){return _resumableCopyObject.apply(this,arguments)}function _resumableCopyObject(){return _resumableCopyObject=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u,l,d,p,_,h,f,m,g,v,y,S,E,T,b,R,C,k,I,A,O,M,P,w,D,N,x,L=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.cancelToken,a=function(){return o&&!!o.reason},e.next=4,headObject.call(this,{bucket:t.srcBucket,key:t.srcKey,versionId:t.srcVersionId});case 4:return s=e.sent,c=s.data,u=c.etag,l=+c["content-length"],e.next=10,_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("object"!==_typeof(t.checkpoint)){e.next=2;break}return e.abrupt("return",{record:t.checkpoint});case 2:return e.abrupt("return",{});case 3:case"end":return e.stop()}}),e)})))();case 10:return d=e.sent,e.next=13,_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null!=(t=d.record)&&t.copy_source_object_info&&(n=null==(r=d.record)?void 0:r.copy_source_object_info,i=n.last_modified,o=n.object_size,c["last-modified"]===i&&+c["content-length"]===o||(console.warn("The file has been modified since ".concat(new Date(i),", so the checkpoint file is invalid, and specified file will be uploaded again.")),delete d.record));case 1:case"end":return e.stop()}}),e)})))();case 13:if(p=calculateSafePartSize(l,t.partSize||(null==(r=d.record)?void 0:r.part_size)||DEFAULT_PART_SIZE$1,!0),d.record&&d.record.part_size!==p&&(console.warn("The partSize param does not equal the partSize in checkpoint file, so the checkpoint file is invalid, and specified file will be uploaded again."),delete d.record),_=t.bucket||this.opts.bucket||"",h=t.key,f="",m=[],g=getAllTasks$1(l,p),v=((null==(n=d.record)?void 0:n.parts_info)||[]).filter((function(e){return e.is_completed})).reduce((function(e,t){return e+t.copy_source_range_end-t.copy_source_range_start+1}),0),y=v,S=(null==(i=d.record)?void 0:i.parts_info)||[],E=new Map,S.forEach((function(e){return E.set(e.part_number,e)})),T=function(){return{bucket:_,key:h,part_size:p,upload_id:f,parts_info:S,copy_source_object_info:{last_modified:c["last-modified"],etag:c.etag,hash_crc64ecma:c["x-tos-hash-crc64ecma"]||"",object_size:+c["content-length"]}}},b=function(e){if(t.copyEventListener){var r=_objectSpread2({bucket:_,uploadId:f,key:h},e);d.filePath&&(r.checkpointFile=d.filePath),t.copyEventListener(r)}},($=R||(R={}))[$.createMultipartUploadSucceed=1]="createMultipartUploadSucceed",$[$.uploadPartSucceed=2]="uploadPartSucceed",$[$.completeMultipartUploadSucceed=3]="completeMultipartUploadSucceed",C=function(e){if(t.progress){var r=0;r=e===R.createMultipartUploadSucceed?0:e===R.completeMultipartUploadSucceed?1:l?y/l:1,y===l&&e===R.uploadPartSucceed||t.progress(r,T())}},k=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=E.get(t.partNumber))||(n={part_number:t.partNumber,copy_source_range_start:t.offset,copy_source_range_end:t.offset+t.partSize-1,is_completed:!1,etag:""},S.push(n),E.set(n.part_number,n)),r instanceof Error||(n.is_completed=!0,n.etag=r.ETag),e.next=5,k();case 5:if(i={partNumber:n.part_number,copySourceRangeEnd:n.copy_source_range_end,copySourceRangeStart:n.copy_source_range_start},!(r instanceof Error)){e.next=12;break}return o=r,a=ResumableCopyEventType.uploadPartCopyFailed,o instanceof TosServerError&&ABORT_ERROR_STATUS_CODE$1.includes(o.statusCode)&&(a=ResumableCopyEventType.uploadPartCopyAborted),b({type:a,err:o,copyPartInfo:i}),e.abrupt("return");case 12:i.etag=r.ETag,y+=i.copySourceRangeEnd-i.copySourceRangeStart+1,b({type:ResumableCopyEventType.uploadPartCopySucceed,copyPartInfo:i}),C(R.uploadPartSucceed);case 16:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),!d.record){e.next=39;break}_=d.record.bucket,f=d.record.upload_id,O=new Set((d.record.parts_info||[]).filter((function(e){return e.is_completed})).map((function(e){return e.part_number}))),m=g.filter((function(e){return!O.has(e.partNumber)})),e.next=59;break;case 39:return e.prev=39,e.next=42,createMultipartUpload.call(this,cloneDeep$1(t));case 42:if(M=e.sent,P=M.data,!a()){e.next=46;break}throw new CancelError("cancel uploadFile");case 46:_=P.Bucket,f=P.UploadId,d.filePathIsPlaceholder&&(d.filePath=null==(w=d.filePath)?void 0:w.replace("".concat(CHECKPOINT_FILE_NAME_PLACEHOLDER$1),getDefaultCheckpointFilePath$1(_objectSpread2(_objectSpread2({},t),{},{bucket:_})))),b({type:ResumableCopyEventType.createMultipartUploadSucceed}),C(R.createMultipartUploadSucceed),e.next=58;break;case 53:throw e.prev=53,e.t0=e.catch(39),D=e.t0,b({type:ResumableCopyEventType.createMultipartUploadFailed,err:D}),D;case 58:m=g;case 59:return N=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var r,n,i,o,s,c,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,n=0,e.next=4,Promise.all(Array.from({length:t.taskNum||1}).map(_asyncToGenerator(_regeneratorRuntime().mark((function e(){var i,o,s,c,l,d,p,g,v;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((i=n++)>=m.length)){e.next=4;break}return e.abrupt("return");case 4:return o=m[i],e.prev=5,c=getCopySourceHeaderValue(t.srcBucket,t.srcKey),t.srcVersionId&&(c+="?versionId=".concat(t.srcVersionId)),l="bytes=".concat(o.offset,"-").concat(o.offset+o.partSize-1),d=_objectSpread2(_objectSpread2({},t.headers),{},(_defineProperty$1(s={},"x-tos-copy-source",c),_defineProperty$1(s,"x-tos-copy-source-if-match",u),_defineProperty$1(s,"x-tos-copy-source-range",l),s)),o.partSize||delete d["x-tos-copy-source-range"],e.next=13,uploadPartCopy.call(L,{bucket:_,key:h,uploadId:f,partNumber:o.partNumber,headers:d});case 13:if(p=e.sent,g=p.data,!a()){e.next=17;break}throw new CancelError("cancel uploadFile");case 17:return e.next=19,A(o,g);case 19:e.next=29;break;case 21:if(e.prev=21,e.t0=e.catch(5),!isCancelError$1(v=e.t0)){e.next=26;break}throw v;case 26:return r||(r=v),e.next=29,A(o,v);case 29:e.next=0;break;case 31:case"end":return e.stop()}}),e,null,[[5,21]])})))));case 4:if(!r){e.next=6;break}throw r;case 6:return i=(T().parts_info||[]).map((function(e){return{eTag:e.etag,partNumber:e.part_number}})),e.next=9,safeAwait(completeMultipartUpload.call(L,{bucket:_,key:h,uploadId:f,parts:i}));case 9:if(o=e.sent,s=_slicedToArray(o,2),c=s[0],l=s[1],!c&&l){e.next=16;break}throw b({type:ResumableCopyEventType.completeMultipartUploadFailed}),c;case 16:return b({type:ResumableCopyEventType.completeMultipartUploadSucceed}),C(R.completeMultipartUploadSucceed),e.next=20,I();case 20:return e.abrupt("return",l);case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var r,n,i,o,a,s,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=getCopySourceHeaderValue(t.srcBucket,t.srcKey),t.srcVersionId&&(n+="?versionId=".concat(t.srcVersionId)),i=_objectSpread2(_objectSpread2({},t.headers),{},(_defineProperty$1(r={},"x-tos-copy-source",n),_defineProperty$1(r,"x-tos-copy-source-if-match",u),r)),e.next=5,safeAwait(copyObject.call(L,{bucket:t.bucket,key:t.key,headers:i}));case 5:if(o=e.sent,a=_slicedToArray(o,2),s=a[0],c=a[1],!s&&c){e.next=12;break}throw b({type:ResumableCopyEventType.uploadPartCopyFailed}),s;case 12:return C(R.completeMultipartUploadSucceed),b({type:ResumableCopyEventType.uploadPartCopySucceed,copyPartInfo:{partNumber:0,copySourceRangeStart:0,copySourceRangeEnd:0}}),b({type:ResumableCopyEventType.completeMultipartUploadSucceed}),e.abrupt("return",_objectSpread2(_objectSpread2({},c),{},{data:{ETag:c.headers.etag||"",Bucket:_,Key:h,Location:"http".concat(L.opts.secure?"s":"","://").concat(_,".").concat(L.opts.endpoint,"/").concat(h),VersionID:c.headers["x-tos-version-id"],HashCrc64ecma:c.headers["x-tos-hash-crc64ecma"]?+c.headers["x-tos-hash-crc64ecma"]:0}}));case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",0===l?x():N());case 62:case"end":return e.stop()}var $}),e,this,[[39,53]])}))),_resumableCopyObject.apply(this,arguments)}function isCancelError$1(e){return e instanceof CancelError}function getAllTasks$1(e,t){for(var r=[],n=0;;++n){var i=n*t,o=Math.min(t,e-i);if(r.push({offset:i,partSize:o,partNumber:n+1}),(n+1)*t>=e)break}return r}function getDefaultCheckpointFilePath$1(e){return[e.srcBucket,e.srcKey,e.srcVersionId,e.bucket,e.key,"copy"].filter(Boolean).join(".").replace(/[\\/]/g,"")}function putBucketPolicy(e){return _putBucketPolicy.apply(this,arguments)}function _putBucketPolicy(){return(_putBucketPolicy=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.policy.Statement.length){e.next=2;break}return e.abrupt("return",deleteBucketPolicy.call(this,t.bucket));case 2:return e.next=4,this.fetchBucket(t.bucket,"PUT",{policy:""},{},t.policy,{needMd5:!0});case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getBucketPolicy(e){return _getBucketPolicy.apply(this,arguments)}function _getBucketPolicy(){return _getBucketPolicy=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchBucket(t,"GET",{policy:""},{});case 3:return(r=e.sent).data.Statement.forEach((function(e){var t=makeArrayProp(e);t("Action"),Object.keys(e.Condition||{}).forEach((function(r){Object.keys(e.Condition[r]).forEach((function(e){t('Condition["'.concat(r,'"]["').concat(e,'"]'))}))})),t("Principal"),t("Resource")})),e.abrupt("return",r);case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",handleEmptyServerError(e.t0,{Statement:[],Version:"2012-10-17"}));case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),_getBucketPolicy.apply(this,arguments)}function deleteBucketPolicy(e){return _deleteBucketPolicy.apply(this,arguments)}function _deleteBucketPolicy(){return(_deleteBucketPolicy=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchBucket(t,"DELETE",{policy:""},{}));case 1:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getBucketVersioning(e){return _getBucketVersioning.apply(this,arguments)}function _getBucketVersioning(){return(_getBucketVersioning=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchBucket(t,"GET",{versioning:""},{}));case 1:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function putBucketVersioning(e){return _putBucketVersioning.apply(this,arguments)}function _putBucketVersioning(){return(_putBucketVersioning=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchBucket(t.bucket,"PUT",{versioning:""},{},{Status:t.status}));case 1:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function preSignedPolicyURL(e){var t=normalizeInput.call(this,e);validateConditions(e.conditions);var r=e.alternativeEndpoint||"".concat(t.bucket,".").concat(this.opts.endpoint),n="http".concat(this.opts.secure?"s":"","://").concat(r),i=obj2QueryStr(this.getSignatureQuery({bucket:t.bucket,expires:t.expires,policy:{conditions:t.conditions}}));return{getSignedURLForList:function(e){var t=obj2QueryStr(e),r=[i,t].filter(Boolean).join("&");return"".concat(n,"?").concat(r)},getSignedURLForGetOrHead:function(e,t){var r=obj2QueryStr(t),o=[i,r].filter(Boolean).join("&"),a=encodeURIComponent(e);return"".concat(n,"/").concat(a,"?").concat(o)},signedQuery:i}}function normalizeInput(e){var t=e.bucket||this.opts.bucket;if(!t)throw new TosClientError("Must provide bucket param");validateConditions(e.conditions);var r=e.conditions.map((function(e){return[e.operator||"eq","$key",e.value]}));return r.push(["eq","$bucket",t]),{bucket:t,expires:e.expires||3600,conditions:r}}function validateConditions(e){if(e.length<1)throw new TosClientError("The `conditions` field of `PreSignedPolicyURLInput` must has one item at least");var t,r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if("key"!==n.key)throw new TosClientError("The `key` field of `PolicySignatureCondition` must be `'key'`");if(n.operator&&"eq"!==n.operator&&"starts-with"!==n.operator)throw new TosClientError("The `operator` field of `PolicySignatureCondition` must be `'eq'` or `'starts-with'`")}}catch(err2){r.e(err2)}finally{r.f()}}function downloadFile(e){return _downloadFile.apply(this,arguments)}function _downloadFile(){return(_downloadFile=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new TosClientError("`downloadFile` is not supported in browser environment");case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function getBucketLocation(e){return _getBucketLocation.apply(this,arguments)}function _getBucketLocation(){return(_getBucketLocation=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.abrupt("return",this.fetchBucket(r,"GET",{location:""},{}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getBucketCORS(e){return _getBucketCORS.apply(this,arguments)}function _getBucketCORS(){return(_getBucketCORS=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.abrupt("return",this.fetchBucket(r,"GET",{cors:""},{}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function putBucketCORS(e){return _putBucketCORS.apply(this,arguments)}function _putBucketCORS(){return(_putBucketCORS=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,n=t.CORSRules,e.abrupt("return",this.fetchBucket(r,"PUT",{cors:""},{},{CORSRules:n}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function deleteBucketCORS(e){return _deleteBucketCORS.apply(this,arguments)}function _deleteBucketCORS(){return(_deleteBucketCORS=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.abrupt("return",this.fetchBucket(r,"DELETE",{cors:""},{}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function listObjectsType2(){return _listObjectsType.apply(this,arguments)}function _listObjectsType(){return _listObjectsType=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=o.length>0&&void 0!==o[0]?o[0]:{}).bucket,r=_objectWithoutProperties(t,_excluded4),e.next=4,this.fetchBucket(t.bucket,"GET",_objectSpread2({"list-type":2},covertCamelCase2Kebab(r)),{});case 4:return n=e.sent,(i=makeArrayProp(n.data))("CommonPrefixes"),i("Contents"),e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)}))),_listObjectsType.apply(this,arguments)}function putBucketLifecycle(e){return _putBucketLifecycle.apply(this,arguments)}function _putBucketLifecycle(){return(_putBucketLifecycle=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,n=t.rules,e.abrupt("return",this.fetchBucket(r,"PUT",{lifecycle:""},{},{Rules:n}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getBucketLifecycle(e){return _getBucketLifecycle.apply(this,arguments)}function _getBucketLifecycle(){return(_getBucketLifecycle=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.abrupt("return",this.fetchBucket(r,"GET",{lifecycle:""},{}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function deleteBucketLifecycle(e){return _deleteBucketLifecycle.apply(this,arguments)}function _deleteBucketLifecycle(){return(_deleteBucketLifecycle=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.abrupt("return",this.fetchBucket(r,"DELETE",{lifecycle:""},{}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function putBucketEncryption(e){return _putBucketEncryption.apply(this,arguments)}function _putBucketEncryption(){return(_putBucketEncryption=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,n=t.rule,e.abrupt("return",this.fetchBucket(r,"PUT",{encryption:""},{"Content-MD5":hashMd5(JSON.stringify({Rule:n}),"base64")},{Rule:n}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getBucketEncryption(e){return _getBucketEncryption.apply(this,arguments)}function _getBucketEncryption(){return(_getBucketEncryption=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.abrupt("return",this.fetchBucket(r,"GET",{encryption:""},{}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function deleteBucketEncryption(e){return _deleteBucketEncryption.apply(this,arguments)}function _deleteBucketEncryption(){return(_deleteBucketEncryption=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.abrupt("return",this.fetchBucket(r,"DELETE",{encryption:""},{}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}BucketVersioningStatus2=BucketVersioningStatus||(BucketVersioningStatus={}),BucketVersioningStatus2.Enable="Enabled",BucketVersioningStatus2.Suspended="Suspended",BucketVersioningStatus2.Disable="",DownloadEventType2=DownloadEventType||(DownloadEventType={}),DownloadEventType2[DownloadEventType2.CreateTempFileSucceed=1]="CreateTempFileSucceed",DownloadEventType2[DownloadEventType2.CreateTempFileFailed=2]="CreateTempFileFailed",DownloadEventType2[DownloadEventType2.DownloadPartSucceed=3]="DownloadPartSucceed",DownloadEventType2[DownloadEventType2.DownloadPartFailed=4]="DownloadPartFailed",DownloadEventType2[DownloadEventType2.DownloadPartAborted=5]="DownloadPartAborted",DownloadEventType2[DownloadEventType2.RenameTempFileSucceed=6]="RenameTempFileSucceed",DownloadEventType2[DownloadEventType2.RenameTempFileFailed=7]="RenameTempFileFailed";var CommonQueryKey="mirror";function putBucketMirrorBack(e){return _putBucketMirrorBack.apply(this,arguments)}function _putBucketMirrorBack(){return(_putBucketMirrorBack=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,n=t.rules,e.abrupt("return",this.fetchBucket(r,"PUT",_defineProperty$1({},CommonQueryKey,""),{},{Rules:n}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getBucketMirrorBack(e){return _getBucketMirrorBack.apply(this,arguments)}function _getBucketMirrorBack(){return(_getBucketMirrorBack=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.prev=1,e.next=4,this.fetchBucket(r,"GET",_defineProperty$1({},CommonQueryKey,""),{});case 4:return e.abrupt("return",e.sent);case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",handleEmptyServerError(e.t0,{Rules:[]}));case 10:case"end":return e.stop()}}),e,this,[[1,7]])})))).apply(this,arguments)}function deleteBucketMirrorBack(e){return _deleteBucketMirrorBack.apply(this,arguments)}function _deleteBucketMirrorBack(){return(_deleteBucketMirrorBack=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.abrupt("return",this.fetchBucket(r,"DELETE",_defineProperty$1({},CommonQueryKey,""),{}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}var CommonQueryKey$1="tagging";function putObjectTagging(e){return _putObjectTagging.apply(this,arguments)}function _putObjectTagging(){return(_putObjectTagging=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.tagSet,n=t.versionId,i=normalizeHeadersKey({versionId:n}),e.abrupt("return",this.fetchObject(t,"PUT",_objectSpread2(_defineProperty$1({},CommonQueryKey$1,""),i),{},{TagSet:r}));case 3:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getObjectTagging(e){return _getObjectTagging.apply(this,arguments)}function _getObjectTagging(){return(_getObjectTagging=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.versionId,n=normalizeHeadersKey({versionId:r}),e.abrupt("return",this.fetchObject(t,"GET",_objectSpread2(_defineProperty$1({},CommonQueryKey$1,""),n),{}));case 3:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function deleteObjectTagging(e){return _deleteObjectTagging.apply(this,arguments)}function _deleteObjectTagging(){return(_deleteObjectTagging=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.versionId,n=normalizeHeadersKey({versionId:r}),e.abrupt("return",this.fetchObject(t,"DELETE",_objectSpread2(_defineProperty$1({},CommonQueryKey$1,""),n),{}));case 3:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}var CommonQueryKey$2="replication";function putBucketReplication(e){return _putBucketReplication.apply(this,arguments)}function _putBucketReplication(){return(_putBucketReplication=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,n=t.rules,i=t.role,e.abrupt("return",this.fetchBucket(r,"PUT",_defineProperty$1({},CommonQueryKey$2,""),{},{Role:i,Rules:n}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getBucketReplication(e){return _getBucketReplication.apply(this,arguments)}function _getBucketReplication(){return(_getBucketReplication=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,n=t.progress,i=t.ruleId,o=normalizeHeadersKey({progress:n,ruleId:i}),e.prev=2,e.next=5,this.fetchBucket(r,"GET",_objectSpread2(_defineProperty$1({},CommonQueryKey$2,""),o),{});case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",handleEmptyServerError(e.t0,{Rules:[],Role:""}));case 11:case"end":return e.stop()}}),e,this,[[2,8]])})))).apply(this,arguments)}function deleteBucketReplication(e){return _deleteBucketReplication.apply(this,arguments)}function _deleteBucketReplication(){return(_deleteBucketReplication=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.abrupt("return",this.fetchBucket(r,"DELETE",_defineProperty$1({},CommonQueryKey$2,""),{}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}var CommonQueryKey$3="website";function putBucketWebsite(e){return _putBucketWebsite.apply(this,arguments)}function _putBucketWebsite(){return(_putBucketWebsite=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,n=_objectWithoutProperties(t,_excluded5),i=convertNormalCamelCase2Upper(n),e.abrupt("return",this.fetchBucket(r,"PUT",_defineProperty$1({},CommonQueryKey$3,""),{},_objectSpread2({},i)));case 3:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getBucketWebsite(e){return _getBucketWebsite.apply(this,arguments)}function _getBucketWebsite(){return(_getBucketWebsite=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.prev=1,e.abrupt("return",this.fetchBucket(r,"GET",_defineProperty$1({},CommonQueryKey$3,""),{}));case 5:return e.prev=5,e.t0=e.catch(1),e.abrupt("return",handleEmptyServerError(e.t0,{RoutingRules:[]}));case 8:case"end":return e.stop()}}),e,this,[[1,5]])})))).apply(this,arguments)}function deleteBucketWebsite(e){return _deleteBucketWebsite.apply(this,arguments)}function _deleteBucketWebsite(){return(_deleteBucketWebsite=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.abrupt("return",this.fetchBucket(r,"DELETE",_defineProperty$1({},CommonQueryKey$3,""),{}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}var CommonQueryKey$4="notification";function putBucketNotification(e){return _putBucketNotification.apply(this,arguments)}function _putBucketNotification(){return(_putBucketNotification=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,n=_objectWithoutProperties(t,_excluded6),i=convertNormalCamelCase2Upper(n),e.abrupt("return",this.fetchBucket(r,"PUT",_defineProperty$1({},CommonQueryKey$4,""),{},_objectSpread2({},i)));case 3:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getBucketNotification(e){return _getBucketNotification.apply(this,arguments)}function _getBucketNotification(){return(_getBucketNotification=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.prev=1,e.next=4,this.fetchBucket(r,"GET",_defineProperty$1({},CommonQueryKey$4,""),{});case 4:return e.abrupt("return",e.sent);case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",handleEmptyServerError(e.t0,{CloudFunctionConfigurations:[],RocketMQConfigurations:[]}));case 10:case"end":return e.stop()}}),e,this,[[1,7]])})))).apply(this,arguments)}var CommonQueryKey$5="customdomain";function putBucketCustomDomain(e){return _putBucketCustomDomain.apply(this,arguments)}function _putBucketCustomDomain(){return(_putBucketCustomDomain=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,n=_objectWithoutProperties(t,_excluded7),i=convertNormalCamelCase2Upper(n),e.abrupt("return",this.fetchBucket(r,"PUT",_defineProperty$1({},CommonQueryKey$5,""),{},_objectSpread2({},i)));case 3:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getBucketCustomDomain(e){return _getBucketCustomDomain.apply(this,arguments)}function _getBucketCustomDomain(){return(_getBucketCustomDomain=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.bucket,e.next=4,this.fetchBucket(r,"GET",_defineProperty$1({},CommonQueryKey$5,""),{});case 4:return e.abrupt("return",e.sent);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",handleEmptyServerError(e.t0,{CustomDomainRules:[]}));case 10:case"end":return e.stop()}}),e,this,[[0,7]])})))).apply(this,arguments)}function deleteBucketCustomDomain(e){return _deleteBucketCustomDomain.apply(this,arguments)}function _deleteBucketCustomDomain(){return(_deleteBucketCustomDomain=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,n=t.customDomain,e.abrupt("return",this.fetchBucket(r,"DELETE",{customdomain:n},{}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}var CommonQueryKey$6="realtimeLog",ScheduleFrequency,ScheduleFrequency2,IncludedObjectVersions,IncludedObjectVersions2,InventoryOptionalFields,InventoryOptionalFields2;function putBucketRealTimeLog(e){return _putBucketRealTimeLog.apply(this,arguments)}function _putBucketRealTimeLog(){return(_putBucketRealTimeLog=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,n=_objectWithoutProperties(t,_excluded8),i=convertNormalCamelCase2Upper(n),e.abrupt("return",this.fetchBucket(r,"PUT",_defineProperty$1({},CommonQueryKey$6,""),{},_objectSpread2({},i)));case 3:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getBucketRealTimeLog(e){return _getBucketRealTimeLog.apply(this,arguments)}function _getBucketRealTimeLog(){return(_getBucketRealTimeLog=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.prev=1,e.next=4,this.fetchBucket(r,"GET",_defineProperty$1({},CommonQueryKey$6,""),{});case 4:return e.abrupt("return",e.sent);case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",handleEmptyServerError(e.t0,{}));case 10:case"end":return e.stop()}}),e,this,[[1,7]])})))).apply(this,arguments)}function deleteBucketRealTimeLog(e){return _deleteBucketRealTimeLog.apply(this,arguments)}function _deleteBucketRealTimeLog(){return(_deleteBucketRealTimeLog=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.abrupt("return",this.fetchBucket(r,"DELETE",_defineProperty$1({},CommonQueryKey$6,""),{}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getBucketInventory(e){return _getBucketInventory.apply(this,arguments)}function _getBucketInventory(){return(_getBucketInventory=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchBucket(t.bucket,"GET",{inventory:"",id:t.id},{});case 3:return r=e.sent,e.abrupt("return",r);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",handleEmptyServerError(e.t0,void 0));case 10:case"end":return e.stop()}}),e,this,[[0,7]])})))).apply(this,arguments)}function listBucketInventory(e){return _listBucketInventory.apply(this,arguments)}function _listBucketInventory(){return(_listBucketInventory=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=_objectSpread2({inventory:""},t.continuationToken?{"continuation-token":t.continuationToken}:null),e.prev=1,e.next=4,this.fetchBucket(t.bucket,"GET",r,{});case 4:return n=e.sent,e.abrupt("return",n);case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",handleEmptyServerError(e.t0,{InventoryConfigurations:[]}));case 11:case"end":return e.stop()}}),e,this,[[1,8]])})))).apply(this,arguments)}function deleteBucketInventory(e){return _deleteBucketInventory.apply(this,arguments)}function _deleteBucketInventory(){return(_deleteBucketInventory=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchBucket(t.bucket,"DELETE",{inventory:"",id:t.id},{}));case 1:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function putBucketInventory(e){return this.fetchBucket(e.bucket,"PUT",{inventory:"",id:e.inventoryConfiguration.Id},{},e.inventoryConfiguration)}function createJob(e){return _createJob.apply(this,arguments)}function _createJob(){return(_createJob=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.accountId,n=_objectWithoutProperties(t,_excluded9),i=convertNormalCamelCase2Upper(n),e.next=4,this.fetch("POST","/jobs",{},{"x-tos-account-id":r},_objectSpread2({},i));case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function listJobs(e){return _listJobs.apply(this,arguments)}function _listJobs(){return(_listJobs=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.accountId,n=t.jobStatuses,i=void 0===n?"":n,o=t.maxResults,a=void 0===o?1e3:o,s=t.nextToken,c=void 0===s?"":s,e.next=3,this.fetch("GET","/jobs",{jobStatuses:i,maxResults:a,nextToken:c},{"x-tos-account-id":r},{},{axiosOpts:{paramsSerializer:paramsSerializer}});case 3:return u=e.sent,e.abrupt("return",u);case 5:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function updateJobPriority(e){return _updateJobPriority.apply(this,arguments)}function _updateJobPriority(){return(_updateJobPriority=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.accountId,n=t.jobId,i=t.priority,e.next=3,this.fetch("POST","/jobs/".concat(n,"/priority"),{priority:i},{"x-tos-account-id":r},{},{needMd5:!0});case 3:return o=e.sent,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function updateJobStatus(e){return _updateJobStatus.apply(this,arguments)}function _updateJobStatus(){return(_updateJobStatus=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.accountId,n=t.jobId,i=t.requestedJobStatus,o=t.statusUpdateReason,e.next=3,this.fetch("POST","/jobs/".concat(n,"/status"),{requestedJobStatus:i,statusUpdateReason:o},{"x-tos-account-id":r},{},{needMd5:!0});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function deleteJob(e){return _deleteJob.apply(this,arguments)}function _deleteJob(){return(_deleteJob=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.accountId,n=t.JobId,e.next=3,this.fetch("DELETE","/jobs/".concat(n),{},{"x-tos-account-id":r},{});case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function describeJob(e){return _describeJob.apply(this,arguments)}function _describeJob(){return(_describeJob=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.accountId,n=t.JobId,e.next=3,this.fetch("GET","/jobs/".concat(n),{},{"x-tos-account-id":r},{});case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function putBucketTagging(e){return _putBucketTagging.apply(this,arguments)}function _putBucketTagging(){return(_putBucketTagging=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchBucket(t.bucket,"PUT",{tagging:""},{},t.tagging,{needMd5:!0});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getBucketTagging(e){return _getBucketTagging.apply(this,arguments)}function _getBucketTagging(){return(_getBucketTagging=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.prev=1,e.next=4,this.fetchBucket(r,"GET",{tagging:""},{});case 4:return n=e.sent,e.abrupt("return",n);case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",handleEmptyServerError(e.t0,{TagSet:{Tags:[]}}));case 11:case"end":return e.stop()}}),e,this,[[1,8]])})))).apply(this,arguments)}function deleteBucketTagging(e){return _deleteBucketTagging.apply(this,arguments)}function _deleteBucketTagging(){return(_deleteBucketTagging=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.abrupt("return",this.fetchBucket(r,"DELETE",{tagging:""},{}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function putBucketPayByTraffic(e){return _putBucketPayByTraffic.apply(this,arguments)}function _putBucketPayByTraffic(){return(_putBucketPayByTraffic=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchBucket(t.bucket,"PUT",{payByTraffic:""},{},t.payByTraffic);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getBucketPayByTraffic(e){return _getBucketPayByTraffic.apply(this,arguments)}function _getBucketPayByTraffic(){return(_getBucketPayByTraffic=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.next=3,this.fetchBucket(r,"GET",{payByTraffic:""},{});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getBucketImageStyleList(e){return _getBucketImageStyleList.apply(this,arguments)}function _getBucketImageStyleList(){return(_getBucketImageStyleList=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchBucket(t,"GET",{imageStyle:""},{});case 3:return r=e.sent,e.abrupt("return",r);case 7:if(e.prev=7,e.t0=e.catch(0),!(e.t0 instanceof TosServerError)){e.next=12;break}if(404!==e.t0.statusCode){e.next=12;break}return e.abrupt("return",this.getNormalDataFromError({ImageStyles:[]},e.t0));case 12:throw e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,7]])})))).apply(this,arguments)}function getBucketImageStyle(e,t){return _getBucketImageStyle.apply(this,arguments)}function _getBucketImageStyle(){return(_getBucketImageStyle=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchBucket(t,"GET",{imageStyle:"",styleName:r},{});case 3:return n=e.sent,e.abrupt("return",n);case 7:if(e.prev=7,e.t0=e.catch(0),!(e.t0 instanceof TosServerError)){e.next=12;break}if(404!==e.t0.statusCode){e.next=12;break}return e.abrupt("return",this.getNormalDataFromError(null,e.t0));case 12:throw e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,7]])})))).apply(this,arguments)}function putBucketImageStyle(e,t,r){return _putBucketImageStyle.apply(this,arguments)}function _putBucketImageStyle(){return(_putBucketImageStyle=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchBucket(t,"PUT",{imageStyle:"",styleName:r},{},{Content:n});case 3:return i=e.sent,e.abrupt("return",i);case 7:if(e.prev=7,e.t0=e.catch(0),!(e.t0 instanceof TosServerError)){e.next=12;break}if(404!==e.t0.statusCode){e.next=12;break}return e.abrupt("return",this.getNormalDataFromError(null,e.t0));case 12:throw e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,7]])})))).apply(this,arguments)}function deleteBucketImageStyle(e,t){return _deleteBucketImageStyle.apply(this,arguments)}function _deleteBucketImageStyle(){return(_deleteBucketImageStyle=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchBucket(t,"DELETE",{imageStyle:"",styleName:r},{});case 3:return n=e.sent,e.abrupt("return",n);case 7:if(e.prev=7,e.t0=e.catch(0),!(e.t0 instanceof TosServerError)){e.next=12;break}if(404!==e.t0.statusCode){e.next=12;break}return e.abrupt("return",this.getNormalDataFromError(null,e.t0));case 12:throw e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,7]])})))).apply(this,arguments)}function putBucketImageProtect(e,t){return _putBucketImageProtect.apply(this,arguments)}function _putBucketImageProtect(){return(_putBucketImageProtect=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchBucket(t,"PUT",{originalImageProtect:""},{},r);case 3:return n=e.sent,e.abrupt("return",n);case 7:if(e.prev=7,e.t0=e.catch(0),!(e.t0 instanceof TosServerError)){e.next=12;break}if(404!==e.t0.statusCode){e.next=12;break}return e.abrupt("return",this.getNormalDataFromError(null,e.t0));case 12:throw e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,7]])})))).apply(this,arguments)}function getBucketImageProtect(e){return _getBucketImageProtect.apply(this,arguments)}function _getBucketImageProtect(){return(_getBucketImageProtect=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchBucket(t,"GET",{originalImageProtect:""},{});case 3:return r=e.sent,e.abrupt("return",r);case 7:if(e.prev=7,e.t0=e.catch(0),!(e.t0 instanceof TosServerError)){e.next=12;break}if(404!==e.t0.statusCode){e.next=12;break}return e.abrupt("return",this.getNormalDataFromError(null,e.t0));case 12:throw e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,7]])})))).apply(this,arguments)}function putBucketImageStyleSeparator(e,t){return _putBucketImageStyleSeparator.apply(this,arguments)}function _putBucketImageStyleSeparator(){return(_putBucketImageStyleSeparator=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchBucket(t,"PUT",{imageStyleSeparator:""},{},{Separator:r});case 3:return n=e.sent,e.abrupt("return",n);case 7:if(e.prev=7,e.t0=e.catch(0),!(e.t0 instanceof TosServerError)){e.next=12;break}if(404!==e.t0.statusCode){e.next=12;break}return e.abrupt("return",this.getNormalDataFromError(null,e.t0));case 12:throw e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,7]])})))).apply(this,arguments)}function getBucketImageStyleSeparator(e){return _getBucketImageStyleSeparator.apply(this,arguments)}function _getBucketImageStyleSeparator(){return(_getBucketImageStyleSeparator=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchBucket(t,"GET",{imageStyleSeparator:""},{});case 3:return r=e.sent,e.abrupt("return",r);case 7:if(e.prev=7,e.t0=e.catch(0),!(e.t0 instanceof TosServerError)){e.next=12;break}if(404!==e.t0.statusCode){e.next=12;break}return e.abrupt("return",this.getNormalDataFromError(null,e.t0));case 12:throw e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,7]])})))).apply(this,arguments)}function getBucketIntelligenttiering(e){return _getBucketIntelligenttiering.apply(this,arguments)}function _getBucketIntelligenttiering(){return(_getBucketIntelligenttiering=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchBucket(t,"GET",{intelligenttiering:""},{});case 3:return r=e.sent,e.abrupt("return",r);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",handleEmptyServerError(e.t0,{}));case 10:case"end":return e.stop()}}),e,this,[[0,7]])})))).apply(this,arguments)}ScheduleFrequency2=ScheduleFrequency||(ScheduleFrequency={}),ScheduleFrequency2.Daily="Daily",ScheduleFrequency2.Weekly="Weekly",IncludedObjectVersions2=IncludedObjectVersions||(IncludedObjectVersions={}),IncludedObjectVersions2.All="All",IncludedObjectVersions2.Current="Current",InventoryOptionalFields2=InventoryOptionalFields||(InventoryOptionalFields={}),InventoryOptionalFields2.Size="Size",InventoryOptionalFields2.LastModifiedDat="LastModifiedDate",InventoryOptionalFields2.ETag="ETag",InventoryOptionalFields2.StorageClass="StorageClass",InventoryOptionalFields2.IsMultipartUploaded="IsMultipartUploaded",InventoryOptionalFields2.EncryptionStatus="EncryptionStatus",InventoryOptionalFields2.CRC64="CRC64";var CommonQueryKey$7="rename",TierType,TierType2;function putBucketRename(e){return _putBucketRename.apply(this,arguments)}function _putBucketRename(){return(_putBucketRename=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,n=_objectWithoutProperties(t,_excluded10),i=convertNormalCamelCase2Upper(n),e.abrupt("return",this.fetchBucket(r,"PUT",_defineProperty$1({},CommonQueryKey$7,""),{},_objectSpread2({},i)));case 3:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function getBucketRename(e){return _getBucketRename.apply(this,arguments)}function _getBucketRename(){return(_getBucketRename=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.next=3,this.fetchBucket(r,"GET",_defineProperty$1({},CommonQueryKey$7,""),{});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function deleteBucketRename(e){return _deleteBucketRename.apply(this,arguments)}function _deleteBucketRename(){return(_deleteBucketRename=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bucket,e.abrupt("return",this.fetchBucket(r,"DELETE",_defineProperty$1({},CommonQueryKey$7,""),{}));case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function restoreObject(e){return _restoreObject.apply(this,arguments)}function _restoreObject(){return(_restoreObject=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.bucket,t.key,r=t.versionId,n=_objectWithoutProperties(t,_excluded11),i={restore:""},r&&(i.versionId=r),o=convertNormalCamelCase2Upper(n),e.abrupt("return",this.fetchObject(t,"POST",i,{},o));case 5:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}TierType2=TierType||(TierType={}),TierType2.TierStandard="Standard",TierType2.TierExpedited="Expedited",TierType2.TierBulk="Bulk";var CancelToken=axios$1.CancelToken,TosClient=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;_classCallCheck(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).createBucket=createBucket,e.headBucket=headBucket,e.deleteBucket=deleteBucket,e.listBuckets=listBuckets,e.getBucketLocation=getBucketLocation,e.putBucketStorageClass=putBucketStorageClass,e.getBucketAcl=getBucketAcl,e.putBucketAcl=putBucketAcl,e.getBucketPolicy=getBucketPolicy,e.putBucketPolicy=putBucketPolicy,e.deleteBucketPolicy=deleteBucketPolicy,e.getBucketVersioning=getBucketVersioning,e.putBucketVersioning=putBucketVersioning,e.getBucketCORS=getBucketCORS,e.putBucketCORS=putBucketCORS,e.deleteBucketCORS=deleteBucketCORS,e.putBucketLifecycle=putBucketLifecycle,e.getBucketLifecycle=getBucketLifecycle,e.deleteBucketLifecycle=deleteBucketLifecycle,e.putBucketEncryption=putBucketEncryption,e.getBucketEncryption=getBucketEncryption,e.deleteBucketEncryption=deleteBucketEncryption,e.putBucketMirrorBack=putBucketMirrorBack,e.getBucketMirrorBack=getBucketMirrorBack,e.deleteBucketMirrorBack=deleteBucketMirrorBack,e.putBucketReplication=putBucketReplication,e.getBucketReplication=getBucketReplication,e.deleteBucketReplication=deleteBucketReplication,e.putBucketWebsite=putBucketWebsite,e.getBucketWebsite=getBucketWebsite,e.deleteBucketWebsite=deleteBucketWebsite,e.putBucketNotification=putBucketNotification,e.getBucketNotification=getBucketNotification,e.putBucketCustomDomain=putBucketCustomDomain,e.getBucketCustomDomain=getBucketCustomDomain,e.deleteBucketCustomDomain=deleteBucketCustomDomain,e.putBucketRealTimeLog=putBucketRealTimeLog,e.getBucketRealTimeLog=getBucketRealTimeLog,e.deleteBucketRealTimeLog=deleteBucketRealTimeLog,e.getBucketInventory=getBucketInventory,e.listBucketInventory=listBucketInventory,e.putBucketInventory=putBucketInventory,e.deleteBucketInventory=deleteBucketInventory,e.putBucketTagging=putBucketTagging,e.getBucketTagging=getBucketTagging,e.deleteBucketTagging=deleteBucketTagging,e.putBucketPayByTraffic=putBucketPayByTraffic,e.getBucketPayByTraffic=getBucketPayByTraffic,e.getBucketImageStyle=getBucketImageStyle,e.getBucketImageStyleList=getBucketImageStyleList,e.deleteBucketImageStyle=deleteBucketImageStyle,e.putBucketImageStyle=putBucketImageStyle,e.putBucketImageStyleSeparator=putBucketImageStyleSeparator,e.putBucketImageProtect=putBucketImageProtect,e.getBucketImageProtect=getBucketImageProtect,e.getBucketImageStyleSeparator=getBucketImageStyleSeparator,e.putBucketRename=putBucketRename,e.getBucketRename=getBucketRename,e.deleteBucketRename=deleteBucketRename,e.copyObject=copyObject,e.resumableCopyObject=resumableCopyObject,e.deleteObject=deleteObject,e.deleteMultiObjects=deleteMultiObjects,e.getObject=getObject,e.getObjectV2=getObjectV2,e.getObjectToFile=getObjectToFile,e.getObjectAcl=getObjectAcl,e.headObject=headObject,e.appendObject=appendObject,e.listObjects=listObjects,e.listObjectsType2=listObjectsType2,e.listObjectVersions=listObjectVersions,e.putObject=putObject,e.putObjectFromFile=putObjectFromFile,e.putObjectAcl=putObjectAcl,e.setObjectMeta=setObjectMeta,e.createMultipartUpload=createMultipartUpload,e.uploadPart=uploadPart,e.uploadPartFromFile=uploadPartFromFile,e.completeMultipartUpload=completeMultipartUpload,e.abortMultipartUpload=abortMultipartUpload,e.uploadPartCopy=uploadPartCopy,e.listMultipartUploads=listMultipartUploads,e.listParts=listParts,e.downloadFile=downloadFile,e.putObjectTagging=putObjectTagging,e.getObjectTagging=getObjectTagging,e.deleteObjectTagging=deleteObjectTagging,e.listJobs=listJobs,e.createJob=createJob,e.deleteJob=deleteJob,e.describeJob=describeJob,e.updateJobStatus=updateJobStatus,e.updateJobPriority=updateJobPriority,e.restoreObject=restoreObject,e.uploadFile=uploadFile,e.getPreSignedUrl=getPreSignedUrl,e.calculatePostSignature=calculatePostSignature,e.preSignedPostSignature=calculatePostSignature,e.preSignedPolicyURL=preSignedPolicyURL,e.getBucketIntelligenttiering=getBucketIntelligenttiering,e}return _createClass(r)}(TOSBase);TosClient.TosServerError=TosServerError,TosClient.isCancel=isCancelError,TosClient.CancelError=CancelError,TosClient.TosServerCode=TosServerCode,TosClient.TosClientError=TosClientError,TosClient.CancelToken=CancelToken,TosClient.ACLType=ACLType,TosClient.StorageClassType=StorageClassType,TosClient.MetadataDirectiveType=MetadataDirectiveType,TosClient.AzRedundancyType=AzRedundancyType,TosClient.PermissionType=PermissionType,TosClient.GranteeType=GranteeType,TosClient.CannedType=CannedType,TosClient.HttpMethodType=HttpMethodType;var sparkMd5={exports:{}};!function(e,t){e.exports=function(e){var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(e,t){var r=e[0],n=e[1],i=e[2],o=e[3];n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+t[1]-389564586|0)<<12|o>>>20)+r|0)&r|~o&n)+t[2]+606105819|0)<<17|i>>>15)+o|0)&o|~i&r)+t[3]-1044525330|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+t[5]+1200080426|0)<<12|o>>>20)+r|0)&r|~o&n)+t[6]-1473231341|0)<<17|i>>>15)+o|0)&o|~i&r)+t[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+t[9]-1958414417|0)<<12|o>>>20)+r|0)&r|~o&n)+t[10]-42063|0)<<17|i>>>15)+o|0)&o|~i&r)+t[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+t[13]-40341101|0)<<12|o>>>20)+r|0)&r|~o&n)+t[14]-1502002290|0)<<17|i>>>15)+o|0)&o|~i&r)+t[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+t[6]-1069501632|0)<<9|o>>>23)+r|0)&n|r&~n)+t[11]+643717713|0)<<14|i>>>18)+o|0)&r|o&~r)+t[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+t[10]+38016083|0)<<9|o>>>23)+r|0)&n|r&~n)+t[15]-660478335|0)<<14|i>>>18)+o|0)&r|o&~r)+t[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+t[14]-1019803690|0)<<9|o>>>23)+r|0)&n|r&~n)+t[3]-187363961|0)<<14|i>>>18)+o|0)&r|o&~r)+t[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+t[2]-51403784|0)<<9|o>>>23)+r|0)&n|r&~n)+t[7]+1735328473|0)<<14|i>>>18)+o|0)&r|o&~r)+t[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+t[8]-2022574463|0)<<11|o>>>21)+r|0)^r^n)+t[11]+1839030562|0)<<16|i>>>16)+o|0)^o^r)+t[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+t[4]+1272893353|0)<<11|o>>>21)+r|0)^r^n)+t[7]-155497632|0)<<16|i>>>16)+o|0)^o^r)+t[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+t[0]-358537222|0)<<11|o>>>21)+r|0)^r^n)+t[3]-722521979|0)<<16|i>>>16)+o|0)^o^r)+t[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+t[12]-421815835|0)<<11|o>>>21)+r|0)^r^n)+t[15]+530742520|0)<<16|i>>>16)+o|0)^o^r)+t[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+t[7]+1126891415|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[14]-1416354905|0)<<15|i>>>17)+o|0)|~r))+t[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+t[3]-1894986606|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[10]-1051523|0)<<15|i>>>17)+o|0)|~r))+t[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+t[15]-30611744|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[6]-1560198380|0)<<15|i>>>17)+o|0)|~r))+t[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+t[11]-1120210379|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[2]+718787259|0)<<15|i>>>17)+o|0)|~r))+t[9]-343485551|0)<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}function n(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function i(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function o(e){var t,i,o,a,s,c,u=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=u;t+=64)r(l,n(e.substring(t-64,t)));for(i=(e=e.substring(t-64)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<i;t+=1)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(r(l,o),t=0;t<16;t+=1)o[t]=0;return a=(a=8*u).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),c=parseInt(a[1],16)||0,o[14]=s,o[15]=c,r(l,o),l}function a(e){var t,n,o,a,s,c,u=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=u;t+=64)r(l,i(e.subarray(t-64,t)));for(n=(e=t-64<u?e.subarray(t-64):new Uint8Array(0)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)o[t>>2]|=e[t]<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(r(l,o),t=0;t<16;t+=1)o[t]=0;return a=(a=8*u).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),c=parseInt(a[1],16)||0,o[14]=s,o[15]=c,r(l,o),l}function s(e){var r,n="";for(r=0;r<4;r+=1)n+=t[e>>8*r+4&15]+t[e>>8*r&15];return n}function c(e){var t;for(t=0;t<e.length;t+=1)e[t]=s(e[t]);return e.join("")}function u(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function l(e,t){var r,n=e.length,i=new ArrayBuffer(n),o=new Uint8Array(i);for(r=0;r<n;r+=1)o[r]=e.charCodeAt(r);return t?o:i}function d(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function p(e,t,r){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e)),n.set(new Uint8Array(t),e.byteLength),r?n:n.buffer}function _(e){var t,r=[],n=e.length;for(t=0;t<n-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function h(){this.reset()}return c(o("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,n){var i,o,a,s,c=this.byteLength,u=t(r,c),l=c;return n!==e&&(l=t(n,c)),u>l?new ArrayBuffer(0):(i=l-u,o=new ArrayBuffer(i),a=new Uint8Array(o),s=new Uint8Array(this,u,i),a.set(s),o)}}(),h.prototype.append=function(e){return this.appendBinary(u(e)),this},h.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,i=this._buff.length;for(t=64;t<=i;t+=64)r(this._hash,n(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},h.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),r=c(this._hash),e&&(r=_(r)),this.reset(),r},h.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},h.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},h.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},h.prototype._finish=function(e,t){var n,i,o,a=t;if(e[a>>2]|=128<<(a%4<<3),a>55)for(r(this._hash,e),a=0;a<16;a+=1)e[a]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),o=parseInt(n[1],16)||0,e[14]=i,e[15]=o,r(this._hash,e)},h.hash=function(e,t){return h.hashBinary(u(e),t)},h.hashBinary=function(e,t){var r=c(o(e));return t?_(r):r},h.ArrayBuffer=function(){this.reset()},h.ArrayBuffer.prototype.append=function(e){var t,n=p(this._buff.buffer,e,!0),o=n.length;for(this._length+=e.byteLength,t=64;t<=o;t+=64)r(this._hash,i(n.subarray(t-64,t)));return this._buff=t-64<o?new Uint8Array(n.buffer.slice(t-64)):new Uint8Array(0),this},h.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n[t]<<(t%4<<3);return this._finish(o,i),r=c(this._hash),e&&(r=_(r)),this.reset(),r},h.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.ArrayBuffer.prototype.getState=function(){var e=h.prototype.getState.call(this);return e.buff=d(e.buff),e},h.ArrayBuffer.prototype.setState=function(e){return e.buff=l(e.buff,!0),h.prototype.setState.call(this,e)},h.ArrayBuffer.prototype.destroy=h.prototype.destroy,h.ArrayBuffer.prototype._finish=h.prototype._finish,h.ArrayBuffer.hash=function(e,t){var r=c(a(new Uint8Array(e)));return t?_(r):r},h}()}(sparkMd5);var sparkMd5Exports=sparkMd5.exports,SparkMD5=getDefaultExportFromCjs$1(sparkMd5Exports);function getFileMD5(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2097152;return new Promise((function(r,n){var i=Math.ceil(e.size/t),o=0,a=new SparkMD5.ArrayBuffer,s=new FileReader;function c(){var r=o*t,n=r+t;n>e.size&&(n=e.size),s.readAsArrayBuffer(e.slice(r,n))}s.onload=function(e){if(a.append(e.target.result),++o<i)c();else{var t=a.end();r(t)}},s.onerror=function(e){n(e)},c()}))}var UploaderCache=function(){function e(){_classCallCheck(this,e),_defineProperty$1(this,"md5",""),_defineProperty$1(this,"key",""),_defineProperty$1(this,"tokenKey",""),_defineProperty$1(this,"needReset",!1)}var t;return _createClass(e,[{key:"initMd5",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,getFileMD5(t);case 2:return this.md5=e.sent,this.key="uploader_".concat(this.md5),this.tokenKey="uploader_token_".concat(this.md5),e.abrupt("return",this.md5);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"saveTokenInfo",value:function(e){localStorage.setItem(this.tokenKey,JSON.stringify(e))}},{key:"_checkNeedReset",value:function(){return!!this.needReset&&(this.clearCheckPoint(),this.needReset=!1,!0)}},{key:"getTokenInfo",value:function(){return this._checkNeedReset()?null:this._getObjectBase(this.tokenKey)}},{key:"getCheckPoint",value:function(){return this._checkNeedReset()?null:this._getObjectBase(this.key)}},{key:"_getObjectBase",value:function(e){var t=localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(e2){return null}return null}},{key:"saveCheckPoint",value:function(e){localStorage.setItem(this.key,JSON.stringify(e))}},{key:"clearCheckPoint",value:function(){localStorage.removeItem(this.key),localStorage.removeItem(this.tokenKey)}}]),e}(),Uploader=function(){function e(){_classCallCheck(this,e),_defineProperty$1(this,"start",0),_defineProperty$1(this,"url",""),_defineProperty$1(this,"client",null),_defineProperty$1(this,"partSize",6291456),_defineProperty$1(this,"fileName",""),_defineProperty$1(this,"cache",null),_defineProperty$1(this,"cancelToken",null),this.cache=new UploaderCache}var t,r,n;return _createClass(e,[{key:"cacheStorage",value:function(e){this.cache.saveTokenInfo(e)}},{key:"getStorage",value:function(){return this.cache.getTokenInfo()}},{key:"setInfo",value:function(e){var t=e.fileName,r=e.region,n=e.accessKeyId,i=e.accessKeySecret,o=e.stsToken,a=e.bucket;this.fileName=t,this.client=new TosClient({region:r,accessKeyId:n,accessKeySecret:i,stsToken:o,bucket:a})}},{key:"initMD5",value:function(e){return this.cache.initMd5(e)}},{key:"upload",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.cancelToken=CancelToken.source(),e.prev=1,n={key:this.fileName,file:t,partSize:this.partSize,cancelToken:this.cancelToken.token,progress:function(e,t){i.cache.saveCheckPoint(t),r(100*e)}},this.checkPointCache&&(n.checkpoint=this.checkPointCache),e.next=6,this.client.uploadFile(n);case 6:e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return",{success:!1,data:e.t0});case 12:return this._clearCheckPoint(),e.abrupt("return",{success:!0});case 14:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e,t){return n.apply(this,arguments)})},{key:"pause",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.cancelToken.cancel("user call");case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"cancel",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.pause(),this._clearCheckPoint();case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"checkPoint",value:function(){return this.checkPointCache=this.cache.getCheckPoint(),!!this.checkPointCache}},{key:"_clearCheckPoint",value:function(){this.checkPointCache=null,this.cache.clearCheckPoint()}}]),e}(),UPLOAD_ACTION={SEND_REQ_URL:0,RECEIVE_URL:0,SEND_UPLOADED:1,RECEIVE_PROGRESS:1,RECEIVE_DOWNLOAD_DONE:2,SEND_CANCEL:8,RECEIVE_CANCEL:24},ACTIONS=Object.values(UPLOAD_ACTION),UploadMessenger=function(e){_inherits(n,e);var t,r=_createSuper(n);function n(e){var t;return _classCallCheck(this,n),_defineProperty$1(_assertThisInitialized(t=r.call(this,e)),"uploader",null),_defineProperty$1(_assertThisInitialized(t),"player",null),_defineProperty$1(_assertThisInitialized(t),"uploading",!1),_defineProperty$1(_assertThisInitialized(t),"fileQueue",[]),_defineProperty$1(_assertThisInitialized(t),"file",null),t.player=e,t.uploader=new Uploader,t}return _createClass(n,[{key:"handleResponse",value:function(e){this.player._debug&&console.warn("server UploadMessenger response: "+JSON.stringify(e));var t=e.data||e.result||{},r=t.action,n=t.carries;if(!ACTIONS.includes(r))return!1;var i=n.result;if(0!==i)return this.player.emit("on-send-file-message-error",{action:r,carries:n}),this.uploading=!1,this.logError(i),this._sendDone(!1,1),!0;if(r===UPLOAD_ACTION.RECEIVE_URL){var o=n.cloud_storage,a={ak:o.ak,sk:o.sk,bucket:o.bucket,region:o.region,stsToken:o.security_token,object:o.object};this.uploader.cacheStorage(a),this.startUpload(a)}else r===UPLOAD_ACTION.RECEIVE_PROGRESS?this.onProgress(50+.5*n.progress,n):r===UPLOAD_ACTION.RECEIVE_DOWNLOAD_DONE?this._onUploadDone(n):r===UPLOAD_ACTION.RECEIVE_CANCEL&&(this.player.emit("on-send-file-cancel",{reason:"from-server",action:r,carries:n}),this.uploader.cancel(),this.uploading=!1,this.log({name:"fileChannelSendOnCancel",elapse:"end",progress:!0}),this._sendDone(!1,2));return!0}},{key:"_onUploadDone",value:function(e){var t=e.folder,r=e.md5,n=e.name;t&&(this.options.folder=t),r&&(this.options.md5=r),n&&(this.options.name=n),this.player.emit("on-send-file-done",{carries:e}),this.log({name:"fileChannelSendOnComplete",elapse:"end"}),this.uploading=!1,this.nextTask(),this._sendDone(!1)}},{key:"startUpload",value:function(e){var t=this,r=e.ak,n=e.sk,i=e.bucket,o=e.region,a=e.stsToken,s=e.object;this.log({name:"fileChannelSendOnStart",elapse:"start"}),this.uploader.setInfo({fileName:s,region:o,accessKeyId:r,accessKeySecret:n,stsToken:a,bucket:i}),this.uploader.upload(this.file,(function(e){t.onProgress(.5*e)})).then((function(e){var r=e.success,n=e.data;r?t._send(UPLOAD_ACTION.SEND_UPLOADED):(t.player.emit("on-send-file-error",n),t.logError("-3","from_client:客户端上传失败"),t.uploading=!1,t._sendDone(!1,1))}))}},{key:"onProgress",value:function(e,t){this._logProgress=e,this.player.emit("on-send-file-progress",e,t)}},{key:"nextTask",value:function(){var e=this.fileQueue.shift();if(e){var t=e.file,r=e.options;this.sendFile(t,r),this.player.emit("on-send-file-info",{message:"自动执行下一个任务",options:r})}}},{key:"startSendFile",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return this.player.emit("on-send-file-error",{message:"请传入需要上传的文件",options:r}),e.abrupt("return",!1);case 3:if(!this.uploading){e.next=7;break}return this.player.emit("on-send-file-info",{message:"当前已有上传任务，新任务已加入队列",options:r}),this.fileQueue.push({file:t,options:r}),e.abrupt("return",!1);case 7:return this.file=t,this.uploading=!0,e.t0=r.name||t.name,e.next=12,this.uploader.initMD5(t);case 12:if(e.t1=e.sent,this.options={name:e.t0,md5:e.t1},r.folder&&(this.options.folder=r.folder),r.options&&(this.options.options=r.options),this.log({name:"fileChannelStartSendFile"}),!this.uploader.checkPoint()){e.next=24;break}return this.player._debug&&console.warn("sendFile: 命中断点续传",t,r),n=this.uploader.getStorage(),this.startUpload(n),e.abrupt("return",!0);case 24:return e.prev=24,this.player._debug&&console.warn("sendFile: ",t,r),this._send(UPLOAD_ACTION.SEND_REQ_URL),e.abrupt("return",!0);case 30:return e.prev=30,e.t2=e.catch(24),this.uploading=!1,e.abrupt("return",!1);case 34:case"end":return e.stop()}}),e,this,[[24,30]])}))),function(e,r){return t.apply(this,arguments)})},{key:"stopSendFile",value:function(){return!!this.uploading&&(this.uploading=!1,this.fileQueue=[],this.log({name:"fileChannelStopSendFile"}),this.uploader.cancel(),this._send(UPLOAD_ACTION.SEND_CANCEL),this.player.emit("on-send-file-cancel",{reason:"user-call"}),this._sendDone(!1,2),!0)}},{key:"logError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"from_pod";this.log({name:"fileChannelSendOnError",elapse:"end",progress:!0,error:getFileChannelError(e),oErrc:e,oMsg:t})}},{key:"log",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,r=e.error,i=e.oErrc,o=e.oMsg,a=e.elapse,s=e.progress;_get(_getPrototypeOf(n.prototype),"log",this).call(this,{name:t,error:r,elapse:a,progress:s,fileSize:this.file.length,oErrc:i,oMsg:o})}}]),n}(FileChannelMessenger),TosFileChannelHandler=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),(n=t.call(this,e)).room=new CacheRoom,n.uploadMessenger=new UploadMessenger(e),n.downloadMessenger=new DownloadMessenger(e),n}return _createClass(r,[{key:"initRoomId",value:function(e){var t=this.room.setId(e);this.uploadMessenger.uploader.cache.needReset=t,this.downloadMessenger.downloader.cache.needReset=t}},{key:"handleResponse",value:function(e){this.uploadMessenger.handleResponse(e)||this.downloadMessenger.handleResponse(e)}},{key:"startSendFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.player.client?this.uploadMessenger.startSendFile(e,t):console.warn("请先启动游戏")}},{key:"stopSendFile",value:function(){this.uploadMessenger.stopSendFile()}},{key:"pauseSendFile",value:function(){this.uploadMessenger.uploader.pause()}},{key:"stopReceiveFile",value:function(){this.downloadMessenger.stopReceiveFile()}},{key:"startPushFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.startSendFile(e,t)}},{key:"stopPushFile",value:function(){this.stopSendFile()}},{key:"startPullFile",value:function(e){var t=e.folder,r=e.name,n=e.returnUrl,i=void 0!==n&&n;this.downloadMessenger.sendDownload({folder:t,name:r,returnUrl:i})}},{key:"stopPullFile",value:function(){this.stopReceiveFile()}},{key:"setReturnUrl",value:function(e){this.downloadMessenger.returnUrl=e}}]),r}(BaseHandlerProxy);TosFileChannelHandler.handlerName="TosFileChannelHandler";var GamePadProxy=function(){function e(){var t=this;_classCallCheck(this,e),this.inLoop=!1,this.connected=!1,this.supported=!(!navigator.getGamepads&&!navigator.webkitGetGamepads),this.connected_list=[],this.disconnected_list=[],this.event_list=[],this.handleGamepadDisconnected=function(e){var r=e.gamepad,n=r.id,i=r.index,o=r.mapping;t.disconnected_list.forEach((function(e){e({mapping:o,id:n,index:i})}))},this.handleGamePadConnected=function(e){t.connected=!0;var r=e.gamepad;t.connected_list.forEach((function(e){e({mapping:r.mapping,index:r.index,id:r.id,buttonCount:r.buttons.length,axesCount:r.axes.length})})),t.inLoop||(t.inLoop=!0,t.gamepadLoop())},this.supported&&this.initGamePadEvent()}return _createClass(e,[{key:"getGamepads",value:function(){var e=[];if(navigator.getGamepads?e=navigator.getGamepads():navigator.webkitGetGamepads&&(e=navigator.webkitGetGamepads()),0===e.length)return[];var t,r=[],n=_createForOfIteratorHelper(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;i&&r.push(i)}}catch(err2){n.e(err2)}finally{n.f()}return r}},{key:"on",value:function(e,t){t&&this["".concat(e,"_list")].push(t)}},{key:"remove",value:function(e,t){var r=this["".concat(e,"_list")];-1!==r.indexOf(t)&&r.splice(t,1)}},{key:"gamepadLoop",value:function(){var e=this,t=this.getGamepads();0===t.length?(this.inLoop=!1,this.connected=!1):(this.event_list.forEach((function(e){e(t)})),requestAnimationFrame((function(){e.gamepadLoop()})))}},{key:"initGamePadEvent",value:function(){window.addEventListener("gamepadconnected",this.handleGamePadConnected),window.addEventListener("gamepaddisconnected",this.handleGamepadDisconnected),this.gamepadLoop()}},{key:"vibrate",value:function(e){var t=this,r=this.getGamepads();"number"==typeof e&&r[e]?this._vibrate(r[e]):r.forEach((function(e){t._vibrate(e)}))}},{key:"_vibrate",value:function(e){try{var t,r;null===(t=e.vibrationActuator)||void 0===t||null===(r=t.playEffect)||void 0===r||r.call(t,"dual-rumble",{startDelay:0,duration:200,weakMagnitude:1,strongMagnitude:1})}catch(e2){console.warn(e2)}}},{key:"destroy",value:function(){window.removeEventListener("gamepadconnected",this.handleGamePadConnected),window.removeEventListener("gamepaddisconnected",this.handleGamepadDisconnected)}}]),e}(),GCKeyType=[4096,8192,16384,32768,256,512,0,0,32,16,64,128,1,2,4,8,0];function roundGPValue(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32767;return Math.abs(e)>1?e:Math.round(e*t)}var GamePadHandler=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).pbType=PB_MESSAGE.TYPES.MsgOutput,e.pbSubTypes=[PB_OUTPUT.SUBTYPES.MsgOutputGCVibration],e._lastValue=[],e}return _createClass(r,[{key:"init",value:function(){var e=this;this.gamePadProxy=new GamePadProxy,this.gamePadProxy.supported?(this.gamePadProxy.on("connected",(function(t){var r=t.mapping,n=t.id,i=t.index;e.log("gamepadConnected",{mapping:r,id:n,index:i}),e.emit("gamepad-connected",t),e.print("gamepad-connected",t)})),this.gamePadProxy.on("disconnected",(function(t){var r=t.mapping,n=t.id,i=t.index;e.log("gamepadDisconnected",{mapping:r,id:n,index:i}),e.emit("gamepad-disconnected",t),e.print("gamepad-disconnected",t)})),this.gamePadProxy.on("event",(function(t){e.handleGamePads(t)}))):console.warn("您的设备不支持游戏手柄")}},{key:"onMessage",value:function(e){e.type;var t=e.subtype,r=e.msg;if(t===PB_OUTPUT.SUBTYPES.MsgOutputGCVibration){if(0===r.l&&0===r.r)return;this.print("gamepad-vibrate",r),this.emit("gamepad-vibrate",r),this.gamePadProxy.vibrate(r.index)}}},{key:"handleGamePads",value:function(e){var t,r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var n,i=t.value,o=i.buttons,a=i.index,s=i.axes,c={buttons:0,index:a},u=_createForOfIteratorHelper(o.entries());try{for(u.s();!(n=u.n()).done;){var l=_slicedToArray(n.value,2),d=l[0],p=l[1];switch(p.pressed&&(c.buttons=c.buttons|(GCKeyType[d]||0)),d){case 6:c.lt=roundGPValue(p.value,255);break;case 7:c.rt=roundGPValue(p.value,255);break;case 10:c.lx=roundGPValue(s[0]),c.ly=roundGPValue(-s[1]);break;case 11:c.rx=roundGPValue(s[2]),c.ry=roundGPValue(-s[3])}}}catch(err2){u.e(err2)}finally{u.f()}var _=this._lastValue[a],h="";for(var f in c)h+=",".concat(c[f]);if(this._lastValue[a]=h,h!==_){var m=ProtoBufMessage.encodeGamePadMsg(c);this.print("gamepadEvent",c,m),this.sendPBMessage(m)}}}catch(err2){r.e(err2)}finally{r.f()}}},{key:"destroy",value:function(){this.gamePadProxy.destroy()}}]),r}(BaseHandler$1),e;try{new EventTarget,e=!0}catch(t2){e=!1}var t=function(){function e(){_classCallCheck(this,e),this.e={}}return _createClass(e,[{key:"addEventListener",value:function(e,t){this.t(e).push(t)}},{key:"removeEventListener",value:function(e,t){var r=this.t(e),n=r.indexOf(t);n>-1&&r.splice(n,1)}},{key:"dispatchEvent",value:function(e){return e.target=this,Object.freeze(e),this.t(e.type).forEach((function(t){return t(e)})),!0}},{key:"t",value:function(e){return this.e[e]=this.e[e]||[]}}]),e}(),s=e?EventTarget:t,i=_createClass((function e(t){_classCallCheck(this,e),this.type=t})),a=e?Event:i,n=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var i;return _classCallCheck(this,r),(i=t.call(this,e)).newState=n.newState,i.oldState=n.oldState,i.originalEvent=n.originalEvent,i}return _createClass(r)}(a),r="active",h="passive",c="hidden",o="frozen",d="terminated",u="object"==("undefined"==typeof safari?"undefined":_typeof(safari))&&safari.pushNotification,v="onpageshow"in self,l=["focus","blur","visibilitychange","freeze","resume","pageshow",v?"pagehide":"unload"],g=function(e){return e.preventDefault(),e.returnValue="Are you sure?"},f=function(e){return e.reduce((function(e,t,r){return e[t]=r,e}),{})},b=[[r,h,c,d],[r,h,c,o],[c,h,r],[o,c],[o,r],[o,h]].map(f),p=function(e,t){for(var r,n=0;r=b[n];++n){var i=r[e],o=r[t];if(i>=0&&o>=0&&o>i)return Object.keys(r).slice(i,o+1)}return[]},E=function(){return document.visibilityState===c?c:document.hasFocus()?r:h},m=function(e){_inherits(i,e);var t=_createSuper(i);function i(){var e;_classCallCheck(this,i),e=t.call(this);var r=E();return e.s=r,e.i=[],e.a=e.a.bind(_assertThisInitialized(e)),l.forEach((function(t){return addEventListener(t,e.a,!0)})),u&&addEventListener("beforeunload",(function(t){e.n=setTimeout((function(){t.defaultPrevented||t.returnValue.length>0||e.r(t,c)}),0)})),e}return _createClass(i,[{key:"state",get:function(){return this.s}},{key:"pageWasDiscarded",get:function(){return document.wasDiscarded||!1}},{key:"addUnsavedChanges",value:function(e){!this.i.indexOf(e)>-1&&(0===this.i.length&&addEventListener("beforeunload",g),this.i.push(e))}},{key:"removeUnsavedChanges",value:function(e){var t=this.i.indexOf(e);t>-1&&(this.i.splice(t,1),0===this.i.length&&removeEventListener("beforeunload",g))}},{key:"r",value:function(e,t){if(t!==this.s)for(var r=this.s,i=p(r,t),o=0;o<i.length-1;++o){var a=i[o],s=i[o+1];this.s=s,this.dispatchEvent(new n("statechange",{oldState:a,newState:s,originalEvent:e}))}}},{key:"a",value:function(e){switch(u&&clearTimeout(this.n),e.type){case"pageshow":case"resume":this.r(e,E());break;case"focus":this.r(e,r);break;case"blur":this.s===r&&this.r(e,E());break;case"pagehide":case"unload":this.r(e,e.persisted?o:d);break;case"visibilitychange":this.s!==o&&this.s!==d&&this.r(e,E());break;case"freeze":this.r(e,o)}}}]),i}(s),w=new m,networkMonitor_min={exports:{}};!function(e,t){!function(e){function t(){t=function(){return e};var e={},r=Object.prototype,n=r.hasOwnProperty,i=(h="function"==typeof Symbol?Symbol:{}).iterator||"@@iterator",o=h.asyncIterator||"@@asyncIterator",a=h.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(R){s=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i,o,a,s;return t=t&&t.prototype instanceof d?t:d,t=Object.create(t.prototype),n=new E(n||[]),t._invoke=(i=e,o=r,a=n,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return b()}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r&&(r=function e(t,r){var n=t.iterator[r.method];if(void 0===n){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method))return l;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}return"throw"===(n=u(n,t.iterator,r.arg)).type?(r.method="throw",r.arg=n.arg,r.delegate=null,l):(n=n.arg)?n.done?(r[t.resultName]=n.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):n:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}(r,a))){if(r===l)continue;return r}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);if(s="executing","normal"===(r=u(i,o,a)).type){if(s=a.done?"completed":"suspendedYield",r.arg===l)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(s="completed",a.method="throw",a.arg=r.arg)}}),t}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(n){return{type:"throw",arg:n}}}e.wrap=c;var l={};function d(){}function p(){}function _(){}var h,f,m=(s(h={},i,(function(){return this})),(f=(f=Object.getPrototypeOf)&&f(f(T([]))))&&f!==r&&n.call(f,i)&&(h=f),_.prototype=d.prototype=Object.create(h));function g(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){var r;this._invoke=function(i,o){function a(){return new t((function(r,a){!function r(i,o,a,s){var c;if("throw"!==(i=u(e[i],e,o)).type)return(o=(c=i.arg).value)&&"object"==_typeof(o)&&n.call(o,"__await")?t.resolve(o.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(o).then((function(e){c.value=e,a(c)}),(function(e){return r("throw",e,a,s)}));s(i.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function y(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(y,this),this.reset(!0)}function T(e){if(e){var t,r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return t=-1,(r=function r(){for(;++t<e.length;)if(n.call(e,t))return r.value=e[t],r.done=!1,r;return r.value=void 0,r.done=!0,r}).next=r}return{next:b}}function b(){return{value:void 0,done:!0}}return s(m,"constructor",p.prototype=_),s(_,"constructor",p),p.displayName=s(_,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){return!!(e="function"==typeof e&&e.constructor)&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,s(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},g(v.prototype),s(v.prototype,o,(function(){return this})),e.AsyncIterator=v,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new v(c(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},g(m),s(m,a,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t,r=[];for(t in e)r.push(t);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=T,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;0<=i;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}var a=(o=o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc?null:o)?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(r=i.completion).type&&(n=r.arg,S(i)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,r){t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1})}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){var r,n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function s(e,t,r,n){return new(r=r||Promise)((function(i,o){function a(e){try{c(n.next(e))}catch(t){o(t)}}function s(e){try{c(n.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))}function c(e){var t=0<arguments.length&&void 0!==e?e:5,r={queue:[],total:0,avg:0,max:0,receiveStat:function(e){if("number"!=typeof e||Number.isNaN(e))return null;r.queue.push(e),r.total+=e,e>r.max&&(r.max=e),r.queue.length>t&&(e=r.queue.shift(),r.total-=e,r.max===e&&(r.max=Math.max.apply(null,r.queue))),r.avg=r.total/r.queue.length}};return r}function u(e,t){var r,n=1<arguments.length&&void 0!==t?t:function(e){return e},i=0,o=a(e);try{for(o.s();!(r=o.n()).done;)i+=n(r.value)}catch(s){o.e(s)}finally{o.f()}return i/e.length}function l(e,t,r,n){return r=2<arguments.length&&void 0!==r?r:0,e<0?-1:100<(n=((e=3<arguments.length&&void 0!==n&&!n?e:t-e+r)-r)/(t-r)*100)?100:n<0?0:n}function d(e){return"number"==typeof e?e:-1}var p=function(){function e(){r(this,e),this.inited=!1,this.rttStat=c(),this.lostRateStat=c()}return i(e,[{key:"receiveStats",value:function(e){this.inited||(this.inited=!0),this.rttStat.receiveStat(e.rtt),this.lostRateStat.receiveStat(e.lostRate)}}]),e}(),_=function(){function e(t){r(this,e),this.stat=c(),this.filter=function(e){return"cache"!==e.deliveryType&&200===e.responseStatus},t&&(this.filter=t),this.url=new URL(location.href)}return i(e,[{key:"analyze",value:function(){return s(this,void 0,void 0,t().mark((function e(){var r,n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===(r=this.filterResource()).length)return this.url.searchParams.set("_v","".concat(Date.now())),e.prev=3,e.next=6,fetch("".concat(this.url.toString()));e.next=14;break;case 6:return n=e.sent,e.next=9,n.text();case 9:r=this.filterResource(),e.next=14;break;case 12:e.prev=12,e.t0=e.catch(3);case 14:n=u(r,(function(e){return e.duration})),this.stat.receiveStat(n);case 16:case"end":return e.stop()}}),e,this,[[3,12]])})))}},{key:"filterResource",value:function(){var e,t=[],r=a(performance.getEntriesByType("resource"));try{for(r.s();!(e=r.n()).done;){var n=e.value;this.filter(n)&&t.push(n)}}catch(i){r.e(i)}finally{r.f()}return performance.clearResourceTimings(),t}}]),e}(),h=function(){function e(n){var i=this,o=n.filter,a=n.onStat;r(this,e),this.data={score:-1,type:"",online:"",downlink:-1,rtt:-1,lostRate:-1,visible:"",duration:-1},this.rtcStat=new p,this.performanceStat=new _(o),this.interval=setInterval((function(){return s(i,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.performanceStat.analyze();case 2:this.fillInfo(),null!=a&&a(this.data);case 4:case"end":return e.stop()}}),e,this)})))}),2e3)}return i(e,[{key:"receiveRTCStats",value:function(e){this.rtcStat.receiveStats(e)}},{key:"fillInfo",value:function(){var e=this.data,t=navigator.connection;t&&(e.downlink=d(t.downlink),e.type=t.type||t.effectiveType||"",e.rtt=d(t.rtt)),"boolean"==typeof navigator.onLine&&(e.online=navigator.onLine),this.rtcStat.inited&&(e.rtt=Math.round(this.rtcStat.rttStat.avg),e.lostRate=Math.round(this.rtcStat.lostRateStat.avg)),e.duration=Math.round(this.performanceStat.stat.avg),e.visible="hidden"!==document.visibilityState,e.score=this.evaluate()}},{key:"evaluate",value:function(){var e=this.data;return!1===e.online?0:Math.round(u([l(e.downlink,10,0,!1),l(e.lostRate,1),l(e.rtt,500,50),l(e.duration,5e3,100)].filter((function(e){return 0<=e}))))}},{key:"destroy",value:function(){clearInterval(this.interval)}}]),e}();e.NetworkMonitor=h,Object.defineProperty(e,"__esModule",{value:!0})}(t)}(0,networkMonitor_min.exports);var networkMonitor_minExports=networkMonitor_min.exports,PageLifeHandler=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).visible=!0,e.online=!0,e.networkLevel=-1,e._listeners={},e}return _createClass(r,[{key:"init",value:function(){var e,t=this;this.setLogInfo("href",location.href);var r=this._listeners;this.online=null===(e=navigator.onLine)||void 0===e||e;var n=function(){var e,r=!(document.hidden||"hidden"===document.visibilityState);(t.print("visibilitychange: ",document.visibilityState),r===t.visible&&r)||(t.visible=r,t.setLogInfo("visible",t.visible),t.beaconLog("visibilitychange",{visibilityState:document.visibilityState,visible:r}),null===(e=localStorage)||void 0===e||e.setItem("visibilitychange","".concat(localStorage.getItem("visibilitychange"),"_").concat(r)),t.emit("on-visible-change",t.visible))};setTimeout((function(){n()}),0),document.addEventListener("visibilitychange",r.vc=n),window.addEventListener("online",r.online=function(){t.onlineChange(!0)}),window.addEventListener("offline",r.offline=function(){t.onlineChange(!1)}),window.addEventListener("beforeunload",r.bu=function(){t.beaconLog("onBeforeUnload")}),window.addEventListener("error",r.error=function(e){var r,n;t.log("onWindowError",{message:(null===(r=e.error)||void 0===r?void 0:r.message)||e.message,stack:(null===(n=e.error)||void 0===n?void 0:n.stack)||""}),t.emit("on-window-error",t.online)}),this.on("network-quality",r.nq=function(e){t.networkLevel=e,t.setLogInfo("networkLevel",e)}),w.addEventListener("statechange",r.lc=function(e){var r,n=_objectSpread2(_objectSpread2({},t.getLogParams()),{},{otherLog:{ts:(new Date).getTime(),visibilityState:!1,visible:!1}});if("passive"===e.newState)null===(r=localStorage)||void 0===r||r.setItem("_vegame_oldLog","".concat(JSON.stringify(n))),setTimeout((function(){var e;null===(e=localStorage)||void 0===e||e.removeItem("_vegame_oldLog")}),600);else if("hidden"===e.newState){var i;null===(i=localStorage)||void 0===i||i.removeItem("_vegame_oldLog")}})}},{key:"initNetworkMonitor",value:function(){var e=this;this.networkMonitor=new networkMonitor_minExports.NetworkMonitor({onStat:function(t){e.setLogInfo("networkInfo",t)}}),this.on("received-stream-stats",(function(t){var r=t.stats;e.networkMonitor.receiveRTCStats({rtt:r.accessDelay,lostRate:r.videoReceivedPacketsLostRate})}))}},{key:"onlineChange",value:function(e){this.online=e,this.setLogInfo("onLine",this.online),this.beaconLog("onLineChange"),this.emit("online-change",this.online)}},{key:"destroy",value:function(){var e,t=this._listeners,r=t.vc,n=t.online,i=t.offline,o=t.nq,a=t.bu,s=t.error,c=t.lc;document.removeEventListener("visibilitychange",r),window.removeEventListener("online",n),window.removeEventListener("offline",i),window.removeEventListener("beforeunload",a),window.removeEventListener("error",s),w.removeEventListener("statechange",c),this.off("network-quality",o),null===(e=this.networkMonitor)||void 0===e||e.destroy()}}]),r}(BaseHandler$1),BtnAction=function(e){return e[e.Down=0]="Down",e[e.Up=1]="Up",e}(BtnAction||{}),GamePadKey=(GamePadKey2=GamePadKey||{},GamePadKey2[GamePadKey2.A=GCKeyType[0]]="A",GamePadKey2[GamePadKey2.B=GCKeyType[1]]="B",GamePadKey2[GamePadKey2.X=GCKeyType[2]]="X",GamePadKey2[GamePadKey2.Y=GCKeyType[3]]="Y",GamePadKey2[GamePadKey2.LeftShoulder=GCKeyType[4]]="LeftShoulder",GamePadKey2[GamePadKey2.RightShoulder=GCKeyType[5]]="RightShoulder",GamePadKey2[GamePadKey2.Back=GCKeyType[8]]="Back",GamePadKey2[GamePadKey2.Menu=GCKeyType[9]]="Menu",GamePadKey2[GamePadKey2.LeftThumb=GCKeyType[10]]="LeftThumb",GamePadKey2[GamePadKey2.RightThumb=GCKeyType[11]]="RightThumb",GamePadKey2[GamePadKey2.Up=GCKeyType[12]]="Up",GamePadKey2[GamePadKey2.Down=GCKeyType[13]]="Down",GamePadKey2[GamePadKey2.Left=GCKeyType[14]]="Left",GamePadKey2[GamePadKey2.Right=GCKeyType[15]]="Right",GamePadKey2),GamePadKey2,WhichDir=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e}(WhichDir||{}),GamePadApi=function(){function e(t){_classCallCheck(this,e),this._state=[],this._parent=t}return _createClass(e,[{key:"_getState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._state[e]||(this._state[e]={lx:0,ly:0,rx:0,ry:0,lt:0,rt:0,buttons:new Set}),this._state[e]}},{key:"sendGamePadRockerEvent",value:function(e){var t=e.index,r=void 0===t?0:t,n=e.x,i=void 0===n?0:n,o=e.y,a=void 0===o?0:o,s=e.which,c=void 0===s?0:s,u=this._getState(r);0===c?(u.lx=i,u.ly=a):(u.rx=i,u.ry=a),this._sendGamePad(r)}},{key:"sendTriggerButton",value:function(e){var t=e.index,r=void 0===t?0:t,n=e.which,i=void 0===n?0:n,o=e.value,a=this._getState(r);0===i?a.lt=o:a.rt=o,this._sendGamePad(r)}},{key:"sendKeyEvent",value:function(e){var t=e.key,r=e.action,n=e.index,i=void 0===n?0:n,o=this._getState(i);0===r?o.buttons.add(t):o.buttons.delete(t),this._sendGamePad(i)}},{key:"onVibrate",value:function(e){return this._parent.on("gamepad-vibrate",e)}},{key:"_sendGamePad",value:function(e){var t,r=this._getState(e),n={buttons:0,index:e,lt:roundGPValue(r.lt,255),rt:roundGPValue(r.rt,255),lx:roundGPValue(r.lx),ly:roundGPValue(-r.ly),rx:roundGPValue(r.rx),ry:roundGPValue(-r.ry)},i=_createForOfIteratorHelper(r.buttons);try{for(i.s();!(t=i.n()).done;){var o=t.value;n.buttons=n.buttons|o}}catch(err2){i.e(err2)}finally{i.f()}var a=ProtoBufMessage.encodeGamePadMsg(n);this._parent.print("_sendGamePad",n,a),this._parent.sendPBMessage(a)}}]),e}(),MouseBtnValue=function(e){return e[e.Left=0]="Left",e[e.WheelBtn=1]="WheelBtn",e[e.Right=2]="Right",e[e.X1=3]="X1",e[e.X2=4]="X2",e}(MouseBtnValue||{}),MouseApi=function(){function e(t){var r=this;_classCallCheck(this,e),this._touchToMouse=!1,this._parent=t,this._touchToMouseListener=function(e){r._touchToMouseCall(e)}}var t;return _createClass(e,[{key:"_touchToMouseCall",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._parent.player,n=t[0],i=n.action,o=n.x,a=n.y,e.next=4,r._sendMouseMessage({action:ACTION.MOVE,x:o,y:a});case 4:i===ACTION.TOUCH_START&&r._sendMouseMessage({button:MOUSE_BUTTON.LEFT,action:ACTION.DOWN}),i===ACTION.TOUCH_END&&r._sendMouseMessage({button:MOUSE_BUTTON.LEFT,action:ACTION.UP});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"setTouchToMouse",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e!==this._touchToMouse){this._touchToMouse=e;var t=this._parent.player;t[e?"on":"off"]("on-touch-event",this._touchToMouseListener)}}},{key:"setMouseStateListener",value:function(e){this._parent.on("system-cursor-stat-changed",e)}},{key:"sendInputMouseMove",value:function(e,t){var r=ProtoBufMessage.encodeMouseMovementMsg({x:e,y:t});this._parent.print("sendInputMouseMove",e,t),this._parent.sendPBMessage(r)}},{key:"sendInputMouseKey",value:function(e,t){return this._parent.player._sendMouseMessage({action:t,button:e})}},{key:"sendInputMouseWheel",value:function(e,t){return this._parent.player._sendMouseMessage({action:ACTION.WHEEL,wheel:e,hwheel:t})}},{key:"sendInputCursorPos",value:function(e,t){return this._parent.player._sendMouseMessage({action:ACTION.MOVE,x:e,y:t})}}]),e}(),HardwareApiHandler=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).Enum={MouseBtnValue:MouseBtnValue,GamePadKey:GamePadKey,WhichDir:WhichDir,BtnAction:BtnAction},e.Keyboard={sendKeyboard:function(t,r){return e.player._sendKeyboardMessage({keycode:t,action:r})}},e}return _createClass(r,[{key:"init",value:function(){this.GamePad=new GamePadApi(this),this.Mouse=new MouseApi(this)}}]),r}(BaseHandler$1);HardwareApiHandler.handlerName="HardwareApiHandler";var HangUpHandler=function(e){_inherits(i,e);var t,r,n=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=n.apply(this,arguments)).pbType=PB_MESSAGE.TYPES.MsgBusiness,e.pbSubTypes=[PB_BUSINESS.SUBTYPES.MsgBusinessSessionMode,PB_BUSINESS.SUBTYPES.MsgBusinessPodStreamChange],e}return _createClass(i,[{key:"isHangUpMode",get:function(){return 1===this.mode}},{key:"canSetSessionMode",get:function(){var e=this.player._controlRightHandler;return!e||e.isPlayer}},{key:"initMode",value:function(e){this.mode=e}},{key:"setSessionMode",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c,u;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.log("setSessionMode",{mode:t}),this.canSetSessionMode){e.next=5;break}return r={success:!1,msg:"观众角色不可设置sessionMode"},this.log("setSessionModeResult",{mode:t,result:r}),e.abrupt("return",r);case 5:return this.mode=t,n=ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.SessionMode,payload:{sessionMode:wrapSingle(t)},type:this.pbType,subType:this.pbSubTypes[0]}),this.print("【setSessionMode message】",n),e.next=10,this.sendMessageWithReturn({message:n,pbType:this.pbType,pbSubType:this.pbSubTypes[0]});case 10:if(i=e.sent,o=i.success,a=i.fromCatch,s=i.data,c=i.err,!a){e.next=17;break}return e.abrupt("return",{success:o,err:c,msg:"操作错误: 超时错误"});case 17:return u={success:o,msg:"".concat(s.sessionMode," ").concat(s.result)},this.log("setSessionModeResult",{result:u}),this.print("【setSessionMode result】",u),e.abrupt("return",u);case 21:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"hangUpPause",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!(o.length>0&&void 0!==o[0])||o[0],this.isHangUpMode){e.next=3;break}return e.abrupt("return",null);case 3:return r=t?1:0,n=ProtoBufMessage.encodeMsgCommon({msgName:PB_BUSINESS.MSG_NAMES.PodStreamChange,payload:{status:wrapSingle(r)},type:this.pbType,subType:this.pbSubTypes[1]}),this.print("【hangUpPause】pause",t),e.next=8,this.sendMessageWithReturn({message:n,pbType:this.pbType,pbSubType:this.pbSubTypes[1]});case 8:return i=e.sent,this.print("【hangUpPause】result",i),e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}(BaseHandler$1),MessageShieldHandler=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).pbType=PB_MESSAGE.TYPES.MsgBusiness,e.pbSubTypes=[PB_BUSINESS.SUBTYPES.MsgBusinessShield],e}return _createClass(r,[{key:"onMessage",value:function(e){var t=e.msg;e.type,e.subtype,this.emit("messageShield",{type:t.type,subType:t.subType}),this.print("messageShield",t)}}]),r}(BaseHandler$1),QueueHandler=function(e){_inherits(s,e);var t,r,n,i,o,a=_createSuper(s);function s(){var e;return _classCallCheck(this,s),(e=a.apply(this,arguments)).queuePriority=0,e.interval=5,e.timer=null,e.body=null,e.isFirst=!0,e}return _createClass(s,[{key:"clearState",value:function(){this.body=null,this.getStartSize=null}},{key:"setQueuePriority",value:function(e){"number"==typeof e&&(e<0?e=0:e>99&&(e=99),this.queuePriority=e)}},{key:"needUseQueue",get:function(){return this.queuePriority>0}},{key:"gameStart",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,i,o,a,s,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.body=t,this.getStartSize=r,e.next=4,this.addUserQueue();case 4:return n=e.sent,i=n.QueueList,o=n.Interval,a=n.RemainTime,s=n.Skey,this.assignStore({skey:s}),c=i.map((function(e){return{userPosition:e.UserPosition,configurationCode:e.ConfigurationCode,total:e.Total}})),e.abrupt("return",this.loopQueryQueue({queueList:c,interval:o,remainTime:a},!0));case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"loopQueryQueue",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,i,o,a,s,c=this,u=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.queueList,n=t.interval,i=t.remainTime,o=u.length>1&&void 0!==u[1]&&u[1],void 0===(a=u.length>2?u[2]:void 0)&&(a=this.checkQueueList({queueList:r,interval:n,remainTime:i})),!a){e.next=9;break}return o||this.emit("queue-success"),e.abrupt("return",this.innerGameStart());case 9:return e.next=11,delay$1(1e3*this.interval,(function(e){c.timer=e}));case 11:return e.next=13,this.fetchQueryQueue();case 13:if(!(s=e.sent)){e.next=16;break}return e.abrupt("return",this.loopQueryQueue(s));case 16:return e.abrupt("return",this.loopQueryQueue({},!1,!1));case 17:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"innerGameStart",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("innerStart"),Object.assign(this.body,_objectSpread2({},this.getStartSize())),t=this.store.skey,e.next=5,this.fetchInnerApi({host:this.player.getResourceHost,method:"POST",url:"/volc/cloudgame/game/start",name:"innerGameStart",extraRequiredParam:{skey:t},headers:{skey:t},body:this.body});case 5:if(!(r=e.sent).success){e.next=10;break}this.clearState(),e.next=12;break;case 10:throw console.error("innerGameStart error",r),r;case 12:return this.log("innerStartRequest"),e.abrupt("return",r);case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"fetchQueryQueue",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o,a,s,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.store,r=t.skey,n=t.gameId,i=t.userId,o=t.deviceId,a=t.sessionId,e.next=3,this.fetchInnerApi({host:this.player.getResourceHost,url:"/volc/cloudgame/user_queue/get",name:"queryQueue",extraRequiredParam:{skey:r},headers:{skey:r},params:{game_id:n,client_user_id:i,device_id:o,session_id:a}});case 3:if(!(s=e.sent).success){e.next=10;break}return this.log("queueUpdate",{queueInfo:JSON.stringify(s)}),c=s.queue_list.map((function(e){return{userPosition:e.user_position,configurationCode:e.configuration_code,total:e.total}})),e.abrupt("return",{queueList:c,remainTime:s.remain_time,interval:s.interval});case 10:return s.errorCode&&this.emit("error",s),e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"checkQueueList",value:function(e){var t=e.queueList,r=e.interval;e.remainTime;var n="",i=t.map((function(e){var t=e.userPosition,r=e.configurationCode;return n||t||(n=r),{configurationCode:r,userPosition:t,total:e.total}})),o=!!n;return this.emit("queue-update",{queueList:i,done:o}),this.interval=r,o}},{key:"addUserQueue",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,o,a,s,c,u,l,d,p;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.store,r=t.gameHost,n=t.token,i=t.gameId,o=t.userId,a=t.deviceId,s=t.queuePriority,c=t.sessionId,e.next=3,this.fetchBase({token:n,host:r,defaultHosts:GAME_HOST,params:{Action:"AddUserQueue",Version:"2023-03-18"},body:{GameId:i,ClientUserId:o,DeviceId:a,QueuePriority:s,ConfigurationCode:"",SessionId:c},name:"preAllocateResource"});case 3:if(u=e.sent,l=u.success,d=u.data,p=u.error,l){e.next=10;break}throw this.print("addUserQueue Fail",p),p;case 10:return this.log("addQueue",{queueInfo:JSON.stringify(d.QueueList)}),e.abrupt("return",d);case 12:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){clearTimeout(this.timer)}}]),s}(BaseHandler$1),MessageHandler=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r)}(BaseHandler$1),CursorPosHandler=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).enabled=!1,e.isActive=!1,e.timer=null,e.lastMsg="",e.lastRateX=0,e.lastRateY=0,e.pointLockRate=2,e.mouseMoveRate=10,e.pbType=PB_MESSAGE.TYPES.MsgOutput,e.pbSubTypes=[PB_OUTPUT.SUBTYPES.MsgOutputCursorPos],e.received=!1,e}return _createClass(r,[{key:"onMessage",value:function(e){var t=e.msg;JSON.stringify(t)!==this.lastMsg&&(this.lastMsg=t,this.lastRateX=t.x/t.w,this.lastRateY=t.y/t.h),this.isActive=!0,this.received=!0,this.startTimer()}},{key:"startTimer",value:function(){var e=this;this.timer||(this.timer=setInterval((function(){e.received?e.received=!1:(e.isActive=!1,e.print("exit cursor pos mode"),clearInterval(e.timer))}),300))}},{key:"isEnable",get:function(){return this.enabled&&this.isActive}},{key:"onMouseMove",value:function(e){var t=e.isPointLock,r=e.clientWidth,n=e.clientHeight,i=e.offsetLeft,o=e.offsetTop,a=e.movementX,s=e.movementY,c=t?this.pointLockRate:this.mouseMoveRate;return{clientX:r*this.lastRateX+a*c+i,clientY:n*this.lastRateY+s*c+o}}},{key:"init",value:function(){}},{key:"destroy",value:function(){clearInterval(this.timer)}}]),r}(BaseHandler$1),ConfigHandler=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments))._config={},e._store={},e}return _createClass(r,[{key:"destroy",value:function(){this._config=null}},{key:"config",get:function(){return this._config}},{key:"store",get:function(){return this._store}},{key:"getConfig",value:function(e){return this._config[e]}},{key:"setConfig",value:function(e,t){return this._config[e]=t,t}},{key:"assignConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this._config,e)}},{key:"getStore",value:function(e){return this._store[e]}},{key:"setStore",value:function(e,t){return this._store[e]=t,t}},{key:"assignStore",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this._store,e)}}]),r}(BaseHandler$1);function createStats(){var e={queue:[],total:0,avg:0,max:0,receiveStat:function(t){if("number"!=typeof t||Number.isNaN(t))return null;e.queue.push(t),e.total+=t,t>e.max&&(e.max=t);var r=!0;if(e.queue.length>5){var n=e.queue.shift();e.total-=n,e.max===n&&(e.max=Math.max.apply(null,e.queue)),r=!1}return e.avg=e.total/e.queue.length,{isNormal:e.max>20&&e.avg>10,isInit:r}}};return e}ConfigHandler.handlerName="ConfigHandler";var StuckMonitorHandler=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).decodeFPS=createStats(),e.receiveFPS=createStats(),e}return _createClass(r,[{key:"init",value:function(){var e=this;this.on("received-stream-stats",this.listener=function(t){var r=t.stats,n=e.decodeFPS.receiveStat(r.decoderOutputFrameRate),i=e.receiveFPS.receiveStat(r.receivedFrameRate);if(n&&i){if(e.emit("fps-stats",{avgReceive:Math.round(e.receiveFPS.avg),maxReceive:Math.round(e.receiveFPS.max),avgDecode:Math.round(e.decodeFPS.avg),maxDecode:Math.round(e.decodeFPS.max)}),!n.isNormal){var o=_objectSpread2({},e.decodeFPS);e.log("fpsAbnormal",o),e.printTraceLog("decode-fps-abnormal",o),e.emit("decode-fps-abnormal",o)}if(!i.isNormal){var a=_objectSpread2(_objectSpread2({},e.receiveFPS),{},{isInit:i.isInit,isReceive:!0});e.log("fpsAbnormal",a),e.printTraceLog("receive-fps-abnormal",a),e.emit("receive-fps-abnormal",a)}}})}},{key:"destroy",value:function(){this.off("received-stream-stats",this.listener)}}]),r}(BaseHandler$1);StuckMonitorHandler.handlerName="StuckMonitorHandler";var Handlers={GamePadHandler:GamePadHandler,PageLifeHandler:PageLifeHandler,HardwareApiHandler:HardwareApiHandler,HangUpHandler:HangUpHandler,MessageShieldHandler:MessageShieldHandler,QueueHandler:QueueHandler,MessageHandler:MessageHandler,CursorPosHandler:CursorPosHandler,ConfigHandler:ConfigHandler,StuckMonitorHandler:StuckMonitorHandler},HandleManagerBase=_createClass((function e(){_classCallCheck(this,e)}));for(var key in Handlers)Handlers[key].handlerName=key;function autoUseHandlerPlugin(e){var t=e.HandlerPlugin;getPlugin(t.pluginName)||usePlugin(t)}function useHandler(e){if(!e.handlerName)throw new Error("未命名的handler");return e.handlerName in Handlers?(console.warn("Handler 与 已用Handler命名有冲突:"+e.handlerName),!1):(autoUseHandlerPlugin(e),Handlers[e.handlerName]=e,!0)}var HandleManager=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;_classCallCheck(this,r),(n=t.call(this))._keys=[],n._keys=Object.keys(Handlers);var i,o=_createForOfIteratorHelper(n._keys);try{for(o.s();!(i=o.n()).done;){var a,s=i.value;n[s]=new Handlers[s](e,_assertThisInitialized(n)),null===(a=n[s])||void 0===a||a.init()}}catch(err2){o.e(err2)}finally{o.f()}return n}return _createClass(r,[{key:"handleMessage",value:function(e){var t,r=_createForOfIteratorHelper(this._keys);try{for(r.s();!(t=r.n()).done;){var n;if(null!==(n=this[t.value])&&void 0!==n&&n.handleMessage(e))return!0}}catch(err2){r.e(err2)}finally{r.f()}return!1}},{key:"destroy",value:function(){var e,t=_createForOfIteratorHelper(this._keys);try{for(t.s();!(e=t.n()).done;){var r,n,i=e.value;null===(r=this[i])||void 0===r||r.destroy(),null!==(n=this[i])&&void 0!==n&&n.player&&(this[i].player=null)}}catch(err2){t.e(err2)}finally{t.f()}}}]),r}(HandleManagerBase),HandlerCore=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"initHandlers",value:function(e){this.handlers=new HandleManager(e)}},{key:"config",get:function(){return this.handlers.ConfigHandler.config}},{key:"store",get:function(){return this.handlers.ConfigHandler.store}},{key:"getConfig",value:function(e){return this.handlers.ConfigHandler.getConfig(e)}},{key:"setConfig",value:function(e,t){return this.handlers.ConfigHandler.setConfig(e,t)}},{key:"getStore",value:function(e){return this.handlers.ConfigHandler.getStore(e)}},{key:"setStore",value:function(e,t){return this.handlers.ConfigHandler.setStore(e,t)}},{key:"assignConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.handlers.ConfigHandler.assignConfig(e)}},{key:"assignStore",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.handlers.ConfigHandler.assignStore(e)}}]),e}();HandlerCore.useHandler=useHandler,HandlerCore.useHandler(TosFileChannelHandler);var VePhoneControlRightHandler=function(){function e(t){var r=this;_classCallCheck(this,e),this._player=t,this.canOperate=!0,this.currentUserId=this._player.userId,this._initControlListener(),this.start(),this._player.on("on-control-state-changed",(function(e){var t,n=e;if(0===n.code&&(null===(t=n.data)||void 0===t?void 0:t.userId)===r.currentUserId){var i,o=(null===(i=n.data)||void 0===i?void 0:i.callUserId)===r.currentUserId;r._player.logger.send("userControlStateChange",{enable:n.data.enable,msg:o?"self set":"other user set"}),r.canOperate=n.data.enable}}))}return _createClass(e,[{key:"start",value:function(){var e,t,r=this;null===(e=this._player)||void 0===e||null===(t=e.startPromise)||void 0===t||t.then((function(){return r._innerHasControl()})).then((function(e){var t,n=null==e||null===(t=e.data)||void 0===t?void 0:t.enable;void 0!==n&&(r.canOperate=n)}))}},{key:"_promisifyEventCallback",value:function(e,t){var r=this,n=function(e){clearTimeout(i),t(e)},i=setTimeout((function(){r._player.logger.send("podError",{callUserId:r.currentUserId,msg:"pod trigger ".concat(e," timeout")}),t({code:-1,msg:"timeout"}),r._player.off(e,n)}),5e3);this._player.once(e,n)}},{key:"enableControl",value:function(e,t){var r=this;return new Promise((function(n){r._player.logger.send("enableControl",{userId:e,enable:t,callUserId:r.currentUserId}),r._player._sendCustomMessage(MessageFactory$1.eventTypeUserControl({action:3,userId:e,enable:t})),r._promisifyEventCallback("on-enable-control-result",n)}))}},{key:"_innerHasControl",value:function(){var e=this;return new Promise((function(t){e._isInnerInvokeHasControl=!0,e._player._sendCustomMessage(MessageFactory$1.eventTypeUserControl({action:1,userId:e.currentUserId})),e._promisifyEventCallback("on-inner-has-control-result",t)}))}},{key:"hasControl",value:function(e){var t=this;return new Promise((function(r){t._player._sendCustomMessage(MessageFactory$1.eventTypeUserControl({action:1,userId:e})),t._promisifyEventCallback("on-has-control-result",r)}))}},{key:"getAllControls",value:function(){var e=this;return new Promise((function(t){e._player._sendCustomMessage(MessageFactory$1.eventTypeUserControl({action:2})),e._promisifyEventCallback("on-all-controls-result",t)}))}},{key:"_initControlListener",value:function(){var e=this;this._player.on("inner-message-received",(function(t){var r=t.msg||{},n=r.command,i=r.data,o=r.action,a=r.callUserId,s=r.code,c=r.msg;if(n===SERVER_COMMAND.CMD_USER_CONTROL){var u,l=[];try{l=JSON.parse(i)||[]}catch(err2){e._player.logger.localErrorLog("ClientTrigger","parse user control data error")}var d=null===(u=l)||void 0===u?void 0:u[0];if(a===e.currentUserId)switch(o){case 1:e._isInnerInvokeHasControl?(e._isInnerInvokeHasControl=!1,e._player.emit("on-inner-has-control-result",{code:s,msg:c,data:d})):e._player.emit("on-has-control-result",{code:s,msg:c,data:d});break;case 2:e._player.emit("on-all-controls-result",{code:s,msg:c,data:l});break;case 3:e._player.emit("on-enable-control-result",{code:s,msg:c,data:d})}3===o&&e._player.emit("on-control-state-changed",{code:s,msg:c,data:_objectSpread2(_objectSpread2({},d),{},{callUserId:a})})}}))}}]),e}(),pageProcesstId="".concat((new Date).getTime()),Player=function(e){_inherits(u,e);var t,r,n,i,o,a,s,c=_createSuper(u);function u(e){var t,r,n;if(_classCallCheck(this,u),(r=c.call(this))._isHaiMACloud=!1,r._isSupported=isSupported,EventEmitter$2(_assertThisInitialized(r)),e.podSettings&&(e.podSettings.max_pcu=1),r.options=e,r.userId=e.userId,r.domId=e.domId,r.customLocalKeyboardInputId=e.customLocalKeyboardInputId,r.useCustomLocalKeyboardInput=e.useCustomLocalKeyboardInput,r.region=e.region||"cn",r.mode=e.mode||MODE.CLOUD_PHONE_GAME,r.isVePhone=e.isVePhone||!1,r.usePB=null!==(t=e.usePB)&&void 0!==t?t:!r.isVePhone,r.isPC=e.isPC,r.disableInteraction=e.disableInteraction||!1,r.getResourceHost=e.getResourceHost,r.gameHost=e.gameHost,r.clientMode=e.clientMode,r.phoneHost=e.phoneHost,r.accountId=e.accountId,!r.accountId){var i=START_ERROR.ERROR_INIT_ACCOUNT_ID_ILLEGAL;throw new Error("init error. errorCode: ".concat(i.CODE,"; errMessage: ").concat(i.MESSAGE))}(r.localStream=null,r.touchHandler=null,r.status="init",r._keyCodeList=e.keyCodeList||[],r.uiDomRotation=0,r.isPodLxc=!1,r.did=getDeviceId(),null!=e&&e.isDebug)&&(null===(n=sessionStorage)||void 0===n||n.setItem("_vegame_debuglog","true"));return r._uesLocalKeyboard=e.enableLocalKeyboard,r._mediaProvider=e.mediaProvider,r.containerDomId=(null==e?void 0:e.containerDomId)||CONTAINER_DOM_ID,r._cacheToken=null,r._reservedId=null,r._commonHandler=null,r._videoStreamProfileHandler=null,r._backgroundHandler=null,r._autoRecycleTimeHandler=null,r._userProfilePathHandler=null,r._veMessageHandler=null,r._localKeyboardHandler=null,r._pcImeHandler=null,r._locationServiceHandler=null,r._remoteAppBackgroundHandler=null,r._clipboardHandler=null,r._clipboardAutoSyncHandler=null,r._fullscreenHandler=null,r._startWithFrameworkHandler=null,r._detectDelayHandler=null,r._controlRightHandler=null,r._screenRecordHandler=new ScreenRecordHandler(_assertThisInitialized(r)),r._keyboardDisableHandler=new KeyboardDisableHandler(_assertThisInitialized(r)),r._networkHandler=new NetworkHandler(_assertThisInitialized(r)),r._isSocketSupport=e.isSocketSupport||!1,r.logger=new Logger$2({userId:r.userId,channelDomain:LOG_CHANNEL_DOMAIN,SDKVersion:r.getVersion()}),r.sessionId="sid_"+v4$2(),r.logger.setCommonParams({accountId:r.accountId,volcProduct:r.isVePhone?"vePhone":"veGame",initSessionId:"isid_"+v4$2(),sessionId:r.sessionId,uuid:r.did}),r._isSupportedPromise=new Promise((function(e,t){r._isSupported().then((function(t){var n,i,o=t.socketSupport,a=t.rtcSupport;r._initEngine({socketSupport:o,rtcSupport:a}),r._initDOM({domId:r.domId,customLocalKeyboardInputId:r.customLocalKeyboardInputId,useCustomLocalKeyboardInput:r.useCustomLocalKeyboardInput}),r._init({containerDomId:r.containerDomId}),r.logger.setCommonParams({delivery:"rtc"}),r.logger.on("logger",(function(e){r.emit("logger",e)}));var s=(null===(n=sessionStorage)||void 0===n?void 0:n.getItem("_vegame_pageId"))||"isPageId_".concat(v4$2());null===(i=sessionStorage)||void 0===i||i.setItem("_vegame_pageId",s),r.logger.send("init",{enableSyncClipboard:r.options.enableSyncClipboard||!1,enableLocationService:r.options.enableLocationService||!1,enableLocalKeyboard:r.options.enableLocalKeyboard||!1,enableLocalMouseScroll:r.options.enableLocalMouseScroll||!1,disableAudioInjection:r.options.disableAudioInjection||!1,disableDefaultTouchEvent:r.options.disableDefaultTouchEvent||!1,containerDomId:r.containerDomId,domId:r.domId,mode:r.mode,isPC:r.isPC,pageProcessId:pageProcesstId,pageId:s}),r.logger.localInfoLog("Init","init","init success"),e()}))})),r.initHandlers(_assertThisInitialized(r)),r._removeResizeMonitor=onResize((function(){r._updateVideoScale()})),r.assignStore(_objectSpread2(_objectSpread2({},pick(e,["gameHost","accountId","enableLocalKeyboard","userId","mode","isPC"])),{},{deviceId:r.did,sessionId:r.sessionId})),r.assignConfig(e.config),r.config.disableNetworkMonitor||r.handlers.PageLifeHandler.initNetworkMonitor(),r}return _createClass(u,[{key:"usePB",get:function(){return MessageFactory$1.usePB},set:function(e){MessageFactory$1.usePB=e}},{key:"canOperate",get:function(){return!this._controlRightHandler||this._controlRightHandler.canOperate}},{key:"_setOptions",value:function(e){this.options=Object.assign(this.options,e),this.userId=e.userId}},{key:"_getDebugInfo",value:function(){return _objectSpread2(_objectSpread2({},this.logger.getCommonParams()),{},{userId:this.userId,channelDomain:LOG_CHANNEL_DOMAIN,SDKVersion:this.getVersion()})}},{key:"getVersion",value:function(){return"1.31.0"}},{key:"_initEngine",value:function(e){var t=e.socketSupport,r=e.rtcSupport;t&&(this._enableMediaProvider=COMMUNICATION_MODE.WS),r&&(this._enableMediaProvider=COMMUNICATION_MODE.RTC),t&&r&&(this._enableMediaProvider=COMMUNICATION_MODE.AUTO),this._enableMediaProvider?(this._enableMediaProvider!==COMMUNICATION_MODE.RTC&&this._enableMediaProvider!==COMMUNICATION_MODE.AUTO||(this._clientRTC=new RTCEngine(this,{userId:this.userId,logger:this.logger,configServerHost:RTC_HOST[this.region],containerDomId:this.containerDomId,sdkType:SDK_TYPE})),this._enableMediaProvider!==COMMUNICATION_MODE.WS&&this._enableMediaProvider!==COMMUNICATION_MODE.AUTO||(this._clientSocket=new SocketEngine(this,{userId:this.userId,logger:this.logger,containerDomId:this.containerDomId}))):this.logger.localInfoLog("Init","_initEngine","The environment does not support")}},{key:"_setKeepAliveTime",value:function(e){this.logger.send("setIdleTime",{time:e});var t=MessageFactory$1.eventTypeKeepAliveTime(e);return this._sendCustomMessage(t)}},{key:"_setGameAudioVolumeUp",value:function(){var e=MessageFactory$1.eventTypeKeyCustom({keycode:INNER_KEYCODE.KEYCODE_VOLUME_UP,action:ACTION.DOWN}),t=MessageFactory$1.eventTypeKeyCustom({keycode:INNER_KEYCODE.KEYCODE_VOLUME_UP,action:ACTION.UP});this._sendCustomMessage(e),this._sendCustomMessage(t)}},{key:"_setGameAudioVolumeDown",value:function(){var e=MessageFactory$1.eventTypeKeyCustom({keycode:INNER_KEYCODE.KEYCODE_VOLUME_DOWN,action:ACTION.DOWN}),t=MessageFactory$1.eventTypeKeyCustom({keycode:INNER_KEYCODE.KEYCODE_VOLUME_DOWN,action:ACTION.UP});this._sendCustomMessage(e),this._sendCustomMessage(t)}},{key:"_setLocalAudioPlaybackVolume",value:function(e){var t;return this.logger.send("setLocalAudioPlaybackVolume",{volume:e}),null!=this&&null!==(t=this._clientRTC)&&void 0!==t&&t.audioEle?(this._clientRTC.audioEle.volume=e,0):-1}},{key:"_getLocalAudioPlaybackVolume",value:function(){var e,t,r,n;return this.logger.send("getLocalAudioPlaybackVolume",{volume:null==this||null===(e=this._clientRTC)||void 0===e||null===(t=e.audioEle)||void 0===t?void 0:t.volume}),null==this||null===(r=this._clientRTC)||void 0===r||null===(n=r.audioEle)||void 0===n?void 0:n.volume}},{key:"_setAutoRecycleTime",value:function(e){var t;return null==this||null===(t=this._autoRecycleTimeHandler)||void 0===t?void 0:t.setAutoRecycleTime(e)}},{key:"_getAutoRecycleTime",value:function(){var e;return null==this||null===(e=this._autoRecycleTimeHandler)||void 0===e?void 0:e.getAutoRecycleTime()}},{key:"_setUserProfilePath",value:function(e){var t;return null==this||null===(t=this._userProfilePathHandler)||void 0===t?void 0:t.setUserProfilePath(e)}},{key:"_getUserProfilePath",value:function(){var e;return null==this||null===(e=this._userProfilePathHandler)||void 0===e?void 0:e.getUserProfilePath()}},{key:"_setRemoteLocationMock",value:function(e){var t;return null==this||null===(t=this._locationServiceHandler)||void 0===t?void 0:t.setRemoteLocationMock(e)}},{key:"_enableLocationService",value:function(e){var t;null==this||null===(t=this._locationServiceHandler)||void 0===t||t.enableLocationService(e)}},{key:"_isLocationServiceEnabled",value:function(){var e;return null==this||null===(e=this._locationServiceHandler)||void 0===e?void 0:e.isLocationServiceEnabled()}},{key:"_setLocationServiceMode",value:function(e){var t;null==this||null===(t=this._locationServiceHandler)||void 0===t||t.setLocationServiceMode(e)}},{key:"_getLocationServiceMode",value:function(){var e;return null==this||null===(e=this._locationServiceHandler)||void 0===e?void 0:e.getLocationServiceMode()}},{key:"_setRemoteGameForeground",value:function(){var e;return null==this||null===(e=this._remoteAppBackgroundHandler)||void 0===e?void 0:e.setRemoteGameForeground()}},{key:"_getRemoteBackgroundAppList",value:function(){var e;return null==this||null===(e=this._remoteAppBackgroundHandler)||void 0===e?void 0:e.getRemoteBackgroundAppList()}},{key:"_setRemoteAppForeground",value:function(e){var t;return null==this||null===(t=this._remoteAppBackgroundHandler)||void 0===t?void 0:t.setRemoteAppForeground(e)}},{key:"_initDOM",value:function(e){var t=e.domId,r=e.customLocalKeyboardInputId,n=e.useCustomLocalKeyboardInput,i=document.getElementById(t);if(!i){var o=START_ERROR.ERROR_SDK_INIT_FAILED;throw new Error("init error. errorCode: ".concat(o.CODE,"; errMessage: ").concat(o.MESSAGE,"; detail: ").concat(t,"-dom不存在"))}var a=document.getElementById(this.containerDomId);a||((a=document.createElement("div")).id=this.containerDomId,a.style.width="100%",a.style.height="100%",a.style.position="relative",a.style.zIndex="1",a.style.overflow="hidden"),this._uesLocalKeyboard?(this._localKeyboardHandler=new LocalKeyboardHandler$1(this,{customLocalKeyboardInputId:r,useCustomLocalKeyboardInput:n}),this._localKeyboardHandler.inputCon&&a.appendChild(this._localKeyboardHandler.inputCon),this.mode===MODE.CLOUD_PC&&(this._pcImeHandler=new PCImeHandler(this))):this.isVePhone&&!isMobile()&&(this._localKeyboardHandler=new LocalKeyboardHandler(this,{customLocalKeyboardInputId:r}),this._localKeyboardHandler.inputCon&&a.appendChild(this._localKeyboardHandler.inputCon)),i.appendChild(a)}},{key:"_destroyDOM",value:function(e){var t;null===(t=this._localKeyboardHandler)||void 0===t||t.destroy();var r,n=document.getElementById(e);n&&(null==n||null===(r=n.parentElement)||void 0===r||r.removeChild(n))}},{key:"_init",value:function(e){var t=e.containerDomId;this.logger.localInfoLog("Init","_init","sdk init..."),this._systemCursorShowStatHandler=new SystemCursorShowStatHandler(this),this.touchHandler=new TouchHandler(this,{domId:t,mode:this.mode,isPC:this.isPC,disableInteraction:this.disableInteraction,enableLocalMouseScroll:this.options.enableLocalMouseScroll,localKeyboardHandler:this._localKeyboardHandler,systemCursorShowStatHandler:this._systemCursorShowStatHandler,disableDefaultTouchEvent:this.options.disableDefaultTouchEvent}),this._initEnableConfig({containerDomId:t})}},{key:"_initEnableConfig",value:function(e){var t=e.containerDomId;this._commonHandler=new CommonHandler(this),this._veMessageHandler=new VEMessageHandler(this),this._videoStreamProfileHandler=new VideoStreamProfileHandler(this),this._backgroundHandler=new BackgroundHandler(this),this._autoRecycleTimeHandler=new AutoRecycleTimeHandler(this),this._userProfilePathHandler=new UserProfilePathHandler(this),this._clipboardHandler=new ClipboardHandler(this),this.isVePhone&&(this._locationServiceHandler=new LocationServiceHandler(this,{enable:this.options.enableLocationService})),this._remoteAppBackgroundHandler=new RemoteAppBackgroundHandler(this),this.options.enableSyncClipboard&&(this._clipboardAutoSyncHandler=new ClipboardAutoSyncHandler(this,{containerDomId:t})),this._localAudioHandler=new LocalAudioHandler(this),this._localCameraHandler=new LocalCameraHandler(this),this._fullscreenHandler=new FullscreenHandler(this),this._screenShotHandler=new ScreenShotHandler(this),this._startWithFrameworkHandler=new StartWithFrameworkHandler(this),this._controlRightHandler=this.isVePhone?new VePhoneControlRightHandler(this):new ControlRightHandler(this),this._detectDelayHandler=new DetectDelayHandler(this,{mode:this.mode}),this.status="init"}},{key:"_markCustomError",value:function(e){var t,r=buildCustomError(e);return null===(t=this.logger)||void 0===t||t.send("debugError",{code:r.CODE,message:r.MESSAGE}),r}},{key:"_start",value:function(e){var t,r=this,n=e.mute,i=void 0!==n&&n,o=e.token,a=e.gameId,s=e.customGameId,c=e.productId,u=e.roundId,l=e.videoStreamProfileId,d=e.accountId,p=e.podId,_=e.applicationId,h=e.planId,f=e.reservedId,m=e.rotation,g=e.gameRotation,v=e.isScreenLock,y=e.isReset,S=e.userTag,E=e.extra,T=e.audioAutoPlay,b=e.mediaProvider,R=e.autoRecycleTime,C=e.userProfilePathList,k=e.remoteLocationMock,I=e.enableFullScreen,A=e.systemCursorShowStatManual,O=e.keyboardEnable,M=void 0===O||O,P=e.videoRenderMode,w=void 0===P?VIDEO_RENDER_MODE.CONTAIN:P,D=e.remoteWindowSize,N=e.sessionMode,x=void 0===N?0:N,L=e.queuePriority,$=void 0===L?0:L,B=e.hasVideoBlackPadding,U=void 0!==B&&B;if(this.assignStore({queuePriority:$,sessionMode:x,videoStreamProfileId:l,gameId:a,productId:c,token:o,rotation:m,gameRotation:g,isScreenLock:v,roundId:u}),!this.isVePhone&&void 0===u)throw this._markCustomError("roundId 为空:".concat(u));(this._gameId=a,this.mode===MODE.CLOUD_PHONE_GAME&&(!g&&m?g=m:!m&&g&&(m=g)),this.handlers.QueueHandler.setQueuePriority($),this.handlers.HangUpHandler.initMode(x),this.startPromise=new Promise((function(e,t){var n;r._startResolve=e,r._startReject=t,r._startRejectFn=function(e){(null==e?void 0:e.errorCode)!==START_ERROR.ERROR_START_STREAM_AUTO_PLAY_FAILED.CODE&&r._renewSessionId(),r._startReject(e)};var O=d||r.accountId;r.logger.localInfoLog("Start","_start","sdk start...");var P=new Date;if(r.logger.setCommonParams({roundId:u,gameId:a,planId:h,productId:c,reservedId:f,podId:p,accountId:O}),r.logger.send("start",{gameId:a,rotation:m,gameRotation:g,sessionMode:x,mute:i,token:o,isScreenLock:v,systemCursorShowStatManual:A,videoRenderMode:w,remoteWindowSize:D,reservedId:f,extra:E}),r._cacheToken=o,r._needFirstClickPlayAudio=!1,T&&(r._needFirstClickPlayAudio=!0),r._isRotationGameService=!1,r.rotationMode=m||"auto_rotation",!r.isVePhone||m&&"landscape"!==m||(r._isRotationGameService=!0),"start"===r.sessionIdState){var N=POD_WARNING.WARNING_START_NO_STOP_BEFORE,L=N.CODE,B=N.MESSAGE;return r.emit("warning",{errorCode:L,message:B}),void r._startReject({errorCode:L,message:B})}r.sessionIdState="start",null==r||null===(n=r._veMessageHandler)||void 0===n||n.initMap(),r._isSupportedPromise.then((function(){var n;r.touchHandler&&(r.touchHandler.videoRenderMode=w,r.touchHandler.hasVideoBlackPadding=U),null==r||null===(n=r._systemCursorShowStatHandler)||void 0===n||n.setSystemCursorShowStatManual(A),r.logger.localInfoLog("Start","_start","engine select...");var d=document.getElementById(r.containerDomId),T=(null==D?void 0:D.width)||d.clientWidth,N=(null==D?void 0:D.height)||d.clientHeight;if(0!==(null==D?void 0:D.width)&&0!==(null==D?void 0:D.height)||(T=void 0,N=void 0),r._mediaProvider=b||r._enableMediaProvider,R<=0&&r.logger.localWarnLog("Start","_start",POD_WARNING.WARNING_START_INVALID_AUTO_RECYCLE_TIME),r.isVePhone)r.emit("on-start-process-status-changed",{status:START_CONNECTION_STATUS.STARTED}),PhoneStart({accountId:O,phoneHost:r.phoneHost,width:T,height:N,rotation:m,productId:c,podId:p,did:r.did,userId:r.userId,token:o,applicationId:_,planId:h,isReset:y,roundId:u,videoStreamProfileId:l,userTag:S,extra:E,sessionId:r.sessionId,mediaProvider:r._mediaProvider,remoteLocationMock:k,enableLocalKeyboard:r.options.enableLocalKeyboard,autoRecycleTime:R,mode:r.mode,platform:getPlatform(),sdkVersion:r.getVersion()},r.logger).then((function(n){r.emit("on-start-process-status-changed",{status:START_CONNECTION_STATUS.PODSTART_SUCCESS}),r._reservedId=n.reserved_id,r._skey=n.s_key,r._podId=n.pod_id,r.setStore("reservedId",n.reserved_id),r.isPodLxc=!(null==n||!n.isPodLxc),r.logger.setCommonParams({planId:n.configuration_code,reservedId:n.reserved_id,podId:n.pod_id}),n.media_provider===COMMUNICATION_MODE.RTC?(r.client=r._clientRTC,r.podUserId=n.pod_user_id,r._startRTC({roomId:n.room_id,token:n.token,podUserId:n.pod_user_id,rtcAppId:n.rtc_app_id,width:n.width,height:n.height,mute:i,rotation:n.rotation_mode,isScreenLock:v,startTime:P,extra:E,videoRenderMode:w}).then((function(t){r._detectDelayHandler.start(),r.logger.send("onStartSuccess"),e(t)})).catch((function(e){t(e)}))):(r.client=r._clientSocket,r._startSocket({url:n.websocket_url,token:n.media_token,podUserId:n.pod_user_id,domWidth:T,domHeight:N,width:n.width,height:n.height,mute:i,rotation:n.screen_rotation,startTime:P,roundId:u}).then((function(t){r.logger.send("onStartSuccess"),e(t)})).catch((function(e){r._startRejectFn(e)})))})).catch((function(e){r.emit("on-start-process-status-changed",{status:START_CONNECTION_STATUS.PODSTART_ERROR}),r._openApiStartFail({err:e,startTime:P,reject:t})}));else{r._keyboardDisableHandler.setEnabled(M);var L=r.handlers.QueueHandler,B=function(){return{width:r.mode===MODE.CLOUD_PC&&"portrait"===m?N:T,height:r.mode===MODE.CLOUD_PC&&"portrait"===m?T:N}},F=generateStartBody(_objectSpread2(_objectSpread2({accountId:O,gameHost:r.gameHost,gameId:a,customGameId:s,token:o,userId:r.userId,did:r.did,roundId:u,videoStreamProfileId:l,planId:h,reservedId:f,sessionId:r.sessionId,autoRecycleTime:R},B()),{},{rotation:g,isScreenLock:v,userTag:S,extra:E,mediaProvider:r._mediaProvider,userProfilePathList:C,enableFullScreen:I,platform:getPlatform(),podSettings:r.options.podSettings,sdkVersion:r.getVersion(),sessionMode:x,queuePriority:$}));(L.needUseQueue?L.gameStart(F,B):GameStart(F,{token:o,gameHost:r.gameHost,roundId:u},r.logger)).then((function(e){r._startGameNext(e,{startTime:P,domWidth:T,domHeight:N,mute:i,gameId:a,roundId:u,isScreenLock:v,extra:E,videoRenderMode:w})})).catch((function(e){r._openApiStartFail({err:e,startTime:P,reject:t})}))}}))})),this.isVePhone)&&(null===(t=this._controlRightHandler)||void 0===t||t.start());return this.startPromise}},{key:"_startGameNext",value:function(e,t){var r=t.startTime,n=t.domWidth,i=t.domHeight,o=t.mute,a=t.gameId,s=t.roundId,c=t.isScreenLock,u=t.extra,l=t.videoRenderMode;this._reservedId=e.reserved_id,this._skey=e.skey,this.assignStore({reservedId:e.reserved_id,skey:e.skey}),this.isPodLxc=!0,this._rtc_business_id=e.rtc_business_id,this.logger.setCommonParams({planId:e.configuration_code,reservedId:e.reserved_id,customGameId:e.custom_game_id,podId:e.game_pod_id}),this._selectMediaProvider({res:e,startTime:r,domWidth:n,domHeight:i,mute:o,gameId:a,roundId:s,isScreenLock:c,extra:u,videoRenderMode:l})}},{key:"_selectMediaProvider",value:function(e){var t=this,r=e.res,n=e.startTime,i=e.domWidth,o=e.domHeight,a=e.mute,s=e.gameId,c=e.roundId,u=e.isScreenLock,l=e.extra,d=e.videoRenderMode;if(r.media_provider===COMMUNICATION_MODE.RTC){this.client=this._clientRTC;var p=r.game_type,_="pc"===p?this.rotationMode:r.game_rotation;this._startRTC({roomId:r.room_id,token:r.token,podUserId:r.pod_user_id,rtcAppId:r.rtc_app_id,width:r.stream_width,height:r.stream_height,mute:a,rotation:_,startTime:n,isScreenLock:u,extra:l,gameType:p,videoRenderMode:d}).then((function(e){t.logger.send("onStartSuccess"),t._detectDelayHandler.start(),t.emit("on-start-process-status-changed",{status:START_CONNECTION_STATUS.CLIENT_START_SUCCESS}),t._startResolve(_objectSpread2({roundId:c,reservedId:r.reserved_id,gameId:s,extra:l},e))})).catch((function(e){t._startRejectFn(e)}))}else this.client=this._clientSocket,this._startSocket({url:r.websocket_url,token:r.media_token,podUserId:r.pod_user_id,domWidth:i,domHeight:o,width:r.stream_width,height:r.stream_height,mute:a,rotation:r.game_rotation,startTime:n,extra:l,videoRenderMode:d}).then((function(e){t.logger.send("onStartSuccess"),t._startResolve(_objectSpread2({roundId:c,reservedId:r.reserved_id,gameId:s,extra:l},e))})).catch((function(e){t._startRejectFn(e)}))}},{key:"_openApiStartFail",value:function(e){var t=e.err,r=e.startTime,n=e.reject,i=t.errorCode,o=t.message,a=t.originalErrorCode,s=t.originalMessage;this.logger.send("startFailure",{cost:(new Date).valueOf()-r.valueOf(),errc:i,msg:o,oErrc:a,oMsg:s,oReqId:t.requestId}),this._renewSessionId(),n({errorCode:i,message:o,originalMessage:s,originalErrorCode:a})}},{key:"_startRTC",value:function(e){var t=this,r=e.roomId,n=e.token,i=e.podUserId,o=e.rtcAppId,a=e.width,s=e.height,c=e.mute,u=e.videoRenderMode,l=void 0===u?VIDEO_RENDER_MODE.CONTAIN:u,d=e.rotation,p=void 0===d?0:d,_=e.startTime,h=void 0===_?new Date:_,f=e.isScreenLock,m=e.extra,g=void 0===m?{}:m,v=e.gameType,y=void 0===v?"android":v,S=e.noScale,E=e.noScaleAndLandscape,T=e.isHaiMACloud,b=void 0!==T&&T;return this._isHaiMACloud=b,b&&(this.usePB=!1),this.podUserId=i,new Promise((function(e,u){t._isSupportedPromise.then((function(){t.logger.setCommonParams({roomId:r,rtcAppId:o}),t.client||(t.client=new RTCEngine(t,{userId:t.userId,logger:t.logger,configServerHost:RTC_HOST[t.region],containerDomId:t.containerDomId,sdkType:SDK_TYPE}));var d=t.client;t._isRotationGameService||t._touchRotation(p,y),("pc"===y&&"portrait"===p||E)&&(t.touchHandler.noScaleAndLandscape=!0),("pc"===y&&"portrait"!==p||S)&&(t.touchHandler.noScale=!0),t.touchHandler.setContentSize({width:t.touchHandler.noScaleAndLandscape?s:a,height:t.touchHandler.noScaleAndLandscape?a:s,enableScale:!g.isPCWeb}),f&&(t._screenLockHandler||(t._screenLockHandler=new ScreenLockHandler(t,{domId:t.domId}))),d.start({roomId:r,token:n,podUserId:i,rtcAppId:o,width:a,height:s,mute:c,videoRenderMode:l,startTime:h,gameType:y,disableAudioInjection:t.options.disableAudioInjection}).then((function(r){var n=r.width,i=r.height;t.logger.send("onFirstRemoteVideoFrameRendered",{cost:(new Date).valueOf()-h.valueOf()}),e({width:n,height:i})})).catch(u)}))}))}},{key:"_startSocket",value:function(e){var t=this,r=e.url,n=e.token,i=e.podUserId,o=e.domWidth,a=e.domHeight,s=e.width,c=e.height,u=e.mute,l=e.videoRenderMode,d=void 0===l?VIDEO_RENDER_MODE.CONTAIN:l,p=e.rotation,_=void 0===p?0:p,h=e.startTime,f=void 0===h?new Date:h,m=e.roundId,g=e.extra,v=void 0===g?{}:g;return new Promise((function(e,l){t.logger.send("socketStart",{cost:(new Date).valueOf()-f.valueOf()}),t.client||(t.client=new SocketEngine(t,{userId:t.userId,logger:t.logger,containerDomId:t.containerDomId}));var p=t.client;t._isRotationGameService||t._touchRotation(_),t.touchHandler.setContentSize({width:s,height:c,enableScale:!v.isPCWeb}),p.start({url:r,token:n,podUserId:i,width:o,height:a,mute:u,videoRenderMode:d,startTime:f}).then((function(r){t.logger.send("onFirstRemoteVideoFrameRendered",{cost:(new Date).valueOf()-f.valueOf()}),e({width:s,height:c,roundId:m,extra:v})})).catch(l)}))}},{key:"_restart",value:function(){this.logger.send("restartGame");var e=MessageFactory$1.eventTypeRestart();return this._sendCustomMessage(e)}},{key:"_playByInteraction",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.logger.send("playByInteraction"),new Promise((function(r,n){e.client.renderEle?e.client.play(t).then((function(){e.logger.send("playByInteractionSuccess"),r()})).catch((function(t){var r=t.code,i=t.message,o=START_ERROR.ERROR_START_STREAM_AUTO_PLAY_FAILED.CODE,a=START_ERROR.ERROR_START_STREAM_AUTO_PLAY_FAILED.MESSAGE;e.logger.localErrorLog("Start","playByInteraction fail",t.code,t.msg),e.logger.send("playByInteractionFailure",{errc:o,msg:a,oMsg:i,oErrc:r}),n(t)})):(e.logger.send("playByInteractionFailure",{msg:"renderEle is null"}),n())}))}},{key:"_touchRotation",value:function(e,t){"portrait"===e?e=0:"landscape"===e&&(e=270),"pc"===t&&(e=0),this.touchHandler.setRotation(e)}},{key:"_stop",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.logger.send("stop",{isUserStop:t}),this._stopSendAudioStream(),this._stopVideoStream(),new Promise((function(t,r){e._destroyHandler(),e.client.stop().then((function(){e._renewSessionId(),t()})).catch((function(t){e._renewSessionId(),r(t)}))}))}},{key:"_pauseOrResume",value:function(){var e,t,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.client.pauseOrResume(r),null===(e=this._detectDelayHandler)||void 0===e||e.pause(r),null===(t=this.handlers.HangUpHandler)||void 0===t||t.hangUpPause(r)}},{key:"_renewToken",value:function(e){this._cacheToken=e,this.logger.send("renewToken",{newToken:e})}},{key:"_renewSessionId",value:function(){if("start"===this.sessionIdState){this.sessionIdState="stop",this.sessionId="sid_"+v4$2(),this.setStore("sessionId",this.sessionId),this.logger.setCommonParams({sessionId:this.sessionId});this.logger.localInfoLog("Stopped","_renewSessionId","[31m".concat("生成新的sessionId",":").concat(this.logger.getCommonParams().sessionId,"[0m"))}}},{key:"_updateVideoScale",value:function(){var e;this._screenLockHandler?this._screenLockHandler.handleScreenLock():this.touchHandler&&this.touchHandler.updateVideoScale(null===(e=this.client)||void 0===e?void 0:e.renderEle)}},{key:"_rotateCoordinate",value:function(e){this.touchHandler&&this.touchHandler.setDegree(e)}},{key:"_rotateScreen",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.touchHandler){var r=Math.round(e/90)%2==1?360-e:e;this._rotateVideoParentDom(r),this._rotateCoordinate(r),t&&this._sendRotateEventToGame(180===e?0:e)}}},{key:"_rotateVideoParentDom",value:function(e){var t=document.getElementById(this.domId),r=document.getElementById(this.containerDomId);if(t){var n,i;if(n=t.clientWidth||t.offsetWidth,i=t.clientHeight||t.offsetHeight,0===n)return!1;if(n>i){var o=i;i=n,n=o}r.style.width="".concat(n,"px"),r.style.height="".concat(i,"px"),r.style.transform=270===e||90===e?"translate(".concat(Math.abs(n-i)/2,"px, ").concat(-Math.abs(n-i)/2,"px) rotate(").concat(e,"deg)"):180===e?"rotate(".concat(e,"deg)"):""}}},{key:"_sendRotateEventToGame",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:350;return this.logger.send("rotateEvent",{rotation:e}),new Promise((function(n,i){var o=MessageFactory$1.eventRotatePhoneEvent(e,r);t._sendCustomMessage(o).then((function(){n()})).catch((function(){i()}))}))}},{key:"_rotate",value:function(e){this.touchHandler&&this.touchHandler.setRotation(e)}},{key:"_setAudioMute",value:function(e){return this.client.setAudioMute(e)}},{key:"_muteAudio",value:function(e){return this.logger.send("muteAudio",{mute:e}),this.client.muteStream({audio:e},SUBSCRIBE_TYPE.AUDIO)}},{key:"_isAudioMuted",value:function(){return this.client.isAudioMuted()}},{key:"_muteVideo",value:function(e){return this.logger.send("muteVideo",{mute:e}),this.client.muteStream({video:e},SUBSCRIBE_TYPE.VIDEO)}},{key:"_isVideoMuted",value:function(){return this.client.isVideoMuted()}},{key:"_getStats",value:function(){return this.client.getStats()}},{key:"_getConnectionState",value:function(){if(this.client)return this.client.getConnectionState()}},{key:"_getDeviceId",value:function(){return this.logger.send("getDeviceId"),this.did}},{key:"getResourceStatus",value:function(){var e=this;return new Promise((function(t,r){GetResourceStatus({getResourceHost:e.getResourceHost,reservedId:e._reservedId,skey:e._skey},e.logger).then((function(e){t(e)})).catch((function(e){t(e)}))}))}},{key:"getVePhonePodStatus",value:function(){var e=this;return new Promise((function(t,r){GetVePhonePodStatus({getResourceHost:e.getResourceHost,reservedId:e._reservedId,sKey:e._skey,podId:e._podId},e.logger).then((function(e){console.log("🚀 ~ file: index.ts:1740 ~ getVePhonePodStatus Result:",e),t({podStatus:e.ExitCode})})).catch(r)}))}},{key:"updateMediaToken",value:function(){return UpdateMediaToken({getResourceHost:this.getResourceHost,reservedId:this._reservedId,skey:this._skey,userId:this.userId},this.logger)}},{key:"_changeLocalKeyboardStatus",value:function(e){if(e===POD_KEYBOARD_STATUS.VIRTUAL_KEYBOARD&&this._uesLocalKeyboard||e===POD_KEYBOARD_STATUS.LOCAL_KEYBOARD&&!this._uesLocalKeyboard){var t,r,n,i=null===(t=this._localKeyboardHandler)||void 0===t?void 0:t._inputContainerDomId;null===(r=this._localKeyboardHandler)||void 0===r||r.destroy();var o=document.getElementById(i);null===(n=o)||void 0===n||n.remove(),o=null,this._uesLocalKeyboard=e!==POD_KEYBOARD_STATUS.VIRTUAL_KEYBOARD,this._initDOM({domId:this.domId,customLocalKeyboardInputId:this.customLocalKeyboardInputId,useCustomLocalKeyboardInput:this.useCustomLocalKeyboardInput})}}},{key:"_monitorPod",value:function(e){var t=this,r=e.monitorPodId,n=e.startTime,i=void 0===n?new Date:n,o=e.monitorUserId,a=e.monitorToken,s=e.monitorAccountId;return new Promise((function(e,n){MonitorPod({phoneHost:t.phoneHost,monitorPodId:r,monitorUserId:o,monitorToken:a,monitorAccountId:s},t.logger).then((function(r){t.logger.send("monitorPodSuccess",r),e(r)})).catch((function(e){var r=e.errorCode,o=e.message,a=e.originalErrorCode,s=e.originalMessage;t.logger.send("monitorPodFailure",{cost:(new Date).valueOf()-i.valueOf(),errc:r,msg:o,oErrc:a,oMsg:s,oReqId:e.requestId}),n({errorCode:r,message:o})}))}))}},{key:"_closeApp",value:function(e){this._sendControlMessage(e,0)}},{key:"_launchApp",value:function(e){this._sendControlMessage(e,1)}},{key:"_sendVEMessage",value:function(e){var t=e.message,r=e.needAck,n=e.timeout,i=e.destUserId;return this._veMessageHandler.sendVEMessage({message:t,needAck:r,timeout:n,destUserId:i})}},{key:"_sendClipBoardMessage",value:function(e){return this.logger.send("sendClipBoardMessage",{length:e.length}),this._clipboardHandler.sendClipBoardMessage(e)}},{key:"_sendCustomMessage",value:function(e){return this.handlers.MessageHandler.sendMessage(e)}},{key:"_sendMessage",value:function(e,t){return this.handlers.MessageHandler.sendMessageBase(e,t)}},{key:"_sendCustomMessageWithReturn",value:function(e){return this.handlers.MessageHandler.sendMessageWithReturn(e)}},{key:"_sendTouchMessage",value:function(e){return this.touchHandler.sendTouchMessage(e)}},{key:"_sendControlMessage",value:function(e,t){var r=MessageFactory$1.eventTypeAppManager(e,t);this._sendCustomMessage(r)}},{key:"_sendKeycodeMessage",value:function(e){var t=this,r=e.keycode,n=e.action;return new Promise((function(e,i){if(t._checkKeycode(Number(r))){var o=MessageFactory$1.eventTypeKey({keycode:r,action:n});t.logger.send("sendKey",{keycode:r,action:n}),t._sendCustomMessage(o).then((function(i){t.logger.send("sendKeySuccess",{keycode:r,action:n}),e(i)})).catch((function(e){var o=e.errorCode,a=e.message;t.logger.send("sendKeyFail",{keycode:r,action:n,errorCode:o,message:a}),i(e)}))}else t.logger.send("sendKeyFail",{keycode:r,action:n,errorCode:"",message:"暂不支持该 code"}),i("暂不支持该 code")}))}},{key:"_checkKeycode",value:function(e){var t=[3,4,82,187];return this._keyCodeList.length>0?[].concat(t,_toConsumableArray(this._keyCodeList)).includes(e):t.includes(e)}},{key:"_sendMouseMessage",value:function(e){var t,r=e.button,n=e.action,i=e.wheel,o=e.hwheel,a=e.x,s=e.y,c=e.sendMovement;if(this.mode===MODE.CLOUD_PC)switch(n){case ACTION.DOWN:t=ProtoBufMessage.encodeMouseKeyMsg(r,!0);break;case ACTION.UP:t=ProtoBufMessage.encodeMouseKeyMsg(r,!1);break;case ACTION.MOVE:var u=document.getElementById(this.domId),l=(null==u?void 0:u.clientWidth)||0,d=(null==u?void 0:u.clientHeight)||0;if(this._screenLockHandler?this._screenLockHandler._isRotation:isLandscape()){var p=[d,l];l=p[0],d=p[1]}var _=limitRange(Math.floor(l*a),1,l-1),h=limitRange(Math.floor(d*s),1,d-1),f=c?1:0,m=ProtoBufMessage.encodeMouseMoveMsg({movementX:f,movementY:f,clientWidth:l,clientHeight:d,offsetX:_,offsetY:h}),g=m.movePBMessage;t=m.cursorPosPBMessage,c&&this._sendCustomMessage(g);break;case ACTION.WHEEL:t=ProtoBufMessage.encodeWheelMsg(o,i)}else t=MessageFactory$1.eventTypeMouse({button:r,action:n,wheel:i,x:a,y:s});return this._sendCustomMessage(t)}},{key:"_sendKeyboardMessage",value:function(e){var t=e.keycode,r=e.action;if(this.mode===MODE.CLOUD_PC){var n=ProtoBufMessage.encodeKeyMsg(t,!(r!==ACTION.DOWN));return this._sendCustomMessage(n)}}},{key:"_sendGamepadButtonMessage",value:function(e){var t=e.keycode,r=e.action,n=e.index,i=void 0===n?0:n;if(this.mode===MODE.CLOUD_PC){var o=MessageFactory$1.eventTypeKey({keycode:t,action:r,index:i});return this._sendCustomMessage(o)}}},{key:"_sendJoystickMessage",value:function(e){var t=e.leftX,r=e.leftY,n=e.rightX,i=e.rightY,o=e.leftT,a=e.rightT,s=e.index,c=void 0===s?0:s;if(this.mode===MODE.CLOUD_PC){var u=MessageFactory$1.eventTypeGdapJoystick({leftX:t,leftY:r,rightX:n,rightY:i,leftT:o,rightT:a,index:c});this._sendCustomMessage(u)}}},{key:"_sendGamePadPbMessage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.mode===MODE.CLOUD_PC){var t=ProtoBufMessage.encodeGamePadMsg(e);return this._sendMessage(t,!0)}}},{key:"_enableLocalAudio",value:function(){var e=this;return new Promise((function(t,r){e.localStream||navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then((function(n){e.client?e.client._publishStream().then((function(){e.logger.send("enableLocalAudioSuccess"),e.localStream=!0,t()})).catch((function(){r()})):e.logger.send("enableLocalAudioFail",{eventType:"sdkError",errCode:SDK_CUSTOM_ERROR.CLIENT_NOT_INIT.CODE,errMsg:SDK_CUSTOM_ERROR.CLIENT_NOT_INIT.MESSAGE,oErr:""})})).catch((function(t){e.logger.send("enableLocalAudioFail",{eventType:"sdkError",errCode:SDK_CUSTOM_ERROR.GET_USER_MEDIA_FAIL.CODE,errMsg:SDK_CUSTOM_ERROR.GET_USER_MEDIA_FAIL.MESSAGE,oErr:t}),r()}))}))}},{key:"_disableLocalAudio",value:function(){var e=this;return new Promise((function(t,r){e.client?e.client._unPublishStream().then((function(){e.logger.send("disableLocalAudioSuccess"),t()})).catch((function(){r()})):e.logger.send("disableLocalAudioFail",{eventType:"sdkError",errCode:SDK_CUSTOM_ERROR.CLIENT_NOT_INIT.CODE,errMsg:SDK_CUSTOM_ERROR.CLIENT_NOT_INIT.MESSAGE,oErr:""})}))}},{key:"messageReceivedHandler",value:function(e,t){var r,n,i,o,a,s,c,u,l,d,p,_,h,f;if(e.message){var m=Object.prototype.toString.call(e.message);if("[object String]"===m)try{r=JSON.parse(e.message)}catch(e2){return void this.logger.localWarnLog("PodTrigger","messageReceivedHandler",e2)}"[object Object]"===m&&(r=e.message)}if(this.logger.localInfoLog("PodTrigger","messageReceivedHandler","message-received:",r),this.emit("inner-message-received",{from:t,to:this.userId,msg:r}),this.emit("message-received",{from:t,to:this.userId,msg:r}),r&&r.command===SERVER_COMMAND.CMD_CLIPBOARD)return null==this||null===(n=this._clipboardAutoSyncHandler)||void 0===n||n.handleClipboardEvent(r),void(null==this||null===(i=this._clipboardHandler)||void 0===i||i.handleClipboardEvent(r));if(!r||r.command!==SERVER_COMMAND.CMD_START_LOCATION_REQUEST&&r.command!==SERVER_COMMAND.CMD_STOP_LOCATION_REQUEST)if(r&&r.command===SERVER_COMMAND.CMD_CAMERA_UPSTREAM)null==this||null===(a=this._localCameraHandler)||void 0===a||a.handleCameraEvent(r);else if(r&&r.command===SERVER_COMMAND.CMD_AUD_UPSTREAM)null==this||null===(s=this._localAudioHandler)||void 0===s||s.handleAudioEvent(r);else if(r&&r.command===SERVER_COMMAND.CMD_GAME_OVERDUE)null==this||null===(c=this._commonHandler)||void 0===c||c.handleErrorEvent(r);else if(!r||r.command!==SERVER_COMMAND.CMD_INPUT_START&&r.command!==SERVER_COMMAND.CMD_INPUT_SHOW&&r.command!==SERVER_COMMAND.CMD_INPUT_DESTROY&&r.command!==SERVER_COMMAND.CMD_TEXT_INPUT_CONTROL)if(r&&r.command===SERVER_COMMAND.CMD_MSG_CHANNEL)null==this||null===(l=this._veMessageHandler)||void 0===l||l.receiveVEMessage(r);else if(r&&r.command===SERVER_COMMAND.CMD_USERSTATUS)null==this||null===(d=this._backgroundHandler)||void 0===d||d.handleBackgroundEvent(r);else if(r&&r.command===SERVER_COMMAND.CMD_FOREGROUND_CHANGE_STATUS)this.isVePhone?null==this||null===(h=this._remoteAppBackgroundHandler)||void 0===h||h.handleAppsForegroundChangeStatus(r):null==this||null===(f=this._remoteAppBackgroundHandler)||void 0===f||f.handleGameForegroundChangeStatus(r);else if(r&&r.command===SERVER_COMMAND.CMD_USER_APP_FRAMEWORK_WARNING)null==this||null===(p=this._startWithFrameworkHandler)||void 0===p||p.handleWarningEvent(r);else{if(r&&r.command===SERVER_COMMAND.CMD_FOCUSED_WINDOW)return this.logger.localInfoLog("PodTrigger","messageReceivedHandler","server focused window:",r),this.logger.send("receiveFocusedWindowApp",{code:r.result,packageName:r.appPackageName,msg:""}),void this.emit("focused-window",{code:r.result,packageName:r.appPackageName,msg:""});if(r&&r.command===SERVER_COMMAND.CMD_SHAKE_RESPONSE){this.logger.localInfoLog("PodTrigger","messageReceivedHandler","server shake response: ",r);var g=r.data||r.result||{};return this.logger.send("receiveShakeResponse",g),void this.emit("shake-response",g)}if(r&&r.command===SERVER_COMMAND.CMD_SCREENRECORD_RESPONSE)this._screenRecordHandler.handleResponse(r);else if(r&&r.command===SERVER_COMMAND.CMD_FILE_CHANNEL)null===(_=this.handlers.TosFileChannelHandler)||void 0===_||_.handleResponse(r);else if(r&&r.command===SERVER_COMMAND.CMD_KEYBOARD_ENABLE_RESULT)this._keyboardDisableHandler.handleResponse(r);else{if(r&&r.command===SERVER_COMMAND.CMD_DISLAY_POLICY){var v,y;this.logger.localInfoLog("PodTrigger","messageReceivedHandler","navbarStatus response: ",r);var S={status:null===(v=r)||void 0===v?void 0:v.status,reason:null===(y=r)||void 0===y?void 0:y.reason};return this.logger.send("on-navbar-status",S),void this.emit("on-navbar-status",S)}if(r&&r.command===SERVER_COMMAND.CMD_KEYCODE_TYPE){var E,T,b=_objectSpread2({},null===(E=r)||void 0===E?void 0:E.data);if(0!==(null===(T=b)||void 0===T?void 0:T.code)){var R,C,k,I=POD_WARNING.WARNING_NATIVE_IME_DISABLED,A=I.CODE,O=I.MESSAGE;0===(null===(R=b)||void 0===R?void 0:R.type)&&this._changeLocalKeyboardStatus(0),b={errorCode:A,message:O,oErrc:null===(C=b)||void 0===C?void 0:C.code,type:null===(k=b)||void 0===k?void 0:k.type}}return this.logger.send("on-keyboard-changed",b),void this.emit("on-keyboard-changed",b)}var M,P,w,D,N,x;if(r&&r.command===SERVER_COMMAND.CMD_ORIENTATION_IND)null==this||null===(M=this._localKeyboardHandler)||void 0===M||M.handleRotationEvent(r),this.logger.localInfoLog("PodTrigger","messageReceivedHandler","message-orientation:  ",r),this.rotationDegree=r.orientation,this.emit("on-screen-rotation",{appOriginDirection:0===this.rotationDegree?"portrait":"landscape",streamDirection:"portrait"===this.rotationMode&&0!==r.orientation?"landscape":"portrait",uiDomRotation:null!==(P=null==this||null===(w=this.touchHandler)||void 0===w?void 0:w.degree)&&void 0!==P?P:0,fromPod:!0}),this._isRotationGameService&&(this.touchHandler.setRotation(r.orientation),this._updateVideoScale(),this.logger.send("phoneOrientationGameService",{rotation:r.orientation}));if(r&&r.command===SERVER_COMMAND.CMD_GENERAL_PURPOSE)this.emit("general-message-received",{from:t,to:this.userId,msg:null===(D=r)||void 0===D||null===(N=D.data)||void 0===N?void 0:N.payload});if(r&&r.command===SERVER_COMMAND.CMD_CAMERA_INJECT_STATUS)this.emit("on-camera-inject-status",_objectSpread2({},null===(x=r)||void 0===x?void 0:x.data))}}else null==this||null===(u=this._localKeyboardHandler)||void 0===u||u.handleInputMethodEvent(r);else null==this||null===(o=this._locationServiceHandler)||void 0===o||o.handleInputMethodEvent(r)}},{key:"_onReceiveBusinessMessage",value:function(e,t){if(e===PB_BUSINESS.SUBTYPES.Clipboard){var r,n,i={data:{clipData:t.clip_data}};return null===(r=this._clipboardAutoSyncHandler)||void 0===r||r.handleClipboardEvent(i),null===(n=this._clipboardHandler)||void 0===n||n.handleClipboardEvent(i),!0}var o,a,s,c;if(e===PB_BUSINESS.SUBTYPES.MsgBusinessOrientation)return null===(o=this._localKeyboardHandler)||void 0===o||o.handleRotationEvent(),this.logger.localInfoLog("PodTrigger","_onReceiveBusinessMessage","message-orientation:  ",JSON.stringify(t)),this._isRotationGameService&&(this.touchHandler.setRotation(t.orientation),this._updateVideoScale()),this.logger.send("onRemoteRotation",{rotation:t.orientation}),this.emit("on-screen-rotation",{rotation:t.orientation,fromPod:!0}),!0;if(e===PB_BUSINESS.SUBTYPES.Location)return t.fastestInterval=t.fastest_interval,t.packageName=t.package_name,t.numUpdates=t.num_updates,t.expireAt=t.expire_at,t.smallestDisplacement=t.smallest_displacement,null===(a=this._locationServiceHandler)||void 0===a||a.handleInputMethodEvent(t),!0;if(e===PB_BUSINESS.SUBTYPES.MsgBusinessBackgroundApp){if(0===t.action){var u,l,d={data:t};if(this.isVePhone)null===(u=this._remoteAppBackgroundHandler)||void 0===u||u.handleAppsForegroundChangeStatus(d);else null===(l=this._remoteAppBackgroundHandler)||void 0===l||l.handleGameForegroundChangeStatus(d)}return!0}if(e===PB_BUSINESS.SUBTYPES.MsgBusinessSessionClose){var p,_={data:{reason:t.reason,packageName:t.package_name}};return null===(p=this._commonHandler)||void 0===p||p.handleErrorEvent(_),!0}if(e===PB_BUSINESS.SUBTYPES.MsgBusinessMsgChannel){var h,f={data:JSON.stringify(_objectSpread2(_objectSpread2({},t),{},{message:t.payload}))};return null===(h=this._veMessageHandler)||void 0===h||h.receiveVEMessage(f),!0}if(e===PB_BUSINESS.SUBTYPES.MsgBusinessBinaryMsgChannel)return this._veMessageHandler.receiveVEBinaryMessage(t),!0;if(e===PB_BUSINESS.SUBTYPES.MsgBusinessFocusWindow){var m={result:t.result,appPackageName:t.package_name};return this.logger.localInfoLog("PodTrigger","_onReceiveBusinessMessage","server focused window:  ",JSON.stringify(m)),this.logger.send("receiveFocusedWindowApp",{code:m.result,packageName:m.appPackageName,msg:""}),this.emit("focused-window",{code:m.result,packageName:m.appPackageName,msg:""}),!0}return e===PB_BUSINESS.SUBTYPES.MsgBusinessShake?(this.logger.localInfoLog("PodTrigger","_onReceiveBusinessMessage","server shake response: ",JSON.stringify(t)),this.logger.send("receiveShakeResponse",t),this.emit("shake-response",t),!0):e===PB_BUSINESS.SUBTYPES.MsgBusinessScreenRecord?(this._screenRecordHandler.handleResponse({data:t}),!0):e===PB_BUSINESS.SUBTYPES.MsgBusinessFileChannel?(null===(s=this.handlers.TosFileChannelHandler)||void 0===s||s.handleResponse({data:{action:t.action,carries:readData(t.carries,["result","progress"])}}),!0):(e===PB_BUSINESS.SUBTYPES.UserStatus&&(null===(c=this._backgroundHandler)||void 0===c||c.handleBackgroundEvent({data:t})),!1)}},{key:"_onReceiveIMEMessage",value:function(e,t){if(e===PB_IME.SUBTYPES.MsgIMEControl){var r;if(3===t.type)this._keyboardDisableHandler.handleResponse({data:{enable:!!readSingle(t.is_allow)}});else null===(r=this._localKeyboardHandler)||void 0===r||r.handleInputMethodEvent({command:{0:SERVER_COMMAND.CMD_INPUT_START,1:SERVER_COMMAND.CMD_INPUT_SHOW,2:SERVER_COMMAND.CMD_INPUT_DESTROY}[t.type],currentText:t.current_text,data:{actionId:readSingle(t.action_id)},selectionStart:readSingle(t.selection_start),selectionEnd:readSingle(t.selection_end)});return!0}return!1}},{key:"binaryMessageReceviedHandler",value:function(e,t){var r=ProtoBufMessage.decodePBMessage(e.message);if(r){var n,i=ProtoBufMessage.protoRoot,o=r.type,a=r.subtype,s=r.msg;if(o===i.MsgType.MsgOutput&&a===i.MsgOutputType.MsgOutputCursorImage||o===i.MsgType.MsgOutput&&a===i.MsgOutputType.MsgOutputCursorVisibility)null===(n=this._systemCursorShowStatHandler)||void 0===n||n.handleMessage(r);else if(o===i.MsgType.MsgDevice&&a===i.MsgDeviceType.MsgDeviceControl){var c,u;if((null==s?void 0:s.type)===i.DeviceType.DeviceCamara)null===(c=this._localCameraHandler)||void 0===c||c.handleCameraPBEvent(r);else null===(u=this._localAudioHandler)||void 0===u||u.handleAudioPBEvent(r)}else if(o===i.MsgType.MsgRaw&&a===i.MsgRawType.MsgRawString||o===i.MsgType.MsgRaw&&a===i.MsgRawType.MsgRawBinary)a===i.MsgRawType.MsgRawString?this.emit("message",{userId:this.podUserId,text:s}):this.emit("message",{userId:this.podUserId,binary:s});else if(o===PB_MESSAGE.TYPES.MsgBusiness&&this._onReceiveBusinessMessage(a,s))this.logger.localInfoLog("PodTrigger","binaryMessageReceviedHandler","BusinessMessage part");else if(o===PB_MESSAGE.TYPES.MsgIME&&this._onReceiveIMEMessage(a,s))this.logger.localInfoLog("PodTrigger","binaryMessageReceviedHandler","IMEMessage part");else{var l,d;if(null!==(l=this._controlRightHandler)&&void 0!==l&&l.handleMessage(r))return;if(null!==(d=this._pcImeHandler)&&void 0!==d&&d.handleMessage(r))return;if(this.handlers.handleMessage(r))return;this.logger.localWarnLog("PodTrigger","binaryMessageReceviedHandler","未处理的消息: ",r)}}else this.logger.localWarnLog("PodTrigger","binaryMessageReceviedHandler","找不到pb协议定义")}},{key:"seiMessageReceviedHandler",value:function(e,t){return this._detectDelayHandler.handleDetectDelayMessage(e)}},{key:"_switchVideoStreamProfile",value:function(e){var t;return null===(t=this._videoStreamProfileHandler)||void 0===t?void 0:t.switchVideoStreamProfile(e)}},{key:"_switchBackground",value:function(e){var t;return null==this||null===(t=this._backgroundHandler)||void 0===t?void 0:t.switchBackground(e)}},{key:"_setFullScreenState",value:function(e,t){var r,n=t.fitMode;return null==this||null===(r=this._fullscreenHandler)||void 0===r?void 0:r.setFullScreenState(e,{fitMode:n})}},{key:"_setNavigationBarStatus",value:function(e){this.logger.send("setNavigationBarStatus",e);var t=MessageFactory$1.eventTypeDislayPolicy({action:0,status:e,displayContent:1});return this._sendCustomMessage(t)}},{key:"_getNavigationBarStatus",value:function(){var e=this;this.logger.send("getNavigationBarStatus");var t=MessageFactory$1.eventTypeDislayPolicy({action:1,displayContent:1});return new Promise((function(r,n){var i=START_ERROR.ERROR_SDK_GENERAL.CODE,o=START_ERROR.ERROR_SDK_GENERAL.MESSAGE;e._sendCustomMessage(t).then((function(){e.once("on-navbar-status",(function(e){(null==e?void 0:e.reason)!==DISLAY_POLICY_REASON.ERROR_PARAMETER?r({status:null==e?void 0:e.status}):n({reason:null==e?void 0:e.reason,status:null==e?void 0:e.status})}))})).catch((function(){n({errorCode:i,message:o})}))}))}},{key:"_setAudioSourceType",value:(s=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._localAudioHandler;case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}this._localAudioHandler.setAudioSourceType(t,r);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"_startExternalAudioTrack",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._localAudioHandler;case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}this._localAudioHandler.startExternalAudioTrack(t,r);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"_stopExternalAudioTrack",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._localAudioHandler;case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}this._localAudioHandler.stopExternalAudioTrack();case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"_startSendAudioStream",value:function(){var e;return null==this||null===(e=this._localAudioHandler)||void 0===e?void 0:e.startSendAudioStream()}},{key:"_stopSendAudioStream",value:function(){var e;return null==this||null===(e=this._localAudioHandler)||void 0===e?void 0:e.stopSendAudioStream()}},{key:"_getAudioPlaybackDeviceList",value:function(){var e;return null==this||null===(e=this._localAudioHandler)||void 0===e?void 0:e.getAudioPlaybackDeviceList()}},{key:"_setAudioPlaybackRoute",value:function(e){var t;return null==this||null===(t=this._localAudioHandler)||void 0===t?void 0:t.setAudioPlaybackDevice(e)}},{key:"_getAudioCaptureDeviceList",value:function(){var e;return null==this||null===(e=this._localAudioHandler)||void 0===e?void 0:e.getAudioCaptureDeviceList()}},{key:"_setAudioCaptureDevice",value:function(e){var t;return null==this||null===(t=this._localAudioHandler)||void 0===t?void 0:t.setAudioCaptureDevice(e)}},{key:"_getAudioPlaybackRoute",value:function(){var e;return null==this||null===(e=this._localAudioHandler)||void 0===e?void 0:e.getAudioPlaybackDevice()}},{key:"_getAudioCaptureDevice",value:function(){var e;return null==this||null===(e=this._localAudioHandler)||void 0===e?void 0:e.getAudioCaptureDevice()}},{key:"_setVideoSourceType",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._localCameraHandler;case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}this._localCameraHandler.setVideoSourceType(t,r);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"_startExternalVideoTrack",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._localCameraHandler;case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}this._localCameraHandler.startExternalVideoTrack(t,r);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"_stopExternalVideoTrack",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._localCameraHandler;case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}this._localCameraHandler.stopExternalVideoTrack();case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_startVideoStream",value:function(){var e;return null==this||null===(e=this._localCameraHandler)||void 0===e?void 0:e.startVideoStream()}},{key:"_stopVideoStream",value:function(){var e;return null==this||null===(e=this._localCameraHandler)||void 0===e?void 0:e.stopVideoStream()}},{key:"_setVideoCaptureDevice",value:function(e){var t;return null==this||null===(t=this._localCameraHandler)||void 0===t?void 0:t.setVideoCaptureDevice(e)}},{key:"_getVideoPlaybackDeviceList",value:function(){var e;return null==this||null===(e=this._localCameraHandler)||void 0===e?void 0:e.getVideoPlaybackDeviceList()}},{key:"_getVideoCaptureDevice",value:function(){var e;return null==this||null===(e=this._localCameraHandler)||void 0===e?void 0:e.getVideoCaptureDevice()}},{key:"_setLocalVideoView",value:function(e){var t;return null==this||null===(t=this._localCameraHandler)||void 0===t?void 0:t.setLocalVideoView(e)}},{key:"_setVideoRotationMode",value:function(e){var t;return null==this||null===(t=this._localCameraHandler)||void 0===t?void 0:t.setVideoRotationMode(e)}},{key:"_setLocalVideoMirrorMode",value:function(e){var t;return null==this||null===(t=this._localCameraHandler)||void 0===t?void 0:t.setLocalVideoMirrorMode(e)}},{key:"_getLocalVideoMirrorMode",value:function(){var e;return null==this||null===(e=this._localCameraHandler)||void 0===e?void 0:e.getLocalVideoMirrorMode()}},{key:"_setVideoCaptureConfig",value:function(e){var t;return null==this||null===(t=this._localCameraHandler)||void 0===t?void 0:t.setVideoCaptureConfig(e)}},{key:"_setVideoEncoderConfig",value:function(e){var t;return null===(t=this._localCameraHandler)||void 0===t?void 0:t.setVideoEncoderConfig(e)}},{key:"_setReconnectTime",value:function(e){this.client&&(this.client.reconnectTime=e)}},{key:"_clickVirtualBtn",value:function(e){var t=MessageFactory$1.eventTypeKeyCustom({keycode:e,action:ACTION.DOWN}),r=MessageFactory$1.eventTypeKeyCustom({keycode:e,action:ACTION.UP});this._sendCustomMessage(t),this._sendCustomMessage(r)}},{key:"_setToHomePage",value:function(){return this._clickVirtualBtn(KEYCODE.KEYCODE_HOME)}},{key:"_setBackToPreviousPage",value:function(){return this._clickVirtualBtn(KEYCODE.KEYCODE_BACK)}},{key:"_setToRecentAppPage",value:function(){return this._clickVirtualBtn(KEYCODE.KEYCODE_MENU)}},{key:"_screenShot",value:function(e){var t;return null==this||null===(t=this._screenShotHandler)||void 0===t?void 0:t.screenShot(e)}},{key:"_startRecording",value:function(e,t){var r;return null==this||null===(r=this._screenRecordHandler)||void 0===r?void 0:r.startRecording(e,t)}},{key:"_stopRecording",value:function(){var e;return null==this||null===(e=this._screenRecordHandler)||void 0===e?void 0:e.stopRecording()}},{key:"_sendSensorDataToGame",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0};return this.logger.send("sensorMessage",{type:e,data:r}),new Promise((function(n,i){t._sendCustomMessage(MessageFactory$1.eventTypeSensors(e,[r.x,r.y,r.z])).then((function(){n()})).catch((function(){i()}))}))}},{key:"_sendShakeEventToGame",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1800;return this.logger.send("shakeEvent",{duration:t}),new Promise((function(r,n){var i=MessageFactory$1.eventShakeEvent(t);e._sendCustomMessage(i).then((function(){r()})).catch((function(){n()}))}))}},{key:"_getFocusedWindowApp",value:function(){this.logger.send("getFocusedWindowApp",{uid:this.podUserId});var e=MessageFactory$1.eventGetFocusedWindow({uid:this.podUserId});this._sendCustomMessage(e)}},{key:"_setSystemCursorShowStatControlKey",value:function(e){var t;return null==this||null===(t=this._systemCursorShowStatHandler)||void 0===t?void 0:t.setSystemCursorShowStatControlKey(e)}},{key:"_setSystemCursorShowStat",value:function(e){var t;return null==this||null===(t=this._systemCursorShowStatHandler)||void 0===t?void 0:t.setSystemCursorShowStat(e)}},{key:"_setSystemCursorSensitivity",value:function(e){var t;return null==this||null===(t=this._systemCursorShowStatHandler)||void 0===t?void 0:t.setSystemCursorSensitivity(e)}},{key:"_updateVideoRenderMode",value:function(e){var t;null===(t=this.client)||void 0===t||t.updateVideoRenderMode(e),this.touchHandler&&(this.touchHandler.videoRenderMode=e),this._updateVideoScale()}},{key:"_destroyHandler",value:function(){var e,t;(this._screenLockHandler&&(this._screenLockHandler.destroy(),this._screenLockHandler=null),this._locationServiceHandler&&this._locationServiceHandler.destroy(),this._localKeyboardHandler&&this._localKeyboardHandler.reset(),this._detectDelayHandler&&this._detectDelayHandler.stop(),this._mediaProvider===COMMUNICATION_MODE.RTC)&&(null===(e=this._localCameraHandler)||void 0===e||e.stop(),null===(t=this._localAudioHandler)||void 0===t||t.stop())}},{key:"_destroy",value:function(){var e=this;return this.logger.send("destroy"),new Promise((function(t,r){var n,i=e.client.getConnectionState();e._localKeyboardHandler.destroy(),e._fullscreenHandler.destroy(),null==e||null===(n=e._systemCursorShowStatHandler)||void 0===n||n.destroy(),e.isVePhone&&e._destroyDOM(e.containerDomId),"DISCONNECTED"!==i?e._stop().then((function(){e.client.destroy(),e.touchHandler.destroy(),e.logger.destroy(),e._removeResizeMonitor(),e.handlers.destroy(),t(!0)})).catch(r):(e.client.destroy(),e.remoteMessager=null,e.touchHandler.destroy(),e.logger.destroy(),e._removeResizeMonitor(),e.handlers.destroy(),t(!0))}))}},{key:"_changeRole",value:function(e){var t;return this.logger.send("changeRole",e),null==this||null===(t=this._controlRightHandler)||void 0===t?void 0:t.changeRole(e)}},{key:"_enableControl",value:function(e,t){var r;return null===(r=this._controlRightHandler)||void 0===r?void 0:r.enableControl(e,t)}},{key:"_hasControl",value:function(e){var t;return null===(t=this._controlRightHandler)||void 0===t?void 0:t.hasControl(e)}},{key:"_getAllControls",value:function(){var e;return null===(e=this._controlRightHandler)||void 0===e?void 0:e.getAllControls()}},{key:"_startVideoPlay",value:function(e,t){this.logger.send("startVideoPlay",{fiilePath:e,mode:t});var r=MessageFactory$1.eventTypeVideoPlayInject({action:1,path:e,mode:t});return this._sendCustomMessage(r)}},{key:"_stopVideoPlay",value:function(){this.logger.send("stopVideoPlay");var e=MessageFactory$1.eventTypeVideoPlayInject({action:0});return this._sendCustomMessage(e)}},{key:"_getVideoStatus",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.send("getVideoStatus"),t=MessageFactory$1.eventTypeVideoPlayInject({action:2}),e.abrupt("return",this._sendCustomMessageWithReturn({message:t,jsonCmd:SERVER_COMMAND.CMD_CAMERA_INJECT_STATUS}).then((function(e){var t;return Promise.resolve(null==e||null===(t=e.data)||void 0===t?void 0:t.data)})));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_setKeyboardStyle",value:function(e){var t=this;this.logger.send("setKeyboardStyle",{keyboard:e});var r="pod"===e?0:1;this._changeLocalKeyboardStatus(r);var n=MessageFactory$1.eventTypeKeyboardChange({keyboard:e,action:1});return this._sendCustomMessageWithReturn({message:n,jsonCmd:SERVER_COMMAND.CMD_KEYCODE_TYPE}).then((function(e){return new Promise((function(n,i){var o,a=null==e||null===(o=e.data)||void 0===o?void 0:o.data;if(0===(null==a?void 0:a.code))n({action:null==a?void 0:a.action,type:null==a?void 0:a.type});else{var s=POD_WARNING.WARNING_NATIVE_IME_DISABLED,c=s.CODE,u=s.MESSAGE;0===(null==a?void 0:a.type)&&1===r&&t._changeLocalKeyboardStatus(0),i({errorCode:c,message:u,oErrc:null==a?void 0:a.code,type:null==a?void 0:a.type})}}))}))}},{key:"_getKeyboardStyle",value:function(){this.logger.send("stopVideoPlay");var e=MessageFactory$1.eventTypeKeyboardChange({action:2});return this._sendCustomMessageWithReturn({message:e,jsonCmd:SERVER_COMMAND.CMD_KEYCODE_TYPE}).then((function(e){var t;return Promise.resolve(null==e||null===(t=e.data)||void 0===t?void 0:t.data)}))}}]),u}(HandlerCore);function logAop(e){e.isTestable=!0;var t,r=_createForOfIteratorHelper(Reflect.ownKeys(e.prototype).filter((function(e){return"constructor"!==e})));try{var n=function(){var r=t.value,n=e.prototype[r];e.prototype[r]=function(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e.LOGGER.localInfoLog("ClientTrigger",r,i),n.apply(this,i)}};for(r.s();!(t=r.n()).done;)n()}catch(err2){r.e(err2)}finally{r.f()}}function getUrlQuery(e){var t={};if(/\?/g.test(e))for(var r=e.substr(e.indexOf("?")+1).split("&"),n=0;n<r.length;n++){var i=r[n].split("=");t[i[0]]=i[1]||"0"}return t}Player.MODE=MODE,Player.ACTION=ACTION,Player.KEYCODE=KEYCODE,Player.MOUSE_BUTTON=MOUSE_BUTTON,Player.GAMEPAD_BUTTON=GAMEPAD_BUTTON,Player.NETWORK_QUALITY=NetworkHandler.NetworkQuality,Player.use=usePlugin,Player.plugins=getPluginNames(),Player.setSdkType=setSdkType,Player.onOrientationChange=orientationChange,Player.getDeviceId=getDeviceId,Player.isSupported=isSupportedStatic,Player.isSocketSupported=isSocketSupported,Player.isRtcSupported=isRtcSupported;var Stage=function(e){return e[e.ALL=0]="ALL",e[e.Init=1]="Init",e[e.Start=2]="Start",e[e.PodTrigger=3]="PodTrigger",e[e.Reconnect=4]="Reconnect",e[e.Stopped=5]="Stopped",e[e.ClientTrigger=6]="ClientTrigger",e}(Stage||{}),Logger=function(){function e(){_classCallCheck(this,e),this.state={colorGroup:{1:"#cf1322",2:"#ffc069",3:"#237804",4:"#595959",36:"#0958d9"}}}return _createClass(e,[{key:"getTime",value:function(){var e=new Date,t=e.getHours(),r=e.getMinutes(),n=e.getSeconds(),i=e.getMilliseconds();return"".concat(t,":").concat(r,":").concat(n,":").concat(i)}},{key:"print",value:function(e,t,r,n){var i,o,a,s,c=(null===(i=this.state.colorGroup)||void 0===i?void 0:i[e])||(null===(o=this.state.colorGroup)||void 0===o?void 0:o[4]);3===e&&"ClientTrigger"===t&&(c=null===(s=this.state.colorGroup)||void 0===s?void 0:s[36]);(a=console).log.apply(a,["%c".concat(this.getTime(),"~").concat(r),"color:".concat(c,";")].concat(_toConsumableArray(n)))}},{key:"getLocalShowGroup",value:function(){var e,t,r,n=[""],i=[""],o=!1,a=getUrlQuery(null===(e=window)||void 0===e||null===(t=e.location)||void 0===t?void 0:t.href);if(null!=a&&a._vegame_debuglog){var s,c;if(o=!0,null!=a&&a._vegame_debuglog_level)n=null==a||null===(s=a._vegame_debuglog_level)||void 0===s?void 0:s.split("_");if(null!=a&&a._vegame_debuglog_stage)i=null==a||null===(c=a._vegame_debuglog_stage)||void 0===c?void 0:c.split("_")}if(null!==(r=sessionStorage)&&void 0!==r&&r.getItem("_vegame_debuglog")){var u,l,d,p,_,h;if(o=!0,null!==(u=sessionStorage)&&void 0!==u&&u.getItem("_vegame_debuglog_level"))n=null===(d=sessionStorage)||void 0===d||null===(p=d.getItem("_vegame_debuglog_level"))||void 0===p?void 0:p.split("_");if(null!==(l=sessionStorage)&&void 0!==l&&l.getItem("_vegame_debuglog_stage"))i=null===(_=sessionStorage)||void 0===_||null===(h=_.getItem("_vegame_debuglog_stage"))||void 0===h?void 0:h.split("_")}return{logShowFlag:o,levelList:n,stageList:i}}},{key:"localLog",value:function(e,t,r,n){var i=this.getLocalShowGroup();if(null!=i&&i.logShowFlag){if(!(null!=i&&i.levelList.includes("0")||null!=i&&i.levelList.includes("")||null!=i&&i.levelList.includes("".concat(e))))return!1;if(null!=i&&i.levelList.includes("")&&"4"==e)return!1;if(!(null!=i&&i.stageList.includes("0")||null!=i&&i.stageList.includes("")||null!=i&&i.stageList.includes("".concat(Stage[t]))))return!1;this.print(e,t,"[".concat(e,"][").concat(t,"](").concat(r,") "),n)}}},{key:"localWarnLog",value:function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];this.localLog(2,e,t,n)}},{key:"localErrorLog",value:function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];this.localLog(1,e,t,n)}},{key:"localInfoLog",value:function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];this.localLog(3,e,t,n)}},{key:"localTraceLog",value:function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];this.localLog(4,e,t,n)}}]),e}(),__defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__decorateClass=function(e,t,r,n){for(var i,o=n>1?void 0:n?__getOwnPropDesc(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&__defProp(t,r,o),o};setSdkType("vePhone");var vePhoneSDK$1=function(e){_inherits(c,e);var t,r,n,i,o,a,s=_createSuper(c);function c(e){return _classCallCheck(this,c),s.call(this,_objectSpread2(_objectSpread2({mode:MODE.CLOUD_PHONE},e),{},{isVePhone:!0,needConnectFileChannel:!1}))}return _createClass(c,[{key:"checkSystemRequirements",value:function(){var e=!1;return["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach((function(t){e||window&&t in window&&(e=!0)})),e}},{key:"getVersion",value:function(){return"1.31.0"}},{key:"getStats",value:function(){return this._getStats()}},{key:"getConnectionState",value:function(){return this._getConnectionState()}},{key:"getDeviceId",value:function(){return this._getDeviceId()}},{key:"isAudioPlaying",value:function(){return!!this.streamMessager&&this.streamMessager.isAudioPlaying()}},{key:"setOptions",value:function(e){this._setOptions(e)}},{key:"getDebugInfo",value:function(){return this._getDebugInfo()}},{key:"setIdleTime",value:function(e){return this._setKeepAliveTime(e)}},{key:"volumeUp",value:function(){this._setGameAudioVolumeUp()}},{key:"volumeDown",value:function(){this._setGameAudioVolumeDown()}},{key:"setGameAudioVolumeUp",value:function(){this._setGameAudioVolumeUp()}},{key:"setGameAudioVolumeDown",value:function(){this._setGameAudioVolumeDown()}},{key:"setLocalAudioPlaybackVolume",value:function(e){this._setLocalAudioPlaybackVolume(e)}},{key:"getLocalAudioPlaybackVolume",value:function(){return this._getLocalAudioPlaybackVolume()}},{key:"setAutoRecycleTime",value:function(e){return this._setAutoRecycleTime(e)}},{key:"getAutoRecycleTime",value:function(){return this._getAutoRecycleTime()}},{key:"setRemoteLocationMock",value:function(e){return this._setRemoteLocationMock(e)}},{key:"enableLocationService",value:function(e){this._enableLocationService(e)}},{key:"isLocationServiceEnabled",value:function(){return this._isLocationServiceEnabled()}},{key:"setLocationServiceMode",value:function(e){this._setLocationServiceMode(e)}},{key:"getLocationServiceMode",value:function(){return this._getLocationServiceMode()}},{key:"getRemoteBackgroundAppList",value:function(){return this._getRemoteBackgroundAppList()}},{key:"setRemoteAppForeground",value:function(e){return this._setRemoteAppForeground(e)}},{key:"start",value:function(e){return this._start(e)}},{key:"restart",value:function(){return this._restart()}},{key:"startRTC",value:function(e){return this._startRTC(e)}},{key:"playByInteraction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._playByInteraction(e)}},{key:"monitorPod",value:function(e){return this._monitorPod(e)}},{key:"stop",value:function(){return this._stop(!0)}},{key:"pause",value:function(){return this._pauseOrResume(!0)}},{key:"resume",value:function(){return this._pauseOrResume(!1)}},{key:"rotateCoordinate",value:function(e){this._rotateCoordinate(e)}},{key:"rotateScreen",value:function(e,t){this._rotateScreen(e,t)}},{key:"rotate",value:function(e){this._rotate(e)}},{key:"setAudioMute",value:function(e){return this._setAudioMute(e)}},{key:"muteAudio",value:function(e){return this._muteAudio(e)}},{key:"isAudioMuted",value:function(){return this._isAudioMuted()}},{key:"muteVideo",value:function(e){return this._muteVideo(e)}},{key:"isVideoMuted",value:function(){return this._isVideoMuted()}},{key:"playAudio",value:function(){this._playAudio()}},{key:"closeApp",value:function(e){this._closeApp(e)}},{key:"launchApp",value:function(e){this._launchApp(e)}},{key:"sendMessage",value:function(e){var t=e.message,r=e.needAck,n=e.timeout,i=e.destUserId;return this._sendVEMessage({message:t,needAck:r,timeout:n,destUserId:i})}},{key:"sendClipBoardMessage",value:function(e){return this._sendClipBoardMessage(e)}},{key:"sendCustomMessage",value:function(e){return this._sendCustomMessage(e)}},{key:"sendTouchMessage",value:function(e){return this._sendTouchMessage(e)}},{key:"sendKeycodeMessage",value:function(e){return this._sendKeycodeMessage(e)}},{key:"sendMouseMessage",value:function(e){this._sendMouseMessage(e)}},{key:"enableLocalAudio",value:function(){return this._enableLocalAudio()}},{key:"disableLocalAudio",value:function(){return this._disableLocalAudio()}},{key:"switchVideoStreamProfile",value:function(e){return this._switchVideoStreamProfile(e)}},{key:"switchBackground",value:function(e){return this._switchBackground(e)}},{key:"setFullScreenState",value:function(e,t){return this._setFullScreenState(e,t)}},{key:"setAudioSourceType",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._setAudioSourceType(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"startExternalAudioTrack",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._startExternalAudioTrack(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"stopExternalAudioTrack",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._stopExternalAudioTrack());case 1:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"startSendAudioStream",value:function(){return this._startSendAudioStream()}},{key:"stopSendAudioStream",value:function(){return this._stopSendAudioStream()}},{key:"getAudioPlaybackDeviceList",value:function(){return this._getAudioPlaybackDeviceList()}},{key:"setAudioPlaybackDevice",value:function(e){return this._setAudioPlaybackRoute(e)}},{key:"getAudioCaptureDeviceList",value:function(){return this._getAudioCaptureDeviceList()}},{key:"setAudioCaptureDevice",value:function(e){return this._setAudioCaptureDevice(e)}},{key:"getAudioPlaybackDevice",value:function(){return this._getAudioPlaybackRoute()}},{key:"getAudioCaptureDevice",value:function(){return this._getAudioCaptureDevice()}},{key:"setVideoSourceType",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._setVideoSourceType(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"startExternalVideoTrack",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._startExternalVideoTrack(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"stopExternalVideoTrack",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._stopExternalVideoTrack());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"startVideoStream",value:function(){return this._startVideoStream()}},{key:"stopVideoStream",value:function(){return this._stopVideoStream()}},{key:"switchCamera",value:function(e){return this._setVideoCaptureDevice(e)}},{key:"getVideoPlaybackDeviceList",value:function(){return this._getVideoPlaybackDeviceList()}},{key:"getVideoCaptureDevice",value:function(){return this._getVideoCaptureDevice()}},{key:"setLocalVideoView",value:function(e){return this._setLocalVideoView(e)}},{key:"setVideoRotationMode",value:function(e){return this._setVideoRotationMode(e)}},{key:"setLocalVideoMirrorMode",value:function(e){return this._setLocalVideoMirrorMode(e)}},{key:"getLocalVideoMirrorMode",value:function(){return this._getLocalVideoMirrorMode()}},{key:"setVideoCaptureConfig",value:function(e){return this._setVideoCaptureConfig(e)}},{key:"setVideoEncoderConfig",value:function(e){return this._setVideoEncoderConfig(e)}},{key:"setReconnectTime",value:function(e){return this._setReconnectTime(e)}},{key:"setToHomePage",value:function(){return this._setToHomePage()}},{key:"setBackToPreviousPage",value:function(){return this._setBackToPreviousPage()}},{key:"setToRecentAppPage",value:function(){return this._setToRecentAppPage()}},{key:"screenShot",value:function(e){return this._screenShot(e)}},{key:"getFocusedWindowApp",value:function(){return this._getFocusedWindowApp()}},{key:"destroy",value:function(){return this._destroy()}},{key:"startRecording",value:function(e,t){return this._startRecording(e,t)}},{key:"stopRecording",value:function(){return this._stopRecording()}},{key:"startPushFile",value:function(e,t){var r=t.folder,n=t.name;return this.handlers.TosFileChannelHandler.startPushFile(e,{folder:r,name:n})}},{key:"stopPushFile",value:function(){return this.handlers.TosFileChannelHandler.stopPushFile()}},{key:"startPullFile",value:function(e){var t=e.folder,r=e.name,n=e.returnUrl,i=void 0!==n&&n;return this.handlers.TosFileChannelHandler.startPullFile({folder:t,name:r,returnUrl:i})}},{key:"stopPullFile",value:function(){return this.handlers.TosFileChannelHandler.stopPullFile()}},{key:"setReturnUrl",value:function(e){return this.handlers.TosFileChannelHandler.setReturnUrl(e)}},{key:"sendShakeEventToGame",value:function(e){return this._sendShakeEventToGame(e)}},{key:"setNavBarStatus",value:function(e){return this._setNavigationBarStatus(e)}},{key:"getNavBarStatus",value:function(){return this._getNavigationBarStatus()}},{key:"updateVideoRenderMode",value:function(e){return this._updateVideoRenderMode(e)}},{key:"changeLocalKeyboardStatus",value:function(e){return this._changeLocalKeyboardStatus(e)}},{key:"startVideoPlay",value:function(e,t){return this._startVideoPlay(e,t)}},{key:"stopVideoPlay",value:function(){return this._stopVideoPlay()}},{key:"getVideoStatus",value:function(){return this._getVideoStatus()}},{key:"enableControl",value:function(e,t){return this._enableControl(e,t)}},{key:"hasControl",value:function(e){return this._hasControl(e)}},{key:"getAllControls",value:function(){return this._getAllControls()}},{key:"setKeyboardStyle",value:function(e){return this._setKeyboardStyle(e)}},{key:"getKeyboardStyle",value:function(){return this._getKeyboardStyle()}}],[{key:"setSdkType",value:function(){_get(_getPrototypeOf(c),"setSdkType",this).call(this,"vePhone")}}]),c}(Player);vePhoneSDK$1.MODE=MODE,vePhoneSDK$1.ACTION=ACTION,vePhoneSDK$1.KEYCODE=KEYCODE,vePhoneSDK$1.MOUSE_BUTTON=MOUSE_BUTTON,vePhoneSDK$1.GAMEPAD_BUTTON=GAMEPAD_BUTTON,vePhoneSDK$1.LOCATION_SERVICE_MODE=LOCATION_SERVICE_MODE,vePhoneSDK$1.STREAM_TYPE=STREAM_TYPE,vePhoneSDK$1.VIDEO_SOURCE_TYPE=VIDEO_SOURCE_TYPE,vePhoneSDK$1.AUDIO_SOURCE_TYPE=AUDIO_SOURCE_TYPE,vePhoneSDK$1.VIDEO_RENDER_MODE=VIDEO_RENDER_MODE,vePhoneSDK$1.LOGGER=new Logger,vePhoneSDK$1=__decorateClass([logAop],vePhoneSDK$1);var vePhoneSDK=vePhoneSDK$1;return vePhoneSDK}));
//# sourceMappingURL=index.umd.min.js.map
